<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>SearchTree: Binary Search Trees</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/vfa.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 3: Verified Functional Algorithms</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">SearchTree<span class="subtitle">Binary Search Trees</span></h1>

<div class="code">
</div>

<div class="doc">

<div class="paragraph"> </div>

 We have implemented maps twice so far: with lists in
    <a href="https://softwarefoundations.cis.upenn.edu/lf-current/Lists.html"><span class="inlineref">Lists</span></a>, and with higher-order functions in <a href="https://softwarefoundations.cis.upenn.edu/lf-current/Maps.html"><span class="inlineref">Maps</span></a>.
    Those are simple but inefficient implementations: looking up the
    value bound to a given key takes time linear in the number of
    bindings, both in the worst and expected case. 
<div class="paragraph"> </div>

 If the type of keys can be totally ordered -- that is, it supports
    a well-behaved <span class="inlinecode">≤</span> comparison -- then maps can be implemented with
    <i>binary search trees</i> (BSTs).  Insert and lookup operations on
    BSTs take time proportional to the height of the tree.  If the
    tree is balanced, the operations therefore take logarithmic time. 
<div class="paragraph"> </div>

 If you don't recall BSTs or haven't seen them in a while, see
    Wikipedia or read any standard textbook; for example:

<div class="paragraph"> </div>

<ul class="doclist">
<li> Section 3.2 of <i>Algorithms, Fourth Edition</i>, by Sedgewick and
      Wayne, Addison Wesley 2011; or

<div class="paragraph"> </div>


</li>
<li> Chapter 12 of <i>Introduction to Algorithms, 3rd Edition</i>, by
      Cormen, Leiserson, and Rivest, MIT Press 2009. 
</li>
</ul>

</div>

<div class="doc">
<a name="lab98"></a><h1 class="section">BST Implementation</h1>

<div class="paragraph"> </div>

 We use <span class="inlinecode"><span class="id" title="var">nat</span></span> as the key type in our implementation of BSTs,
    since it has a convenient total order <span class="inlinecode">&lt;=?</span> with lots of theorems
    and automation available. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a name="key"><span class="id" title="definition">key</span></a> := <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>.<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">E</span></span> represents the empty map.  <span class="inlinecode"><span class="id" title="var">T</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">r</span></span> represents the
    map that binds <span class="inlinecode"><span class="id" title="var">k</span></span> to <span class="inlinecode"><span class="id" title="var">v</span></span>, along with all the bindings in <span class="inlinecode"><span class="id" title="var">l</span></span> and
    <span class="inlinecode"><span class="id" title="var">r</span></span>.  No key may be bound more than once in the map. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <a name="tree"><span class="id" title="inductive">tree</span></a> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) : <span class="id" title="keyword">Type</span> :=<br/>
| <a name="E"><span class="id" title="constructor">E</span></a><br/>
| <a name="T"><span class="id" title="constructor">T</span></a> (<span class="id" title="var">l</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">v</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">r</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>).<br/><hr class='doublespaceincode'/>
<span class="id" title="var">Arguments</span> <a class="idref" href="SearchTree.html#E"><span class="id" title="constructor">E</span></a> {<span class="id" title="var">V</span>}.<br/>
<span class="id" title="var">Arguments</span> <a class="idref" href="SearchTree.html#T"><span class="id" title="constructor">T</span></a> {<span class="id" title="var">V</span>}.<br/>
</div>

<div class="doc">
An example tree:
<pre>
      4 <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> "four"
      /        \
     /          \
  2 <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> "two"   5 <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> "five"
</pre>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a name="ex_tree"><span class="id" title="definition">ex_tree</span></a> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a> :=<br/>
&nbsp;&nbsp;(<a class="idref" href="SearchTree.html#T"><span class="id" title="constructor">T</span></a> (<a class="idref" href="SearchTree.html#T"><span class="id" title="constructor">T</span></a> <a class="idref" href="SearchTree.html#E"><span class="id" title="constructor">E</span></a> 2 "two" <a class="idref" href="SearchTree.html#E"><span class="id" title="constructor">E</span></a>) 4 "four" (<a class="idref" href="SearchTree.html#T"><span class="id" title="constructor">T</span></a> <a class="idref" href="SearchTree.html#E"><span class="id" title="constructor">E</span></a> 5 "five" <a class="idref" href="SearchTree.html#E"><span class="id" title="constructor">E</span></a>))%<span class="id" title="var">string</span>.<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">empty_tree</span></span> contains no bindings. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a name="empty_tree"><span class="id" title="definition">empty_tree</span></a> {<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>} : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="SearchTree.html#E"><span class="id" title="constructor">E</span></a>.<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">bound</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> is whether <span class="inlinecode"><span class="id" title="var">k</span></span> is bound in <span class="inlinecode"><span class="id" title="var">t</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <a name="bound"><span class="id" title="definition">bound</span></a> {<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">x</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="SearchTree.html#E"><span class="id" title="constructor">E</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="SearchTree.html#T"><span class="id" title="constructor">T</span></a> <span class="id" title="var">l</span> <span class="id" title="var">y</span> <span class="id" title="var">v</span> <span class="id" title="var">r</span> ⇒ <span class="id" title="keyword">if</span> <a class="idref" href="SearchTree.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <span class="id" title="var">y</span> <span class="id" title="keyword">then</span> <a class="idref" href="SearchTree.html#bound"><span class="id" title="definition">bound</span></a> <a class="idref" href="SearchTree.html#x"><span class="id" title="variable">x</span></a> <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="keyword">if</span> <a class="idref" href="SearchTree.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Perm.html#5ea9023a94e85f78711b2bf8cc72c8f<sub>4</sub>"><span class="id" title="notation">&gt;?</span></a> <span class="id" title="var">y</span> <span class="id" title="keyword">then</span> <a class="idref" href="SearchTree.html#bound"><span class="id" title="definition">bound</span></a> <a class="idref" href="SearchTree.html#x"><span class="id" title="variable">x</span></a> <span class="id" title="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">lookup</span></span> <span class="inlinecode"><span class="id" title="var">d</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> is the value bound to <span class="inlinecode"><span class="id" title="var">k</span></span> in <span class="inlinecode"><span class="id" title="var">t</span></span>, or is default
    value <span class="inlinecode"><span class="id" title="var">d</span></span> if <span class="inlinecode"><span class="id" title="var">k</span></span> is not bound in <span class="inlinecode"><span class="id" title="var">t</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <a name="lookup"><span class="id" title="definition">lookup</span></a> {<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">d</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">x</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="SearchTree.html#E"><span class="id" title="constructor">E</span></a> ⇒ <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="SearchTree.html#T"><span class="id" title="constructor">T</span></a> <span class="id" title="var">l</span> <span class="id" title="var">y</span> <span class="id" title="var">v</span> <span class="id" title="var">r</span> ⇒ <span class="id" title="keyword">if</span> <a class="idref" href="SearchTree.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <span class="id" title="var">y</span> <span class="id" title="keyword">then</span> <a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#x"><span class="id" title="variable">x</span></a> <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="keyword">if</span> <a class="idref" href="SearchTree.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Perm.html#5ea9023a94e85f78711b2bf8cc72c8f<sub>4</sub>"><span class="id" title="notation">&gt;?</span></a> <span class="id" title="var">y</span> <span class="id" title="keyword">then</span> <a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#x"><span class="id" title="variable">x</span></a> <span class="id" title="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">insert</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> is the map containing all the bindings of <span class="inlinecode"><span class="id" title="var">t</span></span> along
    with a binding of <span class="inlinecode"><span class="id" title="var">k</span></span> to <span class="inlinecode"><span class="id" title="var">v</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <a name="insert"><span class="id" title="definition">insert</span></a> {<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">x</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">v</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="SearchTree.html#E"><span class="id" title="constructor">E</span></a> ⇒ <a class="idref" href="SearchTree.html#T"><span class="id" title="constructor">T</span></a> <a class="idref" href="SearchTree.html#E"><span class="id" title="constructor">E</span></a> <a class="idref" href="SearchTree.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="SearchTree.html#E"><span class="id" title="constructor">E</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="SearchTree.html#T"><span class="id" title="constructor">T</span></a> <span class="id" title="var">l</span> <span class="id" title="var">y</span> <span class="id" title="var">v'</span> <span class="id" title="var">r</span> ⇒ <span class="id" title="keyword">if</span> <a class="idref" href="SearchTree.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <span class="id" title="var">y</span> <span class="id" title="keyword">then</span> <a class="idref" href="SearchTree.html#T"><span class="id" title="constructor">T</span></a> (<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> <span class="id" title="var">l</span>) <span class="id" title="var">y</span> <span class="id" title="var">v'</span> <span class="id" title="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="keyword">if</span> <a class="idref" href="SearchTree.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Perm.html#5ea9023a94e85f78711b2bf8cc72c8f<sub>4</sub>"><span class="id" title="notation">&gt;?</span></a> <span class="id" title="var">y</span> <span class="id" title="keyword">then</span> <a class="idref" href="SearchTree.html#T"><span class="id" title="constructor">T</span></a> <span class="id" title="var">l</span> <span class="id" title="var">y</span> <span class="id" title="var">v'</span> (<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> <span class="id" title="var">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <a class="idref" href="SearchTree.html#T"><span class="id" title="constructor">T</span></a> <span class="id" title="var">l</span> <a class="idref" href="SearchTree.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> <span class="id" title="var">r</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
Note that <span class="inlinecode"><span class="id" title="var">insert</span></span> is a <i>functional</i> aka <i>persistent</i>
    implementation: <span class="inlinecode"><span class="id" title="var">t</span></span> is not changed. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Module</span> <a name="Tests"><span class="id" title="module">Tests</span></a>.<br/>
</div>

<div class="doc">
Here are some unit tests to check that BSTs behave the way we
    expect. 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">string_scope</span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="keyword">Example</span> <a name="Tests.bst_ex<sub>1</sub>"><span class="id" title="definition">bst_ex<sub>1</sub></span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> 5 "five" (<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> 2 "two" (<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> 4 "four" <a class="idref" href="SearchTree.html#empty_tree"><span class="id" title="definition">empty_tree</span></a>)) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#ex_tree"><span class="id" title="definition">ex_tree</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="keyword">Example</span> <a name="Tests.bst_ex<sub>2</sub>"><span class="id" title="definition">bst_ex<sub>2</sub></span></a> : <a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> "" 5 <a class="idref" href="SearchTree.html#ex_tree"><span class="id" title="definition">ex_tree</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> "five".<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="keyword">Example</span> <a name="Tests.bst_ex<sub>3</sub>"><span class="id" title="definition">bst_ex<sub>3</sub></span></a> : <a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> "" 3 <a class="idref" href="SearchTree.html#ex_tree"><span class="id" title="definition">ex_tree</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> "".<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="keyword">Example</span> <a name="Tests.bst_ex<sub>4</sub>"><span class="id" title="definition">bst_ex<sub>4</sub></span></a> : <a class="idref" href="SearchTree.html#bound"><span class="id" title="definition">bound</span></a> 3 <a class="idref" href="SearchTree.html#ex_tree"><span class="id" title="definition">ex_tree</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="SearchTree.html#Tests"><span class="id" title="module">Tests</span></a>.<br/>
</div>

<div class="doc">
Although we can spot-check the behavior of BST operations with
    unit tests like these, we of course should prove general theorems
    about their correctness.  We will do that later in the chapter. 
</div>

<div class="doc">
<a name="lab99"></a><h1 class="section">BST Invariant</h1>

<div class="paragraph"> </div>

 The implementations of <span class="inlinecode"><span class="id" title="var">lookup</span></span> and <span class="inlinecode"><span class="id" title="var">insert</span></span> assume that
    values of type <span class="inlinecode"><span class="id" title="var">tree</span></span> obey the <i>BST invariant</i>: for any non-empty
    node with key <span class="inlinecode"><span class="id" title="var">k</span></span>, all the values of the left subtree are less
    than <span class="inlinecode"><span class="id" title="var">k</span></span> and all the values of the right subtree are greater than
    <span class="inlinecode"><span class="id" title="var">k</span></span>.  But that invariant is not part of the definition of
    <span class="inlinecode"><span class="id" title="var">tree</span></span>. For example, the following tree is not a BST: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Module</span> <a name="NotBst"><span class="id" title="module">NotBst</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">string_scope</span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="NotBst.t"><span class="id" title="definition">t</span></a> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#T"><span class="id" title="constructor">T</span></a> (<a class="idref" href="SearchTree.html#T"><span class="id" title="constructor">T</span></a> <a class="idref" href="SearchTree.html#E"><span class="id" title="constructor">E</span></a> 5 "five" <a class="idref" href="SearchTree.html#E"><span class="id" title="constructor">E</span></a>) 4 "four" (<a class="idref" href="SearchTree.html#T"><span class="id" title="constructor">T</span></a> <a class="idref" href="SearchTree.html#E"><span class="id" title="constructor">E</span></a> 2 "two" <a class="idref" href="SearchTree.html#E"><span class="id" title="constructor">E</span></a>).<br/>
</div>

<div class="doc">
The <span class="inlinecode"><span class="id" title="var">insert</span></span> function we wrote above would never produce
      such a tree, but we can still construct it by manually applying
      <span class="inlinecode"><span class="id" title="var">T</span></span>. When we try to lookup <span class="inlinecode">2</span> in that tree, we get the wrong
      answer, because <span class="inlinecode"><span class="id" title="var">lookup</span></span> assumes <span class="inlinecode">2</span> is in the left subtree: 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Example</span> <a name="NotBst.not_bst_lookup_wrong"><span class="id" title="definition">not_bst_lookup_wrong</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> "" 2 <a class="idref" href="SearchTree.html#NotBst.t"><span class="id" title="definition">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">≠</span></a> "two".<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#not"><span class="id" title="definition">not</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">contra</span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="SearchTree.html#NotBst"><span class="id" title="module">NotBst</span></a>.<br/>
</div>

<div class="doc">
So, let's formalize the BST invariant. Here's one way to do
    so.  First, we define a helper <span class="inlinecode"><span class="id" title="var">ForallT</span></span> to express that idea that
    a predicate holds at every node of a tree: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <a name="ForallT"><span class="id" title="definition">ForallT</span></a> {<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">P</span>: <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>) (<span class="id" title="var">t</span>: <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="SearchTree.html#E"><span class="id" title="constructor">E</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#True"><span class="id" title="inductive">True</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="SearchTree.html#T"><span class="id" title="constructor">T</span></a> <span class="id" title="var">l</span> <span class="id" title="var">k</span> <span class="id" title="var">v</span> <span class="id" title="var">r</span> ⇒ <a class="idref" href="SearchTree.html#P"><span class="id" title="variable">P</span></a> <span class="id" title="var">k</span> <span class="id" title="var">v</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="SearchTree.html#ForallT"><span class="id" title="definition">ForallT</span></a> <a class="idref" href="SearchTree.html#P"><span class="id" title="variable">P</span></a> <span class="id" title="var">l</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="SearchTree.html#ForallT"><span class="id" title="definition">ForallT</span></a> <a class="idref" href="SearchTree.html#P"><span class="id" title="variable">P</span></a> <span class="id" title="var">r</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
Second, we define the BST invariant:

<div class="paragraph"> </div>

<ul class="doclist">
<li> An empty tree is a BST.

<div class="paragraph"> </div>


</li>
<li> A non-empty tree is a BST if all its left nodes have a lesser
      key, its right nodes have a greater key, and the left and
      right subtrees are themselves BSTs. 
</li>
</ul>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <a name="BST"><span class="id" title="inductive">BST</span></a> {<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>} : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <span class="id" title="var">V</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
| <a name="BST_E"><span class="id" title="constructor">BST_E</span></a> : <a class="idref" href="SearchTree.html#BST"><span class="id" title="inductive">BST</span></a> <a class="idref" href="SearchTree.html#E"><span class="id" title="constructor">E</span></a><br/>
| <a name="BST_T"><span class="id" title="constructor">BST_T</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">v</span> <span class="id" title="var">r</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#ForallT"><span class="id" title="definition">ForallT</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="SearchTree.html#y"><span class="id" title="variable">y</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="SearchTree.html#x"><span class="id" title="variable">x</span></a>) <a class="idref" href="SearchTree.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#ForallT"><span class="id" title="definition">ForallT</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="SearchTree.html#y"><span class="id" title="variable">y</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#7f2a7ef2c63af7359b22787a9daf336e"><span class="id" title="notation">&gt;</span></a> <a class="idref" href="SearchTree.html#x"><span class="id" title="variable">x</span></a>) <a class="idref" href="SearchTree.html#r"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#BST"><span class="id" title="inductive">BST</span></a> <a class="idref" href="SearchTree.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#BST"><span class="id" title="inductive">BST</span></a> <a class="idref" href="SearchTree.html#r"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#BST"><span class="id" title="inductive">BST</span></a> (<a class="idref" href="SearchTree.html#T"><span class="id" title="constructor">T</span></a> <a class="idref" href="SearchTree.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="SearchTree.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="SearchTree.html#r"><span class="id" title="variable">r</span></a>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Hint Constructors</span> <a class="idref" href="SearchTree.html#BST"><span class="id" title="inductive">BST</span></a>.<br/>
</div>

<div class="doc">
Let's check that <span class="inlinecode"><span class="id" title="var">BST</span></span> correctly classifies a couple of example
    trees: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Example</span> <a name="is_BST_ex"><span class="id" title="definition">is_BST_ex</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="SearchTree.html#BST"><span class="id" title="inductive">BST</span></a> <a class="idref" href="SearchTree.html#ex_tree"><span class="id" title="definition">ex_tree</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="SearchTree.html#ex_tree"><span class="id" title="definition">ex_tree</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">omega</span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <a name="not_BST_ex"><span class="id" title="definition">not_BST_ex</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">¬</span></a> <a class="idref" href="SearchTree.html#BST"><span class="id" title="inductive">BST</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="definition">NotBst.t</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="SearchTree.html#t"><span class="id" title="definition">NotBst.t</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">contra</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">inv</span> <span class="id" title="var">contra</span>. <span class="id" title="var">inv</span> <span class="id" title="var">H<sub>3</sub></span>. <span class="id" title="tactic">omega</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab100"></a><h4 class="section">Exercise: 1 star, standard (empty_tree_BST)</h4>

<div class="paragraph"> </div>

 Prove that the empty tree is a BST. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <a name="empty_tree_BST"><span class="id" title="lemma">empty_tree_BST</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#BST"><span class="id" title="inductive">BST</span></a> (@<a class="idref" href="SearchTree.html#empty_tree"><span class="id" title="definition">empty_tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab101"></a><h4 class="section">Exercise: 4 stars, standard (insert_BST)</h4>

<div class="paragraph"> </div>

 Prove that <span class="inlinecode"><span class="id" title="var">insert</span></span> produces a BST, assuming it is given one.

<div class="paragraph"> </div>

    Start by proving this helper lemma, which says that <span class="inlinecode"><span class="id" title="var">insert</span></span>
    preserves any node predicate. Proceed by induction on <span class="inlinecode"><span class="id" title="var">t</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="ForallT_insert"><span class="id" title="lemma">ForallT_insert</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">P</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#ForallT"><span class="id" title="definition">ForallT</span></a> <a class="idref" href="SearchTree.html#P"><span class="id" title="variable">P</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">∀</span> (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">v</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#P"><span class="id" title="variable">P</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="SearchTree.html#ForallT"><span class="id" title="definition">ForallT</span></a> <a class="idref" href="SearchTree.html#P"><span class="id" title="variable">P</span></a> (<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
</div>

<div class="doc">
Now prove the main theorem. Proceed by induction on the evidence
    that <span class="inlinecode"><span class="id" title="var">t</span></span> is a BST. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <a name="insert_BST"><span class="id" title="lemma">insert_BST</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">v</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#BST"><span class="id" title="inductive">BST</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="SearchTree.html#BST"><span class="id" title="inductive">BST</span></a> (<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 Since <span class="inlinecode"><span class="id" title="var">empty_tree</span></span> and <span class="inlinecode"><span class="id" title="var">insert</span></span> are the only operations that
    create BSTs, we are guaranteed that any <span class="inlinecode"><span class="id" title="var">tree</span></span> is a BST -- unless
    it was constructed manually with <span class="inlinecode"><span class="id" title="var">T</span></span>.  It would therefore make
    sense to limit the use of <span class="inlinecode"><span class="id" title="var">T</span></span> to only within the tree operations,
    rather than expose it.  Coq, like OCaml and other functional
    languages, can do this with its module system.  See <a href="ADT.html"><span class="inlineref">ADT</span></a> for
    details. 
</div>

<div class="doc">
<a name="lab102"></a><h1 class="section">Correctness of BST Operations</h1>

<div class="paragraph"> </div>

 To prove the correctness of <span class="inlinecode"><span class="id" title="var">lookup</span></span> and <span class="inlinecode"><span class="id" title="var">bound</span></span>, we need
    specifications for them.  We'll study two different techniques for
    that in this chapter. 
<div class="paragraph"> </div>

 The first is called <i>algebraic specification</i>.  With it, we write
    down equations relating the results of operations.  For example,
    we could write down equations like the following to specify the
    <span class="inlinecode">+</span> and <span class="inlinecode">×</span> operations:

<div class="paragraph"> </div>

<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">a</span> + <span class="id" title="var">b</span>) + <span class="id" title="var">c</span> = <span class="id" title="var">a</span> + (<span class="id" title="var">b</span> + <span class="id" title="var">c</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> + <span class="id" title="var">b</span> = <span class="id" title="var">b</span> + <span class="id" title="var">a</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> + 0 = <span class="id" title="var">a</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">a</span> × <span class="id" title="var">b</span>) × <span class="id" title="var">c</span> = <span class="id" title="var">a</span> × (<span class="id" title="var">b</span> × <span class="id" title="var">c</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> × <span class="id" title="var">b</span> = <span class="id" title="var">b</span> × <span class="id" title="var">a</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> × 1 = <span class="id" title="var">a</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> × 0 = 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> × (<span class="id" title="var">b</span> + <span class="id" title="var">c</span>) = <span class="id" title="var">a</span> × <span class="id" title="var">b</span> + <span class="id" title="var">a</span> × <span class="id" title="var">c</span>
<div class="paragraph"> </div>

</span>
<div class="paragraph"> </div>

    For BSTs, let's examine how <span class="inlinecode"><span class="id" title="var">lookup</span></span> should interact with
    when applied to other operations.  It is easy to see what needs to
    be true for <span class="inlinecode"><span class="id" title="var">empty_tree</span></span>: looking up any value at all in the empty
    tree should fail and return the default value:

<div class="paragraph"> </div>

<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lookup</span> <span class="id" title="var">d</span> <span class="id" title="var">k</span> <span class="id" title="var">empty_tree</span> = <span class="id" title="var">d</span>
<div class="paragraph"> </div>

</span>
<div class="paragraph"> </div>

    What about non-empty trees?  The only way to build a non-empty
    tree is by applying <span class="inlinecode"><span class="id" title="var">insert</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> to an existing tree <span class="inlinecode"><span class="id" title="var">t</span></span>. So it
    suffices to describe the behavior of <span class="inlinecode"><span class="id" title="var">lookup</span></span> on the result of an
    arbitrary <span class="inlinecode"><span class="id" title="var">insert</span></span> operation. There are two cases.  If we look up
    the same key that was just inserted, we should get the value that
    was inserted with it:

<div class="paragraph"> </div>

<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lookup</span> <span class="id" title="var">d</span> <span class="id" title="var">k</span> (<span class="id" title="var">insert</span> <span class="id" title="var">k</span> <span class="id" title="var">v</span> <span class="id" title="var">t</span>) = <span class="id" title="var">v</span>
<div class="paragraph"> </div>

</span>
<div class="paragraph"> </div>

    If we look up a different key than was just inserted, the insert
    should not affect the answer -- which should be the same as if we
    did the lookup in the original tree before the insert occured:

<div class="paragraph"> </div>

<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lookup</span> <span class="id" title="var">d</span> <span class="id" title="var">k'</span> (<span class="id" title="var">insert</span> <span class="id" title="var">k</span> <span class="id" title="var">v</span> <span class="id" title="var">t</span>) = <span class="id" title="var">lookup</span> <span class="id" title="var">d</span> <span class="id" title="var">k'</span> <span class="id" title="var">t</span>      <span class="id" title="keyword">if</span> <span class="id" title="var">k</span> ≠ <span class="id" title="var">k'</span>
<div class="paragraph"> </div>

</span>
<div class="paragraph"> </div>

    These three basic equations specify the correct behavior of maps.
    Let's prove that they hold. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <a name="lookup_empty"><span class="id" title="lemma">lookup_empty</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">d</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#empty_tree"><span class="id" title="definition">empty_tree</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <a name="lookup_insert_eq"><span class="id" title="lemma">lookup_insert_eq</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">d</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">v</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> (<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>)  <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">bdestruct</span> (<span class="id" title="var">k</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <span class="id" title="var">k</span>); <span class="id" title="tactic">try</span> <span class="id" title="tactic">omega</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">bdestruct</span> (<span class="id" title="var">k</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <span class="id" title="var">k<sub>0</sub></span>); <span class="id" title="var">bdestruct</span> (<span class="id" title="var">k<sub>0</sub></span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <span class="id" title="var">k</span>); <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">omega</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">bdestruct</span> (<span class="id" title="var">k</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <span class="id" title="var">k<sub>0</sub></span>); <span class="id" title="var">bdestruct</span> (<span class="id" title="var">k<sub>0</sub></span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <span class="id" title="var">k</span>); <span class="id" title="tactic">try</span> <span class="id" title="tactic">omega</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">bdestruct</span> (<span class="id" title="var">k</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <span class="id" title="var">k<sub>0</sub></span>); <span class="id" title="var">bdestruct</span> (<span class="id" title="var">k<sub>0</sub></span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <span class="id" title="var">k</span>); <span class="id" title="tactic">try</span> <span class="id" title="tactic">omega</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">bdestruct</span> (<span class="id" title="var">k<sub>0</sub></span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <span class="id" title="var">k<sub>0</sub></span>); <span class="id" title="tactic">try</span> <span class="id" title="tactic">omega</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The basic method of that proof is to repeatedly <span class="inlinecode"><span class="id" title="var">bdestruct</span></span>
    everything in sight, followed by generous use of <span class="inlinecode"><span class="id" title="tactic">omega</span></span> and
    <span class="inlinecode"><span class="id" title="tactic">auto</span></span>. Let's automate that. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">bdestruct_guard</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| &#x22A2; <span class="id" title="keyword">context</span> [ <span class="id" title="keyword">if</span> ?<span class="id" title="var">X</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#ad2ec4e405f68c46c0a176e3e94ae2e<sub>3</sub>"><span class="id" title="notation">=?</span></a> ?<span class="id" title="var">Y</span> <span class="id" title="keyword">then</span> <span class="id" title="var">_</span> <span class="id" title="keyword">else</span> <span class="id" title="var">_</span> ] ⇒ <span class="id" title="var">bdestruct</span> (<span class="id" title="var">X</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#ad2ec4e405f68c46c0a176e3e94ae2e<sub>3</sub>"><span class="id" title="notation">=?</span></a> <span class="id" title="var">Y</span>)<br/>
&nbsp;&nbsp;| &#x22A2; <span class="id" title="keyword">context</span> [ <span class="id" title="keyword">if</span> ?<span class="id" title="var">X</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#0f31f5c1c6b6a21a3a187247222bc9e<sub>4</sub>"><span class="id" title="notation">&lt;=?</span></a> ?<span class="id" title="var">Y</span> <span class="id" title="keyword">then</span> <span class="id" title="var">_</span> <span class="id" title="keyword">else</span> <span class="id" title="var">_</span> ] ⇒ <span class="id" title="var">bdestruct</span> (<span class="id" title="var">X</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#0f31f5c1c6b6a21a3a187247222bc9e<sub>4</sub>"><span class="id" title="notation">&lt;=?</span></a> <span class="id" title="var">Y</span>)<br/>
&nbsp;&nbsp;| &#x22A2; <span class="id" title="keyword">context</span> [ <span class="id" title="keyword">if</span> ?<span class="id" title="var">X</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> ?<span class="id" title="var">Y</span> <span class="id" title="keyword">then</span> <span class="id" title="var">_</span> <span class="id" title="keyword">else</span> <span class="id" title="var">_</span> ] ⇒ <span class="id" title="var">bdestruct</span> (<span class="id" title="var">X</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <span class="id" title="var">Y</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">bdall</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">simpl</span>; <span class="id" title="var">bdestruct_guard</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">omega</span>; <span class="id" title="tactic">auto</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <a name="lookup_insert_eq'"><span class="id" title="lemma">lookup_insert_eq'</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">d</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">v</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> (<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="var">bdall</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The tactic immediately pays off in proving the third
    equation. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <a name="lookup_insert_neq"><span class="id" title="lemma">lookup_insert_neq</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">d</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">k</span> <span class="id" title="var">k'</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">v</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">≠</span></a> <a class="idref" href="SearchTree.html#k'"><span class="id" title="variable">k'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k'"><span class="id" title="variable">k'</span></a> (<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k'"><span class="id" title="variable">k'</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="var">bdall</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Perhaps surprisingly, the proofs of these results do not
    depend on whether <span class="inlinecode"><span class="id" title="var">t</span></span> satisfies the BST invariant.  That's because
    <span class="inlinecode"><span class="id" title="var">lookup</span></span> and <span class="inlinecode"><span class="id" title="var">insert</span></span> follow the same path through the tree, so
    even if nodes are in the "wrong" place, they are consistently
    "wrong". 
<div class="paragraph"> </div>

<a name="lab103"></a><h4 class="section">Exercise: 3 stars, standard, optional (bound_correct)</h4>

<div class="paragraph"> </div>

 Specify and prove the correctness of <span class="inlinecode"><span class="id" title="var">bound</span></span>. State and prove
    three theorems, inspired by those we just proved for <span class="inlinecode"><span class="id" title="var">lookup</span></span>. If
    you have the right theorem statements, the proofs should all be
    quite easy -- thanks to <span class="inlinecode"><span class="id" title="var">bdall</span></span>. 
</div>
<div class="code">

<br/>
<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/><hr class='doublespaceincode'/>
<span class="comment">(*&nbsp;Do&nbsp;not&nbsp;modify&nbsp;the&nbsp;following&nbsp;line:&nbsp;*)</span><br/>
<span class="id" title="keyword">Definition</span> <a name="manual_grade_for_bound_correct"><span class="id" title="definition">manual_grade_for_bound_correct</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>) := <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab104"></a><h4 class="section">Exercise: 3 stars, standard, optional (bound_default)</h4>

<div class="paragraph"> </div>

 Prove that if <span class="inlinecode"><span class="id" title="var">bound</span></span> returns <span class="inlinecode"><span class="id" title="var">false</span></span>, then <span class="inlinecode"><span class="id" title="var">lookup</span></span> returns
    the default value. Proceed by induction on the tree. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <a name="bound_default"><span class="id" title="lemma">bound_default</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">d</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#bound"><span class="id" title="definition">bound</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a name="lab105"></a><h1 class="section">BSTs vs. Higher-order Functions (Optional)</h1>

<div class="paragraph"> </div>

 The three theorems we just proved for <span class="inlinecode"><span class="id" title="var">lookup</span></span> should seem
    familiar: we proved equivalent theorems in <a href="https://softwarefoundations.cis.upenn.edu/lf-current/Maps.html"><span class="inlineref">Maps</span></a> for maps
    defined as higher-order functions. 
<div class="paragraph"> </div>

<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="var">lookup_empty</span></span> and <span class="inlinecode"><span class="id" title="var">t_apply_empty</span></span> both state that the empty map
      binds all keys to the default value. 
</li>
</ul>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Check</span> <a class="idref" href="SearchTree.html#lookup_empty"><span class="id" title="lemma">lookup_empty</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">d</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#empty_tree"><span class="id" title="definition">empty_tree</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Check</span> <span class="id" title="axiom">t_apply_empty</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">d</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">t_empty</span> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a>.<br/>
</div>

<div class="doc">
<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="var">lookup_insert_eq</span></span> and <span class="inlinecode"><span class="id" title="var">t_update_eq</span></span> both state that updating a map
      then looking for the updated key produces the updated value. 
</li>
</ul>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Check</span> <a class="idref" href="SearchTree.html#lookup_insert_eq"><span class="id" title="lemma">lookup_insert_eq</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">d</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">v</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> (<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Check</span> <span class="id" title="axiom">t_update_eq</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">m</span> : <span class="id" title="definition">total_map</span> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">v</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="definition">t_update</span> <a class="idref" href="SearchTree.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a>) <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a>.<br/>
</div>

<div class="doc">
<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="var">lookup_insert_neq</span></span> and <span class="inlinecode"><span class="id" title="var">t_update_neq</span></span> both state that updating
      a map then looking for a different key produces the same value
      as the original map. 
</li>
</ul>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Check</span> <a class="idref" href="SearchTree.html#lookup_insert_neq"><span class="id" title="lemma">lookup_insert_neq</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">d</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">k</span> <span class="id" title="var">k'</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">v</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">≠</span></a> <a class="idref" href="SearchTree.html#k'"><span class="id" title="variable">k'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k'"><span class="id" title="variable">k'</span></a> (<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k'"><span class="id" title="variable">k'</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Check</span> <span class="id" title="axiom">t_update_neq</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">v</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">k</span> <span class="id" title="var">k'</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">m</span> : <span class="id" title="definition">total_map</span> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">≠</span></a> <a class="idref" href="SearchTree.html#k'"><span class="id" title="variable">k'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> (<span class="id" title="definition">t_update</span> <a class="idref" href="SearchTree.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a>) <a class="idref" href="SearchTree.html#k'"><span class="id" title="variable">k'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="SearchTree.html#k'"><span class="id" title="variable">k'</span></a>.<br/>
</div>

<div class="doc">
In <a href="https://softwarefoundations.cis.upenn.edu/lf-current/Maps.html"><span class="inlineref">Maps</span></a>, we also proved three other theorems about the
    behavior of functional maps on various combinations of updates and
    lookups: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Check</span> <span class="id" title="axiom">t_update_shadow</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">m</span> : <span class="id" title="definition">total_map</span> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">v<sub>1</sub></span> <span class="id" title="var">v<sub>2</sub></span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">t_update</span> (<span class="id" title="definition">t_update</span> <a class="idref" href="SearchTree.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v<sub>1</sub>"><span class="id" title="variable">v<sub>1</sub></span></a>) <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v<sub>2</sub>"><span class="id" title="variable">v<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">t_update</span> <a class="idref" href="SearchTree.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v<sub>2</sub>"><span class="id" title="variable">v<sub>2</sub></span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Check</span> <span class="id" title="axiom">t_update_same</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">m</span> : <span class="id" title="definition">total_map</span> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">t_update</span> <a class="idref" href="SearchTree.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> (<a class="idref" href="SearchTree.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#m"><span class="id" title="variable">m</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Check</span> <span class="id" title="axiom">t_update_permute</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">v<sub>1</sub></span> <span class="id" title="var">v<sub>2</sub></span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">k<sub>1</sub></span> <span class="id" title="var">k<sub>2</sub></span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">m</span> : <span class="id" title="definition">total_map</span> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#k<sub>2</sub>"><span class="id" title="variable">k<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">≠</span></a> <a class="idref" href="SearchTree.html#k<sub>1</sub>"><span class="id" title="variable">k<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">t_update</span> (<span class="id" title="definition">t_update</span> <a class="idref" href="SearchTree.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="SearchTree.html#k<sub>2</sub>"><span class="id" title="variable">k<sub>2</sub></span></a> <a class="idref" href="SearchTree.html#v<sub>2</sub>"><span class="id" title="variable">v<sub>2</sub></span></a>) <a class="idref" href="SearchTree.html#k<sub>1</sub>"><span class="id" title="variable">k<sub>1</sub></span></a> <a class="idref" href="SearchTree.html#v<sub>1</sub>"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">t_update</span> (<span class="id" title="definition">t_update</span> <a class="idref" href="SearchTree.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="SearchTree.html#k<sub>1</sub>"><span class="id" title="variable">k<sub>1</sub></span></a> <a class="idref" href="SearchTree.html#v<sub>1</sub>"><span class="id" title="variable">v<sub>1</sub></span></a>) <a class="idref" href="SearchTree.html#k<sub>2</sub>"><span class="id" title="variable">k<sub>2</sub></span></a> <a class="idref" href="SearchTree.html#v<sub>2</sub>"><span class="id" title="variable">v<sub>2</sub></span></a>.<br/>
</div>

<div class="doc">
Let's prove analogues to these three theorems for search trees.

<div class="paragraph"> </div>

    Hint: you do not need to unfold the definitions of <span class="inlinecode"><span class="id" title="var">empty_tree</span></span>,
    <span class="inlinecode"><span class="id" title="var">insert</span></span>, or <span class="inlinecode"><span class="id" title="var">lookup</span></span>.  Instead, use <span class="inlinecode"><span class="id" title="var">lookup_insert_eq</span></span> and
    <span class="inlinecode"><span class="id" title="var">lookup_insert_neq</span></span>. 
<div class="paragraph"> </div>

<a name="lab106"></a><h4 class="section">Exercise: 2 stars, standard, optional (lookup_insert_shadow)</h4>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="lookup_insert_shadow"><span class="id" title="lemma">lookup_insert_shadow</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">v</span> <span class="id" title="var">v'</span> <span class="id" title="var">d</span>: <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">k</span> <span class="id" title="var">k'</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k'"><span class="id" title="variable">k'</span></a> (<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> (<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v'"><span class="id" title="variable">v'</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>)) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k'"><span class="id" title="variable">k'</span></a> (<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">bdestruct</span> (<span class="id" title="var">k</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#ad2ec4e405f68c46c0a176e3e94ae2e<sub>3</sub>"><span class="id" title="notation">=?</span></a> <span class="id" title="var">k'</span>).<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab107"></a><h4 class="section">Exercise: 2 stars, standard, optional (lookup_insert_same)</h4>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="lookup_insert_same"><span class="id" title="lemma">lookup_insert_same</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">k</span> <span class="id" title="var">k'</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">d</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k'"><span class="id" title="variable">k'</span></a> (<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> (<a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>) <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k'"><span class="id" title="variable">k'</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab108"></a><h4 class="section">Exercise: 2 stars, standard, optional (lookup_insert_permute)</h4>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="lookup_insert_permute"><span class="id" title="lemma">lookup_insert_permute</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">v<sub>1</sub></span> <span class="id" title="var">v<sub>2</sub></span> <span class="id" title="var">d</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">k<sub>1</sub></span> <span class="id" title="var">k<sub>2</sub></span> <span class="id" title="var">k'</span>: <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#k<sub>1</sub>"><span class="id" title="variable">k<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">≠</span></a> <a class="idref" href="SearchTree.html#k<sub>2</sub>"><span class="id" title="variable">k<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k'"><span class="id" title="variable">k'</span></a> (<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#k<sub>1</sub>"><span class="id" title="variable">k<sub>1</sub></span></a> <a class="idref" href="SearchTree.html#v<sub>1</sub>"><span class="id" title="variable">v<sub>1</sub></span></a> (<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#k<sub>2</sub>"><span class="id" title="variable">k<sub>2</sub></span></a> <a class="idref" href="SearchTree.html#v<sub>2</sub>"><span class="id" title="variable">v<sub>2</sub></span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k'"><span class="id" title="variable">k'</span></a> (<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#k<sub>2</sub>"><span class="id" title="variable">k<sub>2</sub></span></a> <a class="idref" href="SearchTree.html#v<sub>2</sub>"><span class="id" title="variable">v<sub>2</sub></span></a> (<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#k<sub>1</sub>"><span class="id" title="variable">k<sub>1</sub></span></a> <a class="idref" href="SearchTree.html#v<sub>1</sub>"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>)).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 Our ability to prove these lemmas without reference to the
    underlying tree implementation demonstrates they hold for any map
    implementation that satisfies the three basic equations. 
<div class="paragraph"> </div>

 Each of these lemmas just proved was phrased as an equality
    between the results of looking up an arbitrary key <span class="inlinecode"><span class="id" title="var">k'</span></span> in two
    maps.  But the lemmas for the function-based maps were phrased as
    direct equalities between the maps themselves.

<div class="paragraph"> </div>

    Could we state the tree lemmas with direct equalities?  For
    <span class="inlinecode"><span class="id" title="var">insert_shadow</span></span>, the answer is yes: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="insert_shadow_equality"><span class="id" title="lemma">insert_shadow_equality</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">v</span> <span class="id" title="var">v'</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> (<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v'"><span class="id" title="variable">v'</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="var">bdall</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHt1</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHt2</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
But the other two direct equalities on BSTs do not necessarily
    hold. 
<div class="paragraph"> </div>

<a name="lab109"></a><h4 class="section">Exercise: 3 stars, standard, optional (direct_equalities_break)</h4>

<div class="paragraph"> </div>

 Prove that the other equalities do not hold.  Hint: find a counterexample
    first on paper, then use the <span class="inlinecode"><span class="id" title="tactic">∃</span></span> tactic to instantiate the theorem
    on your counterexample.  The simpler your counterexample, the simpler
    the rest of the proof will be. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="insert_same_equality_breaks"><span class="id" title="lemma">insert_same_equality_breaks</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">∃</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">(</span></a><span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">d</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">),</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> (<a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>) <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">≠</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a name="insert_permute_equality_breaks"><span class="id" title="lemma">insert_permute_equality_breaks</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">∃</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">(</span></a><span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">v<sub>1</sub></span> <span class="id" title="var">v<sub>2</sub></span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">k<sub>1</sub></span> <span class="id" title="var">k<sub>2</sub></span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">),</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#k<sub>1</sub>"><span class="id" title="variable">k<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">≠</span></a> <a class="idref" href="SearchTree.html#k<sub>2</sub>"><span class="id" title="variable">k<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#k<sub>1</sub>"><span class="id" title="variable">k<sub>1</sub></span></a> <a class="idref" href="SearchTree.html#v<sub>1</sub>"><span class="id" title="variable">v<sub>1</sub></span></a> (<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#k<sub>2</sub>"><span class="id" title="variable">k<sub>2</sub></span></a> <a class="idref" href="SearchTree.html#v<sub>2</sub>"><span class="id" title="variable">v<sub>2</sub></span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">≠</span></a> <a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#k<sub>2</sub>"><span class="id" title="variable">k<sub>2</sub></span></a> <a class="idref" href="SearchTree.html#v<sub>2</sub>"><span class="id" title="variable">v<sub>2</sub></span></a> (<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#k<sub>1</sub>"><span class="id" title="variable">k<sub>1</sub></span></a> <a class="idref" href="SearchTree.html#v<sub>1</sub>"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a name="lab110"></a><h1 class="section">Converting a BST to a List</h1>

<div class="paragraph"> </div>

 Let's add a new operation to our BST: converting it to an
    <i>association list</i> that contains the key--value bindings from the
    tree stored as pairs.  If that list is sorted by the keys, then
    any two trees that represent the same map would be converted to
    the same list. Here's a function that does so with an in-order
    traversal of the tree: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <a name="elements"><span class="id" title="definition">elements</span></a> {<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="SearchTree.html#E"><span class="id" title="constructor">E</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="SearchTree.html#T"><span class="id" title="constructor">T</span></a> <span class="id" title="var">l</span> <span class="id" title="var">k</span> <span class="id" title="var">v</span> <span class="id" title="var">r</span> ⇒ <a class="idref" href="SearchTree.html#elements"><span class="id" title="definition">elements</span></a> <span class="id" title="var">l</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c<sub>6</sub>"><span class="id" title="notation">++</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">v</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c<sub>6</sub>"><span class="id" title="notation">++</span></a> <a class="idref" href="SearchTree.html#elements"><span class="id" title="definition">elements</span></a> <span class="id" title="var">r</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <a name="elements_ex"><span class="id" title="definition">elements_ex</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#elements"><span class="id" title="definition">elements</span></a> <a class="idref" href="SearchTree.html#ex_tree"><span class="id" title="definition">ex_tree</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">[</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a>2<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> "two"<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a>4<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> "four"<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a>5<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> "five"<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">]</span></a>%<span class="id" title="var">string</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Here are three desirable properties for <span class="inlinecode"><span class="id" title="var">elements</span></span>:

<div class="paragraph"> </div>

    1. The list has the same bindings as the tree.

<div class="paragraph"> </div>

    2. The list is sorted by keys.

<div class="paragraph"> </div>

    3. The list contains no duplicates.

<div class="paragraph"> </div>

    Let's formally specify and verify them. 
<div class="paragraph"> </div>

<a name="lab111"></a><h2 class="section">Part 1: Same Bindings</h2>

<div class="paragraph"> </div>

 We want to show that a binding is in <span class="inlinecode"><span class="id" title="var">elements</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> iff it's in
    <span class="inlinecode"><span class="id" title="var">t</span></span>. We'll prove the two directions of that bi-implication
    separately:

<div class="paragraph"> </div>

<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="var">elements</span></span> is <i>complete</i>: if a binding is in <span class="inlinecode"><span class="id" title="var">t</span></span> then it's in
      <span class="inlinecode"><span class="id" title="var">elements</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>.

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode"><span class="id" title="var">elements</span></span> is <i>correct</i>: if a binding is in <span class="inlinecode"><span class="id" title="var">elements</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> then
      it's in <span class="inlinecode"><span class="id" title="var">t</span></span>.  
</li>
</ul>

<div class="paragraph"> </div>

 Getting the specification of completeness right is a little
    tricky.  It's tempting to start off with something too simple like
    this: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a name="elements_complete_broken_spec"><span class="id" title="definition">elements_complete_broken_spec</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">v</span> <span class="id" title="var">d</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#BST"><span class="id" title="inductive">BST</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> (<a class="idref" href="SearchTree.html#elements"><span class="id" title="definition">elements</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>).<br/>
</div>

<div class="doc">
The problem with that specification is how it handles the default
    element <span class="inlinecode"><span class="id" title="var">d</span></span>: the specification would incorrectly require <span class="inlinecode"><span class="id" title="var">elements</span></span>
    <span class="inlinecode"><span class="id" title="var">t</span></span> to contain a binding <span class="inlinecode">(<span class="id" title="var">k</span>,</span> <span class="inlinecode"><span class="id" title="var">d</span>)</span> for all keys <span class="inlinecode"><span class="id" title="var">k</span></span> unbound in
    <span class="inlinecode"><span class="id" title="var">t</span></span>. That would force <span class="inlinecode"><span class="id" title="var">elements</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> to be infinitely long, since
    it would have to contain a binding for every natural number. We can
    observe this problem right away if we begin the proof: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <a name="elements_complete_broken"><span class="id" title="lemma">elements_complete_broken</span></a> : <a class="idref" href="SearchTree.html#elements_complete_broken_spec"><span class="id" title="definition">elements_complete_broken_spec</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="SearchTree.html#elements_complete_broken_spec"><span class="id" title="definition">elements_complete_broken_spec</span></a>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;t&nbsp;=&nbsp;E&nbsp;*)</span> <span class="id" title="tactic">simpl</span>.<br/>
</div>

<div class="doc">
We have nothing to work with, since <span class="inlinecode"><span class="id" title="var">elements</span></span> <span class="inlinecode"><span class="id" title="var">E</span></span> is <span class="inlinecode">[]</span>. 
</div>
<div class="code">
<span class="id" title="keyword">Abort</span>.<br/>
</div>

<div class="doc">
The solution is to check first to see whether <span class="inlinecode"><span class="id" title="var">k</span></span> is bound in <span class="inlinecode"><span class="id" title="var">t</span></span>.
    Only bound keys need be in the list of elements: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a name="elements_complete_spec"><span class="id" title="definition">elements_complete_spec</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">v</span> <span class="id" title="var">d</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#BST"><span class="id" title="inductive">BST</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#bound"><span class="id" title="definition">bound</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> (<a class="idref" href="SearchTree.html#elements"><span class="id" title="definition">elements</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>).<br/>
</div>

<div class="doc">
<a name="lab112"></a><h4 class="section">Exercise: 3 stars, standard (elements_complete)</h4>

<div class="paragraph"> </div>

 Prove that <span class="inlinecode"><span class="id" title="var">elements</span></span> is complete. Proceed by induction on <span class="inlinecode"><span class="id" title="var">t</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <a name="elements_complete"><span class="id" title="lemma">elements_complete</span></a> : <a class="idref" href="SearchTree.html#elements_complete_spec"><span class="id" title="definition">elements_complete_spec</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 The specification for correctness likewise mentions that the
    key must be bound: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a name="elements_correct_spec"><span class="id" title="definition">elements_correct_spec</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">v</span> <span class="id" title="var">d</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#BST"><span class="id" title="inductive">BST</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> (<a class="idref" href="SearchTree.html#elements"><span class="id" title="definition">elements</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#bound"><span class="id" title="definition">bound</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a>.<br/>
</div>

<div class="doc">
Proving correctness requires more work than completeness.

<div class="paragraph"> </div>

    <span class="inlinecode"><span class="id" title="var">BST</span></span> uses <span class="inlinecode"><span class="id" title="var">ForallT</span></span> to say that all nodes in the left/right
    subtree have smaller/greater keys than the root.  We need to
    relate <span class="inlinecode"><span class="id" title="var">ForallT</span></span>, which expresses that all nodes satisfy a
    property, to <span class="inlinecode"><span class="id" title="var">Forall</span></span>, which expresses that all list elements
    satisfy a property.

<div class="paragraph"> </div>

    We begin with this lemma about <span class="inlinecode"><span class="id" title="var">Forall</span></span>, which is missing from the
    standard library. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="Forall_app"><span class="id" title="lemma">Forall_app</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">A</span>: <span class="id" title="keyword">Type</span>) (<span class="id" title="var">P</span> : <a class="idref" href="SearchTree.html#A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>) (<span class="id" title="var">l<sub>1</sub></span> <span class="id" title="var">l<sub>2</sub></span> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="SearchTree.html#A"><span class="id" title="variable">A</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#Forall"><span class="id" title="inductive">Forall</span></a> <a class="idref" href="SearchTree.html#P"><span class="id" title="variable">P</span></a> <a class="idref" href="SearchTree.html#l<sub>1</sub>"><span class="id" title="variable">l<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#Forall"><span class="id" title="inductive">Forall</span></a> <a class="idref" href="SearchTree.html#P"><span class="id" title="variable">P</span></a> <a class="idref" href="SearchTree.html#l<sub>2</sub>"><span class="id" title="variable">l<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#Forall"><span class="id" title="inductive">Forall</span></a> <a class="idref" href="SearchTree.html#P"><span class="id" title="variable">P</span></a> (<a class="idref" href="SearchTree.html#l<sub>1</sub>"><span class="id" title="variable">l<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c<sub>6</sub>"><span class="id" title="notation">++</span></a> <a class="idref" href="SearchTree.html#l<sub>2</sub>"><span class="id" title="variable">l<sub>2</sub></span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l<sub>1</sub></span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">auto</span>; <span class="id" title="var">inv</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab113"></a><h4 class="section">Exercise: 2 stars, standard (elements_preserves_forall)</h4>

<div class="paragraph"> </div>

 Prove that if a property <span class="inlinecode"><span class="id" title="var">P</span></span> holds of every node in a tree <span class="inlinecode"><span class="id" title="var">t</span></span>,
    then that property holds of every pair in <span class="inlinecode"><span class="id" title="var">elements</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>. Proceed
    by induction on <span class="inlinecode"><span class="id" title="var">t</span></span>.

<div class="paragraph"> </div>

    There is a little mismatch between the type of <span class="inlinecode"><span class="id" title="var">P</span></span> in <span class="inlinecode"><span class="id" title="var">ForallT</span></span>
    and the type of the property accepted by <span class="inlinecode"><span class="id" title="var">Forall</span></span>, so we have to
    <i>uncurry</i> <span class="inlinecode"><span class="id" title="var">P</span></span> when we pass it to <span class="inlinecode"><span class="id" title="var">Forall</span></span>. (See <a href="https://softwarefoundations.cis.upenn.edu/lf-current/Poly.html"><span class="inlineref">Poly</span></a> for
    more about uncurrying.) The single quote used below is the Coq
    syntax for doing a pattern match in the function arguments. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a name="uncurry"><span class="id" title="definition">uncurry</span></a> {<span class="id" title="var">X</span> <span class="id" title="var">Y</span> <span class="id" title="var">Z</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <a class="idref" href="SearchTree.html#X"><span class="id" title="variable">X</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="SearchTree.html#Y"><span class="id" title="variable">Y</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="SearchTree.html#Z"><span class="id" title="variable">Z</span></a>) '<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">a</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">b</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="SearchTree.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="SearchTree.html#a"><span class="id" title="variable">a</span></a> <a class="idref" href="SearchTree.html#b"><span class="id" title="variable">b</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Hint Transparent</span> <a class="idref" href="SearchTree.html#uncurry"><span class="id" title="definition">uncurry</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a name="elements_preserves_forall"><span class="id" title="lemma">elements_preserves_forall</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">P</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#ForallT"><span class="id" title="definition">ForallT</span></a> <a class="idref" href="SearchTree.html#P"><span class="id" title="variable">P</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#Forall"><span class="id" title="inductive">Forall</span></a> (<a class="idref" href="SearchTree.html#uncurry"><span class="id" title="definition">uncurry</span></a> <a class="idref" href="SearchTree.html#P"><span class="id" title="variable">P</span></a>) (<a class="idref" href="SearchTree.html#elements"><span class="id" title="definition">elements</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab114"></a><h4 class="section">Exercise: 2 stars, standard (elements_preserves_relation)</h4>

<div class="paragraph"> </div>

 Prove that if all the keys in <span class="inlinecode"><span class="id" title="var">t</span></span> are in a relation <span class="inlinecode"><span class="id" title="var">R</span></span> with a
    distinguished key <span class="inlinecode"><span class="id" title="var">k'</span></span>, then any key <span class="inlinecode"><span class="id" title="var">k</span></span> in <span class="inlinecode"><span class="id" title="var">elements</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> is also
    related by <span class="inlinecode"><span class="id" title="var">R</span></span> to <span class="inlinecode"><span class="id" title="var">k'</span></span>. For example, <span class="inlinecode"><span class="id" title="var">R</span></span> could be <span class="inlinecode">&lt;</span>, in which
    case the lemma says that if all the keys in <span class="inlinecode"><span class="id" title="var">t</span></span> are less than
    <span class="inlinecode"><span class="id" title="var">k'</span></span>, then all the keys in <span class="inlinecode"><span class="id" title="var">elements</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> are also less than
    <span class="inlinecode"><span class="id" title="var">k'</span></span>.

<div class="paragraph"> </div>

    Hint: you don't need induction.  Immediately look for a way
    to use <span class="inlinecode"><span class="id" title="var">elements_preserves_forall</span></span> and library theorem
    <span class="inlinecode"><span class="id" title="var">Forall_forall</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="elements_preserves_relation"><span class="id" title="lemma">elements_preserves_relation</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">k</span> <span class="id" title="var">k'</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">v</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">R</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#ForallT"><span class="id" title="definition">ForallT</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="SearchTree.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="SearchTree.html#y"><span class="id" title="variable">y</span></a> <a class="idref" href="SearchTree.html#k'"><span class="id" title="variable">k'</span></a>) <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> (<a class="idref" href="SearchTree.html#elements"><span class="id" title="definition">elements</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="SearchTree.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#k'"><span class="id" title="variable">k'</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab115"></a><h4 class="section">Exercise: 4 stars, standard (elements_correct)</h4>

<div class="paragraph"> </div>

 Prove that <span class="inlinecode"><span class="id" title="var">elements</span></span> is correct. Proceed by induction on the
    evidence that <span class="inlinecode"><span class="id" title="var">t</span></span> is a BST. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <a name="elements_correct"><span class="id" title="lemma">elements_correct</span></a> : <a class="idref" href="SearchTree.html#elements_correct_spec"><span class="id" title="definition">elements_correct_spec</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 The inverses of completeness and correctness also should hold:

<div class="paragraph"> </div>

<ul class="doclist">
<li> inverse completeness: if a binding is not in <span class="inlinecode"><span class="id" title="var">t</span></span> then it's not
      in <span class="inlinecode"><span class="id" title="var">elements</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>.

<div class="paragraph"> </div>


</li>
<li> inverse correctness: if a binding is not in <span class="inlinecode"><span class="id" title="var">elements</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> then
      it's not in <span class="inlinecode"><span class="id" title="var">t</span></span>.

</li>
</ul>

<div class="paragraph"> </div>

    Let's prove that they do. 
<div class="paragraph"> </div>

<a name="lab116"></a><h4 class="section">Exercise: 2 stars, advanced (elements_complete_inverse)</h4>

<div class="paragraph"> </div>

 This inverse doesn't require induction.  Look for a way to use
    <span class="inlinecode"><span class="id" title="var">elements_correct</span></span> to quickly prove the result. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <a name="elements_complete_inverse"><span class="id" title="lemma">elements_complete_inverse</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">v</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#BST"><span class="id" title="inductive">BST</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#bound"><span class="id" title="definition">bound</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">¬</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> (<a class="idref" href="SearchTree.html#elements"><span class="id" title="definition">elements</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab117"></a><h4 class="section">Exercise: 4 stars, advanced (elements_correct_inverse)</h4>

<div class="paragraph"> </div>

 Prove the inverse.  First, prove this helper lemma by induction on
    <span class="inlinecode"><span class="id" title="var">t</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="bound_value"><span class="id" title="lemma">bound_value</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#bound"><span class="id" title="definition">bound</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">∃</span></a> <span class="id" title="var">v</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <span class="id" title="keyword">∀</span> <span class="id" title="var">d</span>, <a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
</div>

<div class="doc">
Prove the main result.  You don't need induction. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <a name="elements_correct_inverse"><span class="id" title="lemma">elements_correct_inverse</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#BST"><span class="id" title="inductive">BST</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <span class="id" title="var">v</span>, <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">¬</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> (<a class="idref" href="SearchTree.html#elements"><span class="id" title="definition">elements</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>)<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#bound"><span class="id" title="definition">bound</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab118"></a><h2 class="section">Part 2: Sorted (Advanced)</h2>

<div class="paragraph"> </div>

 We want to show that <span class="inlinecode"><span class="id" title="var">elements</span></span> is sorted by keys.  We follow a
    proof technique contributed by Lydia Symmons et al.
<div class="paragraph"> </div>

<a name="lab119"></a><h4 class="section">Exercise: 3 stars, advanced (sorted_app)</h4>

<div class="paragraph"> </div>

 Prove that inserting an intermediate value between two lists
    maintains sortedness. Proceed by induction on the evidence
    that <span class="inlinecode"><span class="id" title="var">l<sub>1</sub></span></span> is sorted. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="sorted_app"><span class="id" title="lemma">sorted_app</span></a>: <span class="id" title="keyword">∀</span> <span class="id" title="var">l<sub>1</sub></span> <span class="id" title="var">l<sub>2</sub></span> <span class="id" title="var">x</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="Sort.html#sorted"><span class="id" title="inductive">Sort.sorted</span></a> <a class="idref" href="SearchTree.html#l<sub>1</sub>"><span class="id" title="variable">l<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="Sort.html#sorted"><span class="id" title="inductive">Sort.sorted</span></a> <a class="idref" href="SearchTree.html#l<sub>2</sub>"><span class="id" title="variable">l<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#Forall"><span class="id" title="inductive">Forall</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">n</span> ⇒ <a class="idref" href="SearchTree.html#n"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="SearchTree.html#x"><span class="id" title="variable">x</span></a>) <a class="idref" href="SearchTree.html#l<sub>1</sub>"><span class="id" title="variable">l<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#Forall"><span class="id" title="inductive">Forall</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">n</span> ⇒ <a class="idref" href="SearchTree.html#n"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#7f2a7ef2c63af7359b22787a9daf336e"><span class="id" title="notation">&gt;</span></a> <a class="idref" href="SearchTree.html#x"><span class="id" title="variable">x</span></a>) <a class="idref" href="SearchTree.html#l<sub>2</sub>"><span class="id" title="variable">l<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Sort.html#sorted"><span class="id" title="inductive">Sort.sorted</span></a> (<a class="idref" href="SearchTree.html#l<sub>1</sub>"><span class="id" title="variable">l<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c<sub>6</sub>"><span class="id" title="notation">++</span></a> <a class="idref" href="SearchTree.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="SearchTree.html#l<sub>2</sub>"><span class="id" title="variable">l<sub>2</sub></span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab120"></a><h4 class="section">Exercise: 4 stars, advanced (sorted_elements)</h4>

<div class="paragraph"> </div>

 The keys in an association list are the first elements of every
    pair: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a name="list_keys"><span class="id" title="definition">list_keys</span></a> {<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">lst</span> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>)) :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <a class="idref" href="SearchTree.html#lst"><span class="id" title="variable">lst</span></a>.<br/>
</div>

<div class="doc">
Prove that <span class="inlinecode"><span class="id" title="var">elements</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> is sorted by keys. Proceed by induction
    on the evidence that <span class="inlinecode"><span class="id" title="var">t</span></span> is a BST. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <a name="sorted_elements"><span class="id" title="lemma">sorted_elements</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#BST"><span class="id" title="inductive">BST</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="Sort.html#sorted"><span class="id" title="inductive">Sort.sorted</span></a> (<a class="idref" href="SearchTree.html#list_keys"><span class="id" title="definition">list_keys</span></a> (<a class="idref" href="SearchTree.html#elements"><span class="id" title="definition">elements</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>)).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab121"></a><h2 class="section">Part 3: No Duplicates (Advanced and Optional)</h2>

<div class="paragraph"> </div>

 We want to show that <span class="inlinecode"><span class="id" title="var">elements</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> contains no duplicate
    bindings. Tree <span class="inlinecode"><span class="id" title="var">t</span></span> itself cannot contain any duplicates, so the
    list that <span class="inlinecode"><span class="id" title="var">elements</span></span> produces shouldn't either. The standard
    library already contains a helpful inductive proposition,
    <span class="inlinecode"><span class="id" title="var">NoDup</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Print</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#NoDup"><span class="id" title="inductive">NoDup</span></a>.<br/>
</div>

<div class="doc">
The library is missing a theorem, though, about <span class="inlinecode"><span class="id" title="var">NoDup</span></span> and <span class="inlinecode">++</span>.
    To state that theorem, we first need to formalize what it means
    for two lists to be disjoint: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a name="disjoint"><span class="id" title="definition">disjoint</span></a> {<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>} (<span class="id" title="var">l<sub>1</sub></span> <span class="id" title="var">l<sub>2</sub></span>: <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="SearchTree.html#X"><span class="id" title="variable">X</span></a>) := <span class="id" title="keyword">∀</span> (<span class="id" title="var">x</span> : <a class="idref" href="SearchTree.html#X"><span class="id" title="variable">X</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="SearchTree.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="SearchTree.html#l<sub>1</sub>"><span class="id" title="variable">l<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">¬</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="SearchTree.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="SearchTree.html#l<sub>2</sub>"><span class="id" title="variable">l<sub>2</sub></span></a>.<br/>
</div>

<div class="doc">
<a name="lab122"></a><h4 class="section">Exercise: 3 stars, advanced, optional (NoDup_append)</h4>

<div class="paragraph"> </div>

 Prove that if two lists are disjoint, appending them preserves
    <span class="inlinecode"><span class="id" title="var">NoDup</span></span>.  Hint: You might already have proved this theorem in an
    advanced exercise in <a href="https://softwarefoundations.cis.upenn.edu/lf-current/IndProp.html"><span class="inlineref">IndProp</span></a>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="NoDup_append"><span class="id" title="lemma">NoDup_append</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>) (<span class="id" title="var">l<sub>1</sub></span> <span class="id" title="var">l<sub>2</sub></span>: <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="SearchTree.html#X"><span class="id" title="variable">X</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#NoDup"><span class="id" title="inductive">NoDup</span></a> <a class="idref" href="SearchTree.html#l<sub>1</sub>"><span class="id" title="variable">l<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#NoDup"><span class="id" title="inductive">NoDup</span></a> <a class="idref" href="SearchTree.html#l<sub>2</sub>"><span class="id" title="variable">l<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="SearchTree.html#disjoint"><span class="id" title="definition">disjoint</span></a> <a class="idref" href="SearchTree.html#l<sub>1</sub>"><span class="id" title="variable">l<sub>1</sub></span></a> <a class="idref" href="SearchTree.html#l<sub>2</sub>"><span class="id" title="variable">l<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#NoDup"><span class="id" title="inductive">NoDup</span></a> (<a class="idref" href="SearchTree.html#l<sub>1</sub>"><span class="id" title="variable">l<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c<sub>6</sub>"><span class="id" title="notation">++</span></a> <a class="idref" href="SearchTree.html#l<sub>2</sub>"><span class="id" title="variable">l<sub>2</sub></span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab123"></a><h4 class="section">Exercise: 4 stars, advanced, optional (elements_nodup_keys)</h4>

<div class="paragraph"> </div>

 Prove that there are no duplicate keys in the list returned
    by <span class="inlinecode"><span class="id" title="var">elements</span></span>. Proceed by induction on the evidence that <span class="inlinecode"><span class="id" title="var">t</span></span> is a
    BST. Make use of library theorems about <span class="inlinecode"><span class="id" title="var">map</span></span> as needed. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <a name="elements_nodup_keys"><span class="id" title="lemma">elements_nodup_keys</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#BST"><span class="id" title="inductive">BST</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#NoDup"><span class="id" title="inductive">NoDup</span></a> (<a class="idref" href="SearchTree.html#list_keys"><span class="id" title="definition">list_keys</span></a> (<a class="idref" href="SearchTree.html#elements"><span class="id" title="definition">elements</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>)).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 That concludes the proof of correctness of <span class="inlinecode"><span class="id" title="var">elements</span></span>. 
</div>

<div class="doc">
<a name="lab124"></a><h1 class="section">A Faster <span class="inlinecode"><span class="id" title="var">elements</span></span> Implementation</h1>

<div class="paragraph"> </div>

 The implemention of <span class="inlinecode"><span class="id" title="var">elements</span></span> is inefficient because of how
    it uses the <span class="inlinecode">++</span> operator.  On a balanced tree its running time is
    linearithmic, because it does a linear number of concatentations
    at each level of the tree. On an unbalanced tree it's quadratic
    time.  Here's a tail-recursive implementation than runs in linear
    time, regardless of whether the tree is balanced: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <a name="fast_elements_tr"><span class="id" title="definition">fast_elements_tr</span></a> {<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">acc</span> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>)) : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="SearchTree.html#E"><span class="id" title="constructor">E</span></a> ⇒ <a class="idref" href="SearchTree.html#acc"><span class="id" title="variable">acc</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="SearchTree.html#T"><span class="id" title="constructor">T</span></a> <span class="id" title="var">l</span> <span class="id" title="var">k</span> <span class="id" title="var">v</span> <span class="id" title="var">r</span> ⇒ <a class="idref" href="SearchTree.html#fast_elements_tr"><span class="id" title="definition">fast_elements_tr</span></a> <span class="id" title="var">l</span> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">v</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="SearchTree.html#fast_elements_tr"><span class="id" title="definition">fast_elements_tr</span></a> <span class="id" title="var">r</span> <a class="idref" href="SearchTree.html#acc"><span class="id" title="variable">acc</span></a>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a name="fast_elements"><span class="id" title="definition">fast_elements</span></a> {<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) :=<br/>
&nbsp;&nbsp;<a class="idref" href="SearchTree.html#fast_elements_tr"><span class="id" title="definition">fast_elements_tr</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>.<br/>
</div>

<div class="doc">
<a name="lab125"></a><h4 class="section">Exercise: 3 stars, standard (fast_elements_eq_elements)</h4>

<div class="paragraph"> </div>

 Prove that <span class="inlinecode"><span class="id" title="var">fast_elements</span></span> and <span class="inlinecode"><span class="id" title="var">elements</span></span> compute the same
    function. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="fast_elements_tr_helper"><span class="id" title="lemma">fast_elements_tr_helper</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">lst</span> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#fast_elements_tr"><span class="id" title="definition">fast_elements_tr</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="SearchTree.html#lst"><span class="id" title="variable">lst</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#elements"><span class="id" title="definition">elements</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c<sub>6</sub>"><span class="id" title="notation">++</span></a> <a class="idref" href="SearchTree.html#lst"><span class="id" title="variable">lst</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a name="fast_elements_eq_elements"><span class="id" title="lemma">fast_elements_eq_elements</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#fast_elements"><span class="id" title="definition">fast_elements</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#elements"><span class="id" title="definition">elements</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 Since the two implementations compute the same function, all
    the results we proved about the correctness of <span class="inlinecode"><span class="id" title="var">elements</span></span>
    also hold for <span class="inlinecode"><span class="id" title="var">fast_elements</span></span>.  For example: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Corollary</span> <a name="fast_elements_correct"><span class="id" title="lemma">fast_elements_correct</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">v</span> <span class="id" title="var">d</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#BST"><span class="id" title="inductive">BST</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> (<a class="idref" href="SearchTree.html#fast_elements"><span class="id" title="definition">fast_elements</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#bound"><span class="id" title="definition">bound</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="SearchTree.html#fast_elements_eq_elements"><span class="id" title="axiom">fast_elements_eq_elements</span></a> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="SearchTree.html#elements_correct"><span class="id" title="axiom">elements_correct</span></a>; <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
This corollary illustrates a general technique:  prove the correctness
    of a simple, slow implementation; then prove that the slow version
    is functionally equivalent to a fast implementation.  The proof of
    correctness for the fast implementation then comes "for free". 
</div>

<div class="doc">
<a name="lab126"></a><h1 class="section">An Algebraic Specification of <span class="inlinecode"><span class="id" title="var">elements</span></span></h1>

<div class="paragraph"> </div>

 The verification of <span class="inlinecode"><span class="id" title="var">elements</span></span> we did above did not adhere to the
    algebraic specification approach, which would suggest that we look
    for equations of the form
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">elements</span> <span class="id" title="var">empty_tree</span> = ...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">elements</span> (<span class="id" title="var">insert</span> <span class="id" title="var">k</span> <span class="id" title="var">v</span> <span class="id" title="var">t</span>) = ... (<span class="id" title="var">elements</span> <span class="id" title="var">t</span>) ...
<div class="paragraph"> </div>

</span>
<div class="paragraph"> </div>

    The first of these is easy; we can trivially prove the following:
    
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="elements_empty"><span class="id" title="lemma">elements_empty</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="SearchTree.html#elements"><span class="id" title="definition">elements</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a> <a class="idref" href="SearchTree.html#empty_tree"><span class="id" title="definition">empty_tree</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
But for the second equation, we have to express the result of
    inserting <span class="inlinecode">(<span class="id" title="var">k</span>,</span> <span class="inlinecode"><span class="id" title="var">v</span>)</span> into the elements list for <span class="inlinecode"><span class="id" title="var">t</span></span>, accounting for
    ordering and the possibility that <span class="inlinecode"><span class="id" title="var">t</span></span> may already contain a pair
    <span class="inlinecode">(<span class="id" title="var">k</span>,</span> <span class="inlinecode"><span class="id" title="var">v'</span>)</span> which must be replaced.  The following rather ugly
    function will do the trick: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <a name="kvs_insert"><span class="id" title="definition">kvs_insert</span></a> {<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">v</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">kvs</span> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>)) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="SearchTree.html#kvs"><span class="id" title="variable">kvs</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k'</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">v'</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <span class="id" title="var">kvs'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <span class="id" title="var">k'</span> <span class="id" title="keyword">then</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="SearchTree.html#kvs"><span class="id" title="variable">kvs</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="keyword">if</span> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="Perm.html#5ea9023a94e85f78711b2bf8cc72c8f<sub>4</sub>"><span class="id" title="notation">&gt;?</span></a> <span class="id" title="var">k'</span> <span class="id" title="keyword">then</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k'</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">v'</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="SearchTree.html#kvs_insert"><span class="id" title="definition">kvs_insert</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> <span class="id" title="var">kvs'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <span class="id" title="var">kvs'</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
That's not satisfactory, because the definition of
    <span class="inlinecode"><span class="id" title="var">kvs_insert</span></span> is so complex. Moreover, this equation doesn't tell
    us anything directly about the overall properties of <span class="inlinecode"><span class="id" title="var">elements</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>
    for a given tree <span class="inlinecode"><span class="id" title="var">t</span></span>.  Nonetheless, we can proceed with a rather
    ugly verification. 
<div class="paragraph"> </div>

<a name="lab127"></a><h4 class="section">Exercise: 3 stars, standard, optional (kvs_insert_split)</h4>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="kvs_insert_split"><span class="id" title="lemma">kvs_insert_split</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">v</span> <span class="id" title="var">v<sub>0</sub></span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">e<sub>1</sub></span> <span class="id" title="var">e<sub>2</sub></span> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>)) (<span class="id" title="var">k</span> <span class="id" title="var">k<sub>0</sub></span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#Forall"><span class="id" title="inductive">Forall</span></a> (<span class="id" title="keyword">fun</span> '<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k'</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> ⇒ <a class="idref" href="SearchTree.html#k'"><span class="id" title="variable">k'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="SearchTree.html#k<sub>0</sub>"><span class="id" title="variable">k<sub>0</sub></span></a>) <a class="idref" href="SearchTree.html#e<sub>1</sub>"><span class="id" title="variable">e<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#Forall"><span class="id" title="inductive">Forall</span></a> (<span class="id" title="keyword">fun</span> '<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k'</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> ⇒ <a class="idref" href="SearchTree.html#k'"><span class="id" title="variable">k'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#7f2a7ef2c63af7359b22787a9daf336e"><span class="id" title="notation">&gt;</span></a> <a class="idref" href="SearchTree.html#k<sub>0</sub>"><span class="id" title="variable">k<sub>0</sub></span></a>) <a class="idref" href="SearchTree.html#e<sub>2</sub>"><span class="id" title="variable">e<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#kvs_insert"><span class="id" title="definition">kvs_insert</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> (<a class="idref" href="SearchTree.html#e<sub>1</sub>"><span class="id" title="variable">e<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c<sub>6</sub>"><span class="id" title="notation">++</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="SearchTree.html#k<sub>0</sub>"><span class="id" title="variable">k<sub>0</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="SearchTree.html#v<sub>0</sub>"><span class="id" title="variable">v<sub>0</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="SearchTree.html#e<sub>2</sub>"><span class="id" title="variable">e<sub>2</sub></span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="SearchTree.html#k<sub>0</sub>"><span class="id" title="variable">k<sub>0</sub></span></a> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c<sub>6</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="SearchTree.html#kvs_insert"><span class="id" title="definition">kvs_insert</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="SearchTree.html#e<sub>1</sub>"><span class="id" title="variable">e<sub>1</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c<sub>6</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c<sub>6</sub>"><span class="id" title="notation">++</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="SearchTree.html#k<sub>0</sub>"><span class="id" title="variable">k<sub>0</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="SearchTree.html#v<sub>0</sub>"><span class="id" title="variable">v<sub>0</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a><a class="idref" href="SearchTree.html#e<sub>2</sub>"><span class="id" title="variable">e<sub>2</sub></span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="keyword">if</span> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="Perm.html#5ea9023a94e85f78711b2bf8cc72c8f<sub>4</sub>"><span class="id" title="notation">&gt;?</span></a> <a class="idref" href="SearchTree.html#k<sub>0</sub>"><span class="id" title="variable">k<sub>0</sub></span></a> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#e<sub>1</sub>"><span class="id" title="variable">e<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c<sub>6</sub>"><span class="id" title="notation">++</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="SearchTree.html#k<sub>0</sub>"><span class="id" title="variable">k<sub>0</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="SearchTree.html#v<sub>0</sub>"><span class="id" title="variable">v<sub>0</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::(</span></a><a class="idref" href="SearchTree.html#kvs_insert"><span class="id" title="definition">kvs_insert</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="SearchTree.html#e<sub>2</sub>"><span class="id" title="variable">e<sub>2</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#e<sub>1</sub>"><span class="id" title="variable">e<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c<sub>6</sub>"><span class="id" title="notation">++</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a><a class="idref" href="SearchTree.html#e<sub>2</sub>"><span class="id" title="variable">e<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab128"></a><h4 class="section">Exercise: 3 stars, standard, optional (kvs_insert_elements)</h4>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="kvs_insert_elements"><span class="id" title="lemma">kvs_insert_elements</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#BST"><span class="id" title="inductive">BST</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">v</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#elements"><span class="id" title="definition">elements</span></a> (<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#kvs_insert"><span class="id" title="definition">kvs_insert</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> (<a class="idref" href="SearchTree.html#elements"><span class="id" title="definition">elements</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a name="lab129"></a><h1 class="section">Model-based Specifications</h1>

<div class="paragraph"> </div>

 At the outset, we mentioned studying two techniques for
    specifying the correctness of BST operations in this chapter.  The
    first was algebraic specification.

<div class="paragraph"> </div>

    Another approach to proving correctness of search trees is to
    relate them to our existing implementation of functional partial
    maps, as developed in <a href="https://softwarefoundations.cis.upenn.edu/lf-current/Maps.html"><span class="inlineref">Maps</span></a>. To prove the correctness of a
    search-tree algorithm, we can prove:

<div class="paragraph"> </div>

<ul class="doclist">
<li> Any search tree corresponds to some functional partial map,
      using a function or relation that we write down.

<div class="paragraph"> </div>


</li>
<li> The <span class="inlinecode"><span class="id" title="var">lookup</span></span> operation on trees gives the same result as the
      <span class="inlinecode"><span class="id" title="var">find</span></span> operation on the corresponding map.

<div class="paragraph"> </div>


</li>
<li> Given a tree and corresponding map, if we <span class="inlinecode"><span class="id" title="var">insert</span></span> on the tree
      and <span class="inlinecode"><span class="id" title="var">update</span></span> the map with the same key and value, the resulting
      tree and map are in correspondence.

</li>
</ul>

<div class="paragraph"> </div>

    This approach is sometimes called <i>model-based specification</i>: we
    show that our implementation of a data type corresponds to a more
    more abstract <i>model</i> type that we already understand. To reason
    about programs that use the implementation, it suffices to reason
    about the behavior of the abstract type, which may be
    significantly easier.  For example, we can take advantage of laws
    that we proved for the abstract type, like <span class="inlinecode"><span class="id" title="var">update_eq</span></span> for
    functional maps, without having to prove them again for the
    concrete tree type.

<div class="paragraph"> </div>

    We also need to be careful here, because the type of functional
    maps as defined in <a href="Maps.html"><span class="inlineref">Maps</span></a> do not actually behave quite like
    our tree-based maps. For one thing, functional maps can be defined
    on an infinite number of keys, and there is no mechanism for
    enumerating over the key set. To maintain correspondence with our
    finite trees, we need to make sure that we consider only
    functional maps built by finitely many applications of constructor
    functions (<span class="inlinecode"><span class="id" title="var">empty</span></span> and <span class="inlinecode"><span class="id" title="var">update</span></span>). Also, thanks to functional
    extensionality, functional maps obey stronger equality laws than
    our trees do (as we investigated in the <span class="inlinecode"><span class="id" title="var">direct_equalities</span></span>
    exercise above), so we should not be misled into thinking that
    every fact we can prove about abstract maps necessarily holds for
    concrete ones.

<div class="paragraph"> </div>

    Compared to the algebraic-specification approach described earlier
    in this chapter, the model-based approach can save some proof
    effort, especially if we already have a well-developed theory for
    the abstract model type.  On the other hand, we have to give an
    explicit <i>abstraction</i> relation between trees and maps, and show
    that it is maintained by all operations. In the end, about the
    same amount of work is needed to show correctness, though the work
    shows up in different places depending on how the abstraction
    relation is defined. 
<div class="paragraph"> </div>

 We now give a model-based specification for trees in terms
    of functional partial maps. It is based on a simple abstraction
    relation that builds a functional map element by element. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <a name="map_of_list"><span class="id" title="definition">map_of_list</span></a> {<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">el</span> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>)) : <span class="id" title="definition">partial_map</span> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="SearchTree.html#el"><span class="id" title="variable">el</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> ⇒ <span class="id" title="definition">empty</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">v</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <span class="id" title="var">el'</span> ⇒ <span class="id" title="definition">update</span> (<a class="idref" href="SearchTree.html#map_of_list"><span class="id" title="definition">map_of_list</span></a> <span class="id" title="var">el'</span>) <span class="id" title="var">k</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a name="Abs"><span class="id" title="definition">Abs</span></a> {<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) : <span class="id" title="definition">partial_map</span> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="SearchTree.html#map_of_list"><span class="id" title="definition">map_of_list</span></a> (<a class="idref" href="SearchTree.html#elements"><span class="id" title="definition">elements</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>).<br/>
</div>

<div class="doc">
In general, model-based specifications may use an abstraction
    relation, allowing each concrete value to be related to multiple
    abstract values.  But in this case a simple abstraction <i>function</i>
    will do, assigning a unique abstract value to each concrete
    one. 
<div class="paragraph"> </div>

 One small difference between trees and functional maps is that
    applying the latter returns an <span class="inlinecode"><span class="id" title="var">option</span></span> <span class="inlinecode"><span class="id" title="var">V</span></span> which might be <span class="inlinecode"><span class="id" title="var">None</span></span>,
    whereas <span class="inlinecode"><span class="id" title="var">lookup</span></span> returns a default value if key is not bound
    lookup fails.  We can easily provide a function on functional
    partial maps having the latter behavior. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a name="find"><span class="id" title="definition">find</span></a> {<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">d</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">m</span> : <span class="id" title="definition">partial_map</span> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="SearchTree.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">v</span> ⇒ <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
We also need a <span class="inlinecode"><span class="id" title="var">bound</span></span> operation on maps. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a name="map_bound"><span class="id" title="definition">map_bound</span></a> {<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">m</span> : <span class="id" title="definition">partial_map</span> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="SearchTree.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">_</span> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
We now proceed to prove that each operation preserves (or establishes)
    the abstraction relationship in an appropriate way:

<div class="paragraph"> </div>

<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">concrete</span>        <span class="id" title="tactic">abstract</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;--------        --------<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">empty_tree</span>      <span class="id" title="var">empty</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">bound</span>           <span class="id" title="var">map_bound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lookup</span>          <span class="id" title="var">find</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">insert</span>          <span class="id" title="var">update</span>
<div class="paragraph"> </div>

</span> 
<div class="paragraph"> </div>

 The following lemmas will be useful, though you are not required
    to prove them. They can all be proved by induction on the list. 
<div class="paragraph"> </div>

<a name="lab130"></a><h4 class="section">Exercise: 2 stars, standard, optional (in_fst)</h4>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="in_fst"><span class="id" title="lemma">in_fst</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">X</span> <span class="id" title="var">Y</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">lst</span> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="SearchTree.html#X"><span class="id" title="variable">X</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a> <a class="idref" href="SearchTree.html#Y"><span class="id" title="variable">Y</span></a>)) (<span class="id" title="var">x</span> : <a class="idref" href="SearchTree.html#X"><span class="id" title="variable">X</span></a>) (<span class="id" title="var">y</span> : <a class="idref" href="SearchTree.html#Y"><span class="id" title="variable">Y</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="SearchTree.html#x"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="SearchTree.html#y"><span class="id" title="variable">y</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="SearchTree.html#lst"><span class="id" title="variable">lst</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="SearchTree.html#x"><span class="id" title="variable">x</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <a class="idref" href="SearchTree.html#lst"><span class="id" title="variable">lst</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab131"></a><h4 class="section">Exercise: 2 stars, standard, optional (in_map_of_list)</h4>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="in_map_of_list"><span class="id" title="lemma">in_map_of_list</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">el</span> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>)) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">v</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#NoDup"><span class="id" title="inductive">NoDup</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <a class="idref" href="SearchTree.html#el"><span class="id" title="variable">el</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="SearchTree.html#el"><span class="id" title="variable">el</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> (<a class="idref" href="SearchTree.html#map_of_list"><span class="id" title="definition">map_of_list</span></a> <a class="idref" href="SearchTree.html#el"><span class="id" title="variable">el</span></a>) <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab132"></a><h4 class="section">Exercise: 2 stars, standard, optional (not_in_map_of_list)</h4>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="not_in_map_of_list"><span class="id" title="lemma">not_in_map_of_list</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">el</span> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>)) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">¬</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <a class="idref" href="SearchTree.html#el"><span class="id" title="variable">el</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> (<a class="idref" href="SearchTree.html#map_of_list"><span class="id" title="definition">map_of_list</span></a> <a class="idref" href="SearchTree.html#el"><span class="id" title="variable">el</span></a>) <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="empty_relate"><span class="id" title="lemma">empty_relate</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="SearchTree.html#Abs"><span class="id" title="definition">Abs</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a> <a class="idref" href="SearchTree.html#empty_tree"><span class="id" title="definition">empty_tree</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">empty</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab133"></a><h4 class="section">Exercise: 3 stars, standard, optional (bound_relate)</h4>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <a name="bound_relate"><span class="id" title="lemma">bound_relate</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#BST"><span class="id" title="inductive">BST</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#map_bound"><span class="id" title="definition">map_bound</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> (<a class="idref" href="SearchTree.html#Abs"><span class="id" title="definition">Abs</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#bound"><span class="id" title="definition">bound</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab134"></a><h4 class="section">Exercise: 3 stars, standard, optional (lookup_relate)</h4>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="lookup_relate"><span class="id" title="lemma">lookup_relate</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">d</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#BST"><span class="id" title="inductive">BST</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="SearchTree.html#find"><span class="id" title="definition">find</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> (<a class="idref" href="SearchTree.html#Abs"><span class="id" title="definition">Abs</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab135"></a><h4 class="section">Exercise: 3 stars, standard, optional (insert_relate)</h4>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="insert_relate"><span class="id" title="lemma">insert_relate</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">v</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="SearchTree.html#BST"><span class="id" title="inductive">BST</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="SearchTree.html#Abs"><span class="id" title="definition">Abs</span></a> (<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">update</span> (<a class="idref" href="SearchTree.html#Abs"><span class="id" title="definition">Abs</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>) <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;TODO:&nbsp;find&nbsp;a&nbsp;direct&nbsp;proof&nbsp;that&nbsp;doesn't&nbsp;rely&nbsp;on&nbsp;<span class="inlinecode"><span class="id" title="var">kvs_insert_elements</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="SearchTree.html#Abs"><span class="id" title="definition">Abs</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="SearchTree.html#kvs_insert_elements"><span class="id" title="axiom">kvs_insert_elements</span></a>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<a class="idref" href="SearchTree.html#elements"><span class="id" title="definition">elements</span></a> <span class="id" title="var">t</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> -<span class="id" title="var">l</span>. <span class="comment">(*&nbsp;clear&nbsp;everything&nbsp;not&nbsp;about&nbsp;<span class="inlinecode"><span class="id" title="var">l</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Hint:&nbsp;proceed&nbsp;by&nbsp;induction&nbsp;on&nbsp;<span class="inlinecode"><span class="id" title="var">l</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 The previous three lemmas are in essence saying that the following
    diagrams commute.

<div class="paragraph"> </div>

<pre>
             bound k
      t -------------------+
      |                    |
  Abs |                    |
      V                    V
      m ---------------<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> b
           map_bound k


            lookup d k
      t ---------------<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> v
      |                    |
  Abs |                    | Some
      V                    V
      m ---------------<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> Some v
             find d k


            insert k v
      t ---------------<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t'
      |                    |
  Abs |                    | Abs
      V                    V
      m ---------------<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> m'
            update' k v
</pre>

<div class="paragraph"> </div>

    Where we define:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update'</span> <span class="id" title="var">k</span> <span class="id" title="var">v</span> <span class="id" title="var">m</span> = <span class="id" title="var">update</span> <span class="id" title="var">m</span> <span class="id" title="var">k</span> <span class="id" title="var">v</span>
<div class="paragraph"> </div>

</span>
<div class="paragraph"> </div>


<div class="paragraph"> </div>

 Functional partial maps lack a way to extract or iterate
    over their elements, so we cannot give an analogous abstract
    operation for <span class="inlinecode"><span class="id" title="var">elements</span></span>. Instead, we can prove this trivial
    little lemma. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="elements_relate"><span class="id" title="lemma">elements_relate</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="SearchTree.html#BST"><span class="id" title="inductive">BST</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="SearchTree.html#map_of_list"><span class="id" title="definition">map_of_list</span></a> (<a class="idref" href="SearchTree.html#elements"><span class="id" title="definition">elements</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#Abs"><span class="id" title="definition">Abs</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="SearchTree.html#Abs"><span class="id" title="definition">Abs</span></a>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab136"></a><h1 class="section">An Alternative Abstraction Relation (Optional, Advanced)</h1>

<div class="paragraph"> </div>

 There is often more than one way to specify a suitable abstraction
    relation between given concrete and abstract datatypes. The
    following exercises explore another way to relate search trees to
    functional partial maps without using <span class="inlinecode"><span class="id" title="var">elements</span></span> as an
    intermediate step.

<div class="paragraph"> </div>

    We extend our definition of functional partial maps by adding a
    new primitive for combining two partial maps, which we call
    <span class="inlinecode"><span class="id" title="var">union</span></span>.  Our intention is that it only be used to combine maps
    with disjoint key sets; to keep the operation symmetric, we make
    the result be undefined on any key they have in common.  
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a name="union"><span class="id" title="definition">union</span></a> {<span class="id" title="var">X</span>} (<span class="id" title="var">m<sub>1</sub></span> <span class="id" title="var">m<sub>2</sub></span>: <span class="id" title="definition">partial_map</span> <a class="idref" href="SearchTree.html#X"><span class="id" title="variable">X</span></a>) : <span class="id" title="definition">partial_map</span> <a class="idref" href="SearchTree.html#X"><span class="id" title="variable">X</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">k</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="SearchTree.html#m<sub>1</sub>"><span class="id" title="variable">m<sub>1</sub></span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="SearchTree.html#m<sub>2</sub>"><span class="id" title="variable">m<sub>2</sub></span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">v</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">v</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
We can prove some simple properties of lookup and update on unions,
    which will prove useful later. 
<div class="paragraph"> </div>

<a name="lab137"></a><h4 class="section">Exercise: 2 stars, standard, optional (union_collapse)</h4>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="union_left"><span class="id" title="lemma">union_left</span></a> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">X</span>} (<span class="id" title="var">m<sub>1</sub></span> <span class="id" title="var">m<sub>2</sub></span>: <span class="id" title="definition">partial_map</span> <a class="idref" href="SearchTree.html#X"><span class="id" title="variable">X</span></a>) <span class="id" title="var">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#m<sub>2</sub>"><span class="id" title="variable">m<sub>2</sub></span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="SearchTree.html#union"><span class="id" title="definition">union</span></a> <a class="idref" href="SearchTree.html#m<sub>1</sub>"><span class="id" title="variable">m<sub>1</sub></span></a> <a class="idref" href="SearchTree.html#m<sub>2</sub>"><span class="id" title="variable">m<sub>2</sub></span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#m<sub>1</sub>"><span class="id" title="variable">m<sub>1</sub></span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a name="union_right"><span class="id" title="lemma">union_right</span></a> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">X</span>} (<span class="id" title="var">m<sub>1</sub></span> <span class="id" title="var">m<sub>2</sub></span>: <span class="id" title="definition">partial_map</span> <a class="idref" href="SearchTree.html#X"><span class="id" title="variable">X</span></a>) <span class="id" title="var">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#m<sub>1</sub>"><span class="id" title="variable">m<sub>1</sub></span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#union"><span class="id" title="definition">union</span></a> <a class="idref" href="SearchTree.html#m<sub>1</sub>"><span class="id" title="variable">m<sub>1</sub></span></a> <a class="idref" href="SearchTree.html#m<sub>2</sub>"><span class="id" title="variable">m<sub>2</sub></span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#m<sub>2</sub>"><span class="id" title="variable">m<sub>2</sub></span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a name="union_both"><span class="id" title="lemma">union_both</span></a> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">X</span>} (<span class="id" title="var">m<sub>1</sub></span> <span class="id" title="var">m<sub>2</sub></span> : <span class="id" title="definition">partial_map</span> <a class="idref" href="SearchTree.html#X"><span class="id" title="variable">X</span></a>) <span class="id" title="var">k</span> <span class="id" title="var">v<sub>1</sub></span> <span class="id" title="var">v<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#m<sub>1</sub>"><span class="id" title="variable">m<sub>1</sub></span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="SearchTree.html#v<sub>1</sub>"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#m<sub>2</sub>"><span class="id" title="variable">m<sub>2</sub></span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="SearchTree.html#v<sub>2</sub>"><span class="id" title="variable">v<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#union"><span class="id" title="definition">union</span></a> <a class="idref" href="SearchTree.html#m<sub>1</sub>"><span class="id" title="variable">m<sub>1</sub></span></a> <a class="idref" href="SearchTree.html#m<sub>2</sub>"><span class="id" title="variable">m<sub>2</sub></span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab138"></a><h4 class="section">Exercise: 3 stars, standard, optional (union_update)</h4>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="union_update_right"><span class="id" title="lemma">union_update_right</span></a> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">X</span>} (<span class="id" title="var">m<sub>1</sub></span> <span class="id" title="var">m<sub>2</sub></span>: <span class="id" title="definition">partial_map</span> <a class="idref" href="SearchTree.html#X"><span class="id" title="variable">X</span></a>) <span class="id" title="var">k</span> <span class="id" title="var">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#m<sub>1</sub>"><span class="id" title="variable">m<sub>1</sub></span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">update</span> (<a class="idref" href="SearchTree.html#union"><span class="id" title="definition">union</span></a> <a class="idref" href="SearchTree.html#m<sub>1</sub>"><span class="id" title="variable">m<sub>1</sub></span></a> <a class="idref" href="SearchTree.html#m<sub>2</sub>"><span class="id" title="variable">m<sub>2</sub></span></a>) <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#union"><span class="id" title="definition">union</span></a> <a class="idref" href="SearchTree.html#m<sub>1</sub>"><span class="id" title="variable">m<sub>1</sub></span></a> (<span class="id" title="definition">update</span> <a class="idref" href="SearchTree.html#m<sub>2</sub>"><span class="id" title="variable">m<sub>2</sub></span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a name="union_update_left"><span class="id" title="lemma">union_update_left</span></a> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">X</span>} (<span class="id" title="var">m<sub>1</sub></span> <span class="id" title="var">m<sub>2</sub></span>: <span class="id" title="definition">partial_map</span> <a class="idref" href="SearchTree.html#X"><span class="id" title="variable">X</span></a>) <span class="id" title="var">k</span> <span class="id" title="var">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#m<sub>2</sub>"><span class="id" title="variable">m<sub>2</sub></span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">update</span> (<a class="idref" href="SearchTree.html#union"><span class="id" title="definition">union</span></a> <a class="idref" href="SearchTree.html#m<sub>1</sub>"><span class="id" title="variable">m<sub>1</sub></span></a> <a class="idref" href="SearchTree.html#m<sub>2</sub>"><span class="id" title="variable">m<sub>2</sub></span></a>) <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#union"><span class="id" title="definition">union</span></a> (<span class="id" title="definition">update</span> <a class="idref" href="SearchTree.html#m<sub>1</sub>"><span class="id" title="variable">m<sub>1</sub></span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a>) <a class="idref" href="SearchTree.html#m<sub>2</sub>"><span class="id" title="variable">m<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 We can now write a direct conversion function from trees to maps
    based on the structure of the tree, and prove a basic property
    preservation result. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <a name="map_of_tree"><span class="id" title="definition">map_of_tree</span></a> {<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span>: <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) : <span class="id" title="definition">partial_map</span> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="SearchTree.html#E"><span class="id" title="constructor">E</span></a> ⇒ <span class="id" title="definition">empty</span><br/>
&nbsp;&nbsp;| <a class="idref" href="SearchTree.html#T"><span class="id" title="constructor">T</span></a> <span class="id" title="var">l</span> <span class="id" title="var">k</span> <span class="id" title="var">v</span> <span class="id" title="var">r</span> ⇒ <span class="id" title="definition">update</span> (<a class="idref" href="SearchTree.html#union"><span class="id" title="definition">union</span></a> (<a class="idref" href="SearchTree.html#map_of_tree"><span class="id" title="definition">map_of_tree</span></a> <span class="id" title="var">l</span>) (<a class="idref" href="SearchTree.html#map_of_tree"><span class="id" title="definition">map_of_tree</span></a> <span class="id" title="var">r</span>)) <span class="id" title="var">k</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
<a name="lab139"></a><h4 class="section">Exercise: 3 stars, advanced, optional (map_of_tree_prop)</h4>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="map_of_tree_prop"><span class="id" title="lemma">map_of_tree_prop</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">P</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#ForallT"><span class="id" title="definition">ForallT</span></a> <a class="idref" href="SearchTree.html#P"><span class="id" title="variable">P</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">k</span> <span class="id" title="var">v</span>, (<a class="idref" href="SearchTree.html#map_of_tree"><span class="id" title="definition">map_of_tree</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>) <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#P"><span class="id" title="variable">P</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 Finally, we define our new abstraction function, and prove the
    same lemmas as before. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a name="Abs'"><span class="id" title="definition">Abs'</span></a> {<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span>: <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) : <span class="id" title="definition">partial_map</span> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="SearchTree.html#map_of_tree"><span class="id" title="definition">map_of_tree</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a name="empty_relate'"><span class="id" title="lemma">empty_relate'</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="SearchTree.html#Abs'"><span class="id" title="definition">Abs'</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a> <a class="idref" href="SearchTree.html#empty_tree"><span class="id" title="definition">empty_tree</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">empty</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab140"></a><h4 class="section">Exercise: 3 stars, advanced, optional (bound_relate')</h4>

</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <a name="bound_relate'"><span class="id" title="lemma">bound_relate'</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#BST"><span class="id" title="inductive">BST</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#map_bound"><span class="id" title="definition">map_bound</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> (<a class="idref" href="SearchTree.html#Abs'"><span class="id" title="definition">Abs'</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#bound"><span class="id" title="definition">bound</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab141"></a><h4 class="section">Exercise: 3 stars, advanced, optional (lookup_relate')</h4>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="lookup_relate'"><span class="id" title="lemma">lookup_relate'</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">d</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#BST"><span class="id" title="inductive">BST</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="SearchTree.html#find"><span class="id" title="definition">find</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> (<a class="idref" href="SearchTree.html#Abs'"><span class="id" title="definition">Abs'</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="SearchTree.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab142"></a><h4 class="section">Exercise: 4 stars, advanced, optional (insert_relate')</h4>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="insert_relate'"><span class="id" title="lemma">insert_relate'</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">k</span> : <a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a>) (<span class="id" title="var">v</span> : <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#BST"><span class="id" title="inductive">BST</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="SearchTree.html#Abs'"><span class="id" title="definition">Abs'</span></a> (<a class="idref" href="SearchTree.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">update</span> (<a class="idref" href="SearchTree.html#Abs'"><span class="id" title="definition">Abs'</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>) <a class="idref" href="SearchTree.html#k"><span class="id" title="variable">k</span></a> <a class="idref" href="SearchTree.html#v"><span class="id" title="variable">v</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 The <span class="inlinecode"><span class="id" title="var">elements_relate</span></span> lemma, which was trivial for our previous <span class="inlinecode"><span class="id" title="var">Abs</span></span>
    function, is considerably harder this time.  We suggest starting with
    an auxiliary lemma. 
<div class="paragraph"> </div>

<a name="lab143"></a><h4 class="section">Exercise: 3 stars, advanced, optional (map_of_list_app)</h4>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="map_of_list_app"><span class="id" title="lemma">map_of_list_app</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">el<sub>1</sub></span> <span class="id" title="var">el<sub>2</sub></span>: <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="SearchTree.html#key"><span class="id" title="definition">key</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>)),<br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#disjoint"><span class="id" title="definition">disjoint</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <a class="idref" href="SearchTree.html#el<sub>1</sub>"><span class="id" title="variable">el<sub>1</sub></span></a>) (<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <a class="idref" href="SearchTree.html#el<sub>2</sub>"><span class="id" title="variable">el<sub>2</sub></span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="SearchTree.html#map_of_list"><span class="id" title="definition">map_of_list</span></a> (<a class="idref" href="SearchTree.html#el<sub>1</sub>"><span class="id" title="variable">el<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c<sub>6</sub>"><span class="id" title="notation">++</span></a> <a class="idref" href="SearchTree.html#el<sub>2</sub>"><span class="id" title="variable">el<sub>2</sub></span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#union"><span class="id" title="definition">union</span></a> (<a class="idref" href="SearchTree.html#map_of_list"><span class="id" title="definition">map_of_list</span></a> <a class="idref" href="SearchTree.html#el<sub>1</sub>"><span class="id" title="variable">el<sub>1</sub></span></a>) (<a class="idref" href="SearchTree.html#map_of_list"><span class="id" title="definition">map_of_list</span></a> <a class="idref" href="SearchTree.html#el<sub>2</sub>"><span class="id" title="variable">el<sub>2</sub></span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab144"></a><h4 class="section">Exercise: 4 stars, advanced, optional (elements_relate')</h4>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="elements_relate'"><span class="id" title="lemma">elements_relate'</span></a> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">V</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">t</span> : <a class="idref" href="SearchTree.html#tree"><span class="id" title="inductive">tree</span></a> <a class="idref" href="SearchTree.html#V"><span class="id" title="variable">V</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="SearchTree.html#BST"><span class="id" title="inductive">BST</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="SearchTree.html#map_of_list"><span class="id" title="definition">map_of_list</span></a> (<a class="idref" href="SearchTree.html#elements"><span class="id" title="definition">elements</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SearchTree.html#Abs'"><span class="id" title="definition">Abs'</span></a> <a class="idref" href="SearchTree.html#t"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a name="lab145"></a><h1 class="section">Efficiency of Search Trees</h1>

<div class="paragraph"> </div>

 All the theory we've developed so far has been about correctness.
    But the reason we use binary search trees is that they are
    efficient.  That is, if there are <span class="inlinecode"><span class="id" title="var">N</span></span> elements in a (reasonably
    well balanced) BST, each insertion or lookup takes about <span class="inlinecode"><span class="id" title="var">log</span></span> <span class="inlinecode"><span class="id" title="var">N</span></span>
    time.

<div class="paragraph"> </div>

    What could go wrong?

<div class="paragraph"> </div>

     1. The search tree might not be balanced.  In that case, each
        insertion or lookup will take as much as linear time.

<div class="paragraph"> </div>

<ul class="doclist">
<li> SOLUTION: use an algorithm that ensures the trees stay
          balanced.  We'll do that in <a href="Redblack.html"><span class="inlineref">Redblack</span></a>.

</li>
</ul>

<div class="paragraph"> </div>

     2. Our keys are natural numbers, and Coq's <span class="inlinecode"><span class="id" title="var">nat</span></span> type takes linear
        time per comparison.  That is, computing (j &lt;? k) takes time
        proportional to the value of <span class="inlinecode"><span class="id" title="var">k</span>-<span class="id" title="var">j</span></span>.

<div class="paragraph"> </div>

<ul class="doclist">
<li> SOLUTION: represent keys by a data type that has a more
          efficient comparison operator.  We used <span class="inlinecode"><span class="id" title="var">nat</span></span> in this chapter
          because it's something easy to work with.

</li>
</ul>

<div class="paragraph"> </div>

     3. There's no notion of running time in Coq.  That is, we can't
        say what it means that a Coq function "takes N steps to
        evaluate."  Therefore, we can't prove that binary search trees
        are efficient.

<div class="paragraph"> </div>

<ul class="doclist">
<li> SOLUTION 1: Don't prove (in Coq) that they're efficient;
          just prove that they are correct.  Prove things about their
          efficiency the old-fashioned way, on pencil and paper.

<div class="paragraph"> </div>


</li>
<li> SOLUTION 2: Prove in Coq some facts about the height of the
          trees, which have direct bearing on their efficiency.  We'll
          explore that in <a href="Redblack.html"><span class="inlineref">Redblack</span></a>.

<div class="paragraph"> </div>


</li>
<li> SOLUTION 3: Apply bleeding-edge frameworks for reasoning
          about run-time of programs represented in Coq.

</li>
</ul>

<div class="paragraph"> </div>

      4. Our functions in Coq are models of implementations in "real"
         programming languages.  What if the real implementations
         differ from the Coq models?

<div class="paragraph"> </div>

<ul class="doclist">
<li> SOLUTION: Use Coq's <span class="inlinecode"><span class="id" title="var">extraction</span></span> feature to derive the real
	   implementation (in Ocaml or Haskell) automatically from the
	   Coq function.  Or, use Coq's <span class="inlinecode"><span class="id" title="keyword">Compute</span></span> or <span class="inlinecode"><span class="id" title="keyword">Eval</span></span>
	   <span class="inlinecode"><span class="id" title="var">native_compute</span></span> feature to compile and run the programs
	   efficiently inside Coq.  We'll explore <span class="inlinecode"><span class="id" title="var">extraction</span></span> in a
	   <a href="Extract.html"><span class="inlineref">Extract</span></a>. 
</li>
</ul>

</div>
<div class="code">

<br/>
<span class="comment">(*&nbsp;2020-07-22&nbsp;22:40:38&nbsp;(UTC+00)&nbsp;*)</span><br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>