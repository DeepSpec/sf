<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>Rich: Assertions, Loops, N-ary Functions</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/slf.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 6: Separation Logic Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">Rich<span class="subtitle">Assertions, Loops, N-ary Functions</span></h1>


<div class="code">

<span class="id" title="keyword">Set Implicit Arguments</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">SLF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="LibSepReference.html#"><span class="id" title="library">LibSepReference</span></a> <span class="id" title="library">LibSepTLCbuffer</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">SLF</span> <span class="id" title="keyword">Require</span> <a class="idref" href="Basic.html#"><span class="id" title="library">Basic</span></a> <a class="idref" href="Repr.html#"><span class="id" title="library">Repr</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">P</span> : <span class="id" title="keyword">Prop</span>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">H</span> : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">Q</span> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span> : <a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">k</span> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> : <span class="id" title="notation">int</span>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">v</span> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">b</span> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">L</span> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
</div>

<div class="doc">
<a id="lab429"></a><h1 class="section">First Pass</h1>

<div class="paragraph"> </div>

 This chapter introduces support for additional language constructs:
<ul class="doclist">
<li> assertions,

</li>
<li> if-statements that are not in A-normal form (needed for loops)

</li>
<li> while-loops,

</li>
<li> n-ary functions (bonus contents).

</li>
</ul>

<div class="paragraph"> </div>

    Regarding assertions, we present a reasoning rule such that:
<ul class="doclist">
<li> assertions may access to mutable data,

</li>
<li> assertions may perform local side-effects,

</li>
<li> the program remains correct whether assertions are executed or not.

</li>
</ul>

<div class="paragraph"> </div>

    Regarding loops, we explain why traditional Hoare-style reasoning rules
    based on loop invariants are limited, in that they prevent useful
    applications of the frame rule. We present alternative reasoning rules
    compatible with the frame rule, and demonstrate their benefits on
    practical examples.

<div class="paragraph"> </div>

    Regarding n-ary functions, that is, functions with several arguments,
    there are essentially three possible approaches:

<div class="paragraph"> </div>

<ul class="doclist">
<li> native n-ary functions, e.g., <span class="inlinecode"><span class="id" title="var">function</span>(<span class="id" title="var">x</span>,</span> <span class="inlinecode"><span class="id" title="var">y</span>)</span> <span class="inlinecode">{</span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">}</span> <span class="inlinecode"></span> in C syntax;

</li>
<li> curried functions, e.g., <span class="inlinecode"><span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">t</span></span> in OCaml syntax;

</li>
<li> tupled functions, e.g., <span class="inlinecode"><span class="id" title="keyword">fun</span></span> <span class="inlinecode">(<span class="id" title="var">x</span>,<span class="id" title="var">y</span>)</span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">t</span></span> in OCaml syntax.

</li>
</ul>

<div class="paragraph"> </div>

    In this chapter, we describe the first two approaches. The third
    approach (tupled functions) would require product data types in
    the source language. 
</div>

<div class="doc">
<a id="lab430"></a><h2 class="section">Reasoning Rule for Assertions</h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="Assertions" class="idref" href="#Assertions"><span class="id" title="module">Assertions</span></a>.<br/>
</div>

<div class="doc">
Assume an additional primitive operation, allowing to write terms
    of the form <span class="inlinecode"><span class="id" title="var">val_assert</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>, to dynamically check at runtime that the
    term <span class="inlinecode"><span class="id" title="var">t</span></span> produces the boolean value <span class="inlinecode"><span class="id" title="var">true</span></span>, equivalently to the
    OCaml expression <span class="inlinecode"><span class="id" title="tactic">assert</span>(<span class="id" title="var">t</span>)</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="Assertions.val_assert" class="idref" href="#Assertions.val_assert"><span class="id" title="axiom">val_assert</span></a> : <a class="idref" href="LibSepReference.html#prim"><span class="id" title="inductive">prim</span></a>.<br/>
</div>

<div class="doc">
The reasoning rule for assertions should ensure that:

<div class="paragraph"> </div>

<ul class="doclist">
<li> the body of the assertion always evaluates to <span class="inlinecode"><span class="id" title="var">true</span></span>,

</li>
<li> the program remains correct if the assertion is not evaluated.

</li>
</ul>

<div class="paragraph"> </div>

    Let us introduce a boolean flag to control the evaluation of
    assertions. The value of this flag is purposely left unspecified. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="Assertions.evaluate_assertions" class="idref" href="#Assertions.evaluate_assertions"><span class="id" title="axiom">evaluate_assertions</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>.<br/>
</div>

<div class="doc">
The program should be correct for both possible values of
    <span class="inlinecode"><span class="id" title="var">evaluate_assertions</span></span>. The semantics of the evaluation of assertions
    is formally captured by the following two rules.

<div class="paragraph"> </div>

<ul class="doclist">
<li> The rule <span class="inlinecode"><span class="id" title="var">eval_assert_enabled</span></span> applies when <span class="inlinecode"><span class="id" title="var">evaluate_assertions</span></span>
      is set to <span class="inlinecode"><span class="id" title="var">true</span></span>. The rule describes the evaluation of the body of
      the assertion, and the check that the output value is <span class="inlinecode"><span class="id" title="var">true</span></span>.

</li>
<li> The rule <span class="inlinecode"><span class="id" title="var">eval_assert_disabled</span></span> applies when <span class="inlinecode"><span class="id" title="var">evaluate_assertions</span></span>
      is set to <span class="inlinecode"><span class="id" title="var">false</span></span>. The rule totally ignores the body of the assertion.
      It treats the assertion as immediately returning the <span class="inlinecode"><span class="id" title="var">unit</span></span> value,
      in the current state. 

</li>
</ul>
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="Assertions.eval_assert_enabled" class="idref" href="#Assertions.eval_assert_enabled"><span class="id" title="axiom">eval_assert_enabled</span></a> : <span class="id" title="keyword">∀</span> <a id="s:3" class="idref" href="#s:3"><span class="id" title="binder">s</span></a> <a id="t:4" class="idref" href="#t:4"><span class="id" title="binder">t</span></a> <a id="s':5" class="idref" href="#s':5"><span class="id" title="binder">s'</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#Assertions.evaluate_assertions"><span class="id" title="axiom">evaluate_assertions</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Rich.html#s:3"><span class="id" title="variable">s</span></a> <a class="idref" href="Rich.html#t:4"><span class="id" title="variable">t</span></a> <a class="idref" href="Rich.html#s':5"><span class="id" title="variable">s'</span></a> (<a class="idref" href="LibSepReference.html#val_bool"><span class="id" title="constructor">val_bool</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Rich.html#s:3"><span class="id" title="variable">s</span></a> (<a class="idref" href="Rich.html#Assertions.val_assert"><span class="id" title="axiom">val_assert</span></a> <a class="idref" href="Rich.html#t:4"><span class="id" title="variable">t</span></a>) <a class="idref" href="Rich.html#s':5"><span class="id" title="variable">s'</span></a> <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Parameter</span> <a id="Assertions.eval_assert_disabled" class="idref" href="#Assertions.eval_assert_disabled"><span class="id" title="axiom">eval_assert_disabled</span></a> : <span class="id" title="keyword">∀</span> <a id="s:7" class="idref" href="#s:7"><span class="id" title="binder">s</span></a> <a id="t:8" class="idref" href="#t:8"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#Assertions.evaluate_assertions"><span class="id" title="axiom">evaluate_assertions</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Rich.html#s:7"><span class="id" title="variable">s</span></a> (<a class="idref" href="Rich.html#Assertions.val_assert"><span class="id" title="axiom">val_assert</span></a> <a class="idref" href="Rich.html#t:8"><span class="id" title="variable">t</span></a>) <a class="idref" href="Rich.html#s:7"><span class="id" title="variable">s</span></a> <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a>.<br/>
</div>

<div class="doc">
Note that it might be tempting to consider a "unifying" evaluation rule
    that evaluates the body of the assertion, checks that the result is <span class="inlinecode"><span class="id" title="var">true</span></span>,
    and, moreover, imposes that the assertion does not modify the state. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="Assertions.eval_assert_no_effect" class="idref" href="#Assertions.eval_assert_no_effect"><span class="id" title="axiom">eval_assert_no_effect</span></a> : <span class="id" title="keyword">∀</span> <a id="s:10" class="idref" href="#s:10"><span class="id" title="binder">s</span></a> <a id="t:11" class="idref" href="#t:11"><span class="id" title="binder">t</span></a> <a id="v:12" class="idref" href="#v:12"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Rich.html#s:10"><span class="id" title="variable">s</span></a> <a class="idref" href="Rich.html#t:11"><span class="id" title="variable">t</span></a> <a class="idref" href="Rich.html#s:10"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#val_bool"><span class="id" title="constructor">val_bool</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Rich.html#s:10"><span class="id" title="variable">s</span></a> (<a class="idref" href="Rich.html#Assertions.val_assert"><span class="id" title="axiom">val_assert</span></a> <a class="idref" href="Rich.html#t:11"><span class="id" title="variable">t</span></a>) <a class="idref" href="Rich.html#s:10"><span class="id" title="variable">s</span></a> <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a>.<br/>
</div>

<div class="doc">
Yet, such a rule would be overly restrictive, for two reasons. First, it
    might be useful for an assertion to allocate local data for evaluating
    a particular property. Second, there are useful examples of assertions
    that do modify existing cells from the heap. For example, an assertion
    that appears in real programs is <span class="inlinecode"><span class="id" title="tactic">assert</span></span> <span class="inlinecode">(<span class="id" title="var">find</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">find</span></span> <span class="inlinecode"><span class="id" title="var">y</span>)</span>, where the
    <span class="inlinecode"><span class="id" title="var">find</span></span> operation finds the representative of a node from a Union-Find
    data structure, an operation that performs path compression. 
<div class="paragraph"> </div>

 At this point, our goal is to state a reasoning rule for <span class="inlinecode"><span class="id" title="var">val_assert</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>
    that does not depend on the value of the boolean flag <span class="inlinecode"><span class="id" title="var">evaluate_assertions</span></span>.
    In other words, we are seeking for a rule that is correct both with respect
    to <span class="inlinecode"><span class="id" title="var">eval_assert_enabled</span></span> and with respect to <span class="inlinecode"><span class="id" title="var">eval_assert_disabled</span></span>.

<div class="paragraph"> </div>

    Consider the evaluation of <span class="inlinecode"><span class="id" title="var">val_assert</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> in a state described by <span class="inlinecode"><span class="id" title="var">H</span></span>.
    The output state should still be described by <span class="inlinecode"><span class="id" title="var">H</span></span>, although the internal
    representation of the state might have changed (e.g., for path compression
    in the case of a Union-Find data structure). The body of the assertion
    should evaluate correctly in a state described by <span class="inlinecode"><span class="id" title="var">H</span></span>, and should return
    the value <span class="inlinecode"><span class="id" title="var">true</span></span>, in an output state still described by <span class="inlinecode"><span class="id" title="var">H</span></span>.

<div class="paragraph"> </div>

    As usual for primitive operations, we first establish a rule for
    Hoare triples, then deduce a rule for Separation Logic triples. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Assertions.hoare_assert" class="idref" href="#Assertions.hoare_assert"><span class="id" title="lemma">hoare_assert</span></a> : <span class="id" title="keyword">∀</span> <a id="t:14" class="idref" href="#t:14"><span class="id" title="binder">t</span></a> <a id="H:15" class="idref" href="#H:15"><span class="id" title="binder">H</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#hoare"><span class="id" title="definition">hoare</span></a> <a class="idref" href="Rich.html#t:14"><span class="id" title="variable">t</span></a> <a class="idref" href="Rich.html#H:15"><span class="id" title="variable">H</span></a> (<span class="id" title="keyword">fun</span> <a id="r:16" class="idref" href="#r:16"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Rich.html#r:16"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Rich.html#H:15"><span class="id" title="variable">H</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#hoare"><span class="id" title="definition">hoare</span></a> (<a class="idref" href="Rich.html#Assertions.val_assert"><span class="id" title="axiom">val_assert</span></a> <a class="idref" href="Rich.html#t:14"><span class="id" title="variable">t</span></a>) <a class="idref" href="Rich.html#H:15"><span class="id" title="variable">H</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Rich.html#H:15"><span class="id" title="variable">H</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">s</span> <span class="id" title="var">K</span>. <span class="id" title="var">forwards</span> (<span class="id" title="var">s'</span>&amp;<span class="id" title="var">v</span>&amp;<span class="id" title="var">R</span>&amp;<span class="id" title="var">N</span>): <span class="id" title="var">M</span> <span class="id" title="var">K</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_hpure_l"><span class="id" title="lemma">hstar_hpure_l</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">N</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">N</span> <span class="id" title="keyword">as</span> (<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>&amp;<span class="id" title="var">K'</span>).<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;There&nbsp;are&nbsp;two&nbsp;cases,&nbsp;depending&nbsp;on&nbsp;whether&nbsp;assertions&nbsp;are&nbsp;evaluated.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="var">case_eq</span> <a class="idref" href="Rich.html#Assertions.evaluate_assertions"><span class="id" title="axiom">evaluate_assertions</span></a>; <span class="id" title="tactic">intros</span> <span class="id" title="var">C</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Case&nbsp;1:&nbsp;assertions&nbsp;are&nbsp;enabled.&nbsp;*)</span><br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">∃</span> <span class="id" title="var">s'</span> <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Rich.html#Assertions.eval_assert_enabled"><span class="id" title="axiom">eval_assert_enabled</span></a> <span class="id" title="var">C</span> <span class="id" title="var">R</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <span class="id" title="var">K'</span>. } }<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Case&nbsp;2:&nbsp;assertions&nbsp;are&nbsp;disabled.&nbsp;*)</span><br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">∃</span> <span class="id" title="var">s</span> <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Rich.html#Assertions.eval_assert_disabled"><span class="id" title="axiom">eval_assert_disabled</span></a> <span class="id" title="var">C</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <span class="id" title="var">K</span>. } }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Assertions.triple_assert" class="idref" href="#Assertions.triple_assert"><span class="id" title="lemma">triple_assert</span></a> : <span class="id" title="keyword">∀</span> <a id="t:17" class="idref" href="#t:17"><span class="id" title="binder">t</span></a> <a id="H:18" class="idref" href="#H:18"><span class="id" title="binder">H</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Rich.html#t:17"><span class="id" title="variable">t</span></a> <a class="idref" href="Rich.html#H:18"><span class="id" title="variable">H</span></a> (<span class="id" title="keyword">fun</span> <a id="r:19" class="idref" href="#r:19"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Rich.html#r:19"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Rich.html#H:18"><span class="id" title="variable">H</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Rich.html#Assertions.val_assert"><span class="id" title="axiom">val_assert</span></a> <a class="idref" href="Rich.html#t:17"><span class="id" title="variable">t</span></a>) <a class="idref" href="Rich.html#H:18"><span class="id" title="variable">H</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Rich.html#H:18"><span class="id" title="variable">H</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H'</span>. <span class="id" title="var">specializes</span> <span class="id" title="var">M</span> <span class="id" title="var">H'</span>. <span class="id" title="var">applys</span> <a class="idref" href="Rich.html#Assertions.hoare_assert"><span class="id" title="lemma">hoare_assert</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#hoare_conseq"><span class="id" title="lemma">hoare_conseq</span></a> <span class="id" title="var">M</span>. { <span class="id" title="var">xsimpl</span>. } { <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">auto</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="Rich.html#Assertions"><span class="id" title="module">Assertions</span></a>.<br/>
</div>

<div class="doc">
<a id="lab431"></a><h2 class="section">Semantics of Conditionals not in Administrative Normal Form</h2>

<div class="paragraph"> </div>

 To state reasoning rule for while-loops in a concise manner, it is useful
    to generalize the construct <span class="inlinecode"><span class="id" title="keyword">if</span></span> <span class="inlinecode"><span class="id" title="var">b</span></span> <span class="inlinecode"><span class="id" title="keyword">then</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="keyword">else</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> to the form
    <span class="inlinecode"><span class="id" title="keyword">if</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>0</sub></span></span> <span class="inlinecode"><span class="id" title="keyword">then</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="keyword">else</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>. 
<div class="paragraph"> </div>

 To specify the behavior of a term of the form <span class="inlinecode"><span class="id" title="keyword">if</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>0</sub></span></span> <span class="inlinecode"><span class="id" title="keyword">then</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="keyword">else</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>,
    let us assume the evaluation rule shown below. This rule generalizes
    the rule <span class="inlinecode"><span class="id" title="var">eval_if</span></span>. It first evaluates <span class="inlinecode"><span class="id" title="var">t<sub>0</sub></span></span> into a value <span class="inlinecode"><span class="id" title="var">v<sub>0</sub></span></span>, then it
    evaluates the term <span class="inlinecode"><span class="id" title="keyword">if</span></span> <span class="inlinecode"><span class="id" title="var">v<sub>0</sub></span></span> <span class="inlinecode"><span class="id" title="keyword">then</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="keyword">else</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="eval_if_trm" class="idref" href="#eval_if_trm"><span class="id" title="axiom">eval_if_trm</span></a> : <span class="id" title="keyword">∀</span> <a id="s<sub>1</sub>:20" class="idref" href="#s<sub>1</sub>:20"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="s<sub>2</sub>:21" class="idref" href="#s<sub>2</sub>:21"><span class="id" title="binder">s<sub>2</sub></span></a> <a id="s<sub>3</sub>:22" class="idref" href="#s<sub>3</sub>:22"><span class="id" title="binder">s<sub>3</sub></span></a> <a id="v<sub>0</sub>:23" class="idref" href="#v<sub>0</sub>:23"><span class="id" title="binder">v<sub>0</sub></span></a> <a id="v:24" class="idref" href="#v:24"><span class="id" title="binder">v</span></a> <a id="t<sub>0</sub>:25" class="idref" href="#t<sub>0</sub>:25"><span class="id" title="binder">t<sub>0</sub></span></a> <a id="t<sub>1</sub>:26" class="idref" href="#t<sub>1</sub>:26"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:27" class="idref" href="#t<sub>2</sub>:27"><span class="id" title="binder">t<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Rich.html#s<sub>1</sub>:20"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>0</sub>:25"><span class="id" title="variable">t<sub>0</sub></span></a> <a class="idref" href="Rich.html#s<sub>2</sub>:21"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Rich.html#v<sub>0</sub>:23"><span class="id" title="variable">v<sub>0</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Rich.html#s<sub>2</sub>:21"><span class="id" title="variable">s<sub>2</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> <a class="idref" href="Rich.html#v<sub>0</sub>:23"><span class="id" title="variable">v<sub>0</sub></span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:26"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:27"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Rich.html#s<sub>3</sub>:22"><span class="id" title="variable">s<sub>3</sub></span></a> <a class="idref" href="Rich.html#v:24"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Rich.html#s<sub>1</sub>:20"><span class="id" title="variable">s<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> <a class="idref" href="Rich.html#t<sub>0</sub>:25"><span class="id" title="variable">t<sub>0</sub></span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:26"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:27"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Rich.html#s<sub>3</sub>:22"><span class="id" title="variable">s<sub>3</sub></span></a> <a class="idref" href="Rich.html#v:24"><span class="id" title="variable">v</span></a>.<br/>
</div>

<div class="doc">
With respect to this evaluation rule <span class="inlinecode"><span class="id" title="var">eval_if_trm</span></span>, we can prove a
    correpsonding reasoning rule. We first state it in Hoare-logic, then
    in Separation Logic, following the usual proof pattern. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="hoare_if_trm" class="idref" href="#hoare_if_trm"><span class="id" title="lemma">hoare_if_trm</span></a> : <span class="id" title="keyword">∀</span> <a id="Q':29" class="idref" href="#Q':29"><span class="id" title="binder">Q'</span></a> <a id="t<sub>0</sub>:30" class="idref" href="#t<sub>0</sub>:30"><span class="id" title="binder">t<sub>0</sub></span></a> <a id="t<sub>1</sub>:31" class="idref" href="#t<sub>1</sub>:31"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:32" class="idref" href="#t<sub>2</sub>:32"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="H:33" class="idref" href="#H:33"><span class="id" title="binder">H</span></a> <a id="Q:34" class="idref" href="#Q:34"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#hoare"><span class="id" title="definition">hoare</span></a> <a class="idref" href="Rich.html#t<sub>0</sub>:30"><span class="id" title="variable">t<sub>0</sub></span></a> <a class="idref" href="Rich.html#H:33"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q':29"><span class="id" title="variable">Q'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="v:35" class="idref" href="#v:35"><span class="id" title="binder">v</span></a>, <a class="idref" href="LibSepReference.html#hoare"><span class="id" title="definition">hoare</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> <a class="idref" href="Rich.html#v:35"><span class="id" title="variable">v</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:31"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:32"><span class="id" title="variable">t<sub>2</sub></span></a>) (<a class="idref" href="Rich.html#Q':29"><span class="id" title="variable">Q'</span></a> <a class="idref" href="Rich.html#v:35"><span class="id" title="variable">v</span></a>) <a class="idref" href="Rich.html#Q:34"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#hoare"><span class="id" title="definition">hoare</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> <a class="idref" href="Rich.html#t<sub>0</sub>:30"><span class="id" title="variable">t<sub>0</sub></span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:31"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:32"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Rich.html#H:33"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q:34"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">K<sub>1</sub></span>. <span class="id" title="var">lets</span> (<span class="id" title="var">s<sub>2</sub></span>&amp;<span class="id" title="var">v<sub>0</sub></span>&amp;<span class="id" title="var">R<sub>2</sub></span>&amp;<span class="id" title="var">K<sub>2</sub></span>): <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">K<sub>1</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">forwards</span> (<span class="id" title="var">s<sub>3</sub></span>&amp;<span class="id" title="var">v</span>&amp;<span class="id" title="var">R<sub>3</sub></span>&amp;<span class="id" title="var">K<sub>3</sub></span>): <span class="id" title="var">M<sub>2</sub></span> <span class="id" title="var">K<sub>2</sub></span>. <span class="id" title="tactic">∃</span> <span class="id" title="var">s<sub>3</sub></span> <span class="id" title="var">v</span>. <span class="id" title="var">splits</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Rich.html#eval_if_trm"><span class="id" title="axiom">eval_if_trm</span></a> <span class="id" title="var">R<sub>2</sub></span> <span class="id" title="var">R<sub>3</sub></span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <span class="id" title="var">K<sub>3</sub></span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="triple_if_trm" class="idref" href="#triple_if_trm"><span class="id" title="lemma">triple_if_trm</span></a> : <span class="id" title="keyword">∀</span> <a id="Q':36" class="idref" href="#Q':36"><span class="id" title="binder">Q'</span></a> <a id="t<sub>0</sub>:37" class="idref" href="#t<sub>0</sub>:37"><span class="id" title="binder">t<sub>0</sub></span></a> <a id="t<sub>1</sub>:38" class="idref" href="#t<sub>1</sub>:38"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:39" class="idref" href="#t<sub>2</sub>:39"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="H:40" class="idref" href="#H:40"><span class="id" title="binder">H</span></a> <a id="Q:41" class="idref" href="#Q:41"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Rich.html#t<sub>0</sub>:37"><span class="id" title="variable">t<sub>0</sub></span></a> <a class="idref" href="Rich.html#H:40"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q':36"><span class="id" title="variable">Q'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="v:42" class="idref" href="#v:42"><span class="id" title="binder">v</span></a>, <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> <a class="idref" href="Rich.html#v:42"><span class="id" title="variable">v</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:38"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:39"><span class="id" title="variable">t<sub>2</sub></span></a>) (<a class="idref" href="Rich.html#Q':36"><span class="id" title="variable">Q'</span></a> <a class="idref" href="Rich.html#v:42"><span class="id" title="variable">v</span></a>) <a class="idref" href="Rich.html#Q:41"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> <a class="idref" href="Rich.html#t<sub>0</sub>:37"><span class="id" title="variable">t<sub>0</sub></span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:38"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:39"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Rich.html#H:40"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q:41"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">HF</span>. <span class="id" title="var">applys</span> <a class="idref" href="Rich.html#hoare_if_trm"><span class="id" title="lemma">hoare_if_trm</span></a> (<span class="id" title="var">Q'</span> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <span class="id" title="var">HF</span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#hoare_conseq"><span class="id" title="lemma">hoare_conseq</span></a>. <span class="id" title="var">applys</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">HF</span>. { <span class="id" title="var">xsimpl</span>. } { <span class="id" title="var">xsimpl</span>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">v</span>. <span class="id" title="var">applys</span> <span class="id" title="var">M<sub>2</sub></span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The reasoning rule can also be reformulated in weakest-precondition form.
    The rule below generalizes the rule <span class="inlinecode"><span class="id" title="var">wp_if</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_if_trm" class="idref" href="#wp_if_trm"><span class="id" title="lemma">wp_if_trm</span></a> : <span class="id" title="keyword">∀</span> <a id="t<sub>0</sub>:43" class="idref" href="#t<sub>0</sub>:43"><span class="id" title="binder">t<sub>0</sub></span></a> <a id="t<sub>1</sub>:44" class="idref" href="#t<sub>1</sub>:44"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:45" class="idref" href="#t<sub>2</sub>:45"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="Q:46" class="idref" href="#Q:46"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="Rich.html#t<sub>0</sub>:43"><span class="id" title="variable">t<sub>0</sub></span></a> (<span class="id" title="keyword">fun</span> <a id="v:47" class="idref" href="#v:47"><span class="id" title="binder">v</span></a> ⇒ <a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> <a class="idref" href="Rich.html#v:47"><span class="id" title="variable">v</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:44"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:45"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Rich.html#Q:46"><span class="id" title="variable">Q</span></a>) <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> <a class="idref" href="Rich.html#t<sub>0</sub>:43"><span class="id" title="variable">t<sub>0</sub></span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:44"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:45"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Rich.html#Q:46"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a>. <span class="id" title="var">xsimpl</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span> <span class="id" title="var">M</span> <span class="id" title="var">H'</span>. <span class="id" title="var">applys</span> <a class="idref" href="Rich.html#hoare_if_trm"><span class="id" title="lemma">hoare_if_trm</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <span class="id" title="var">M</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">v</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_hexists"><span class="id" title="lemma">hstar_hexists</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#hoare_hexists"><span class="id" title="lemma">hoare_hexists</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">HF</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_comm"><span class="id" title="lemma">hstar_comm</span></a> <span class="id" title="var">HF</span>). <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_assoc"><span class="id" title="lemma">hstar_assoc</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#hoare_hpure"><span class="id" title="lemma">hoare_hpure</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">N</span>. <span class="id" title="var">applys</span> <span class="id" title="var">N</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab432"></a><h2 class="section">Semantics and Basic Evaluation Rules for While-Loops</h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="WhileLoops" class="idref" href="#WhileLoops"><span class="id" title="module">WhileLoops</span></a>.<br/>
</div>

<div class="doc">
Assume the grammar of term to be extended with a loop construct
    <span class="inlinecode"><span class="id" title="var">trm_while</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>, corresponding to the OCaml expression
    <span class="inlinecode"><span class="id" title="var">while</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="tactic">do</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>, and written <span class="inlinecode"><span class="id" title="var">While</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">Do</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">Done</span></span> in our
    example programs. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="WhileLoops.trm_while" class="idref" href="#WhileLoops.trm_while"><span class="id" title="axiom">trm_while</span></a> : <a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <a id="WhileLoops.:trm:trm_scope:'while'_x_'do'_x_'done'" class="idref" href="#WhileLoops.:trm:trm_scope:'while'_x_'do'_x_'done'"><span class="id" title="notation">&quot;</span></a>'while' t<sub>1</sub> 'do' t<sub>2</sub> 'done'" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="Rich.html#WhileLoops.trm_while"><span class="id" title="axiom">trm_while</span></a> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>)<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">trm</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">custom</span> <span class="id" title="var">trm</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">t<sub>2</sub></span> <span class="id" title="var">custom</span> <span class="id" title="var">trm</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">format</span> "'[v' 'while'  t<sub>1</sub>  'do'  '/' '['   t<sub>2</sub> ']' '/'  'done' ']'")<br/>
&nbsp;&nbsp;&nbsp;: <span class="id" title="var">trm_scope</span>.<br/>
</div>

<div class="doc">
The semantics of this loop construct can be described in terms of the
    one-step unfolding of the loop: <span class="inlinecode"><span class="id" title="var">while</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="tactic">do</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> is a term that
    behaves exactly like the term <span class="inlinecode"><span class="id" title="keyword">if</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="keyword">then</span></span> <span class="inlinecode">(<span class="id" title="var">t<sub>2</sub></span>;</span> <span class="inlinecode"><span class="id" title="var">while</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="tactic">do</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span>)</span> <span class="inlinecode"><span class="id" title="keyword">else</span></span> <span class="inlinecode">()</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="WhileLoops.eval_while" class="idref" href="#WhileLoops.eval_while"><span class="id" title="axiom">eval_while</span></a> : <span class="id" title="keyword">∀</span> <a id="s<sub>1</sub>:49" class="idref" href="#s<sub>1</sub>:49"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="s<sub>2</sub>:50" class="idref" href="#s<sub>2</sub>:50"><span class="id" title="binder">s<sub>2</sub></span></a> <a id="t<sub>1</sub>:51" class="idref" href="#t<sub>1</sub>:51"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:52" class="idref" href="#t<sub>2</sub>:52"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="v:53" class="idref" href="#v:53"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Rich.html#s<sub>1</sub>:49"><span class="id" title="variable">s<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:51"><span class="id" title="variable">t<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:52"><span class="id" title="variable">t<sub>2</sub></span></a> (<a class="idref" href="Rich.html#WhileLoops.trm_while"><span class="id" title="axiom">trm_while</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:51"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:52"><span class="id" title="variable">t<sub>2</sub></span></a>)) <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a>) <a class="idref" href="Rich.html#s<sub>2</sub>:50"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Rich.html#v:53"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Rich.html#s<sub>1</sub>:49"><span class="id" title="variable">s<sub>1</sub></span></a> (<a class="idref" href="Rich.html#WhileLoops.trm_while"><span class="id" title="axiom">trm_while</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:51"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:52"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Rich.html#s<sub>2</sub>:50"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Rich.html#v:53"><span class="id" title="variable">v</span></a>.<br/>
</div>

<div class="doc">
This evaluation rule translates directly into a reasoning rule:
    to prove a triple for the term <span class="inlinecode"><span class="id" title="var">while</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="tactic">do</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>, it suffices to
    prove a triple for the term <span class="inlinecode"><span class="id" title="keyword">if</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="keyword">then</span></span> <span class="inlinecode">(<span class="id" title="var">t<sub>2</sub></span>;</span> <span class="inlinecode"><span class="id" title="var">while</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="tactic">do</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span>)</span> <span class="inlinecode"><span class="id" title="keyword">else</span></span> <span class="inlinecode">()</span>.

<div class="paragraph"> </div>

    There is a catch in that reasoning principle, namely the fact that
    the loop <span class="inlinecode"><span class="id" title="var">while</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="tactic">do</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> appears again inside the term
    <span class="inlinecode"><span class="id" title="keyword">if</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="keyword">then</span></span> <span class="inlinecode">(<span class="id" title="var">t<sub>2</sub></span>;</span> <span class="inlinecode"><span class="id" title="var">while</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="tactic">do</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span>)</span> <span class="inlinecode"><span class="id" title="keyword">else</span></span> <span class="inlinecode">()</span>. Nevertheless, this is not
    a problem if the user is carrying out a proof by induction. In that
    case, an induction hypothesis about the behavior of <span class="inlinecode"><span class="id" title="var">while</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="tactic">do</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>
    is available. We show an example proof further on.

<div class="paragraph"> </div>

    For the moment, let us state the reasoning rules. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WhileLoops.hoare_while" class="idref" href="#WhileLoops.hoare_while"><span class="id" title="lemma">hoare_while</span></a> : <span class="id" title="keyword">∀</span> <a id="t<sub>1</sub>:55" class="idref" href="#t<sub>1</sub>:55"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:56" class="idref" href="#t<sub>2</sub>:56"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="H:57" class="idref" href="#H:57"><span class="id" title="binder">H</span></a> <a id="Q:58" class="idref" href="#Q:58"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#hoare"><span class="id" title="definition">hoare</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:55"><span class="id" title="variable">t<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:56"><span class="id" title="variable">t<sub>2</sub></span></a> (<a class="idref" href="Rich.html#WhileLoops.trm_while"><span class="id" title="axiom">trm_while</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:55"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:56"><span class="id" title="variable">t<sub>2</sub></span></a>)) <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a>) <a class="idref" href="Rich.html#H:57"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q:58"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#hoare"><span class="id" title="definition">hoare</span></a> (<a class="idref" href="Rich.html#WhileLoops.trm_while"><span class="id" title="axiom">trm_while</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:55"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:56"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Rich.html#H:57"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q:58"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span> <span class="id" title="var">K</span>. <span class="id" title="var">forwards</span>* (<span class="id" title="var">s'</span>&amp;<span class="id" title="var">v</span>&amp;<span class="id" title="var">R<sub>1</sub></span>&amp;<span class="id" title="var">K<sub>1</sub></span>): <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">s'</span> <span class="id" title="var">v</span>. <span class="id" title="var">splits</span>*. { <span class="id" title="var">applys</span>* <a class="idref" href="Rich.html#WhileLoops.eval_while"><span class="id" title="axiom">eval_while</span></a>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="WhileLoops.triple_while" class="idref" href="#WhileLoops.triple_while"><span class="id" title="lemma">triple_while</span></a> : <span class="id" title="keyword">∀</span> <a id="t<sub>1</sub>:59" class="idref" href="#t<sub>1</sub>:59"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:60" class="idref" href="#t<sub>2</sub>:60"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="H:61" class="idref" href="#H:61"><span class="id" title="binder">H</span></a> <a id="Q:62" class="idref" href="#Q:62"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:59"><span class="id" title="variable">t<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:60"><span class="id" title="variable">t<sub>2</sub></span></a> (<a class="idref" href="Rich.html#WhileLoops.trm_while"><span class="id" title="axiom">trm_while</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:59"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:60"><span class="id" title="variable">t<sub>2</sub></span></a>)) <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a>) <a class="idref" href="Rich.html#H:61"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q:62"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Rich.html#WhileLoops.trm_while"><span class="id" title="axiom">trm_while</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:59"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:60"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Rich.html#H:61"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q:62"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H'</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="Rich.html#WhileLoops.hoare_while"><span class="id" title="lemma">hoare_while</span></a>. <span class="id" title="var">applys</span>* <span class="id" title="var">M</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="WhileLoops.wp_while" class="idref" href="#WhileLoops.wp_while"><span class="id" title="lemma">wp_while</span></a> : <span class="id" title="keyword">∀</span> <a id="t<sub>1</sub>:63" class="idref" href="#t<sub>1</sub>:63"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:64" class="idref" href="#t<sub>2</sub>:64"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="Q:65" class="idref" href="#Q:65"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:63"><span class="id" title="variable">t<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:64"><span class="id" title="variable">t<sub>2</sub></span></a> (<a class="idref" href="Rich.html#WhileLoops.trm_while"><span class="id" title="axiom">trm_while</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:63"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:64"><span class="id" title="variable">t<sub>2</sub></span></a>)) <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a>) <a class="idref" href="Rich.html#Q:65"><span class="id" title="variable">Q</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="Rich.html#WhileLoops.trm_while"><span class="id" title="axiom">trm_while</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:63"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:64"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Rich.html#Q:65"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">unfold</span> <a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a>. <span class="id" title="var">xsimpl</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span> <span class="id" title="var">M</span> <span class="id" title="var">H'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="Rich.html#WhileLoops.hoare_while"><span class="id" title="lemma">hoare_while</span></a>. <span class="id" title="var">applys</span> <span class="id" title="var">M</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab433"></a><h2 class="section">Separation-Logic-friendly Reasoning Rule for While-Loops</h2>

<div class="paragraph"> </div>

 One may be tempted to introduce an invariant-based reasoning rule
    for while loops. Traditional invariant-based rules from Hoare
    logic usually admit a relatively simple statement, because they only
    target partial correctness, and because the termination condition
    is restricted to a simple expression that does not alter the state.

<div class="paragraph"> </div>

    In our set up, targeting total correctness and a construct of the
    form <span class="inlinecode"><span class="id" title="var">trm_while</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>, the invariant-based reasoning rule can
    be stated as shown below.

<div class="paragraph"> </div>

    An invariant <span class="inlinecode"><span class="id" title="var">I</span></span> describes the state at the entry and exit point
    of the loop. This invariant is actually of the form <span class="inlinecode"><span class="id" title="var">I</span></span> <span class="inlinecode"><span class="id" title="var">b</span></span> <span class="inlinecode"><span class="id" title="var">X</span></span>, where
    the boolean value <span class="inlinecode"><span class="id" title="var">b</span></span> is <span class="inlinecode"><span class="id" title="var">false</span></span> to indicate that the loop has terminated,
    and where the value <span class="inlinecode"><span class="id" title="var">X</span></span> belongs to a type <span class="inlinecode"><span class="id" title="var">A</span></span> used to express the
    decreasing measure that justifies the termination of the loop. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WhileLoops.triple_while_inv_not_framable" class="idref" href="#WhileLoops.triple_while_inv_not_framable"><span class="id" title="lemma">triple_while_inv_not_framable</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<a id="A:66" class="idref" href="#A:66"><span class="id" title="binder">A</span></a>:<span class="id" title="keyword">Type</span>) (<a id="I:67" class="idref" href="#I:67"><span class="id" title="binder">I</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="Rich.html#A:66"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) (<a id="R:68" class="idref" href="#R:68"><span class="id" title="binder">R</span></a>:<a class="idref" href="Rich.html#A:66"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="Rich.html#A:66"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><span class="id" title="keyword">Prop</span>) <a id="t<sub>1</sub>:69" class="idref" href="#t<sub>1</sub>:69"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:70" class="idref" href="#t<sub>2</sub>:70"><span class="id" title="binder">t<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<span class="id" title="definition">wf</span> <a class="idref" href="Rich.html#R:68"><span class="id" title="variable">R</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="b:71" class="idref" href="#b:71"><span class="id" title="binder">b</span></a> <a id="X:72" class="idref" href="#X:72"><span class="id" title="binder">X</span></a>, <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:69"><span class="id" title="variable">t<sub>1</sub></span></a> (<a class="idref" href="Rich.html#I:67"><span class="id" title="variable">I</span></a> <a class="idref" href="Rich.html#b:71"><span class="id" title="variable">b</span></a> <a class="idref" href="Rich.html#X:72"><span class="id" title="variable">X</span></a>) (<span class="id" title="keyword">fun</span> <a id="r:73" class="idref" href="#r:73"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="b':74" class="idref" href="#b':74"><span class="id" title="binder">b'</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Rich.html#r:73"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Rich.html#b':74"><span class="id" title="variable">b'</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Rich.html#I:67"><span class="id" title="variable">I</span></a> <a class="idref" href="Rich.html#b':74"><span class="id" title="variable">b'</span></a> <a class="idref" href="Rich.html#X:72"><span class="id" title="variable">X</span></a>)<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="b:75" class="idref" href="#b:75"><span class="id" title="binder">b</span></a> <a id="X:76" class="idref" href="#X:76"><span class="id" title="binder">X</span></a>, <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:70"><span class="id" title="variable">t<sub>2</sub></span></a> (<a class="idref" href="Rich.html#I:67"><span class="id" title="variable">I</span></a> <a class="idref" href="Rich.html#b:75"><span class="id" title="variable">b</span></a> <a class="idref" href="Rich.html#X:76"><span class="id" title="variable">X</span></a>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="b':77" class="idref" href="#b':77"><span class="id" title="binder">b'</span></a> <a id="Y:78" class="idref" href="#Y:78"><span class="id" title="binder">Y</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Rich.html#R:68"><span class="id" title="variable">R</span></a> <a class="idref" href="Rich.html#Y:78"><span class="id" title="variable">Y</span></a> <a class="idref" href="Rich.html#X:76"><span class="id" title="variable">X</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Rich.html#I:67"><span class="id" title="variable">I</span></a> <a class="idref" href="Rich.html#b':77"><span class="id" title="variable">b'</span></a> <a class="idref" href="Rich.html#Y:78"><span class="id" title="variable">Y</span></a>)<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Rich.html#WhileLoops.trm_while"><span class="id" title="axiom">trm_while</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:69"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:70"><span class="id" title="variable">t<sub>2</sub></span></a>) (<a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="b:81" class="idref" href="#b:81"><span class="id" title="binder">b</span></a> <a id="X:82" class="idref" href="#X:82"><span class="id" title="binder">X</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Rich.html#I:67"><span class="id" title="variable">I</span></a> <a class="idref" href="Rich.html#b:81"><span class="id" title="variable">b</span></a> <a class="idref" href="Rich.html#X:82"><span class="id" title="variable">X</span></a>) (<span class="id" title="keyword">fun</span> <a id="r:79" class="idref" href="#r:79"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="Y:80" class="idref" href="#Y:80"><span class="id" title="binder">Y</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Rich.html#I:67"><span class="id" title="variable">I</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="Rich.html#Y:80"><span class="id" title="variable">Y</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">WR</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_hexists"><span class="id" title="lemma">triple_hexists</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_hexists"><span class="id" title="lemma">triple_hexists</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">X</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">gen</span> <span class="id" title="var">b</span>. <span class="id" title="var">induction_wf</span> <span class="id" title="var">IH</span>: <span class="id" title="var">WR</span> <span class="id" title="var">X</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span> <a class="idref" href="Rich.html#WhileLoops.triple_while"><span class="id" title="lemma">triple_while</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="Rich.html#triple_if_trm"><span class="id" title="lemma">triple_if_trm</span></a> (<span class="id" title="keyword">fun</span> (<a id="r:85" class="idref" href="#r:85"><span class="id" title="binder">r</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="b':86" class="idref" href="#b':86"><span class="id" title="binder">b'</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Rich.html#r:83"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Rich.html#b':84"><span class="id" title="variable">b'</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <span class="id" title="var">I</span> <a class="idref" href="Rich.html#b':84"><span class="id" title="variable">b'</span></a> <span class="id" title="var">X</span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <span class="id" title="var">M<sub>1</sub></span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">v</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_hexists"><span class="id" title="lemma">triple_hexists</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">b'</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_hpure"><span class="id" title="lemma">triple_hpure</span></a>. <span class="id" title="tactic">intros</span> →.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_if"><span class="id" title="lemma">triple_if</span></a>. <span class="id" title="var">case_if</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_seq"><span class="id" title="lemma">triple_seq</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <span class="id" title="var">M<sub>2</sub></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_hexists"><span class="id" title="lemma">triple_hexists</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">b''</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_hexists"><span class="id" title="lemma">triple_hexists</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_hpure"><span class="id" title="lemma">triple_hpure</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">HR</span>. <span class="id" title="var">applys</span> <span class="id" title="var">IH</span> <span class="id" title="var">HR</span>. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_val"><span class="id" title="lemma">triple_val</span></a>. <span class="id" title="var">xsimpl</span>. } }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The above rule is correct yet limited, because it precludes the possibility
    to apply the frame rule "over the remaining iterations of the loop".

<div class="paragraph"> </div>

    This possibility can be exploited by carrying a proof by induction and
    invoking the rule <span class="inlinecode"><span class="id" title="var">triple_while</span></span>, which unfolds the loop body. In that
    scheme, the frame rule can be applied to the term <span class="inlinecode"><span class="id" title="var">while</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="tactic">do</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> that
    occurs in the <span class="inlinecode"><span class="id" title="keyword">if</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="keyword">then</span></span> <span class="inlinecode">(<span class="id" title="var">t<sub>2</sub></span>;</span> <span class="inlinecode">(<span class="id" title="var">while</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="tactic">do</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span>))</span> <span class="inlinecode"><span class="id" title="keyword">else</span></span> <span class="inlinecode">()</span>. 
<div class="paragraph"> </div>

 We can reduce the noise associated with applying the rule <span class="inlinecode"><span class="id" title="var">triple_while</span></span>
    by assigning a name, say <span class="inlinecode"><span class="id" title="var">t</span></span>, to denote the term <span class="inlinecode"><span class="id" title="var">while</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="tactic">do</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>.
    The correpsonding rule, shown below, asserts that <span class="inlinecode"><span class="id" title="var">t</span></span> admits the same
    behavior as the term <span class="inlinecode"><span class="id" title="keyword">if</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="keyword">then</span></span> <span class="inlinecode">(<span class="id" title="var">t<sub>2</sub></span>;</span> <span class="inlinecode"><span class="id" title="var">t</span>)</span> <span class="inlinecode"><span class="id" title="keyword">else</span></span> <span class="inlinecode">()</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WhileLoops.triple_while'" class="idref" href="#WhileLoops.triple_while'"><span class="id" title="lemma">triple_while'</span></a> : <span class="id" title="keyword">∀</span> <a id="t<sub>1</sub>:87" class="idref" href="#t<sub>1</sub>:87"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:88" class="idref" href="#t<sub>2</sub>:88"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="H:89" class="idref" href="#H:89"><span class="id" title="binder">H</span></a> <a id="Q:90" class="idref" href="#Q:90"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="t:91" class="idref" href="#t:91"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="H':92" class="idref" href="#H':92"><span class="id" title="binder">H'</span></a> <a id="Q':93" class="idref" href="#Q':93"><span class="id" title="binder">Q'</span></a>, <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:87"><span class="id" title="variable">t<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:88"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="Rich.html#t:91"><span class="id" title="variable">t</span></a>) <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a>) <a class="idref" href="Rich.html#H':92"><span class="id" title="variable">H'</span></a> <a class="idref" href="Rich.html#Q':93"><span class="id" title="variable">Q'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Rich.html#t:91"><span class="id" title="variable">t</span></a> <a class="idref" href="Rich.html#H':92"><span class="id" title="variable">H'</span></a> <a class="idref" href="Rich.html#Q':93"><span class="id" title="variable">Q'</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Rich.html#t:91"><span class="id" title="variable">t</span></a> <a class="idref" href="Rich.html#H:89"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q:90"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Rich.html#WhileLoops.trm_while"><span class="id" title="axiom">trm_while</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:87"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:88"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Rich.html#H:89"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q:90"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <span class="id" title="var">M</span>. <span class="id" title="var">introv</span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span> <a class="idref" href="Rich.html#WhileLoops.triple_while"><span class="id" title="lemma">triple_while</span></a>. <span class="id" title="var">applys</span> <span class="id" title="var">K</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The proof scheme that consists of setting up an induction then applying
    the reasoning rule <span class="inlinecode"><span class="id" title="var">triple_while'</span></span> can be factored into the following lemma,
    which is stated using an invariant that appears only in the precondition.
    The postcondition is an abstract <span class="inlinecode"><span class="id" title="var">Q</span></span>. With this presentation, the rule
    features an "invariant", yet it remains possible to invoke the frame rule
    over the "remaining iterations" of the loop. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WhileLoops.triple_while_inv" class="idref" href="#WhileLoops.triple_while_inv"><span class="id" title="lemma">triple_while_inv</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<a id="A:94" class="idref" href="#A:94"><span class="id" title="binder">A</span></a>:<span class="id" title="keyword">Type</span>) (<a id="I:95" class="idref" href="#I:95"><span class="id" title="binder">I</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="Rich.html#A:94"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) (<a id="R:96" class="idref" href="#R:96"><span class="id" title="binder">R</span></a>:<a class="idref" href="Rich.html#A:94"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="Rich.html#A:94"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><span class="id" title="keyword">Prop</span>) <a id="t<sub>1</sub>:97" class="idref" href="#t<sub>1</sub>:97"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:98" class="idref" href="#t<sub>2</sub>:98"><span class="id" title="binder">t<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="Q:101" class="idref" href="#Q:101"><span class="id" title="binder">Q</span></a> := (<span class="id" title="keyword">fun</span> <a id="r:99" class="idref" href="#r:99"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="Y:100" class="idref" href="#Y:100"><span class="id" title="binder">Y</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Rich.html#I:95"><span class="id" title="variable">I</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="Rich.html#Y:100"><span class="id" title="variable">Y</span></a>) <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" title="definition">wf</span> <a class="idref" href="Rich.html#R:96"><span class="id" title="variable">R</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="t:102" class="idref" href="#t:102"><span class="id" title="binder">t</span></a> <a id="b:103" class="idref" href="#b:103"><span class="id" title="binder">b</span></a> <a id="X:104" class="idref" href="#X:104"><span class="id" title="binder">X</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="b':105" class="idref" href="#b':105"><span class="id" title="binder">b'</span></a> <a id="Y:106" class="idref" href="#Y:106"><span class="id" title="binder">Y</span></a>, <a class="idref" href="Rich.html#R:96"><span class="id" title="variable">R</span></a> <a class="idref" href="Rich.html#Y:106"><span class="id" title="variable">Y</span></a> <a class="idref" href="Rich.html#X:104"><span class="id" title="variable">X</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Rich.html#t:102"><span class="id" title="variable">t</span></a> (<a class="idref" href="Rich.html#I:95"><span class="id" title="variable">I</span></a> <a class="idref" href="Rich.html#b':105"><span class="id" title="variable">b'</span></a> <a class="idref" href="Rich.html#Y:106"><span class="id" title="variable">Y</span></a>) <a class="idref" href="Rich.html#Q:101"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:97"><span class="id" title="variable">t<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:98"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="Rich.html#t:102"><span class="id" title="variable">t</span></a>) <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a>) (<a class="idref" href="Rich.html#I:95"><span class="id" title="variable">I</span></a> <a class="idref" href="Rich.html#b:103"><span class="id" title="variable">b</span></a> <a class="idref" href="Rich.html#X:104"><span class="id" title="variable">X</span></a>) <a class="idref" href="Rich.html#Q:101"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Rich.html#WhileLoops.trm_while"><span class="id" title="axiom">trm_while</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:97"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:98"><span class="id" title="variable">t<sub>2</sub></span></a>) (<a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="b:107" class="idref" href="#b:107"><span class="id" title="binder">b</span></a> <a id="X:108" class="idref" href="#X:108"><span class="id" title="binder">X</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Rich.html#I:95"><span class="id" title="variable">I</span></a> <a class="idref" href="Rich.html#b:107"><span class="id" title="variable">b</span></a> <a class="idref" href="Rich.html#X:108"><span class="id" title="variable">X</span></a>) <a class="idref" href="Rich.html#Q:101"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">WR</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_hexists"><span class="id" title="lemma">triple_hexists</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">b<sub>0</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_hexists"><span class="id" title="lemma">triple_hexists</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">X<sub>0</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">gen</span> <span class="id" title="var">b<sub>0</sub></span>. <span class="id" title="var">induction_wf</span> <span class="id" title="var">IH</span>: <span class="id" title="var">WR</span> <span class="id" title="var">X<sub>0</sub></span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span> <a class="idref" href="Rich.html#WhileLoops.triple_while"><span class="id" title="lemma">triple_while</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">b'</span> <span class="id" title="var">Y</span> <span class="id" title="var">HR'</span>. <span class="id" title="var">applys</span> <span class="id" title="var">IH</span> <span class="id" title="var">HR'</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The rule <span class="inlinecode"><span class="id" title="var">triple_while_inv</span></span> admits a constrained precondition of the form
    <span class="inlinecode">(<span class='gray-font'>\</span><span class="id" title="tactic">∃</span></span> <span class="inlinecode"><span class="id" title="var">b</span></span> <span class="inlinecode"><span class="id" title="var">X</span>,</span> <span class="inlinecode"><span class="id" title="var">I</span></span> <span class="inlinecode"><span class="id" title="var">b</span></span> <span class="inlinecode"><span class="id" title="var">X</span>)</span>. To exploit this rule, one almost always needs
    to first invoke the consequence-frame rule.

<div class="paragraph"> </div>

    The rule <span class="inlinecode"><span class="id" title="var">triple_while_inv_conseq_frame</span></span>, shown below, conveniently bakes in
    frame and consequence rules into the statement of <span class="inlinecode"><span class="id" title="var">triple_while_inv</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WhileLoops.triple_while_inv_conseq_frame" class="idref" href="#WhileLoops.triple_while_inv_conseq_frame"><span class="id" title="lemma">triple_while_inv_conseq_frame</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<a id="A:109" class="idref" href="#A:109"><span class="id" title="binder">A</span></a>:<span class="id" title="keyword">Type</span>) (<a id="I:110" class="idref" href="#I:110"><span class="id" title="binder">I</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="Rich.html#A:109"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) (<a id="R:111" class="idref" href="#R:111"><span class="id" title="binder">R</span></a>:<a class="idref" href="Rich.html#A:109"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="Rich.html#A:109"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><span class="id" title="keyword">Prop</span>) <a id="H':112" class="idref" href="#H':112"><span class="id" title="binder">H'</span></a> <a id="t<sub>1</sub>:113" class="idref" href="#t<sub>1</sub>:113"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:114" class="idref" href="#t<sub>2</sub>:114"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="H:115" class="idref" href="#H:115"><span class="id" title="binder">H</span></a> <a id="Q:116" class="idref" href="#Q:116"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="Q':119" class="idref" href="#Q':119"><span class="id" title="binder">Q'</span></a> := (<span class="id" title="keyword">fun</span> <a id="r:117" class="idref" href="#r:117"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="Y:118" class="idref" href="#Y:118"><span class="id" title="binder">Y</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Rich.html#I:110"><span class="id" title="variable">I</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="Rich.html#Y:118"><span class="id" title="variable">Y</span></a>) <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" title="definition">wf</span> <a class="idref" href="Rich.html#R:111"><span class="id" title="variable">R</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Rich.html#H:115"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="b:120" class="idref" href="#b:120"><span class="id" title="binder">b</span></a> <a id="X:121" class="idref" href="#X:121"><span class="id" title="binder">X</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Rich.html#I:110"><span class="id" title="variable">I</span></a> <a class="idref" href="Rich.html#b:120"><span class="id" title="variable">b</span></a> <a class="idref" href="Rich.html#X:121"><span class="id" title="variable">X</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Rich.html#H':112"><span class="id" title="variable">H'</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="t:122" class="idref" href="#t:122"><span class="id" title="binder">t</span></a> <a id="b:123" class="idref" href="#b:123"><span class="id" title="binder">b</span></a> <a id="X:124" class="idref" href="#X:124"><span class="id" title="binder">X</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="b':125" class="idref" href="#b':125"><span class="id" title="binder">b'</span></a> <a id="Y:126" class="idref" href="#Y:126"><span class="id" title="binder">Y</span></a>, <a class="idref" href="Rich.html#R:111"><span class="id" title="variable">R</span></a> <a class="idref" href="Rich.html#Y:126"><span class="id" title="variable">Y</span></a> <a class="idref" href="Rich.html#X:124"><span class="id" title="variable">X</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Rich.html#t:122"><span class="id" title="variable">t</span></a> (<a class="idref" href="Rich.html#I:110"><span class="id" title="variable">I</span></a> <a class="idref" href="Rich.html#b':125"><span class="id" title="variable">b'</span></a> <a class="idref" href="Rich.html#Y:126"><span class="id" title="variable">Y</span></a>) <a class="idref" href="Rich.html#Q':119"><span class="id" title="variable">Q'</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:113"><span class="id" title="variable">t<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:114"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="Rich.html#t:122"><span class="id" title="variable">t</span></a>) <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a>) (<a class="idref" href="Rich.html#I:110"><span class="id" title="variable">I</span></a> <a class="idref" href="Rich.html#b:123"><span class="id" title="variable">b</span></a> <a class="idref" href="Rich.html#X:124"><span class="id" title="variable">X</span></a>) <a class="idref" href="Rich.html#Q':119"><span class="id" title="variable">Q'</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#Q':119"><span class="id" title="variable">Q'</span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="Rich.html#H':112"><span class="id" title="variable">H'</span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Rich.html#Q:116"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Rich.html#WhileLoops.trm_while"><span class="id" title="axiom">trm_while</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:113"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:114"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Rich.html#H:115"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q:116"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">WR</span> <span class="id" title="var">WH</span> <span class="id" title="var">M</span> <span class="id" title="var">WQ</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_conseq_frame"><span class="id" title="lemma">triple_conseq_frame</span></a> <span class="id" title="var">WH</span> <span class="id" title="var">WQ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="Rich.html#WhileLoops.triple_while_inv"><span class="id" title="lemma">triple_while_inv</span></a> <span class="id" title="var">WR</span> <span class="id" title="var">M</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The above rule can be equivalently reformulated in weakest-precondition
    style. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WhileLoops.wp_while_inv_conseq" class="idref" href="#WhileLoops.wp_while_inv_conseq"><span class="id" title="lemma">wp_while_inv_conseq</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<a id="A:127" class="idref" href="#A:127"><span class="id" title="binder">A</span></a>:<span class="id" title="keyword">Type</span>) (<a id="I:128" class="idref" href="#I:128"><span class="id" title="binder">I</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="Rich.html#A:127"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) (<a id="R:129" class="idref" href="#R:129"><span class="id" title="binder">R</span></a>:<a class="idref" href="Rich.html#A:127"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="Rich.html#A:127"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><span class="id" title="keyword">Prop</span>) <a id="t<sub>1</sub>:130" class="idref" href="#t<sub>1</sub>:130"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:131" class="idref" href="#t<sub>2</sub>:131"><span class="id" title="binder">t<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="Q:134" class="idref" href="#Q:134"><span class="id" title="binder">Q</span></a> := (<span class="id" title="keyword">fun</span> <a id="r:132" class="idref" href="#r:132"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="Y:133" class="idref" href="#Y:133"><span class="id" title="binder">Y</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Rich.html#I:128"><span class="id" title="variable">I</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="Rich.html#Y:133"><span class="id" title="variable">Y</span></a>) <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" title="definition">wf</span> <a class="idref" href="Rich.html#R:129"><span class="id" title="variable">R</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="b:135" class="idref" href="#b:135"><span class="id" title="binder">b</span></a> <a id="X:136" class="idref" href="#X:136"><span class="id" title="binder">X</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Rich.html#I:128"><span class="id" title="variable">I</span></a> <a class="idref" href="Rich.html#b:135"><span class="id" title="variable">b</span></a> <a class="idref" href="Rich.html#X:136"><span class="id" title="variable">X</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><span class="id" title="keyword">∀</span> <a id="t:137" class="idref" href="#t:137"><span class="id" title="binder">t</span></a> <a id="b:138" class="idref" href="#b:138"><span class="id" title="binder">b</span></a> <a id="X:139" class="idref" href="#X:139"><span class="id" title="binder">X</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="b':140" class="idref" href="#b':140"><span class="id" title="binder">b'</span></a> <a id="Y:141" class="idref" href="#Y:141"><span class="id" title="binder">Y</span></a>, <a class="idref" href="Rich.html#R:129"><span class="id" title="variable">R</span></a> <a class="idref" href="Rich.html#Y:141"><span class="id" title="variable">Y</span></a> <a class="idref" href="Rich.html#X:139"><span class="id" title="variable">X</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Rich.html#I:128"><span class="id" title="variable">I</span></a> <a class="idref" href="Rich.html#b':140"><span class="id" title="variable">b'</span></a> <a class="idref" href="Rich.html#Y:141"><span class="id" title="variable">Y</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="Rich.html#t:137"><span class="id" title="variable">t</span></a> <a class="idref" href="Rich.html#Q:134"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Rich.html#I:128"><span class="id" title="variable">I</span></a> <a class="idref" href="Rich.html#b:138"><span class="id" title="variable">b</span></a> <a class="idref" href="Rich.html#X:139"><span class="id" title="variable">X</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:130"><span class="id" title="variable">t<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:131"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="Rich.html#t:137"><span class="id" title="variable">t</span></a>) <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a>) <a class="idref" href="Rich.html#Q:134"><span class="id" title="variable">Q</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="Rich.html#WhileLoops.trm_while"><span class="id" title="axiom">trm_while</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:130"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:131"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Rich.html#Q:134"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">WR</span>. <span class="id" title="var">sets</span> <span class="id" title="var">H</span>: (<a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="b:144" class="idref" href="#b:144"><span class="id" title="binder">b</span></a> <a id="X:145" class="idref" href="#X:145"><span class="id" title="binder">X</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <span class="id" title="var">I</span> <a class="idref" href="Rich.html#b:142"><span class="id" title="variable">b</span></a> <a class="idref" href="Rich.html#X:143"><span class="id" title="variable">X</span></a>). <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="Rich.html#WhileLoops.triple_while_inv"><span class="id" title="lemma">triple_while_inv</span></a> <span class="id" title="var">WR</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">N</span>. <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="LibSepReference.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="var">applys</span> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">HR</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="var">applys</span> <span class="id" title="var">N</span> <span class="id" title="var">HR</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab434"></a><h1 class="section">More Details</h1>

</div>

<div class="doc">
<a id="lab435"></a><h2 class="section">Semantics and Basic Evaluation Rules for For-Loops</h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="WhileLoops.ForLoops" class="idref" href="#WhileLoops.ForLoops"><span class="id" title="module">ForLoops</span></a>.<br/>
</div>

<div class="doc">
In the previous section, we have focused on while loops and presented
    encodings, evaluation rules, and reasoning rules. In this section, we
    present a similar construction for for-loops.

<div class="paragraph"> </div>

    A for loop takes the form <span class="inlinecode"><span class="id" title="var">trm_for</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">n<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">n<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>3</sub></span></span>, matching the OCaml
    syntax <span class="inlinecode"><span class="id" title="keyword">for</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">n<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">to</span></span> <span class="inlinecode"><span class="id" title="var">n<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="tactic">do</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>3</sub></span></span> <span class="inlinecode"><span class="id" title="var">done</span></span>. We assume the bounds <span class="inlinecode"><span class="id" title="var">n<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">n<sub>2</sub></span></span>
    to be already evaluated to integers---i.e., we assume A-normal form. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="WhileLoops.ForLoops.trm_for" class="idref" href="#WhileLoops.ForLoops.trm_for"><span class="id" title="axiom">trm_for</span></a> : <a class="idref" href="LibSepVar.html#var"><span class="id" title="definition">var</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <a id="3d7ae2baa46f5721e7c17d2dea3b7a<sub>54</sub>" class="idref" href="#3d7ae2baa46f5721e7c17d2dea3b7a<sub>54</sub>"><span class="id" title="notation">&quot;</span></a>'for' x '=' t<sub>1</sub> 'to' t<sub>2</sub> 'do' t<sub>3</sub> 'done'" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="Rich.html#WhileLoops.ForLoops.trm_for"><span class="id" title="axiom">trm_for</span></a> <span class="id" title="var">x</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="var">t<sub>3</sub></span>)<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">trm</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">x</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">custom</span> <span class="id" title="var">trm</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">t<sub>2</sub></span> <span class="id" title="var">custom</span> <span class="id" title="var">trm</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">t<sub>3</sub></span> <span class="id" title="var">custom</span> <span class="id" title="var">trm</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">format</span> "'[v' 'for'  x  '='  t<sub>1</sub>  'to'  t<sub>2</sub>  'do'  '/' '['   t<sub>3</sub> ']' '/'  'done' ']'")<br/>
&nbsp;&nbsp;&nbsp;: <span class="id" title="var">trm_scope</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Close</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">trm_scope</span>.<br/>
</div>

<div class="doc">
The semantics of <span class="inlinecode"><span class="id" title="keyword">for</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">n<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">to</span></span> <span class="inlinecode"><span class="id" title="var">n<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="tactic">do</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>3</sub></span></span> is encoded using a conditional.
    If <span class="inlinecode"><span class="id" title="var">n<sub>1</sub></span></span> <span class="inlinecode">≤</span> <span class="inlinecode"><span class="id" title="var">n<sub>2</sub></span></span>, then we execute the body <span class="inlinecode"><span class="id" title="var">t<sub>3</sub></span></span> with <span class="inlinecode"><span class="id" title="var">x</span></span> bound to <span class="inlinecode"><span class="id" title="var">n<sub>1</sub></span></span> (that
    is, <span class="inlinecode"><span class="id" title="tactic">subst</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">n<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>3</sub></span></span>), and continue with the remainig iterations, which are
    described by <span class="inlinecode"><span class="id" title="keyword">for</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">n<sub>1</sub></span>+1</span> <span class="inlinecode"><span class="id" title="var">to</span></span> <span class="inlinecode"><span class="id" title="var">n<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="tactic">do</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>3</sub></span></span> <span class="inlinecode"><span class="id" title="var">done</span></span>. Eventually, we reach a
    situation where <span class="inlinecode"><span class="id" title="var">n<sub>1</sub></span></span> <span class="inlinecode">&gt;</span> <span class="inlinecode"><span class="id" title="var">n<sub>2</sub></span></span>. At this point, the loop terminates, and returns
    the unit value. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="WhileLoops.ForLoops.eval_for" class="idref" href="#WhileLoops.ForLoops.eval_for"><span class="id" title="axiom">eval_for</span></a> : <span class="id" title="keyword">∀</span> <a id="s<sub>1</sub>:147" class="idref" href="#s<sub>1</sub>:147"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="s<sub>2</sub>:148" class="idref" href="#s<sub>2</sub>:148"><span class="id" title="binder">s<sub>2</sub></span></a> <a id="x:149" class="idref" href="#x:149"><span class="id" title="binder">x</span></a> <a id="n<sub>1</sub>:150" class="idref" href="#n<sub>1</sub>:150"><span class="id" title="binder">n<sub>1</sub></span></a> <a id="n<sub>2</sub>:151" class="idref" href="#n<sub>2</sub>:151"><span class="id" title="binder">n<sub>2</sub></span></a> <a id="t<sub>3</sub>:152" class="idref" href="#t<sub>3</sub>:152"><span class="id" title="binder">t<sub>3</sub></span></a> <a id="v:153" class="idref" href="#v:153"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Rich.html#s<sub>1</sub>:147"><span class="id" title="variable">s<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> (<a class="idref" href="LibSepReference.html#val_le"><span class="id" title="constructor">val_le</span></a> <a class="idref" href="Rich.html#n<sub>1</sub>:150"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Rich.html#n<sub>2</sub>:151"><span class="id" title="variable">n<sub>2</sub></span></a>) (<a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="Rich.html#x:149"><span class="id" title="variable">x</span></a> <a class="idref" href="Rich.html#n<sub>1</sub>:150"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>3</sub>:152"><span class="id" title="variable">t<sub>3</sub></span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Rich.html#WhileLoops.ForLoops.trm_for"><span class="id" title="axiom">trm_for</span></a> <a class="idref" href="Rich.html#x:149"><span class="id" title="variable">x</span></a> (<a class="idref" href="Rich.html#n<sub>1</sub>:150"><span class="id" title="variable">n<sub>1</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1) <a class="idref" href="Rich.html#n<sub>2</sub>:151"><span class="id" title="variable">n<sub>2</sub></span></a> <a class="idref" href="Rich.html#t<sub>3</sub>:152"><span class="id" title="variable">t<sub>3</sub></span></a>)) <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a>) <a class="idref" href="Rich.html#s<sub>2</sub>:148"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Rich.html#v:153"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Rich.html#s<sub>1</sub>:147"><span class="id" title="variable">s<sub>1</sub></span></a> (<a class="idref" href="Rich.html#WhileLoops.ForLoops.trm_for"><span class="id" title="axiom">trm_for</span></a> <a class="idref" href="Rich.html#x:149"><span class="id" title="variable">x</span></a> <a class="idref" href="Rich.html#n<sub>1</sub>:150"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Rich.html#n<sub>2</sub>:151"><span class="id" title="variable">n<sub>2</sub></span></a> <a class="idref" href="Rich.html#t<sub>3</sub>:152"><span class="id" title="variable">t<sub>3</sub></span></a>) <a class="idref" href="Rich.html#s<sub>2</sub>:148"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Rich.html#v:153"><span class="id" title="variable">v</span></a>.<br/>
</div>

<div class="doc">
The direct reasoning rules for for-loops w.r.t. Hoare triples and
    Separation Logic triples simply unfold the encoding. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WhileLoops.ForLoops.hoare_for" class="idref" href="#WhileLoops.ForLoops.hoare_for"><span class="id" title="lemma">hoare_for</span></a> : <span class="id" title="keyword">∀</span> <a id="x:155" class="idref" href="#x:155"><span class="id" title="binder">x</span></a> <a id="n<sub>1</sub>:156" class="idref" href="#n<sub>1</sub>:156"><span class="id" title="binder">n<sub>1</sub></span></a> <a id="n<sub>2</sub>:157" class="idref" href="#n<sub>2</sub>:157"><span class="id" title="binder">n<sub>2</sub></span></a> <a id="t<sub>3</sub>:158" class="idref" href="#t<sub>3</sub>:158"><span class="id" title="binder">t<sub>3</sub></span></a> <a id="H:159" class="idref" href="#H:159"><span class="id" title="binder">H</span></a> <a id="Q:160" class="idref" href="#Q:160"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#hoare"><span class="id" title="definition">hoare</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> (<a class="idref" href="LibSepReference.html#val_le"><span class="id" title="constructor">val_le</span></a> <a class="idref" href="Rich.html#n<sub>1</sub>:156"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Rich.html#n<sub>2</sub>:157"><span class="id" title="variable">n<sub>2</sub></span></a>) (<a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="Rich.html#x:155"><span class="id" title="variable">x</span></a> <a class="idref" href="Rich.html#n<sub>1</sub>:156"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>3</sub>:158"><span class="id" title="variable">t<sub>3</sub></span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Rich.html#WhileLoops.ForLoops.trm_for"><span class="id" title="axiom">trm_for</span></a> <a class="idref" href="Rich.html#x:155"><span class="id" title="variable">x</span></a> (<a class="idref" href="Rich.html#n<sub>1</sub>:156"><span class="id" title="variable">n<sub>1</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1) <a class="idref" href="Rich.html#n<sub>2</sub>:157"><span class="id" title="variable">n<sub>2</sub></span></a> <a class="idref" href="Rich.html#t<sub>3</sub>:158"><span class="id" title="variable">t<sub>3</sub></span></a>)) <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a>) <a class="idref" href="Rich.html#H:159"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q:160"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#hoare"><span class="id" title="definition">hoare</span></a> (<a class="idref" href="Rich.html#WhileLoops.ForLoops.trm_for"><span class="id" title="axiom">trm_for</span></a> <a class="idref" href="Rich.html#x:155"><span class="id" title="variable">x</span></a> <a class="idref" href="Rich.html#n<sub>1</sub>:156"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Rich.html#n<sub>2</sub>:157"><span class="id" title="variable">n<sub>2</sub></span></a> <a class="idref" href="Rich.html#t<sub>3</sub>:158"><span class="id" title="variable">t<sub>3</sub></span></a>) <a class="idref" href="Rich.html#H:159"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q:160"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span> <span class="id" title="var">K</span>. <span class="id" title="var">forwards</span>* (<span class="id" title="var">s'</span>&amp;<span class="id" title="var">v</span>&amp;<span class="id" title="var">R<sub>1</sub></span>&amp;<span class="id" title="var">K<sub>1</sub></span>): <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">s'</span> <span class="id" title="var">v</span>. <span class="id" title="var">splits</span>*. { <span class="id" title="var">applys</span>* <a class="idref" href="Rich.html#WhileLoops.ForLoops.eval_for"><span class="id" title="axiom">eval_for</span></a>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="WhileLoops.ForLoops.triple_for" class="idref" href="#WhileLoops.ForLoops.triple_for"><span class="id" title="lemma">triple_for</span></a> : <span class="id" title="keyword">∀</span> <a id="x:161" class="idref" href="#x:161"><span class="id" title="binder">x</span></a> <a id="n<sub>1</sub>:162" class="idref" href="#n<sub>1</sub>:162"><span class="id" title="binder">n<sub>1</sub></span></a> <a id="n<sub>2</sub>:163" class="idref" href="#n<sub>2</sub>:163"><span class="id" title="binder">n<sub>2</sub></span></a> <a id="t<sub>3</sub>:164" class="idref" href="#t<sub>3</sub>:164"><span class="id" title="binder">t<sub>3</sub></span></a> <a id="H:165" class="idref" href="#H:165"><span class="id" title="binder">H</span></a> <a id="Q:166" class="idref" href="#Q:166"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> (<a class="idref" href="LibSepReference.html#val_le"><span class="id" title="constructor">val_le</span></a> <a class="idref" href="Rich.html#n<sub>1</sub>:162"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Rich.html#n<sub>2</sub>:163"><span class="id" title="variable">n<sub>2</sub></span></a>) (<a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="Rich.html#x:161"><span class="id" title="variable">x</span></a> <a class="idref" href="Rich.html#n<sub>1</sub>:162"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>3</sub>:164"><span class="id" title="variable">t<sub>3</sub></span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Rich.html#WhileLoops.ForLoops.trm_for"><span class="id" title="axiom">trm_for</span></a> <a class="idref" href="Rich.html#x:161"><span class="id" title="variable">x</span></a> (<a class="idref" href="Rich.html#n<sub>1</sub>:162"><span class="id" title="variable">n<sub>1</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1) <a class="idref" href="Rich.html#n<sub>2</sub>:163"><span class="id" title="variable">n<sub>2</sub></span></a> <a class="idref" href="Rich.html#t<sub>3</sub>:164"><span class="id" title="variable">t<sub>3</sub></span></a>)) <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a>) <a class="idref" href="Rich.html#H:165"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q:166"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Rich.html#WhileLoops.ForLoops.trm_for"><span class="id" title="axiom">trm_for</span></a> <a class="idref" href="Rich.html#x:161"><span class="id" title="variable">x</span></a> <a class="idref" href="Rich.html#n<sub>1</sub>:162"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Rich.html#n<sub>2</sub>:163"><span class="id" title="variable">n<sub>2</sub></span></a> <a class="idref" href="Rich.html#t<sub>3</sub>:164"><span class="id" title="variable">t<sub>3</sub></span></a>) <a class="idref" href="Rich.html#H:165"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q:166"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H'</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="Rich.html#WhileLoops.ForLoops.hoare_for"><span class="id" title="lemma">hoare_for</span></a>. <span class="id" title="var">applys</span>* <span class="id" title="var">M</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Just like for while loops, we can reduce the noise associated with applying
    the rule <span class="inlinecode"><span class="id" title="var">triple_for</span></span>, by pre-processing the encoding based on the
    conditional. This rule may be useful for carrying out proofs by induction.

<div class="paragraph"> </div>

    Follow carefully through the proof, as it exhibits reasoning patterns that
    are useful for the follow-up exercises. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WhileLoops.ForLoops.triple_for'" class="idref" href="#WhileLoops.ForLoops.triple_for'"><span class="id" title="lemma">triple_for'</span></a> : <span class="id" title="keyword">∀</span> <a id="x:167" class="idref" href="#x:167"><span class="id" title="binder">x</span></a> <a id="n<sub>1</sub>:168" class="idref" href="#n<sub>1</sub>:168"><span class="id" title="binder">n<sub>1</sub></span></a> <a id="n<sub>2</sub>:169" class="idref" href="#n<sub>2</sub>:169"><span class="id" title="binder">n<sub>2</sub></span></a> <a id="t<sub>3</sub>:170" class="idref" href="#t<sub>3</sub>:170"><span class="id" title="binder">t<sub>3</sub></span></a> <a id="H:171" class="idref" href="#H:171"><span class="id" title="binder">H</span></a> <a id="Q:172" class="idref" href="#Q:172"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> (<a id="tloop:173" class="idref" href="#tloop:173"><span class="id" title="binder">tloop</span></a>:<span class="id" title="notation">int</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>) (<a id="n:174" class="idref" href="#n:174"><span class="id" title="binder">n</span></a>:<span class="id" title="notation">int</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="i:175" class="idref" href="#i:175"><span class="id" title="binder">i</span></a> <a id="H':176" class="idref" href="#H':176"><span class="id" title="binder">H'</span></a> <a id="Q':177" class="idref" href="#Q':177"><span class="id" title="binder">Q'</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="notation">If</span> <a class="idref" href="Rich.html#i:175"><span class="id" title="variable">i</span></a> <span class="id" title="notation">≤</span> <a class="idref" href="Rich.html#n<sub>2</sub>:169"><span class="id" title="variable">n<sub>2</sub></span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">then</span> <span class="id" title="notation">(</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">∃</span></a> <a id="H<sub>1</sub>:178" class="idref" href="#H<sub>1</sub>:178"><span class="id" title="binder">H<sub>1</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Rich.html#x:167"><span class="id" title="variable">x</span></a> <a class="idref" href="Rich.html#i:175"><span class="id" title="variable">i</span></a> <a class="idref" href="Rich.html#t<sub>3</sub>:170"><span class="id" title="variable">t<sub>3</sub></span></a>) <a class="idref" href="Rich.html#H':176"><span class="id" title="variable">H'</span></a> (<span class="id" title="keyword">fun</span> <a id="v:179" class="idref" href="#v:179"><span class="id" title="binder">v</span></a> ⇒ <a class="idref" href="Rich.html#H<sub>1</sub>:178"><span class="id" title="variable">H<sub>1</sub></span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Rich.html#tloop:173"><span class="id" title="variable">tloop</span></a> (<a class="idref" href="Rich.html#i:175"><span class="id" title="variable">i</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1)) <a class="idref" href="Rich.html#H<sub>1</sub>:178"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Rich.html#Q':177"><span class="id" title="variable">Q'</span></a><span class="id" title="notation">)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">else</span> <span class="id" title="notation">(</span><a class="idref" href="Rich.html#H':176"><span class="id" title="variable">H'</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Rich.html#Q':177"><span class="id" title="variable">Q'</span></a> <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a><span class="id" title="notation">)</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Rich.html#tloop:173"><span class="id" title="variable">tloop</span></a> <a class="idref" href="Rich.html#i:175"><span class="id" title="variable">i</span></a>) <a class="idref" href="Rich.html#H':176"><span class="id" title="variable">H'</span></a> <a class="idref" href="Rich.html#Q':177"><span class="id" title="variable">Q'</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Rich.html#tloop:173"><span class="id" title="variable">tloop</span></a> <a class="idref" href="Rich.html#n:174"><span class="id" title="variable">n</span></a>) <a class="idref" href="Rich.html#H:171"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q:172"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Rich.html#WhileLoops.ForLoops.trm_for"><span class="id" title="axiom">trm_for</span></a> <a class="idref" href="Rich.html#x:167"><span class="id" title="variable">x</span></a> <a class="idref" href="Rich.html#n<sub>1</sub>:168"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Rich.html#n<sub>2</sub>:169"><span class="id" title="variable">n<sub>2</sub></span></a> <a class="idref" href="Rich.html#t<sub>3</sub>:170"><span class="id" title="variable">t<sub>3</sub></span></a>) <a class="idref" href="Rich.html#H:171"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q:172"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <span class="id" title="var">M</span> (<span class="id" title="keyword">fun</span> <a id="n:181" class="idref" href="#n:181"><span class="id" title="binder">n</span></a> ⇒ <a class="idref" href="Rich.html#WhileLoops.ForLoops.trm_for"><span class="id" title="axiom">trm_for</span></a> <span class="id" title="var">x</span> <a class="idref" href="Rich.html#n:180"><span class="id" title="variable">n</span></a> <span class="id" title="var">n<sub>2</sub></span> <span class="id" title="var">t<sub>3</sub></span>). <span class="id" title="var">introv</span> <span class="id" title="var">K</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="Rich.html#WhileLoops.ForLoops.triple_for"><span class="id" title="lemma">triple_for</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="Rich.html#triple_if_trm"><span class="id" title="lemma">triple_if_trm</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_conseq_frame"><span class="id" title="lemma">triple_conseq_frame</span></a> <a class="idref" href="LibSepReference.html#triple_le"><span class="id" title="lemma">triple_le</span></a>. <span class="id" title="var">xsimpl</span>. <span class="id" title="var">xsimpl</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">v</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_hpure"><span class="id" title="lemma">triple_hpure</span></a>. <span class="id" title="tactic">intros</span> →. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_if"><span class="id" title="lemma">triple_if</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="var">case_if</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [ <span class="id" title="var">false</span>; <span class="id" title="var">math</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">forwards</span> (<span class="id" title="var">H<sub>1</sub></span>&amp;<span class="id" title="var">K<sub>1</sub></span>&amp;<span class="id" title="var">K<sub>2</sub></span>):<span class="id" title="var">K</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_seq"><span class="id" title="lemma">triple_seq</span></a> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_let_val"><span class="id" title="lemma">triple_let_val</span></a>. <span class="id" title="var">applys</span> <span class="id" title="var">K<sub>1</sub></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <span class="id" title="var">K<sub>2</sub></span>. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_val"><span class="id" title="lemma">triple_val</span></a>. <span class="id" title="var">applys</span> <span class="id" title="var">K</span>. } }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
We can derive a simpler rule for the case of loops with no iterations. 
<div class="paragraph"> </div>

<a id="lab436"></a><h4 class="section">Exercise: 4 stars, standard, optional (triple_for_ge)</h4>
 Prove the specification of for loops in the case where the lower bound
    of the loop exceeds the upper bound of the loop.
    Hint: the proof shares similarities with that of <span class="inlinecode"><span class="id" title="var">triple_for'</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WhileLoops.ForLoops.triple_for_ge" class="idref" href="#WhileLoops.ForLoops.triple_for_ge"><span class="id" title="lemma">triple_for_ge</span></a> : <span class="id" title="keyword">∀</span> <a id="x:182" class="idref" href="#x:182"><span class="id" title="binder">x</span></a> <a id="n<sub>1</sub>:183" class="idref" href="#n<sub>1</sub>:183"><span class="id" title="binder">n<sub>1</sub></span></a> <a id="n<sub>2</sub>:184" class="idref" href="#n<sub>2</sub>:184"><span class="id" title="binder">n<sub>2</sub></span></a> <a id="t<sub>3</sub>:185" class="idref" href="#t<sub>3</sub>:185"><span class="id" title="binder">t<sub>3</sub></span></a> <a id="H:186" class="idref" href="#H:186"><span class="id" title="binder">H</span></a> <a id="Q:187" class="idref" href="#Q:187"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#n<sub>1</sub>:183"><span class="id" title="variable">n<sub>1</sub></span></a> <span class="id" title="notation">&gt;</span> <a class="idref" href="Rich.html#n<sub>2</sub>:184"><span class="id" title="variable">n<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#H:186"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Rich.html#Q:187"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Rich.html#WhileLoops.ForLoops.trm_for"><span class="id" title="axiom">trm_for</span></a> <a class="idref" href="Rich.html#x:182"><span class="id" title="variable">x</span></a> <a class="idref" href="Rich.html#n<sub>1</sub>:183"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Rich.html#n<sub>2</sub>:184"><span class="id" title="variable">n<sub>2</sub></span></a> <a class="idref" href="Rich.html#t<sub>3</sub>:185"><span class="id" title="variable">t<sub>3</sub></span></a>) <a class="idref" href="Rich.html#H:186"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q:187"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 We can derive an reasoning rule expressed using a loop invariant: if <span class="inlinecode"><span class="id" title="var">I</span></span> <span class="inlinecode"><span class="id" title="var">n<sub>1</sub></span></span>
    holds before the loop, and each iteration takes the state from <span class="inlinecode"><span class="id" title="var">I</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> to
    <span class="inlinecode"><span class="id" title="var">I</span></span> <span class="inlinecode">(<span class="id" title="var">i</span>+1)</span>, then <span class="inlinecode"><span class="id" title="var">I</span></span> <span class="inlinecode">(<span class="id" title="var">n<sub>2</sub></span>+1)</span> holds after the last iteration. The benefits
    of this presentation, compared with <span class="inlinecode"><span class="id" title="var">triple_for'</span></span>, is that it bakes in the
    application of the induction principle. 
<div class="paragraph"> </div>

<a id="lab437"></a><h4 class="section">Exercise: 5 stars, standard, especially useful (triple_for_inv_conseq_frame)</h4>
 Prove the invariant-based reasoning rule for for-loops.
    Hint: the proof shares similarities with that of <span class="inlinecode"><span class="id" title="var">triple_for'</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WhileLoops.ForLoops.triple_for_inv_conseq_frame" class="idref" href="#WhileLoops.ForLoops.triple_for_inv_conseq_frame"><span class="id" title="lemma">triple_for_inv_conseq_frame</span></a> : <span class="id" title="keyword">∀</span> (<a id="I:188" class="idref" href="#I:188"><span class="id" title="binder">I</span></a>:<span class="id" title="notation">int</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) <a id="H':189" class="idref" href="#H':189"><span class="id" title="binder">H'</span></a> <a id="x:190" class="idref" href="#x:190"><span class="id" title="binder">x</span></a> <a id="n<sub>1</sub>:191" class="idref" href="#n<sub>1</sub>:191"><span class="id" title="binder">n<sub>1</sub></span></a> <a id="n<sub>2</sub>:192" class="idref" href="#n<sub>2</sub>:192"><span class="id" title="binder">n<sub>2</sub></span></a> <a id="t<sub>3</sub>:193" class="idref" href="#t<sub>3</sub>:193"><span class="id" title="binder">t<sub>3</sub></span></a> <a id="H:194" class="idref" href="#H:194"><span class="id" title="binder">H</span></a> <a id="Q:195" class="idref" href="#Q:195"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#n<sub>1</sub>:191"><span class="id" title="variable">n<sub>1</sub></span></a> <span class="id" title="notation">≤</span> <a class="idref" href="Rich.html#n<sub>2</sub>:192"><span class="id" title="variable">n<sub>2</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Rich.html#H:194"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Rich.html#I:188"><span class="id" title="variable">I</span></a> <a class="idref" href="Rich.html#n<sub>1</sub>:191"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Rich.html#H':189"><span class="id" title="variable">H'</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="i:196" class="idref" href="#i:196"><span class="id" title="binder">i</span></a>, <a class="idref" href="Rich.html#n<sub>1</sub>:191"><span class="id" title="variable">n<sub>1</sub></span></a> <span class="id" title="notation">≤</span> <a class="idref" href="Rich.html#i:196"><span class="id" title="variable">i</span></a> <span class="id" title="notation">≤</span> <a class="idref" href="Rich.html#n<sub>2</sub>:192"><span class="id" title="variable">n<sub>2</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Rich.html#x:190"><span class="id" title="variable">x</span></a> <a class="idref" href="Rich.html#i:196"><span class="id" title="variable">i</span></a> <a class="idref" href="Rich.html#t<sub>3</sub>:193"><span class="id" title="variable">t<sub>3</sub></span></a>) (<a class="idref" href="Rich.html#I:188"><span class="id" title="variable">I</span></a> <a class="idref" href="Rich.html#i:196"><span class="id" title="variable">i</span></a>) (<span class="id" title="keyword">fun</span> <a id="u:197" class="idref" href="#u:197"><span class="id" title="binder">u</span></a> ⇒ <a class="idref" href="Rich.html#I:188"><span class="id" title="variable">I</span></a> (<a class="idref" href="Rich.html#i:196"><span class="id" title="variable">i</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1))<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">(</span></a><span class="id" title="keyword">fun</span> <a id="v:198" class="idref" href="#v:198"><span class="id" title="binder">v</span></a> ⇒ <a class="idref" href="Rich.html#I:188"><span class="id" title="variable">I</span></a> (<a class="idref" href="Rich.html#n<sub>2</sub>:192"><span class="id" title="variable">n<sub>2</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1) <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Rich.html#H':189"><span class="id" title="variable">H'</span></a><a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Rich.html#Q:195"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Rich.html#WhileLoops.ForLoops.trm_for"><span class="id" title="axiom">trm_for</span></a> <a class="idref" href="Rich.html#x:190"><span class="id" title="variable">x</span></a> <a class="idref" href="Rich.html#n<sub>1</sub>:191"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Rich.html#n<sub>2</sub>:192"><span class="id" title="variable">n<sub>2</sub></span></a> <a class="idref" href="Rich.html#t<sub>3</sub>:193"><span class="id" title="variable">t<sub>3</sub></span></a>) <a class="idref" href="Rich.html#H:194"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q:195"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<span class="id" title="keyword">End</span> <a class="idref" href="Rich.html#WhileLoops.ForLoops"><span class="id" title="module">ForLoops</span></a>.<br/>
</div>

<div class="doc">
<a id="lab438"></a><h2 class="section">Treatment of Generalized Conditionals and Loops in <span class="inlinecode"><span class="id" title="var">wpgen</span></span></h2>

</div>
<div class="code">

<span class="id" title="keyword">Close</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">wp_scope</span>.<br/>
</div>

<div class="doc">
The formula generator <span class="inlinecode"><span class="id" title="var">wpgen</span></span> may be extended to take into account
    the generalized form <span class="inlinecode"><span class="id" title="keyword">if</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>0</sub></span></span> <span class="inlinecode"><span class="id" title="keyword">then</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="keyword">else</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>. The corresponding formula is
    <span class="inlinecode"><span class="id" title="var">wpgen_let</span></span> <span class="inlinecode">(<span class="id" title="var">aux</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>0</sub></span>)</span> <span class="inlinecode">(<span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">mkstruct</span></span> <span class="inlinecode">(<span class="id" title="var">wpgen_if</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode">(<span class="id" title="var">aux</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span>)</span> <span class="inlinecode">(<span class="id" title="var">aux</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span>))</span>,
    where <span class="inlinecode"><span class="id" title="var">wpgen_let</span></span> is used to compute the <span class="inlinecode"><span class="id" title="var">wpgen</span></span> of the argument of the
    conditional, and where <span class="inlinecode"><span class="id" title="var">wpgen_if</span></span> is used to compute the <span class="inlinecode"><span class="id" title="var">wpgen</span></span> of a
    conditional with a argument already evaluated to a value.

<div class="paragraph"> </div>

    This pattern is captured by the auxiliary definition <span class="inlinecode"><span class="id" title="var">wpgen_if_trm</span></span>.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">wpgen</span> (<span class="id" title="var">E</span>:<span class="id" title="var">ctx</span>) (<span class="id" title="var">t</span>:<span class="id" title="var">trm</span>) : <span class="id" title="var">hprop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mkstruct</span> <span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">trm_if</span> <span class="id" title="var">t<sub>0</sub></span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> ⇒ <span class="id" title="var">wpgen_if_trm</span> (<span class="id" title="var">wpgen</span> <span class="id" title="var">t<sub>0</sub></span>) (<span class="id" title="var">wpgen</span> <span class="id" title="var">t<sub>1</sub></span>) (<span class="id" title="var">wpgen</span> <span class="id" title="var">t<sub>2</sub></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...
</span>    where <span class="inlinecode"><span class="id" title="var">wpgen_if_trm</span></span> is defined as shown below. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="WhileLoops.wpgen_if_trm" class="idref" href="#WhileLoops.wpgen_if_trm"><span class="id" title="definition">wpgen_if_trm</span></a> (<a id="F<sub>0</sub>:199" class="idref" href="#F<sub>0</sub>:199"><span class="id" title="binder">F<sub>0</sub></span></a> <a id="F<sub>1</sub>:200" class="idref" href="#F<sub>1</sub>:200"><span class="id" title="binder">F<sub>1</sub></span></a> <a id="F<sub>2</sub>:201" class="idref" href="#F<sub>2</sub>:201"><span class="id" title="binder">F<sub>2</sub></span></a>:<a class="idref" href="LibSepReference.html#formula"><span class="id" title="definition">formula</span></a>) : <a class="idref" href="LibSepReference.html#formula"><span class="id" title="definition">formula</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#wpgen_let"><span class="id" title="definition">wpgen_let</span></a> <a class="idref" href="Rich.html#F<sub>0</sub>:199"><span class="id" title="variable">F<sub>0</sub></span></a> (<span class="id" title="keyword">fun</span> <a id="v:202" class="idref" href="#v:202"><span class="id" title="binder">v</span></a> ⇒ <a class="idref" href="LibSepReference.html#mkstruct"><span class="id" title="definition">mkstruct</span></a> (<a class="idref" href="LibSepReference.html#wpgen_if"><span class="id" title="definition">wpgen_if</span></a> <a class="idref" href="Rich.html#v:202"><span class="id" title="variable">v</span></a> <a class="idref" href="Rich.html#F<sub>1</sub>:200"><span class="id" title="variable">F<sub>1</sub></span></a> <a class="idref" href="Rich.html#F<sub>2</sub>:201"><span class="id" title="variable">F<sub>2</sub></span></a>)).<br/>
</div>

<div class="doc">
The soundness of this extension of <span class="inlinecode"><span class="id" title="var">wpgen</span></span> is captured by the
    following lemma. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WhileLoops.wpgen_if_trm_sound" class="idref" href="#WhileLoops.wpgen_if_trm_sound"><span class="id" title="lemma">wpgen_if_trm_sound</span></a> : <span class="id" title="keyword">∀</span> <a id="F<sub>0</sub>:203" class="idref" href="#F<sub>0</sub>:203"><span class="id" title="binder">F<sub>0</sub></span></a> <a id="F<sub>1</sub>:204" class="idref" href="#F<sub>1</sub>:204"><span class="id" title="binder">F<sub>1</sub></span></a> <a id="F<sub>2</sub>:205" class="idref" href="#F<sub>2</sub>:205"><span class="id" title="binder">F<sub>2</sub></span></a> <a id="t<sub>0</sub>:206" class="idref" href="#t<sub>0</sub>:206"><span class="id" title="binder">t<sub>0</sub></span></a> <a id="t<sub>1</sub>:207" class="idref" href="#t<sub>1</sub>:207"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:208" class="idref" href="#t<sub>2</sub>:208"><span class="id" title="binder">t<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> <a class="idref" href="Rich.html#t<sub>0</sub>:206"><span class="id" title="variable">t<sub>0</sub></span></a> <a class="idref" href="Rich.html#F<sub>0</sub>:203"><span class="id" title="variable">F<sub>0</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:207"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#F<sub>1</sub>:204"><span class="id" title="variable">F<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:208"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="Rich.html#F<sub>2</sub>:205"><span class="id" title="variable">F<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> <a class="idref" href="Rich.html#t<sub>0</sub>:206"><span class="id" title="variable">t<sub>0</sub></span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:207"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:208"><span class="id" title="variable">t<sub>2</sub></span></a>) (<a class="idref" href="Rich.html#WhileLoops.wpgen_if_trm"><span class="id" title="definition">wpgen_if_trm</span></a> <a class="idref" href="Rich.html#F<sub>0</sub>:203"><span class="id" title="variable">F<sub>0</sub></span></a> <a class="idref" href="Rich.html#F<sub>1</sub>:204"><span class="id" title="variable">F<sub>1</sub></span></a> <a class="idref" href="Rich.html#F<sub>2</sub>:205"><span class="id" title="variable">F<sub>2</sub></span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">S<sub>0</sub></span> <span class="id" title="var">S<sub>1</sub></span> <span class="id" title="var">S<sub>2</sub></span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Rich.html#WhileLoops.wpgen_if_trm"><span class="id" title="definition">wpgen_if_trm</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="LibSepReference.html#wpgen_let"><span class="id" title="definition">wpgen_let</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans"><span class="id" title="lemma">himpl_trans</span></a> <span class="id" title="var">S<sub>0</sub></span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans"><span class="id" title="lemma">himpl_trans</span></a>; [ | <span class="id" title="var">applys</span> <a class="idref" href="Rich.html#wp_if_trm"><span class="id" title="lemma">wp_if_trm</span></a> ].<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#wp_conseq"><span class="id" title="lemma">wp_conseq</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">v</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#mkstruct_sound"><span class="id" title="lemma">mkstruct_sound</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Q'</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#wpgen_if_sound"><span class="id" title="lemma">wpgen_if_sound</span></a> <span class="id" title="var">S<sub>1</sub></span> <span class="id" title="var">S<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
To handle while loops in <span class="inlinecode"><span class="id" title="var">wpgen</span></span>, we introduce the auxiliary
    definition <span class="inlinecode"><span class="id" title="var">wpgen_while</span></span>.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">wpgen</span> (<span class="id" title="var">E</span>:<span class="id" title="var">ctx</span>) (<span class="id" title="var">t</span>:<span class="id" title="var">trm</span>) : <span class="id" title="var">hprop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mkstruct</span> <span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">trm_while</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> ⇒ <span class="id" title="var">wpgen_while</span> (<span class="id" title="var">wpgen</span> <span class="id" title="var">t<sub>1</sub></span>) (<span class="id" title="var">wpgen</span> <span class="id" title="var">t<sub>2</sub></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...
</span>  The definition of <span class="inlinecode"><span class="id" title="var">wpgen_while</span></span> quantifies over an abstract formula <span class="inlinecode"><span class="id" title="var">F</span></span>,
  while denotes the behavior of the while loop. The weakest precondition
  for the loop w.r.t. postcondition <span class="inlinecode"><span class="id" title="var">Q</span></span> is described as <span class="inlinecode"><span class="id" title="var">F</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>, or, more
  precisely <span class="inlinecode"><span class="id" title="var">mkstruct</span></span> <span class="inlinecode"><span class="id" title="var">F</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>, to keep track of the fact that <span class="inlinecode"><span class="id" title="var">F</span></span> denotes a
  formula on which one may apply any structural reasoning rule.

<div class="paragraph"> </div>

  To establish that <span class="inlinecode"><span class="id" title="var">mkstruct</span></span> <span class="inlinecode"><span class="id" title="var">F</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> is entailed by the heap predicate that
  describes the current state, the user is provided with an assumption:
  the fact that <span class="inlinecode"><span class="id" title="var">mkstruct</span></span> <span class="inlinecode"><span class="id" title="var">F</span></span> <span class="inlinecode"><span class="id" title="var">Q'</span></span> can be proved from the weakest precondition
  of the term <span class="inlinecode"><span class="id" title="keyword">if</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="keyword">then</span></span> <span class="inlinecode">(<span class="id" title="var">t<sub>2</sub></span>;</span> <span class="inlinecode"><span class="id" title="var">t<sub>3</sub></span>)</span> <span class="inlinecode"><span class="id" title="keyword">else</span></span> <span class="inlinecode">()</span>, where the weakest precondition
  of <span class="inlinecode"><span class="id" title="var">t<sub>3</sub></span></span>, which denotes the recursive call to the loop, is described by <span class="inlinecode"><span class="id" title="var">F</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="WhileLoops.wpgen_while" class="idref" href="#WhileLoops.wpgen_while"><span class="id" title="definition">wpgen_while</span></a> (<a id="F<sub>1</sub>:209" class="idref" href="#F<sub>1</sub>:209"><span class="id" title="binder">F<sub>1</sub></span></a> <a id="F<sub>2</sub>:210" class="idref" href="#F<sub>2</sub>:210"><span class="id" title="binder">F<sub>2</sub></span></a>:<a class="idref" href="LibSepReference.html#formula"><span class="id" title="definition">formula</span></a>) : <a class="idref" href="LibSepReference.html#formula"><span class="id" title="definition">formula</span></a> := <span class="id" title="keyword">fun</span> <a id="Q:211" class="idref" href="#Q:211"><span class="id" title="binder">Q</span></a> ⇒<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">∀</span></a> <a id="F:212" class="idref" href="#F:212"><span class="id" title="binder">F</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><span class="id" title="keyword">∀</span> <a id="Q':213" class="idref" href="#Q':213"><span class="id" title="binder">Q'</span></a>,     <a class="idref" href="LibSepReference.html#mkstruct"><span class="id" title="definition">mkstruct</span></a> (<a class="idref" href="Rich.html#WhileLoops.wpgen_if_trm"><span class="id" title="definition">wpgen_if_trm</span></a> <a class="idref" href="Rich.html#F<sub>1</sub>:209"><span class="id" title="variable">F<sub>1</sub></span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#mkstruct"><span class="id" title="definition">mkstruct</span></a> (<a class="idref" href="LibSepReference.html#wpgen_seq"><span class="id" title="definition">wpgen_seq</span></a> <a class="idref" href="Rich.html#F<sub>2</sub>:210"><span class="id" title="variable">F<sub>2</sub></span></a> (<a class="idref" href="LibSepReference.html#mkstruct"><span class="id" title="definition">mkstruct</span></a> <a class="idref" href="Rich.html#F:212"><span class="id" title="variable">F</span></a>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#mkstruct"><span class="id" title="definition">mkstruct</span></a> (<a class="idref" href="LibSepReference.html#wpgen_val"><span class="id" title="definition">wpgen_val</span></a> <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a>))) <a class="idref" href="Rich.html#Q':213"><span class="id" title="variable">Q'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#mkstruct"><span class="id" title="definition">mkstruct</span></a> <a class="idref" href="Rich.html#F:212"><span class="id" title="variable">F</span></a> <a class="idref" href="Rich.html#Q':213"><span class="id" title="variable">Q'</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#mkstruct"><span class="id" title="definition">mkstruct</span></a> <a class="idref" href="Rich.html#F:212"><span class="id" title="variable">F</span></a> <a class="idref" href="Rich.html#Q:211"><span class="id" title="variable">Q</span></a><a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">)</span></a>.<br/>
</div>

<div class="doc">
Let us axiomatize the fact that <span class="inlinecode"><span class="id" title="var">wpgen</span></span> is generalized to handle the new
    term construct <span class="inlinecode"><span class="id" title="var">trm_while</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="WhileLoops.wpgen_while_eq" class="idref" href="#WhileLoops.wpgen_while_eq"><span class="id" title="axiom">wpgen_while_eq</span></a> : <span class="id" title="keyword">∀</span> <a id="E:214" class="idref" href="#E:214"><span class="id" title="binder">E</span></a> <a id="t<sub>1</sub>:215" class="idref" href="#t<sub>1</sub>:215"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:216" class="idref" href="#t<sub>2</sub>:216"><span class="id" title="binder">t<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#wpgen"><span class="id" title="definition">wpgen</span></a> <a class="idref" href="Rich.html#E:214"><span class="id" title="variable">E</span></a> (<a class="idref" href="Rich.html#WhileLoops.trm_while"><span class="id" title="axiom">trm_while</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:215"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:216"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#mkstruct"><span class="id" title="definition">mkstruct</span></a> (<a class="idref" href="Rich.html#WhileLoops.wpgen_while"><span class="id" title="definition">wpgen_while</span></a> (<a class="idref" href="LibSepReference.html#wpgen"><span class="id" title="definition">wpgen</span></a> <a class="idref" href="Rich.html#E:214"><span class="id" title="variable">E</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:215"><span class="id" title="variable">t<sub>1</sub></span></a>) (<a class="idref" href="LibSepReference.html#wpgen"><span class="id" title="definition">wpgen</span></a> <a class="idref" href="Rich.html#E:214"><span class="id" title="variable">E</span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:216"><span class="id" title="variable">t<sub>2</sub></span></a>)).<br/>
</div>

<div class="doc">
The soundness proof of <span class="inlinecode"><span class="id" title="var">wpgen</span></span> with respect to the treatment of
    while-loops goes as follows. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WhileLoops.wpgen_while_sound" class="idref" href="#WhileLoops.wpgen_while_sound"><span class="id" title="lemma">wpgen_while_sound</span></a> : <span class="id" title="keyword">∀</span> <a id="t<sub>1</sub>:218" class="idref" href="#t<sub>1</sub>:218"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:219" class="idref" href="#t<sub>2</sub>:219"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="F<sub>1</sub>:220" class="idref" href="#F<sub>1</sub>:220"><span class="id" title="binder">F<sub>1</sub></span></a> <a id="F<sub>2</sub>:221" class="idref" href="#F<sub>2</sub>:221"><span class="id" title="binder">F<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:218"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#F<sub>1</sub>:220"><span class="id" title="variable">F<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:219"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="Rich.html#F<sub>2</sub>:221"><span class="id" title="variable">F<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a class="idref" href="Rich.html#WhileLoops.trm_while"><span class="id" title="axiom">trm_while</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:218"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:219"><span class="id" title="variable">t<sub>2</sub></span></a>) (<a class="idref" href="Rich.html#WhileLoops.wpgen_while"><span class="id" title="definition">wpgen_while</span></a> <a class="idref" href="Rich.html#F<sub>1</sub>:220"><span class="id" title="variable">F<sub>1</sub></span></a> <a class="idref" href="Rich.html#F<sub>2</sub>:221"><span class="id" title="variable">F<sub>2</sub></span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">S<sub>1</sub></span> <span class="id" title="var">S<sub>2</sub></span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span>. <span class="id" title="var">unfolds</span> <a class="idref" href="Rich.html#WhileLoops.wpgen_while"><span class="id" title="definition">wpgen_while</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_hforall_l"><span class="id" title="lemma">himpl_hforall_l</span></a> (<a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="Rich.html#WhileLoops.trm_while"><span class="id" title="axiom">trm_while</span></a> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>)).<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans"><span class="id" title="lemma">himpl_trans</span></a>. 2:{ <span class="id" title="tactic">rewrite</span>* &lt;- <a class="idref" href="LibSepReference.html#mkstruct_wp"><span class="id" title="lemma">mkstruct_wp</span></a>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hwand_hpure_l"><span class="id" title="lemma">hwand_hpure_l</span></a>. { <span class="id" title="tactic">auto</span>. } <span class="id" title="tactic">intros</span> <span class="id" title="var">Q'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#mkstruct_monotone"><span class="id" title="lemma">mkstruct_monotone</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Q''</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans"><span class="id" title="lemma">himpl_trans</span></a>. 2:{ <span class="id" title="var">applys</span> <a class="idref" href="Rich.html#WhileLoops.wp_while"><span class="id" title="lemma">wp_while</span></a>. }<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans"><span class="id" title="lemma">himpl_trans</span></a>.<br/>
&nbsp;&nbsp;2:{ <span class="id" title="var">applys</span> <a class="idref" href="Rich.html#WhileLoops.wpgen_if_trm_sound"><span class="id" title="lemma">wpgen_if_trm_sound</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <span class="id" title="var">S<sub>1</sub></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#mkstruct_sound"><span class="id" title="lemma">mkstruct_sound</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#wpgen_seq_sound"><span class="id" title="lemma">wpgen_seq_sound</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <span class="id" title="var">S<sub>2</sub></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#mkstruct_sound"><span class="id" title="lemma">mkstruct_sound</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#wp_sound"><span class="id" title="lemma">wp_sound</span></a>. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#mkstruct_sound"><span class="id" title="lemma">mkstruct_sound</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#wpgen_val_sound"><span class="id" title="lemma">wpgen_val_sound</span></a>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">auto</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab439"></a><h2 class="section">Notation and Tactics for Manipulating While-Loops</h2>

<div class="paragraph"> </div>

 The associated piece of notation for displaying characteristic formulae
    are defined as follows. 
</div>
<div class="code">

<span class="id" title="keyword">Notation</span> <a id="WhileLoops.:wp:wp_scope:'If_trm'_x_'Then'_x_'Else'_x" class="idref" href="#WhileLoops.:wp:wp_scope:'If_trm'_x_'Then'_x_'Else'_x"><span class="id" title="notation">&quot;</span></a>'If_trm' F<sub>0</sub> 'Then' F<sub>1</sub> 'Else' F<sub>2</sub>" :=<br/>
&nbsp;&nbsp;((<a class="idref" href="Rich.html#WhileLoops.wpgen_if_trm"><span class="id" title="definition">wpgen_if_trm</span></a> <span class="id" title="var">F<sub>0</sub></span> <span class="id" title="var">F<sub>1</sub></span> <span class="id" title="var">F<sub>2</sub></span>))<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">wp</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 69) : <span class="id" title="var">wp_scope</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="var">Declare</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">wpgen_scope</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <a id="WhileLoops.:wp:wp_scope:'While'_x_'Do'_x_'Done'" class="idref" href="#WhileLoops.:wp:wp_scope:'While'_x_'Do'_x_'Done'"><span class="id" title="notation">&quot;</span></a>'While' F<sub>1</sub> 'Do' F<sub>2</sub> 'Done'" :=<br/>
&nbsp;&nbsp;((<a class="idref" href="Rich.html#WhileLoops.wpgen_while"><span class="id" title="definition">wpgen_while</span></a> <span class="id" title="var">F<sub>1</sub></span> <span class="id" title="var">F<sub>2</sub></span>))<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">wp</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 69, <span class="id" title="var">F<sub>2</sub></span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 68,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">format</span> "'[v' 'While'  F<sub>1</sub>  'Do'  '/' '['   F<sub>2</sub> ']' '/' 'Done' ']'")<br/>
&nbsp;&nbsp;&nbsp;: <span class="id" title="var">wp_scope</span>.<br/>
</div>

<div class="doc">
The tactic <span class="inlinecode"><span class="id" title="var">xapply</span></span> is useful for applying an assumption of the form
    <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">mkstruct</span></span> <span class="inlinecode"><span class="id" title="var">F</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> to a goal of the form <span class="inlinecode"><span class="id" title="var">H'</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">mkstruct</span></span> <span class="inlinecode"><span class="id" title="var">F</span></span> <span class="inlinecode"><span class="id" title="var">Q'</span></span>,
    with the ramified frame rule relating <span class="inlinecode"><span class="id" title="var">H</span></span>, <span class="inlinecode"><span class="id" title="var">H'</span></span>, <span class="inlinecode"><span class="id" title="var">Q</span></span> and <span class="inlinecode"><span class="id" title="var">Q'</span></span>.
    In essence, <span class="inlinecode"><span class="id" title="var">xapply</span></span> applies an hypothesis "modulo consequence-frame". 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WhileLoops.mkstruct_apply" class="idref" href="#WhileLoops.mkstruct_apply"><span class="id" title="lemma">mkstruct_apply</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:222" class="idref" href="#H<sub>1</sub>:222"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:223" class="idref" href="#H<sub>2</sub>:223"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="F:224" class="idref" href="#F:224"><span class="id" title="binder">F</span></a> <a id="Q<sub>1</sub>:225" class="idref" href="#Q<sub>1</sub>:225"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:226" class="idref" href="#Q<sub>2</sub>:226"><span class="id" title="binder">Q<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#H<sub>1</sub>:222"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#mkstruct"><span class="id" title="definition">mkstruct</span></a> <a class="idref" href="Rich.html#F:224"><span class="id" title="variable">F</span></a> <a class="idref" href="Rich.html#Q<sub>1</sub>:225"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#H<sub>2</sub>:223"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Rich.html#H<sub>1</sub>:222"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Rich.html#Q<sub>1</sub>:225"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#5609a52f091556b9923d5758aa61f543"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="LibSepReference.html#HS.protect"><span class="id" title="definition">protect</span></a> <a class="idref" href="Rich.html#Q<sub>2</sub>:226"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#H<sub>2</sub>:223"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#mkstruct"><span class="id" title="definition">mkstruct</span></a> <a class="idref" href="Rich.html#F:224"><span class="id" title="variable">F</span></a> <a class="idref" href="Rich.html#Q<sub>2</sub>:226"><span class="id" title="variable">Q<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="var">xchange</span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="var">xchange</span> <span class="id" title="var">M<sub>1</sub></span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#mkstruct_ramified"><span class="id" title="lemma">mkstruct_ramified</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Tactic Notation</span> "xapply" <span class="id" title="keyword">constr</span>(<span class="id" title="var">E</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="Rich.html#WhileLoops.mkstruct_apply"><span class="id" title="lemma">mkstruct_apply</span></a>; [ <span class="id" title="var">applys</span> <span class="id" title="var">E</span> | <span class="id" title="var">xsimpl</span>; <span class="id" title="tactic">unfold</span> <a class="idref" href="LibSepReference.html#HS.protect"><span class="id" title="definition">protect</span></a> ].<br/>
</div>

<div class="doc">
The tactic <span class="inlinecode"><span class="id" title="var">xwhile</span></span> is useful for reasoning about a while-loop.
    In essence, the tactic <span class="inlinecode"><span class="id" title="var">while</span></span> applies the reasoning rule <span class="inlinecode"><span class="id" title="var">wp_while</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WhileLoops.xwhile_lemma" class="idref" href="#WhileLoops.xwhile_lemma"><span class="id" title="lemma">xwhile_lemma</span></a> : <span class="id" title="keyword">∀</span> <a id="F<sub>1</sub>:227" class="idref" href="#F<sub>1</sub>:227"><span class="id" title="binder">F<sub>1</sub></span></a> <a id="F<sub>2</sub>:228" class="idref" href="#F<sub>2</sub>:228"><span class="id" title="binder">F<sub>2</sub></span></a> <a id="H:229" class="idref" href="#H:229"><span class="id" title="binder">H</span></a> <a id="Q:230" class="idref" href="#Q:230"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="F:231" class="idref" href="#F:231"><span class="id" title="binder">F</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="Q':232" class="idref" href="#Q':232"><span class="id" title="binder">Q'</span></a>, <a class="idref" href="LibSepReference.html#mkstruct"><span class="id" title="definition">mkstruct</span></a> (<a class="idref" href="Rich.html#WhileLoops.wpgen_if_trm"><span class="id" title="definition">wpgen_if_trm</span></a> <a class="idref" href="Rich.html#F<sub>1</sub>:227"><span class="id" title="variable">F<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#mkstruct"><span class="id" title="definition">mkstruct</span></a> (<a class="idref" href="LibSepReference.html#wpgen_seq"><span class="id" title="definition">wpgen_seq</span></a> <a class="idref" href="Rich.html#F<sub>2</sub>:228"><span class="id" title="variable">F<sub>2</sub></span></a> (<a class="idref" href="LibSepReference.html#mkstruct"><span class="id" title="definition">mkstruct</span></a> <a class="idref" href="Rich.html#F:231"><span class="id" title="variable">F</span></a>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#mkstruct"><span class="id" title="definition">mkstruct</span></a> (<a class="idref" href="LibSepReference.html#wpgen_val"><span class="id" title="definition">wpgen_val</span></a> <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a>))) <a class="idref" href="Rich.html#Q':232"><span class="id" title="variable">Q'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#mkstruct"><span class="id" title="definition">mkstruct</span></a> <a class="idref" href="Rich.html#F:231"><span class="id" title="variable">F</span></a> <a class="idref" href="Rich.html#Q':232"><span class="id" title="variable">Q'</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Rich.html#H:229"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#mkstruct"><span class="id" title="definition">mkstruct</span></a> <a class="idref" href="Rich.html#F:231"><span class="id" title="variable">F</span></a> <a class="idref" href="Rich.html#Q:230"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#H:229"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#mkstruct"><span class="id" title="definition">mkstruct</span></a> (<a class="idref" href="Rich.html#WhileLoops.wpgen_while"><span class="id" title="definition">wpgen_while</span></a> <a class="idref" href="Rich.html#F<sub>1</sub>:227"><span class="id" title="variable">F<sub>1</sub></span></a> <a class="idref" href="Rich.html#F<sub>2</sub>:228"><span class="id" title="variable">F<sub>2</sub></span></a>) <a class="idref" href="Rich.html#Q:230"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans"><span class="id" title="lemma">himpl_trans</span></a>. 2:{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#mkstruct_erase"><span class="id" title="lemma">mkstruct_erase</span></a>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Rich.html#WhileLoops.wpgen_while"><span class="id" title="definition">wpgen_while</span></a>. <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">F</span> <span class="id" title="var">N</span>. <span class="id" title="var">applys</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <span class="id" title="var">N</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Tactic Notation</span> "xwhile" :=<br/>
&nbsp;&nbsp;<span class="id" title="var">xseq_xlet_if_needed</span>; <span class="id" title="var">applys</span> <a class="idref" href="Rich.html#WhileLoops.xwhile_lemma"><span class="id" title="lemma">xwhile_lemma</span></a>.<br/>
</div>

<div class="doc">
Note: a similar construction could be set up for dealing with for loops. 
</div>

<div class="doc">
<a id="lab440"></a><h2 class="section">Example of the Application of Frame During Loop Iterations</h2>

</div>
<div class="code">

<span class="id" title="keyword">Section</span> <a id="WhileLoops.DemoLoopFrame" class="idref" href="#WhileLoops.DemoLoopFrame"><span class="id" title="section">DemoLoopFrame</span></a>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ProgramSyntax</span> <span class="id" title="var">Basic</span> <span class="id" title="var">Repr</span>.<br/>
<span class="id" title="keyword">Global Opaque</span> <a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a>.<br/>
</div>

<div class="doc">
Consider the following function, which computes the length of a linked
    list with head at location <span class="inlinecode"><span class="id" title="var">p</span></span>, using a while loop and a reference named
    <span class="inlinecode"><span class="id" title="var">a</span></span> to count the number of cells being traversed.

<div class="paragraph"> </div>

<span class="inlinecode-ocaml">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">mlength_loop</span> <span class="id" title="var">p</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">a</span> = <span class="id" title="var">ref</span> 0 <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">r</span> = <span class="id" title="var">ref</span> <span class="id" title="var">p</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> !<span class="id" title="var">r</span> != <span class="id" title="var">null</span> <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">incr</span> <span class="id" title="var">a</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">r</span> := (!<span class="id" title="var">r</span>).<span class="id" title="var">tail</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">done</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">n</span> = !<span class="id" title="var">a</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">free</span> <span class="id" title="var">a</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">free</span> <span class="id" title="var">r</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">n</span>
</span>
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="WhileLoops.mlength_loop" class="idref" href="#WhileLoops.mlength_loop"><span class="id" title="definition">mlength_loop</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''a'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''a'"><span class="id" title="notation">a</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:'ref'"><span class="id" title="notation">ref</span></a> 0 <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''r'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''r'"><span class="id" title="notation">r</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:'ref'"><span class="id" title="notation">ref</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Rich.html#WhileLoops.:trm:trm_scope:'while'_x_'do'_x_'done'"><span class="id" title="notation">while</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#27f9d9ef09cb3e20c393642accbfc5d<sub>1</sub>"><span class="id" title="notation">!</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''r'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''r'"><span class="id" title="notation">r</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a> <a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a><a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">)</span></a> <a class="idref" href="Rich.html#WhileLoops.:trm:trm_scope:'while'_x_'do'_x_'done'"><span class="id" title="notation">do</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Basic.html#incr"><span class="id" title="definition">incr</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''a'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''a'"><span class="id" title="notation">a</span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#27f9d9ef09cb3e20c393642accbfc5d<sub>1</sub>"><span class="id" title="notation">!</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''r'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''r'"><span class="id" title="notation">r</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">q</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#8e45340a54d108624916002b0e01c7ee"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#tail"><span class="id" title="definition">tail</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''r'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''r'"><span class="id" title="notation">r</span></a> <a class="idref" href="LibSepReference.html#e0633f114fcb17e965cb872e30ce07a<sub>5</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">q</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Rich.html#WhileLoops.:trm:trm_scope:'while'_x_'do'_x_'done'"><span class="id" title="notation">done</span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#27f9d9ef09cb3e20c393642accbfc5d<sub>1</sub>"><span class="id" title="notation">!</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''a'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''a'"><span class="id" title="notation">a</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'free'"><span class="id" title="notation">free</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''a'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''a'"><span class="id" title="notation">a</span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'free'"><span class="id" title="notation">free</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''r'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''r'"><span class="id" title="notation">r</span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
This function is specified and verified as follows. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WhileLoops.triple_mlength_loop" class="idref" href="#WhileLoops.triple_mlength_loop"><span class="id" title="lemma">triple_mlength_loop</span></a> : <span class="id" title="keyword">∀</span> <a id="L:233" class="idref" href="#L:233"><span class="id" title="binder">L</span></a> <a id="p:234" class="idref" href="#p:234"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Rich.html#WhileLoops.mlength_loop"><span class="id" title="definition">mlength_loop</span></a> <a class="idref" href="Rich.html#p:234"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Rich.html#L:233"><span class="id" title="variable">L</span></a> <a class="idref" href="Rich.html#p:234"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:235" class="idref" href="#r:235"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Rich.html#r:235"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Rich.html#L:233"><span class="id" title="variable">L</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Rich.html#L:233"><span class="id" title="variable">L</span></a> <a class="idref" href="Rich.html#p:234"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
</div>

<div class="doc">
Let's compute the weakest precondition and pretend that
    <span class="inlinecode"><span class="id" title="var">xwpgen</span></span> includes support for loops. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="var">xwp</span>. <span class="id" title="var">xapp</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>. <span class="id" title="var">xapp</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">r</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="Rich.html#WhileLoops.wpgen_while_eq"><span class="id" title="axiom">wpgen_while_eq</span></a>. <span class="id" title="var">xwp_simpl</span>.<br/>
</div>

<div class="doc">
We call the <span class="inlinecode"><span class="id" title="var">xwhile</span></span> tactic to handle the loop.
    The formula <span class="inlinecode"><span class="id" title="var">F</span></span> then denotes "the behavior of the loop". 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="var">xwhile</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">F</span> <span class="id" title="var">HF</span>.<br/>
</div>

<div class="doc">
We next state the induction principle for the loop, in the
    form <span class="inlinecode"><span class="id" title="var">I</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">F</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>, where <span class="inlinecode"><span class="id" title="var">I</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> denotes the loop invariant,
    and <span class="inlinecode"><span class="id" title="var">Q</span></span> describes the final output of the loop. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="var">asserts</span> <span class="id" title="var">KF</span>: (<span class="id" title="keyword">∀</span> <a id="p:238" class="idref" href="#p:238"><span class="id" title="binder">p</span></a> <a id="n:239" class="idref" href="#n:239"><span class="id" title="binder">n</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">r</span> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Rich.html#p:236"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <span class="id" title="var">a</span> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Rich.html#n:237"><span class="id" title="variable">n</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <span class="id" title="var">L</span> <a class="idref" href="Rich.html#p:236"><span class="id" title="variable">p</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#mkstruct"><span class="id" title="definition">mkstruct</span></a> <span class="id" title="var">F</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">r</span> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <span class="id" title="var">a</span> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">(</span></a><span class="id" title="definition">length</span> <span class="id" title="var">L</span> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="Rich.html#n:237"><span class="id" title="variable">n</span></a><a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <span class="id" title="var">L</span> <a class="idref" href="Rich.html#p:236"><span class="id" title="variable">p</span></a>)).<br/>
</div>

<div class="doc">
We carry out a proof by induction on the length of the list <span class="inlinecode"><span class="id" title="var">L</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;{ <span class="id" title="var">induction_wf</span> <span class="id" title="var">IH</span>: <span class="id" title="inductive">list_sub</span> <span class="id" title="var">L</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans"><span class="id" title="lemma">himpl_trans</span></a> <span class="id" title="var">HF</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">HF</span>. <span class="id" title="var">xlet</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xapp</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xchange</span> <a class="idref" href="Repr.html#MList_if"><span class="id" title="lemma">MList_if</span></a>. <span class="id" title="var">xif</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">C</span>; <span class="id" title="var">case_if</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">q</span> <span class="id" title="var">L'</span> →. <span class="id" title="var">xseq</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xapp</span>.<br/>
</div>

<div class="doc">
At this point, we reason about the recursive call.
    We use the tactic <span class="inlinecode"><span class="id" title="var">xapply</span></span> to apply the induction
    hypothesis modulo the frame rule. Here, the head cell
    of the list is framed out over the scope of the recursive
    call, which operates only on the tail of the list. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xapply</span> (<span class="id" title="var">IH</span> <span class="id" title="var">L'</span>). { <span class="id" title="tactic">auto</span>. } <span class="id" title="tactic">intros</span> <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xchange</span> &lt;- <a class="idref" href="Repr.html#MList_cons"><span class="id" title="lemma">MList_cons</span></a>. { <span class="id" title="var">xsimpl</span>. <span class="id" title="var">rew_list</span>. <span class="id" title="var">math</span>. }  }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> →. <span class="id" title="var">xval</span>. <span class="id" title="var">xsimpl</span>. { <span class="id" title="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="var">xchange</span>* &lt;- (<a class="idref" href="Repr.html#MList_nil"><span class="id" title="lemma">MList_nil</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a>). } }<br/>
&nbsp;&nbsp;<span class="id" title="var">xapply</span> <span class="id" title="var">KF</span>. <span class="id" title="var">xpull</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xval</span>. <span class="id" title="var">xsimpl</span>. <span class="id" title="var">math</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="Rich.html#WhileLoops.DemoLoopFrame"><span class="id" title="section">DemoLoopFrame</span></a>.<br/>
</div>

<div class="doc">
<a id="lab441"></a><h2 class="section">Reasoning Rule for Loops in an Affine Logic</h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="WhileLoops.LoopRuleAffine" class="idref" href="#WhileLoops.LoopRuleAffine"><span class="id" title="module">LoopRuleAffine</span></a>.<br/>
</div>

<div class="doc">
Recall from <span class="inlinecode"><span class="id" title="var">Affine</span></span> the combined structural rule that includes
    the affine top predicate <span class="inlinecode">\<span class="id" title="var">GC</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="WhileLoops.LoopRuleAffine.triple_conseq_frame_hgc" class="idref" href="#WhileLoops.LoopRuleAffine.triple_conseq_frame_hgc"><span class="id" title="axiom">triple_conseq_frame_hgc</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>2</sub>:240" class="idref" href="#H<sub>2</sub>:240"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="H<sub>1</sub>:241" class="idref" href="#H<sub>1</sub>:241"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="Q<sub>1</sub>:242" class="idref" href="#Q<sub>1</sub>:242"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="t:243" class="idref" href="#t:243"><span class="id" title="binder">t</span></a> <a id="H:244" class="idref" href="#H:244"><span class="id" title="binder">H</span></a> <a id="Q:245" class="idref" href="#Q:245"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Rich.html#t:243"><span class="id" title="variable">t</span></a> <a class="idref" href="Rich.html#H<sub>1</sub>:241"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Rich.html#Q<sub>1</sub>:242"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#H:244"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Rich.html#H<sub>1</sub>:241"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Rich.html#H<sub>2</sub>:240"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#Q<sub>1</sub>:242"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="Rich.html#H<sub>2</sub>:240"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Rich.html#Q:245"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="LibSepReference.html#5e7f0b24a844c8e20e7e8da54b64a002"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#5e7f0b24a844c8e20e7e8da54b64a002"><span class="id" title="notation">GC</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Rich.html#t:243"><span class="id" title="variable">t</span></a> <a class="idref" href="Rich.html#H:244"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q:245"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
In that setting, it is useful to integrate <span class="inlinecode">\<span class="id" title="var">GC</span></span> into the rule
    <span class="inlinecode"><span class="id" title="var">triple_while_inv_conseq_frame</span></span>, to allow discarding the data
    allocated by the loop iterations but not described in the final
    postcondition. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WhileLoops.LoopRuleAffine.triple_while_inv_conseq_frame_hgc" class="idref" href="#WhileLoops.LoopRuleAffine.triple_while_inv_conseq_frame_hgc"><span class="id" title="lemma">triple_while_inv_conseq_frame_hgc</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<a id="A:247" class="idref" href="#A:247"><span class="id" title="binder">A</span></a>:<span class="id" title="keyword">Type</span>) (<a id="I:248" class="idref" href="#I:248"><span class="id" title="binder">I</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="Rich.html#A:247"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) (<a id="R:249" class="idref" href="#R:249"><span class="id" title="binder">R</span></a>:<a class="idref" href="Rich.html#A:247"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="Rich.html#A:247"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><span class="id" title="keyword">Prop</span>) <a id="H':250" class="idref" href="#H':250"><span class="id" title="binder">H'</span></a> <a id="t<sub>1</sub>:251" class="idref" href="#t<sub>1</sub>:251"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:252" class="idref" href="#t<sub>2</sub>:252"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="H:253" class="idref" href="#H:253"><span class="id" title="binder">H</span></a> <a id="Q:254" class="idref" href="#Q:254"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="Q':257" class="idref" href="#Q':257"><span class="id" title="binder">Q'</span></a> := (<span class="id" title="keyword">fun</span> <a id="r:255" class="idref" href="#r:255"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="Y:256" class="idref" href="#Y:256"><span class="id" title="binder">Y</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Rich.html#I:248"><span class="id" title="variable">I</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="Rich.html#Y:256"><span class="id" title="variable">Y</span></a>) <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" title="definition">wf</span> <a class="idref" href="Rich.html#R:249"><span class="id" title="variable">R</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Rich.html#H:253"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="b:258" class="idref" href="#b:258"><span class="id" title="binder">b</span></a> <a id="X:259" class="idref" href="#X:259"><span class="id" title="binder">X</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Rich.html#I:248"><span class="id" title="variable">I</span></a> <a class="idref" href="Rich.html#b:258"><span class="id" title="variable">b</span></a> <a class="idref" href="Rich.html#X:259"><span class="id" title="variable">X</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Rich.html#H':250"><span class="id" title="variable">H'</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="t:260" class="idref" href="#t:260"><span class="id" title="binder">t</span></a> <a id="b:261" class="idref" href="#b:261"><span class="id" title="binder">b</span></a> <a id="X:262" class="idref" href="#X:262"><span class="id" title="binder">X</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="b':263" class="idref" href="#b':263"><span class="id" title="binder">b'</span></a> <a id="Y:264" class="idref" href="#Y:264"><span class="id" title="binder">Y</span></a>, <a class="idref" href="Rich.html#R:249"><span class="id" title="variable">R</span></a> <a class="idref" href="Rich.html#Y:264"><span class="id" title="variable">Y</span></a> <a class="idref" href="Rich.html#X:262"><span class="id" title="variable">X</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Rich.html#t:260"><span class="id" title="variable">t</span></a> (<a class="idref" href="Rich.html#I:248"><span class="id" title="variable">I</span></a> <a class="idref" href="Rich.html#b':263"><span class="id" title="variable">b'</span></a> <a class="idref" href="Rich.html#Y:264"><span class="id" title="variable">Y</span></a>) <a class="idref" href="Rich.html#Q':257"><span class="id" title="variable">Q'</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:251"><span class="id" title="variable">t<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:252"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="Rich.html#t:260"><span class="id" title="variable">t</span></a>) <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a>) (<a class="idref" href="Rich.html#I:248"><span class="id" title="variable">I</span></a> <a class="idref" href="Rich.html#b:261"><span class="id" title="variable">b</span></a> <a class="idref" href="Rich.html#X:262"><span class="id" title="variable">X</span></a>) <a class="idref" href="Rich.html#Q':257"><span class="id" title="variable">Q'</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#Q':257"><span class="id" title="variable">Q'</span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="Rich.html#H':250"><span class="id" title="variable">H'</span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Rich.html#Q:254"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="LibSepReference.html#5e7f0b24a844c8e20e7e8da54b64a002"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#5e7f0b24a844c8e20e7e8da54b64a002"><span class="id" title="notation">GC</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Rich.html#WhileLoops.trm_while"><span class="id" title="axiom">trm_while</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:251"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:252"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Rich.html#H:253"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q:254"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">WR</span> <span class="id" title="var">WH</span> <span class="id" title="var">M</span> <span class="id" title="var">WQ</span>. <span class="id" title="var">applys</span> <a class="idref" href="Rich.html#WhileLoops.LoopRuleAffine.triple_conseq_frame_hgc"><span class="id" title="axiom">triple_conseq_frame_hgc</span></a> <span class="id" title="var">WH</span> <span class="id" title="var">WQ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="Rich.html#WhileLoops.triple_while_inv"><span class="id" title="lemma">triple_while_inv</span></a> <span class="id" title="var">WR</span> <span class="id" title="var">M</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="Rich.html#WhileLoops.LoopRuleAffine"><span class="id" title="module">LoopRuleAffine</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="Rich.html#WhileLoops"><span class="id" title="module">WhileLoops</span></a>.<br/>
</div>

<div class="doc">
<a id="lab442"></a><h2 class="section">Curried Functions of Several Arguments</h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="CurriedFun" class="idref" href="#CurriedFun"><span class="id" title="module">CurriedFun</span></a>.<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">liblist_scope</span>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">f</span> : <a class="idref" href="LibSepVar.html#var"><span class="id" title="definition">var</span></a>.<br/>
</div>

<div class="doc">
We next give a quick presentation of the notation, lemmas and
    tactics involved in the manipulation of curried functions of
    several arguments.

<div class="paragraph"> </div>

    We focus here on the particular case of recursive functions with 2
    arguments, to illustrate the principles at play. Set up for non-recursive
    and recursive functions of arity 2 and 3 can be found in the file
    <span class="inlinecode"><span class="id" title="var">LibSepReference</span></span>.

<div class="paragraph"> </div>

    One may attempt to generalize these definitions to handle arbitrary
    arities. Yet, to obtain an arity-generic treatment of functions, it
    appears simpler to work with primitive n-ary functions, whose treatment
    is presented in the next section.

<div class="paragraph"> </div>

    Consider a curried recursive functions that expects two arguments:
    <span class="inlinecode"><span class="id" title="var">val_fix</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">x<sub>1</sub></span></span> <span class="inlinecode">(<span class="id" title="var">trm_fun</span></span> <span class="inlinecode"><span class="id" title="var">x<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">t</span>)</span> describes such a function, where <span class="inlinecode"><span class="id" title="var">f</span></span>
    denotes the name of the function for recursive calls, <span class="inlinecode"><span class="id" title="var">x<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">x<sub>2</sub></span></span>
    denote the arguments, and <span class="inlinecode"><span class="id" title="var">t</span></span> denotes the body. Observe that the
    inner function, the one that expects <span class="inlinecode"><span class="id" title="var">x<sub>2</sub></span></span>, is not recursive, and that
    it is not a value but a term (because it may refer to the variable <span class="inlinecode"><span class="id" title="var">x<sub>1</sub></span></span>
    bound outside of it).

<div class="paragraph"> </div>

    We introduce the notation <span class="inlinecode"><span class="id" title="keyword">Fix</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">x<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">x<sub>2</sub></span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">t</span></span> for such a recursive
    function with two arguments. 
</div>
<div class="code">

<span class="id" title="keyword">Notation</span> <a id="7877e9665e3efdf73357bd17494a4c<sub>20</sub>" class="idref" href="#7877e9665e3efdf73357bd17494a4c<sub>20</sub>"><span class="id" title="notation">&quot;</span></a>'Fix' f x<sub>1</sub> x<sub>2</sub> ':=' t" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#val_fix"><span class="id" title="constructor">val_fix</span></a> <span class="id" title="var">f</span> <span class="id" title="var">x<sub>1</sub></span> (<a class="idref" href="LibSepReference.html#trm_fun"><span class="id" title="constructor">trm_fun</span></a> <span class="id" title="var">x<sub>2</sub></span> <span class="id" title="var">t</span>))<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 69, <span class="id" title="var">f</span>, <span class="id" title="var">x<sub>1</sub></span>, <span class="id" title="var">x<sub>2</sub></span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0,<br/>
&nbsp;&nbsp;<span class="id" title="var">format</span> "'Fix'  f  x<sub>1</sub>  x<sub>2</sub>  ':='  t").<br/>
</div>

<div class="doc">
An application of a function with two arguments takes the form
    <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">v<sub>2</sub></span></span>, which is actually parsed as <span class="inlinecode"><span class="id" title="var">trm_app</span></span> <span class="inlinecode">(<span class="id" title="var">trm_app</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span>)</span> <span class="inlinecode"><span class="id" title="var">v<sub>2</sub></span></span>.

<div class="paragraph"> </div>

    This expression is an application of a term to a value, and not of
    a value to a value. Thus, this expression cannot be evaluated using
    the rule <span class="inlinecode"><span class="id" title="var">eval_app_fun</span></span>. We therefore need a distinct rule for first
    evaluating the arguments of a function application to values, before
    we can evaluate the application of a value to a value.

<div class="paragraph"> </div>

    The rule <span class="inlinecode"><span class="id" title="var">eval_app_args</span></span> serves that purpose. To state it, we first
    need to characterize whether a term is a value or not, using the
    predicate <span class="inlinecode"><span class="id" title="var">trm_is_val</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> defined next. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="CurriedFun.trm_is_val" class="idref" href="#CurriedFun.trm_is_val"><span class="id" title="definition">trm_is_val</span></a> (<a id="t:265" class="idref" href="#t:265"><span class="id" title="binder">t</span></a>:<a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Rich.html#t:265"><span class="id" title="variable">t</span></a> <span class="id" title="keyword">with</span> <a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <span class="id" title="var">v</span> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#True"><span class="id" title="inductive">True</span></a> | <span class="id" title="var">_</span> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a> <span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
The statement of <span class="inlinecode"><span class="id" title="var">eval_app_args</span></span> is as shown below. For an expression
    of the form <span class="inlinecode"><span class="id" title="var">trm_app</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>, where either <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> or <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> is
    not a value, it enables reducing both <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> to values,
    leaving a premise describing the evaluation of a term of the form
    <span class="inlinecode"><span class="id" title="var">trm_app</span></span> <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">v<sub>2</sub></span></span>, for which the rule <span class="inlinecode"><span class="id" title="var">eval_app_fun</span></span> applies. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="CurriedFun.eval_app_args" class="idref" href="#CurriedFun.eval_app_args"><span class="id" title="axiom">eval_app_args</span></a> : <span class="id" title="keyword">∀</span> <a id="s<sub>1</sub>:267" class="idref" href="#s<sub>1</sub>:267"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="s<sub>2</sub>:268" class="idref" href="#s<sub>2</sub>:268"><span class="id" title="binder">s<sub>2</sub></span></a> <a id="s<sub>3</sub>:269" class="idref" href="#s<sub>3</sub>:269"><span class="id" title="binder">s<sub>3</sub></span></a> <a id="s<sub>4</sub>:270" class="idref" href="#s<sub>4</sub>:270"><span class="id" title="binder">s<sub>4</sub></span></a> <a id="t<sub>1</sub>:271" class="idref" href="#t<sub>1</sub>:271"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:272" class="idref" href="#t<sub>2</sub>:272"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="v<sub>1</sub>:273" class="idref" href="#v<sub>1</sub>:273"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="v<sub>2</sub>:274" class="idref" href="#v<sub>2</sub>:274"><span class="id" title="binder">v<sub>2</sub></span></a> <a id="r:275" class="idref" href="#r:275"><span class="id" title="binder">r</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">¬</span></a> <a class="idref" href="Rich.html#CurriedFun.trm_is_val"><span class="id" title="definition">trm_is_val</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:271"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e<sub>25</sub>"><span class="id" title="notation">∨</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">¬</span></a> <a class="idref" href="Rich.html#CurriedFun.trm_is_val"><span class="id" title="definition">trm_is_val</span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:272"><span class="id" title="variable">t<sub>2</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Rich.html#s<sub>1</sub>:267"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:271"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#s<sub>2</sub>:268"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Rich.html#v<sub>1</sub>:273"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Rich.html#s<sub>2</sub>:268"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:272"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="Rich.html#s<sub>3</sub>:269"><span class="id" title="variable">s<sub>3</sub></span></a> <a class="idref" href="Rich.html#v<sub>2</sub>:274"><span class="id" title="variable">v<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Rich.html#s<sub>3</sub>:269"><span class="id" title="variable">s<sub>3</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="Rich.html#v<sub>1</sub>:273"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Rich.html#v<sub>2</sub>:274"><span class="id" title="variable">v<sub>2</sub></span></a>) <a class="idref" href="Rich.html#s<sub>4</sub>:270"><span class="id" title="variable">s<sub>4</sub></span></a> <a class="idref" href="Rich.html#r:275"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Rich.html#s<sub>1</sub>:267"><span class="id" title="variable">s<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:271"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rich.html#t<sub>2</sub>:272"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Rich.html#s<sub>4</sub>:270"><span class="id" title="variable">s<sub>4</sub></span></a> <a class="idref" href="Rich.html#r:275"><span class="id" title="variable">r</span></a>.<br/>
</div>

<div class="doc">
Using the above rule, we can establish an evaluation rule for the
    term <span class="inlinecode"><span class="id" title="var">v<sub>0</sub></span></span> <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">v<sub>2</sub></span></span>. There, <span class="inlinecode"><span class="id" title="var">v<sub>0</sub></span></span> denotes a recursive function of two
    arguments named <span class="inlinecode"><span class="id" title="var">x<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">x<sub>2</sub></span></span>, the values <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">v<sub>2</sub></span></span> denote
    the two arguments, and <span class="inlinecode"><span class="id" title="var">f</span></span> denotes the name of the function available
    for making recursive calls from the body <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>.

<div class="paragraph"> </div>

    The key idea is that the behavior of <span class="inlinecode"><span class="id" title="var">v<sub>0</sub></span></span> <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">v<sub>2</sub></span></span> is similar to
    that of the term <span class="inlinecode"><span class="id" title="tactic">subst</span></span> <span class="inlinecode"><span class="id" title="var">x<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">v<sub>2</sub></span></span> <span class="inlinecode">(<span class="id" title="tactic">subst</span></span> <span class="inlinecode"><span class="id" title="var">x<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span> <span class="inlinecode">(<span class="id" title="tactic">subst</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">v<sub>0</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span>))</span>.
    We state this property using the predicate <span class="inlinecode"><span class="id" title="var">eval_like</span></span>, introduced
    in the chapter <a href="Rules.html"><span class="inlineref">Rules</span></a>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="CurriedFun.eval_like_app_fix2" class="idref" href="#CurriedFun.eval_like_app_fix2"><span class="id" title="lemma">eval_like_app_fix2</span></a> : <span class="id" title="keyword">∀</span> <a id="v<sub>0</sub>:277" class="idref" href="#v<sub>0</sub>:277"><span class="id" title="binder">v<sub>0</sub></span></a> <a id="v<sub>1</sub>:278" class="idref" href="#v<sub>1</sub>:278"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="v<sub>2</sub>:279" class="idref" href="#v<sub>2</sub>:279"><span class="id" title="binder">v<sub>2</sub></span></a> <a id="f:280" class="idref" href="#f:280"><span class="id" title="binder">f</span></a> <a id="x<sub>1</sub>:281" class="idref" href="#x<sub>1</sub>:281"><span class="id" title="binder">x<sub>1</sub></span></a> <a id="x<sub>2</sub>:282" class="idref" href="#x<sub>2</sub>:282"><span class="id" title="binder">x<sub>2</sub></span></a> <a id="t<sub>1</sub>:283" class="idref" href="#t<sub>1</sub>:283"><span class="id" title="binder">t<sub>1</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#v<sub>0</sub>:277"><span class="id" title="variable">v<sub>0</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_fix"><span class="id" title="constructor">val_fix</span></a> <a class="idref" href="Rich.html#f:280"><span class="id" title="variable">f</span></a> <a class="idref" href="Rich.html#x<sub>1</sub>:281"><span class="id" title="variable">x<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_fun"><span class="id" title="constructor">trm_fun</span></a> <a class="idref" href="Rich.html#x<sub>2</sub>:282"><span class="id" title="variable">x<sub>2</sub></span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:283"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Rich.html#x<sub>1</sub>:281"><span class="id" title="variable">x<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="Rich.html#x<sub>2</sub>:282"><span class="id" title="variable">x<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Rich.html#f:280"><span class="id" title="variable">f</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="Rich.html#x<sub>2</sub>:282"><span class="id" title="variable">x<sub>2</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval_like"><span class="id" title="definition">eval_like</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Rich.html#x<sub>2</sub>:282"><span class="id" title="variable">x<sub>2</sub></span></a> <a class="idref" href="Rich.html#v<sub>2</sub>:279"><span class="id" title="variable">v<sub>2</sub></span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Rich.html#x<sub>1</sub>:281"><span class="id" title="variable">x<sub>1</sub></span></a> <a class="idref" href="Rich.html#v<sub>1</sub>:278"><span class="id" title="variable">v<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Rich.html#f:280"><span class="id" title="variable">f</span></a> <a class="idref" href="Rich.html#v<sub>0</sub>:277"><span class="id" title="variable">v<sub>0</sub></span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:283"><span class="id" title="variable">t<sub>1</sub></span></a>))) (<a class="idref" href="Rich.html#v<sub>0</sub>:277"><span class="id" title="variable">v<sub>0</sub></span></a> <a class="idref" href="Rich.html#v<sub>1</sub>:278"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Rich.html#v<sub>2</sub>:279"><span class="id" title="variable">v<sub>2</sub></span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">E</span> (<span class="id" title="var">N<sub>1</sub></span>&amp;<span class="id" title="var">N<sub>2</sub></span>). <span class="id" title="var">introv</span> <span class="id" title="var">R</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Rich.html#CurriedFun.eval_app_args"><span class="id" title="axiom">eval_app_args</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#eval_app_fix"><span class="id" title="constructor">eval_app_fix</span></a> <span class="id" title="var">E</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">do</span> 2 (<span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepVar.html#var_eq_spec"><span class="id" title="lemma">var_eq_spec</span></a>; <span class="id" title="var">case_if</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#eval_fun"><span class="id" title="constructor">eval_fun</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#eval_val"><span class="id" title="constructor">eval_val</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#eval_app_fun"><span class="id" title="constructor">eval_app_fun</span></a>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
We next derive the specification triple for applications of
    the form <span class="inlinecode"><span class="id" title="var">v<sub>0</sub></span></span> <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">v<sub>2</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="CurriedFun.triple_app_fix2" class="idref" href="#CurriedFun.triple_app_fix2"><span class="id" title="lemma">triple_app_fix2</span></a> : <span class="id" title="keyword">∀</span> <a id="f:284" class="idref" href="#f:284"><span class="id" title="binder">f</span></a> <a id="x<sub>1</sub>:285" class="idref" href="#x<sub>1</sub>:285"><span class="id" title="binder">x<sub>1</sub></span></a> <a id="x<sub>2</sub>:286" class="idref" href="#x<sub>2</sub>:286"><span class="id" title="binder">x<sub>2</sub></span></a> <a id="v<sub>0</sub>:287" class="idref" href="#v<sub>0</sub>:287"><span class="id" title="binder">v<sub>0</sub></span></a> <a id="v<sub>1</sub>:288" class="idref" href="#v<sub>1</sub>:288"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="v<sub>2</sub>:289" class="idref" href="#v<sub>2</sub>:289"><span class="id" title="binder">v<sub>2</sub></span></a> <a id="t<sub>1</sub>:290" class="idref" href="#t<sub>1</sub>:290"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="H:291" class="idref" href="#H:291"><span class="id" title="binder">H</span></a> <a id="Q:292" class="idref" href="#Q:292"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#v<sub>0</sub>:287"><span class="id" title="variable">v<sub>0</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_fix"><span class="id" title="constructor">val_fix</span></a> <a class="idref" href="Rich.html#f:284"><span class="id" title="variable">f</span></a> <a class="idref" href="Rich.html#x<sub>1</sub>:285"><span class="id" title="variable">x<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_fun"><span class="id" title="constructor">trm_fun</span></a> <a class="idref" href="Rich.html#x<sub>2</sub>:286"><span class="id" title="variable">x<sub>2</sub></span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:290"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Rich.html#x<sub>1</sub>:285"><span class="id" title="variable">x<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="Rich.html#x<sub>2</sub>:286"><span class="id" title="variable">x<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Rich.html#f:284"><span class="id" title="variable">f</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="Rich.html#x<sub>2</sub>:286"><span class="id" title="variable">x<sub>2</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Rich.html#x<sub>2</sub>:286"><span class="id" title="variable">x<sub>2</sub></span></a> <a class="idref" href="Rich.html#v<sub>2</sub>:289"><span class="id" title="variable">v<sub>2</sub></span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Rich.html#x<sub>1</sub>:285"><span class="id" title="variable">x<sub>1</sub></span></a> <a class="idref" href="Rich.html#v<sub>1</sub>:288"><span class="id" title="variable">v<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Rich.html#f:284"><span class="id" title="variable">f</span></a> <a class="idref" href="Rich.html#v<sub>0</sub>:287"><span class="id" title="variable">v<sub>0</sub></span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:290"><span class="id" title="variable">t<sub>1</sub></span></a>))) <a class="idref" href="Rich.html#H:291"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q:292"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Rich.html#v<sub>0</sub>:287"><span class="id" title="variable">v<sub>0</sub></span></a> <a class="idref" href="Rich.html#v<sub>1</sub>:288"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Rich.html#v<sub>2</sub>:289"><span class="id" title="variable">v<sub>2</sub></span></a>) <a class="idref" href="Rich.html#H:291"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q:292"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">E</span> <span class="id" title="var">N</span> <span class="id" title="var">M<sub>1</sub></span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_eval_like"><span class="id" title="lemma">triple_eval_like</span></a> <span class="id" title="var">M<sub>1</sub></span>. <span class="id" title="var">applys</span>* <a class="idref" href="Rich.html#CurriedFun.eval_like_app_fix2"><span class="id" title="lemma">eval_like_app_fix2</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The reasoning rule above can be reformulated in weakest-precondition
    style. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="CurriedFun.wp_app_fix2" class="idref" href="#CurriedFun.wp_app_fix2"><span class="id" title="lemma">wp_app_fix2</span></a> : <span class="id" title="keyword">∀</span> <a id="f:293" class="idref" href="#f:293"><span class="id" title="binder">f</span></a> <a id="x<sub>1</sub>:294" class="idref" href="#x<sub>1</sub>:294"><span class="id" title="binder">x<sub>1</sub></span></a> <a id="x<sub>2</sub>:295" class="idref" href="#x<sub>2</sub>:295"><span class="id" title="binder">x<sub>2</sub></span></a> <a id="v<sub>0</sub>:296" class="idref" href="#v<sub>0</sub>:296"><span class="id" title="binder">v<sub>0</sub></span></a> <a id="v<sub>1</sub>:297" class="idref" href="#v<sub>1</sub>:297"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="v<sub>2</sub>:298" class="idref" href="#v<sub>2</sub>:298"><span class="id" title="binder">v<sub>2</sub></span></a> <a id="t<sub>1</sub>:299" class="idref" href="#t<sub>1</sub>:299"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="Q:300" class="idref" href="#Q:300"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#v<sub>0</sub>:296"><span class="id" title="variable">v<sub>0</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_fix"><span class="id" title="constructor">val_fix</span></a> <a class="idref" href="Rich.html#f:293"><span class="id" title="variable">f</span></a> <a class="idref" href="Rich.html#x<sub>1</sub>:294"><span class="id" title="variable">x<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_fun"><span class="id" title="constructor">trm_fun</span></a> <a class="idref" href="Rich.html#x<sub>2</sub>:295"><span class="id" title="variable">x<sub>2</sub></span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:299"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Rich.html#x<sub>1</sub>:294"><span class="id" title="variable">x<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="Rich.html#x<sub>2</sub>:295"><span class="id" title="variable">x<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Rich.html#f:293"><span class="id" title="variable">f</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="Rich.html#x<sub>2</sub>:295"><span class="id" title="variable">x<sub>2</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Rich.html#x<sub>2</sub>:295"><span class="id" title="variable">x<sub>2</sub></span></a> <a class="idref" href="Rich.html#v<sub>2</sub>:298"><span class="id" title="variable">v<sub>2</sub></span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Rich.html#x<sub>1</sub>:294"><span class="id" title="variable">x<sub>1</sub></span></a> <a class="idref" href="Rich.html#v<sub>1</sub>:297"><span class="id" title="variable">v<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Rich.html#f:293"><span class="id" title="variable">f</span></a> <a class="idref" href="Rich.html#v<sub>0</sub>:296"><span class="id" title="variable">v<sub>0</sub></span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:299"><span class="id" title="variable">t<sub>1</sub></span></a>))) <a class="idref" href="Rich.html#Q:300"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="Rich.html#v<sub>0</sub>:296"><span class="id" title="variable">v<sub>0</sub></span></a> <a class="idref" href="Rich.html#v<sub>1</sub>:297"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Rich.html#v<sub>2</sub>:298"><span class="id" title="variable">v<sub>2</sub></span></a>) <a class="idref" href="Rich.html#Q:300"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">EQ<sub>1</sub></span> <span class="id" title="var">N</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#wp_eval_like"><span class="id" title="lemma">wp_eval_like</span></a>. <span class="id" title="var">applys</span>* <a class="idref" href="Rich.html#CurriedFun.eval_like_app_fix2"><span class="id" title="lemma">eval_like_app_fix2</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Finally, it is useful to extend the tactic <span class="inlinecode"><span class="id" title="var">xwp</span></span>, so that it exploits
    the rule <span class="inlinecode"><span class="id" title="var">wp_app_fix2</span></span> in the same way as it exploits <span class="inlinecode"><span class="id" title="var">wp_app_fix</span></span>.

<div class="paragraph"> </div>

    To that end, we state a lemma featuring a conclusion expressed
    as a <span class="inlinecode"><span class="id" title="var">triple</span></span>, and a premise expressed using <span class="inlinecode"><span class="id" title="var">wpgen</span></span>. Observe the
    substitution context associated with <span class="inlinecode"><span class="id" title="var">wpgen</span></span>: it is instantiated as
    <span class="inlinecode">(<span class="id" title="var">f</span>,<span class="id" title="var">v<sub>0</sub></span>)::(<span class="id" title="var">x<sub>1</sub></span>,<span class="id" title="var">v<sub>1</sub></span>)::(<span class="id" title="var">x<sub>2</sub></span>,<span class="id" title="var">v<sub>2</sub></span>)::<span class="id" title="var">nil</span></span>, so as to perform the relevant
    substitutions. Note also how the side-condition expressing the freshness
    conditions on the variables, using a comparison function for variables
    that computes in Coq. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="CurriedFun.xwp_lemma_fix2" class="idref" href="#CurriedFun.xwp_lemma_fix2"><span class="id" title="lemma">xwp_lemma_fix2</span></a> : <span class="id" title="keyword">∀</span> <a id="f:301" class="idref" href="#f:301"><span class="id" title="binder">f</span></a> <a id="v<sub>0</sub>:302" class="idref" href="#v<sub>0</sub>:302"><span class="id" title="binder">v<sub>0</sub></span></a> <a id="v<sub>1</sub>:303" class="idref" href="#v<sub>1</sub>:303"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="v<sub>2</sub>:304" class="idref" href="#v<sub>2</sub>:304"><span class="id" title="binder">v<sub>2</sub></span></a> <a id="x<sub>1</sub>:305" class="idref" href="#x<sub>1</sub>:305"><span class="id" title="binder">x<sub>1</sub></span></a> <a id="x<sub>2</sub>:306" class="idref" href="#x<sub>2</sub>:306"><span class="id" title="binder">x<sub>2</sub></span></a> <a id="t:307" class="idref" href="#t:307"><span class="id" title="binder">t</span></a> <a id="H:308" class="idref" href="#H:308"><span class="id" title="binder">H</span></a> <a id="Q:309" class="idref" href="#Q:309"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#v<sub>0</sub>:302"><span class="id" title="variable">v<sub>0</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_fix"><span class="id" title="constructor">val_fix</span></a> <a class="idref" href="Rich.html#f:301"><span class="id" title="variable">f</span></a> <a class="idref" href="Rich.html#x<sub>1</sub>:305"><span class="id" title="variable">x<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_fun"><span class="id" title="constructor">trm_fun</span></a> <a class="idref" href="Rich.html#x<sub>2</sub>:306"><span class="id" title="variable">x<sub>2</sub></span></a> <a class="idref" href="Rich.html#t:307"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepVar.html#var_eq"><span class="id" title="definition">var_eq</span></a> <a class="idref" href="Rich.html#x<sub>1</sub>:305"><span class="id" title="variable">x<sub>1</sub></span></a> <a class="idref" href="Rich.html#x<sub>2</sub>:306"><span class="id" title="variable">x<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="LibSepVar.html#var_eq"><span class="id" title="definition">var_eq</span></a> <a class="idref" href="Rich.html#f:301"><span class="id" title="variable">f</span></a> <a class="idref" href="Rich.html#x<sub>2</sub>:306"><span class="id" title="variable">x<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#H:308"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#wpgen"><span class="id" title="definition">wpgen</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Rich.html#f:301"><span class="id" title="variable">f</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Rich.html#v<sub>0</sub>:302"><span class="id" title="variable">v<sub>0</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Rich.html#x<sub>1</sub>:305"><span class="id" title="variable">x<sub>1</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Rich.html#v<sub>1</sub>:303"><span class="id" title="variable">v<sub>1</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Rich.html#x<sub>2</sub>:306"><span class="id" title="variable">x<sub>2</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Rich.html#v<sub>2</sub>:304"><span class="id" title="variable">v<sub>2</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>) <a class="idref" href="Rich.html#t:307"><span class="id" title="variable">t</span></a> <a class="idref" href="Rich.html#Q:309"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Rich.html#v<sub>0</sub>:302"><span class="id" title="variable">v<sub>0</sub></span></a> <a class="idref" href="Rich.html#v<sub>1</sub>:303"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Rich.html#v<sub>2</sub>:304"><span class="id" title="variable">v<sub>2</sub></span></a>) <a class="idref" href="Rich.html#H:308"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q:309"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">N</span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepVar.html#var_eq_spec"><span class="id" title="lemma">var_eq_spec</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">N</span>. <span class="id" title="var">rew_bool_eq</span> <span class="id" title="keyword">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="LibSepReference.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="var">xchange</span> <span class="id" title="var">M<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xchange</span> (<span class="id" title="notation">&gt;&gt;</span> <a class="idref" href="LibSepReference.html#wpgen_sound"><span class="id" title="lemma">wpgen_sound</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(</span><span class="id" title="notation">(</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">f</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">v<sub>0</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">++</span> <span class="id" title="notation">(</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">x<sub>1</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">v<sub>1</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">++</span> <span class="id" title="notation">(</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">x<sub>2</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">v<sub>2</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a><span class="id" title="notation">)</span><span class="id" title="notation">)</span> <span class="id" title="var">t</span> <span class="id" title="var">Q</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#isubst_app"><span class="id" title="lemma">isubst_app</span></a>. <span class="id" title="tactic">do</span> 3 <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="LibSepReference.html#subst_eq_isubst_one"><span class="id" title="lemma">subst_eq_isubst_one</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span>* <a class="idref" href="Rich.html#CurriedFun.wp_app_fix2"><span class="id" title="lemma">wp_app_fix2</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The lemma gets integrated into the implementation of <span class="inlinecode"><span class="id" title="var">xwp</span></span> as follows. 
</div>
<div class="code">

<span class="id" title="keyword">Tactic Notation</span> "xwp" :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">first</span> [ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#xwp_lemma_fun"><span class="id" title="lemma">xwp_lemma_fun</span></a>; [ <span class="id" title="tactic">reflexivity</span> | ]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#xwp_lemma_fix"><span class="id" title="lemma">xwp_lemma_fix</span></a>; [ <span class="id" title="tactic">reflexivity</span> | ]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">applys</span> <a class="idref" href="Rich.html#CurriedFun.xwp_lemma_fix2"><span class="id" title="lemma">xwp_lemma_fix2</span></a>; [ <span class="id" title="tactic">reflexivity</span> | <span class="id" title="var">splits</span>; <span class="id" title="tactic">reflexivity</span> | ] ];<br/>
&nbsp;&nbsp;<span class="id" title="var">xwp_simpl</span>.<br/>
</div>

<div class="doc">
This tactic <span class="inlinecode"><span class="id" title="var">xwp</span></span> also appears in the file <span class="inlinecode"><span class="id" title="var">LibSepReference.v</span></span>. It is
    exploited in several examples from the chapter <a href="Basic.html"><span class="inlineref">Basic</span></a>. 
</div>
<div class="code">

<span class="id" title="keyword">End</span> <a class="idref" href="Rich.html#CurriedFun"><span class="id" title="module">CurriedFun</span></a>.<br/>
</div>

<div class="doc">
<a id="lab443"></a><h2 class="section">Primitive n-ary Functions</h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="PrimitiveNaryFun" class="idref" href="#PrimitiveNaryFun"><span class="id" title="module">PrimitiveNaryFun</span></a>.<br/>
</div>

<div class="doc">
We next present an alternative treatment to functions of several
    arguments. The idea is to represent function arguments using lists.
    The verification tool CFML is implemented following this approach.

<div class="paragraph"> </div>

    On the one hand, the manipulation of lists adds a little bit of
    boilerplate. On the other hand, when using this representation, all
    the definitions and lemmas are inherently arity-generic, that is,
    they work for any number of arguments.

<div class="paragraph"> </div>

    We introduce the short names <span class="inlinecode"><span class="id" title="var">vars</span></span>, <span class="inlinecode"><span class="id" title="var">vals</span></span> and <span class="inlinecode"><span class="id" title="var">trms</span></span> to denote lists
    of variables, lists of values, and lists of terms, respectively.

<div class="paragraph"> </div>

    These names are not only useful to improve conciseness, they also enable
    the set up of useful coercions, as illustrated further on. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="PrimitiveNaryFun.vars" class="idref" href="#PrimitiveNaryFun.vars"><span class="id" title="definition">vars</span></a> : <span class="id" title="keyword">Type</span> := <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="LibSepVar.html#var"><span class="id" title="definition">var</span></a>.<br/>
<span class="id" title="keyword">Definition</span> <a id="PrimitiveNaryFun.vals" class="idref" href="#PrimitiveNaryFun.vals"><span class="id" title="definition">vals</span></a> : <span class="id" title="keyword">Type</span> := <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
<span class="id" title="keyword">Definition</span> <a id="PrimitiveNaryFun.trms" class="idref" href="#PrimitiveNaryFun.trms"><span class="id" title="definition">trms</span></a> : <span class="id" title="keyword">Type</span> := <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">xs</span> : <a class="idref" href="Rich.html#PrimitiveNaryFun.vars"><span class="id" title="definition">vars</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">vs</span> : <a class="idref" href="Rich.html#PrimitiveNaryFun.vals"><span class="id" title="definition">vals</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">ts</span> : <a class="idref" href="Rich.html#PrimitiveNaryFun.trms"><span class="id" title="definition">trms</span></a>.<br/>
</div>

<div class="doc">
We assume the grammar of terms and values to include primitive n-ary
    functions and primitive n-ary applications, featuring list of arguments.

<div class="paragraph"> </div>

    Thereafter, for conciseness, we focus on the treatment of recursive
    functions, and do not describe the simpler case of non-recursive
    functions. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="PrimitiveNaryFun.val_fixs" class="idref" href="#PrimitiveNaryFun.val_fixs"><span class="id" title="axiom">val_fixs</span></a> : <a class="idref" href="LibSepVar.html#var"><span class="id" title="definition">var</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Rich.html#PrimitiveNaryFun.vars"><span class="id" title="definition">vars</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
<span class="id" title="keyword">Parameter</span> <a id="PrimitiveNaryFun.trm_fixs" class="idref" href="#PrimitiveNaryFun.trm_fixs"><span class="id" title="axiom">trm_fixs</span></a> : <a class="idref" href="LibSepVar.html#var"><span class="id" title="definition">var</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Rich.html#PrimitiveNaryFun.vars"><span class="id" title="definition">vars</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>.<br/>
<span class="id" title="keyword">Parameter</span> <a id="PrimitiveNaryFun.trm_apps" class="idref" href="#PrimitiveNaryFun.trm_apps"><span class="id" title="axiom">trm_apps</span></a> : <a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Rich.html#PrimitiveNaryFun.trms"><span class="id" title="definition">trms</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>.<br/>
</div>

<div class="doc">
The substitution function is a bit tricky to update for dealing with
    list of variables. A definition along the following lines computes well,
    and is recognized as structurally recursive by Coq.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="tactic">subst</span> (<span class="id" title="var">y</span>:<span class="id" title="var">var</span>) (<span class="id" title="var">w</span>:<span class="id" title="var">val</span>) (<span class="id" title="var">t</span>:<span class="id" title="var">trm</span>) : <span class="id" title="var">trm</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">aux</span> <span class="id" title="var">t</span> := (<span class="id" title="tactic">subst</span> <span class="id" title="var">y</span> <span class="id" title="var">w</span> <span class="id" title="var">t</span>) <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">aux_no_captures</span> <span class="id" title="var">xs</span> <span class="id" title="var">t</span> := (<span class="id" title="var">If</span> <span class="id" title="var">List.In</span> <span class="id" title="var">y</span> <span class="id" title="var">xs</span> <span class="id" title="keyword">then</span> <span class="id" title="var">t</span> <span class="id" title="keyword">else</span> <span class="id" title="var">aux</span> <span class="id" title="var">t</span>) <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">trm_fixs</span> <span class="id" title="var">f</span> <span class="id" title="var">xs</span> <span class="id" title="var">t<sub>1</sub></span> ⇒ <span class="id" title="var">trm_fixs</span> <span class="id" title="var">f</span> <span class="id" title="var">xs</span> (<span class="id" title="var">If</span> <span class="id" title="var">f</span> = <span class="id" title="var">y</span> <span class="id" title="keyword">then</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aux_no_captures</span> <span class="id" title="var">xs</span> <span class="id" title="var">t<sub>1</sub></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">trm_apps</span> <span class="id" title="var">t<sub>0</sub></span> <span class="id" title="var">ts</span> ⇒ <span class="id" title="var">trm_apps</span> (<span class="id" title="var">aux</span> <span class="id" title="var">t<sub>0</sub></span>) (<span class="id" title="var">List.map</span> <span class="id" title="var">aux</span> <span class="id" title="var">ts</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.
</span>
<div class="paragraph"> </div>

 The evaluation rules also need to be updated to handle list of
    arguments. A n-ary function from the grammar of terms evaluates to
    the corresponding n-ary function from the grammar of values. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="PrimitiveNaryFun.eval_fixs" class="idref" href="#PrimitiveNaryFun.eval_fixs"><span class="id" title="axiom">eval_fixs</span></a> : <span class="id" title="keyword">∀</span> <a id="m:313" class="idref" href="#m:313"><span class="id" title="binder">m</span></a> <a id="f:314" class="idref" href="#f:314"><span class="id" title="binder">f</span></a> <a id="xs:315" class="idref" href="#xs:315"><span class="id" title="binder">xs</span></a> <a id="t<sub>1</sub>:316" class="idref" href="#t<sub>1</sub>:316"><span class="id" title="binder">t<sub>1</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#xs:315"><span class="id" title="variable">xs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Rich.html#m:313"><span class="id" title="variable">m</span></a> (<a class="idref" href="Rich.html#PrimitiveNaryFun.trm_fixs"><span class="id" title="axiom">trm_fixs</span></a> <a class="idref" href="Rich.html#f:314"><span class="id" title="variable">f</span></a> <a class="idref" href="Rich.html#xs:315"><span class="id" title="variable">xs</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:316"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="Rich.html#m:313"><span class="id" title="variable">m</span></a> (<a class="idref" href="Rich.html#PrimitiveNaryFun.val_fixs"><span class="id" title="axiom">val_fixs</span></a> <a class="idref" href="Rich.html#f:314"><span class="id" title="variable">f</span></a> <a class="idref" href="Rich.html#xs:315"><span class="id" title="variable">xs</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:316"><span class="id" title="variable">t<sub>1</sub></span></a>).<br/>
</div>

<div class="doc">
Note that, for technical reasons, we need to ensure that list of
    arguments is nonempty. Indeed, a function with zero arguments
    would beta-reduce to its body as soon as it is defined, because
    it is not waiting for any argument, resulting in an infinite
    sequence of reductions. 
<div class="paragraph"> </div>

 The application of a n-ary function to values takes the form
    <span class="inlinecode"><span class="id" title="var">trm_apps</span></span> <span class="inlinecode">(<span class="id" title="var">trm_val</span></span> <span class="inlinecode"><span class="id" title="var">v<sub>0</sub></span>)</span> <span class="inlinecode">((<span class="id" title="var">trm_val</span></span> <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span>)::</span> <span class="inlinecode">..</span> <span class="inlinecode">::(<span class="id" title="var">trm_val</span></span> <span class="inlinecode"><span class="id" title="var">vn</span>)::<span class="id" title="var">nil</span>)</span>.

<div class="paragraph"> </div>

    If the function <span class="inlinecode"><span class="id" title="var">v<sub>0</sub></span></span> is defined as <span class="inlinecode"><span class="id" title="var">val_fixs</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">xs</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>, where <span class="inlinecode"><span class="id" title="var">xs</span></span>
    denotes the list <span class="inlinecode"><span class="id" title="var">x<sub>1</sub></span>::<span class="id" title="var">x<sub>2</sub></span>::...::<span class="id" title="var">xn</span>::<span class="id" title="var">nil</span></span>, then the beta-reduction
    of the function application triggers the evaluation of the
    term <span class="inlinecode"><span class="id" title="tactic">subst</span></span> <span class="inlinecode"><span class="id" title="var">xn</span></span> <span class="inlinecode"><span class="id" title="var">vn</span></span> <span class="inlinecode">(...</span> <span class="inlinecode">(<span class="id" title="tactic">subst</span></span> <span class="inlinecode"><span class="id" title="var">x<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span> <span class="inlinecode">(<span class="id" title="tactic">subst</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">v<sub>0</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span>))</span> <span class="inlinecode">...)</span>.

<div class="paragraph"> </div>

    To describe the evaluation rule in an arity-generic way, we need to
    introduce the list <span class="inlinecode"><span class="id" title="var">vs</span></span> made of the values provided as arguments,
    that is, the list <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span>::<span class="id" title="var">v<sub>2</sub></span>::..::<span class="id" title="var">vn</span>::<span class="id" title="var">nil</span></span>.

<div class="paragraph"> </div>

    With this list <span class="inlinecode"><span class="id" title="var">vs</span></span>, the n-ary application can then be written as the
    term <span class="inlinecode"><span class="id" title="var">trm_apps</span></span> <span class="inlinecode">(<span class="id" title="var">trm_val</span></span> <span class="inlinecode"><span class="id" title="var">v<sub>0</sub></span>)</span> <span class="inlinecode">(<span class="id" title="var">trms_vals</span></span> <span class="inlinecode"><span class="id" title="var">vs</span>)</span>, where the operation
    <span class="inlinecode"><span class="id" title="var">trms_vals</span></span> converts a list of values into a list of terms by
    applying the constructor <span class="inlinecode"><span class="id" title="var">trm_val</span></span> to every value from the list. 
</div>
<div class="code">

<span class="id" title="keyword">Coercion</span> <a id="PrimitiveNaryFun.trms_vals" class="idref" href="#PrimitiveNaryFun.trms_vals"><span class="id" title="definition">trms_vals</span></a> (<a id="vs:318" class="idref" href="#vs:318"><span class="id" title="binder">vs</span></a>:<a class="idref" href="Rich.html#PrimitiveNaryFun.vals"><span class="id" title="definition">vals</span></a>) : <a class="idref" href="Rich.html#PrimitiveNaryFun.trms"><span class="id" title="definition">trms</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="definition">LibList.map</span> <a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <a class="idref" href="Rich.html#vs:318"><span class="id" title="variable">vs</span></a>.<br/>
</div>

<div class="doc">
Note that we declare the operation <span class="inlinecode"><span class="id" title="var">trms_vals</span></span> as a coercion, just
    like <span class="inlinecode"><span class="id" title="var">trm_val</span></span> is a coercion. Doing so enables us to write a n-ary
    application in the form <span class="inlinecode"><span class="id" title="var">v<sub>0</sub></span></span> <span class="inlinecode"><span class="id" title="var">vs</span></span>. 
<div class="paragraph"> </div>

 To describe the iterated substitution
    <span class="inlinecode"><span class="id" title="tactic">subst</span></span> <span class="inlinecode"><span class="id" title="var">xn</span></span> <span class="inlinecode"><span class="id" title="var">vn</span></span> <span class="inlinecode">(...</span> <span class="inlinecode">(<span class="id" title="tactic">subst</span></span> <span class="inlinecode"><span class="id" title="var">x<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span> <span class="inlinecode">(<span class="id" title="tactic">subst</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">v<sub>0</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span>))</span> <span class="inlinecode">...)</span>, we introduce
    the operation <span class="inlinecode"><span class="id" title="var">substn</span></span> <span class="inlinecode"><span class="id" title="var">xs</span></span> <span class="inlinecode"><span class="id" title="var">vs</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>, which substitutes the variables <span class="inlinecode"><span class="id" title="var">xs</span></span>
    with the values <span class="inlinecode"><span class="id" title="var">vs</span></span> inside the <span class="inlinecode"><span class="id" title="var">t</span></span>. It is defined recursively,
    by iterating calls to the function <span class="inlinecode"><span class="id" title="tactic">subst</span></span> for substituting the
    variables one by one. 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <a id="PrimitiveNaryFun.substn" class="idref" href="#PrimitiveNaryFun.substn"><span class="id" title="definition">substn</span></a> (<a id="xs:319" class="idref" href="#xs:319"><span class="id" title="binder">xs</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="LibSepVar.html#var"><span class="id" title="definition">var</span></a>) (<a id="vs:320" class="idref" href="#vs:320"><span class="id" title="binder">vs</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) (<a id="t:321" class="idref" href="#t:321"><span class="id" title="binder">t</span></a>:<a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>) : <a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Rich.html#xs:319"><span class="id" title="variable">xs</span></a>,<a class="idref" href="Rich.html#vs:320"><span class="id" title="variable">vs</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">x</span><span class="id" title="notation">::</span><span class="id" title="var">xs'</span>, <span class="id" title="var">v</span><span class="id" title="notation">::</span><span class="id" title="var">vs'</span> ⇒ <a class="idref" href="Rich.html#substn:322"><span class="id" title="definition">substn</span></a> <span class="id" title="var">xs'</span> <span class="id" title="var">vs'</span> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <span class="id" title="var">x</span> <span class="id" title="var">v</span> <a class="idref" href="Rich.html#t:321"><span class="id" title="variable">t</span></a>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span>,<span class="id" title="var">_</span> ⇒ <a class="idref" href="Rich.html#t:321"><span class="id" title="variable">t</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
This substitution operation is well-behaved only if the list <span class="inlinecode"><span class="id" title="var">xs</span></span>
    and the list <span class="inlinecode"><span class="id" title="var">vs</span></span> have the same lengths. It is also needed for
    reasoning about the evaluation rule to guarantee that the list of
    variables <span class="inlinecode"><span class="id" title="var">xs</span></span> contains variables that are distinct from each others
    and distinct from <span class="inlinecode"><span class="id" title="var">f</span></span>, and to guarantee that the list <span class="inlinecode"><span class="id" title="var">xs</span></span> is not empty.

<div class="paragraph"> </div>

    To formally capture all these invariants, we introduce the predicate
    <span class="inlinecode"><span class="id" title="var">var_fixs</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">xs</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span>, where <span class="inlinecode"><span class="id" title="var">n</span></span> denotes the number of arguments the
    function is being applied to. Typically, <span class="inlinecode"><span class="id" title="var">n</span></span> is equal to the length
    of the list of arguments <span class="inlinecode"><span class="id" title="var">vs</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="PrimitiveNaryFun.var_fixs" class="idref" href="#PrimitiveNaryFun.var_fixs"><span class="id" title="definition">var_fixs</span></a> (<a id="f:325" class="idref" href="#f:325"><span class="id" title="binder">f</span></a>:<a class="idref" href="LibSepVar.html#var"><span class="id" title="definition">var</span></a>) (<a id="xs:326" class="idref" href="#xs:326"><span class="id" title="binder">xs</span></a>:<a class="idref" href="Rich.html#PrimitiveNaryFun.vars"><span class="id" title="definition">vars</span></a>) (<a id="n:327" class="idref" href="#n:327"><span class="id" title="binder">n</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="inductive">LibList.noduplicates</span> (<a class="idref" href="Rich.html#f:325"><span class="id" title="variable">f</span></a><span class="id" title="notation">::</span><a class="idref" href="Rich.html#xs:326"><span class="id" title="variable">xs</span></a>)<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Rich.html#xs:326"><span class="id" title="variable">xs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Rich.html#n:327"><span class="id" title="variable">n</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Rich.html#xs:326"><span class="id" title="variable">xs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>.<br/>
</div>

<div class="doc">
The evaluation of a recursive function <span class="inlinecode"><span class="id" title="var">v<sub>0</sub></span></span> defined as <span class="inlinecode"><span class="id" title="var">val_fixs</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">xs</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>
    on a list of arguments <span class="inlinecode"><span class="id" title="var">vs</span></span> triggers the evaluation of the term
    <span class="inlinecode"><span class="id" title="var">substn</span></span> <span class="inlinecode"><span class="id" title="var">xs</span></span> <span class="inlinecode"><span class="id" title="var">vs</span></span> <span class="inlinecode">(<span class="id" title="tactic">subst</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">v<sub>0</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span>)</span>, same as <span class="inlinecode"><span class="id" title="var">substn</span></span> <span class="inlinecode">(<span class="id" title="var">f</span>::<span class="id" title="var">xs</span>)</span> <span class="inlinecode">(<span class="id" title="var">v<sub>0</sub></span>::<span class="id" title="var">vs</span>)</span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>.
    The evaluation rule is stated as follows, using the predicate <span class="inlinecode"><span class="id" title="var">var_fixs</span></span>
    to enforce the appropriate invariants on the variable names. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="PrimitiveNaryFun.eval_apps_fixs" class="idref" href="#PrimitiveNaryFun.eval_apps_fixs"><span class="id" title="axiom">eval_apps_fixs</span></a> : <span class="id" title="keyword">∀</span> <a id="v<sub>0</sub>:328" class="idref" href="#v<sub>0</sub>:328"><span class="id" title="binder">v<sub>0</sub></span></a> <a id="vs:329" class="idref" href="#vs:329"><span class="id" title="binder">vs</span></a> <a id="f:330" class="idref" href="#f:330"><span class="id" title="binder">f</span></a> <a id="xs:331" class="idref" href="#xs:331"><span class="id" title="binder">xs</span></a> <a id="t<sub>1</sub>:332" class="idref" href="#t<sub>1</sub>:332"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="s<sub>1</sub>:333" class="idref" href="#s<sub>1</sub>:333"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="s<sub>2</sub>:334" class="idref" href="#s<sub>2</sub>:334"><span class="id" title="binder">s<sub>2</sub></span></a> <a id="r:335" class="idref" href="#r:335"><span class="id" title="binder">r</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#v<sub>0</sub>:328"><span class="id" title="variable">v<sub>0</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Rich.html#PrimitiveNaryFun.val_fixs"><span class="id" title="axiom">val_fixs</span></a> <a class="idref" href="Rich.html#f:330"><span class="id" title="variable">f</span></a> <a class="idref" href="Rich.html#xs:331"><span class="id" title="variable">xs</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:332"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#PrimitiveNaryFun.var_fixs"><span class="id" title="definition">var_fixs</span></a> <a class="idref" href="Rich.html#f:330"><span class="id" title="variable">f</span></a> <a class="idref" href="Rich.html#xs:331"><span class="id" title="variable">xs</span></a> (<span class="id" title="definition">LibList.length</span> <a class="idref" href="Rich.html#vs:329"><span class="id" title="variable">vs</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Rich.html#s<sub>1</sub>:333"><span class="id" title="variable">s<sub>1</sub></span></a> (<a class="idref" href="Rich.html#PrimitiveNaryFun.substn"><span class="id" title="definition">substn</span></a> (<a class="idref" href="Rich.html#f:330"><span class="id" title="variable">f</span></a><span class="id" title="notation">::</span><a class="idref" href="Rich.html#xs:331"><span class="id" title="variable">xs</span></a>) (<a class="idref" href="Rich.html#v<sub>0</sub>:328"><span class="id" title="variable">v<sub>0</sub></span></a><span class="id" title="notation">::</span><a class="idref" href="Rich.html#vs:329"><span class="id" title="variable">vs</span></a>) <a class="idref" href="Rich.html#t<sub>1</sub>:332"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="Rich.html#s<sub>2</sub>:334"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Rich.html#r:335"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Rich.html#s<sub>1</sub>:333"><span class="id" title="variable">s<sub>1</sub></span></a> (<a class="idref" href="Rich.html#PrimitiveNaryFun.trm_apps"><span class="id" title="axiom">trm_apps</span></a> <a class="idref" href="Rich.html#v<sub>0</sub>:328"><span class="id" title="variable">v<sub>0</sub></span></a> (<a class="idref" href="Rich.html#PrimitiveNaryFun.trms_vals"><span class="id" title="definition">trms_vals</span></a> <a class="idref" href="Rich.html#vs:329"><span class="id" title="variable">vs</span></a>)) <a class="idref" href="Rich.html#s<sub>2</sub>:334"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Rich.html#r:335"><span class="id" title="variable">r</span></a>.<br/>
</div>

<div class="doc">
The corresponding reasoning rule admits a somewhat similar statement. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="PrimitiveNaryFun.triple_apps_fixs" class="idref" href="#PrimitiveNaryFun.triple_apps_fixs"><span class="id" title="lemma">triple_apps_fixs</span></a> : <span class="id" title="keyword">∀</span> <a id="v<sub>0</sub>:337" class="idref" href="#v<sub>0</sub>:337"><span class="id" title="binder">v<sub>0</sub></span></a> <a id="vs:338" class="idref" href="#vs:338"><span class="id" title="binder">vs</span></a> <a id="f:339" class="idref" href="#f:339"><span class="id" title="binder">f</span></a> <a id="xs:340" class="idref" href="#xs:340"><span class="id" title="binder">xs</span></a> <a id="t<sub>1</sub>:341" class="idref" href="#t<sub>1</sub>:341"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="H:342" class="idref" href="#H:342"><span class="id" title="binder">H</span></a> <a id="Q:343" class="idref" href="#Q:343"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#v<sub>0</sub>:337"><span class="id" title="variable">v<sub>0</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Rich.html#PrimitiveNaryFun.val_fixs"><span class="id" title="axiom">val_fixs</span></a> <a class="idref" href="Rich.html#f:339"><span class="id" title="variable">f</span></a> <a class="idref" href="Rich.html#xs:340"><span class="id" title="variable">xs</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:341"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#PrimitiveNaryFun.var_fixs"><span class="id" title="definition">var_fixs</span></a> <a class="idref" href="Rich.html#f:339"><span class="id" title="variable">f</span></a> <a class="idref" href="Rich.html#xs:340"><span class="id" title="variable">xs</span></a> (<span class="id" title="definition">LibList.length</span> <a class="idref" href="Rich.html#vs:338"><span class="id" title="variable">vs</span></a>)<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Rich.html#PrimitiveNaryFun.substn"><span class="id" title="definition">substn</span></a> (<a class="idref" href="Rich.html#f:339"><span class="id" title="variable">f</span></a><span class="id" title="notation">::</span><a class="idref" href="Rich.html#xs:340"><span class="id" title="variable">xs</span></a>) (<a class="idref" href="Rich.html#v<sub>0</sub>:337"><span class="id" title="variable">v<sub>0</sub></span></a><span class="id" title="notation">::</span><a class="idref" href="Rich.html#vs:338"><span class="id" title="variable">vs</span></a>) <a class="idref" href="Rich.html#t<sub>1</sub>:341"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="Rich.html#H:342"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q:343"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Rich.html#PrimitiveNaryFun.trm_apps"><span class="id" title="axiom">trm_apps</span></a> <a class="idref" href="Rich.html#v<sub>0</sub>:337"><span class="id" title="variable">v<sub>0</sub></span></a> <a class="idref" href="Rich.html#vs:338"><span class="id" title="variable">vs</span></a>) <a class="idref" href="Rich.html#H:342"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q:343"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">E</span> <span class="id" title="var">N</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_eval_like"><span class="id" title="lemma">triple_eval_like</span></a> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">R</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Rich.html#PrimitiveNaryFun.eval_apps_fixs"><span class="id" title="axiom">eval_apps_fixs</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The statement of the above lemma applies only to terms that are
    of the form <span class="inlinecode"><span class="id" title="var">trm_apps</span></span> <span class="inlinecode">(<span class="id" title="var">trm_val</span></span> <span class="inlinecode"><span class="id" title="var">v<sub>0</sub></span>)</span> <span class="inlinecode">(<span class="id" title="var">trms_vals</span></span> <span class="inlinecode"><span class="id" title="var">vs</span>)</span>. Yet, in practice,
    goals are generally of the form
    <span class="inlinecode"><span class="id" title="var">trm_apps</span></span> <span class="inlinecode">(<span class="id" title="var">trm_val</span></span> <span class="inlinecode"><span class="id" title="var">v<sub>0</sub></span>)</span> <span class="inlinecode">((<span class="id" title="var">trm_val</span></span> <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span>)::</span> <span class="inlinecode">..</span> <span class="inlinecode">::</span> <span class="inlinecode">(<span class="id" title="var">trm_val</span></span> <span class="inlinecode"><span class="id" title="var">vn</span>)::<span class="id" title="var">nil</span>)</span>.

<div class="paragraph"> </div>

    The two forms are convertible. Yet, in most cases, Coq is not able to
    synthesize the list <span class="inlinecode"><span class="id" title="var">vs</span></span> during the unification process.

<div class="paragraph"> </div>

    Fortunately, it is possible to reformulate the lemma using an auxiliary
    conversion function named <span class="inlinecode"><span class="id" title="var">trms_to_vals</span></span>, whose evaluation by Coq's
    unification process is able to synthesize the list <span class="inlinecode"><span class="id" title="var">vs</span></span>.

<div class="paragraph"> </div>

    The operation <span class="inlinecode"><span class="id" title="var">trms_to_vals</span></span> <span class="inlinecode"><span class="id" title="var">ts</span></span>, if all the terms in <span class="inlinecode"><span class="id" title="var">ts</span></span> are of the
    form <span class="inlinecode"><span class="id" title="var">trm_val</span></span> <span class="inlinecode"><span class="id" title="var">vi</span></span>, returns a list of values <span class="inlinecode"><span class="id" title="var">vs</span></span> such that <span class="inlinecode"><span class="id" title="var">ts</span></span> is
    equal to <span class="inlinecode"><span class="id" title="var">trms_vals</span></span> <span class="inlinecode"><span class="id" title="var">vs</span></span>. Otherwise, the operation returns <span class="inlinecode"><span class="id" title="var">None</span></span>.
    The definition and specification of the operation <span class="inlinecode"><span class="id" title="var">trms_to_vals</span></span>
    are as follows. 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <a id="PrimitiveNaryFun.trms_to_vals" class="idref" href="#PrimitiveNaryFun.trms_to_vals"><span class="id" title="definition">trms_to_vals</span></a> (<a id="ts:344" class="idref" href="#ts:344"><span class="id" title="binder">ts</span></a>:<a class="idref" href="Rich.html#PrimitiveNaryFun.trms"><span class="id" title="definition">trms</span></a>) : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="Rich.html#PrimitiveNaryFun.vals"><span class="id" title="definition">vals</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Rich.html#ts:344"><span class="id" title="variable">ts</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a><br/>
&nbsp;&nbsp;| <span class="id" title="notation">(</span><a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <span class="id" title="var">v</span><span class="id" title="notation">)::</span><span class="id" title="var">ts'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Rich.html#trms_to_vals:345"><span class="id" title="definition">trms_to_vals</span></a> <span class="id" title="var">ts'</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">vs'</span> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<span class="id" title="var">v</span><span class="id" title="notation">::</span><span class="id" title="var">vs'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
The specification of the function <span class="inlinecode"><span class="id" title="var">trms_to_vals</span></span> asserts that if
    <span class="inlinecode"><span class="id" title="var">trms_to_vals</span></span> <span class="inlinecode"><span class="id" title="var">ts</span></span> produces some list of values <span class="inlinecode"><span class="id" title="var">vs</span></span>, then <span class="inlinecode"><span class="id" title="var">ts</span></span> is
    equal to <span class="inlinecode"><span class="id" title="var">trms_vals</span></span> <span class="inlinecode"><span class="id" title="var">vs</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="PrimitiveNaryFun.trms_to_vals_spec" class="idref" href="#PrimitiveNaryFun.trms_to_vals_spec"><span class="id" title="lemma">trms_to_vals_spec</span></a> : <span class="id" title="keyword">∀</span> <a id="ts:347" class="idref" href="#ts:347"><span class="id" title="binder">ts</span></a> <a id="vs:348" class="idref" href="#vs:348"><span class="id" title="binder">vs</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#PrimitiveNaryFun.trms_to_vals"><span class="id" title="definition">trms_to_vals</span></a> <a class="idref" href="Rich.html#ts:347"><span class="id" title="variable">ts</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Rich.html#vs:348"><span class="id" title="variable">vs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#ts:347"><span class="id" title="variable">ts</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Rich.html#PrimitiveNaryFun.trms_vals"><span class="id" title="definition">trms_vals</span></a> <a class="idref" href="Rich.html#vs:348"><span class="id" title="variable">vs</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">ts</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">ts</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">t</span> <span class="id" title="var">ts'</span>]; <span class="id" title="tactic">simpl</span>; <span class="id" title="var">introv</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">inverts</span> <span class="id" title="var">E</span>. <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> <span class="id" title="var">t</span>; <span class="id" title="var">inverts</span> <span class="id" title="var">E</span> <span class="id" title="keyword">as</span> <span class="id" title="var">E</span>. <span class="id" title="var">cases</span> (<a class="idref" href="Rich.html#PrimitiveNaryFun.trms_to_vals"><span class="id" title="definition">trms_to_vals</span></a> <span class="id" title="var">ts'</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">C</span>; <span class="id" title="var">inverts</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rename</span> <span class="id" title="var">v<sub>0</sub></span> <span class="id" title="var">into</span> <span class="id" title="var">vs'</span>. <span class="id" title="tactic">rewrite</span>* (<span class="id" title="var">IHts'</span> <span class="id" title="var">vs'</span>). }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Here is a demo showing how <span class="inlinecode"><span class="id" title="var">trms_to_vals</span></span> computes in practice. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="PrimitiveNaryFun.demo_trms_to_vals" class="idref" href="#PrimitiveNaryFun.demo_trms_to_vals"><span class="id" title="lemma">demo_trms_to_vals</span></a> : <span class="id" title="keyword">∀</span> <a id="v<sub>1</sub>:349" class="idref" href="#v<sub>1</sub>:349"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="v<sub>2</sub>:350" class="idref" href="#v<sub>2</sub>:350"><span class="id" title="binder">v<sub>2</sub></span></a> <a id="v<sub>3</sub>:351" class="idref" href="#v<sub>3</sub>:351"><span class="id" title="binder">v<sub>3</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">∃</span></a> <a id="vs:352" class="idref" href="#vs:352"><span class="id" title="binder">vs</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Rich.html#PrimitiveNaryFun.trms_to_vals"><span class="id" title="definition">trms_to_vals</span></a> (<span class="id" title="notation">(</span><a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <a class="idref" href="Rich.html#v<sub>1</sub>:349"><span class="id" title="variable">v<sub>1</sub></span></a><span class="id" title="notation">)::(</span><a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <a class="idref" href="Rich.html#v<sub>2</sub>:350"><span class="id" title="variable">v<sub>2</sub></span></a><span class="id" title="notation">)::(</span><a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <a class="idref" href="Rich.html#v<sub>3</sub>:351"><span class="id" title="variable">v<sub>3</sub></span></a><span class="id" title="notation">)::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Rich.html#vs:352"><span class="id" title="variable">vs</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Rich.html#vs:352"><span class="id" title="variable">vs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Rich.html#vs:352"><span class="id" title="variable">vs</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Activate&nbsp;the&nbsp;display&nbsp;of&nbsp;coercions&nbsp;to&nbsp;play&nbsp;this&nbsp;demo&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">esplit</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">eauto</span>. <span class="comment">(*&nbsp;Observe&nbsp;how&nbsp;<span class="inlinecode"><span class="id" title="var">vs</span></span>&nbsp;is&nbsp;inferred.&nbsp;*)</span><br/>
<span class="id" title="keyword">Abort</span>.<br/>
</div>

<div class="doc">
Using <span class="inlinecode"><span class="id" title="var">trms_to_vals</span></span>, we can reformulate the rule <span class="inlinecode"><span class="id" title="var">triple_apps_fixs</span></span>
    in such a way that the rule can be smoothly applied on goals of the
    form <span class="inlinecode"><span class="id" title="var">trm_apps</span></span> <span class="inlinecode">(<span class="id" title="var">trm_val</span></span> <span class="inlinecode"><span class="id" title="var">v<sub>0</sub></span>)</span> <span class="inlinecode">((<span class="id" title="var">trm_val</span></span> <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span>)::</span> <span class="inlinecode">..</span> <span class="inlinecode">::</span> <span class="inlinecode">(<span class="id" title="var">trm_val</span></span> <span class="inlinecode"><span class="id" title="var">vn</span>)::<span class="id" title="var">nil</span>)</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="PrimitiveNaryFun.triple_apps_fixs'" class="idref" href="#PrimitiveNaryFun.triple_apps_fixs'"><span class="id" title="lemma">triple_apps_fixs'</span></a> : <span class="id" title="keyword">∀</span> <a id="v<sub>0</sub>:353" class="idref" href="#v<sub>0</sub>:353"><span class="id" title="binder">v<sub>0</sub></span></a> <a id="ts:354" class="idref" href="#ts:354"><span class="id" title="binder">ts</span></a> <a id="vs:355" class="idref" href="#vs:355"><span class="id" title="binder">vs</span></a> <a id="f:356" class="idref" href="#f:356"><span class="id" title="binder">f</span></a> <a id="xs:357" class="idref" href="#xs:357"><span class="id" title="binder">xs</span></a> <a id="t<sub>1</sub>:358" class="idref" href="#t<sub>1</sub>:358"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="H:359" class="idref" href="#H:359"><span class="id" title="binder">H</span></a> <a id="Q:360" class="idref" href="#Q:360"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#v<sub>0</sub>:353"><span class="id" title="variable">v<sub>0</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Rich.html#PrimitiveNaryFun.val_fixs"><span class="id" title="axiom">val_fixs</span></a> <a class="idref" href="Rich.html#f:356"><span class="id" title="variable">f</span></a> <a class="idref" href="Rich.html#xs:357"><span class="id" title="variable">xs</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:358"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#PrimitiveNaryFun.trms_to_vals"><span class="id" title="definition">trms_to_vals</span></a> <a class="idref" href="Rich.html#ts:354"><span class="id" title="variable">ts</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Rich.html#vs:355"><span class="id" title="variable">vs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#PrimitiveNaryFun.var_fixs"><span class="id" title="definition">var_fixs</span></a> <a class="idref" href="Rich.html#f:356"><span class="id" title="variable">f</span></a> <a class="idref" href="Rich.html#xs:357"><span class="id" title="variable">xs</span></a> (<span class="id" title="definition">LibList.length</span> <a class="idref" href="Rich.html#vs:355"><span class="id" title="variable">vs</span></a>)<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Rich.html#PrimitiveNaryFun.substn"><span class="id" title="definition">substn</span></a> (<a class="idref" href="Rich.html#f:356"><span class="id" title="variable">f</span></a><span class="id" title="notation">::</span><a class="idref" href="Rich.html#xs:357"><span class="id" title="variable">xs</span></a>) (<a class="idref" href="Rich.html#v<sub>0</sub>:353"><span class="id" title="variable">v<sub>0</sub></span></a><span class="id" title="notation">::</span><a class="idref" href="Rich.html#vs:355"><span class="id" title="variable">vs</span></a>) <a class="idref" href="Rich.html#t<sub>1</sub>:358"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="Rich.html#H:359"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q:360"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Rich.html#PrimitiveNaryFun.trm_apps"><span class="id" title="axiom">trm_apps</span></a> <a class="idref" href="Rich.html#v<sub>0</sub>:353"><span class="id" title="variable">v<sub>0</sub></span></a> <a class="idref" href="Rich.html#ts:354"><span class="id" title="variable">ts</span></a>) <a class="idref" href="Rich.html#H:359"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q:360"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">E</span> <span class="id" title="var">T</span> <span class="id" title="var">N</span> <span class="id" title="var">M</span>. <span class="id" title="var">rewrites</span> (@<a class="idref" href="Rich.html#PrimitiveNaryFun.trms_to_vals_spec"><span class="id" title="lemma">trms_to_vals_spec</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">T</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span>* <a class="idref" href="Rich.html#PrimitiveNaryFun.triple_apps_fixs"><span class="id" title="lemma">triple_apps_fixs</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Finally, let us show how to integrate the rule <span class="inlinecode"><span class="id" title="var">triple_apps_fixs'</span></span> into
    the tactic <span class="inlinecode"><span class="id" title="var">xwp</span></span>. To that end, we reformulate the rule by making two
    small changes.

<div class="paragraph"> </div>

    The first change consists of replacing the predicate <span class="inlinecode"><span class="id" title="var">var_fixs</span></span> which checks
    the well-formedness properties of the list of variables <span class="inlinecode"><span class="id" title="var">xs</span></span> by an
    executable version of this predicate, with a result in <span class="inlinecode"><span class="id" title="var">bool</span></span>. This way,
    the tactic <span class="inlinecode"><span class="id" title="tactic">reflexivity</span></span> can prove all the desired facts, when the lemma
    in invoked on a concrete function. We omit the details, and simply
    state the type of the boolean function <span class="inlinecode"><span class="id" title="var">var_fixs_exec</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="PrimitiveNaryFun.var_fixs_exec" class="idref" href="#PrimitiveNaryFun.var_fixs_exec"><span class="id" title="axiom">var_fixs_exec</span></a> : <a class="idref" href="LibSepVar.html#var"><span class="id" title="definition">var</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Rich.html#PrimitiveNaryFun.vars"><span class="id" title="definition">vars</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>.<br/>
</div>

<div class="doc">
The second change consists of introducing the <span class="inlinecode"><span class="id" title="var">wpgen</span></span> function for
    reasoning about the body of the function. Concretely, the substitution
    <span class="inlinecode"><span class="id" title="var">substn</span></span> <span class="inlinecode">(<span class="id" title="var">f</span>::<span class="id" title="var">xs</span>)</span> <span class="inlinecode">(<span class="id" title="var">v<sub>0</sub></span>::<span class="id" title="var">vs</span>)</span> is described by the substitution context
    <span class="inlinecode"><span class="id" title="var">List.combine</span></span> <span class="inlinecode">(<span class="id" title="var">f</span>::<span class="id" title="var">xs</span>)</span> <span class="inlinecode">(<span class="id" title="var">v<sub>0</sub></span>::<span class="id" title="var">vs</span>)</span>.

<div class="paragraph"> </div>

    The statement of the lemma for <span class="inlinecode"><span class="id" title="var">xwp</span></span> is as follows. We omit the proof
    details. (They may be found in the implementation of the CFML tool.) 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="PrimitiveNaryFun.xwp_lemma_fixs" class="idref" href="#PrimitiveNaryFun.xwp_lemma_fixs"><span class="id" title="axiom">xwp_lemma_fixs</span></a> : <span class="id" title="keyword">∀</span> <a id="v<sub>0</sub>:362" class="idref" href="#v<sub>0</sub>:362"><span class="id" title="binder">v<sub>0</sub></span></a> <a id="ts:363" class="idref" href="#ts:363"><span class="id" title="binder">ts</span></a> <a id="vs:364" class="idref" href="#vs:364"><span class="id" title="binder">vs</span></a> <a id="f:365" class="idref" href="#f:365"><span class="id" title="binder">f</span></a> <a id="xs:366" class="idref" href="#xs:366"><span class="id" title="binder">xs</span></a> <a id="t<sub>1</sub>:367" class="idref" href="#t<sub>1</sub>:367"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="H:368" class="idref" href="#H:368"><span class="id" title="binder">H</span></a> <a id="Q:369" class="idref" href="#Q:369"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#v<sub>0</sub>:362"><span class="id" title="variable">v<sub>0</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Rich.html#PrimitiveNaryFun.val_fixs"><span class="id" title="axiom">val_fixs</span></a> <a class="idref" href="Rich.html#f:365"><span class="id" title="variable">f</span></a> <a class="idref" href="Rich.html#xs:366"><span class="id" title="variable">xs</span></a> <a class="idref" href="Rich.html#t<sub>1</sub>:367"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#PrimitiveNaryFun.trms_to_vals"><span class="id" title="definition">trms_to_vals</span></a> <a class="idref" href="Rich.html#ts:363"><span class="id" title="variable">ts</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Rich.html#vs:364"><span class="id" title="variable">vs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#PrimitiveNaryFun.var_fixs_exec"><span class="id" title="axiom">var_fixs_exec</span></a> <a class="idref" href="Rich.html#f:365"><span class="id" title="variable">f</span></a> <a class="idref" href="Rich.html#xs:366"><span class="id" title="variable">xs</span></a> (<span class="id" title="definition">LibList.length</span> <a class="idref" href="Rich.html#vs:364"><span class="id" title="variable">vs</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Rich.html#H:368"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> (<a class="idref" href="LibSepReference.html#wpgen"><span class="id" title="definition">wpgen</span></a> (<span class="id" title="definition">combine</span> (<a class="idref" href="Rich.html#f:365"><span class="id" title="variable">f</span></a><span class="id" title="notation">::</span><a class="idref" href="Rich.html#xs:366"><span class="id" title="variable">xs</span></a>) (<a class="idref" href="Rich.html#v<sub>0</sub>:362"><span class="id" title="variable">v<sub>0</sub></span></a><span class="id" title="notation">::</span><a class="idref" href="Rich.html#vs:364"><span class="id" title="variable">vs</span></a>)) <a class="idref" href="Rich.html#t<sub>1</sub>:367"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="Rich.html#Q:369"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Rich.html#PrimitiveNaryFun.trm_apps"><span class="id" title="axiom">trm_apps</span></a> <a class="idref" href="Rich.html#v<sub>0</sub>:362"><span class="id" title="variable">v<sub>0</sub></span></a> <a class="idref" href="Rich.html#ts:363"><span class="id" title="variable">ts</span></a>) <a class="idref" href="Rich.html#H:368"><span class="id" title="variable">H</span></a> <a class="idref" href="Rich.html#Q:369"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
<a id="lab444"></a><h1 class="section">Optional Material</h1>

</div>

<div class="doc">
<a id="lab445"></a><h2 class="section">A Coercion for Parsing Primitive N-ary Applications</h2>

<div class="paragraph"> </div>

 One last practical detail for working with primitive n-ary functions
    in a smooth way consists of improving the parsing of applications.

<div class="paragraph"> </div>

    Writing an application in the form <span class="inlinecode"><span class="id" title="var">trm_apps</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode">(<span class="id" title="var">x</span>::<span class="id" title="var">y</span>::<span class="id" title="var">nil</span>)</span> to denote
    the application of a function <span class="inlinecode"><span class="id" title="var">f</span></span> to two arguments <span class="inlinecode"><span class="id" title="var">x</span></span> and <span class="inlinecode"><span class="id" title="var">y</span></span> is
    fairly verbose, in comparison with the syntax <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span>, which we were able
    to set up by declaring <span class="inlinecode"><span class="id" title="var">trm_app</span></span> as a <span class="inlinecode"><span class="id" title="var">Funclass</span></span> coercion---recall chapter
    <a href="Rules.html"><span class="inlineref">Rules</span></a>.

<div class="paragraph"> </div>

    If we simply declare <span class="inlinecode"><span class="id" title="var">trm_apps</span></span> as a <span class="inlinecode"><span class="id" title="var">Funclass</span></span> coercion, then we can
    write <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode">(<span class="id" title="var">x</span>::<span class="id" title="var">y</span>::<span class="id" title="var">nil</span>)</span> in place of <span class="inlinecode"><span class="id" title="var">trm_apps</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode">(<span class="id" title="var">x</span>::<span class="id" title="var">y</span>::<span class="id" title="var">nil</span>)</span>, however we
    still need to write the arguments in the form <span class="inlinecode"><span class="id" title="var">x</span>::<span class="id" title="var">y</span>::<span class="id" title="var">nil</span></span>.

<div class="paragraph"> </div>

    Fortunately, there is a trick that allows the expression <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> to be
    interpreted by Coq as <span class="inlinecode"><span class="id" title="var">trm_apps</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode">(<span class="id" title="var">x</span>::<span class="id" title="var">y</span>::<span class="id" title="var">nil</span>)</span>. This trick is arity-generic:
    it works for any number of arguments. It is described next. 
</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="PrimitiveNaryFun.NarySyntax" class="idref" href="#PrimitiveNaryFun.NarySyntax"><span class="id" title="module">NarySyntax</span></a>.<br/>
</div>

<div class="doc">
To explain the working of our coercion trick, let us consider a simplified
    grammar of terms, including only the constructor <span class="inlinecode"><span class="id" title="var">trm_apps</span></span> for n-ary
    applications, and the construct <span class="inlinecode"><span class="id" title="var">trm_val</span></span> for values. 
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <a id="PrimitiveNaryFun.NarySyntax.trm" class="idref" href="#PrimitiveNaryFun.NarySyntax.trm"><span class="id" title="inductive">trm</span></a> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <a id="PrimitiveNaryFun.NarySyntax.trm_val" class="idref" href="#PrimitiveNaryFun.NarySyntax.trm_val"><span class="id" title="constructor">trm_val</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Rich.html#trm:371"><span class="id" title="inductive">trm</span></a><br/>
&nbsp;&nbsp;| <a id="PrimitiveNaryFun.NarySyntax.trm_apps" class="idref" href="#PrimitiveNaryFun.NarySyntax.trm_apps"><span class="id" title="constructor">trm_apps</span></a> : <a class="idref" href="Rich.html#trm:371"><span class="id" title="inductive">trm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Rich.html#trm:371"><span class="id" title="inductive">trm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Rich.html#trm:371"><span class="id" title="inductive">trm</span></a>.<br/>
</div>

<div class="doc">
We introduce the data type <span class="inlinecode"><span class="id" title="var">apps</span></span>, featuring two constructors named
    <span class="inlinecode"><span class="id" title="var">apps_init</span></span> and <span class="inlinecode"><span class="id" title="var">apps_next</span></span>, to represent the syntax tree. 
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <a id="PrimitiveNaryFun.NarySyntax.apps" class="idref" href="#PrimitiveNaryFun.NarySyntax.apps"><span class="id" title="inductive">apps</span></a> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <a id="PrimitiveNaryFun.NarySyntax.apps_init" class="idref" href="#PrimitiveNaryFun.NarySyntax.apps_init"><span class="id" title="constructor">apps_init</span></a> : <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.trm"><span class="id" title="inductive">trm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.trm"><span class="id" title="inductive">trm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Rich.html#apps:373"><span class="id" title="inductive">apps</span></a><br/>
&nbsp;&nbsp;| <a id="PrimitiveNaryFun.NarySyntax.apps_next" class="idref" href="#PrimitiveNaryFun.NarySyntax.apps_next"><span class="id" title="constructor">apps_next</span></a> : <a class="idref" href="Rich.html#apps:373"><span class="id" title="inductive">apps</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.trm"><span class="id" title="inductive">trm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Rich.html#apps:373"><span class="id" title="inductive">apps</span></a>.<br/>
</div>

<div class="doc">
For example, the term <span class="inlinecode"><span class="id" title="var">trm_apps</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode">(<span class="id" title="var">x</span>::<span class="id" title="var">y</span>::<span class="id" title="var">z</span>::<span class="id" title="var">nil</span>)</span> is represented
    as the expression <span class="inlinecode"><span class="id" title="var">apps_next</span></span> <span class="inlinecode">(<span class="id" title="var">apps_next</span></span> <span class="inlinecode">(<span class="id" title="var">apps_init</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">x</span>)</span> <span class="inlinecode"><span class="id" title="var">y</span>)</span> <span class="inlinecode"><span class="id" title="var">z</span></span>.

<div class="paragraph"> </div>

    Internally, the parsing proceeds as follows.

<div class="paragraph"> </div>

<ul class="doclist">
<li> The application of a term to a term, that is, <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>, gets interpreted
      via a <span class="inlinecode"><span class="id" title="var">Funclass</span></span> coercion as <span class="inlinecode"><span class="id" title="var">apps_init</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>, which is an expression
      of type <span class="inlinecode"><span class="id" title="var">apps</span></span>.

</li>
<li> The application of an object of type <span class="inlinecode"><span class="id" title="var">apps</span></span> to a term, that is <span class="inlinecode"><span class="id" title="var">a<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>,
      gets interpreted via another <span class="inlinecode"><span class="id" title="var">Funclass</span></span> coercion as <span class="inlinecode"><span class="id" title="var">apps_next</span></span> <span class="inlinecode"><span class="id" title="var">a<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>.

</li>
</ul>

<div class="paragraph"> </div>


</div>
<div class="code">

<span class="id" title="keyword">Coercion</span> <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.apps_init"><span class="id" title="constructor">apps_init</span></a> <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.apps_init"><span class="id" title="constructor">:</span></a> <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.apps_init"><span class="id" title="constructor">trm</span></a> <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.apps_init"><span class="id" title="constructor">&gt;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.apps_init"><span class="id" title="constructor">Funclass</span></a>.<br/>
<span class="id" title="keyword">Coercion</span> <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.apps_next"><span class="id" title="constructor">apps_next</span></a> <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.apps_next"><span class="id" title="constructor">:</span></a> <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.apps_next"><span class="id" title="constructor">apps</span></a> <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.apps_next"><span class="id" title="constructor">&gt;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.apps_next"><span class="id" title="constructor">Funclass</span></a>.<br/>
</div>

<div class="doc">
From a term of the form <span class="inlinecode"><span class="id" title="var">apps_next</span></span> <span class="inlinecode">(<span class="id" title="var">apps_next</span></span> <span class="inlinecode">(<span class="id" title="var">apps_init</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">x</span>)</span> <span class="inlinecode"><span class="id" title="var">y</span>)</span> <span class="inlinecode"><span class="id" title="var">z</span></span>,
    the corresponding application <span class="inlinecode"><span class="id" title="var">trm_apps</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode">(<span class="id" title="var">x</span>::<span class="id" title="var">y</span>::<span class="id" title="var">z</span>::<span class="id" title="var">nil</span>)</span> can be computed
    by a Coq function, called <span class="inlinecode"><span class="id" title="var">apps_to_trm</span></span>, that processes the syntax tree
    of the <span class="inlinecode"><span class="id" title="var">apps</span></span> expression. This function is implemented recursively.

<div class="paragraph"> </div>

<ul class="doclist">
<li> In the base case, <span class="inlinecode"><span class="id" title="var">apps_init</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> describes the application
      of a function to one argument: <span class="inlinecode"><span class="id" title="var">trm_apps</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode">(<span class="id" title="var">t<sub>2</sub></span>::<span class="id" title="var">nil</span>)</span>.

</li>
<li> In the "next" case, if an apps structure <span class="inlinecode"><span class="id" title="var">a<sub>1</sub></span></span> describes a term
      <span class="inlinecode"><span class="id" title="var">trm_apps</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>0</sub></span></span> <span class="inlinecode"><span class="id" title="var">ts</span></span>, then <span class="inlinecode"><span class="id" title="var">apps_next</span></span> <span class="inlinecode"><span class="id" title="var">a<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> describes the term
      <span class="inlinecode"><span class="id" title="var">trm_apps</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>0</sub></span></span> <span class="inlinecode">(<span class="id" title="var">ts</span>++<span class="id" title="var">t<sub>2</sub></span>::<span class="id" title="var">nil</span>)</span>, that is, an application to one more
      argument. 

</li>
</ul>
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <a id="PrimitiveNaryFun.NarySyntax.apps_to_trm" class="idref" href="#PrimitiveNaryFun.NarySyntax.apps_to_trm"><span class="id" title="definition">apps_to_trm</span></a> (<a id="a:375" class="idref" href="#a:375"><span class="id" title="binder">a</span></a>:<a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.apps"><span class="id" title="inductive">apps</span></a>) : <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.trm"><span class="id" title="inductive">trm</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Rich.html#a:375"><span class="id" title="variable">a</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.apps_init"><span class="id" title="constructor">apps_init</span></a> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> ⇒ <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.trm_apps"><span class="id" title="constructor">trm_apps</span></a> <span class="id" title="var">t<sub>1</sub></span> (<span class="id" title="var">t<sub>2</sub></span><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>)<br/>
&nbsp;&nbsp;| <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.apps_next"><span class="id" title="constructor">apps_next</span></a> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Rich.html#apps_to_trm:376"><span class="id" title="definition">apps_to_trm</span></a> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.trm_apps"><span class="id" title="constructor">trm_apps</span></a> <span class="id" title="var">t<sub>0</sub></span> <span class="id" title="var">ts</span> ⇒ <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.trm_apps"><span class="id" title="constructor">trm_apps</span></a> <span class="id" title="var">t<sub>0</sub></span> (<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#app"><span class="id" title="abbreviation">List.app</span></a> <span class="id" title="var">ts</span> (<span class="id" title="var">t<sub>2</sub></span><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">t<sub>0</sub></span> ⇒ <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.trm_apps"><span class="id" title="constructor">trm_apps</span></a> <span class="id" title="var">t<sub>0</sub></span> (<span class="id" title="var">t<sub>2</sub></span><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
The function <span class="inlinecode"><span class="id" title="var">apps_to_trm</span></span> is declared as a coercion from <span class="inlinecode"><span class="id" title="var">apps</span></span>
    to <span class="inlinecode"><span class="id" title="var">trm</span></span>, so that any iterated application can be interpreted as
    the corresponding <span class="inlinecode"><span class="id" title="var">trm_apps</span></span> term. Coq raises an "ambiguous coercion
    path" warning, but this warning may be safely ignored here. 
</div>
<div class="code">

<span class="id" title="keyword">Coercion</span> <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.apps_to_trm"><span class="id" title="definition">apps_to_trm</span></a> <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.apps_to_trm"><span class="id" title="definition">:</span></a> <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.apps_to_trm"><span class="id" title="definition">apps</span></a> <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.apps_to_trm"><span class="id" title="definition">&gt;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.apps_to_trm"><span class="id" title="definition">trm</span></a>.<br/>
</div>

<div class="doc">
The following demo shows how the term <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode"><span class="id" title="var">z</span></span> is parsed as
    <span class="inlinecode"><span class="id" title="var">apps_to_trm</span></span> <span class="inlinecode">(<span class="id" title="var">apps_next</span></span> <span class="inlinecode">(<span class="id" title="var">apps_next</span></span> <span class="inlinecode">(<span class="id" title="var">apps_init</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">x</span>)</span> <span class="inlinecode"><span class="id" title="var">y</span>)</span> <span class="inlinecode"><span class="id" title="var">z</span>)</span>, which
    then simplifies by <span class="inlinecode"><span class="id" title="tactic">simpl</span></span> to <span class="inlinecode"><span class="id" title="var">trm_apps</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode">(<span class="id" title="var">x</span>::<span class="id" title="var">y</span>::<span class="id" title="var">z</span>::<span class="id" title="var">nil</span>)</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="PrimitiveNaryFun.NarySyntax.apps_demo" class="idref" href="#PrimitiveNaryFun.NarySyntax.apps_demo"><span class="id" title="lemma">apps_demo</span></a> : <span class="id" title="keyword">∀</span> (<a id="f:378" class="idref" href="#f:378"><span class="id" title="binder">f</span></a> <a id="x:379" class="idref" href="#x:379"><span class="id" title="binder">x</span></a> <a id="y:380" class="idref" href="#y:380"><span class="id" title="binder">y</span></a> <a id="z:381" class="idref" href="#z:381"><span class="id" title="binder">z</span></a>:<a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.trm"><span class="id" title="inductive">trm</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="Rich.html#f:378"><span class="id" title="variable">f</span></a> <a class="idref" href="Rich.html#x:379"><span class="id" title="variable">x</span></a> <a class="idref" href="Rich.html#y:380"><span class="id" title="variable">y</span></a> <a class="idref" href="Rich.html#z:381"><span class="id" title="variable">z</span></a> : <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.trm"><span class="id" title="inductive">trm</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax.trm_apps"><span class="id" title="constructor">trm_apps</span></a> <a class="idref" href="Rich.html#f:378"><span class="id" title="variable">f</span></a> (<a class="idref" href="Rich.html#x:379"><span class="id" title="variable">x</span></a><span class="id" title="notation">::</span><a class="idref" href="Rich.html#y:380"><span class="id" title="variable">y</span></a><span class="id" title="notation">::</span><a class="idref" href="Rich.html#z:381"><span class="id" title="variable">z</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="comment">(*&nbsp;activate&nbsp;display&nbsp;of&nbsp;coercions&nbsp;*)</span> <span class="id" title="tactic">simpl</span>. <span class="id" title="keyword">Abort</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="Rich.html#PrimitiveNaryFun.NarySyntax"><span class="id" title="module">NarySyntax</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="Rich.html#PrimitiveNaryFun"><span class="id" title="module">PrimitiveNaryFun</span></a>.<br/>
</div>

<div class="doc">
<a id="lab446"></a><h2 class="section">Historical Notes</h2>

<div class="paragraph"> </div>

 Regarding while loops, the possibility to frame over the remaining
    iterations, as illustrated with the example of <span class="inlinecode"><span class="id" title="var">triple_mlength_loop</span></span>,
    is inherently available when a loop is encoded as a recursive functions,
    or when a loop is presented in CPS-style (typical with assembly-level
    code). The statement of a reasoning rule directly applicable to a
    non-encoded loop construct, and allowing to frame over the remaining
    iterations, has appeared independently in work by <a href="Bib.html#Charguéraud-2010"><span class="inlineref">[Charguéraud 2010]</span></a>
    and <a href="Bib.html#Tuerk-2010"><span class="inlineref">[Tuerk 2010]</span></a>. 
</div>
<div class="code">

<span class="comment">(*&nbsp;2022-08-01&nbsp;19:03&nbsp;*)</span><br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>