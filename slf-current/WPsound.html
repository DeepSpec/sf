<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>WPsound: Soundness of the Weakest Precondition Generator</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/slf.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 6: Separation Logic Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">WPsound<span class="subtitle">Soundness of the Weakest Precondition Generator</span></h1>


<div class="code">

<span class="id" title="keyword">Set Implicit Arguments</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">SLF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="WPsem.html#"><span class="id" title="library">WPsem</span></a> <a class="idref" href="WPgen.html#"><span class="id" title="library">WPgen</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="WPgen.html#WPgenRec"><span class="id" title="module">WPgenRec</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">f</span> : <a class="idref" href="LibSepVar.html#var"><span class="id" title="definition">var</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">b</span> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">v</span> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">h</span> : <a class="idref" href="LibSepReference.html#heap"><span class="id" title="definition">heap</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">P</span> : <span class="id" title="keyword">Prop</span>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">H</span> : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">Q</span> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>.<br/>
</div>

<div class="doc">
<a id="lab374"></a><h1 class="section">More Details</h1>

<div class="paragraph"> </div>

 This chapter develops the soundness proof for <span class="inlinecode"><span class="id" title="var">wpgen</span></span>. The key theorem
    asserts that, for any term and and postcondition, <span class="inlinecode"><span class="id" title="var">wpgen</span></span> (on an empty
    substitution context) yields a formula that entails <span class="inlinecode"><span class="id" title="var">wp</span></span>. Formally:
    <span class="inlinecode"><span class="id" title="var">wpgen</span></span> <span class="inlinecode"><span class="id" title="var">nil</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>. The present "more details" section contains the
    proof of this theorem. The "optional material" section details the proofs of
    two technical lemmas related to permutation of substitutions. This chapter
    may be safely skipped. 
</div>

<div class="doc">
<a id="lab375"></a><h2 class="section">Definition of the Predicate <span class="inlinecode"><span class="id" title="var">formula_sound</span></span></h2>

<div class="paragraph"> </div>

 The soundness theorem that we aim to establish for <span class="inlinecode"><span class="id" title="var">wpgen</span></span> is:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Parameter</span> <span class="id" title="var">wpgen_sound</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">E</span> <span class="id" title="var">t</span> <span class="id" title="var">Q</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">wpgen</span> <span class="id" title="var">E</span> <span class="id" title="var">t</span> <span class="id" title="var">Q</span> ==&gt; <span class="id" title="var">wp</span> (<span class="id" title="var">isubst</span> <span class="id" title="var">E</span> <span class="id" title="var">t</span>) <span class="id" title="var">Q</span>.
</span>
<div class="paragraph"> </div>

 Before entering into the details of the proof, let us reformulate the
    statement of the soundness theorem to make proof obligations and induction
    hypotheses easier to read. To that end, we introduce the predicate
    <span class="inlinecode"><span class="id" title="var">formula_sound</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">F</span></span>, read "F is a formula sound for t". It asserts that <span class="inlinecode"><span class="id" title="var">F</span></span>
    is a weakest-precondition style formula that entails <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>. Formally: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="formula_sound" class="idref" href="#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a id="t:1" class="idref" href="#t:1"><span class="id" title="binder">t</span></a>:<a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>) (<a id="F:2" class="idref" href="#F:2"><span class="id" title="binder">F</span></a>:<a class="idref" href="WPgen.html#formula"><span class="id" title="definition">formula</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="Q:3" class="idref" href="#Q:3"><span class="id" title="binder">Q</span></a>, <a class="idref" href="WPsound.html#F:2"><span class="id" title="variable">F</span></a> <a class="idref" href="WPsound.html#Q:3"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsound.html#t:1"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsound.html#Q:3"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
Using <span class="inlinecode"><span class="id" title="var">formula_sound</span></span>, the soundness theorem for <span class="inlinecode"><span class="id" title="var">wpgen</span></span> is reformulated as
    follows.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Parameter</span> <span class="id" title="var">wpgen_sound</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">E</span> <span class="id" title="var">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">formula_sound</span> (<span class="id" title="var">isubst</span> <span class="id" title="var">E</span> <span class="id" title="var">t</span>) (<span class="id" title="var">wpgen</span> <span class="id" title="var">E</span> <span class="id" title="var">t</span>).
</span>
<div class="paragraph"> </div>

 The soundness theorem <span class="inlinecode"><span class="id" title="var">wpgen_sound</span></span> is proved by induction on <span class="inlinecode"><span class="id" title="var">t</span></span>. Each case
    of this inductive proof corresponds to a term construct. For each term
    construct, we need to exploit two lemmas. The first lemma, common to all
    term constructs, is called <span class="inlinecode"><span class="id" title="var">mkstruct_sound</span></span>, and is used to argue that the
    presence of <span class="inlinecode"><span class="id" title="var">mkstruct</span></span> in the definition of <span class="inlinecode"><span class="id" title="var">wpgen</span></span> is sound. The second
    lemma is specific to the term construct. For example, <span class="inlinecode"><span class="id" title="var">wpgen_sound_seq</span></span> is
    of the form <span class="inlinecode"><span class="id" title="var">formula_sound</span></span> <span class="inlinecode">(<span class="id" title="var">trm_seq</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span>)</span> <span class="inlinecode">(<span class="id" title="var">wpgen_seq</span></span> <span class="inlinecode"><span class="id" title="var">F<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">F<sub>2</sub></span>)</span>. We next
    explain the details of how to state and prove <span class="inlinecode"><span class="id" title="var">wpgen_sound_seq</span></span>, then
    present the other auxiliary lemmas useful for completing the proof by
    induction of <span class="inlinecode"><span class="id" title="var">wpgen_sound</span></span>. 
</div>

<div class="doc">
<a id="lab376"></a><h2 class="section">Soundness for the Case of Sequences</h2>

<div class="paragraph"> </div>

 Consider the soundness theorem <span class="inlinecode"><span class="id" title="var">wpgen_sound</span></span> and let us specialize it to the
    particular case where <span class="inlinecode"><span class="id" title="var">t</span></span> is of the form <span class="inlinecode"><span class="id" title="var">trm_seq</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>. The corresponding
    statement is: 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="wpgen_sound_seq_1" class="idref" href="#wpgen_sound_seq_1"><span class="id" title="axiom">wpgen_sound_seq_1</span></a> : <span class="id" title="keyword">∀</span> <a id="E:4" class="idref" href="#E:4"><span class="id" title="binder">E</span></a> <a id="t<sub>1</sub>:5" class="idref" href="#t<sub>1</sub>:5"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:6" class="idref" href="#t<sub>2</sub>:6"><span class="id" title="binder">t<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a class="idref" href="WPgen.html#isubst"><span class="id" title="definition">isubst</span></a> <a class="idref" href="WPsound.html#E:4"><span class="id" title="variable">E</span></a> (<a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> <a class="idref" href="WPsound.html#t<sub>1</sub>:5"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsound.html#t<sub>2</sub>:6"><span class="id" title="variable">t<sub>2</sub></span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="WPgen.html#WPgenRec.wpgen"><span class="id" title="definition">wpgen</span></a> <a class="idref" href="WPsound.html#E:4"><span class="id" title="variable">E</span></a> (<a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> <a class="idref" href="WPsound.html#t<sub>1</sub>:5"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsound.html#t<sub>2</sub>:6"><span class="id" title="variable">t<sub>2</sub></span></a>)).<br/>
</div>

<div class="doc">
Let us ignore <span class="inlinecode"><span class="id" title="var">mkstruct</span></span> for a minute -- that is, pretend that <span class="inlinecode"><span class="id" title="var">wpgen</span></span> is
    defined without <span class="inlinecode"><span class="id" title="var">mkstruct</span></span>. Under this assumption, <span class="inlinecode"><span class="id" title="var">wpgen</span></span> <span class="inlinecode"><span class="id" title="var">E</span></span> <span class="inlinecode">(<span class="id" title="var">trm_seq</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span>)</span>
    evaluates to <span class="inlinecode"><span class="id" title="var">wpgen_seq</span></span> <span class="inlinecode">(<span class="id" title="var">wpgen</span></span> <span class="inlinecode"><span class="id" title="var">E</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span>)</span> <span class="inlinecode">(<span class="id" title="var">wpgen</span></span> <span class="inlinecode"><span class="id" title="var">E</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span>)</span>. Besides, the expression
    <span class="inlinecode"><span class="id" title="var">isubst</span></span> <span class="inlinecode"><span class="id" title="var">E</span></span> <span class="inlinecode">(<span class="id" title="var">trm_seq</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span>)</span> evaluates to
    <span class="inlinecode"><span class="id" title="var">trm_seq</span></span> <span class="inlinecode">(<span class="id" title="var">isubst</span></span> <span class="inlinecode"><span class="id" title="var">E</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span>)</span> <span class="inlinecode">(<span class="id" title="var">isubst</span></span> <span class="inlinecode"><span class="id" title="var">E</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span>)</span>. Therefore, the soundness statement to
    establish can be reformulated as: 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="wpgen_sound_seq_2" class="idref" href="#wpgen_sound_seq_2"><span class="id" title="axiom">wpgen_sound_seq_2</span></a> : <span class="id" title="keyword">∀</span> <a id="E:8" class="idref" href="#E:8"><span class="id" title="binder">E</span></a> <a id="t<sub>1</sub>:9" class="idref" href="#t<sub>1</sub>:9"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:10" class="idref" href="#t<sub>2</sub>:10"><span class="id" title="binder">t<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> (<a class="idref" href="WPgen.html#isubst"><span class="id" title="definition">isubst</span></a> <a class="idref" href="WPsound.html#E:8"><span class="id" title="variable">E</span></a> <a class="idref" href="WPsound.html#t<sub>1</sub>:9"><span class="id" title="variable">t<sub>1</sub></span></a>) (<a class="idref" href="WPgen.html#isubst"><span class="id" title="definition">isubst</span></a> <a class="idref" href="WPsound.html#E:8"><span class="id" title="variable">E</span></a> <a class="idref" href="WPsound.html#t<sub>2</sub>:10"><span class="id" title="variable">t<sub>2</sub></span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="WPgen.html#wpgen_seq"><span class="id" title="definition">wpgen_seq</span></a> (<a class="idref" href="WPgen.html#WPgenRec.wpgen"><span class="id" title="definition">wpgen</span></a> <a class="idref" href="WPsound.html#E:8"><span class="id" title="variable">E</span></a> <a class="idref" href="WPsound.html#t<sub>1</sub>:9"><span class="id" title="variable">t<sub>1</sub></span></a>) (<a class="idref" href="WPgen.html#WPgenRec.wpgen"><span class="id" title="definition">wpgen</span></a> <a class="idref" href="WPsound.html#E:8"><span class="id" title="variable">E</span></a> <a class="idref" href="WPsound.html#t<sub>2</sub>:10"><span class="id" title="variable">t<sub>2</sub></span></a>)).<br/>
</div>

<div class="doc">
By induction hypothesis, we can assume that <span class="inlinecode"><span class="id" title="var">wpgen</span></span> <span class="inlinecode"><span class="id" title="var">E</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> is a sound formula
    for <span class="inlinecode"><span class="id" title="var">isubst</span></span> <span class="inlinecode"><span class="id" title="var">E</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>, and likewise <span class="inlinecode"><span class="id" title="var">wpgen</span></span> <span class="inlinecode"><span class="id" title="var">E</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> is a sound formula for
    <span class="inlinecode"><span class="id" title="var">isubst</span></span> <span class="inlinecode"><span class="id" title="var">E</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>. Thus, what we actually will need to prove as part of the
    induction is: 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="wpgen_sound_seq_3" class="idref" href="#wpgen_sound_seq_3"><span class="id" title="axiom">wpgen_sound_seq_3</span></a> : <span class="id" title="keyword">∀</span> <a id="E:12" class="idref" href="#E:12"><span class="id" title="binder">E</span></a> <a id="t<sub>1</sub>:13" class="idref" href="#t<sub>1</sub>:13"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:14" class="idref" href="#t<sub>2</sub>:14"><span class="id" title="binder">t<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a class="idref" href="WPgen.html#isubst"><span class="id" title="definition">isubst</span></a> <a class="idref" href="WPsound.html#E:12"><span class="id" title="variable">E</span></a> <a class="idref" href="WPsound.html#t<sub>1</sub>:13"><span class="id" title="variable">t<sub>1</sub></span></a>) (<a class="idref" href="WPgen.html#WPgenRec.wpgen"><span class="id" title="definition">wpgen</span></a> <a class="idref" href="WPsound.html#E:12"><span class="id" title="variable">E</span></a> <a class="idref" href="WPsound.html#t<sub>1</sub>:13"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a class="idref" href="WPgen.html#isubst"><span class="id" title="definition">isubst</span></a> <a class="idref" href="WPsound.html#E:12"><span class="id" title="variable">E</span></a> <a class="idref" href="WPsound.html#t<sub>2</sub>:14"><span class="id" title="variable">t<sub>2</sub></span></a>) (<a class="idref" href="WPgen.html#WPgenRec.wpgen"><span class="id" title="definition">wpgen</span></a> <a class="idref" href="WPsound.html#E:12"><span class="id" title="variable">E</span></a> <a class="idref" href="WPsound.html#t<sub>2</sub>:14"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> (<a class="idref" href="WPgen.html#isubst"><span class="id" title="definition">isubst</span></a> <a class="idref" href="WPsound.html#E:12"><span class="id" title="variable">E</span></a> <a class="idref" href="WPsound.html#t<sub>1</sub>:13"><span class="id" title="variable">t<sub>1</sub></span></a>) (<a class="idref" href="WPgen.html#isubst"><span class="id" title="definition">isubst</span></a> <a class="idref" href="WPsound.html#E:12"><span class="id" title="variable">E</span></a> <a class="idref" href="WPsound.html#t<sub>2</sub>:14"><span class="id" title="variable">t<sub>2</sub></span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="WPgen.html#wpgen_seq"><span class="id" title="definition">wpgen_seq</span></a> (<a class="idref" href="WPgen.html#WPgenRec.wpgen"><span class="id" title="definition">wpgen</span></a> <a class="idref" href="WPsound.html#E:12"><span class="id" title="variable">E</span></a> <a class="idref" href="WPsound.html#t<sub>1</sub>:13"><span class="id" title="variable">t<sub>1</sub></span></a>) (<a class="idref" href="WPgen.html#WPgenRec.wpgen"><span class="id" title="definition">wpgen</span></a> <a class="idref" href="WPsound.html#E:12"><span class="id" title="variable">E</span></a> <a class="idref" href="WPsound.html#t<sub>2</sub>:14"><span class="id" title="variable">t<sub>2</sub></span></a>)).<br/>
</div>

<div class="doc">
In the above statement, let us abstract <span class="inlinecode"><span class="id" title="var">isubst</span></span> <span class="inlinecode"><span class="id" title="var">E</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> as <span class="inlinecode"><span class="id" title="var">t<sub>1</sub>'</span></span> and
    <span class="inlinecode"><span class="id" title="var">wpgen</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> as <span class="inlinecode"><span class="id" title="var">F<sub>1</sub></span></span>, and similarly <span class="inlinecode"><span class="id" title="var">isubst</span></span> <span class="inlinecode"><span class="id" title="var">E</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> as <span class="inlinecode"><span class="id" title="var">t<sub>2</sub>'</span></span> and <span class="inlinecode"><span class="id" title="var">wpgen</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> as
    <span class="inlinecode"><span class="id" title="var">F<sub>2</sub></span></span>. The statement reformulates as: 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wpgen_seq_sound" class="idref" href="#wpgen_seq_sound"><span class="id" title="lemma">wpgen_seq_sound</span></a> : <span class="id" title="keyword">∀</span> <a id="t<sub>1</sub>':16" class="idref" href="#t<sub>1</sub>':16"><span class="id" title="binder">t<sub>1</sub>'</span></a> <a id="t<sub>2</sub>':17" class="idref" href="#t<sub>2</sub>':17"><span class="id" title="binder">t<sub>2</sub>'</span></a> <a id="F<sub>1</sub>:18" class="idref" href="#F<sub>1</sub>:18"><span class="id" title="binder">F<sub>1</sub></span></a> <a id="F<sub>2</sub>:19" class="idref" href="#F<sub>2</sub>:19"><span class="id" title="binder">F<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> <a class="idref" href="WPsound.html#t<sub>1</sub>':16"><span class="id" title="variable">t<sub>1</sub>'</span></a> <a class="idref" href="WPsound.html#F<sub>1</sub>:18"><span class="id" title="variable">F<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> <a class="idref" href="WPsound.html#t<sub>2</sub>':17"><span class="id" title="variable">t<sub>2</sub>'</span></a> <a class="idref" href="WPsound.html#F<sub>2</sub>:19"><span class="id" title="variable">F<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> <a class="idref" href="WPsound.html#t<sub>1</sub>':16"><span class="id" title="variable">t<sub>1</sub>'</span></a> <a class="idref" href="WPsound.html#t<sub>2</sub>':17"><span class="id" title="variable">t<sub>2</sub>'</span></a>) (<a class="idref" href="WPgen.html#wpgen_seq"><span class="id" title="definition">wpgen_seq</span></a> <a class="idref" href="WPsound.html#F<sub>1</sub>:18"><span class="id" title="variable">F<sub>1</sub></span></a> <a class="idref" href="WPsound.html#F<sub>2</sub>:19"><span class="id" title="variable">F<sub>2</sub></span></a>).<br/>
</div>

<div class="doc">
This statement captures the essence of the correctness of the definition of
    <span class="inlinecode"><span class="id" title="var">wpgen_seq</span></span>. Now let's prove it. 
</div>
<div class="code">

<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">S<sub>1</sub></span> <span class="id" title="var">S<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Reveal&nbsp;the&nbsp;soundness&nbsp;statement&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="var">unfolds</span> <a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Consider&nbsp;a&nbsp;postcondition&nbsp;<span class="inlinecode"><span class="id" title="var">Q</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Reveal&nbsp;<span class="inlinecode"><span class="id" title="var">wpgen_seq</span></span> <span class="inlinecode"><span class="id" title="var">F<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">F<sub>2</sub></span></span>,&nbsp;which&nbsp;is&nbsp;defined&nbsp;as&nbsp;<span class="inlinecode"><span class="id" title="var">F<sub>1</sub></span></span> <span class="inlinecode">(<span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">F<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">Q</span>)</span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="var">unfolds</span> <a class="idref" href="WPgen.html#wpgen_seq"><span class="id" title="definition">wpgen_seq</span></a>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;By&nbsp;transitivity&nbsp;of&nbsp;entailment&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans"><span class="id" title="lemma">himpl_trans</span></a>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Apply&nbsp;the&nbsp;wp-style&nbsp;reasoning&nbsp;rule&nbsp;for&nbsp;sequences:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode">(<span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">Q</span>)</span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode">(<span class="id" title="var">trm_seq</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span>)</span> <span class="inlinecode"><span class="id" title="var">Q</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;2:{ <span class="id" title="var">applys</span> <a class="idref" href="WPgen.html#wp_seq"><span class="id" title="axiom">wp_seq</span></a>. }<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Exploit&nbsp;the&nbsp;induction&nbsp;hypotheses&nbsp;to&nbsp;conclude&nbsp;*)</span><br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans"><span class="id" title="lemma">himpl_trans</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <span class="id" title="var">S<sub>1</sub></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="WPsem.html#wp_conseq"><span class="id" title="lemma">wp_conseq</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">v</span>. <span class="id" title="var">applys</span> <span class="id" title="var">S<sub>2</sub></span>. } }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab377"></a><h2 class="section">Soundness for the Other Term Constructs</h2>

<div class="paragraph"> </div>

 Similarly, for every other language construct, we state and prove a lemma
    about <span class="inlinecode"><span class="id" title="var">formula_sound</span></span>. The reader may skip over the proof details. What is
    most interesting here is the pattern followed by the statements. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wpgen_val_sound" class="idref" href="#wpgen_val_sound"><span class="id" title="lemma">wpgen_val_sound</span></a> : <span class="id" title="keyword">∀</span> <a id="v:20" class="idref" href="#v:20"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <a class="idref" href="WPsound.html#v:20"><span class="id" title="variable">v</span></a>) (<a class="idref" href="WPgen.html#wpgen_val"><span class="id" title="definition">wpgen_val</span></a> <a class="idref" href="WPsound.html#v:20"><span class="id" title="variable">v</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span>. <span class="id" title="var">unfolds</span> <a class="idref" href="WPgen.html#wpgen_val"><span class="id" title="definition">wpgen_val</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="WPgen.html#wp_val"><span class="id" title="axiom">wp_val</span></a>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="wpgen_let_sound" class="idref" href="#wpgen_let_sound"><span class="id" title="lemma">wpgen_let_sound</span></a> : <span class="id" title="keyword">∀</span> <a id="F<sub>1</sub>:21" class="idref" href="#F<sub>1</sub>:21"><span class="id" title="binder">F<sub>1</sub></span></a> <a id="F2of:22" class="idref" href="#F2of:22"><span class="id" title="binder">F2of</span></a> <a id="x:23" class="idref" href="#x:23"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:24" class="idref" href="#t<sub>1</sub>:24"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:25" class="idref" href="#t<sub>2</sub>:25"><span class="id" title="binder">t<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> <a class="idref" href="WPsound.html#t<sub>1</sub>:24"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsound.html#F<sub>1</sub>:21"><span class="id" title="variable">F<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="v:26" class="idref" href="#v:26"><span class="id" title="binder">v</span></a>, <a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="WPsound.html#x:23"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#v:26"><span class="id" title="variable">v</span></a> <a class="idref" href="WPsound.html#t<sub>2</sub>:25"><span class="id" title="variable">t<sub>2</sub></span></a>) (<a class="idref" href="WPsound.html#F2of:22"><span class="id" title="variable">F2of</span></a> <a class="idref" href="WPsound.html#v:26"><span class="id" title="variable">v</span></a>)<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="WPsound.html#x:23"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#t<sub>1</sub>:24"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsound.html#t<sub>2</sub>:25"><span class="id" title="variable">t<sub>2</sub></span></a>) (<a class="idref" href="WPgen.html#wpgen_let"><span class="id" title="definition">wpgen_let</span></a> <a class="idref" href="WPsound.html#F<sub>1</sub>:21"><span class="id" title="variable">F<sub>1</sub></span></a> <a class="idref" href="WPsound.html#F2of:22"><span class="id" title="variable">F2of</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">S<sub>1</sub></span> <span class="id" title="var">S<sub>2</sub></span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span>. <span class="id" title="var">unfolds</span> <a class="idref" href="WPgen.html#wpgen_let"><span class="id" title="definition">wpgen_let</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans"><span class="id" title="lemma">himpl_trans</span></a> <a class="idref" href="WPgen.html#wp_let"><span class="id" title="axiom">wp_let</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans"><span class="id" title="lemma">himpl_trans</span></a> <span class="id" title="var">S<sub>1</sub></span>. <span class="id" title="var">applys</span> <a class="idref" href="WPsem.html#wp_conseq"><span class="id" title="lemma">wp_conseq</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">v</span>. <span class="id" title="var">applys</span> <span class="id" title="var">S<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="wpgen_if_sound" class="idref" href="#wpgen_if_sound"><span class="id" title="lemma">wpgen_if_sound</span></a> : <span class="id" title="keyword">∀</span> <a id="F<sub>1</sub>:27" class="idref" href="#F<sub>1</sub>:27"><span class="id" title="binder">F<sub>1</sub></span></a> <a id="F<sub>2</sub>:28" class="idref" href="#F<sub>2</sub>:28"><span class="id" title="binder">F<sub>2</sub></span></a> <a id="t<sub>0</sub>:29" class="idref" href="#t<sub>0</sub>:29"><span class="id" title="binder">t<sub>0</sub></span></a> <a id="t<sub>1</sub>:30" class="idref" href="#t<sub>1</sub>:30"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:31" class="idref" href="#t<sub>2</sub>:31"><span class="id" title="binder">t<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> <a class="idref" href="WPsound.html#t<sub>1</sub>:30"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsound.html#F<sub>1</sub>:27"><span class="id" title="variable">F<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> <a class="idref" href="WPsound.html#t<sub>2</sub>:31"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="WPsound.html#F<sub>2</sub>:28"><span class="id" title="variable">F<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> <a class="idref" href="WPsound.html#t<sub>0</sub>:29"><span class="id" title="variable">t<sub>0</sub></span></a> <a class="idref" href="WPsound.html#t<sub>1</sub>:30"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsound.html#t<sub>2</sub>:31"><span class="id" title="variable">t<sub>2</sub></span></a>) (<a class="idref" href="WPgen.html#wpgen_if"><span class="id" title="definition">wpgen_if</span></a> <a class="idref" href="WPsound.html#t<sub>0</sub>:29"><span class="id" title="variable">t<sub>0</sub></span></a> <a class="idref" href="WPsound.html#F<sub>1</sub>:27"><span class="id" title="variable">F<sub>1</sub></span></a> <a class="idref" href="WPsound.html#F<sub>2</sub>:28"><span class="id" title="variable">F<sub>2</sub></span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">S<sub>1</sub></span> <span class="id" title="var">S<sub>2</sub></span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="WPgen.html#wpgen_if"><span class="id" title="definition">wpgen_if</span></a>. <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">b</span> →.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans"><span class="id" title="lemma">himpl_trans</span></a> <a class="idref" href="WPgen.html#wp_if"><span class="id" title="axiom">wp_if</span></a>. <span class="id" title="var">case_if</span>. { <span class="id" title="var">applys</span> <span class="id" title="var">S<sub>1</sub></span>. } { <span class="id" title="var">applys</span> <span class="id" title="var">S<sub>2</sub></span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="wpgen_app_sound" class="idref" href="#wpgen_app_sound"><span class="id" title="lemma">wpgen_app_sound</span></a> : <span class="id" title="keyword">∀</span> <a id="t:32" class="idref" href="#t:32"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> <a class="idref" href="WPsound.html#t:32"><span class="id" title="variable">t</span></a> (<a class="idref" href="WPgen.html#wpgen_app"><span class="id" title="definition">wpgen_app</span></a> <a class="idref" href="WPsound.html#t:32"><span class="id" title="variable">t</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">t</span> <span class="id" title="var">Q</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="WPgen.html#wpgen_app"><span class="id" title="definition">wpgen_app</span></a>. <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="tactic">apply</span> <span class="id" title="var">M</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="wpgen_fail_sound" class="idref" href="#wpgen_fail_sound"><span class="id" title="lemma">wpgen_fail_sound</span></a> : <span class="id" title="keyword">∀</span> <a id="t:33" class="idref" href="#t:33"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> <a class="idref" href="WPsound.html#t:33"><span class="id" title="variable">t</span></a> <a class="idref" href="WPgen.html#wpgen_fail"><span class="id" title="definition">wpgen_fail</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="WPgen.html#wpgen_fail"><span class="id" title="definition">wpgen_fail</span></a>. <span class="id" title="var">xpull</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="wpgen_fun_sound" class="idref" href="#wpgen_fun_sound"><span class="id" title="lemma">wpgen_fun_sound</span></a> : <span class="id" title="keyword">∀</span> <a id="x:34" class="idref" href="#x:34"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:35" class="idref" href="#t<sub>1</sub>:35"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="Fof:36" class="idref" href="#Fof:36"><span class="id" title="binder">Fof</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="vx:37" class="idref" href="#vx:37"><span class="id" title="binder">vx</span></a>, <a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="WPsound.html#x:34"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#vx:37"><span class="id" title="variable">vx</span></a> <a class="idref" href="WPsound.html#t<sub>1</sub>:35"><span class="id" title="variable">t<sub>1</sub></span></a>) (<a class="idref" href="WPsound.html#Fof:36"><span class="id" title="variable">Fof</span></a> <a class="idref" href="WPsound.html#vx:37"><span class="id" title="variable">vx</span></a>)<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a class="idref" href="LibSepReference.html#trm_fun"><span class="id" title="constructor">trm_fun</span></a> <a class="idref" href="WPsound.html#x:34"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#t<sub>1</sub>:35"><span class="id" title="variable">t<sub>1</sub></span></a>) (<a class="idref" href="WPgen.html#WPgenRec.wpgen_fun"><span class="id" title="definition">wpgen_fun</span></a> <a class="idref" href="WPsound.html#Fof:36"><span class="id" title="variable">Fof</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span>. <span class="id" title="var">unfolds</span> <a class="idref" href="WPgen.html#WPgenRec.wpgen_fun"><span class="id" title="definition">wpgen_fun</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_hforall_l"><span class="id" title="lemma">himpl_hforall_l</span></a> (<a class="idref" href="LibSepReference.html#val_fun"><span class="id" title="constructor">val_fun</span></a> <span class="id" title="var">x</span> <span class="id" title="var">t<sub>1</sub></span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">xchange</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hwand_hpure_l"><span class="id" title="lemma">hwand_hpure_l</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans_r"><span class="id" title="lemma">himpl_trans_r</span></a>. { <span class="id" title="var">applys</span>* <a class="idref" href="WPsem.html#wp_app_fun"><span class="id" title="lemma">wp_app_fun</span></a>. } { <span class="id" title="var">applys</span>* <span class="id" title="var">M</span>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="WPgen.html#wp_fun"><span class="id" title="axiom">wp_fun</span></a>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="wpgen_fix_sound" class="idref" href="#wpgen_fix_sound"><span class="id" title="lemma">wpgen_fix_sound</span></a> : <span class="id" title="keyword">∀</span> <a id="f:38" class="idref" href="#f:38"><span class="id" title="binder">f</span></a> <a id="x:39" class="idref" href="#x:39"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:40" class="idref" href="#t<sub>1</sub>:40"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="Fof:41" class="idref" href="#Fof:41"><span class="id" title="binder">Fof</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="vf:42" class="idref" href="#vf:42"><span class="id" title="binder">vf</span></a> <a id="vx:43" class="idref" href="#vx:43"><span class="id" title="binder">vx</span></a>, <a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="WPsound.html#x:39"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#vx:43"><span class="id" title="variable">vx</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="WPsound.html#f:38"><span class="id" title="variable">f</span></a> <a class="idref" href="WPsound.html#vf:42"><span class="id" title="variable">vf</span></a> <a class="idref" href="WPsound.html#t<sub>1</sub>:40"><span class="id" title="variable">t<sub>1</sub></span></a>)) (<a class="idref" href="WPsound.html#Fof:41"><span class="id" title="variable">Fof</span></a> <a class="idref" href="WPsound.html#vf:42"><span class="id" title="variable">vf</span></a> <a class="idref" href="WPsound.html#vx:43"><span class="id" title="variable">vx</span></a>)<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a class="idref" href="LibSepReference.html#trm_fix"><span class="id" title="constructor">trm_fix</span></a> <a class="idref" href="WPsound.html#f:38"><span class="id" title="variable">f</span></a> <a class="idref" href="WPsound.html#x:39"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#t<sub>1</sub>:40"><span class="id" title="variable">t<sub>1</sub></span></a>) (<a class="idref" href="WPgen.html#WPgenRec.wpgen_fix"><span class="id" title="definition">wpgen_fix</span></a> <a class="idref" href="WPsound.html#Fof:41"><span class="id" title="variable">Fof</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span>. <span class="id" title="var">unfolds</span> <a class="idref" href="WPgen.html#WPgenRec.wpgen_fix"><span class="id" title="definition">wpgen_fix</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_hforall_l"><span class="id" title="lemma">himpl_hforall_l</span></a> (<a class="idref" href="LibSepReference.html#val_fix"><span class="id" title="constructor">val_fix</span></a> <span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">t<sub>1</sub></span>). <span class="id" title="var">xchange</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hwand_hpure_l"><span class="id" title="lemma">hwand_hpure_l</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans_r"><span class="id" title="lemma">himpl_trans_r</span></a>. { <span class="id" title="var">applys</span>* <a class="idref" href="WPsem.html#wp_app_fix"><span class="id" title="lemma">wp_app_fix</span></a>. } { <span class="id" title="var">applys</span>* <span class="id" title="var">M</span>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="WPsem.html#wp_fix"><span class="id" title="lemma">wp_fix</span></a>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Additional lemmas establishing the soundness of a version of <span class="inlinecode"><span class="id" title="var">wpgen</span></span> that
    does not recurse inside local function definitions. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wpgen_fun_val_sound" class="idref" href="#wpgen_fun_val_sound"><span class="id" title="lemma">wpgen_fun_val_sound</span></a> : <span class="id" title="keyword">∀</span> <a id="x:44" class="idref" href="#x:44"><span class="id" title="binder">x</span></a> <a id="t:45" class="idref" href="#t:45"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a class="idref" href="LibSepReference.html#trm_fun"><span class="id" title="constructor">trm_fun</span></a> <a class="idref" href="WPsound.html#x:44"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#t:45"><span class="id" title="variable">t</span></a>) (<a class="idref" href="WPgen.html#wpgen_val"><span class="id" title="definition">wpgen_val</span></a> (<a class="idref" href="LibSepReference.html#val_fun"><span class="id" title="constructor">val_fun</span></a> <a class="idref" href="WPsound.html#x:44"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#t:45"><span class="id" title="variable">t</span></a>)).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span>. <span class="id" title="var">unfolds</span> <a class="idref" href="WPgen.html#wpgen_val"><span class="id" title="definition">wpgen_val</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="WPgen.html#wp_fun"><span class="id" title="axiom">wp_fun</span></a>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="wpgen_fix_val_sound" class="idref" href="#wpgen_fix_val_sound"><span class="id" title="lemma">wpgen_fix_val_sound</span></a> : <span class="id" title="keyword">∀</span> <a id="f:46" class="idref" href="#f:46"><span class="id" title="binder">f</span></a> <a id="x:47" class="idref" href="#x:47"><span class="id" title="binder">x</span></a> <a id="t:48" class="idref" href="#t:48"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a class="idref" href="LibSepReference.html#trm_fix"><span class="id" title="constructor">trm_fix</span></a> <a class="idref" href="WPsound.html#f:46"><span class="id" title="variable">f</span></a> <a class="idref" href="WPsound.html#x:47"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#t:48"><span class="id" title="variable">t</span></a>) (<a class="idref" href="WPgen.html#wpgen_val"><span class="id" title="definition">wpgen_val</span></a> (<a class="idref" href="LibSepReference.html#val_fix"><span class="id" title="constructor">val_fix</span></a> <a class="idref" href="WPsound.html#f:46"><span class="id" title="variable">f</span></a> <a class="idref" href="WPsound.html#x:47"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#t:48"><span class="id" title="variable">t</span></a>)).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span>. <span class="id" title="var">unfolds</span> <a class="idref" href="WPgen.html#wpgen_val"><span class="id" title="definition">wpgen_val</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="WPsem.html#wp_fix"><span class="id" title="lemma">wp_fix</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab378"></a><h2 class="section">Soundness of the Predicate Transformer <span class="inlinecode"><span class="id" title="var">mkstruct</span></span></h2>

<div class="paragraph"> </div>

 Above, we have ignored the existence of <span class="inlinecode"><span class="id" title="var">mkstruct</span></span> at the head of
    formulae produced by <span class="inlinecode"><span class="id" title="var">wpgen</span></span>. We next show that the insertion of <span class="inlinecode"><span class="id" title="var">mkstruct</span></span>
    in formulae preserves their soundness. In other words, if the formula <span class="inlinecode"><span class="id" title="var">F</span></span> is
    a valid weakest precondition for <span class="inlinecode"><span class="id" title="var">t</span></span>, then so is <span class="inlinecode"><span class="id" title="var">mkstruct</span></span> <span class="inlinecode"><span class="id" title="var">F</span></span>.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mkstruct_sound</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t</span> <span class="id" title="var">F</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">formula_sound</span> <span class="id" title="var">t</span> <span class="id" title="var">F</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">formula_sound</span> <span class="id" title="var">t</span> (<span class="id" title="var">mkstruct</span> <span class="id" title="var">F</span>).
</span>    In order to prove this result, we first need to show that <span class="inlinecode"><span class="id" title="var">mkstruct</span></span> is a
    predicate transformer that does not affect the meaning of any formula of the
    form <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>. Intuitively, <span class="inlinecode"><span class="id" title="var">mkstruct</span></span> adds support for applying structural
    rules of Separation Logic; but a formula <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <i>inherently</i> satisfies all
    the structural rules; hence wrapping <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> inside a call to <span class="inlinecode"><span class="id" title="var">mkstruct</span></span> does
    not increase (nor decrease) its expressive power. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="mkstruct_wp" class="idref" href="#mkstruct_wp"><span class="id" title="lemma">mkstruct_wp</span></a> : <span class="id" title="keyword">∀</span> <a id="t:49" class="idref" href="#t:49"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPgen.html#mkstruct"><span class="id" title="definition">mkstruct</span></a> (<a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsound.html#t:49"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsound.html#t:49"><span class="id" title="variable">t</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span> <span class="id" title="lemma">fun_ext_1</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_antisym"><span class="id" title="lemma">himpl_antisym</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">unfold</span> <a class="idref" href="WPgen.html#mkstruct"><span class="id" title="definition">mkstruct</span></a>. <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span> <span class="id" title="var">Q'</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <a class="idref" href="WPsem.html#wp_conseq_frame"><span class="id" title="axiom">wp_conseq_frame</span></a> <span class="id" title="var">M</span>. <span class="id" title="var">xsimpl</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="WPgen.html#mkstruct_erase"><span class="id" title="lemma">mkstruct_erase</span></a>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
We are now ready to prove the desired result <span class="inlinecode"><span class="id" title="var">mkstruct_sound</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="mkstruct_sound" class="idref" href="#mkstruct_sound"><span class="id" title="lemma">mkstruct_sound</span></a> : <span class="id" title="keyword">∀</span> <a id="t:50" class="idref" href="#t:50"><span class="id" title="binder">t</span></a> <a id="F:51" class="idref" href="#F:51"><span class="id" title="binder">F</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> <a class="idref" href="WPsound.html#t:50"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsound.html#F:51"><span class="id" title="variable">F</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> <a class="idref" href="WPsound.html#t:50"><span class="id" title="variable">t</span></a> (<a class="idref" href="WPgen.html#mkstruct"><span class="id" title="definition">mkstruct</span></a> <a class="idref" href="WPsound.html#F:51"><span class="id" title="variable">F</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">unfolds</span> <a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="WPsound.html#mkstruct_wp"><span class="id" title="lemma">mkstruct_wp</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="WPgen.html#mkstruct_monotone"><span class="id" title="lemma">mkstruct_monotone</span></a>. <span class="id" title="var">applys</span> <span class="id" title="var">M</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Another, lower-level proof for the same result reveals the definition of
    <span class="inlinecode"><span class="id" title="var">mkstruct</span></span> and exploits the consequence-frame rule for <span class="inlinecode"><span class="id" title="var">wp</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="mkstruct_sound'" class="idref" href="#mkstruct_sound'"><span class="id" title="lemma">mkstruct_sound'</span></a> : <span class="id" title="keyword">∀</span> <a id="t:52" class="idref" href="#t:52"><span class="id" title="binder">t</span></a> <a id="F:53" class="idref" href="#F:53"><span class="id" title="binder">F</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> <a class="idref" href="WPsound.html#t:52"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsound.html#F:53"><span class="id" title="variable">F</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> <a class="idref" href="WPsound.html#t:52"><span class="id" title="variable">t</span></a> (<a class="idref" href="WPgen.html#mkstruct"><span class="id" title="definition">mkstruct</span></a> <a class="idref" href="WPsound.html#F:53"><span class="id" title="variable">F</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">unfolds</span> <a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Consider&nbsp;a&nbsp;postcondition&nbsp;<span class="inlinecode"><span class="id" title="var">Q</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Reveal&nbsp;the&nbsp;definition&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">mkstruct</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="var">unfolds</span> <a class="idref" href="WPgen.html#mkstruct"><span class="id" title="definition">mkstruct</span></a>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Extract&nbsp;the&nbsp;<span class="inlinecode"><span class="id" title="var">Q'</span></span>&nbsp;quantified&nbsp;in&nbsp;the&nbsp;definition&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">mkstruct</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Q'</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Exploit&nbsp;the&nbsp;assumption&nbsp;on&nbsp;<span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>,</span> <span class="inlinecode"><span class="id" title="var">F</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="var">xchange</span> (<span class="id" title="var">M</span> <span class="id" title="var">Q'</span>).<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Conclude&nbsp;using&nbsp;the&nbsp;structural&nbsp;rules&nbsp;for&nbsp;<span class="inlinecode"><span class="id" title="var">wp</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="WPsem.html#wp_ramified"><span class="id" title="lemma">wp_ramified</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Another interesting property of <span class="inlinecode"><span class="id" title="var">mkstruct</span></span> is its idempotence property, that
    is, it is such that <span class="inlinecode"><span class="id" title="var">mkstruct</span></span> <span class="inlinecode">(<span class="id" title="var">mkstruct</span></span> <span class="inlinecode"><span class="id" title="var">F</span>)</span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">mkstruct</span></span> <span class="inlinecode"><span class="id" title="var">F</span></span>. Idempotence
    asserts that applying the predicate <span class="inlinecode"><span class="id" title="var">mkstruct</span></span> more than once does not
    provide more expressiveness than applying it just once.

<div class="paragraph"> </div>

    Intuitively, idempotence reflects in particular the fact that two nested
    applications of the rule of consequence can always be combined into a single
    application of that rule (due to the transitivity of entailment); and that,
    similarly, two nested applications of the frame rule can always be combined
    into a single application of that rule (framing on <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> then framing on <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>
    is equivalent to framing on <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>). 
<div class="paragraph"> </div>

<a id="lab379"></a><h4 class="section">Exercise: 3 stars, standard, especially useful (mkstruct_idempotent)</h4>
 Complete the proof of the idempotence of <span class="inlinecode"><span class="id" title="var">mkstruct</span></span>. Hint: leverage <span class="inlinecode"><span class="id" title="var">xpull</span></span>
    and <span class="inlinecode"><span class="id" title="var">xsimpl</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="mkstruct_idempotent" class="idref" href="#mkstruct_idempotent"><span class="id" title="lemma">mkstruct_idempotent</span></a> : <span class="id" title="keyword">∀</span> <a id="F:54" class="idref" href="#F:54"><span class="id" title="binder">F</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPgen.html#mkstruct"><span class="id" title="definition">mkstruct</span></a> (<a class="idref" href="WPgen.html#mkstruct"><span class="id" title="definition">mkstruct</span></a> <a class="idref" href="WPsound.html#F:54"><span class="id" title="variable">F</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WPgen.html#mkstruct"><span class="id" title="definition">mkstruct</span></a> <a class="idref" href="WPsound.html#F:54"><span class="id" title="variable">F</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="lemma">fun_ext_1</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_antisym"><span class="id" title="lemma">himpl_antisym</span></a>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab380"></a><h2 class="section">Lemmas Capturing Properties of Iterated Substitutions</h2>

<div class="paragraph"> </div>

 In the soundness proof for <span class="inlinecode"><span class="id" title="var">wpgen</span></span>, we need to exploit two basic properties
    of the iterated substitution function <span class="inlinecode"><span class="id" title="var">isubst</span></span>. The first property asserts
    that the substitution for the empty context is the identity. This result is
    useful to beautify the final statement of the soundness theorem. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="isubst_nil" class="idref" href="#isubst_nil"><span class="id" title="axiom">isubst_nil</span></a> : <span class="id" title="keyword">∀</span> <a id="t:55" class="idref" href="#t:55"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPgen.html#isubst"><span class="id" title="definition">isubst</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="WPsound.html#t:55"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WPsound.html#t:55"><span class="id" title="variable">t</span></a>.<br/>
</div>

<div class="doc">
The second property asserts that the substitution for a context <span class="inlinecode">(<span class="id" title="var">x</span>,<span class="id" title="var">v</span>)::<span class="id" title="var">E</span></span>
    is the same as the substitution for the context <span class="inlinecode"><span class="id" title="var">rem</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">E</span></span> followed with the
    substitution of <span class="inlinecode"><span class="id" title="tactic">subst</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span>. This second property is needed to handle the
    case of let-bindings. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="isubst_rem" class="idref" href="#isubst_rem"><span class="id" title="axiom">isubst_rem</span></a> : <span class="id" title="keyword">∀</span> <a id="x:57" class="idref" href="#x:57"><span class="id" title="binder">x</span></a> <a id="v:58" class="idref" href="#v:58"><span class="id" title="binder">v</span></a> <a id="E:59" class="idref" href="#E:59"><span class="id" title="binder">E</span></a> <a id="t:60" class="idref" href="#t:60"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPgen.html#isubst"><span class="id" title="definition">isubst</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="WPsound.html#x:57"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="WPsound.html#v:58"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="WPsound.html#E:59"><span class="id" title="variable">E</span></a>) <a class="idref" href="WPsound.html#t:60"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="WPsound.html#x:57"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#v:58"><span class="id" title="variable">v</span></a> (<a class="idref" href="WPgen.html#isubst"><span class="id" title="definition">isubst</span></a> (<a class="idref" href="WPgen.html#rem"><span class="id" title="definition">rem</span></a> <a class="idref" href="WPsound.html#x:57"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#E:59"><span class="id" title="variable">E</span></a>) <a class="idref" href="WPsound.html#t:60"><span class="id" title="variable">t</span></a>).<br/>
</div>

<div class="doc">
The proofs for these two lemmas is fairly technical and of limited interest
    for the course. They can be found in the "optional material" near the end of
    this chapter. 
</div>

<div class="doc">
<a id="lab381"></a><h2 class="section">Main Induction for the Soundness Proof of <span class="inlinecode"><span class="id" title="var">wpgen</span></span></h2>

<div class="paragraph"> </div>

 At last, we are ready to establish the soundness of <span class="inlinecode"><span class="id" title="var">wpgen</span></span> <span class="inlinecode"><span class="id" title="var">E</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>. As
    previously announced, the proof is by structural induction on <span class="inlinecode"><span class="id" title="var">t</span></span>. For each
    term construct, the proof has two steps:

<div class="paragraph"> </div>

<ul class="doclist">
<li> first, invoke the lemma <span class="inlinecode"><span class="id" title="var">mkstruct_sound</span></span> to justify soundness
      of the leading <span class="inlinecode"><span class="id" title="var">mkstruct</span></span> produced by <span class="inlinecode"><span class="id" title="var">wpgen</span></span>,

</li>
<li> second, invoke the the soundness lemma specific to that term
      construct, e.g. <span class="inlinecode"><span class="id" title="var">wpgen_seq_sound</span></span> for sequences. 

</li>
</ul>
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wpgen_sound_induct" class="idref" href="#wpgen_sound_induct"><span class="id" title="lemma">wpgen_sound_induct</span></a> : <span class="id" title="keyword">∀</span> <a id="E:62" class="idref" href="#E:62"><span class="id" title="binder">E</span></a> <a id="t:63" class="idref" href="#t:63"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a class="idref" href="WPgen.html#isubst"><span class="id" title="definition">isubst</span></a> <a class="idref" href="WPsound.html#E:62"><span class="id" title="variable">E</span></a> <a class="idref" href="WPsound.html#t:63"><span class="id" title="variable">t</span></a>) (<a class="idref" href="WPgen.html#WPgenRec.wpgen"><span class="id" title="definition">wpgen</span></a> <a class="idref" href="WPsound.html#E:62"><span class="id" title="variable">E</span></a> <a class="idref" href="WPsound.html#t:63"><span class="id" title="variable">t</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">gen</span> <span class="id" title="var">E</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="WPsound.html#mkstruct_sound"><span class="id" title="lemma">mkstruct_sound</span></a>. <span class="comment">(*&nbsp;common&nbsp;to&nbsp;all&nbsp;cases&nbsp;*)</span><br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="WPsound.html#wpgen_val_sound"><span class="id" title="lemma">wpgen_val_sound</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rename</span> <span class="id" title="var">v</span> <span class="id" title="var">into</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="WPgen.html#wpgen_var"><span class="id" title="definition">wpgen_var</span></a>. <span class="id" title="var">case_eq</span> (<a class="idref" href="WPgen.html#lookup"><span class="id" title="definition">lookup</span></a> <span class="id" title="var">x</span> <span class="id" title="var">E</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">v</span> <span class="id" title="var">EQ</span>. <span class="id" title="var">applys</span> <a class="idref" href="WPsound.html#wpgen_val_sound"><span class="id" title="lemma">wpgen_val_sound</span></a>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">N</span>. <span class="id" title="var">applys</span> <a class="idref" href="WPsound.html#wpgen_fail_sound"><span class="id" title="lemma">wpgen_fail_sound</span></a>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="WPsound.html#wpgen_fun_sound"><span class="id" title="lemma">wpgen_fun_sound</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">vx</span>. <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="WPsound.html#isubst_rem"><span class="id" title="axiom">isubst_rem</span></a>. <span class="id" title="var">applys</span> <span class="id" title="var">IHt</span>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">IH</span>. <span class="id" title="var">applys</span> <a class="idref" href="WPsound.html#wpgen_fix_sound"><span class="id" title="lemma">wpgen_fix_sound</span></a> <span class="id" title="var">IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">vf</span> <span class="id" title="var">vx</span>. <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="LibSepReference.html#isubst_rem_2"><span class="id" title="lemma">isubst_rem_2</span></a>. <span class="id" title="var">applys</span> <span class="id" title="var">IHt</span>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="WPsound.html#wpgen_app_sound"><span class="id" title="lemma">wpgen_app_sound</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="WPsound.html#wpgen_seq_sound"><span class="id" title="lemma">wpgen_seq_sound</span></a>. { <span class="id" title="var">applys</span> <span class="id" title="var">IHt1</span>. } { <span class="id" title="var">applys</span> <span class="id" title="var">IHt2</span>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rename</span> <span class="id" title="var">v</span> <span class="id" title="var">into</span> <span class="id" title="var">x</span>. <span class="id" title="var">applys</span> <a class="idref" href="WPsound.html#wpgen_let_sound"><span class="id" title="lemma">wpgen_let_sound</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <span class="id" title="var">IHt1</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">v</span>. <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="WPsound.html#isubst_rem"><span class="id" title="axiom">isubst_rem</span></a>. <span class="id" title="var">applys</span> <span class="id" title="var">IHt2</span>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="WPsound.html#wpgen_if_sound"><span class="id" title="lemma">wpgen_if_sound</span></a>. { <span class="id" title="var">applys</span> <span class="id" title="var">IHt2</span>. } { <span class="id" title="var">applys</span> <span class="id" title="var">IHt3</span>. } }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab382"></a><h2 class="section">Statement of Soundness of <span class="inlinecode"><span class="id" title="var">wpgen</span></span> for Closed Terms</h2>

<div class="paragraph"> </div>

 For a closed term <span class="inlinecode"><span class="id" title="var">t</span></span>, the context <span class="inlinecode"><span class="id" title="var">E</span></span> is instantiated as <span class="inlinecode"><span class="id" title="var">nil</span></span>, and
    <span class="inlinecode"><span class="id" title="var">isubst</span></span> <span class="inlinecode"><span class="id" title="var">nil</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> simplifies to <span class="inlinecode"><span class="id" title="var">t</span></span>. We derive the main soundness statement for
    <span class="inlinecode"><span class="id" title="var">wpgen</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wpgen_sound" class="idref" href="#wpgen_sound"><span class="id" title="lemma">wpgen_sound</span></a> : <span class="id" title="keyword">∀</span> <a id="t:64" class="idref" href="#t:64"><span class="id" title="binder">t</span></a> <a id="Q:65" class="idref" href="#Q:65"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPgen.html#WPgenRec.wpgen"><span class="id" title="definition">wpgen</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="WPsound.html#t:64"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsound.html#Q:65"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsound.html#t:64"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsound.html#Q:65"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">lets</span> <span class="id" title="var">N</span>: (<a class="idref" href="LibSepReference.html#wpgen_sound"><span class="id" title="lemma">wpgen_sound</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <span class="id" title="var">t</span>). <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsound.html#isubst_nil"><span class="id" title="axiom">isubst_nil</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">N</span>. <span class="id" title="var">applys</span>* <span class="id" title="var">N</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The lemma <span class="inlinecode"><span class="id" title="var">triple_of_wpgen</span></span> triggers the initial evaluation of <span class="inlinecode"><span class="id" title="var">wpgen</span></span> for a
    given program <span class="inlinecode"><span class="id" title="var">t</span></span> that appears in a triple. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_of_wpgen" class="idref" href="#triple_of_wpgen"><span class="id" title="lemma">triple_of_wpgen</span></a> : <span class="id" title="keyword">∀</span> <a id="t:66" class="idref" href="#t:66"><span class="id" title="binder">t</span></a> <a id="H:67" class="idref" href="#H:67"><span class="id" title="binder">H</span></a> <a id="Q:68" class="idref" href="#Q:68"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#H:67"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPgen.html#WPgenRec.wpgen"><span class="id" title="definition">wpgen</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="WPsound.html#t:66"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsound.html#Q:68"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsound.html#t:66"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsound.html#H:67"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsound.html#Q:68"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="var">xchange</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <a class="idref" href="WPsound.html#wpgen_sound"><span class="id" title="lemma">wpgen_sound</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The lemma <span class="inlinecode"><span class="id" title="var">triple_app_fun_from_wpgen</span></span> is at the core of the implementation
    of the tactic <span class="inlinecode"><span class="id" title="var">xwp</span></span>. It is a specialized version of triple_of_wpgen]
    specialized for establishing a triple for a function application. In
    essence, this lemma is a reformulation of the rule <span class="inlinecode"><span class="id" title="var">triple_app_fun</span></span>, but
    triggering an evaluation of <span class="inlinecode"><span class="id" title="var">wpgen</span></span> for the body of the function. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_app_fun_from_wpgen" class="idref" href="#triple_app_fun_from_wpgen"><span class="id" title="lemma">triple_app_fun_from_wpgen</span></a> : <span class="id" title="keyword">∀</span> <a id="v<sub>1</sub>:69" class="idref" href="#v<sub>1</sub>:69"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="v<sub>2</sub>:70" class="idref" href="#v<sub>2</sub>:70"><span class="id" title="binder">v<sub>2</sub></span></a> <a id="x:71" class="idref" href="#x:71"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:72" class="idref" href="#t<sub>1</sub>:72"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="H:73" class="idref" href="#H:73"><span class="id" title="binder">H</span></a> <a id="Q:74" class="idref" href="#Q:74"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#v<sub>1</sub>:69"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_fun"><span class="id" title="constructor">val_fun</span></a> <a class="idref" href="WPsound.html#x:71"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#t<sub>1</sub>:72"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#H:73"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPgen.html#WPgenRec.wpgen"><span class="id" title="definition">wpgen</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="WPsound.html#x:71"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="WPsound.html#v<sub>2</sub>:70"><span class="id" title="variable">v<sub>2</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>) <a class="idref" href="WPsound.html#t<sub>1</sub>:72"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsound.html#Q:74"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="WPsound.html#v<sub>1</sub>:69"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="WPsound.html#v<sub>2</sub>:70"><span class="id" title="variable">v<sub>2</sub></span></a>) <a class="idref" href="WPsound.html#H:73"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsound.html#Q:74"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="var">applys</span> <a class="idref" href="WPsem.html#triple_app_fun"><span class="id" title="axiom">triple_app_fun</span></a> <span class="id" title="var">M<sub>1</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">asserts_rewrite</span> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <span class="id" title="var">x</span> <span class="id" title="var">v<sub>2</sub></span> <span class="id" title="var">t<sub>1</sub></span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WPgen.html#isubst"><span class="id" title="definition">isubst</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">x</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">v<sub>2</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>) <span class="id" title="var">t<sub>1</sub></span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsound.html#isubst_rem"><span class="id" title="axiom">isubst_rem</span></a>. <span class="id" title="tactic">rewrite</span>* <a class="idref" href="WPsound.html#isubst_nil"><span class="id" title="axiom">isubst_nil</span></a>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="var">xchange</span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="var">applys</span> <a class="idref" href="WPsound.html#wpgen_sound_induct"><span class="id" title="lemma">wpgen_sound_induct</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The lemma <span class="inlinecode"><span class="id" title="var">triple_app_fix_from_wpgen</span></span> is similar but handles recursive
    functions. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_app_fix_from_wpgen" class="idref" href="#triple_app_fix_from_wpgen"><span class="id" title="lemma">triple_app_fix_from_wpgen</span></a> : <span class="id" title="keyword">∀</span> <a id="v<sub>1</sub>:75" class="idref" href="#v<sub>1</sub>:75"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="v<sub>2</sub>:76" class="idref" href="#v<sub>2</sub>:76"><span class="id" title="binder">v<sub>2</sub></span></a> <a id="f:77" class="idref" href="#f:77"><span class="id" title="binder">f</span></a> <a id="x:78" class="idref" href="#x:78"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:79" class="idref" href="#t<sub>1</sub>:79"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="H:80" class="idref" href="#H:80"><span class="id" title="binder">H</span></a> <a id="Q:81" class="idref" href="#Q:81"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#v<sub>1</sub>:75"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_fix"><span class="id" title="constructor">val_fix</span></a> <a class="idref" href="WPsound.html#f:77"><span class="id" title="variable">f</span></a> <a class="idref" href="WPsound.html#x:78"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#t<sub>1</sub>:79"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#H:80"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPgen.html#WPgenRec.wpgen"><span class="id" title="definition">wpgen</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="WPsound.html#f:77"><span class="id" title="variable">f</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="WPsound.html#v<sub>1</sub>:75"><span class="id" title="variable">v<sub>1</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="WPsound.html#x:78"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="WPsound.html#v<sub>2</sub>:76"><span class="id" title="variable">v<sub>2</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>) <a class="idref" href="WPsound.html#t<sub>1</sub>:79"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsound.html#Q:81"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="WPsound.html#v<sub>1</sub>:75"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="WPsound.html#v<sub>2</sub>:76"><span class="id" title="variable">v<sub>2</sub></span></a>) <a class="idref" href="WPsound.html#H:80"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsound.html#Q:81"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="var">applys</span> <a class="idref" href="Rules.html#triple_app_fix"><span class="id" title="lemma">triple_app_fix</span></a> <span class="id" title="var">M<sub>1</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">asserts_rewrite</span> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <span class="id" title="var">x</span> <span class="id" title="var">v<sub>2</sub></span> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <span class="id" title="var">f</span> <span class="id" title="var">v<sub>1</sub></span> <span class="id" title="var">t<sub>1</sub></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WPgen.html#isubst"><span class="id" title="definition">isubst</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">f</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">v<sub>1</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">x</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">v<sub>2</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>) <span class="id" title="var">t<sub>1</sub></span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#isubst_rem_2"><span class="id" title="lemma">isubst_rem_2</span></a>. <span class="id" title="tactic">rewrite</span>* <a class="idref" href="WPsound.html#isubst_nil"><span class="id" title="axiom">isubst_nil</span></a>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="var">xchange</span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="var">applys</span> <a class="idref" href="WPsound.html#wpgen_sound_induct"><span class="id" title="lemma">wpgen_sound_induct</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab383"></a><h1 class="section">Optional Material</h1>

</div>

<div class="doc">
<a id="lab384"></a><h2 class="section">Proofs of Properties of Iterated Substitution</h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="IsubstProp" class="idref" href="#IsubstProp"><span class="id" title="module">IsubstProp</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">liblist_scope</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">E</span> : <a class="idref" href="WPgen.html#ctx"><span class="id" title="definition">ctx</span></a>.<br/>
</div>

<div class="doc">
Recall that <span class="inlinecode"><span class="id" title="var">isubst</span></span> <span class="inlinecode"><span class="id" title="var">E</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> denotes the multi-substitution in the term <span class="inlinecode"><span class="id" title="var">t</span></span> of
    all bindings form the association list <span class="inlinecode"><span class="id" title="var">E</span></span>. The soundness proof for <span class="inlinecode"><span class="id" title="var">wpgen</span></span>
    and the proof of its corollary <span class="inlinecode"><span class="id" title="var">triple_app_fun_from_wpgen</span></span> rely on two key
    properties of iterated substitutions, captured by the lemmas called
    <span class="inlinecode"><span class="id" title="var">isubst_nil</span></span> and <span class="inlinecode"><span class="id" title="var">isubst_rem</span></span>, which we state and prove next.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">isubst</span> <span class="id" title="var">nil</span> <span class="id" title="var">t</span> = <span class="id" title="var">t</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="var">x</span> <span class="id" title="var">v</span> (<span class="id" title="var">isubst</span> (<span class="id" title="var">rem</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span>) <span class="id" title="var">t</span>) = <span class="id" title="var">isubst</span> ((<span class="id" title="var">x</span>,<span class="id" title="var">v</span>)::<span class="id" title="var">E</span>) <span class="id" title="var">t</span>
</span>
<div class="paragraph"> </div>

 The first lemma is straightforward by induction. The TLC tactic <span class="inlinecode"><span class="id" title="var">fequals</span></span> is
    an enhanced variant of Coq's tactic <span class="inlinecode"><span class="id" title="tactic">f_equal</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="IsubstProp.isubst_nil" class="idref" href="#IsubstProp.isubst_nil"><span class="id" title="lemma">isubst_nil</span></a> : <span class="id" title="keyword">∀</span> <a id="t:82" class="idref" href="#t:82"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPgen.html#isubst"><span class="id" title="definition">isubst</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="WPsound.html#t:82"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WPsound.html#t:82"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">t</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="var">fequals</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The second lemma is much more involved to prove. We introduce the notion of
    "two equivalent contexts" <span class="inlinecode"><span class="id" title="var">E<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">E<sub>2</sub></span></span>, and argue that substitution for two
    equivalent contexts yields the same result. We then introduce the notion of
    "contexts with disjoint domains", and argue that if <span class="inlinecode"><span class="id" title="var">E<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">E<sub>2</sub></span></span> are
    disjoint then <span class="inlinecode"><span class="id" title="var">isubst</span></span> <span class="inlinecode">(<span class="id" title="var">E<sub>1</sub></span></span> <span class="inlinecode">++</span> <span class="inlinecode"><span class="id" title="var">E<sub>2</sub></span>)</span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">isubst</span></span> <span class="inlinecode"><span class="id" title="var">E<sub>1</sub></span></span> <span class="inlinecode">(<span class="id" title="var">isubst</span></span> <span class="inlinecode"><span class="id" title="var">E<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">t</span>)</span>.

<div class="paragraph"> </div>

Before we start, we describe the tactic <span class="inlinecode"><span class="id" title="var">case_var</span></span>, which helps with the
case_analyses on variable equalities, and we prove an auxiliary lemma that
describes the result of a lookup on a context from which a binding has been
removed. It is defined in the file <span class="inlinecode"><span class="id" title="var">LibSepVar.v</span></span> as:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Tactic</span> <span class="id" title="keyword">Notation</span> "case_var" :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">var_eq_spec</span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">repeat</span> <span class="id" title="var">case_if</span>.
</span>    The tactic <span class="inlinecode"><span class="id" title="var">case_var</span>*</span> is a shorthand for <span class="inlinecode"><span class="id" title="var">case_var</span></span> followed with
    automation (essentially, <span class="inlinecode"><span class="id" title="tactic">eauto</span></span>). 
<div class="paragraph"> </div>

 A key auxiliary lemma relates <span class="inlinecode"><span class="id" title="tactic">subst</span></span> and <span class="inlinecode"><span class="id" title="var">isubst</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="IsubstProp.subst_eq_isubst_one" class="idref" href="#IsubstProp.subst_eq_isubst_one"><span class="id" title="lemma">subst_eq_isubst_one</span></a> : <span class="id" title="keyword">∀</span> <a id="x:83" class="idref" href="#x:83"><span class="id" title="binder">x</span></a> <a id="v:84" class="idref" href="#v:84"><span class="id" title="binder">v</span></a> <a id="t:85" class="idref" href="#t:85"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="WPsound.html#x:83"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#v:84"><span class="id" title="variable">v</span></a> <a class="idref" href="WPsound.html#t:85"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WPgen.html#isubst"><span class="id" title="definition">isubst</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="WPsound.html#x:83"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="WPsound.html#v:84"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>) <a class="idref" href="WPsound.html#t:85"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">fequals</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">case_var</span>*. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">fequals</span>. <span class="id" title="var">case_var</span>*. { <span class="id" title="tactic">rewrite</span>* <a class="idref" href="WPsound.html#IsubstProp.isubst_nil"><span class="id" title="lemma">isubst_nil</span></a>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">fequals</span>. <span class="id" title="var">case_var</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">case_var</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">case_var</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsound.html#IsubstProp.isubst_nil"><span class="id" title="lemma">isubst_nil</span></a>; <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">fequals</span>*. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">fequals</span>*. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">fequals</span>*. <span class="id" title="var">case_var</span>*. { <span class="id" title="tactic">rewrite</span>* <a class="idref" href="WPsound.html#IsubstProp.isubst_nil"><span class="id" title="lemma">isubst_nil</span></a>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">fequals</span>*. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
A lemma about the lookup in a removal. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="IsubstProp.lookup_rem" class="idref" href="#IsubstProp.lookup_rem"><span class="id" title="lemma">lookup_rem</span></a> : <span class="id" title="keyword">∀</span> <a id="x:86" class="idref" href="#x:86"><span class="id" title="binder">x</span></a> <a id="y:87" class="idref" href="#y:87"><span class="id" title="binder">y</span></a> <a id="E:88" class="idref" href="#E:88"><span class="id" title="binder">E</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPgen.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="WPsound.html#x:86"><span class="id" title="variable">x</span></a> (<a class="idref" href="WPgen.html#rem"><span class="id" title="definition">rem</span></a> <a class="idref" href="WPsound.html#y:87"><span class="id" title="variable">y</span></a> <a class="idref" href="WPsound.html#E:88"><span class="id" title="variable">E</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="keyword">if</span> <a class="idref" href="LibSepVar.html#var_eq"><span class="id" title="definition">var_eq</span></a> <a class="idref" href="WPsound.html#x:86"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#y:87"><span class="id" title="variable">y</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <span class="id" title="keyword">else</span> <a class="idref" href="WPgen.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="WPsound.html#x:86"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#E:88"><span class="id" title="variable">E</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">E</span> <span class="id" title="keyword">as</span> [|(<span class="id" title="var">z</span>,<span class="id" title="var">v</span>) <span class="id" title="var">E'</span>].<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">simpl</span>. <span class="id" title="var">case_var</span>*. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">simpl</span>. <span class="id" title="var">case_var</span>*; <span class="id" title="tactic">simpl</span>; <span class="id" title="var">case_var</span>*. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
A lemma about the removal over an append. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="IsubstProp.rem_app" class="idref" href="#IsubstProp.rem_app"><span class="id" title="lemma">rem_app</span></a> : <span class="id" title="keyword">∀</span> <a id="x:89" class="idref" href="#x:89"><span class="id" title="binder">x</span></a> <a id="E<sub>1</sub>:90" class="idref" href="#E<sub>1</sub>:90"><span class="id" title="binder">E<sub>1</sub></span></a> <a id="E<sub>2</sub>:91" class="idref" href="#E<sub>2</sub>:91"><span class="id" title="binder">E<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPgen.html#rem"><span class="id" title="definition">rem</span></a> <a class="idref" href="WPsound.html#x:89"><span class="id" title="variable">x</span></a> (<a class="idref" href="WPsound.html#E<sub>1</sub>:90"><span class="id" title="variable">E<sub>1</sub></span></a> <span class="id" title="notation">++</span> <a class="idref" href="WPsound.html#E<sub>2</sub>:91"><span class="id" title="variable">E<sub>2</sub></span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WPgen.html#rem"><span class="id" title="definition">rem</span></a> <a class="idref" href="WPsound.html#x:89"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#E<sub>1</sub>:90"><span class="id" title="variable">E<sub>1</sub></span></a> <span class="id" title="notation">++</span> <a class="idref" href="WPgen.html#rem"><span class="id" title="definition">rem</span></a> <a class="idref" href="WPsound.html#x:89"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#E<sub>2</sub>:91"><span class="id" title="variable">E<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">E<sub>1</sub></span> <span class="id" title="keyword">as</span> [|(<span class="id" title="var">y</span>,<span class="id" title="var">w</span>) <span class="id" title="var">E<sub>1</sub>'</span>]; <span class="id" title="var">rew_list</span>; <span class="id" title="tactic">simpl</span>. { <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">case_var</span>*. { <span class="id" title="var">rew_list</span>. <span class="id" title="var">fequals</span>. } }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The definition of equivalent contexts. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="IsubstProp.ctx_equiv" class="idref" href="#IsubstProp.ctx_equiv"><span class="id" title="definition">ctx_equiv</span></a> <a id="E<sub>1</sub>:92" class="idref" href="#E<sub>1</sub>:92"><span class="id" title="binder">E<sub>1</sub></span></a> <a id="E<sub>2</sub>:93" class="idref" href="#E<sub>2</sub>:93"><span class="id" title="binder">E<sub>2</sub></span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="x:94" class="idref" href="#x:94"><span class="id" title="binder">x</span></a>, <a class="idref" href="WPgen.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="WPsound.html#x:94"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#E<sub>1</sub>:92"><span class="id" title="variable">E<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WPgen.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="WPsound.html#x:94"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#E<sub>2</sub>:93"><span class="id" title="variable">E<sub>2</sub></span></a>.<br/>
</div>

<div class="doc">
The fact that removal preserves equivalence. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="IsubstProp.ctx_equiv_rem" class="idref" href="#IsubstProp.ctx_equiv_rem"><span class="id" title="lemma">ctx_equiv_rem</span></a> : <span class="id" title="keyword">∀</span> <a id="x:95" class="idref" href="#x:95"><span class="id" title="binder">x</span></a> <a id="E<sub>1</sub>:96" class="idref" href="#E<sub>1</sub>:96"><span class="id" title="binder">E<sub>1</sub></span></a> <a id="E<sub>2</sub>:97" class="idref" href="#E<sub>2</sub>:97"><span class="id" title="binder">E<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#IsubstProp.ctx_equiv"><span class="id" title="definition">ctx_equiv</span></a> <a class="idref" href="WPsound.html#E<sub>1</sub>:96"><span class="id" title="variable">E<sub>1</sub></span></a> <a class="idref" href="WPsound.html#E<sub>2</sub>:97"><span class="id" title="variable">E<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#IsubstProp.ctx_equiv"><span class="id" title="definition">ctx_equiv</span></a> (<a class="idref" href="WPgen.html#rem"><span class="id" title="definition">rem</span></a> <a class="idref" href="WPsound.html#x:95"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#E<sub>1</sub>:96"><span class="id" title="variable">E<sub>1</sub></span></a>) (<a class="idref" href="WPgen.html#rem"><span class="id" title="definition">rem</span></a> <a class="idref" href="WPsound.html#x:95"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#E<sub>2</sub>:97"><span class="id" title="variable">E<sub>2</sub></span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">unfolds</span> <a class="idref" href="WPsound.html#IsubstProp.ctx_equiv"><span class="id" title="definition">ctx_equiv</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsound.html#IsubstProp.lookup_rem"><span class="id" title="lemma">lookup_rem</span></a>. <span class="id" title="var">case_var</span>*.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The fact that substitution for equivalent contexts yields equal results. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="IsubstProp.isubst_ctx_equiv" class="idref" href="#IsubstProp.isubst_ctx_equiv"><span class="id" title="lemma">isubst_ctx_equiv</span></a> : <span class="id" title="keyword">∀</span> <a id="t:98" class="idref" href="#t:98"><span class="id" title="binder">t</span></a> <a id="E<sub>1</sub>:99" class="idref" href="#E<sub>1</sub>:99"><span class="id" title="binder">E<sub>1</sub></span></a> <a id="E<sub>2</sub>:100" class="idref" href="#E<sub>2</sub>:100"><span class="id" title="binder">E<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#IsubstProp.ctx_equiv"><span class="id" title="definition">ctx_equiv</span></a> <a class="idref" href="WPsound.html#E<sub>1</sub>:99"><span class="id" title="variable">E<sub>1</sub></span></a> <a class="idref" href="WPsound.html#E<sub>2</sub>:100"><span class="id" title="variable">E<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPgen.html#isubst"><span class="id" title="definition">isubst</span></a> <a class="idref" href="WPsound.html#E<sub>1</sub>:99"><span class="id" title="variable">E<sub>1</sub></span></a> <a class="idref" href="WPsound.html#t:98"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WPgen.html#isubst"><span class="id" title="definition">isubst</span></a> <a class="idref" href="WPsound.html#E<sub>2</sub>:100"><span class="id" title="variable">E<sub>2</sub></span></a> <a class="idref" href="WPsound.html#t:98"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">hint</span> <a class="idref" href="WPsound.html#IsubstProp.ctx_equiv_rem"><span class="id" title="lemma">ctx_equiv_rem</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">t</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>; <span class="id" title="var">introv</span> <span class="id" title="var">EQ</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="var">fequals</span>*.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">EQ</span>. <span class="id" title="tactic">auto</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The definition of disjoint contexts. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="IsubstProp.ctx_disjoint" class="idref" href="#IsubstProp.ctx_disjoint"><span class="id" title="definition">ctx_disjoint</span></a> <a id="E<sub>1</sub>:101" class="idref" href="#E<sub>1</sub>:101"><span class="id" title="binder">E<sub>1</sub></span></a> <a id="E<sub>2</sub>:102" class="idref" href="#E<sub>2</sub>:102"><span class="id" title="binder">E<sub>2</sub></span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="x:103" class="idref" href="#x:103"><span class="id" title="binder">x</span></a> <a id="v<sub>1</sub>:104" class="idref" href="#v<sub>1</sub>:104"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="v<sub>2</sub>:105" class="idref" href="#v<sub>2</sub>:105"><span class="id" title="binder">v<sub>2</sub></span></a>, <a class="idref" href="WPgen.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="WPsound.html#x:103"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#E<sub>1</sub>:101"><span class="id" title="variable">E<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="WPsound.html#v<sub>1</sub>:104"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="WPgen.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="WPsound.html#x:103"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#E<sub>2</sub>:102"><span class="id" title="variable">E<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="WPsound.html#v<sub>2</sub>:105"><span class="id" title="variable">v<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>
</div>

<div class="doc">
Removal preserves disjointness. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="IsubstProp.ctx_disjoint_rem" class="idref" href="#IsubstProp.ctx_disjoint_rem"><span class="id" title="lemma">ctx_disjoint_rem</span></a> : <span class="id" title="keyword">∀</span> <a id="x:106" class="idref" href="#x:106"><span class="id" title="binder">x</span></a> <a id="E<sub>1</sub>:107" class="idref" href="#E<sub>1</sub>:107"><span class="id" title="binder">E<sub>1</sub></span></a> <a id="E<sub>2</sub>:108" class="idref" href="#E<sub>2</sub>:108"><span class="id" title="binder">E<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#IsubstProp.ctx_disjoint"><span class="id" title="definition">ctx_disjoint</span></a> <a class="idref" href="WPsound.html#E<sub>1</sub>:107"><span class="id" title="variable">E<sub>1</sub></span></a> <a class="idref" href="WPsound.html#E<sub>2</sub>:108"><span class="id" title="variable">E<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#IsubstProp.ctx_disjoint"><span class="id" title="definition">ctx_disjoint</span></a> (<a class="idref" href="WPgen.html#rem"><span class="id" title="definition">rem</span></a> <a class="idref" href="WPsound.html#x:106"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#E<sub>1</sub>:107"><span class="id" title="variable">E<sub>1</sub></span></a>) (<a class="idref" href="WPgen.html#rem"><span class="id" title="definition">rem</span></a> <a class="idref" href="WPsound.html#x:106"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#E<sub>2</sub>:108"><span class="id" title="variable">E<sub>2</sub></span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">D</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">y</span> <span class="id" title="var">v<sub>1</sub></span> <span class="id" title="var">v<sub>2</sub></span> <span class="id" title="var">K<sub>1</sub></span> <span class="id" title="var">K<sub>2</sub></span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsound.html#IsubstProp.lookup_rem"><span class="id" title="lemma">lookup_rem</span></a> <span class="id" title="keyword">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="var">case_var</span>. <span class="id" title="var">applys</span>* <span class="id" title="var">D</span> <span class="id" title="var">K<sub>1</sub></span> <span class="id" title="var">K<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Lookup in the concatenation of two disjoint contexts <span class="inlinecode"><span class="id" title="var">E<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">E<sub>2</sub></span></span> is
    equivalent to a lookup in <span class="inlinecode"><span class="id" title="var">E<sub>1</sub></span></span> if it succeeds, or a lookup in <span class="inlinecode"><span class="id" title="var">E<sub>2</sub></span></span>
    otherwise. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="IsubstProp.lookup_app" class="idref" href="#IsubstProp.lookup_app"><span class="id" title="lemma">lookup_app</span></a> : <span class="id" title="keyword">∀</span> <a id="x:109" class="idref" href="#x:109"><span class="id" title="binder">x</span></a> <a id="E<sub>1</sub>:110" class="idref" href="#E<sub>1</sub>:110"><span class="id" title="binder">E<sub>1</sub></span></a> <a id="E<sub>2</sub>:111" class="idref" href="#E<sub>2</sub>:111"><span class="id" title="binder">E<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPgen.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="WPsound.html#x:109"><span class="id" title="variable">x</span></a> (<a class="idref" href="WPsound.html#E<sub>1</sub>:110"><span class="id" title="variable">E<sub>1</sub></span></a> <span class="id" title="notation">++</span> <a class="idref" href="WPsound.html#E<sub>2</sub>:111"><span class="id" title="variable">E<sub>2</sub></span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="keyword">match</span> <a class="idref" href="WPgen.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="WPsound.html#x:109"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#E<sub>1</sub>:110"><span class="id" title="variable">E<sub>1</sub></span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="WPgen.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="WPsound.html#x:109"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#E<sub>2</sub>:111"><span class="id" title="variable">E<sub>2</sub></span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">v</span> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">E<sub>1</sub></span> <span class="id" title="keyword">as</span> [|(<span class="id" title="var">y</span>,<span class="id" title="var">w</span>) <span class="id" title="var">E<sub>1</sub>'</span>]; <span class="id" title="var">rew_list</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">case_var</span>*. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The key induction shows that <span class="inlinecode"><span class="id" title="var">isubst</span></span> distributes over context
    concatenation. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="IsubstProp.isubst_app" class="idref" href="#IsubstProp.isubst_app"><span class="id" title="lemma">isubst_app</span></a> : <span class="id" title="keyword">∀</span> <a id="t:112" class="idref" href="#t:112"><span class="id" title="binder">t</span></a> <a id="E<sub>1</sub>:113" class="idref" href="#E<sub>1</sub>:113"><span class="id" title="binder">E<sub>1</sub></span></a> <a id="E<sub>2</sub>:114" class="idref" href="#E<sub>2</sub>:114"><span class="id" title="binder">E<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPgen.html#isubst"><span class="id" title="definition">isubst</span></a> (<a class="idref" href="WPsound.html#E<sub>1</sub>:113"><span class="id" title="variable">E<sub>1</sub></span></a> <span class="id" title="notation">++</span> <a class="idref" href="WPsound.html#E<sub>2</sub>:114"><span class="id" title="variable">E<sub>2</sub></span></a>) <a class="idref" href="WPsound.html#t:112"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WPgen.html#isubst"><span class="id" title="definition">isubst</span></a> <a class="idref" href="WPsound.html#E<sub>2</sub>:114"><span class="id" title="variable">E<sub>2</sub></span></a> (<a class="idref" href="WPgen.html#isubst"><span class="id" title="definition">isubst</span></a> <a class="idref" href="WPsound.html#E<sub>1</sub>:113"><span class="id" title="variable">E<sub>1</sub></span></a> <a class="idref" href="WPsound.html#t:112"><span class="id" title="variable">t</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">hint</span> <a class="idref" href="WPsound.html#IsubstProp.ctx_disjoint_rem"><span class="id" title="lemma">ctx_disjoint_rem</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">t</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">fequals</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rename</span> <span class="id" title="var">v</span> <span class="id" title="var">into</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">rewrite</span>* <a class="idref" href="WPsound.html#IsubstProp.lookup_app"><span class="id" title="lemma">lookup_app</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">case_eq</span> (<a class="idref" href="WPgen.html#lookup"><span class="id" title="definition">lookup</span></a> <span class="id" title="var">x</span> <span class="id" title="var">E<sub>1</sub></span>); <span class="id" title="var">introv</span> <span class="id" title="var">K<sub>1</sub></span>; <span class="id" title="var">case_eq</span> (<a class="idref" href="WPgen.html#lookup"><span class="id" title="definition">lookup</span></a> <span class="id" title="var">x</span> <span class="id" title="var">E<sub>2</sub></span>); <span class="id" title="var">introv</span> <span class="id" title="var">K<sub>2</sub></span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span>* <span class="id" title="var">K<sub>2</sub></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span>* <span class="id" title="var">K<sub>2</sub></span>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">fequals</span>. <span class="id" title="tactic">rewrite</span>* <a class="idref" href="WPsound.html#IsubstProp.rem_app"><span class="id" title="lemma">rem_app</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">fequals</span>. <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span>* <a class="idref" href="WPsound.html#IsubstProp.rem_app"><span class="id" title="lemma">rem_app</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">fequals</span>*. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">fequals</span>*. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">fequals</span>*. { <span class="id" title="tactic">rewrite</span>* <a class="idref" href="WPsound.html#IsubstProp.rem_app"><span class="id" title="lemma">rem_app</span></a>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">fequals</span>*. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The next lemma asserts that the concatenation order is irrelevant in a
    substitution if the contexts have disjoint domains. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="IsubstProp.isubst_app_swap" class="idref" href="#IsubstProp.isubst_app_swap"><span class="id" title="lemma">isubst_app_swap</span></a> : <span class="id" title="keyword">∀</span> <a id="t:115" class="idref" href="#t:115"><span class="id" title="binder">t</span></a> <a id="E<sub>1</sub>:116" class="idref" href="#E<sub>1</sub>:116"><span class="id" title="binder">E<sub>1</sub></span></a> <a id="E<sub>2</sub>:117" class="idref" href="#E<sub>2</sub>:117"><span class="id" title="binder">E<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsound.html#IsubstProp.ctx_disjoint"><span class="id" title="definition">ctx_disjoint</span></a> <a class="idref" href="WPsound.html#E<sub>1</sub>:116"><span class="id" title="variable">E<sub>1</sub></span></a> <a class="idref" href="WPsound.html#E<sub>2</sub>:117"><span class="id" title="variable">E<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPgen.html#isubst"><span class="id" title="definition">isubst</span></a> (<a class="idref" href="WPsound.html#E<sub>1</sub>:116"><span class="id" title="variable">E<sub>1</sub></span></a> <span class="id" title="notation">++</span> <a class="idref" href="WPsound.html#E<sub>2</sub>:117"><span class="id" title="variable">E<sub>2</sub></span></a>) <a class="idref" href="WPsound.html#t:115"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WPgen.html#isubst"><span class="id" title="definition">isubst</span></a> (<a class="idref" href="WPsound.html#E<sub>2</sub>:117"><span class="id" title="variable">E<sub>2</sub></span></a> <span class="id" title="notation">++</span> <a class="idref" href="WPsound.html#E<sub>1</sub>:116"><span class="id" title="variable">E<sub>1</sub></span></a>) <a class="idref" href="WPsound.html#t:115"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">D</span>. <span class="id" title="var">applys</span> <a class="idref" href="WPsound.html#IsubstProp.isubst_ctx_equiv"><span class="id" title="lemma">isubst_ctx_equiv</span></a>. <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#ctx_disjoint_equiv_app"><span class="id" title="lemma">ctx_disjoint_equiv_app</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
At last, we derive the desired property of <span class="inlinecode"><span class="id" title="var">isubst</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="IsubstProp.isubst_rem" class="idref" href="#IsubstProp.isubst_rem"><span class="id" title="lemma">isubst_rem</span></a> : <span class="id" title="keyword">∀</span> <a id="x:118" class="idref" href="#x:118"><span class="id" title="binder">x</span></a> <a id="v:119" class="idref" href="#v:119"><span class="id" title="binder">v</span></a> <a id="E:120" class="idref" href="#E:120"><span class="id" title="binder">E</span></a> <a id="t:121" class="idref" href="#t:121"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPgen.html#isubst"><span class="id" title="definition">isubst</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="WPsound.html#x:118"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WPsound.html#v:119"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="WPsound.html#E:120"><span class="id" title="variable">E</span></a>) <a class="idref" href="WPsound.html#t:121"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="WPsound.html#x:118"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#v:119"><span class="id" title="variable">v</span></a> (<a class="idref" href="WPgen.html#isubst"><span class="id" title="definition">isubst</span></a> (<a class="idref" href="WPgen.html#rem"><span class="id" title="definition">rem</span></a> <a class="idref" href="WPsound.html#x:118"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#E:120"><span class="id" title="variable">E</span></a>) <a class="idref" href="WPsound.html#t:121"><span class="id" title="variable">t</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsound.html#IsubstProp.subst_eq_isubst_one"><span class="id" title="lemma">subst_eq_isubst_one</span></a>. <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="WPsound.html#IsubstProp.isubst_app"><span class="id" title="lemma">isubst_app</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsound.html#IsubstProp.isubst_app_swap"><span class="id" title="lemma">isubst_app_swap</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="WPsound.html#IsubstProp.isubst_ctx_equiv"><span class="id" title="lemma">isubst_ctx_equiv</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">y</span>. <span class="id" title="var">rew_list</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="var">case_var</span>*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsound.html#IsubstProp.lookup_rem"><span class="id" title="lemma">lookup_rem</span></a>. <span class="id" title="var">case_var</span>*. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">y</span> <span class="id" title="var">v<sub>1</sub></span> <span class="id" title="var">v<sub>2</sub></span> <span class="id" title="var">K<sub>1</sub></span> <span class="id" title="var">K<sub>2</sub></span>. <span class="id" title="var">simpls</span>. <span class="id" title="var">case_var</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsound.html#IsubstProp.lookup_rem"><span class="id" title="lemma">lookup_rem</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">K<sub>1</sub></span>. <span class="id" title="var">case_var</span>*. } }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
We also prove the variant lemma which is useful for handling recursive
    functions in the soundness proof for <span class="inlinecode"><span class="id" title="var">wpgen</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="IsubstProp.isubst_rem_2" class="idref" href="#IsubstProp.isubst_rem_2"><span class="id" title="lemma">isubst_rem_2</span></a> : <span class="id" title="keyword">∀</span> <a id="f:122" class="idref" href="#f:122"><span class="id" title="binder">f</span></a> <a id="x:123" class="idref" href="#x:123"><span class="id" title="binder">x</span></a> <a id="vf:124" class="idref" href="#vf:124"><span class="id" title="binder">vf</span></a> <a id="vx:125" class="idref" href="#vx:125"><span class="id" title="binder">vx</span></a> <a id="E:126" class="idref" href="#E:126"><span class="id" title="binder">E</span></a> <a id="t:127" class="idref" href="#t:127"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WPgen.html#isubst"><span class="id" title="definition">isubst</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="WPsound.html#f:122"><span class="id" title="variable">f</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="WPsound.html#vf:124"><span class="id" title="variable">vf</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="WPsound.html#x:123"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="WPsound.html#vx:125"><span class="id" title="variable">vx</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="WPsound.html#E:126"><span class="id" title="variable">E</span></a>) <a class="idref" href="WPsound.html#t:127"><span class="id" title="variable">t</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="WPsound.html#x:123"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsound.html#vx:125"><span class="id" title="variable">vx</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="WPsound.html#f:122"><span class="id" title="variable">f</span></a> <a class="idref" href="WPsound.html#vf:124"><span class="id" title="variable">vf</span></a> (<a class="idref" href="WPgen.html#isubst"><span class="id" title="definition">isubst</span></a> (<a class="idref" href="WPgen.html#rem"><span class="id" title="definition">rem</span></a> <a class="idref" href="WPsound.html#x:123"><span class="id" title="variable">x</span></a> (<a class="idref" href="WPgen.html#rem"><span class="id" title="definition">rem</span></a> <a class="idref" href="WPsound.html#f:122"><span class="id" title="variable">f</span></a> <a class="idref" href="WPsound.html#E:126"><span class="id" title="variable">E</span></a>)) <a class="idref" href="WPsound.html#t:127"><span class="id" title="variable">t</span></a>)).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsound.html#IsubstProp.subst_eq_isubst_one"><span class="id" title="lemma">subst_eq_isubst_one</span></a>. <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="WPsound.html#IsubstProp.isubst_app"><span class="id" title="lemma">isubst_app</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsound.html#IsubstProp.isubst_app_swap"><span class="id" title="lemma">isubst_app_swap</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="WPsound.html#IsubstProp.isubst_ctx_equiv"><span class="id" title="lemma">isubst_ctx_equiv</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">y</span>. <span class="id" title="var">rew_list</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsound.html#IsubstProp.lookup_rem"><span class="id" title="lemma">lookup_rem</span></a>. <span class="id" title="var">case_var</span>*. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">y</span> <span class="id" title="var">v<sub>1</sub></span> <span class="id" title="var">v<sub>2</sub></span> <span class="id" title="var">K<sub>1</sub></span> <span class="id" title="var">K<sub>2</sub></span>. <span class="id" title="var">rew_listx</span> <span class="id" title="keyword">in</span> *. <span class="id" title="var">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsound.html#IsubstProp.lookup_rem"><span class="id" title="lemma">lookup_rem</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">K<sub>1</sub></span>. <span class="id" title="var">case_var</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="WPsound.html#IsubstProp"><span class="id" title="module">IsubstProp</span></a>.<br/><hr class='doublespaceincode'/>
<span class="comment">(*&nbsp;2024-08-08&nbsp;20:37&nbsp;*)</span><br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>