<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>Arrays: Reasoning about Arrays</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/slf.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 6: Separation Logic Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">Arrays<span class="subtitle">Reasoning about Arrays</span></h1>


<div class="code">

<span class="id" title="keyword">Set Implicit Arguments</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">SLF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="LibSepReference.html#"><span class="id" title="library">LibSepReference</span></a> <span class="id" title="library">LibSepTLCbuffer</span>.<br/>
#[<span class="id" title="var">global</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Rewrite</span> <a class="idref" href="LibSepFmap.html#conseq_cons'"><span class="id" title="lemma">conseq_cons'</span></a> : <span class="id" title="var">rew_listx</span>.<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">wp_scope</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">P</span> : <span class="id" title="keyword">Prop</span>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">H</span> : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">Q</span> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span> : <a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">k</span> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> : <span class="id" title="notation">int</span>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">v</span> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">z</span> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>.<br/>
</div>

<div class="doc">
<a id="lab428"></a><h1 class="section">First Pass</h1>

<div class="paragraph"> </div>

 This chapter explains how to specify operations on ML-style arrays in
    Separation Logic. In ML-like languages, an array of size <span class="inlinecode"><span class="id" title="var">n</span></span> is an allocated
    block of size <span class="inlinecode"><span class="id" title="var">n</span>+1</span> with a header field that stores the length of the array.
    To perform a <span class="inlinecode"><span class="id" title="var">get</span></span> or a <span class="inlinecode"><span class="id" title="tactic">set</span></span> operation on an array, the programmer provides
    the pointer to the array object -- that is, the address of the header cell
 as well as the index on which to operate.

<div class="paragraph"> </div>

    The chapter starts with a presentation of <i>large-footprint</i> operations for
    arrays, expressed with respect to a representation predicate of the form
    <span class="inlinecode"><span class="id" title="var">harray</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>. Then it presents <i>small-footprint</i> specifications for the same
    operations, involving a representation predicate of the form <span class="inlinecode"><span class="id" title="var">hcell</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span>
    for representing each cell, as well as a predicate, written <span class="inlinecode"><span class="id" title="var">hheader</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span>
    for representing the header field. Interestingly, the header cell predicate
    alone suffices for reading the length of an array.

<div class="paragraph"> </div>

    We will illustrate the benefits of small-footprint specifications for
    reasoning about the recursive function <span class="inlinecode"><span class="id" title="var">quicksort</span></span>, which operates on array
    segments. Segments are described using the heap predicate <span class="inlinecode"><span class="id" title="var">harray_seg</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span>
    . Array segments allow "framing" the parts of arrays that are not involved
    in a recursive call.

<div class="paragraph"> </div>

    The "More Details" part of the chapter explains how to define the predicates
    <span class="inlinecode"><span class="id" title="var">hheader</span></span>, <span class="inlinecode"><span class="id" title="var">hcell</span></span>, <span class="inlinecode"><span class="id" title="var">hseg</span></span>, and <span class="inlinecode"><span class="id" title="var">harray</span></span> with respect to the representation
    of heaps as a finite map from locations to values. The "optional material"
    part of the chapter shows how to implement and verify <span class="inlinecode"><span class="id" title="var">make</span></span>, <span class="inlinecode"><span class="id" title="var">length</span></span>,
    <span class="inlinecode"><span class="id" title="var">get</span></span>, and <span class="inlinecode"><span class="id" title="tactic">set</span></span> in terms of block allocation and pointer arithmetic. 
</div>

<div class="doc">
<a id="lab429"></a><h2 class="section">Large-Footprint Specifications for Array Operations</h2>

<div class="paragraph"> </div>

 The heap predicate <span class="inlinecode"><span class="id" title="var">harray</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> asserts that an array is allocated at
    address <span class="inlinecode"><span class="id" title="var">p</span></span> and that its elements are described by the list <span class="inlinecode"><span class="id" title="var">L</span></span>. At this
    stage, let us axiomatize this predicate. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="harray" class="idref" href="#harray"><span class="id" title="axiom">harray</span></a> : <span class="id" title="keyword">∀</span> (<a id="L:1" class="idref" href="#L:1"><span class="id" title="binder">L</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) (<a id="p:2" class="idref" href="#p:2"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>), <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>.<br/>
</div>

<div class="doc">
The primitive operation <span class="inlinecode"><span class="id" title="var">val_array_make</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> allocates a fresh array of
    length <span class="inlinecode"><span class="id" title="var">n</span></span>, with each of its cells containing the value <span class="inlinecode"><span class="id" title="var">v</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="val_array_make" class="idref" href="#val_array_make"><span class="id" title="axiom">val_array_make</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
</div>

<div class="doc">
The specification of <span class="inlinecode"><span class="id" title="var">val_array_make</span></span> requires the length <span class="inlinecode"><span class="id" title="var">n</span></span> to be
    nonnegative. The output array is described as a list made of <span class="inlinecode"><span class="id" title="var">n</span></span> copies of
    the value <span class="inlinecode"><span class="id" title="var">v</span></span>. This list is built by the utility function
    <span class="inlinecode"><span class="id" title="var">LibList.make</span></span> <span class="inlinecode">(<span class="id" title="var">abs</span></span> <span class="inlinecode"><span class="id" title="var">n</span>)</span> <span class="inlinecode"><span class="id" title="var">v</span></span>, where <span class="inlinecode"><span class="id" title="var">abs</span></span> converts the integer <span class="inlinecode"><span class="id" title="var">n</span></span> into a
    natural number. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_array_make" class="idref" href="#triple_array_make"><span class="id" title="axiom">triple_array_make</span></a> : <span class="id" title="keyword">∀</span> <a id="n:5" class="idref" href="#n:5"><span class="id" title="binder">n</span></a> <a id="v:6" class="idref" href="#v:6"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#n:5"><span class="id" title="variable">n</span></a> <span class="id" title="notation">≥</span> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#val_array_make"><span class="id" title="axiom">val_array_make</span></a> <a class="idref" href="Arrays.html#n:5"><span class="id" title="variable">n</span></a> <a class="idref" href="Arrays.html#v:6"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:9" class="idref" href="#p:9"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Arrays.html#harray"><span class="id" title="axiom">harray</span></a> (<span class="id" title="definition">LibList.make</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">n</span>) <a class="idref" href="Arrays.html#v:6"><span class="id" title="variable">v</span></a>) <a class="idref" href="Arrays.html#p:7"><span class="id" title="variable">p</span></a>).<br/>
</div>

<div class="doc">
Alternatively, the array produced by <span class="inlinecode"><span class="id" title="var">make</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> can be described
    extensionally, as a list <span class="inlinecode"><span class="id" title="var">L</span></span> of length <span class="inlinecode"><span class="id" title="var">n</span></span> such that all its elements are
    equal to <span class="inlinecode"><span class="id" title="var">v</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_array_make'" class="idref" href="#triple_array_make'"><span class="id" title="axiom">triple_array_make'</span></a> : <span class="id" title="keyword">∀</span> <a id="n:11" class="idref" href="#n:11"><span class="id" title="binder">n</span></a> <a id="v:12" class="idref" href="#v:12"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#n:11"><span class="id" title="variable">n</span></a> <span class="id" title="notation">≥</span> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#val_array_make"><span class="id" title="axiom">val_array_make</span></a> <a class="idref" href="Arrays.html#n:11"><span class="id" title="variable">n</span></a> <a class="idref" href="Arrays.html#v:12"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:15" class="idref" href="#p:15"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="L:16" class="idref" href="#L:16"><span class="id" title="binder">L</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Arrays.html#harray"><span class="id" title="axiom">harray</span></a> <a class="idref" href="Arrays.html#L:16"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:13"><span class="id" title="variable">p</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Arrays.html#n:11"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:16"><span class="id" title="variable">L</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><span class="id" title="keyword">∀</span> <a id="i:17" class="idref" href="#i:17"><span class="id" title="binder">i</span></a>, 0 <span class="id" title="notation">≤</span> <a class="idref" href="Arrays.html#i:17"><span class="id" title="variable">i</span></a> <span class="id" title="notation">&lt;</span> <a class="idref" href="Arrays.html#n:11"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <span class="id" title="definition">LibList.nth</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">i</span>) <a class="idref" href="Arrays.html#L:16"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#v:12"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>).<br/>
</div>

<div class="doc">
We'll come back shortly afterwards on the benefits of using the first
    presentation, expressed using <span class="inlinecode"><span class="id" title="var">LibList.make</span></span>. 
<div class="paragraph"> </div>

 The operation <span class="inlinecode"><span class="id" title="var">val_array_length</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> returns the length of the array allocated
    at location <span class="inlinecode"><span class="id" title="var">p</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="val_array_length" class="idref" href="#val_array_length"><span class="id" title="axiom">val_array_length</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
</div>

<div class="doc">
The specification for <span class="inlinecode"><span class="id" title="var">val_array_length</span></span> expects a heap predicate of the
    form <span class="inlinecode"><span class="id" title="var">harray</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> and asserts that the return value is the length of the
    logical list <span class="inlinecode"><span class="id" title="var">L</span></span>. The postcondition repeats <span class="inlinecode"><span class="id" title="var">harray</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> to capture the fact
    that the array is not modified during the operation. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_array_length" class="idref" href="#triple_array_length"><span class="id" title="axiom">triple_array_length</span></a> : <span class="id" title="keyword">∀</span> <a id="L:20" class="idref" href="#L:20"><span class="id" title="binder">L</span></a> <a id="p:21" class="idref" href="#p:21"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#val_array_length"><span class="id" title="axiom">val_array_length</span></a> <a class="idref" href="Arrays.html#p:21"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Arrays.html#harray"><span class="id" title="axiom">harray</span></a> <a class="idref" href="Arrays.html#L:20"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:21"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:22" class="idref" href="#r:22"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Arrays.html#r:22"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:20"><span class="id" title="variable">L</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#harray"><span class="id" title="axiom">harray</span></a> <a class="idref" href="Arrays.html#L:20"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:21"><span class="id" title="variable">p</span></a>).<br/>
</div>

<div class="doc">
The operation <span class="inlinecode"><span class="id" title="var">val_array_get</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> returns the contents of the <span class="inlinecode"><span class="id" title="var">i</span></span>-th cell of
    the array at location <span class="inlinecode"><span class="id" title="var">p</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="val_array_get" class="idref" href="#val_array_get"><span class="id" title="axiom">val_array_get</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
</div>

<div class="doc">
The specification of <span class="inlinecode"><span class="id" title="var">val_array_get</span></span> is as follows. The precondition
    describes the array in the form <span class="inlinecode"><span class="id" title="var">harray</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>, with a premise that requires
    the index <span class="inlinecode"><span class="id" title="var">i</span></span> to be in the valid range, that is, between zero (inclusive)
    and the length of <span class="inlinecode"><span class="id" title="var">L</span></span> (exclusive). The postcondition asserts that the result
    value is the <span class="inlinecode"><span class="id" title="var">i</span></span>-th element of the list <span class="inlinecode"><span class="id" title="var">L</span></span>, written <span class="inlinecode"><span class="id" title="var">nth</span></span> <span class="inlinecode">(<span class="id" title="var">abs</span></span> <span class="inlinecode"><span class="id" title="var">i</span>)</span> <span class="inlinecode"><span class="id" title="var">L</span></span>. The
    postcondition again repeats <span class="inlinecode"><span class="id" title="var">harray</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> because the array is unchanged. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_array_get" class="idref" href="#triple_array_get"><span class="id" title="axiom">triple_array_get</span></a> : <span class="id" title="keyword">∀</span> <a id="L:25" class="idref" href="#L:25"><span class="id" title="binder">L</span></a> <a id="p:26" class="idref" href="#p:26"><span class="id" title="binder">p</span></a> <a id="i:27" class="idref" href="#i:27"><span class="id" title="binder">i</span></a>,<br/>
&nbsp;&nbsp;0 <span class="id" title="notation">≤</span> <a class="idref" href="Arrays.html#i:27"><span class="id" title="variable">i</span></a> <span class="id" title="notation">&lt;</span> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:25"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#val_array_get"><span class="id" title="axiom">val_array_get</span></a> <a class="idref" href="Arrays.html#p:26"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:27"><span class="id" title="variable">i</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Arrays.html#harray"><span class="id" title="axiom">harray</span></a> <a class="idref" href="Arrays.html#L:25"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:26"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:28" class="idref" href="#r:28"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Arrays.html#r:28"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">LibList.nth</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">i</span>) <a class="idref" href="Arrays.html#L:25"><span class="id" title="variable">L</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#harray"><span class="id" title="axiom">harray</span></a> <a class="idref" href="Arrays.html#L:25"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:26"><span class="id" title="variable">p</span></a>).<br/>
</div>

<div class="doc">
The operation <span class="inlinecode"><span class="id" title="var">val_array_set</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> updates the contents of the <span class="inlinecode"><span class="id" title="var">i</span></span>-th cell
    of the array at location <span class="inlinecode"><span class="id" title="var">p</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="val_array_set" class="idref" href="#val_array_set"><span class="id" title="axiom">val_array_set</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
</div>

<div class="doc">
The specification of <span class="inlinecode"><span class="id" title="var">val_array_set</span></span> admits the same precondition as
    <span class="inlinecode"><span class="id" title="var">val_array_get</span></span>, with <span class="inlinecode"><span class="id" title="var">harray</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> and the constraint <span class="inlinecode">0</span> <span class="inlinecode">≤</span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode">&lt;</span> <span class="inlinecode"><span class="id" title="var">length</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span>.
    Its postcondition describes the updated array using a predicate of the form
    <span class="inlinecode"><span class="id" title="var">harray</span></span> <span class="inlinecode"><span class="id" title="var">L'</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>, where <span class="inlinecode"><span class="id" title="var">L'</span></span> corresponds to the update of the <span class="inlinecode"><span class="id" title="var">i</span></span>-th item of
    the list <span class="inlinecode"><span class="id" title="var">L</span></span> with the value <span class="inlinecode"><span class="id" title="var">v</span></span>, written <span class="inlinecode"><span class="id" title="var">update</span></span> <span class="inlinecode">(<span class="id" title="var">abs</span></span> <span class="inlinecode"><span class="id" title="var">i</span>)</span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_array_set" class="idref" href="#triple_array_set"><span class="id" title="axiom">triple_array_set</span></a> : <span class="id" title="keyword">∀</span> <a id="L:31" class="idref" href="#L:31"><span class="id" title="binder">L</span></a> <a id="p:32" class="idref" href="#p:32"><span class="id" title="binder">p</span></a> <a id="i:33" class="idref" href="#i:33"><span class="id" title="binder">i</span></a> <a id="v:34" class="idref" href="#v:34"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;0 <span class="id" title="notation">≤</span> <a class="idref" href="Arrays.html#i:33"><span class="id" title="variable">i</span></a> <span class="id" title="notation">&lt;</span> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:31"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#val_array_set"><span class="id" title="axiom">val_array_set</span></a> <a class="idref" href="Arrays.html#p:32"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:33"><span class="id" title="variable">i</span></a> <a class="idref" href="Arrays.html#v:34"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Arrays.html#harray"><span class="id" title="axiom">harray</span></a> <a class="idref" href="Arrays.html#L:31"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:32"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Arrays.html#harray"><span class="id" title="axiom">harray</span></a> (<span class="id" title="definition">LibList.update</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">i</span>) <a class="idref" href="Arrays.html#v:34"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#L:31"><span class="id" title="variable">L</span></a>) <a class="idref" href="Arrays.html#p:32"><span class="id" title="variable">p</span></a>).<br/><hr class='doublespaceincode'/>
#[<span class="id" title="var">global</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Resolve</span> <span class="id" title="var">triple_array_get</span> <span class="id" title="var">triple_array_set</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">triple_array_make</span> <span class="id" title="var">triple_array_length</span> : <span class="id" title="var">triple</span>.<br/>
</div>

<div class="doc">
Above, we saw two ways of stating the postcondition of the <span class="inlinecode"><span class="id" title="var">array_make</span></span>
    operation: either describing the result using a corresponding logical
    operation, like in <span class="inlinecode"><span class="id" title="var">triple_array_make</span></span>; or describing the result
    extensionally by specifying the value of each cell, as in
    <span class="inlinecode"><span class="id" title="var">triple_array_make'</span></span>. A question of this kind appears not only here for
    <span class="inlinecode"><span class="id" title="var">array_make</span></span>, but for numerous other operations involving arrays. There is
    no definite rule, but the following considerations motivate our preference
    for the first style.

<div class="paragraph"> </div>

    A first aspect to take into account is that expressing the postcondition in
    terms of a logical operation like in <span class="inlinecode"><span class="id" title="var">triple_array_make</span></span> leads to a more
    concise specification.

<div class="paragraph"> </div>

    A second aspect to consider is how to reason about a sequence of operations
    involving arrays. For example, consider the following program fragment.

<div class="paragraph"> </div>

<span class="inlinecode-ocaml">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">t</span> = <span class="id" title="var">Array.make</span> <span class="id" title="var">n</span> <span class="id" title="var">v</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t</span>.(<span class="id" title="var">i</span>) &lt;- <span class="id" title="var">w</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t</span>.(<span class="id" title="var">j</span>)
</span>
<div class="paragraph"> </div>

    When using logical operations, the resulting array may be described as
    <span class="inlinecode"><span class="id" title="var">nth</span></span> <span class="inlinecode">(<span class="id" title="var">abs</span></span> <span class="inlinecode"><span class="id" title="var">j</span>)</span> <span class="inlinecode">(<span class="id" title="var">update</span></span> <span class="inlinecode">(<span class="id" title="var">abs</span></span> <span class="inlinecode"><span class="id" title="var">i</span>)</span> <span class="inlinecode"><span class="id" title="var">w</span></span> <span class="inlinecode">(<span class="id" title="var">make</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">v</span>))</span>. If <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode">≠</span> <span class="inlinecode"><span class="id" title="var">j</span></span>, this expression
    can be simplified by rewriting into <span class="inlinecode"><span class="id" title="var">v</span></span>. In other words, all the reasoning
    is carried out by in-place rewriting without involving any hypothesis.

<div class="paragraph"> </div>

    When using extensional characterization, the operation <span class="inlinecode"><span class="id" title="var">Array.make</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> is
    described as an array <span class="inlinecode"><span class="id" title="var">L</span></span> such that <span class="inlinecode"><span class="id" title="var">nth</span></span> <span class="inlinecode">(<span class="id" title="var">abs</span></span> <span class="inlinecode"><span class="id" title="var">k</span>)</span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">v</span></span> holds for any valid
    index <span class="inlinecode"><span class="id" title="var">k</span></span>. In that same style, the operation <span class="inlinecode"><span class="id" title="var">Array.set</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="id" title="var">w</span></span> would be
    described as returning an array <span class="inlinecode"><span class="id" title="var">L'</span></span> such that <span class="inlinecode"><span class="id" title="var">nth</span></span> <span class="inlinecode">(<span class="id" title="var">abs</span></span> <span class="inlinecode"><span class="id" title="var">i</span>)</span> <span class="inlinecode"><span class="id" title="var">L'</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">w</span></span> and
    <span class="inlinecode"><span class="id" title="var">nth</span></span> <span class="inlinecode">(<span class="id" title="var">abs</span></span> <span class="inlinecode"><span class="id" title="var">k</span>)</span> <span class="inlinecode"><span class="id" title="var">L'</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">nth</span></span> <span class="inlinecode">(<span class="id" title="var">abs</span></span> <span class="inlinecode"><span class="id" title="var">k</span>)</span> <span class="inlinecode"><span class="id" title="var">L</span></span> for any valid index <span class="inlinecode"><span class="id" title="var">k</span></span> such that <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode">≠</span> <span class="inlinecode"><span class="id" title="var">i</span></span>.
    Then, the final value is described as <span class="inlinecode"><span class="id" title="var">nth</span></span> <span class="inlinecode">(<span class="id" title="var">abs</span></span> <span class="inlinecode"><span class="id" title="var">j</span>)</span> <span class="inlinecode"><span class="id" title="var">L'</span></span>. To prove this value
    equal to <span class="inlinecode"><span class="id" title="var">v</span></span> under the assumption <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode">≠</span> <span class="inlinecode"><span class="id" title="var">j</span></span>, we would need to perform two
    rewriting steps using each of the two hypotheses: <span class="inlinecode"><span class="id" title="var">nth</span></span> <span class="inlinecode">(<span class="id" title="var">abs</span></span> <span class="inlinecode"><span class="id" title="var">j</span>)</span> <span class="inlinecode"><span class="id" title="var">L'</span></span> is equal
    to <span class="inlinecode"><span class="id" title="var">nth</span></span> <span class="inlinecode">(<span class="id" title="var">abs</span></span> <span class="inlinecode"><span class="id" title="var">j</span>)</span> <span class="inlinecode"><span class="id" title="var">L</span></span>, hence equal to <span class="inlinecode"><span class="id" title="var">v</span></span>.

<div class="paragraph"> </div>

    In summary, both approach work. But when a logical function corresponding to
    the program function can be used, hypotheses are more concise and tend to be
    better suited for automated simplification by rewriting. Of course, there
    might be overheads to defining this logical function, but if it already
    exists in the library of our theorem prover, then the overhead is null. 
</div>

<div class="doc">
<a id="lab430"></a><h2 class="section">Small-Footprint Specifications for Array Operations</h2>

<div class="paragraph"> </div>

 The large-footprint specifications presented above are sufficently
    expressive for verifying sequential programs manipulating arrays, but they
    are too limited for verifying a parallel program that concurrently updates
    two independent segments of an array. Indeed, even the verification of
    certain sequential programs can benefit from the use of smaller-footprint
    specifications, which require the ownership not of the whole array but only
    of a specific subset of the array cells.

<div class="paragraph"> </div>

    For example, the divide-and-conquer <span class="inlinecode"><span class="id" title="var">quicksort</span></span> function sorts the elements
    in a given range of cells. Even though <span class="inlinecode"><span class="id" title="var">quicksort</span></span> is not a concurrent
    function, using a small-footprint specification avoids the need to
    explicitly state the fact that cells of the array outside of the segment
    targeted by a recursive call remain unmodified.

<div class="paragraph"> </div>

    In what follows, we present small-footprint specifications for operating on
    individual cells and for operating on array segments, then present the proof
    of quicksort. 
<div class="paragraph"> </div>

 Small-footprint specifications are expressed using heap predicates for
    individual array and header cells.

<div class="paragraph"> </div>

    The heap predicate <span class="inlinecode"><span class="id" title="var">hcell</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> asserts that the cell at index <span class="inlinecode"><span class="id" title="var">i</span></span> in the
    array <span class="inlinecode"><span class="id" title="var">p</span></span> stores the value <span class="inlinecode"><span class="id" title="var">v</span></span>.

<div class="paragraph"> </div>

    Internally, as explained below, <span class="inlinecode"><span class="id" title="var">hcell</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> can be defined as
    <span class="inlinecode">(<span class="id" title="var">p</span>+1+<span class="id" title="var">i</span>)</span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">v</span></span>, with the <span class="inlinecode">+1</span> corresponding to the header cell. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="hcell" class="idref" href="#hcell"><span class="id" title="axiom">hcell</span></a> : <span class="id" title="keyword">∀</span> (<a id="v:36" class="idref" href="#v:36"><span class="id" title="binder">v</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) (<a id="p:37" class="idref" href="#p:37"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) (<a id="i:38" class="idref" href="#i:38"><span class="id" title="binder">i</span></a>:<span class="id" title="notation">int</span>), <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>.<br/>
</div>

<div class="doc">
The heap predicate <span class="inlinecode"><span class="id" title="var">hheader</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> asserts that the header cell of the array
    at address <span class="inlinecode"><span class="id" title="var">p</span></span> stores the length <span class="inlinecode"><span class="id" title="var">n</span></span>. Internally, <span class="inlinecode"><span class="id" title="var">hheader</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> can be
    defined as <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">n</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="hheader" class="idref" href="#hheader"><span class="id" title="axiom">hheader</span></a> : <span class="id" title="keyword">∀</span> (<a id="n:40" class="idref" href="#n:40"><span class="id" title="binder">n</span></a>:<span class="id" title="notation">int</span>) (<a id="p:41" class="idref" href="#p:41"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>), <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>.<br/>
</div>

<div class="doc">
To read the length of an array, it is sufficient to provide the heap
    predicate associated with the header field of that array. In other words,
    there is no need to have the ownership of any cell of an array for reading
    its length. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_array_length_hheader" class="idref" href="#triple_array_length_hheader"><span class="id" title="axiom">triple_array_length_hheader</span></a> : <span class="id" title="keyword">∀</span> <a id="n:43" class="idref" href="#n:43"><span class="id" title="binder">n</span></a> <a id="p:44" class="idref" href="#p:44"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#val_array_length"><span class="id" title="axiom">val_array_length</span></a> <a class="idref" href="Arrays.html#p:44"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Arrays.html#hheader"><span class="id" title="axiom">hheader</span></a> <a class="idref" href="Arrays.html#n:43"><span class="id" title="variable">n</span></a> <a class="idref" href="Arrays.html#p:44"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:45" class="idref" href="#r:45"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Arrays.html#r:45"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="Arrays.html#n:43"><span class="id" title="variable">n</span></a>:<span class="id" title="notation">int</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#hheader"><span class="id" title="axiom">hheader</span></a> <a class="idref" href="Arrays.html#n:43"><span class="id" title="variable">n</span></a> <a class="idref" href="Arrays.html#p:44"><span class="id" title="variable">p</span></a>).<br/>
</div>

<div class="doc">
To read or write in a given array cell, it is sufficient to provide the
    <span class="inlinecode"><span class="id" title="var">hcell</span></span> predicate associated with that cell. There is no need to own the
    header cell or other cells of the array. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_array_get_hcell" class="idref" href="#triple_array_get_hcell"><span class="id" title="axiom">triple_array_get_hcell</span></a> : <span class="id" title="keyword">∀</span> <a id="p:47" class="idref" href="#p:47"><span class="id" title="binder">p</span></a> <a id="i:48" class="idref" href="#i:48"><span class="id" title="binder">i</span></a> <a id="v:49" class="idref" href="#v:49"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#val_array_get"><span class="id" title="axiom">val_array_get</span></a> <a class="idref" href="Arrays.html#p:47"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:48"><span class="id" title="variable">i</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Arrays.html#hcell"><span class="id" title="axiom">hcell</span></a> <a class="idref" href="Arrays.html#v:49"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#p:47"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:48"><span class="id" title="variable">i</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:50" class="idref" href="#r:50"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Arrays.html#r:50"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#v:49"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#hcell"><span class="id" title="axiom">hcell</span></a> <a class="idref" href="Arrays.html#v:49"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#p:47"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:48"><span class="id" title="variable">i</span></a>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Parameter</span> <a id="triple_array_set_hcell" class="idref" href="#triple_array_set_hcell"><span class="id" title="axiom">triple_array_set_hcell</span></a> : <span class="id" title="keyword">∀</span> <a id="p:52" class="idref" href="#p:52"><span class="id" title="binder">p</span></a> <a id="i:53" class="idref" href="#i:53"><span class="id" title="binder">i</span></a> <a id="v:54" class="idref" href="#v:54"><span class="id" title="binder">v</span></a> <a id="w:55" class="idref" href="#w:55"><span class="id" title="binder">w</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#val_array_set"><span class="id" title="axiom">val_array_set</span></a> <a class="idref" href="Arrays.html#p:52"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:53"><span class="id" title="variable">i</span></a> <a class="idref" href="Arrays.html#v:54"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Arrays.html#hcell"><span class="id" title="axiom">hcell</span></a> <a class="idref" href="Arrays.html#w:55"><span class="id" title="variable">w</span></a> <a class="idref" href="Arrays.html#p:52"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:53"><span class="id" title="variable">i</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Arrays.html#hcell"><span class="id" title="axiom">hcell</span></a> <a class="idref" href="Arrays.html#v:54"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#p:52"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:53"><span class="id" title="variable">i</span></a>).<br/>
</div>

<div class="doc">
Note: technically, an ML runtime performs bound checks on <span class="inlinecode"><span class="id" title="var">get</span></span> and <span class="inlinecode"><span class="id" title="tactic">set</span></span>
    operations, to ensure that the indices provided fall within the array. These
    bound-checks operations do involve a read to the header field. Thus, it may
    appear that the header cell ought to be involved in the specification of
    <span class="inlinecode"><span class="id" title="var">get</span></span> and <span class="inlinecode"><span class="id" title="tactic">set</span></span>. However, providing the <span class="inlinecode"><span class="id" title="var">hheader</span></span> predicate is not actually
    required for verifying the correctness a program. If one wanted to formally
    verify a <i>runtime system</i>, on the other hand, one would argue instead that
    headers are read-only cells, and that the access permissions over such cells
    can be "divided" among the client code and the runtime system. The
    realization of this "division" mechanism is based on the use of "fractional
    permissions", a Separation Logic concept that is just beyond the scope of
    the present course. 
</div>

<div class="doc">
<a id="lab431"></a><h2 class="section">Heap Predicate for Array Segments</h2>

<div class="paragraph"> </div>

 So far, we have presented small-footprint specifications expressed in terms
    of <span class="inlinecode"><span class="id" title="var">hheader</span></span> and <span class="inlinecode"><span class="id" title="var">hcell</span></span>. But the creation of an array via
    <span class="inlinecode"><span class="id" title="var">val_array_make</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> produces a heap predicate of the form <span class="inlinecode"><span class="id" title="var">harray</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>.
    Thus, it remains to explain how to convert an <span class="inlinecode"><span class="id" title="var">harray</span></span> predicate into the
    separating conjunction of an <span class="inlinecode"><span class="id" title="var">hheader</span></span> predicate and a set of <span class="inlinecode"><span class="id" title="var">hcell</span></span>
    predicates. 
<div class="paragraph"> </div>

 The auxiliary predicate <span class="inlinecode"><span class="id" title="var">hseg</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">j</span></span> describes an "array segment": it
    describes the iterated separating conjunction of the predicate <span class="inlinecode"><span class="id" title="var">hcell</span></span> over
    a set of consecutive cells starting at index <span class="inlinecode"><span class="id" title="var">j</span></span>, with elements described by
    the list <span class="inlinecode"><span class="id" title="var">L</span></span>. For example, <span class="inlinecode"><span class="id" title="var">hseg</span></span> <span class="inlinecode">(<span class="id" title="var">x<sub>0</sub></span>::<span class="id" title="var">x<sub>1</sub></span>::<span class="id" title="var">x<sub>2</sub></span>::<span class="id" title="var">nil</span>)</span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">j</span></span> corresponds to
    <span class="inlinecode"><span class="id" title="var">hcell</span></span> <span class="inlinecode"><span class="id" title="var">x<sub>0</sub></span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">(<span class="id" title="var">j</span>+0)</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">hcell</span></span> <span class="inlinecode"><span class="id" title="var">x<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">(<span class="id" title="var">j</span>+1)</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">hcell</span></span> <span class="inlinecode"><span class="id" title="var">x<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">(<span class="id" title="var">j</span>+2)</span>. Internally, this
    corresponds to the cells at address <span class="inlinecode"><span class="id" title="var">p</span>+1+<span class="id" title="var">j</span></span>, <span class="inlinecode"><span class="id" title="var">p</span>+2+<span class="id" title="var">j</span></span>, and <span class="inlinecode"><span class="id" title="var">p</span>+3+<span class="id" title="var">j</span></span>, skipping
    the header cell located at address <span class="inlinecode"><span class="id" title="var">p</span>+<span class="id" title="var">j</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <a id="hseg" class="idref" href="#hseg"><span class="id" title="definition">hseg</span></a> (<a id="L:57" class="idref" href="#L:57"><span class="id" title="binder">L</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) (<a id="p:58" class="idref" href="#p:58"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) (<a id="j:59" class="idref" href="#j:59"><span class="id" title="binder">j</span></a>:<span class="id" title="notation">int</span>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Arrays.html#L:57"><span class="id" title="variable">L</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> ⇒ <a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;| <span class="id" title="var">x</span><span class="id" title="notation">::</span><span class="id" title="var">L'</span> ⇒ <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Arrays.html#hcell"><span class="id" title="axiom">hcell</span></a> <span class="id" title="var">x</span> <a class="idref" href="Arrays.html#p:58"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:59"><span class="id" title="variable">j</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Arrays.html#hseg:60"><span class="id" title="definition">hseg</span></a> <span class="id" title="var">L'</span> <a class="idref" href="Arrays.html#p:58"><span class="id" title="variable">p</span></a> (<a class="idref" href="Arrays.html#j:59"><span class="id" title="variable">j</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1)<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
If the list <span class="inlinecode"><span class="id" title="var">L</span></span> is empty, then <span class="inlinecode"><span class="id" title="var">hseg</span></span> <span class="inlinecode"><span class="id" title="var">nil</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">j</span></span> is equivalent to the empty
    heap predicate. In particular, it does not assert that <span class="inlinecode"><span class="id" title="var">j</span></span> is a valid index
    in the array. (The proofs of this lemma and the following one appear further
    in the file.) 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="hseg_nil" class="idref" href="#hseg_nil"><span class="id" title="axiom">hseg_nil</span></a> : <span class="id" title="keyword">∀</span> <a id="p:62" class="idref" href="#p:62"><span class="id" title="binder">p</span></a> <a id="j:63" class="idref" href="#j:63"><span class="id" title="binder">j</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="Arrays.html#p:62"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:63"><span class="id" title="variable">j</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a>.<br/>
</div>

<div class="doc">
If the list <span class="inlinecode"><span class="id" title="var">L</span></span> is a singleton, then <span class="inlinecode"><span class="id" title="var">hseg</span></span> <span class="inlinecode">(<span class="id" title="var">v</span>::<span class="id" title="var">nil</span>)</span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">j</span></span> is equivalent to
    <span class="inlinecode"><span class="id" title="var">hcell</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">j</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="hseg_one" class="idref" href="#hseg_one"><span class="id" title="axiom">hseg_one</span></a> : <span class="id" title="keyword">∀</span> <a id="v:65" class="idref" href="#v:65"><span class="id" title="binder">v</span></a> <a id="p:66" class="idref" href="#p:66"><span class="id" title="binder">p</span></a> <a id="j:67" class="idref" href="#j:67"><span class="id" title="binder">j</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> (<a class="idref" href="Arrays.html#v:65"><span class="id" title="variable">v</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>) <a class="idref" href="Arrays.html#p:66"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:67"><span class="id" title="variable">j</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#hcell"><span class="id" title="axiom">hcell</span></a> <a class="idref" href="Arrays.html#v:65"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#p:66"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:67"><span class="id" title="variable">j</span></a>.<br/>
</div>

<div class="doc">
A key result captures how a range of consecutive cells may be split in two
    parts. Concretely, a heap predicate describing a segment with elements
    <span class="inlinecode">(<span class="id" title="var">L<sub>1</sub></span>++<span class="id" title="var">L<sub>2</sub></span>)</span> can be split into a predicate describing a first segment with
    elements <span class="inlinecode"><span class="id" title="var">L<sub>1</sub></span></span> and another predicate describing a second segment with
    elements <span class="inlinecode"><span class="id" title="var">L<sub>2</sub></span></span>. The two parts can be merged back into the original form at
    any time, as captured by the equality symbol in the statement below. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="hseg_app" class="idref" href="#hseg_app"><span class="id" title="axiom">hseg_app</span></a> : <span class="id" title="keyword">∀</span> <a id="p:69" class="idref" href="#p:69"><span class="id" title="binder">p</span></a> <a id="j:70" class="idref" href="#j:70"><span class="id" title="binder">j</span></a> <a id="L<sub>1</sub>:71" class="idref" href="#L<sub>1</sub>:71"><span class="id" title="binder">L<sub>1</sub></span></a> <a id="L<sub>2</sub>:72" class="idref" href="#L<sub>2</sub>:72"><span class="id" title="binder">L<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> (<a class="idref" href="Arrays.html#L<sub>1</sub>:71"><span class="id" title="variable">L<sub>1</sub></span></a> <span class="id" title="notation">++</span> <a class="idref" href="Arrays.html#L<sub>2</sub>:72"><span class="id" title="variable">L<sub>2</sub></span></a>) <a class="idref" href="Arrays.html#p:69"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:70"><span class="id" title="variable">j</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L<sub>1</sub>:71"><span class="id" title="variable">L<sub>1</sub></span></a> <a class="idref" href="Arrays.html#p:69"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:70"><span class="id" title="variable">j</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L<sub>2</sub>:72"><span class="id" title="variable">L<sub>2</sub></span></a> <a class="idref" href="Arrays.html#p:69"><span class="id" title="variable">p</span></a> (<a class="idref" href="Arrays.html#j:70"><span class="id" title="variable">j</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L<sub>1</sub>:71"><span class="id" title="variable">L<sub>1</sub></span></a>).<br/>
</div>

<div class="doc">
For verifying programs, two corollaries are convenient. The lemma
    <span class="inlinecode"><span class="id" title="var">hseg_cons</span></span> isolates the first cell of a segment, whereas the lemma
    <span class="inlinecode"><span class="id" title="var">hseg_last</span></span> isolates the last cell of a segment. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="hseg_cons" class="idref" href="#hseg_cons"><span class="id" title="lemma">hseg_cons</span></a> : <span class="id" title="keyword">∀</span> <a id="v:74" class="idref" href="#v:74"><span class="id" title="binder">v</span></a> <a id="p:75" class="idref" href="#p:75"><span class="id" title="binder">p</span></a> <a id="j:76" class="idref" href="#j:76"><span class="id" title="binder">j</span></a> <a id="L:77" class="idref" href="#L:77"><span class="id" title="binder">L</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> (<a class="idref" href="Arrays.html#v:74"><span class="id" title="variable">v</span></a><span class="id" title="notation">::</span><a class="idref" href="Arrays.html#L:77"><span class="id" title="variable">L</span></a>) <a class="idref" href="Arrays.html#p:75"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:76"><span class="id" title="variable">j</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#hcell"><span class="id" title="axiom">hcell</span></a> <a class="idref" href="Arrays.html#v:74"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#p:75"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:76"><span class="id" title="variable">j</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L:77"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:75"><span class="id" title="variable">p</span></a> (<a class="idref" href="Arrays.html#j:76"><span class="id" title="variable">j</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="hseg_last" class="idref" href="#hseg_last"><span class="id" title="lemma">hseg_last</span></a> : <span class="id" title="keyword">∀</span> <a id="v:78" class="idref" href="#v:78"><span class="id" title="binder">v</span></a> <a id="p:79" class="idref" href="#p:79"><span class="id" title="binder">p</span></a> <a id="j:80" class="idref" href="#j:80"><span class="id" title="binder">j</span></a> <a id="L:81" class="idref" href="#L:81"><span class="id" title="binder">L</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> (<a class="idref" href="Arrays.html#L:81"><span class="id" title="variable">L</span></a><span class="id" title="notation">&amp;</span><a class="idref" href="Arrays.html#v:78"><span class="id" title="variable">v</span></a>) <a class="idref" href="Arrays.html#p:79"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:80"><span class="id" title="variable">j</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L:81"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:79"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:80"><span class="id" title="variable">j</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#hcell"><span class="id" title="axiom">hcell</span></a> <a class="idref" href="Arrays.html#v:78"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#p:79"><span class="id" title="variable">p</span></a> (<a class="idref" href="Arrays.html#j:80"><span class="id" title="variable">j</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a><span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:81"><span class="id" title="variable">L</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="Arrays.html#hseg_app"><span class="id" title="axiom">hseg_app</span></a>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="Arrays.html#hseg_cons"><span class="id" title="lemma">hseg_cons</span></a>, <a class="idref" href="Arrays.html#hseg_nil"><span class="id" title="axiom">hseg_nil</span></a>. <span class="id" title="var">xsimpl</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
These two corollaries themselves admit additional reformulations that help
    merge back the isolated head and tail cells. 
<div class="paragraph"> </div>

 Their statements do not constraint the offsets to be syntactically of the
    form <span class="inlinecode"><span class="id" title="var">j</span></span> <span class="inlinecode">+</span> <span class="inlinecode">1</span> or <span class="inlinecode"><span class="id" title="var">j</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">length</span></span> <span class="inlinecode"><span class="id" title="var">L<sub>1</sub></span></span>, but instead introduce arithmetic equalities
    that the tactic <span class="inlinecode"><span class="id" title="var">math</span></span> can generally handle. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="hseg_cons_r" class="idref" href="#hseg_cons_r"><span class="id" title="lemma">hseg_cons_r</span></a> : <span class="id" title="keyword">∀</span> <a id="L:82" class="idref" href="#L:82"><span class="id" title="binder">L</span></a> <a id="v:83" class="idref" href="#v:83"><span class="id" title="binder">v</span></a> <a id="p:84" class="idref" href="#p:84"><span class="id" title="binder">p</span></a> <a id="j<sub>1</sub>:85" class="idref" href="#j<sub>1</sub>:85"><span class="id" title="binder">j<sub>1</sub></span></a> <a id="j<sub>2</sub>:86" class="idref" href="#j<sub>2</sub>:86"><span class="id" title="binder">j<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#j<sub>2</sub>:86"><span class="id" title="variable">j<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#j<sub>1</sub>:85"><span class="id" title="variable">j<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#hcell"><span class="id" title="axiom">hcell</span></a> <a class="idref" href="Arrays.html#v:83"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#p:84"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j<sub>1</sub>:85"><span class="id" title="variable">j<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L:82"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:84"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j<sub>2</sub>:86"><span class="id" title="variable">j<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> (<a class="idref" href="Arrays.html#v:83"><span class="id" title="variable">v</span></a><span class="id" title="notation">::</span><a class="idref" href="Arrays.html#L:82"><span class="id" title="variable">L</span></a>) <a class="idref" href="Arrays.html#p:84"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j<sub>1</sub>:85"><span class="id" title="variable">j<sub>1</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span>* <a class="idref" href="Arrays.html#hseg_cons"><span class="id" title="lemma">hseg_cons</span></a>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="hseg_app_r" class="idref" href="#hseg_app_r"><span class="id" title="lemma">hseg_app_r</span></a> : <span class="id" title="keyword">∀</span> <a id="p:87" class="idref" href="#p:87"><span class="id" title="binder">p</span></a> <a id="L<sub>1</sub>:88" class="idref" href="#L<sub>1</sub>:88"><span class="id" title="binder">L<sub>1</sub></span></a> <a id="L<sub>2</sub>:89" class="idref" href="#L<sub>2</sub>:89"><span class="id" title="binder">L<sub>2</sub></span></a> <a id="j<sub>1</sub>:90" class="idref" href="#j<sub>1</sub>:90"><span class="id" title="binder">j<sub>1</sub></span></a> <a id="j<sub>2</sub>:91" class="idref" href="#j<sub>2</sub>:91"><span class="id" title="binder">j<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#j<sub>2</sub>:91"><span class="id" title="variable">j<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#j<sub>1</sub>:90"><span class="id" title="variable">j<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L<sub>1</sub>:88"><span class="id" title="variable">L<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L<sub>1</sub>:88"><span class="id" title="variable">L<sub>1</sub></span></a> <a class="idref" href="Arrays.html#p:87"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j<sub>1</sub>:90"><span class="id" title="variable">j<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L<sub>2</sub>:89"><span class="id" title="variable">L<sub>2</sub></span></a> <a class="idref" href="Arrays.html#p:87"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j<sub>2</sub>:91"><span class="id" title="variable">j<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> (<a class="idref" href="Arrays.html#L<sub>1</sub>:88"><span class="id" title="variable">L<sub>1</sub></span></a> <span class="id" title="notation">++</span> <a class="idref" href="Arrays.html#L<sub>2</sub>:89"><span class="id" title="variable">L<sub>2</sub></span></a>) <a class="idref" href="Arrays.html#p:87"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j<sub>1</sub>:90"><span class="id" title="variable">j<sub>1</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span>* <a class="idref" href="Arrays.html#hseg_app"><span class="id" title="axiom">hseg_app</span></a>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="hseg_last_r" class="idref" href="#hseg_last_r"><span class="id" title="lemma">hseg_last_r</span></a> : <span class="id" title="keyword">∀</span> <a id="v:92" class="idref" href="#v:92"><span class="id" title="binder">v</span></a> <a id="p:93" class="idref" href="#p:93"><span class="id" title="binder">p</span></a> <a id="j:94" class="idref" href="#j:94"><span class="id" title="binder">j</span></a> <a id="L:95" class="idref" href="#L:95"><span class="id" title="binder">L</span></a> <a id="j':96" class="idref" href="#j':96"><span class="id" title="binder">j'</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#j':96"><span class="id" title="variable">j'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="Arrays.html#j:94"><span class="id" title="variable">j</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a><span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:95"><span class="id" title="variable">L</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L:95"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:93"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:94"><span class="id" title="variable">j</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#hcell"><span class="id" title="axiom">hcell</span></a> <a class="idref" href="Arrays.html#v:92"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#p:93"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j':96"><span class="id" title="variable">j'</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> (<a class="idref" href="Arrays.html#L:95"><span class="id" title="variable">L</span></a><span class="id" title="notation">&amp;</span><a class="idref" href="Arrays.html#v:92"><span class="id" title="variable">v</span></a>) <a class="idref" href="Arrays.html#p:93"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:94"><span class="id" title="variable">j</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span>* <a class="idref" href="Arrays.html#hseg_last"><span class="id" title="lemma">hseg_last</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab432"></a><h2 class="section">Derived Segment-Based Specifications for Array Operations</h2>

<div class="paragraph"> </div>

 For reasoning about programs that operate over array segments, such as
    <span class="inlinecode"><span class="id" title="var">quicksort</span></span>, it is convenient to specify the functions <span class="inlinecode"><span class="id" title="var">make</span></span>, <span class="inlinecode"><span class="id" title="var">length</span></span>,
    <span class="inlinecode"><span class="id" title="var">get</span></span> and <span class="inlinecode"><span class="id" title="tactic">set</span></span> exclusively in terms of <span class="inlinecode"><span class="id" title="var">hheader</span></span> and <span class="inlinecode"><span class="id" title="var">hseg</span></span>. The lemma
    <span class="inlinecode"><span class="id" title="var">triple_array_length_header</span></span>, already stated earlier, specifies <span class="inlinecode"><span class="id" title="var">length</span></span> in
    terms of <span class="inlinecode"><span class="id" title="var">hheader</span></span>. For the other operations, we consider the following
    derived specifications. 
</div>
<div class="code">

&nbsp;<span class="id" title="keyword">Parameter</span> <a id="triple_array_make_hseg" class="idref" href="#triple_array_make_hseg"><span class="id" title="axiom">triple_array_make_hseg</span></a> : <span class="id" title="keyword">∀</span> <a id="n:97" class="idref" href="#n:97"><span class="id" title="binder">n</span></a> <a id="v:98" class="idref" href="#v:98"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#n:97"><span class="id" title="variable">n</span></a> <span class="id" title="notation">≥</span> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#val_array_make"><span class="id" title="axiom">val_array_make</span></a> <a class="idref" href="Arrays.html#n:97"><span class="id" title="variable">n</span></a> <a class="idref" href="Arrays.html#v:98"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:101" class="idref" href="#p:101"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Arrays.html#hheader"><span class="id" title="axiom">hheader</span></a> (<span class="id" title="notation">abs</span> <span class="id" title="notation">n</span>) <a class="idref" href="Arrays.html#p:99"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> (<span class="id" title="definition">LibList.make</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">n</span>) <a class="idref" href="Arrays.html#v:98"><span class="id" title="variable">v</span></a>) <a class="idref" href="Arrays.html#p:99"><span class="id" title="variable">p</span></a> 0).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Parameter</span> <a id="triple_array_get_hseg" class="idref" href="#triple_array_get_hseg"><span class="id" title="axiom">triple_array_get_hseg</span></a> : <span class="id" title="keyword">∀</span> <a id="L:103" class="idref" href="#L:103"><span class="id" title="binder">L</span></a> <a id="p:104" class="idref" href="#p:104"><span class="id" title="binder">p</span></a> <a id="i:105" class="idref" href="#i:105"><span class="id" title="binder">i</span></a> <a id="j:106" class="idref" href="#j:106"><span class="id" title="binder">j</span></a>,<br/>
&nbsp;&nbsp;0 <span class="id" title="notation">≤</span> <a class="idref" href="Arrays.html#i:105"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#::Z_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="Arrays.html#j:106"><span class="id" title="variable">j</span></a> <span class="id" title="notation">&lt;</span> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:103"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#val_array_get"><span class="id" title="axiom">val_array_get</span></a> <a class="idref" href="Arrays.html#p:104"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:105"><span class="id" title="variable">i</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L:103"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:104"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:106"><span class="id" title="variable">j</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:107" class="idref" href="#r:107"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Arrays.html#r:107"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">LibList.nth</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">i</span><span class="id" title="notation">-</span><span class="id" title="notation">j</span><span class="id" title="notation">)</span>) <a class="idref" href="Arrays.html#L:103"><span class="id" title="variable">L</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L:103"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:104"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:106"><span class="id" title="variable">j</span></a>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Parameter</span> <a id="triple_array_set_hseg" class="idref" href="#triple_array_set_hseg"><span class="id" title="axiom">triple_array_set_hseg</span></a> : <span class="id" title="keyword">∀</span> <a id="L:109" class="idref" href="#L:109"><span class="id" title="binder">L</span></a> <a id="p:110" class="idref" href="#p:110"><span class="id" title="binder">p</span></a> <a id="i:111" class="idref" href="#i:111"><span class="id" title="binder">i</span></a> <a id="j:112" class="idref" href="#j:112"><span class="id" title="binder">j</span></a> <a id="v:113" class="idref" href="#v:113"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;0 <span class="id" title="notation">≤</span> <a class="idref" href="Arrays.html#i:111"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#::Z_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="Arrays.html#j:112"><span class="id" title="variable">j</span></a> <span class="id" title="notation">&lt;</span> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:109"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#val_array_set"><span class="id" title="axiom">val_array_set</span></a> <a class="idref" href="Arrays.html#p:110"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:111"><span class="id" title="variable">i</span></a> <a class="idref" href="Arrays.html#v:113"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L:109"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:110"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:112"><span class="id" title="variable">j</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> (<span class="id" title="definition">LibList.update</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">i</span><span class="id" title="notation">-</span><span class="id" title="notation">j</span><span class="id" title="notation">)</span>) <a class="idref" href="Arrays.html#v:113"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#L:109"><span class="id" title="variable">L</span></a>) <a class="idref" href="Arrays.html#p:110"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:112"><span class="id" title="variable">j</span></a>).<br/>
</div>

<div class="doc">
<a id="lab433"></a><h2 class="section">Verification of the Safety of QuickSort</h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="QuickSort" class="idref" href="#QuickSort"><span class="id" title="module">QuickSort</span></a>.<br/>
<span class="id" title="keyword">Export</span> <a class="idref" href="LibSepVar.html#NotationForVariables"><span class="id" title="module">NotationForVariables</span></a>.<br/>
</div>

<div class="doc">
Let us illustrate the benefits of these segment-based specifications by
    reasoning about the divide-and-conquer <span class="inlinecode"><span class="id" title="var">quicksort</span></span> function. For simplicity,
    let us consider an array that stores integer values. The implementation of
    quicksort is standard, using an auxiliary <span class="inlinecode"><span class="id" title="var">pivot</span></span> function. The operation
    <span class="inlinecode"><span class="id" title="var">pivot</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> processes the segment of array <span class="inlinecode"><span class="id" title="var">p</span></span> that starts at index <span class="inlinecode"><span class="id" title="var">i</span></span>
    and is made of <span class="inlinecode"><span class="id" title="var">n</span></span> elements. It first chooses an arbitrary element from that
    segment as pivot. It then reorders the elements from the segment, separating
    the values less than or equal to the pivot value from the values greater
    than the pivot value. It returns the index at which the pivot value ends up
    being stored in the segment.  <span class="inlinecode-ocaml">&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">pivot</span> <span class="id" title="var">p</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> = ...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">pivot</span></span>&nbsp;modifies&nbsp;an&nbsp;array&nbsp;<span class="inlinecode"><span class="id" title="var">p</span></span>,&nbsp;and&nbsp;returns&nbsp;the&nbsp;index&nbsp;<span class="inlinecode"><span class="id" title="var">j</span></span>&nbsp;of&nbsp;a&nbsp;pivot<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span>,&nbsp;with&nbsp;<span class="inlinecode"><span class="id" title="var">j</span></span>&nbsp;in&nbsp;the&nbsp;range&nbsp;<span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode">≤</span> <span class="inlinecode"><span class="id" title="var">j</span></span> <span class="inlinecode">&lt;</span> <span class="inlinecode"><span class="id" title="var">i</span>+<span class="id" title="var">n</span></span>,&nbsp;such&nbsp;that&nbsp;elements<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;the&nbsp;range&nbsp;<span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode">..</span> <span class="inlinecode"><span class="id" title="var">j</span>-1</span>&nbsp;are&nbsp;smaller&nbsp;than&nbsp;or&nbsp;equal&nbsp;to&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span>,&nbsp;and&nbsp;elements<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;the&nbsp;range&nbsp;<span class="inlinecode"><span class="id" title="var">j</span>+1</span> <span class="inlinecode">..</span> <span class="inlinecode"><span class="id" title="var">i</span>+<span class="id" title="var">n</span>-1</span>&nbsp;are&nbsp;greater&nbsp;than&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span>.&nbsp;*)</span><br/>
<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">quicksort</span></span>&nbsp;sorts&nbsp;an&nbsp;array&nbsp;<span class="inlinecode"><span class="id" title="var">p</span></span>&nbsp;on&nbsp;the&nbsp;range&nbsp;of&nbsp;indices&nbsp;<span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode">..</span> <span class="inlinecode"><span class="id" title="var">i</span>+<span class="id" title="var">n</span>-1</span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="keyword">rec</span> <span class="id" title="var">quicksort</span> <span class="id" title="var">p</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">n</span> &gt; 1 <span class="id" title="keyword">then</span> <span class="id" title="var">begin</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">j</span> = <span class="id" title="var">pivot</span> <span class="id" title="var">p</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">n<sub>1</sub></span> = <span class="id" title="var">j</span> - <span class="id" title="var">i</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">quicksort</span> <span class="id" title="var">p</span> <span class="id" title="var">i</span> <span class="id" title="var">n<sub>1</sub></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">quicksort</span> <span class="id" title="var">p</span> (<span class="id" title="var">j</span>+1) (<span class="id" title="var">n</span>-<span class="id" title="var">n<sub>1</sub></span>-1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>
</span>
<div class="paragraph"> </div>

 As a warm-up before establishing the full functional correctness of
    <span class="inlinecode"><span class="id" title="var">quicksort</span></span>, we begin by establishing its safety and termination. The core
    of this argument is proving that every array access is valid, through the
    use of array-segment specifications. The safety proof captures the essence
    of the ownership reasoning at play, including the framing process over
    recursive calls. In the "More Details" section, we generalize the proof to
    show that <span class="inlinecode"><span class="id" title="var">quicksort</span></span> also correctly sorts its input array. 
<div class="paragraph"> </div>

 First, <span class="inlinecode"><span class="id" title="var">pivot</span></span>.

<div class="paragraph"> </div>

    Its safety specification asserts that <span class="inlinecode"><span class="id" title="var">pivot</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> operates on a range of
    size <span class="inlinecode"><span class="id" title="var">n</span></span>, starting at index <span class="inlinecode"><span class="id" title="var">i</span></span> of the array <span class="inlinecode"><span class="id" title="var">p</span></span>. This range is described in
    the precondition by a list <span class="inlinecode"><span class="id" title="var">L</span></span>, and in the postcondition by a list <span class="inlinecode"><span class="id" title="var">L'</span></span>.
    This list <span class="inlinecode"><span class="id" title="var">L'</span></span> decomposes as <span class="inlinecode"><span class="id" title="var">L<sub>1</sub></span></span> <span class="inlinecode">++</span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">::</span> <span class="inlinecode"><span class="id" title="var">L<sub>2</sub></span></span>, where <span class="inlinecode"><span class="id" title="var">x</span></span> denotes the pivot
    value. 
<div class="paragraph"> </div>

 In the full correctness proof, we will further assert that <span class="inlinecode"><span class="id" title="var">L<sub>1</sub></span></span> contains
    only values smaller than <span class="inlinecode"><span class="id" title="var">x</span></span> and <span class="inlinecode"><span class="id" title="var">L<sub>2</sub></span></span> only values at least as large as <span class="inlinecode"><span class="id" title="var">x</span></span>,
    but for establishing safety these assertions are not needed. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="QuickSort.val_pivot" class="idref" href="#QuickSort.val_pivot"><span class="id" title="axiom">val_pivot</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Parameter</span> <a id="QuickSort.triple_pivot_safety" class="idref" href="#QuickSort.triple_pivot_safety"><span class="id" title="axiom">triple_pivot_safety</span></a> : <span class="id" title="keyword">∀</span> <a id="p:116" class="idref" href="#p:116"><span class="id" title="binder">p</span></a> <a id="i:117" class="idref" href="#i:117"><span class="id" title="binder">i</span></a> <a id="n:118" class="idref" href="#n:118"><span class="id" title="binder">n</span></a> <a id="L:119" class="idref" href="#L:119"><span class="id" title="binder">L</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#n:118"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:119"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#n:118"><span class="id" title="variable">n</span></a> <span class="id" title="notation">≥</span> 1 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#QuickSort.val_pivot"><span class="id" title="axiom">val_pivot</span></a> <a class="idref" href="Arrays.html#p:116"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:117"><span class="id" title="variable">i</span></a> <a class="idref" href="Arrays.html#n:118"><span class="id" title="variable">n</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L:119"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:116"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:117"><span class="id" title="variable">i</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:120" class="idref" href="#r:120"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">(</span></a><a id="j:121" class="idref" href="#j:121"><span class="id" title="binder">j</span></a>:<span class="id" title="notation">int</span><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">),</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Arrays.html#r:120"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Arrays.html#j:121"><span class="id" title="variable">j</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">(</span></a><a id="x:122" class="idref" href="#x:122"><span class="id" title="binder">x</span></a>:<span class="id" title="notation">int</span>) (<a id="L':123" class="idref" href="#L':123"><span class="id" title="binder">L'</span></a> <a id="L<sub>1</sub>:124" class="idref" href="#L<sub>1</sub>:124"><span class="id" title="binder">L<sub>1</sub></span></a> <a id="L<sub>2</sub>:125" class="idref" href="#L<sub>2</sub>:125"><span class="id" title="binder">L<sub>2</sub></span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">),</span></a> <a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L':123"><span class="id" title="variable">L'</span></a> <a class="idref" href="Arrays.html#p:116"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:117"><span class="id" title="variable">i</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L':123"><span class="id" title="variable">L'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:119"><span class="id" title="variable">L</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Arrays.html#L':123"><span class="id" title="variable">L'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#L<sub>1</sub>:124"><span class="id" title="variable">L<sub>1</sub></span></a> <span class="id" title="notation">++</span> <a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Arrays.html#x:122"><span class="id" title="variable">x</span></a> <span class="id" title="notation">::</span> <a class="idref" href="Arrays.html#L<sub>2</sub>:125"><span class="id" title="variable">L<sub>2</sub></span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Arrays.html#j:121"><span class="id" title="variable">j</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#::Z_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="Arrays.html#i:117"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L<sub>1</sub>:124"><span class="id" title="variable">L<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>).<br/>
</div>

<div class="doc">
Now, the recursive function <span class="inlinecode"><span class="id" title="var">quicksort</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> sorts an segment of length
    <span class="inlinecode"><span class="id" title="var">n</span></span>, starting at index <span class="inlinecode"><span class="id" title="var">i</span></span>, in the array <span class="inlinecode"><span class="id" title="var">p</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="QuickSort.val_quicksort" class="idref" href="#QuickSort.val_quicksort"><span class="id" title="definition">val_quicksort</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#06de39bf13088f4f90583983ce65e722"><span class="id" title="notation">fix</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">i</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#06de39bf13088f4f90583983ce65e722"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:x_'&gt;'_x"><span class="id" title="notation">&gt;</span></a> 1 <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'end'"><span class="id" title="notation">if</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'end'"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">j</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#QuickSort.val_pivot"><span class="id" title="axiom">val_pivot</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">i</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n<sub>1</sub>'"><span class="id" title="notation">n<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">j</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">i</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">i</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n<sub>1</sub>'"><span class="id" title="notation">n<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i<sub>2</sub>'"><span class="id" title="notation">i<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">j</span></a> <a class="idref" href="LibSepReference.html#590da34eb63eef1c68773c655749c128"><span class="id" title="notation">+</span></a> 1 <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n<sub>3</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n<sub>3</sub>'"><span class="id" title="notation">n<sub>3</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n<sub>1</sub>'"><span class="id" title="notation">n<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n<sub>2</sub>'"><span class="id" title="notation">n<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n<sub>3</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n<sub>3</sub>'"><span class="id" title="notation">n<sub>3</sub></span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1 <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i<sub>2</sub>'"><span class="id" title="notation">i<sub>2</sub></span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n<sub>2</sub>'"><span class="id" title="notation">n<sub>2</sub></span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'end'"><span class="id" title="notation">end</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
<a id="lab434"></a><h4 class="section">Exercise: 4 stars, standard, especially useful (triple_quicksort_safety)</h4>
 Prove that <span class="inlinecode"><span class="id" title="var">quicksort</span></span> operates on the targeted array segment without
    interfering with the other cells of the array. This property is captured by
    the specification shown below. Hint: use <span class="inlinecode"><span class="id" title="var">xapp</span></span> <span class="inlinecode"><span class="id" title="var">triple_pivot_safety</span></span> to
    reason about the call to <span class="inlinecode"><span class="id" title="var">pivot</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="QuickSort.triple_quicksort_safety" class="idref" href="#QuickSort.triple_quicksort_safety"><span class="id" title="lemma">triple_quicksort_safety</span></a> : <span class="id" title="keyword">∀</span> <a id="p:127" class="idref" href="#p:127"><span class="id" title="binder">p</span></a> <a id="i:128" class="idref" href="#i:128"><span class="id" title="binder">i</span></a> <a id="n:129" class="idref" href="#n:129"><span class="id" title="binder">n</span></a> <a id="L:130" class="idref" href="#L:130"><span class="id" title="binder">L</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#n:129"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:130"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#i:128"><span class="id" title="variable">i</span></a> <span class="id" title="notation">≥</span> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#QuickSort.val_quicksort"><span class="id" title="definition">val_quicksort</span></a> <a class="idref" href="Arrays.html#p:127"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:128"><span class="id" title="variable">i</span></a> <a class="idref" href="Arrays.html#n:129"><span class="id" title="variable">n</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L:130"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:127"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:128"><span class="id" title="variable">i</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="L':131" class="idref" href="#L':131"><span class="id" title="binder">L'</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L':131"><span class="id" title="variable">L'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:130"><span class="id" title="variable">L</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L':131"><span class="id" title="variable">L'</span></a> <a class="idref" href="Arrays.html#p:127"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:128"><span class="id" title="variable">i</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">Hn</span> <span class="id" title="var">Hi</span>. <span class="id" title="var">gen</span> <span class="id" title="var">i</span> <span class="id" title="var">L</span>. <span class="id" title="var">induction_wf</span> <span class="id" title="var">IH</span>: (<span class="id" title="definition">downto</span> 0) <span class="id" title="var">n</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab435"></a><h1 class="section">More Details</h1>

</div>

<div class="doc">
<a id="lab436"></a><h2 class="section">Formalization of Sorted Lists</h2>

</div>
<div class="code">

<span class="id" title="keyword">Section</span> <a id="QuickSort.SortedLists" class="idref" href="#QuickSort.SortedLists"><span class="id" title="section">SortedLists</span></a>.<br/>
</div>

<div class="doc">
To refine the above safety proof into a functional correctness proof, we
    first need to formalize the notations of permutation and sortedness.

<div class="paragraph"> </div>

    The predicate <span class="inlinecode"><span class="id" title="var">permut</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">L'</span></span> asserts that <span class="inlinecode"><span class="id" title="var">L'</span></span> is a permutation of <span class="inlinecode"><span class="id" title="var">L</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <a id="QuickSort.permut" class="idref" href="#QuickSort.permut"><span class="id" title="inductive">permut</span></a> (<a id="A:132" class="idref" href="#A:132"><span class="id" title="binder">A</span></a>:<span class="id" title="keyword">Type</span>) : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <span class="id" title="var">A</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <span class="id" title="var">A</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="QuickSort.permut_mid" class="idref" href="#QuickSort.permut_mid"><span class="id" title="constructor">permut_mid</span></a> : <span class="id" title="keyword">∀</span> <a id="L<sub>1</sub>:135" class="idref" href="#L<sub>1</sub>:135"><span class="id" title="binder">L<sub>1</sub></span></a> <a id="L<sub>2</sub>:136" class="idref" href="#L<sub>2</sub>:136"><span class="id" title="binder">L<sub>2</sub></span></a> <a id="L<sub>3</sub>:137" class="idref" href="#L<sub>3</sub>:137"><span class="id" title="binder">L<sub>3</sub></span></a> <a id="L<sub>4</sub>:138" class="idref" href="#L<sub>4</sub>:138"><span class="id" title="binder">L<sub>4</sub></span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#permut:133"><span class="id" title="inductive">permut</span></a> (<a class="idref" href="Arrays.html#L<sub>1</sub>:135"><span class="id" title="variable">L<sub>1</sub></span></a> <span class="id" title="notation">++</span> <a class="idref" href="Arrays.html#L<sub>2</sub>:136"><span class="id" title="variable">L<sub>2</sub></span></a> <span class="id" title="notation">++</span> <a class="idref" href="Arrays.html#L<sub>3</sub>:137"><span class="id" title="variable">L<sub>3</sub></span></a> <span class="id" title="notation">++</span> <a class="idref" href="Arrays.html#L<sub>4</sub>:138"><span class="id" title="variable">L<sub>4</sub></span></a>) (<a class="idref" href="Arrays.html#L<sub>1</sub>:135"><span class="id" title="variable">L<sub>1</sub></span></a> <span class="id" title="notation">++</span> <a class="idref" href="Arrays.html#L<sub>3</sub>:137"><span class="id" title="variable">L<sub>3</sub></span></a> <span class="id" title="notation">++</span> <a class="idref" href="Arrays.html#L<sub>2</sub>:136"><span class="id" title="variable">L<sub>2</sub></span></a> <span class="id" title="notation">++</span> <a class="idref" href="Arrays.html#L<sub>4</sub>:138"><span class="id" title="variable">L<sub>4</sub></span></a>)<br/>
&nbsp;&nbsp;| <a id="QuickSort.permut_trans" class="idref" href="#QuickSort.permut_trans"><span class="id" title="constructor">permut_trans</span></a> : <span class="id" title="keyword">∀</span> <a id="L<sub>3</sub>:139" class="idref" href="#L<sub>3</sub>:139"><span class="id" title="binder">L<sub>3</sub></span></a> <a id="L<sub>1</sub>:140" class="idref" href="#L<sub>1</sub>:140"><span class="id" title="binder">L<sub>1</sub></span></a> <a id="L<sub>2</sub>:141" class="idref" href="#L<sub>2</sub>:141"><span class="id" title="binder">L<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#permut:133"><span class="id" title="inductive">permut</span></a> <a class="idref" href="Arrays.html#L<sub>1</sub>:140"><span class="id" title="variable">L<sub>1</sub></span></a> <a class="idref" href="Arrays.html#L<sub>2</sub>:141"><span class="id" title="variable">L<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#permut:133"><span class="id" title="inductive">permut</span></a> <a class="idref" href="Arrays.html#L<sub>2</sub>:141"><span class="id" title="variable">L<sub>2</sub></span></a> <a class="idref" href="Arrays.html#L<sub>3</sub>:139"><span class="id" title="variable">L<sub>3</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#permut:133"><span class="id" title="inductive">permut</span></a> <a class="idref" href="Arrays.html#L<sub>1</sub>:140"><span class="id" title="variable">L<sub>1</sub></span></a> <a class="idref" href="Arrays.html#L<sub>3</sub>:139"><span class="id" title="variable">L<sub>3</sub></span></a>.<br/>
</div>

<div class="doc">
The predicate <span class="inlinecode"><span class="id" title="var">permut</span></span> is reflexive and symmetric. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="QuickSort.permut_refl" class="idref" href="#QuickSort.permut_refl"><span class="id" title="lemma">permut_refl</span></a> : <span class="id" title="keyword">∀</span> <a id="A:142" class="idref" href="#A:142"><span class="id" title="binder">A</span></a> (<a id="L:143" class="idref" href="#L:143"><span class="id" title="binder">L</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Arrays.html#A:142"><span class="id" title="variable">A</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.permut"><span class="id" title="inductive">permut</span></a> <a class="idref" href="Arrays.html#L:143"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#L:143"><span class="id" title="variable">L</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span> <a class="idref" href="Arrays.html#QuickSort.permut_mid"><span class="id" title="constructor">permut_mid</span></a> (@<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <span class="id" title="var">A</span>) (@<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <span class="id" title="var">A</span>) (@<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <span class="id" title="var">A</span>) <span class="id" title="var">L</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="QuickSort.permut_sym" class="idref" href="#QuickSort.permut_sym"><span class="id" title="lemma">permut_sym</span></a> : <span class="id" title="keyword">∀</span> <a id="A:144" class="idref" href="#A:144"><span class="id" title="binder">A</span></a> (<a id="L<sub>1</sub>:145" class="idref" href="#L<sub>1</sub>:145"><span class="id" title="binder">L<sub>1</sub></span></a> <a id="L<sub>2</sub>:146" class="idref" href="#L<sub>2</sub>:146"><span class="id" title="binder">L<sub>2</sub></span></a>: <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Arrays.html#A:144"><span class="id" title="variable">A</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.permut"><span class="id" title="inductive">permut</span></a> <a class="idref" href="Arrays.html#L<sub>1</sub>:145"><span class="id" title="variable">L<sub>1</sub></span></a> <a class="idref" href="Arrays.html#L<sub>2</sub>:146"><span class="id" title="variable">L<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.permut"><span class="id" title="inductive">permut</span></a> <a class="idref" href="Arrays.html#L<sub>2</sub>:146"><span class="id" title="variable">L<sub>2</sub></span></a> <a class="idref" href="Arrays.html#L<sub>1</sub>:145"><span class="id" title="variable">L<sub>1</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span>* <a class="idref" href="Arrays.html#QuickSort.permut_mid"><span class="id" title="constructor">permut_mid</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span>* <a class="idref" href="Arrays.html#QuickSort.permut_trans"><span class="id" title="constructor">permut_trans</span></a> <span class="id" title="var">IHM2</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Resolve</span> <span class="id" title="var">permut_refl</span>.<br/>
</div>

<div class="doc">
If <span class="inlinecode"><span class="id" title="var">L'</span></span> is a permutation of <span class="inlinecode"><span class="id" title="var">L</span></span>, then it has the same length as <span class="inlinecode"><span class="id" title="var">L</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="QuickSort.permut_length" class="idref" href="#QuickSort.permut_length"><span class="id" title="lemma">permut_length</span></a> : <span class="id" title="keyword">∀</span> <a id="A:147" class="idref" href="#A:147"><span class="id" title="binder">A</span></a> (<a id="L:148" class="idref" href="#L:148"><span class="id" title="binder">L</span></a> <a id="L':149" class="idref" href="#L':149"><span class="id" title="binder">L'</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Arrays.html#A:147"><span class="id" title="variable">A</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.permut"><span class="id" title="inductive">permut</span></a> <a class="idref" href="Arrays.html#L:148"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#L':149"><span class="id" title="variable">L'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:148"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L':149"><span class="id" title="variable">L'</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">M</span>; <span class="id" title="var">rew_list</span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">try</span> <span class="id" title="var">math</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
If <span class="inlinecode"><span class="id" title="var">L<sub>1</sub>'</span></span> is a permutation of <span class="inlinecode"><span class="id" title="var">L<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">L<sub>2</sub>'</span></span> is a permutation of <span class="inlinecode"><span class="id" title="var">L<sub>2</sub></span></span>, then
    <span class="inlinecode"><span class="id" title="var">L<sub>1</sub>'</span></span> <span class="inlinecode">++</span> <span class="inlinecode"><span class="id" title="var">L<sub>2</sub>'</span></span> is a permutation of <span class="inlinecode"><span class="id" title="var">L<sub>1</sub></span></span> <span class="inlinecode">++</span> <span class="inlinecode"><span class="id" title="var">L<sub>2</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="QuickSort.permut_app" class="idref" href="#QuickSort.permut_app"><span class="id" title="lemma">permut_app</span></a> : <span class="id" title="keyword">∀</span> <a id="A:150" class="idref" href="#A:150"><span class="id" title="binder">A</span></a> (<a id="L<sub>1</sub>:151" class="idref" href="#L<sub>1</sub>:151"><span class="id" title="binder">L<sub>1</sub></span></a> <a id="L<sub>2</sub>:152" class="idref" href="#L<sub>2</sub>:152"><span class="id" title="binder">L<sub>2</sub></span></a> <a id="L<sub>1</sub>':153" class="idref" href="#L<sub>1</sub>':153"><span class="id" title="binder">L<sub>1</sub>'</span></a> <a id="L<sub>2</sub>':154" class="idref" href="#L<sub>2</sub>':154"><span class="id" title="binder">L<sub>2</sub>'</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Arrays.html#A:150"><span class="id" title="variable">A</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.permut"><span class="id" title="inductive">permut</span></a> <a class="idref" href="Arrays.html#L<sub>1</sub>:151"><span class="id" title="variable">L<sub>1</sub></span></a> <a class="idref" href="Arrays.html#L<sub>1</sub>':153"><span class="id" title="variable">L<sub>1</sub>'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.permut"><span class="id" title="inductive">permut</span></a> <a class="idref" href="Arrays.html#L<sub>2</sub>:152"><span class="id" title="variable">L<sub>2</sub></span></a> <a class="idref" href="Arrays.html#L<sub>2</sub>':154"><span class="id" title="variable">L<sub>2</sub>'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.permut"><span class="id" title="inductive">permut</span></a> (<a class="idref" href="Arrays.html#L<sub>1</sub>:151"><span class="id" title="variable">L<sub>1</sub></span></a> <span class="id" title="notation">++</span> <a class="idref" href="Arrays.html#L<sub>2</sub>:152"><span class="id" title="variable">L<sub>2</sub></span></a>) (<a class="idref" href="Arrays.html#L<sub>1</sub>':153"><span class="id" title="variable">L<sub>1</sub>'</span></a> <span class="id" title="notation">++</span> <a class="idref" href="Arrays.html#L<sub>2</sub>':154"><span class="id" title="variable">L<sub>2</sub>'</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="var">applys</span> <a class="idref" href="Arrays.html#QuickSort.permut_trans"><span class="id" title="constructor">permut_trans</span></a> (<span class="id" title="var">L<sub>1</sub>'</span> <span class="id" title="notation">++</span> <span class="id" title="var">L<sub>2</sub></span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">clear</span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">M<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">rew_list</span>. <span class="id" title="var">applys</span> <a class="idref" href="Arrays.html#QuickSort.permut_mid"><span class="id" title="constructor">permut_mid</span></a>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span>* <a class="idref" href="Arrays.html#QuickSort.permut_trans"><span class="id" title="constructor">permut_trans</span></a> <span class="id" title="var">IHM1_2</span>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">clear</span> <span class="id" title="var">M<sub>1</sub></span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">M<sub>2</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="lemma">app_assoc</span> <span class="id" title="var">L<sub>1</sub>'</span>). <span class="id" title="var">applys</span> <a class="idref" href="Arrays.html#QuickSort.permut_mid"><span class="id" title="constructor">permut_mid</span></a>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span>* <a class="idref" href="Arrays.html#QuickSort.permut_trans"><span class="id" title="constructor">permut_trans</span></a> <span class="id" title="var">IHM2_2</span>. } }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Useful corollaries for <span class="inlinecode"><span class="id" title="var">cons</span></span> and <span class="inlinecode"><span class="id" title="var">last</span></span>: 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="QuickSort.permut_cons" class="idref" href="#QuickSort.permut_cons"><span class="id" title="lemma">permut_cons</span></a> : <span class="id" title="keyword">∀</span> <a id="A:155" class="idref" href="#A:155"><span class="id" title="binder">A</span></a> (<a id="x:156" class="idref" href="#x:156"><span class="id" title="binder">x</span></a>:<a class="idref" href="Arrays.html#A:155"><span class="id" title="variable">A</span></a>) <a id="L<sub>1</sub>:157" class="idref" href="#L<sub>1</sub>:157"><span class="id" title="binder">L<sub>1</sub></span></a> <a id="L<sub>1</sub>':158" class="idref" href="#L<sub>1</sub>':158"><span class="id" title="binder">L<sub>1</sub>'</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.permut"><span class="id" title="inductive">permut</span></a> <a class="idref" href="Arrays.html#L<sub>1</sub>:157"><span class="id" title="variable">L<sub>1</sub></span></a> <a class="idref" href="Arrays.html#L<sub>1</sub>':158"><span class="id" title="variable">L<sub>1</sub>'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.permut"><span class="id" title="inductive">permut</span></a> (<a class="idref" href="Arrays.html#x:156"><span class="id" title="variable">x</span></a> <span class="id" title="notation">::</span> <a class="idref" href="Arrays.html#L<sub>1</sub>:157"><span class="id" title="variable">L<sub>1</sub></span></a>) (<a class="idref" href="Arrays.html#x:156"><span class="id" title="variable">x</span></a> <span class="id" title="notation">::</span> <a class="idref" href="Arrays.html#L<sub>1</sub>':158"><span class="id" title="variable">L<sub>1</sub>'</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Arrays.html#QuickSort.permut_app"><span class="id" title="lemma">permut_app</span></a> (<span class="id" title="var">x</span><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>) <span class="id" title="var">L<sub>1</sub></span> (<span class="id" title="var">x</span><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>) <span class="id" title="var">L<sub>1</sub>'</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="QuickSort.permut_last" class="idref" href="#QuickSort.permut_last"><span class="id" title="lemma">permut_last</span></a> : <span class="id" title="keyword">∀</span> <a id="A:159" class="idref" href="#A:159"><span class="id" title="binder">A</span></a> (<a id="x:160" class="idref" href="#x:160"><span class="id" title="binder">x</span></a>:<a class="idref" href="Arrays.html#A:159"><span class="id" title="variable">A</span></a>) <a id="L<sub>1</sub>:161" class="idref" href="#L<sub>1</sub>:161"><span class="id" title="binder">L<sub>1</sub></span></a> <a id="L<sub>1</sub>':162" class="idref" href="#L<sub>1</sub>':162"><span class="id" title="binder">L<sub>1</sub>'</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.permut"><span class="id" title="inductive">permut</span></a> <a class="idref" href="Arrays.html#L<sub>1</sub>:161"><span class="id" title="variable">L<sub>1</sub></span></a> <a class="idref" href="Arrays.html#L<sub>1</sub>':162"><span class="id" title="variable">L<sub>1</sub>'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.permut"><span class="id" title="inductive">permut</span></a> (<a class="idref" href="Arrays.html#L<sub>1</sub>:161"><span class="id" title="variable">L<sub>1</sub></span></a> <span class="id" title="notation">&amp;</span> <a class="idref" href="Arrays.html#x:160"><span class="id" title="variable">x</span></a>) (<a class="idref" href="Arrays.html#L<sub>1</sub>':162"><span class="id" title="variable">L<sub>1</sub>'</span></a> <span class="id" title="notation">&amp;</span> <a class="idref" href="Arrays.html#x:160"><span class="id" title="variable">x</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Arrays.html#QuickSort.permut_app"><span class="id" title="lemma">permut_app</span></a> <span class="id" title="var">L<sub>1</sub></span> (<span class="id" title="var">x</span><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>) <span class="id" title="var">L<sub>1</sub>'</span> (<span class="id" title="var">x</span><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>). <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Swapping of consecutive elements or moving the first element to the last
    position yield valid permutations. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="QuickSort.permut_swap_first_two" class="idref" href="#QuickSort.permut_swap_first_two"><span class="id" title="lemma">permut_swap_first_two</span></a> : <span class="id" title="keyword">∀</span> <a id="A:163" class="idref" href="#A:163"><span class="id" title="binder">A</span></a> (<a id="x:164" class="idref" href="#x:164"><span class="id" title="binder">x</span></a> <a id="y:165" class="idref" href="#y:165"><span class="id" title="binder">y</span></a> : <a class="idref" href="Arrays.html#A:163"><span class="id" title="variable">A</span></a>) (<a id="L:166" class="idref" href="#L:166"><span class="id" title="binder">L</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Arrays.html#A:163"><span class="id" title="variable">A</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.permut"><span class="id" title="inductive">permut</span></a> (<a class="idref" href="Arrays.html#x:164"><span class="id" title="variable">x</span></a> <span class="id" title="notation">::</span> <a class="idref" href="Arrays.html#y:165"><span class="id" title="variable">y</span></a> <span class="id" title="notation">::</span> <a class="idref" href="Arrays.html#L:166"><span class="id" title="variable">L</span></a>) (<a class="idref" href="Arrays.html#y:165"><span class="id" title="variable">y</span></a> <span class="id" title="notation">::</span> <a class="idref" href="Arrays.html#x:164"><span class="id" title="variable">x</span></a> <span class="id" title="notation">::</span> <a class="idref" href="Arrays.html#L:166"><span class="id" title="variable">L</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span> <a class="idref" href="Arrays.html#QuickSort.permut_mid"><span class="id" title="constructor">permut_mid</span></a> (@<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <span class="id" title="var">A</span>) (<span class="id" title="var">x</span><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>) (<span class="id" title="var">y</span><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>) <span class="id" title="var">L</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="QuickSort.permut_swap_first_last" class="idref" href="#QuickSort.permut_swap_first_last"><span class="id" title="lemma">permut_swap_first_last</span></a> : <span class="id" title="keyword">∀</span> <a id="A:167" class="idref" href="#A:167"><span class="id" title="binder">A</span></a> (<a id="x:168" class="idref" href="#x:168"><span class="id" title="binder">x</span></a> : <a class="idref" href="Arrays.html#A:167"><span class="id" title="variable">A</span></a>) (<a id="L:169" class="idref" href="#L:169"><span class="id" title="binder">L</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Arrays.html#A:167"><span class="id" title="variable">A</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.permut"><span class="id" title="inductive">permut</span></a> (<a class="idref" href="Arrays.html#x:168"><span class="id" title="variable">x</span></a><span class="id" title="notation">::</span><a class="idref" href="Arrays.html#L:169"><span class="id" title="variable">L</span></a>) (<a class="idref" href="Arrays.html#L:169"><span class="id" title="variable">L</span></a><span class="id" title="notation">&amp;</span><a class="idref" href="Arrays.html#x:168"><span class="id" title="variable">x</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">applys_eq</span> (<span class="id" title="notation">&gt;&gt;</span> <a class="idref" href="Arrays.html#QuickSort.permut_mid"><span class="id" title="constructor">permut_mid</span></a> <span class="id" title="notation">(</span>@<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <span class="id" title="var">A</span><span class="id" title="notation">)</span> <span class="id" title="notation">(</span><span class="id" title="var">x</span><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a><span class="id" title="notation">)</span> <span class="id" title="var">L</span> <span class="id" title="notation">(</span>@<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <span class="id" title="var">A</span><span class="id" title="notation">)</span>). <span class="id" title="var">rew_list</span>*.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
If a property <span class="inlinecode"><span class="id" title="var">P</span></span> holds for all elements of a list <span class="inlinecode"><span class="id" title="var">L</span></span>, it also holds for
    all the elements of any permutation of <span class="inlinecode"><span class="id" title="var">L</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="QuickSort.permut_Forall" class="idref" href="#QuickSort.permut_Forall"><span class="id" title="lemma">permut_Forall</span></a> : <span class="id" title="keyword">∀</span> <a id="A:170" class="idref" href="#A:170"><span class="id" title="binder">A</span></a> (<a id="P:171" class="idref" href="#P:171"><span class="id" title="binder">P</span></a>:<a class="idref" href="Arrays.html#A:170"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><span class="id" title="keyword">Prop</span>) <a id="L:172" class="idref" href="#L:172"><span class="id" title="binder">L</span></a> <a id="L':173" class="idref" href="#L':173"><span class="id" title="binder">L'</span></a>,<br/>
&nbsp;&nbsp;<span class="id" title="inductive">Forall</span> <a class="idref" href="Arrays.html#P:171"><span class="id" title="variable">P</span></a> <a class="idref" href="Arrays.html#L:172"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.permut"><span class="id" title="inductive">permut</span></a> <a class="idref" href="Arrays.html#L:172"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#L':173"><span class="id" title="variable">L'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="inductive">Forall</span> <a class="idref" href="Arrays.html#P:171"><span class="id" title="variable">P</span></a> <a class="idref" href="Arrays.html#L':173"><span class="id" title="variable">L'</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">N</span> <span class="id" title="var">M</span>. <span class="id" title="var">gen</span> <span class="id" title="var">N</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">M</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">Forall_app_eq</span> <span class="id" title="keyword">in</span> *. <span class="id" title="var">autos</span>*. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The predicate <span class="inlinecode"><span class="id" title="var">sorted</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> asserts that <span class="inlinecode"><span class="id" title="var">L</span></span> is a sorted list of integers. 
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <a id="QuickSort.sorted" class="idref" href="#QuickSort.sorted"><span class="id" title="inductive">sorted</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <span class="id" title="notation">int</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="QuickSort.sorted_nil" class="idref" href="#QuickSort.sorted_nil"><span class="id" title="constructor">sorted_nil</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#sorted:174"><span class="id" title="inductive">sorted</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a><br/>
&nbsp;&nbsp;| <a id="QuickSort.sorted_one" class="idref" href="#QuickSort.sorted_one"><span class="id" title="constructor">sorted_one</span></a> : <span class="id" title="keyword">∀</span> <a id="x:176" class="idref" href="#x:176"><span class="id" title="binder">x</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#sorted:174"><span class="id" title="inductive">sorted</span></a> (<a class="idref" href="Arrays.html#x:176"><span class="id" title="variable">x</span></a> <span class="id" title="notation">::</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>)<br/>
&nbsp;&nbsp;| <a id="QuickSort.sorted_cons" class="idref" href="#QuickSort.sorted_cons"><span class="id" title="constructor">sorted_cons</span></a> : <span class="id" title="keyword">∀</span> <a id="x:177" class="idref" href="#x:177"><span class="id" title="binder">x</span></a> <a id="y:178" class="idref" href="#y:178"><span class="id" title="binder">y</span></a> <a id="L:179" class="idref" href="#L:179"><span class="id" title="binder">L</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#x:177"><span class="id" title="variable">x</span></a> <span class="id" title="notation">≤</span> <a class="idref" href="Arrays.html#y:178"><span class="id" title="variable">y</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#sorted:174"><span class="id" title="inductive">sorted</span></a> (<a class="idref" href="Arrays.html#y:178"><span class="id" title="variable">y</span></a> <span class="id" title="notation">::</span> <a class="idref" href="Arrays.html#L:179"><span class="id" title="variable">L</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#sorted:174"><span class="id" title="inductive">sorted</span></a> (<a class="idref" href="Arrays.html#x:177"><span class="id" title="variable">x</span></a> <span class="id" title="notation">::</span> <a class="idref" href="Arrays.html#y:178"><span class="id" title="variable">y</span></a> <span class="id" title="notation">::</span> <a class="idref" href="Arrays.html#L:179"><span class="id" title="variable">L</span></a>).<br/>
</div>

<div class="doc">
The proposition <span class="inlinecode"><span class="id" title="var">list_of_gt</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> asserts that all elements in <span class="inlinecode"><span class="id" title="var">L</span></span> are
    greater than <span class="inlinecode"><span class="id" title="var">x</span></span>. Symmetrically, the proposition <span class="inlinecode"><span class="id" title="var">list_of_le</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> asserts
    that all elements in <span class="inlinecode"><span class="id" title="var">L</span></span> is no greater than <span class="inlinecode"><span class="id" title="var">x</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="QuickSort.list_of_gt" class="idref" href="#QuickSort.list_of_gt"><span class="id" title="definition">list_of_gt</span></a> (<a id="x:180" class="idref" href="#x:180"><span class="id" title="binder">x</span></a>:<span class="id" title="notation">int</span>) (<a id="L:181" class="idref" href="#L:181"><span class="id" title="binder">L</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <span class="id" title="notation">int</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="inductive">Forall</span> (<span class="id" title="keyword">fun</span> <a id="y:182" class="idref" href="#y:182"><span class="id" title="binder">y</span></a> ⇒ <a class="idref" href="Arrays.html#y:182"><span class="id" title="variable">y</span></a> <span class="id" title="notation">&gt;</span> <a class="idref" href="Arrays.html#x:180"><span class="id" title="variable">x</span></a>) <a class="idref" href="Arrays.html#L:181"><span class="id" title="variable">L</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="QuickSort.list_of_le" class="idref" href="#QuickSort.list_of_le"><span class="id" title="definition">list_of_le</span></a> (<a id="x:183" class="idref" href="#x:183"><span class="id" title="binder">x</span></a>:<span class="id" title="notation">int</span>) (<a id="L:184" class="idref" href="#L:184"><span class="id" title="binder">L</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <span class="id" title="notation">int</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="inductive">Forall</span> (<span class="id" title="keyword">fun</span> <a id="y:185" class="idref" href="#y:185"><span class="id" title="binder">y</span></a> ⇒ <a class="idref" href="Arrays.html#y:185"><span class="id" title="variable">y</span></a> <span class="id" title="notation">≤</span> <a class="idref" href="Arrays.html#x:183"><span class="id" title="variable">x</span></a>) <a class="idref" href="Arrays.html#L:184"><span class="id" title="variable">L</span></a>.<br/>
</div>

<div class="doc">
Two key lemmas for verifying sorting algorithms are stated below.

<div class="paragraph"> </div>

    First, if <span class="inlinecode"><span class="id" title="var">L</span></span> is sorted, then adding an element <span class="inlinecode"><span class="id" title="var">x</span></span> no greater than elements
    in <span class="inlinecode"><span class="id" title="var">L</span></span> to the front of <span class="inlinecode"><span class="id" title="var">L</span></span> yields a sorted list. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="QuickSort.sorted_cons_gt" class="idref" href="#QuickSort.sorted_cons_gt"><span class="id" title="lemma">sorted_cons_gt</span></a> : <span class="id" title="keyword">∀</span> <a id="x:186" class="idref" href="#x:186"><span class="id" title="binder">x</span></a> <a id="L:187" class="idref" href="#L:187"><span class="id" title="binder">L</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.list_of_gt"><span class="id" title="definition">list_of_gt</span></a> <a class="idref" href="Arrays.html#x:186"><span class="id" title="variable">x</span></a> <a class="idref" href="Arrays.html#L:187"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.sorted"><span class="id" title="inductive">sorted</span></a> <a class="idref" href="Arrays.html#L:187"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.sorted"><span class="id" title="inductive">sorted</span></a> (<a class="idref" href="Arrays.html#x:186"><span class="id" title="variable">x</span></a> <span class="id" title="notation">::</span> <a class="idref" href="Arrays.html#L:187"><span class="id" title="variable">L</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">N</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">L</span> <span class="id" title="keyword">as</span> [|].<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Arrays.html#QuickSort.sorted_one"><span class="id" title="constructor">sorted_one</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">lets</span> (<span class="id" title="var">Hv</span>&amp;<span class="id" title="var">_</span>): <span class="id" title="lemma">Forall_cons_inv</span> <span class="id" title="var">N</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Arrays.html#QuickSort.sorted_cons"><span class="id" title="constructor">sorted_cons</span></a>. <span class="id" title="var">math</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Second, if <span class="inlinecode"><span class="id" title="var">L<sub>1</sub></span></span> is a sorted list, <span class="inlinecode"><span class="id" title="var">x</span></span> is no less than the elements in <span class="inlinecode"><span class="id" title="var">L<sub>1</sub></span></span>,
    and <span class="inlinecode"><span class="id" title="var">x</span>::<span class="id" title="var">L<sub>2</sub></span></span> is a sorted list, then <span class="inlinecode"><span class="id" title="var">L<sub>1</sub></span></span> <span class="inlinecode">++</span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">::</span> <span class="inlinecode"><span class="id" title="var">L<sub>2</sub></span></span> is sorted. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="QuickSort.sorted_app_le" class="idref" href="#QuickSort.sorted_app_le"><span class="id" title="lemma">sorted_app_le</span></a> : <span class="id" title="keyword">∀</span> <a id="x:188" class="idref" href="#x:188"><span class="id" title="binder">x</span></a> <a id="L<sub>1</sub>:189" class="idref" href="#L<sub>1</sub>:189"><span class="id" title="binder">L<sub>1</sub></span></a> <a id="L<sub>2</sub>:190" class="idref" href="#L<sub>2</sub>:190"><span class="id" title="binder">L<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.list_of_le"><span class="id" title="definition">list_of_le</span></a> <a class="idref" href="Arrays.html#x:188"><span class="id" title="variable">x</span></a> <a class="idref" href="Arrays.html#L<sub>1</sub>:189"><span class="id" title="variable">L<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.sorted"><span class="id" title="inductive">sorted</span></a> <a class="idref" href="Arrays.html#L<sub>1</sub>:189"><span class="id" title="variable">L<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.sorted"><span class="id" title="inductive">sorted</span></a> (<a class="idref" href="Arrays.html#x:188"><span class="id" title="variable">x</span></a> <span class="id" title="notation">::</span> <a class="idref" href="Arrays.html#L<sub>2</sub>:190"><span class="id" title="variable">L<sub>2</sub></span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.sorted"><span class="id" title="inductive">sorted</span></a> (<a class="idref" href="Arrays.html#L<sub>1</sub>:189"><span class="id" title="variable">L<sub>1</sub></span></a> <span class="id" title="notation">++</span> <a class="idref" href="Arrays.html#x:188"><span class="id" title="variable">x</span></a> <span class="id" title="notation">::</span> <a class="idref" href="Arrays.html#L<sub>2</sub>:190"><span class="id" title="variable">L<sub>2</sub></span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">N</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">M<sub>1</sub></span>; <span class="id" title="var">rew_list</span> <span class="id" title="keyword">in</span> *. { <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">lets</span> (<span class="id" title="var">Hv</span>&amp;<span class="id" title="var">_</span>): <span class="id" title="lemma">Forall_cons_inv</span> <span class="id" title="var">N</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Arrays.html#QuickSort.sorted_cons"><span class="id" title="constructor">sorted_cons</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">lets</span> (<span class="id" title="var">_</span>&amp;<span class="id" title="var">N'</span>): <span class="id" title="lemma">Forall_cons_inv</span> <span class="id" title="var">N</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Arrays.html#QuickSort.sorted_cons"><span class="id" title="constructor">sorted_cons</span></a>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="Arrays.html#QuickSort.SortedLists"><span class="id" title="section">SortedLists</span></a>.<br/>
</div>

<div class="doc">
<a id="lab437"></a><h2 class="section">Formalization of Arrays of Integer Values</h2>

<div class="paragraph"> </div>

 To specify <span class="inlinecode"><span class="id" title="var">quicksort</span></span> and other functions manipulating lists of integers,
    it is useful to introduce a conversion function <span class="inlinecode"><span class="id" title="var">vals_int</span></span>, which converts a
    list of integers (type <span class="inlinecode"><span class="id" title="var">list</span></span> <span class="inlinecode"><span class="id" title="var">int</span></span>) into a list of values (type <span class="inlinecode"><span class="id" title="var">list</span></span> <span class="inlinecode"><span class="id" title="var">val</span></span>).

<div class="paragraph"> </div>

    In particular, <span class="inlinecode"><span class="id" title="var">hseg</span></span> <span class="inlinecode">(<span class="id" title="var">vals_int</span></span> <span class="inlinecode"><span class="id" title="var">L</span>)</span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> describes an array segment containing
    integer values. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="QuickSort.vals_int" class="idref" href="#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a> (<a id="L:191" class="idref" href="#L:191"><span class="id" title="binder">L</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <span class="id" title="notation">int</span>) : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="definition">LibList.map</span> <a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Arrays.html#L:191"><span class="id" title="variable">L</span></a>.<br/>
</div>

<div class="doc">
To ease the reasoning about <span class="inlinecode"><span class="id" title="var">vals_int</span></span>, we add the rewriting rules, stated
    below, to the tactics <span class="inlinecode"><span class="id" title="var">rew_list</span></span> and <span class="inlinecode"><span class="id" title="var">rew_listx</span></span>. These tactics perform
    normalization by means of Coq's <span class="inlinecode"><span class="id" title="tactic">autorewrite</span></span> tactic. In an ideal world, we
    would use a single tactic <span class="inlinecode"><span class="id" title="var">rew_list</span></span> to handle all rewriting rules related
    to lists. Unfortunately, <span class="inlinecode"><span class="id" title="tactic">autorewrite</span></span> is undesirably slow when handling a
    large the data base of rewriting rules. The TLC library therefore relies on
    a 2-layer design: the tactic <span class="inlinecode"><span class="id" title="var">rew_list</span></span> covers only the most frequently used
    rewriting rules, whereas the tactic <span class="inlinecode"><span class="id" title="var">rew_listx</span></span> is slower but covers all
    rewriting rules. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="QuickSort.vals_int_nil" class="idref" href="#QuickSort.vals_int_nil"><span class="id" title="lemma">vals_int_nil</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a>. <span class="id" title="var">rew_listx</span>*. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="QuickSort.vals_int_cons" class="idref" href="#QuickSort.vals_int_cons"><span class="id" title="lemma">vals_int_cons</span></a> : <span class="id" title="keyword">∀</span> <a id="x:192" class="idref" href="#x:192"><span class="id" title="binder">x</span></a> <a id="L:193" class="idref" href="#L:193"><span class="id" title="binder">L</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a> (<a class="idref" href="Arrays.html#x:192"><span class="id" title="variable">x</span></a> <span class="id" title="notation">::</span> <a class="idref" href="Arrays.html#L:193"><span class="id" title="variable">L</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Arrays.html#x:192"><span class="id" title="variable">x</span></a> <span class="id" title="notation">::</span> <a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a> <a class="idref" href="Arrays.html#L:193"><span class="id" title="variable">L</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a>. <span class="id" title="var">rew_listx</span>*. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="QuickSort.vals_int_app" class="idref" href="#QuickSort.vals_int_app"><span class="id" title="lemma">vals_int_app</span></a> : <span class="id" title="keyword">∀</span> <a id="L<sub>1</sub>:194" class="idref" href="#L<sub>1</sub>:194"><span class="id" title="binder">L<sub>1</sub></span></a> <a id="L<sub>2</sub>:195" class="idref" href="#L<sub>2</sub>:195"><span class="id" title="binder">L<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a> (<a class="idref" href="Arrays.html#L<sub>1</sub>:194"><span class="id" title="variable">L<sub>1</sub></span></a> <span class="id" title="notation">++</span> <a class="idref" href="Arrays.html#L<sub>2</sub>:195"><span class="id" title="variable">L<sub>2</sub></span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a> <a class="idref" href="Arrays.html#L<sub>1</sub>:194"><span class="id" title="variable">L<sub>1</sub></span></a> <span class="id" title="notation">++</span> <a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a> <a class="idref" href="Arrays.html#L<sub>2</sub>:195"><span class="id" title="variable">L<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a>. <span class="id" title="var">rew_listx</span>*. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="QuickSort.vals_int_last" class="idref" href="#QuickSort.vals_int_last"><span class="id" title="lemma">vals_int_last</span></a> : <span class="id" title="keyword">∀</span> <a id="x:196" class="idref" href="#x:196"><span class="id" title="binder">x</span></a> <a id="L:197" class="idref" href="#L:197"><span class="id" title="binder">L</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a> (<a class="idref" href="Arrays.html#L:197"><span class="id" title="variable">L</span></a> <span class="id" title="notation">&amp;</span> <a class="idref" href="Arrays.html#x:196"><span class="id" title="variable">x</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a> <a class="idref" href="Arrays.html#L:197"><span class="id" title="variable">L</span></a> <span class="id" title="notation">&amp;</span> <a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Arrays.html#x:196"><span class="id" title="variable">x</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a>. <span class="id" title="var">rew_listx</span>*. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="QuickSort.length_vals_int" class="idref" href="#QuickSort.length_vals_int"><span class="id" title="lemma">length_vals_int</span></a> : <span class="id" title="keyword">∀</span> <a id="L:198" class="idref" href="#L:198"><span class="id" title="binder">L</span></a>,<br/>
&nbsp;&nbsp;<span class="id" title="definition">length</span> (<a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a> <a class="idref" href="Arrays.html#L:198"><span class="id" title="variable">L</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:198"><span class="id" title="variable">L</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a>. <span class="id" title="var">rew_listx</span>*. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
#[<span class="id" title="var">export</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Rewrite</span> <a class="idref" href="Arrays.html#QuickSort.vals_int_nil"><span class="id" title="lemma">vals_int_nil</span></a> <a class="idref" href="Arrays.html#QuickSort.vals_int_cons"><span class="id" title="lemma">vals_int_cons</span></a> <a class="idref" href="Arrays.html#QuickSort.vals_int_app"><span class="id" title="lemma">vals_int_app</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.vals_int_last"><span class="id" title="lemma">vals_int_last</span></a> <a class="idref" href="Arrays.html#QuickSort.length_vals_int"><span class="id" title="lemma">length_vals_int</span></a> : <span class="id" title="var">rew_list</span>.<br/>
#[<span class="id" title="var">export</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Rewrite</span> <a class="idref" href="Arrays.html#QuickSort.vals_int_nil"><span class="id" title="lemma">vals_int_nil</span></a> <a class="idref" href="Arrays.html#QuickSort.vals_int_cons"><span class="id" title="lemma">vals_int_cons</span></a> <a class="idref" href="Arrays.html#QuickSort.vals_int_app"><span class="id" title="lemma">vals_int_app</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.vals_int_last"><span class="id" title="lemma">vals_int_last</span></a> <a class="idref" href="Arrays.html#QuickSort.length_vals_int"><span class="id" title="lemma">length_vals_int</span></a> : <span class="id" title="var">rew_listx</span>.<br/>
</div>

<div class="doc">
<a id="lab438"></a><h2 class="section">Functional Correctness of Quicksort</h2>

<div class="paragraph"> </div>

 In order to verify <span class="inlinecode"><span class="id" title="var">quicksort</span></span>, we need to refine the specification of the
    <span class="inlinecode"><span class="id" title="var">pivot</span></span> function to include functional correctness properties.

<div class="paragraph"> </div>

    The postcondition of the pivot operation describes the elements in the
    segment as the list <span class="inlinecode"><span class="id" title="var">L'</span></span>. This list decomposes as <span class="inlinecode"><span class="id" title="var">L<sub>1</sub></span></span> <span class="inlinecode">++</span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">::</span> <span class="inlinecode"><span class="id" title="var">L<sub>2</sub></span></span>, where <span class="inlinecode"><span class="id" title="var">x</span></span>
    corresponds to the pivot. This time, the assertions <span class="inlinecode"><span class="id" title="var">list_of_le</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">L<sub>1</sub></span></span> and
    <span class="inlinecode"><span class="id" title="var">list_of_gt</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">L<sub>2</sub></span></span> are included. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="QuickSort.triple_pivot" class="idref" href="#QuickSort.triple_pivot"><span class="id" title="axiom">triple_pivot</span></a> : <span class="id" title="keyword">∀</span> <a id="n:199" class="idref" href="#n:199"><span class="id" title="binder">n</span></a> <a id="p:200" class="idref" href="#p:200"><span class="id" title="binder">p</span></a> <a id="i:201" class="idref" href="#i:201"><span class="id" title="binder">i</span></a> <a id="L:202" class="idref" href="#L:202"><span class="id" title="binder">L</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#n:199"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:202"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#n:199"><span class="id" title="variable">n</span></a> <span class="id" title="notation">≥</span> 1 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#QuickSort.val_pivot"><span class="id" title="axiom">val_pivot</span></a> <a class="idref" href="Arrays.html#p:200"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:201"><span class="id" title="variable">i</span></a> <a class="idref" href="Arrays.html#n:199"><span class="id" title="variable">n</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> (<a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a> <a class="idref" href="Arrays.html#L:202"><span class="id" title="variable">L</span></a>) <a class="idref" href="Arrays.html#p:200"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:201"><span class="id" title="variable">i</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:203" class="idref" href="#r:203"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="j:204" class="idref" href="#j:204"><span class="id" title="binder">j</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Arrays.html#r:203"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Arrays.html#j:204"><span class="id" title="variable">j</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="x:205" class="idref" href="#x:205"><span class="id" title="binder">x</span></a> <a id="L':206" class="idref" href="#L':206"><span class="id" title="binder">L'</span></a> <a id="L<sub>1</sub>:207" class="idref" href="#L<sub>1</sub>:207"><span class="id" title="binder">L<sub>1</sub></span></a> <a id="L<sub>2</sub>:208" class="idref" href="#L<sub>2</sub>:208"><span class="id" title="binder">L<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> (<a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a> <a class="idref" href="Arrays.html#L':206"><span class="id" title="variable">L'</span></a>) <a class="idref" href="Arrays.html#p:200"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:201"><span class="id" title="variable">i</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.permut"><span class="id" title="inductive">permut</span></a> <a class="idref" href="Arrays.html#L:202"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#L':206"><span class="id" title="variable">L'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Arrays.html#L':206"><span class="id" title="variable">L'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#L<sub>1</sub>:207"><span class="id" title="variable">L<sub>1</sub></span></a> <span class="id" title="notation">++</span> <a class="idref" href="Arrays.html#x:205"><span class="id" title="variable">x</span></a> <span class="id" title="notation">::</span> <a class="idref" href="Arrays.html#L<sub>2</sub>:208"><span class="id" title="variable">L<sub>2</sub></span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Arrays.html#j:204"><span class="id" title="variable">j</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#::Z_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="Arrays.html#i:201"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L<sub>1</sub>:207"><span class="id" title="variable">L<sub>1</sub></span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Arrays.html#QuickSort.list_of_le"><span class="id" title="definition">list_of_le</span></a> <a class="idref" href="Arrays.html#x:205"><span class="id" title="variable">x</span></a> <a class="idref" href="Arrays.html#L<sub>1</sub>:207"><span class="id" title="variable">L<sub>1</sub></span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Arrays.html#QuickSort.list_of_gt"><span class="id" title="definition">list_of_gt</span></a> <a class="idref" href="Arrays.html#x:205"><span class="id" title="variable">x</span></a> <a class="idref" href="Arrays.html#L<sub>2</sub>:208"><span class="id" title="variable">L<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>).<br/>
</div>

<div class="doc">
<a id="lab439"></a><h4 class="section">Exercise: 5 stars, standard, optional (triple_quicksort)</h4>
 Prove that <span class="inlinecode"><span class="id" title="var">quicksort</span></span> sorts the array segment targeted by its arguments.
    Hint: use <span class="inlinecode"><span class="id" title="var">xapp</span></span> <span class="inlinecode"><span class="id" title="var">triple_pivot</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="QuickSort.triple_quicksort" class="idref" href="#QuickSort.triple_quicksort"><span class="id" title="lemma">triple_quicksort</span></a> : <span class="id" title="keyword">∀</span> <a id="p:210" class="idref" href="#p:210"><span class="id" title="binder">p</span></a> <a id="i:211" class="idref" href="#i:211"><span class="id" title="binder">i</span></a> <a id="n:212" class="idref" href="#n:212"><span class="id" title="binder">n</span></a> <a id="L:213" class="idref" href="#L:213"><span class="id" title="binder">L</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#n:212"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:213"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#i:211"><span class="id" title="variable">i</span></a> <span class="id" title="notation">≥</span> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#QuickSort.val_quicksort"><span class="id" title="definition">val_quicksort</span></a> <a class="idref" href="Arrays.html#p:210"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:211"><span class="id" title="variable">i</span></a> <a class="idref" href="Arrays.html#n:212"><span class="id" title="variable">n</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> (<a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a> <a class="idref" href="Arrays.html#L:213"><span class="id" title="variable">L</span></a>) <a class="idref" href="Arrays.html#p:210"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:211"><span class="id" title="variable">i</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="L':214" class="idref" href="#L':214"><span class="id" title="binder">L'</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Arrays.html#QuickSort.permut"><span class="id" title="inductive">permut</span></a> <a class="idref" href="Arrays.html#L:213"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#L':214"><span class="id" title="variable">L'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Arrays.html#QuickSort.sorted"><span class="id" title="inductive">sorted</span></a> <a class="idref" href="Arrays.html#L':214"><span class="id" title="variable">L'</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> (<a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a> <a class="idref" href="Arrays.html#L':214"><span class="id" title="variable">L'</span></a>) <a class="idref" href="Arrays.html#p:210"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:211"><span class="id" title="variable">i</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 The function <span class="inlinecode"><span class="id" title="var">quicksort_full</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> sorts all the elements stored in the array
    at address <span class="inlinecode"><span class="id" title="var">p</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="QuickSort.val_quicksort_full" class="idref" href="#QuickSort.val_quicksort_full"><span class="id" title="definition">val_quicksort_full</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#val_array_length"><span class="id" title="axiom">val_array_length</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.val_quicksort"><span class="id" title="definition">val_quicksort</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> 0 <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
The predicate <span class="inlinecode"><span class="id" title="var">harray</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> is defined as the conjunction of
    <span class="inlinecode"><span class="id" title="var">hheader</span></span> <span class="inlinecode">(<span class="id" title="var">length</span></span> <span class="inlinecode"><span class="id" title="var">L</span>)</span> <span class="inlinecode"><span class="id" title="var">p</span></span>, which captures the fact that the header stores the
    length of the list <span class="inlinecode"><span class="id" title="var">L</span></span>, and of <span class="inlinecode"><span class="id" title="var">hseg</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">0</span>, which describes "full" array
    segment, ranging from the first to the last cell of the array. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="QuickSort.harray_eq" class="idref" href="#QuickSort.harray_eq"><span class="id" title="axiom">harray_eq</span></a> : <span class="id" title="keyword">∀</span> <a id="p:215" class="idref" href="#p:215"><span class="id" title="binder">p</span></a> <a id="L:216" class="idref" href="#L:216"><span class="id" title="binder">L</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#harray"><span class="id" title="axiom">harray</span></a> <a class="idref" href="Arrays.html#L:216"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:215"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="n:217" class="idref" href="#n:217"><span class="id" title="binder">n</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Arrays.html#n:217"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:216"><span class="id" title="variable">L</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#hheader"><span class="id" title="axiom">hheader</span></a> <a class="idref" href="Arrays.html#n:217"><span class="id" title="variable">n</span></a> <a class="idref" href="Arrays.html#p:215"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L:216"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:215"><span class="id" title="variable">p</span></a> 0.<br/>
</div>

<div class="doc">
<a id="lab440"></a><h4 class="section">Exercise: 2 stars, standard, optional (triple_quicksort_full)</h4>
 Prove that <span class="inlinecode"><span class="id" title="var">val_quicksort_full</span></span> sorts an array. Hint: use <span class="inlinecode"><span class="id" title="var">xchange</span></span> and
    <span class="inlinecode"><span class="id" title="var">xchange</span></span> <span class="inlinecode">&lt;-</span> on <span class="inlinecode"><span class="id" title="var">harray_eq</span></span> to convert between <span class="inlinecode"><span class="id" title="var">harray</span></span> and <span class="inlinecode"><span class="id" title="var">hseg</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="QuickSort.triple_quicksort_full" class="idref" href="#QuickSort.triple_quicksort_full"><span class="id" title="lemma">triple_quicksort_full</span></a> : <span class="id" title="keyword">∀</span> <a id="p:219" class="idref" href="#p:219"><span class="id" title="binder">p</span></a> <a id="L:220" class="idref" href="#L:220"><span class="id" title="binder">L</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#QuickSort.val_quicksort_full"><span class="id" title="definition">val_quicksort_full</span></a> <a class="idref" href="Arrays.html#p:219"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Arrays.html#harray"><span class="id" title="axiom">harray</span></a> (<a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a> <a class="idref" href="Arrays.html#L:220"><span class="id" title="variable">L</span></a>) <a class="idref" href="Arrays.html#p:219"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="L':221" class="idref" href="#L':221"><span class="id" title="binder">L'</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Arrays.html#QuickSort.permut"><span class="id" title="inductive">permut</span></a> <a class="idref" href="Arrays.html#L:220"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#L':221"><span class="id" title="variable">L'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Arrays.html#QuickSort.sorted"><span class="id" title="inductive">sorted</span></a> <a class="idref" href="Arrays.html#L':221"><span class="id" title="variable">L'</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#harray"><span class="id" title="axiom">harray</span></a> (<a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a> <a class="idref" href="Arrays.html#L':221"><span class="id" title="variable">L'</span></a>) <a class="idref" href="Arrays.html#p:219"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<span class="id" title="keyword">End</span> <a class="idref" href="Arrays.html#QuickSort"><span class="id" title="module">QuickSort</span></a>.<br/>
</div>

<div class="doc">
<a id="lab441"></a><h2 class="section">Realization of <span class="inlinecode"><span class="id" title="var">hheader</span></span> and <span class="inlinecode"><span class="id" title="var">hcell</span></span></h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="Realization" class="idref" href="#Realization"><span class="id" title="module">Realization</span></a>.<br/>
</div>

<div class="doc">
So far, the predicates <span class="inlinecode"><span class="id" title="var">hheader</span></span> and <span class="inlinecode"><span class="id" title="var">hcell</span></span> were axiomatized. Let us show
    how they can be realized with respect to the concrete representation of the
    memory state, of type <span class="inlinecode"><span class="id" title="var">heap</span></span>. The predicates <span class="inlinecode"><span class="id" title="var">hseg</span></span> and <span class="inlinecode"><span class="id" title="var">harray</span></span> can then be
    defined on top of <span class="inlinecode"><span class="id" title="var">hheader</span></span> and <span class="inlinecode"><span class="id" title="var">hcell</span></span>.

<div class="paragraph"> </div>

    Following the standard memory layout of allocated blocks in ML programs, we
    represent ML-style array of size <span class="inlinecode"><span class="id" title="var">n</span></span> as a memory block of size <span class="inlinecode"><span class="id" title="var">n</span>+1</span>. The
    first cell, called the "header cell", stores the length of the array. The
    remaining cells store the elements from the array.

<div class="paragraph"> </div>

    The heap predicate <span class="inlinecode"><span class="id" title="var">hheader</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> describes a cell at location <span class="inlinecode"><span class="id" title="var">p</span></span> with
    contents <span class="inlinecode"><span class="id" title="var">n</span></span>. Recall that the definition of <span class="inlinecode"><span class="id" title="var">hheader</span></span> is opaque when
    reasoning about array-using programs, so there is no risk that the
    programmer attempts to reason about code that modifies header fields. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="Realization.hheader" class="idref" href="#Realization.hheader"><span class="id" title="definition">hheader</span></a> (<a id="n:222" class="idref" href="#n:222"><span class="id" title="binder">n</span></a>:<span class="id" title="notation">int</span>) (<a id="p:223" class="idref" href="#p:223"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#p:223"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Arrays.html#n:222"><span class="id" title="variable">n</span></a><a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">)</span></a>.<br/>
</div>

<div class="doc">
Because Coq's <span class="inlinecode"><span class="id" title="tactic">fold</span></span> operation rarely applys as the user expects, we state a
    lemma that reformulates the definition of <span class="inlinecode"><span class="id" title="var">hheader</span></span> as an equality.
    Performing a <span class="inlinecode"><span class="id" title="tactic">rewrite</span></span> using this lemma corresponds either to an <span class="inlinecode"><span class="id" title="tactic">unfold</span></span> or
    to a <span class="inlinecode"><span class="id" title="tactic">fold</span></span> operation, depending on the direction. More generally,
    reformulating a definition as an equality is strongly recommended for every
    representation predicate. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.hheader_eq" class="idref" href="#Realization.hheader_eq"><span class="id" title="lemma">hheader_eq</span></a> : <span class="id" title="keyword">∀</span> <a id="p:224" class="idref" href="#p:224"><span class="id" title="binder">p</span></a> <a id="n:225" class="idref" href="#n:225"><span class="id" title="binder">n</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="Arrays.html#Realization.hheader"><span class="id" title="definition">hheader</span></a> <a class="idref" href="Arrays.html#n:225"><span class="id" title="variable">n</span></a> <a class="idref" href="Arrays.html#p:224"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="Arrays.html#p:224"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Arrays.html#n:225"><span class="id" title="variable">n</span></a><a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The predicate <span class="inlinecode"><span class="id" title="var">hcell</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> asserts that the cell at index <span class="inlinecode"><span class="id" title="var">i</span></span> from the
    array at address <span class="inlinecode"><span class="id" title="var">p</span></span> stores the value <span class="inlinecode"><span class="id" title="var">p</span></span>. We defined this predicate
    informally by asserting that the cell in memory at address <span class="inlinecode"><span class="id" title="var">p</span>+1+<span class="id" title="var">i</span></span> stores
    the value <span class="inlinecode"><span class="id" title="var">v</span></span>. Thus, as first approximation, the predicate <span class="inlinecode"><span class="id" title="var">hcell</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span>
    could be defined as <span class="inlinecode">(<span class="id" title="var">p</span></span> <span class="inlinecode">+</span> <span class="inlinecode">1</span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">abs</span></span> <span class="inlinecode"><span class="id" title="var">i</span>)</span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">v</span></span>. The actual definition also
    embeds the assertion <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode">≥</span> <span class="inlinecode">0</span> to guarantee that <span class="inlinecode"><span class="id" title="var">i</span></span> refers to a valid index
    and <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">+</span> <span class="inlinecode">1</span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">abs</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> computes the expected offset. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="Realization.hcell" class="idref" href="#Realization.hcell"><span class="id" title="definition">hcell</span></a> (<a id="v:226" class="idref" href="#v:226"><span class="id" title="binder">v</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) (<a id="p:227" class="idref" href="#p:227"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) (<a id="i:228" class="idref" href="#i:228"><span class="id" title="binder">i</span></a>:<span class="id" title="notation">int</span>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a>(<a class="idref" href="Arrays.html#p:227"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> 1 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="notation">abs</span> <span class="id" title="notation">i</span>)%<span class="id" title="var">nat</span> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Arrays.html#v:226"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Arrays.html#i:228"><span class="id" title="variable">i</span></a> <span class="id" title="notation">≥</span> 0<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>.<br/>
</div>

<div class="doc">
The following lemma is useful for folding or unfolding the definition. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.hcell_eq" class="idref" href="#Realization.hcell_eq"><span class="id" title="lemma">hcell_eq</span></a> : <span class="id" title="keyword">∀</span> <a id="v:229" class="idref" href="#v:229"><span class="id" title="binder">v</span></a> <a id="p:230" class="idref" href="#p:230"><span class="id" title="binder">p</span></a> <a id="i:231" class="idref" href="#i:231"><span class="id" title="binder">i</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="Arrays.html#Realization.hcell"><span class="id" title="definition">hcell</span></a> <a class="idref" href="Arrays.html#v:229"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#p:230"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:231"><span class="id" title="variable">i</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a>(<a class="idref" href="Arrays.html#p:230"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> 1 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="notation">abs</span> <span class="id" title="notation">i</span>)%<span class="id" title="var">nat</span> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Arrays.html#v:229"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Arrays.html#i:231"><span class="id" title="variable">i</span></a> <span class="id" title="notation">≥</span> 0<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
This one extracts the property <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode">≥</span> <span class="inlinecode">0</span> from <span class="inlinecode"><span class="id" title="var">hcell</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> . 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.hcell_nonneg" class="idref" href="#Realization.hcell_nonneg"><span class="id" title="lemma">hcell_nonneg</span></a> : <span class="id" title="keyword">∀</span> <a id="v:232" class="idref" href="#v:232"><span class="id" title="binder">v</span></a> <a id="p:233" class="idref" href="#p:233"><span class="id" title="binder">p</span></a> <a id="i:234" class="idref" href="#i:234"><span class="id" title="binder">i</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#Realization.hcell"><span class="id" title="definition">hcell</span></a> <a class="idref" href="Arrays.html#v:232"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#p:233"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:234"><span class="id" title="variable">i</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Arrays.html#Realization.hcell"><span class="id" title="definition">hcell</span></a> <a class="idref" href="Arrays.html#v:232"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#p:233"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:234"><span class="id" title="variable">i</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Arrays.html#i:234"><span class="id" title="variable">i</span></a> <span class="id" title="notation">≥</span> 0<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Arrays.html#Realization.hcell"><span class="id" title="definition">hcell</span></a>. <span class="id" title="var">xsimpl</span>*. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab442"></a><h2 class="section">Realization of <span class="inlinecode"><span class="id" title="var">hseg</span></span> and <span class="inlinecode"><span class="id" title="var">harray</span></span></h2>

<div class="paragraph"> </div>

 The heap predicate <span class="inlinecode"><span class="id" title="var">hseg</span></span> for array segments can be defined in terms of
    <span class="inlinecode"><span class="id" title="var">hcell</span></span> as suggested earlier. 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <a id="Realization.hseg" class="idref" href="#Realization.hseg"><span class="id" title="definition">hseg</span></a> (<a id="L:235" class="idref" href="#L:235"><span class="id" title="binder">L</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) (<a id="p:236" class="idref" href="#p:236"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) (<a id="j:237" class="idref" href="#j:237"><span class="id" title="binder">j</span></a>:<span class="id" title="notation">int</span>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Arrays.html#L:235"><span class="id" title="variable">L</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> ⇒ <a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;| <span class="id" title="var">x</span><span class="id" title="notation">::</span><span class="id" title="var">L'</span> ⇒ <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Arrays.html#Realization.hcell"><span class="id" title="definition">hcell</span></a> <span class="id" title="var">x</span> <a class="idref" href="Arrays.html#p:236"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:237"><span class="id" title="variable">j</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Arrays.html#hseg:238"><span class="id" title="definition">hseg</span></a> <span class="id" title="var">L'</span> <a class="idref" href="Arrays.html#p:236"><span class="id" title="variable">p</span></a> (<a class="idref" href="Arrays.html#j:237"><span class="id" title="variable">j</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1)<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
The predicate for full arrays, <span class="inlinecode"><span class="id" title="var">harray</span></span>, can be defined as the pair of an
    <span class="inlinecode"><span class="id" title="var">hheader</span></span> predicate describing the header cell and a <span class="inlinecode"><span class="id" title="var">hseg</span></span> covering the
    full contents of the array. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="Realization.harray" class="idref" href="#Realization.harray"><span class="id" title="definition">harray</span></a> (<a id="L:240" class="idref" href="#L:240"><span class="id" title="binder">L</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) (<a id="p:241" class="idref" href="#p:241"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#Realization.hheader"><span class="id" title="definition">hheader</span></a> (<span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:240"><span class="id" title="variable">L</span></a>) <a class="idref" href="Arrays.html#p:241"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#Realization.hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L:240"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:241"><span class="id" title="variable">p</span></a> 0.<br/>
</div>

<div class="doc">
The lemma <span class="inlinecode"><span class="id" title="var">harray_eq</span></span> can be used for folding or unfolding <span class="inlinecode"><span class="id" title="var">harray</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.harray_eq" class="idref" href="#Realization.harray_eq"><span class="id" title="lemma">harray_eq</span></a> : <span class="id" title="keyword">∀</span> <a id="p:242" class="idref" href="#p:242"><span class="id" title="binder">p</span></a> <a id="L:243" class="idref" href="#L:243"><span class="id" title="binder">L</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#Realization.harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Arrays.html#L:243"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:242"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="n:244" class="idref" href="#n:244"><span class="id" title="binder">n</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Arrays.html#n:244"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:243"><span class="id" title="variable">L</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#Realization.hheader"><span class="id" title="definition">hheader</span></a> <a class="idref" href="Arrays.html#n:244"><span class="id" title="variable">n</span></a> <a class="idref" href="Arrays.html#p:242"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#Realization.hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L:243"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:242"><span class="id" title="variable">p</span></a> 0.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Arrays.html#Realization.harray"><span class="id" title="definition">harray</span></a>. <span class="id" title="var">xsimpl</span>*. { <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">subst</span>*. } <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
When proving properties about <span class="inlinecode"><span class="id" title="var">hseg</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">j</span></span>, one frequently faces a mismatch
    between <span class="inlinecode"><span class="id" title="var">hseg</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">j<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">hseg</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">j<sub>2</sub></span></span>, where <span class="inlinecode"><span class="id" title="var">j<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">j<sub>2</sub></span></span> are provably
    equal yet do not unify. To avoid cluttering proofs, the following lemma and
    associated hint are very useful. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.hseg_start_eq" class="idref" href="#Realization.hseg_start_eq"><span class="id" title="lemma">hseg_start_eq</span></a> : <span class="id" title="keyword">∀</span> <a id="L:245" class="idref" href="#L:245"><span class="id" title="binder">L</span></a> <a id="p:246" class="idref" href="#p:246"><span class="id" title="binder">p</span></a> <a id="j<sub>1</sub>:247" class="idref" href="#j<sub>1</sub>:247"><span class="id" title="binder">j<sub>1</sub></span></a> <a id="j<sub>2</sub>:248" class="idref" href="#j<sub>2</sub>:248"><span class="id" title="binder">j<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#j<sub>1</sub>:247"><span class="id" title="variable">j<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#j<sub>2</sub>:248"><span class="id" title="variable">j<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#Realization.hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L:245"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:246"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j<sub>1</sub>:247"><span class="id" title="variable">j<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Arrays.html#Realization.hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L:245"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:246"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j<sub>2</sub>:248"><span class="id" title="variable">j<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">subst</span>*. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Extern</span> 1 (<a class="idref" href="Arrays.html#Realization.hseg"><span class="id" title="definition">hseg</span></a> ?<span class="id" title="var">L</span> ?<span class="id" title="var">p</span> ?<span class="id" title="var">j<sub>1</sub></span> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Arrays.html#Realization.hseg"><span class="id" title="definition">hseg</span></a> ?<span class="id" title="var">L</span> ?<span class="id" title="var">p</span> ?<span class="id" title="var">j<sub>2</sub></span>) ⇒<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Arrays.html#Realization.hseg_start_eq"><span class="id" title="lemma">hseg_start_eq</span></a>; <span class="id" title="var">math</span>.<br/>
</div>

<div class="doc">
We now prove the lemmas <span class="inlinecode"><span class="id" title="var">hseg_nil</span></span> and <span class="inlinecode"><span class="id" title="var">hseg_one</span></span> and <span class="inlinecode"><span class="id" title="var">hseg_cons</span></span>, which we
    presented and used earlier in the chapter. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.hseg_nil" class="idref" href="#Realization.hseg_nil"><span class="id" title="lemma">hseg_nil</span></a> : <span class="id" title="keyword">∀</span> <a id="p:249" class="idref" href="#p:249"><span class="id" title="binder">p</span></a> <a id="j:250" class="idref" href="#j:250"><span class="id" title="binder">j</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#Realization.hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="Arrays.html#p:249"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:250"><span class="id" title="variable">j</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.hseg_one" class="idref" href="#Realization.hseg_one"><span class="id" title="lemma">hseg_one</span></a> : <span class="id" title="keyword">∀</span> <a id="v:251" class="idref" href="#v:251"><span class="id" title="binder">v</span></a> <a id="p:252" class="idref" href="#p:252"><span class="id" title="binder">p</span></a> <a id="j:253" class="idref" href="#j:253"><span class="id" title="binder">j</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#Realization.hseg"><span class="id" title="definition">hseg</span></a> (<a class="idref" href="Arrays.html#v:251"><span class="id" title="variable">v</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>) <a class="idref" href="Arrays.html#p:252"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:253"><span class="id" title="variable">j</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#Realization.hcell"><span class="id" title="definition">hcell</span></a> <a class="idref" href="Arrays.html#v:251"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#p:252"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:253"><span class="id" title="variable">j</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="var">xsimpl</span>*. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.hseg_cons" class="idref" href="#Realization.hseg_cons"><span class="id" title="lemma">hseg_cons</span></a> : <span class="id" title="keyword">∀</span> <a id="v:254" class="idref" href="#v:254"><span class="id" title="binder">v</span></a> <a id="p:255" class="idref" href="#p:255"><span class="id" title="binder">p</span></a> <a id="j:256" class="idref" href="#j:256"><span class="id" title="binder">j</span></a> <a id="L:257" class="idref" href="#L:257"><span class="id" title="binder">L</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#Realization.hseg"><span class="id" title="definition">hseg</span></a> (<a class="idref" href="Arrays.html#v:254"><span class="id" title="variable">v</span></a><span class="id" title="notation">::</span><a class="idref" href="Arrays.html#L:257"><span class="id" title="variable">L</span></a>) <a class="idref" href="Arrays.html#p:255"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:256"><span class="id" title="variable">j</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#Realization.hcell"><span class="id" title="definition">hcell</span></a> <a class="idref" href="Arrays.html#v:254"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#p:255"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:256"><span class="id" title="variable">j</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#Realization.hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L:257"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:255"><span class="id" title="variable">p</span></a> (<a class="idref" href="Arrays.html#j:256"><span class="id" title="variable">j</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="var">xsimpl</span>*. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab443"></a><h4 class="section">Exercise: 3 stars, standard, especially useful (hseg_app)</h4>
 Prove the splitting lemma for array segments. Hint: <span class="inlinecode"><span class="id" title="var">rew_list</span></span> is helpful
    for simplifying list operations. Recall that <span class="inlinecode"><span class="id" title="var">xsimpl</span></span> helps proving
    equalities on <span class="inlinecode"><span class="id" title="var">hprop</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.hseg_app" class="idref" href="#Realization.hseg_app"><span class="id" title="lemma">hseg_app</span></a> : <span class="id" title="keyword">∀</span> <a id="L<sub>1</sub>:258" class="idref" href="#L<sub>1</sub>:258"><span class="id" title="binder">L<sub>1</sub></span></a> <a id="L<sub>2</sub>:259" class="idref" href="#L<sub>2</sub>:259"><span class="id" title="binder">L<sub>2</sub></span></a> <a id="p:260" class="idref" href="#p:260"><span class="id" title="binder">p</span></a> <a id="j:261" class="idref" href="#j:261"><span class="id" title="binder">j</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#Realization.hseg"><span class="id" title="definition">hseg</span></a> (<a class="idref" href="Arrays.html#L<sub>1</sub>:258"><span class="id" title="variable">L<sub>1</sub></span></a> <span class="id" title="notation">++</span> <a class="idref" href="Arrays.html#L<sub>2</sub>:259"><span class="id" title="variable">L<sub>2</sub></span></a>) <a class="idref" href="Arrays.html#p:260"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:261"><span class="id" title="variable">j</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#Realization.hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L<sub>1</sub>:258"><span class="id" title="variable">L<sub>1</sub></span></a> <a class="idref" href="Arrays.html#p:260"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:261"><span class="id" title="variable">j</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#Realization.hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L<sub>2</sub>:259"><span class="id" title="variable">L<sub>2</sub></span></a> <a class="idref" href="Arrays.html#p:260"><span class="id" title="variable">p</span></a> (<a class="idref" href="Arrays.html#j:261"><span class="id" title="variable">j</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L<sub>1</sub>:258"><span class="id" title="variable">L<sub>1</sub></span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab444"></a><h2 class="section">Focus Lemmas for Array Segments</h2>

<div class="paragraph"> </div>

 With a predicate <span class="inlinecode"><span class="id" title="var">harray</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> at hand, it may be useful to isolate the cell
    at an index <span class="inlinecode"><span class="id" title="var">i</span></span>, that is, to extract the predicate <span class="inlinecode"><span class="id" title="var">hcell</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span>, where
    <span class="inlinecode">0</span> <span class="inlinecode">≤</span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode">&lt;</span> <span class="inlinecode"><span class="id" title="var">length</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> and <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">LibList.nth</span></span> <span class="inlinecode">(<span class="id" title="var">abs</span></span> <span class="inlinecode"><span class="id" title="var">i</span>)</span> <span class="inlinecode"><span class="id" title="var">L</span></span>. By "giving back" the
    predicate <span class="inlinecode"><span class="id" title="var">hcell</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span>, we can get back to the original predicate
    <span class="inlinecode"><span class="id" title="var">harray</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="Realization.harray_focus_read'" class="idref" href="#Realization.harray_focus_read'"><span class="id" title="axiom">harray_focus_read'</span></a> : <span class="id" title="keyword">∀</span> <a id="i:262" class="idref" href="#i:262"><span class="id" title="binder">i</span></a> <a id="L:263" class="idref" href="#L:263"><span class="id" title="binder">L</span></a> <a id="p:264" class="idref" href="#p:264"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;0 <span class="id" title="notation">≤</span> <a class="idref" href="Arrays.html#i:262"><span class="id" title="variable">i</span></a> <span class="id" title="notation">&lt;</span> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:263"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#Realization.harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Arrays.html#L:263"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:264"><span class="id" title="variable">p</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <span class="id" title="keyword">let</span> <a id="v:265" class="idref" href="#v:265"><span class="id" title="binder">v</span></a> := <span class="id" title="definition">LibList.nth</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">i</span>) <a class="idref" href="Arrays.html#L:263"><span class="id" title="variable">L</span></a> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Arrays.html#Realization.hcell"><span class="id" title="definition">hcell</span></a> <a class="idref" href="Arrays.html#v:265"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#p:264"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:262"><span class="id" title="variable">i</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Arrays.html#Realization.hcell"><span class="id" title="definition">hcell</span></a> <a class="idref" href="Arrays.html#v:265"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#p:264"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:262"><span class="id" title="variable">i</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Arrays.html#Realization.harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Arrays.html#L:263"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:264"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>.<br/>
</div>

<div class="doc">
The lemma above, called a "focus" lemma or "borrowing" lemma in Rust's
    terminology, only supports reading into the "focused" cell at index <span class="inlinecode"><span class="id" title="var">i</span></span>; it
    does not allow modifying the contents of the cell. Indeed, if <span class="inlinecode"><span class="id" title="var">hcell</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span>
    is updated to <span class="inlinecode"><span class="id" title="var">hcell</span></span> <span class="inlinecode"><span class="id" title="var">w</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span>, then the magic wand
    <span class="inlinecode"><span class="id" title="var">hcell</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">harray</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> can no longer be exploited.

<div class="paragraph"> </div>

    Fortunately, it is straightforward to generalize the focus lemma into a form
    that supports updates. The general focus lemma shown below makes use of a
    universal quantification over the value <span class="inlinecode"><span class="id" title="var">w</span></span> that the cell <span class="inlinecode"><span class="id" title="var">i</span></span> may contain
    after potential update operations. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="Realization.harray_focus'" class="idref" href="#Realization.harray_focus'"><span class="id" title="axiom">harray_focus'</span></a> : <span class="id" title="keyword">∀</span> <a id="i:267" class="idref" href="#i:267"><span class="id" title="binder">i</span></a> <a id="L:268" class="idref" href="#L:268"><span class="id" title="binder">L</span></a> <a id="p:269" class="idref" href="#p:269"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;0 <span class="id" title="notation">≤</span> <a class="idref" href="Arrays.html#i:267"><span class="id" title="variable">i</span></a> <span class="id" title="notation">&lt;</span> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:268"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#Realization.harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Arrays.html#L:268"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:269"><span class="id" title="variable">p</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <span class="id" title="keyword">let</span> <a id="v:270" class="idref" href="#v:270"><span class="id" title="binder">v</span></a> := <span class="id" title="definition">LibList.nth</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">i</span>) <a class="idref" href="Arrays.html#L:268"><span class="id" title="variable">L</span></a> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Arrays.html#Realization.hcell"><span class="id" title="definition">hcell</span></a> <a class="idref" href="Arrays.html#v:270"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#p:269"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:267"><span class="id" title="variable">i</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">∀</span></a> <a id="w:271" class="idref" href="#w:271"><span class="id" title="binder">w</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="Arrays.html#Realization.hcell"><span class="id" title="definition">hcell</span></a> <a class="idref" href="Arrays.html#w:271"><span class="id" title="variable">w</span></a> <a class="idref" href="Arrays.html#p:269"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:267"><span class="id" title="variable">i</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Arrays.html#Realization.harray"><span class="id" title="definition">harray</span></a> (<span class="id" title="definition">LibList.update</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">i</span>) <a class="idref" href="Arrays.html#w:271"><span class="id" title="variable">w</span></a> <a class="idref" href="Arrays.html#L:268"><span class="id" title="variable">L</span></a>) <a class="idref" href="Arrays.html#p:269"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>.<br/>
</div>

<div class="doc">
The focus lemmas are critically useful. Without them, we would need to
    repeat a number of tedious splitting and merging steps. 
<div class="paragraph"> </div>

<a id="lab445"></a><h4 class="section">Exercise: 4 stars, standard, especially useful (hseg_focus)</h4>
 Prove the following focus lemma for array <i>segments</i>. Hint: although a proof
    by induction is possible, a simpler proof can be achieved by exploiting
    <span class="inlinecode"><span class="id" title="var">LibList.list_middle_inv</span></span>, <span class="inlinecode"><span class="id" title="var">LibList.nth_middle</span></span> and <span class="inlinecode"><span class="id" title="var">LibList.update_middle</span></span>.
    Also, recall that lemma <span class="inlinecode"><span class="id" title="var">Inhab_val</span></span> proves <span class="inlinecode"><span class="id" title="var">Inhab</span></span> <span class="inlinecode"><span class="id" title="var">val</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.hseg_focus_relative" class="idref" href="#Realization.hseg_focus_relative"><span class="id" title="lemma">hseg_focus_relative</span></a> : <span class="id" title="keyword">∀</span> (<a id="k:273" class="idref" href="#k:273"><span class="id" title="binder">k</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) <a id="L:274" class="idref" href="#L:274"><span class="id" title="binder">L</span></a> <a id="p:275" class="idref" href="#p:275"><span class="id" title="binder">p</span></a> <a id="j:276" class="idref" href="#j:276"><span class="id" title="binder">j</span></a>,<br/>
&nbsp;&nbsp;0 <span class="id" title="notation">≤</span> <a class="idref" href="Arrays.html#k:273"><span class="id" title="variable">k</span></a> <span class="id" title="notation">&lt;</span> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:274"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#Realization.hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L:274"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:275"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:276"><span class="id" title="variable">j</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <span class="id" title="keyword">let</span> <a id="v:277" class="idref" href="#v:277"><span class="id" title="binder">v</span></a> := <span class="id" title="definition">LibList.nth</span> <a class="idref" href="Arrays.html#k:273"><span class="id" title="variable">k</span></a> <a class="idref" href="Arrays.html#L:274"><span class="id" title="variable">L</span></a> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#Realization.hcell"><span class="id" title="definition">hcell</span></a> <a class="idref" href="Arrays.html#v:277"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#p:275"><span class="id" title="variable">p</span></a> (<a class="idref" href="Arrays.html#j:276"><span class="id" title="variable">j</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a><a class="idref" href="Arrays.html#k:273"><span class="id" title="variable">k</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">∀</span></a> <a id="w:278" class="idref" href="#w:278"><span class="id" title="binder">w</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="Arrays.html#Realization.hcell"><span class="id" title="definition">hcell</span></a> <a class="idref" href="Arrays.html#w:278"><span class="id" title="variable">w</span></a> <a class="idref" href="Arrays.html#p:275"><span class="id" title="variable">p</span></a> (<a class="idref" href="Arrays.html#j:276"><span class="id" title="variable">j</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a><a class="idref" href="Arrays.html#k:273"><span class="id" title="variable">k</span></a>) <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Arrays.html#Realization.hseg"><span class="id" title="definition">hseg</span></a> (<span class="id" title="definition">LibList.update</span> <a class="idref" href="Arrays.html#k:273"><span class="id" title="variable">k</span></a> <a class="idref" href="Arrays.html#w:278"><span class="id" title="variable">w</span></a> <a class="idref" href="Arrays.html#L:274"><span class="id" title="variable">L</span></a>) <a class="idref" href="Arrays.html#p:275"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:276"><span class="id" title="variable">j</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<span class="id" title="keyword">Arguments</span> <a class="idref" href="Arrays.html#Realization.hseg_focus_relative"><span class="id" title="axiom">hseg_focus_relative</span></a> : <span class="id" title="tactic">clear</span> <span class="id" title="var">implicits</span>.<br/>
</div>

<div class="doc">
In the statement above, <span class="inlinecode"><span class="id" title="var">k</span></span> is an index relative to the start of the
    segment. The focus lemma can also be expressed in terms of absolute indices.
    Below, <span class="inlinecode"><span class="id" title="var">i</span></span> denotes a valid array index within the targeted segment. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.hseg_focus" class="idref" href="#Realization.hseg_focus"><span class="id" title="lemma">hseg_focus</span></a> : <span class="id" title="keyword">∀</span> <a id="i:279" class="idref" href="#i:279"><span class="id" title="binder">i</span></a> <a id="L:280" class="idref" href="#L:280"><span class="id" title="binder">L</span></a> <a id="p:281" class="idref" href="#p:281"><span class="id" title="binder">p</span></a> <a id="j:282" class="idref" href="#j:282"><span class="id" title="binder">j</span></a>,<br/>
&nbsp;&nbsp;0 <span class="id" title="notation">≤</span> <a class="idref" href="Arrays.html#i:279"><span class="id" title="variable">i</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#::Z_scope:x_'-'_x"><span class="id" title="notation">-</span></a><a class="idref" href="Arrays.html#j:282"><span class="id" title="variable">j</span></a> <span class="id" title="notation">&lt;</span> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:280"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#Realization.hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L:280"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:281"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:282"><span class="id" title="variable">j</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <span class="id" title="keyword">let</span> <a id="v:283" class="idref" href="#v:283"><span class="id" title="binder">v</span></a> := <span class="id" title="definition">LibList.nth</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">i</span><span class="id" title="notation">-</span><span class="id" title="notation">j</span><span class="id" title="notation">)</span>) <a class="idref" href="Arrays.html#L:280"><span class="id" title="variable">L</span></a> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#Realization.hcell"><span class="id" title="definition">hcell</span></a> <a class="idref" href="Arrays.html#v:283"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#p:281"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:279"><span class="id" title="variable">i</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">∀</span></a> <a id="w:284" class="idref" href="#w:284"><span class="id" title="binder">w</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="Arrays.html#Realization.hcell"><span class="id" title="definition">hcell</span></a> <a class="idref" href="Arrays.html#w:284"><span class="id" title="variable">w</span></a> <a class="idref" href="Arrays.html#p:281"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:279"><span class="id" title="variable">i</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Arrays.html#Realization.hseg"><span class="id" title="definition">hseg</span></a> (<span class="id" title="definition">LibList.update</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">i</span><span class="id" title="notation">-</span><span class="id" title="notation">j</span><span class="id" title="notation">)</span>) <a class="idref" href="Arrays.html#w:284"><span class="id" title="variable">w</span></a> <a class="idref" href="Arrays.html#L:280"><span class="id" title="variable">L</span></a>) <a class="idref" href="Arrays.html#p:281"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:282"><span class="id" title="variable">j</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">Hk</span>. <span class="id" title="var">xchange</span> (<a class="idref" href="Arrays.html#Realization.hseg_focus_relative"><span class="id" title="axiom">hseg_focus_relative</span></a> (<span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">i</span><span class="id" title="notation">-</span><span class="id" title="notation">j</span><span class="id" title="notation">)</span>)). { <span class="id" title="var">math</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="var">math_rewrite</span> (<span class="id" title="var">j</span> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">i</span> <span class="id" title="notation">-</span> <span class="id" title="notation">j</span><span class="id" title="notation">)</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">i</span>). <span class="id" title="var">xsimpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Arguments</span> <a class="idref" href="Arrays.html#Realization.hseg_focus"><span class="id" title="lemma">hseg_focus</span></a> : <span class="id" title="tactic">clear</span> <span class="id" title="var">implicits</span>.<br/>
</div>

<div class="doc">
We can derive the final focus lemma for <span class="inlinecode"><span class="id" title="var">harray</span></span> from the one for <span class="inlinecode"><span class="id" title="var">hseg</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.harray_focus" class="idref" href="#Realization.harray_focus"><span class="id" title="lemma">harray_focus</span></a> : <span class="id" title="keyword">∀</span> <a id="i:285" class="idref" href="#i:285"><span class="id" title="binder">i</span></a> <a id="L:286" class="idref" href="#L:286"><span class="id" title="binder">L</span></a> <a id="p:287" class="idref" href="#p:287"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;0 <span class="id" title="notation">≤</span> <a class="idref" href="Arrays.html#i:285"><span class="id" title="variable">i</span></a> <span class="id" title="notation">&lt;</span> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:286"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#Realization.harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Arrays.html#L:286"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:287"><span class="id" title="variable">p</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <span class="id" title="keyword">let</span> <a id="v:288" class="idref" href="#v:288"><span class="id" title="binder">v</span></a> := <span class="id" title="definition">LibList.nth</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">i</span>) <a class="idref" href="Arrays.html#L:286"><span class="id" title="variable">L</span></a> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#Realization.hcell"><span class="id" title="definition">hcell</span></a> <a class="idref" href="Arrays.html#v:288"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#p:287"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:285"><span class="id" title="variable">i</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">∀</span></a> <a id="w:289" class="idref" href="#w:289"><span class="id" title="binder">w</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="Arrays.html#Realization.hcell"><span class="id" title="definition">hcell</span></a> <a class="idref" href="Arrays.html#w:289"><span class="id" title="variable">w</span></a> <a class="idref" href="Arrays.html#p:287"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:285"><span class="id" title="variable">i</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Arrays.html#Realization.harray"><span class="id" title="definition">harray</span></a> (<span class="id" title="definition">LibList.update</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">i</span>) <a class="idref" href="Arrays.html#w:289"><span class="id" title="variable">w</span></a> <a class="idref" href="Arrays.html#L:286"><span class="id" title="variable">L</span></a>) <a class="idref" href="Arrays.html#p:287"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">Hi</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Arrays.html#Realization.harray"><span class="id" title="definition">harray</span></a>. <span class="id" title="var">xchange</span> (<a class="idref" href="Arrays.html#Realization.hseg_focus"><span class="id" title="lemma">hseg_focus</span></a> <span class="id" title="var">i</span>). { <span class="id" title="var">math</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="var">math_rewrite</span> (<span class="id" title="var">i</span> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#::Z_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">i</span>). <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">w</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xchange</span> (<a class="idref" href="LibSepReference.html#SepSimplArgs.hforall_specialize"><span class="id" title="lemma">hforall_specialize</span></a> <span class="id" title="var">w</span>). <span class="id" title="var">xsimpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span>* <span class="id" title="lemma">LibList.length_update</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Arguments</span> <a class="idref" href="Arrays.html#Realization.harray_focus"><span class="id" title="lemma">harray_focus</span></a> : <span class="id" title="tactic">clear</span> <span class="id" title="var">implicits</span>.<br/>
</div>

<div class="doc">
<a id="lab446"></a><h4 class="section">Exercise: 3 stars, standard, optional (harray_focus_read)</h4>
 Prove that the "focus-read" lemma is a direct consequence of the general
    version of the focus lemma <span class="inlinecode"><span class="id" title="var">harray_focus</span></span>. Hint: use
    <span class="inlinecode"><span class="id" title="var">LibList.update_nth_same</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.harray_focus_read" class="idref" href="#Realization.harray_focus_read"><span class="id" title="lemma">harray_focus_read</span></a> : <span class="id" title="keyword">∀</span> <a id="i:290" class="idref" href="#i:290"><span class="id" title="binder">i</span></a> <a id="L:291" class="idref" href="#L:291"><span class="id" title="binder">L</span></a> <a id="p:292" class="idref" href="#p:292"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;0 <span class="id" title="notation">≤</span> <a class="idref" href="Arrays.html#i:290"><span class="id" title="variable">i</span></a> <span class="id" title="notation">&lt;</span> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:291"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#Realization.harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Arrays.html#L:291"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:292"><span class="id" title="variable">p</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <span class="id" title="keyword">let</span> <a id="v:293" class="idref" href="#v:293"><span class="id" title="binder">v</span></a> := <span class="id" title="definition">LibList.nth</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">i</span>) <a class="idref" href="Arrays.html#L:291"><span class="id" title="variable">L</span></a> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#Realization.hcell"><span class="id" title="definition">hcell</span></a> <a class="idref" href="Arrays.html#v:293"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#p:292"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:290"><span class="id" title="variable">i</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Arrays.html#Realization.hcell"><span class="id" title="definition">hcell</span></a> <a class="idref" href="Arrays.html#v:293"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#p:292"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:290"><span class="id" title="variable">i</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Arrays.html#Realization.harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Arrays.html#L:291"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:292"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<span class="id" title="keyword">Arguments</span> <a class="idref" href="Arrays.html#Realization.harray_focus_read"><span class="id" title="axiom">harray_focus_read</span></a> : <span class="id" title="tactic">clear</span> <span class="id" title="var">implicits</span>.<br/>
</div>

<div class="doc">
<a id="lab447"></a><h1 class="section">Optional Material</h1>

<div class="paragraph"> </div>

 In this section, we show how to implement array operations in terms of
    lower-level primitive operations such as block allocation and pointer
    arithmetic. 
</div>

<div class="doc">
<a id="lab448"></a><h2 class="section">Semantics of Pointer Arithmetic</h2>

<div class="paragraph"> </div>

 The operation <span class="inlinecode"><span class="id" title="var">val_ptr_add</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> applies to a pointer <span class="inlinecode"><span class="id" title="var">p</span></span> and an integer <span class="inlinecode"><span class="id" title="var">n</span></span>,
    and returns the address <span class="inlinecode"><span class="id" title="var">p</span>+<span class="id" title="var">n</span></span>. In other words, it computes the address of
    the <span class="inlinecode"><span class="id" title="var">n</span></span>-th cell past the cell at location <span class="inlinecode"><span class="id" title="var">p</span></span>. We assume <span class="inlinecode"><span class="id" title="var">val_ptr_add</span></span> to be
    a primitive of the language. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="Realization.val_ptr_add" class="idref" href="#Realization.val_ptr_add"><span class="id" title="axiom">val_ptr_add</span></a> : <a class="idref" href="LibSepReference.html#prim"><span class="id" title="inductive">prim</span></a>.<br/>
</div>

<div class="doc">
The evaluation rule and the general specification for pointer addition are
    shown below. They both require <span class="inlinecode"><span class="id" title="var">p</span>+<span class="id" title="var">n</span></span> to be a nonnegative integer. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="Realization.eval_ptr_add" class="idref" href="#Realization.eval_ptr_add"><span class="id" title="axiom">eval_ptr_add</span></a> : <span class="id" title="keyword">∀</span> <a id="p:295" class="idref" href="#p:295"><span class="id" title="binder">p</span></a> <a id="n:296" class="idref" href="#n:296"><span class="id" title="binder">n</span></a> <a id="s:297" class="idref" href="#s:297"><span class="id" title="binder">s</span></a> <a id="Q:298" class="idref" href="#Q:298"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#p:295"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="Arrays.html#n:296"><span class="id" title="variable">n</span></a> <span class="id" title="notation">≥</span> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#Q:298"><span class="id" title="variable">Q</span></a> (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> (<span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">p</span> <span class="id" title="notation">+</span> <span class="id" title="notation">n</span><span class="id" title="notation">)</span>)) <a class="idref" href="Arrays.html#s:297"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Arrays.html#s:297"><span class="id" title="variable">s</span></a> (<a class="idref" href="Arrays.html#Realization.val_ptr_add"><span class="id" title="axiom">val_ptr_add</span></a> (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Arrays.html#p:295"><span class="id" title="variable">p</span></a>) (<a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Arrays.html#n:296"><span class="id" title="variable">n</span></a>)) <a class="idref" href="Arrays.html#Q:298"><span class="id" title="variable">Q</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_ptr_add" class="idref" href="#Realization.triple_ptr_add"><span class="id" title="lemma">triple_ptr_add</span></a> : <span class="id" title="keyword">∀</span> (<a id="p:300" class="idref" href="#p:300"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) (<a id="n:301" class="idref" href="#n:301"><span class="id" title="binder">n</span></a>:<span class="id" title="notation">int</span>),<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#p:300"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="Arrays.html#n:301"><span class="id" title="variable">n</span></a> <span class="id" title="notation">≥</span> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#Realization.val_ptr_add"><span class="id" title="axiom">val_ptr_add</span></a> <a class="idref" href="Arrays.html#p:300"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#n:301"><span class="id" title="variable">n</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:302" class="idref" href="#r:302"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Arrays.html#r:302"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> (<span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">p</span> <span class="id" title="notation">+</span> <span class="id" title="notation">n</span><span class="id" title="notation">)</span>)<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">R</span> <span class="id" title="var">Hs</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Arrays.html#Realization.eval_ptr_add"><span class="id" title="axiom">eval_ptr_add</span></a>. <span class="id" title="var">lets</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>: <a class="idref" href="LibSepReference.html#SepSimplArgs.hempty_inv"><span class="id" title="lemma">hempty_inv</span></a> <span class="id" title="var">Hs</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hpure_intro"><span class="id" title="lemma">hpure_intro</span></a>. <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
For the <span class="inlinecode"><span class="id" title="var">math</span></span> tactic provided by the TLC library to behave well on goals
    involving expressions of the form <span class="inlinecode"><span class="id" title="var">p</span>+<span class="id" title="var">n</span></span> involved in calls to <span class="inlinecode"><span class="id" title="var">val_ptr_add</span></span>,
    we need a small tweak. We instantiate a hook of the <span class="inlinecode"><span class="id" title="var">math</span></span> tactic to
    registier <span class="inlinecode"><span class="id" title="var">loc</span></span> as transparent type for this tactic. 
</div>
<div class="code">

<span class="id" title="keyword">Ltac</span> <span class="id" title="var">is_additional_arith_type</span> <span class="id" title="var">T</span> <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">T</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a> ⇒ <span class="id" title="keyword">constr</span>:(<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
For the purpose of this course, we only need to shift pointers by a
    nonnegative number of cells. We show below a simplified specification
    featuring the premise <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">≥</span> <span class="inlinecode">0</span> instead of <span class="inlinecode"><span class="id" title="var">p</span>+<span class="id" title="var">n</span></span> <span class="inlinecode">≥</span> <span class="inlinecode">0</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_ptr_add_nonneg" class="idref" href="#Realization.triple_ptr_add_nonneg"><span class="id" title="lemma">triple_ptr_add_nonneg</span></a> : <span class="id" title="keyword">∀</span> (<a id="p:303" class="idref" href="#p:303"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) (<a id="n:304" class="idref" href="#n:304"><span class="id" title="binder">n</span></a>:<span class="id" title="notation">int</span>),<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#n:304"><span class="id" title="variable">n</span></a> <span class="id" title="notation">≥</span> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#Realization.val_ptr_add"><span class="id" title="axiom">val_ptr_add</span></a> <a class="idref" href="Arrays.html#p:303"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#n:304"><span class="id" title="variable">n</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:305" class="idref" href="#r:305"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Arrays.html#r:305"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> (<a class="idref" href="Arrays.html#p:303"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="notation">abs</span> <span class="id" title="notation">n</span>)%<span class="id" title="var">nat</span><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">Hn</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_conseq"><span class="id" title="lemma">triple_conseq</span></a> <a class="idref" href="Arrays.html#Realization.triple_ptr_add"><span class="id" title="lemma">triple_ptr_add</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">math</span>. } { <span class="id" title="var">xsimpl</span>. } { <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> ? →. <span class="id" title="var">fequal</span>. <span class="id" title="var">math</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
#[<span class="id" title="var">export</span>]<span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Resolve</span> <span class="id" title="var">triple_ptr_add_nonneg</span> : <span class="id" title="var">triple</span>.<br/>
</div>

<div class="doc">
<a id="lab449"></a><h2 class="section">Semantics of Low-Level Block Allocation</h2>

<div class="paragraph"> </div>

 The operation <span class="inlinecode"><span class="id" title="var">val_alloc</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> allocates a block of <span class="inlinecode"><span class="id" title="var">n</span></span> consecutive cells.
    Starting from a state <span class="inlinecode"><span class="id" title="var">sa</span></span>, it produces a state described as the union of
    <span class="inlinecode"><span class="id" title="var">sb</span></span> and <span class="inlinecode"><span class="id" title="var">sa</span></span>, where <span class="inlinecode"><span class="id" title="var">sb</span></span> consists of consecutive of <span class="inlinecode"><span class="id" title="var">n</span></span> consecutive cells.
    In the evaluation rule shown below, <span class="inlinecode"><span class="id" title="var">Fmap.conseq</span></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="var">p</span></span> builds a state with
    a range of cells starting a location <span class="inlinecode"><span class="id" title="var">p</span></span> and with contents described by the
    list <span class="inlinecode"><span class="id" title="var">L</span></span>. Each of these cells is specified as having the special value
    <span class="inlinecode"><span class="id" title="var">val_uninit</span></span> as contents. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="Realization.val_alloc" class="idref" href="#Realization.val_alloc"><span class="id" title="axiom">val_alloc</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Parameter</span> <a id="Realization.eval_alloc" class="idref" href="#Realization.eval_alloc"><span class="id" title="axiom">eval_alloc</span></a> : <span class="id" title="keyword">∀</span> <a id="n:307" class="idref" href="#n:307"><span class="id" title="binder">n</span></a> <a id="sa:308" class="idref" href="#sa:308"><span class="id" title="binder">sa</span></a> <a id="Q:309" class="idref" href="#Q:309"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#n:307"><span class="id" title="variable">n</span></a> <span class="id" title="notation">≥</span> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="p:310" class="idref" href="#p:310"><span class="id" title="binder">p</span></a> <a id="sb:311" class="idref" href="#sb:311"><span class="id" title="binder">sb</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#sb:311"><span class="id" title="variable">sb</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#Fmap.conseq"><span class="id" title="definition">Fmap.conseq</span></a> (<span class="id" title="definition">LibList.make</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">n</span>) <a class="idref" href="LibSepReference.html#val_uninit"><span class="id" title="constructor">val_uninit</span></a>) <a class="idref" href="Arrays.html#p:310"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#p:310"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#Fmap.disjoint"><span class="id" title="definition">Fmap.disjoint</span></a> <a class="idref" href="Arrays.html#sa:308"><span class="id" title="variable">sa</span></a> <a class="idref" href="Arrays.html#sb:311"><span class="id" title="variable">sb</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#Q:309"><span class="id" title="variable">Q</span></a> (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Arrays.html#p:310"><span class="id" title="variable">p</span></a>) (<a class="idref" href="Arrays.html#sb:311"><span class="id" title="variable">sb</span></a> <a class="idref" href="LibSepReference.html#11dbc5cc324072f557c3f348a31ba1a<sub>0</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#11dbc5cc324072f557c3f348a31ba1a<sub>0</sub>"><span class="id" title="notation">u</span></a> <a class="idref" href="Arrays.html#sa:308"><span class="id" title="variable">sa</span></a>)<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Arrays.html#sa:308"><span class="id" title="variable">sa</span></a> (<a class="idref" href="Arrays.html#Realization.val_alloc"><span class="id" title="axiom">val_alloc</span></a> (<a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Arrays.html#n:307"><span class="id" title="variable">n</span></a>)) <a class="idref" href="Arrays.html#Q:309"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
The specification of <span class="inlinecode"><span class="id" title="var">val_alloc</span></span> is expressed using the heap predicate
    <span class="inlinecode"><span class="id" title="var">hrange</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> to describe a range of consecutive cells -- a heap produced by
    <span class="inlinecode"><span class="id" title="var">Fmap.conseq</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>. The structure of the recursive definition of <span class="inlinecode"><span class="id" title="var">hrange</span></span>
    resembles that of <span class="inlinecode"><span class="id" title="var">hseg</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <a id="Realization.hrange" class="idref" href="#Realization.hrange"><span class="id" title="definition">hrange</span></a> (<a id="L:313" class="idref" href="#L:313"><span class="id" title="binder">L</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) (<a id="p:314" class="idref" href="#p:314"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Arrays.html#L:313"><span class="id" title="variable">L</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> ⇒ <a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;| <span class="id" title="var">x</span><span class="id" title="notation">::</span><span class="id" title="var">L'</span> ⇒ <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Arrays.html#p:314"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <span class="id" title="var">x</span><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Arrays.html#hrange:315"><span class="id" title="definition">hrange</span></a> <span class="id" title="var">L'</span> (<a class="idref" href="Arrays.html#p:314"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1)%<span class="id" title="var">nat</span><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.hrange_intro" class="idref" href="#Realization.hrange_intro"><span class="id" title="lemma">hrange_intro</span></a> : <span class="id" title="keyword">∀</span> <a id="L:317" class="idref" href="#L:317"><span class="id" title="binder">L</span></a> <a id="p:318" class="idref" href="#p:318"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;(<a class="idref" href="Arrays.html#Realization.hrange"><span class="id" title="definition">hrange</span></a> <a class="idref" href="Arrays.html#L:317"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:318"><span class="id" title="variable">p</span></a>) (<a class="idref" href="LibSepReference.html#Fmap.conseq"><span class="id" title="definition">Fmap.conseq</span></a> <a class="idref" href="Arrays.html#L:317"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:318"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">L</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">L</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">L'</span>]; <span class="id" title="tactic">intros</span>; <span class="id" title="var">rew_listx</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hempty_intro"><span class="id" title="lemma">hempty_intro</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">simpl</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_intro"><span class="id" title="lemma">hstar_intro</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#SepSimplArgs.hsingle_intro"><span class="id" title="lemma">hsingle_intro</span></a>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <span class="id" title="var">IHL</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#Fmap.disjoint_single_conseq"><span class="id" title="lemma">Fmap.disjoint_single_conseq</span></a>. <span class="id" title="tactic">left</span>. <span class="id" title="var">math</span>. } }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The allocation operation <span class="inlinecode"><span class="id" title="var">val_alloc</span></span> is then specified as producing a heap
    described using <span class="inlinecode"><span class="id" title="var">hrange</span></span> for a list of uninitialized values. Note: in ML,
    uninitialized values are never exposed to the programmer; <span class="inlinecode"><span class="id" title="var">val_alloc</span></span> is
    only meant to be invoked internally by the runtime system. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_alloc" class="idref" href="#Realization.triple_alloc"><span class="id" title="lemma">triple_alloc</span></a> : <span class="id" title="keyword">∀</span> <a id="n:319" class="idref" href="#n:319"><span class="id" title="binder">n</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#n:319"><span class="id" title="variable">n</span></a> <span class="id" title="notation">≥</span> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#Realization.val_alloc"><span class="id" title="axiom">val_alloc</span></a> <a class="idref" href="Arrays.html#n:319"><span class="id" title="variable">n</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:322" class="idref" href="#p:322"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Arrays.html#Realization.hrange"><span class="id" title="definition">hrange</span></a> (<span class="id" title="definition">LibList.make</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">n</span>) <a class="idref" href="LibSepReference.html#val_uninit"><span class="id" title="constructor">val_uninit</span></a>) <a class="idref" href="Arrays.html#p:320"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Arrays.html#p:320"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">Hn</span> <span class="id" title="var">Hsa</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Arrays.html#Realization.eval_alloc"><span class="id" title="axiom">eval_alloc</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">p</span> <span class="id" title="var">sb</span> <span class="id" title="var">Esb</span> <span class="id" title="var">Hp</span> <span class="id" title="var">D</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">lets</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>: <a class="idref" href="LibSepReference.html#SepSimplArgs.hempty_inv"><span class="id" title="lemma">hempty_inv</span></a> <span class="id" title="var">Hsa</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hexists_intro"><span class="id" title="lemma">hexists_intro</span></a> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_hpure_l"><span class="id" title="lemma">hstar_hpure_l</span></a>. <span class="id" title="tactic">split</span>*. <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#Fmap.union_empty_r"><span class="id" title="lemma">Fmap.union_empty_r</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_hpure_r"><span class="id" title="lemma">hstar_hpure_r</span></a>. <span class="id" title="tactic">split</span>*. <span class="id" title="tactic">subst</span> <span class="id" title="var">sb</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Arrays.html#Realization.hrange_intro"><span class="id" title="lemma">hrange_intro</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
#[<span class="id" title="var">export</span>]<span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Resolve</span> <span class="id" title="var">triple_alloc</span> : <span class="id" title="var">triple</span>.<br/>
</div>

<div class="doc">
<a id="lab450"></a><h2 class="section">Low-Level Implementation of Arrays</h2>

<div class="paragraph"> </div>

 We are now ready to explain how a runtime system could implement the
    operations <span class="inlinecode"><span class="id" title="var">length</span></span>, <span class="inlinecode"><span class="id" title="var">get</span></span>, <span class="inlinecode"><span class="id" title="tactic">set</span></span>, and <span class="inlinecode"><span class="id" title="var">make</span></span> on arrays, in terms of
    <span class="inlinecode"><span class="id" title="var">val_alloc</span></span> and <span class="inlinecode"><span class="id" title="var">val_ptr_add</span></span> for allocating memory blocks and computing
    pointer offsets, as well as <span class="inlinecode"><span class="id" title="var">val_get</span></span> and <span class="inlinecode"><span class="id" title="var">val_set</span></span> for reading and writing
    into individual memory cells. 
</div>
<div class="code">

<span class="id" title="keyword">Import</span> <a class="idref" href="LibSepVar.html#NotationForVariables"><span class="id" title="module">NotationForVariables</span></a>.<br/>
</div>

<div class="doc">
The operation that obtains the <span class="inlinecode"><span class="id" title="var">length</span></span> of an array is implemented by
    reading the integer stored into the header field of that array. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="Realization.val_array_length" class="idref" href="#Realization.val_array_length"><span class="id" title="definition">val_array_length</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="LibSepReference.html#val_get"><span class="id" title="constructor">val_get</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
The operation that reads into an array cell, written <span class="inlinecode"><span class="id" title="var">val_array_get</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span>, is
    implemented as a read at the location <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">+</span> <span class="inlinecode">1</span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">abs</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="Realization.val_array_get" class="idref" href="#Realization.val_array_get"><span class="id" title="definition">val_array_get</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#bfe3f2ff4c10f23c7c7f24aa5367bca5"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">i</span></a> <a class="idref" href="LibSepReference.html#bfe3f2ff4c10f23c7c7f24aa5367bca5"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#Realization.val_ptr_add"><span class="id" title="axiom">val_ptr_add</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> 1 <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">q</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#Realization.val_ptr_add"><span class="id" title="axiom">val_ptr_add</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">i</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#val_get"><span class="id" title="constructor">val_get</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">q</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
The operation that reads into an array cell, written <span class="inlinecode"><span class="id" title="var">val_array_set</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span>,
    is implemented as a write of <span class="inlinecode"><span class="id" title="var">v</span></span> at the location <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">+</span> <span class="inlinecode">1</span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">abs</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="Realization.val_array_set" class="idref" href="#Realization.val_array_set"><span class="id" title="definition">val_array_set</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#bfe3f2ff4c10f23c7c7f24aa5367bca5"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">i</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">v</span></a> <a class="idref" href="LibSepReference.html#bfe3f2ff4c10f23c7c7f24aa5367bca5"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#Realization.val_ptr_add"><span class="id" title="axiom">val_ptr_add</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> 1 <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">q</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#Realization.val_ptr_add"><span class="id" title="axiom">val_ptr_add</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">i</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#val_set"><span class="id" title="constructor">val_set</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">q</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">v</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
The auxiliary function <span class="inlinecode"><span class="id" title="var">fill</span></span> is used to implement <span class="inlinecode"><span class="id" title="var">make</span></span>. The operation
    <span class="inlinecode"><span class="id" title="var">fill</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> fills the range of the array <span class="inlinecode"><span class="id" title="var">p</span></span>, starting at index <span class="inlinecode"><span class="id" title="var">i</span></span>, with
    <span class="inlinecode"><span class="id" title="var">n</span></span> copies of the value <span class="inlinecode"><span class="id" title="var">v</span></span>. The code below provides a naive recursive
    implementation of <span class="inlinecode"><span class="id" title="var">fill</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="Realization.val_array_fill" class="idref" href="#Realization.val_array_fill"><span class="id" title="definition">val_array_fill</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#06de39bf13088f4f90583983ce65e722"><span class="id" title="notation">fix</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">i</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">v</span></a> <a class="idref" href="LibSepReference.html#06de39bf13088f4f90583983ce65e722"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:x_'&gt;'_x"><span class="id" title="notation">&gt;</span></a> 0 <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'end'"><span class="id" title="notation">if</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'end'"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#Realization.val_array_set"><span class="id" title="definition">val_array_set</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">i</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">v</span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">m</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1 <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">j</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">i</span></a> <a class="idref" href="LibSepReference.html#590da34eb63eef1c68773c655749c128"><span class="id" title="notation">+</span></a> 1 <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">j</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">m</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">v</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'end'"><span class="id" title="notation">end</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
The operation <span class="inlinecode"><span class="id" title="var">val_array_make</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> creates an array of length <span class="inlinecode"><span class="id" title="var">n</span></span> filled
    with copies of the value <span class="inlinecode"><span class="id" title="var">v</span></span>. It is implemented as the allocation of a block
    of length <span class="inlinecode"><span class="id" title="var">n</span>+1</span> at a fresh address <span class="inlinecode"><span class="id" title="var">p</span></span>, followed by the write of the value
    <span class="inlinecode"><span class="id" title="var">n</span></span> in the header, and with a call to <span class="inlinecode"><span class="id" title="var">fill</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">0</span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> for filling the <span class="inlinecode"><span class="id" title="var">n</span></span>
    cells of the array <span class="inlinecode"><span class="id" title="var">p</span></span> with copies of the value <span class="inlinecode"><span class="id" title="var">v</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="Realization.val_array_make" class="idref" href="#Realization.val_array_make"><span class="id" title="definition">val_array_make</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#bfe3f2ff4c10f23c7c7f24aa5367bca5"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">v</span></a> <a class="idref" href="LibSepReference.html#bfe3f2ff4c10f23c7c7f24aa5367bca5"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">m</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#590da34eb63eef1c68773c655749c128"><span class="id" title="notation">+</span></a> 1 <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#Realization.val_alloc"><span class="id" title="axiom">val_alloc</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">m</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#val_set"><span class="id" title="constructor">val_set</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#Realization.val_array_fill"><span class="id" title="definition">val_array_fill</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> 0 <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">v</span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
<a id="lab451"></a><h2 class="section">Verification of Low-Level Operations for Arrays</h2>

<div class="paragraph"> </div>

 Now we can prove that the implementations presented above for <span class="inlinecode"><span class="id" title="var">length</span></span>,
    <span class="inlinecode"><span class="id" title="var">get</span></span>, <span class="inlinecode"><span class="id" title="tactic">set</span></span>, and <span class="inlinecode"><span class="id" title="var">make</span></span> indeed satisfy the specifications axiomatized for
    them earlier in this chapter. For these proofs, we need to set the
    definition of <span class="inlinecode"><span class="id" title="var">hheader</span></span> as transparent. 
</div>
<div class="code">

<span class="id" title="keyword">Global Transparent</span> <a class="idref" href="Arrays.html#Realization.hheader"><span class="id" title="definition">hheader</span></a>.<br/>
</div>

<div class="doc">
We also add a hint for <span class="inlinecode"><span class="id" title="var">xapp</span></span>, to automatically handle the arithmetic
    preconditions arising from calls to <span class="inlinecode"><span class="id" title="var">val_ptr_add</span></span> and <span class="inlinecode"><span class="id" title="var">val_alloc</span></span>. 
</div>
<div class="code">

#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Extern</span> 1 (<span class="id" title="var">_</span> <span class="id" title="notation">≥</span> <span class="id" title="var">_</span>) ⇒ <span class="id" title="var">math</span> : <span class="id" title="var">triple</span>.<br/>
</div>

<div class="doc">
Moreover, we customize the behavior of the "*" suffix that appears in next
    to Coq tactics, for this symbol to trigger not a call to <span class="inlinecode"><span class="id" title="tactic">eauto</span></span> but instead
    a call to <span class="inlinecode"><span class="id" title="tactic">eauto</span></span> <span class="inlinecode"><span class="id" title="keyword">with</span></span> <span class="inlinecode"><span class="id" title="var">maths</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Local Ltac</span> <span class="id" title="var">auto_star</span> <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">maths</span>.<br/>
</div>

<div class="doc">
Here are the proofs for the small-footprint specifications. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_array_length_hheader" class="idref" href="#Realization.triple_array_length_hheader"><span class="id" title="lemma">triple_array_length_hheader</span></a> : <span class="id" title="keyword">∀</span> <a id="n:323" class="idref" href="#n:323"><span class="id" title="binder">n</span></a> <a id="p:324" class="idref" href="#p:324"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#Realization.val_array_length"><span class="id" title="definition">val_array_length</span></a> <a class="idref" href="Arrays.html#p:324"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Arrays.html#Realization.hheader"><span class="id" title="definition">hheader</span></a> <a class="idref" href="Arrays.html#n:323"><span class="id" title="variable">n</span></a> <a class="idref" href="Arrays.html#p:324"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:325" class="idref" href="#r:325"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Arrays.html#r:325"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#n:323"><span class="id" title="variable">n</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#Realization.hheader"><span class="id" title="definition">hheader</span></a> <a class="idref" href="Arrays.html#n:323"><span class="id" title="variable">n</span></a> <a class="idref" href="Arrays.html#p:324"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">xwp</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Arrays.html#Realization.hheader"><span class="id" title="definition">hheader</span></a>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xsimpl</span>*. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_array_get_hcell" class="idref" href="#Realization.triple_array_get_hcell"><span class="id" title="lemma">triple_array_get_hcell</span></a> : <span class="id" title="keyword">∀</span> <a id="v:326" class="idref" href="#v:326"><span class="id" title="binder">v</span></a> <a id="p:327" class="idref" href="#p:327"><span class="id" title="binder">p</span></a> <a id="i:328" class="idref" href="#i:328"><span class="id" title="binder">i</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#Realization.val_array_get"><span class="id" title="definition">val_array_get</span></a> <a class="idref" href="Arrays.html#p:327"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:328"><span class="id" title="variable">i</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Arrays.html#Realization.hcell"><span class="id" title="definition">hcell</span></a> <a class="idref" href="Arrays.html#v:326"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#p:327"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:328"><span class="id" title="variable">i</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:329" class="idref" href="#r:329"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Arrays.html#r:329"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#v:326"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#Realization.hcell"><span class="id" title="definition">hcell</span></a> <a class="idref" href="Arrays.html#v:326"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#p:327"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:328"><span class="id" title="variable">i</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xwp</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Arrays.html#Realization.hcell"><span class="id" title="definition">hcell</span></a>. <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Hi</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xsimpl</span>*.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_array_set_hcell" class="idref" href="#Realization.triple_array_set_hcell"><span class="id" title="lemma">triple_array_set_hcell</span></a> : <span class="id" title="keyword">∀</span> <a id="p:330" class="idref" href="#p:330"><span class="id" title="binder">p</span></a> <a id="i:331" class="idref" href="#i:331"><span class="id" title="binder">i</span></a> <a id="v:332" class="idref" href="#v:332"><span class="id" title="binder">v</span></a> <a id="w:333" class="idref" href="#w:333"><span class="id" title="binder">w</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#Realization.val_array_set"><span class="id" title="definition">val_array_set</span></a> <a class="idref" href="Arrays.html#p:330"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:331"><span class="id" title="variable">i</span></a> <a class="idref" href="Arrays.html#v:332"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Arrays.html#Realization.hcell"><span class="id" title="definition">hcell</span></a> <a class="idref" href="Arrays.html#w:333"><span class="id" title="variable">w</span></a> <a class="idref" href="Arrays.html#p:330"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:331"><span class="id" title="variable">i</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Arrays.html#Realization.hcell"><span class="id" title="definition">hcell</span></a> <a class="idref" href="Arrays.html#v:332"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#p:330"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:331"><span class="id" title="variable">i</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xwp</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Arrays.html#Realization.hcell"><span class="id" title="definition">hcell</span></a>. <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Hi</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xsimpl</span>*.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Then, the proofs of specifications operating on array segments (<span class="inlinecode"><span class="id" title="var">hseg</span></span>). 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_array_get_hseg" class="idref" href="#Realization.triple_array_get_hseg"><span class="id" title="lemma">triple_array_get_hseg</span></a> : <span class="id" title="keyword">∀</span> <a id="L:334" class="idref" href="#L:334"><span class="id" title="binder">L</span></a> <a id="p:335" class="idref" href="#p:335"><span class="id" title="binder">p</span></a> <a id="i:336" class="idref" href="#i:336"><span class="id" title="binder">i</span></a> <a id="j:337" class="idref" href="#j:337"><span class="id" title="binder">j</span></a>,<br/>
&nbsp;&nbsp;0 <span class="id" title="notation">≤</span> <a class="idref" href="Arrays.html#i:336"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#::Z_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="Arrays.html#j:337"><span class="id" title="variable">j</span></a> <span class="id" title="notation">&lt;</span> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:334"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#Realization.val_array_get"><span class="id" title="definition">val_array_get</span></a> <a class="idref" href="Arrays.html#p:335"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:336"><span class="id" title="variable">i</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Arrays.html#Realization.hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L:334"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:335"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:337"><span class="id" title="variable">j</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:338" class="idref" href="#r:338"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Arrays.html#r:338"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">LibList.nth</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">i</span><span class="id" title="notation">-</span><span class="id" title="notation">j</span><span class="id" title="notation">)</span>) <a class="idref" href="Arrays.html#L:334"><span class="id" title="variable">L</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#Realization.hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L:334"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:335"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:337"><span class="id" title="variable">j</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">xtriple</span>. <span class="id" title="var">xchange</span>* (<a class="idref" href="Arrays.html#Realization.hseg_focus"><span class="id" title="lemma">hseg_focus</span></a> <span class="id" title="var">i</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span> <a class="idref" href="Arrays.html#Realization.triple_array_get_hcell"><span class="id" title="lemma">triple_array_get_hcell</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xchange</span> (<a class="idref" href="LibSepReference.html#SepSimplArgs.hforall_specialize"><span class="id" title="lemma">hforall_specialize</span></a> (<span class="id" title="definition">nth</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">i</span> <span class="id" title="notation">-</span> <span class="id" title="notation">j</span><span class="id" title="notation">)</span>) <span class="id" title="var">L</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span>* <span class="id" title="lemma">update_nth_same</span>. { <span class="id" title="var">xsimpl</span>*. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_array_set_hseg" class="idref" href="#Realization.triple_array_set_hseg"><span class="id" title="lemma">triple_array_set_hseg</span></a> : <span class="id" title="keyword">∀</span> <a id="L:339" class="idref" href="#L:339"><span class="id" title="binder">L</span></a> <a id="p:340" class="idref" href="#p:340"><span class="id" title="binder">p</span></a> <a id="i:341" class="idref" href="#i:341"><span class="id" title="binder">i</span></a> <a id="j:342" class="idref" href="#j:342"><span class="id" title="binder">j</span></a> <a id="v:343" class="idref" href="#v:343"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;0 <span class="id" title="notation">≤</span> <a class="idref" href="Arrays.html#i:341"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#::Z_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="Arrays.html#j:342"><span class="id" title="variable">j</span></a> <span class="id" title="notation">&lt;</span> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:339"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#Realization.val_array_set"><span class="id" title="definition">val_array_set</span></a> <a class="idref" href="Arrays.html#p:340"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:341"><span class="id" title="variable">i</span></a> <a class="idref" href="Arrays.html#v:343"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Arrays.html#Realization.hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L:339"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:340"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:342"><span class="id" title="variable">j</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Arrays.html#Realization.hseg"><span class="id" title="definition">hseg</span></a> (<span class="id" title="definition">LibList.update</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">i</span><span class="id" title="notation">-</span><span class="id" title="notation">j</span><span class="id" title="notation">)</span>) <a class="idref" href="Arrays.html#v:343"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#L:339"><span class="id" title="variable">L</span></a>) <a class="idref" href="Arrays.html#p:340"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:342"><span class="id" title="variable">j</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">xtriple</span>. <span class="id" title="var">xchange</span>* (<a class="idref" href="Arrays.html#Realization.hseg_focus"><span class="id" title="lemma">hseg_focus</span></a> <span class="id" title="var">i</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span> <a class="idref" href="Arrays.html#Realization.triple_array_set_hcell"><span class="id" title="lemma">triple_array_set_hcell</span></a>. <span class="id" title="var">xchange</span> (<a class="idref" href="LibSepReference.html#SepSimplArgs.hforall_specialize"><span class="id" title="lemma">hforall_specialize</span></a> <span class="id" title="var">v</span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.hseg_eq_hrange" class="idref" href="#Realization.hseg_eq_hrange"><span class="id" title="lemma">hseg_eq_hrange</span></a> : <span class="id" title="keyword">∀</span> <a id="L:344" class="idref" href="#L:344"><span class="id" title="binder">L</span></a> <a id="p:345" class="idref" href="#p:345"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#Realization.hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L:344"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:345"><span class="id" title="variable">p</span></a> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#Realization.hrange"><span class="id" title="definition">hrange</span></a> <a class="idref" href="Arrays.html#L:344"><span class="id" title="variable">L</span></a> (<a class="idref" href="Arrays.html#p:345"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1)%<span class="id" title="var">nat</span>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">asserts</span> <span class="id" title="var">M</span>: (<span class="id" title="keyword">∀</span> <a id="L:349" class="idref" href="#L:349"><span class="id" title="binder">L</span></a> (<a id="k:350" class="idref" href="#k:350"><span class="id" title="binder">k</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) <a id="p:351" class="idref" href="#p:351"><span class="id" title="binder">p</span></a>, <a class="idref" href="Arrays.html#Realization.hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L:346"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:348"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#k:347"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#Realization.hrange"><span class="id" title="definition">hrange</span></a> <a class="idref" href="Arrays.html#L:346"><span class="id" title="variable">L</span></a> (<a class="idref" href="Arrays.html#p:348"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a><a class="idref" href="Arrays.html#k:347"><span class="id" title="variable">k</span></a>)%<span class="id" title="var">nat</span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">L</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">L</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">math_rewrite</span> (<span class="id" title="var">p</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> 1 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="var">k</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> 1 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">p</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> 1 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">(</span></a><span class="id" title="var">k</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> 1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">nat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHL</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Arrays.html#Realization.hcell"><span class="id" title="definition">hcell</span></a>. <span class="id" title="var">xsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">_</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#HS.himpl_of_eq"><span class="id" title="lemma">himpl_of_eq</span></a>; <span class="id" title="var">fequals_rec</span>; <span class="id" title="var">math</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">math</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#HS.himpl_of_eq"><span class="id" title="lemma">himpl_of_eq</span></a>; <span class="id" title="var">fequals_rec</span>; <span class="id" title="var">math</span>. } } }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">M</span> <span class="id" title="var">L</span> 0%<span class="id" title="var">nat</span>). <span class="id" title="var">fequals</span>. <span class="id" title="var">math</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_array_fill" class="idref" href="#Realization.triple_array_fill"><span class="id" title="lemma">triple_array_fill</span></a> : <span class="id" title="keyword">∀</span> <a id="n:352" class="idref" href="#n:352"><span class="id" title="binder">n</span></a> <a id="L:353" class="idref" href="#L:353"><span class="id" title="binder">L</span></a> <a id="p:354" class="idref" href="#p:354"><span class="id" title="binder">p</span></a> <a id="i:355" class="idref" href="#i:355"><span class="id" title="binder">i</span></a> <a id="v:356" class="idref" href="#v:356"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#n:352"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:353"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#Realization.val_array_fill"><span class="id" title="definition">val_array_fill</span></a> <a class="idref" href="Arrays.html#p:354"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:355"><span class="id" title="variable">i</span></a> <a class="idref" href="Arrays.html#n:352"><span class="id" title="variable">n</span></a> <a class="idref" href="Arrays.html#v:356"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Arrays.html#Realization.hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L:353"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:354"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:355"><span class="id" title="variable">i</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Arrays.html#Realization.hseg"><span class="id" title="definition">hseg</span></a> (<span class="id" title="definition">LibList.make</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">n</span>) <a class="idref" href="Arrays.html#v:356"><span class="id" title="variable">v</span></a>) <a class="idref" href="Arrays.html#p:354"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:355"><span class="id" title="variable">i</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span>. <span class="id" title="var">induction_wf</span> <span class="id" title="var">IH</span>: (<span class="id" title="definition">downto</span> 0) <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">Hn</span>. <span class="id" title="var">xwp</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xif</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">C</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xapp</span> <a class="idref" href="Arrays.html#Realization.triple_array_set_hseg"><span class="id" title="lemma">triple_array_set_hseg</span></a>. { <span class="id" title="var">math</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">math_rewrite</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">i</span> <span class="id" title="notation">-</span> <span class="id" title="notation">i</span><span class="id" title="notation">)</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 0%<span class="id" title="var">nat</span>).<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">L</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">x</span> <span class="id" title="var">L'</span>]; <span class="id" title="var">rew_list</span> <span class="id" title="keyword">in</span> *. { <span class="id" title="var">false</span>. <span class="id" title="var">math</span>. }<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">rew_listx</span>. <span class="id" title="var">xchange</span> <a class="idref" href="Arrays.html#Realization.hseg_cons"><span class="id" title="lemma">hseg_cons</span></a>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xapp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xapp</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">math</span>. <span class="id" title="var">xchange</span> &lt;- <a class="idref" href="Arrays.html#Realization.hseg_cons"><span class="id" title="lemma">hseg_cons</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rewrites</span>* (<span class="id" title="notation">&gt;&gt;</span> <span class="id" title="lemma">LibList.make_pos</span> <span class="id" title="notation">(</span><span class="id" title="notation">abs</span> <span class="id" title="notation">n</span><span class="id" title="notation">)</span> <span class="id" title="var">v</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">math_rewrite</span>* (<span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">n</span><span class="id" title="notation">-1)</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="notation">abs</span> <span class="id" title="notation">n</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1)%<span class="id" title="var">nat</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xval</span>. <span class="id" title="var">math_rewrite</span> (<span class="id" title="var">n</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 0) <span class="id" title="keyword">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">L</span>; <span class="id" title="var">rew_listx</span> <span class="id" title="keyword">in</span> *; <span class="id" title="var">tryfalse</span>. <span class="id" title="tactic">auto</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_array_make_hseg" class="idref" href="#Realization.triple_array_make_hseg"><span class="id" title="lemma">triple_array_make_hseg</span></a> : <span class="id" title="keyword">∀</span> <a id="n:357" class="idref" href="#n:357"><span class="id" title="binder">n</span></a> <a id="v:358" class="idref" href="#v:358"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#n:357"><span class="id" title="variable">n</span></a> <span class="id" title="notation">≥</span> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#Realization.val_array_make"><span class="id" title="definition">val_array_make</span></a> <a class="idref" href="Arrays.html#n:357"><span class="id" title="variable">n</span></a> <a class="idref" href="Arrays.html#v:358"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:361" class="idref" href="#p:361"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Arrays.html#Realization.hheader"><span class="id" title="definition">hheader</span></a> (<span class="id" title="notation">abs</span> <span class="id" title="notation">n</span>) <a class="idref" href="Arrays.html#p:359"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#Realization.hseg"><span class="id" title="definition">hseg</span></a> (<span class="id" title="definition">LibList.make</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">n</span>) <a class="idref" href="Arrays.html#v:358"><span class="id" title="variable">v</span></a>) <a class="idref" href="Arrays.html#p:359"><span class="id" title="variable">p</span></a> 0).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">Hn</span>. <span class="id" title="var">xwp</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xapp</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">q</span> <span class="id" title="var">Hq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">math_rewrite</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">n</span><span class="id" title="notation">+1)</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (<span class="id" title="notation">abs</span> <span class="id" title="notation">n</span>)). <span class="id" title="var">rew_listx</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span>. <span class="id" title="var">xchange</span>* &lt;- (<a class="idref" href="Arrays.html#Realization.hheader_eq"><span class="id" title="lemma">hheader_eq</span></a> <span class="id" title="var">q</span>). <span class="id" title="var">xchange</span> &lt;- <a class="idref" href="Arrays.html#Realization.hseg_eq_hrange"><span class="id" title="lemma">hseg_eq_hrange</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span> <a class="idref" href="Arrays.html#Realization.triple_array_fill"><span class="id" title="lemma">triple_array_fill</span></a>. <span class="id" title="var">rew_listx</span>*. <span class="id" title="var">xval</span>. <span class="id" title="var">xsimpl</span>*.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#HS.himpl_of_eq"><span class="id" title="lemma">himpl_of_eq</span></a>; <span class="id" title="var">fequals_rec</span>; <span class="id" title="var">math</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Finally, the proofs of specifications expressed in terms of <span class="inlinecode"><span class="id" title="var">harray</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_array_get" class="idref" href="#Realization.triple_array_get"><span class="id" title="lemma">triple_array_get</span></a> : <span class="id" title="keyword">∀</span> <a id="L:362" class="idref" href="#L:362"><span class="id" title="binder">L</span></a> <a id="p:363" class="idref" href="#p:363"><span class="id" title="binder">p</span></a> <a id="i:364" class="idref" href="#i:364"><span class="id" title="binder">i</span></a>,<br/>
&nbsp;&nbsp;0 <span class="id" title="notation">≤</span> <a class="idref" href="Arrays.html#i:364"><span class="id" title="variable">i</span></a> <span class="id" title="notation">&lt;</span> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:362"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#Realization.val_array_get"><span class="id" title="definition">val_array_get</span></a> <a class="idref" href="Arrays.html#p:363"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:364"><span class="id" title="variable">i</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Arrays.html#Realization.harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Arrays.html#L:362"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:363"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:365" class="idref" href="#r:365"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Arrays.html#r:365"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">LibList.nth</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">i</span>) <a class="idref" href="Arrays.html#L:362"><span class="id" title="variable">L</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#Realization.harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Arrays.html#L:362"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:363"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">xtriple</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Arrays.html#Realization.harray"><span class="id" title="definition">harray</span></a>. <span class="id" title="var">xapp</span> <a class="idref" href="Arrays.html#Realization.triple_array_get_hseg"><span class="id" title="lemma">triple_array_get_hseg</span></a>. { <span class="id" title="var">math</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="var">math_rewrite</span> (<span class="id" title="var">i</span> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#::Z_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">i</span>). <span class="id" title="var">xsimpl</span>*.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_array_set" class="idref" href="#Realization.triple_array_set"><span class="id" title="lemma">triple_array_set</span></a> : <span class="id" title="keyword">∀</span> <a id="L:366" class="idref" href="#L:366"><span class="id" title="binder">L</span></a> <a id="p:367" class="idref" href="#p:367"><span class="id" title="binder">p</span></a> <a id="i:368" class="idref" href="#i:368"><span class="id" title="binder">i</span></a> <a id="v:369" class="idref" href="#v:369"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;0 <span class="id" title="notation">≤</span> <a class="idref" href="Arrays.html#i:368"><span class="id" title="variable">i</span></a> <span class="id" title="notation">&lt;</span> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:366"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#Realization.val_array_set"><span class="id" title="definition">val_array_set</span></a> <a class="idref" href="Arrays.html#p:367"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:368"><span class="id" title="variable">i</span></a> <a class="idref" href="Arrays.html#v:369"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Arrays.html#Realization.harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Arrays.html#L:366"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:367"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Arrays.html#Realization.harray"><span class="id" title="definition">harray</span></a> (<span class="id" title="definition">LibList.update</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">i</span>) <a class="idref" href="Arrays.html#v:369"><span class="id" title="variable">v</span></a> <a class="idref" href="Arrays.html#L:366"><span class="id" title="variable">L</span></a>) <a class="idref" href="Arrays.html#p:367"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">xtriple</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Arrays.html#Realization.harray"><span class="id" title="definition">harray</span></a>. <span class="id" title="var">xapp</span> <a class="idref" href="Arrays.html#Realization.triple_array_set_hseg"><span class="id" title="lemma">triple_array_set_hseg</span></a>. { <span class="id" title="var">math</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="var">math_rewrite</span> (<span class="id" title="var">i</span> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#::Z_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">i</span>). <span class="id" title="var">rew_listx</span>. <span class="id" title="var">xsimpl</span>*.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_array_length" class="idref" href="#Realization.triple_array_length"><span class="id" title="lemma">triple_array_length</span></a> : <span class="id" title="keyword">∀</span> <a id="L:370" class="idref" href="#L:370"><span class="id" title="binder">L</span></a> <a id="p:371" class="idref" href="#p:371"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#Realization.val_array_length"><span class="id" title="definition">val_array_length</span></a> <a class="idref" href="Arrays.html#p:371"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Arrays.html#Realization.harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Arrays.html#L:370"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:371"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:372" class="idref" href="#r:372"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Arrays.html#r:372"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:370"><span class="id" title="variable">L</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#Realization.harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Arrays.html#L:370"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:371"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">xtriple</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Arrays.html#Realization.harray"><span class="id" title="definition">harray</span></a>. <span class="id" title="var">xapp</span> <a class="idref" href="Arrays.html#Realization.triple_array_length_hheader"><span class="id" title="lemma">triple_array_length_hheader</span></a>. <span class="id" title="var">xsimpl</span>*.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_array_make" class="idref" href="#Realization.triple_array_make"><span class="id" title="lemma">triple_array_make</span></a> : <span class="id" title="keyword">∀</span> <a id="n:373" class="idref" href="#n:373"><span class="id" title="binder">n</span></a> <a id="v:374" class="idref" href="#v:374"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#n:373"><span class="id" title="variable">n</span></a> <span class="id" title="notation">≥</span> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#Realization.val_array_make"><span class="id" title="definition">val_array_make</span></a> <a class="idref" href="Arrays.html#n:373"><span class="id" title="variable">n</span></a> <a class="idref" href="Arrays.html#v:374"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:377" class="idref" href="#p:377"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Arrays.html#Realization.harray"><span class="id" title="definition">harray</span></a> (<span class="id" title="definition">LibList.make</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">n</span>) <a class="idref" href="Arrays.html#v:374"><span class="id" title="variable">v</span></a>) <a class="idref" href="Arrays.html#p:375"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">xtriple</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Arrays.html#Realization.harray"><span class="id" title="definition">harray</span></a>. <span class="id" title="var">xapp</span> <a class="idref" href="Arrays.html#Realization.triple_array_make_hseg"><span class="id" title="lemma">triple_array_make_hseg</span></a>. { <span class="id" title="var">math</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="var">rew_listx</span>. <span class="id" title="var">xsimpl</span>*.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="Arrays.html#Realization"><span class="id" title="module">Realization</span></a>.<br/>
</div>

<div class="doc">
<a id="lab452"></a><h1 class="section">Appendix</h1>

</div>

<div class="doc">
<a id="lab453"></a><h2 class="section">Verification of the Pivot Function</h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="Pivot" class="idref" href="#Pivot"><span class="id" title="module">Pivot</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="Arrays.html#QuickSort"><span class="id" title="module">QuickSort</span></a>.<br/>
<span class="id" title="keyword">Local Ltac</span> <span class="id" title="var">auto_star</span> <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">maths</span>.<br/>
</div>

<div class="doc">
For completeness, we include the formal verification of the <span class="inlinecode"><span class="id" title="var">pivot</span></span>
    function. The proof is unfortunately rather cluttered with reasoning about
    the <span class="inlinecode"><span class="id" title="var">vals_int</span></span> conversion function. The need for it stems from the fact that
    we are reasoning on untyped code. The actual CFML tool provides reasoning
    rule for well-typed code, and is thereby avoids all this kind of clutter.

<div class="paragraph"> </div>

    We consider a simple, unoptimized implementation of the <span class="inlinecode"><span class="id" title="var">pivot</span></span> function.
    This implementation is recursive and performs a series of <span class="inlinecode"><span class="id" title="var">swap</span></span> operations.

<div class="paragraph"> </div>

<span class="inlinecode-ocaml">&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">swap</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">p</span> <span class="id" title="var">j<sub>1</sub></span> <span class="id" title="var">j<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">x<sub>1</sub></span> = <span class="id" title="var">p</span>.(<span class="id" title="var">j<sub>1</sub></span>) <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">x<sub>2</sub></span> = <span class="id" title="var">p</span>.(<span class="id" title="var">j<sub>2</sub></span>) <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">p</span>.(<span class="id" title="var">j<sub>1</sub></span>) &lt;- <span class="id" title="var">x<sub>2</sub></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">p</span>.(<span class="id" title="var">j<sub>2</sub></span>) &lt;- <span class="id" title="var">x<sub>1</sub></span><br/>
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">pivot</span> <span class="id" title="var">p</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">n</span> &lt; 2 <span class="id" title="keyword">then</span> <span class="id" title="var">i</span> <span class="id" title="keyword">else</span> <span class="id" title="var">begin</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">j</span> = <span class="id" title="var">i</span>+1 <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">x</span> = <span class="id" title="var">p</span>.(<span class="id" title="var">i</span>) <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">y</span> = <span class="id" title="var">p</span>.(<span class="id" title="var">j</span>) <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">y</span> ≤ <span class="id" title="var">x</span> <span class="id" title="keyword">then</span> <span class="id" title="var">begin</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">swap</span> <span class="id" title="var">p</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pivot</span> <span class="id" title="var">p</span> <span class="id" title="var">j</span> (<span class="id" title="var">n</span>-1);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <span class="id" title="keyword">else</span> <span class="id" title="var">begin</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">swap</span> <span class="id" title="var">p</span> <span class="id" title="var">j</span> <span class="id" title="var">k</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pivot</span> <span class="id" title="var">p</span> <span class="id" title="var">i</span> (<span class="id" title="var">n</span>-1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>
</span>
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="Pivot.val_array_swap" class="idref" href="#Pivot.val_array_swap"><span class="id" title="definition">val_array_swap</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#bfe3f2ff4c10f23c7c7f24aa5367bca5"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j<sub>1</sub>'"><span class="id" title="notation">j<sub>1</sub></span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j<sub>2</sub>'"><span class="id" title="notation">j<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#bfe3f2ff4c10f23c7c7f24aa5367bca5"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x<sub>1</sub>'"><span class="id" title="notation">x<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#val_array_get"><span class="id" title="axiom">val_array_get</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j<sub>1</sub>'"><span class="id" title="notation">j<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x<sub>2</sub>'"><span class="id" title="notation">x<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#val_array_get"><span class="id" title="axiom">val_array_get</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j<sub>2</sub>'"><span class="id" title="notation">j<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#val_array_set"><span class="id" title="axiom">val_array_set</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j<sub>1</sub>'"><span class="id" title="notation">j<sub>1</sub></span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x<sub>2</sub>'"><span class="id" title="notation">x<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#val_array_set"><span class="id" title="axiom">val_array_set</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j<sub>2</sub>'"><span class="id" title="notation">j<sub>2</sub></span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x<sub>1</sub>'"><span class="id" title="notation">x<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="Pivot.val_pivot" class="idref" href="#Pivot.val_pivot"><span class="id" title="definition">val_pivot</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#06de39bf13088f4f90583983ce65e722"><span class="id" title="notation">fix</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">i</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#06de39bf13088f4f90583983ce65e722"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> 2 <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">i</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">x</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#val_array_get"><span class="id" title="axiom">val_array_get</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">i</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">j</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">i</span></a> <a class="idref" href="LibSepReference.html#590da34eb63eef1c68773c655749c128"><span class="id" title="notation">+</span></a> 1 <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''y'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''y'"><span class="id" title="notation">y</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#val_array_get"><span class="id" title="axiom">val_array_get</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">j</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">m</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1 <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">c</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''y'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''y'"><span class="id" title="notation">y</span></a> <a class="idref" href="LibSepReference.html#9ff281c3872a35aaa31aa0ff16f0b827"><span class="id" title="notation">≤</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">x</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">c</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#Pivot.val_array_swap"><span class="id" title="definition">val_array_swap</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">i</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">j</span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">j</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">m</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''k'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''k'"><span class="id" title="notation">k</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">i</span></a> <a class="idref" href="LibSepReference.html#590da34eb63eef1c68773c655749c128"><span class="id" title="notation">+</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">m</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#Pivot.val_array_swap"><span class="id" title="definition">val_array_swap</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">j</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''k'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''k'"><span class="id" title="notation">k</span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">i</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">m</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
We first state a specialized version of <span class="inlinecode"><span class="id" title="var">array_get</span></span> for array segments
    storing integer values. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Pivot.triple_array_get_hseg_vals_int" class="idref" href="#Pivot.triple_array_get_hseg_vals_int"><span class="id" title="lemma">triple_array_get_hseg_vals_int</span></a> : <span class="id" title="keyword">∀</span> (<a id="L:378" class="idref" href="#L:378"><span class="id" title="binder">L</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <span class="id" title="notation">int</span>) <a id="p:379" class="idref" href="#p:379"><span class="id" title="binder">p</span></a> <a id="i:380" class="idref" href="#i:380"><span class="id" title="binder">i</span></a> <a id="j:381" class="idref" href="#j:381"><span class="id" title="binder">j</span></a>,<br/>
&nbsp;&nbsp;0 <span class="id" title="notation">≤</span> <a class="idref" href="Arrays.html#i:380"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#::Z_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="Arrays.html#j:381"><span class="id" title="variable">j</span></a> <span class="id" title="notation">&lt;</span> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:378"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#val_array_get"><span class="id" title="axiom">val_array_get</span></a> <a class="idref" href="Arrays.html#p:379"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:380"><span class="id" title="variable">i</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> (<a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a> <a class="idref" href="Arrays.html#L:378"><span class="id" title="variable">L</span></a>) <a class="idref" href="Arrays.html#p:379"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:381"><span class="id" title="variable">j</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:382" class="idref" href="#r:382"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Arrays.html#r:382"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">LibList.nth</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">i</span><span class="id" title="notation">-</span><span class="id" title="notation">j</span><span class="id" title="notation">)</span>) <a class="idref" href="Arrays.html#L:378"><span class="id" title="variable">L</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> (<a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a> <a class="idref" href="Arrays.html#L:378"><span class="id" title="variable">L</span></a>) <a class="idref" href="Arrays.html#p:379"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j:381"><span class="id" title="variable">j</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">xtriple</span>. <span class="id" title="var">xapp</span> <a class="idref" href="Arrays.html#triple_array_get_hseg"><span class="id" title="axiom">triple_array_get_hseg</span></a>. { <span class="id" title="var">rew_list</span>. <span class="id" title="var">math</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="var">xsimpl</span>. <span class="id" title="var">unfolds</span> <a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a>. <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">nth_map</span>. <span class="id" title="var">fequals</span>. <span class="id" title="var">math</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Next, we verify the <span class="inlinecode"><span class="id" title="var">swap</span></span> function, which permutes elements at two indices
    inside a given array segment. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Pivot.triple_array_swap_seg" class="idref" href="#Pivot.triple_array_swap_seg"><span class="id" title="lemma">triple_array_swap_seg</span></a> : <span class="id" title="keyword">∀</span> <a id="p:383" class="idref" href="#p:383"><span class="id" title="binder">p</span></a> <a id="i:384" class="idref" href="#i:384"><span class="id" title="binder">i</span></a> <a id="j<sub>1</sub>:385" class="idref" href="#j<sub>1</sub>:385"><span class="id" title="binder">j<sub>1</sub></span></a> <a id="j<sub>2</sub>:386" class="idref" href="#j<sub>2</sub>:386"><span class="id" title="binder">j<sub>2</sub></span></a> (<a id="L:387" class="idref" href="#L:387"><span class="id" title="binder">L</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>),<br/>
&nbsp;&nbsp;0 <span class="id" title="notation">≤</span> <a class="idref" href="Arrays.html#j<sub>1</sub>:385"><span class="id" title="variable">j<sub>1</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#::Z_scope:x_'-'_x"><span class="id" title="notation">-</span></a><a class="idref" href="Arrays.html#i:384"><span class="id" title="variable">i</span></a> <span class="id" title="notation">&lt;</span> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:387"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;0 <span class="id" title="notation">≤</span> <a class="idref" href="Arrays.html#j<sub>2</sub>:386"><span class="id" title="variable">j<sub>2</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#::Z_scope:x_'-'_x"><span class="id" title="notation">-</span></a><a class="idref" href="Arrays.html#i:384"><span class="id" title="variable">i</span></a> <span class="id" title="notation">&lt;</span> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:387"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#Pivot.val_array_swap"><span class="id" title="definition">val_array_swap</span></a> <a class="idref" href="Arrays.html#p:383"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j<sub>1</sub>:385"><span class="id" title="variable">j<sub>1</sub></span></a> <a class="idref" href="Arrays.html#j<sub>2</sub>:386"><span class="id" title="variable">j<sub>2</sub></span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L:387"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:383"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:384"><span class="id" title="variable">i</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> (<span class="id" title="definition">LibList.update</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">j<sub>2</sub></span><span class="id" title="notation">-</span><span class="id" title="notation">i</span><span class="id" title="notation">)</span>) (<span class="id" title="definition">LibList.nth</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">j<sub>1</sub></span><span class="id" title="notation">-</span><span class="id" title="notation">i</span><span class="id" title="notation">)</span>) <a class="idref" href="Arrays.html#L:387"><span class="id" title="variable">L</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="definition">LibList.update</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">j<sub>1</sub></span><span class="id" title="notation">-</span><span class="id" title="notation">i</span><span class="id" title="notation">)</span>) (<span class="id" title="definition">LibList.nth</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">j<sub>2</sub></span><span class="id" title="notation">-</span><span class="id" title="notation">i</span><span class="id" title="notation">)</span>) <a class="idref" href="Arrays.html#L:387"><span class="id" title="variable">L</span></a>) <a class="idref" href="Arrays.html#L:387"><span class="id" title="variable">L</span></a>)) <a class="idref" href="Arrays.html#p:383"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:384"><span class="id" title="variable">i</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">Hj<sub>1</sub></span> <span class="id" title="var">Hj<sub>2</sub></span>. <span class="id" title="var">xwp</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span> <a class="idref" href="Arrays.html#triple_array_get_hseg"><span class="id" title="axiom">triple_array_get_hseg</span></a>. { <span class="id" title="var">math</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span> <a class="idref" href="Arrays.html#triple_array_get_hseg"><span class="id" title="axiom">triple_array_get_hseg</span></a>. { <span class="id" title="var">math</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span> <a class="idref" href="Arrays.html#triple_array_set_hseg"><span class="id" title="axiom">triple_array_set_hseg</span></a>. { <span class="id" title="var">math</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span> <a class="idref" href="Arrays.html#triple_array_set_hseg"><span class="id" title="axiom">triple_array_set_hseg</span></a>. { <span class="id" title="var">rew_listx</span>. <span class="id" title="var">math</span>. } <span class="id" title="var">xsimpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
We derive a specification for <span class="inlinecode"><span class="id" title="var">swap</span></span> specialized for the case where the
    elements appear in array segments. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Pivot.triple_array_swap_seg_lists" class="idref" href="#Pivot.triple_array_swap_seg_lists"><span class="id" title="lemma">triple_array_swap_seg_lists</span></a> : <span class="id" title="keyword">∀</span> <a id="L<sub>1</sub>:388" class="idref" href="#L<sub>1</sub>:388"><span class="id" title="binder">L<sub>1</sub></span></a> <a id="L<sub>2</sub>:389" class="idref" href="#L<sub>2</sub>:389"><span class="id" title="binder">L<sub>2</sub></span></a> <a id="L<sub>3</sub>:390" class="idref" href="#L<sub>3</sub>:390"><span class="id" title="binder">L<sub>3</sub></span></a> <a id="x:391" class="idref" href="#x:391"><span class="id" title="binder">x</span></a> <a id="y:392" class="idref" href="#y:392"><span class="id" title="binder">y</span></a> <a id="p:393" class="idref" href="#p:393"><span class="id" title="binder">p</span></a> <a id="i:394" class="idref" href="#i:394"><span class="id" title="binder">i</span></a> <a id="j<sub>1</sub>:395" class="idref" href="#j<sub>1</sub>:395"><span class="id" title="binder">j<sub>1</sub></span></a> <a id="j<sub>2</sub>:396" class="idref" href="#j<sub>2</sub>:396"><span class="id" title="binder">j<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#j<sub>1</sub>:395"><span class="id" title="variable">j<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#i:394"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L<sub>1</sub>:388"><span class="id" title="variable">L<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#j<sub>2</sub>:396"><span class="id" title="variable">j<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#i:394"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L<sub>1</sub>:388"><span class="id" title="variable">L<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1 <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L<sub>2</sub>:389"><span class="id" title="variable">L<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#Pivot.val_array_swap"><span class="id" title="definition">val_array_swap</span></a> <a class="idref" href="Arrays.html#p:393"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j<sub>1</sub>:395"><span class="id" title="variable">j<sub>1</sub></span></a> <a class="idref" href="Arrays.html#j<sub>2</sub>:396"><span class="id" title="variable">j<sub>2</sub></span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> (<a class="idref" href="Arrays.html#L<sub>1</sub>:388"><span class="id" title="variable">L<sub>1</sub></span></a> <span class="id" title="notation">++</span> <a class="idref" href="Arrays.html#x:391"><span class="id" title="variable">x</span></a> <span class="id" title="notation">::</span> <a class="idref" href="Arrays.html#L<sub>2</sub>:389"><span class="id" title="variable">L<sub>2</sub></span></a> <span class="id" title="notation">++</span> <a class="idref" href="Arrays.html#y:392"><span class="id" title="variable">y</span></a> <span class="id" title="notation">::</span> <a class="idref" href="Arrays.html#L<sub>3</sub>:390"><span class="id" title="variable">L<sub>3</sub></span></a>) <a class="idref" href="Arrays.html#p:393"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:394"><span class="id" title="variable">i</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> (<a class="idref" href="Arrays.html#L<sub>1</sub>:388"><span class="id" title="variable">L<sub>1</sub></span></a> <span class="id" title="notation">++</span> <a class="idref" href="Arrays.html#y:392"><span class="id" title="variable">y</span></a> <span class="id" title="notation">::</span> <a class="idref" href="Arrays.html#L<sub>2</sub>:389"><span class="id" title="variable">L<sub>2</sub></span></a> <span class="id" title="notation">++</span> <a class="idref" href="Arrays.html#x:391"><span class="id" title="variable">x</span></a> <span class="id" title="notation">::</span> <a class="idref" href="Arrays.html#L<sub>3</sub>:390"><span class="id" title="variable">L<sub>3</sub></span></a>) <a class="idref" href="Arrays.html#p:393"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:394"><span class="id" title="variable">i</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">hint</span> <a class="idref" href="LibSepReference.html#Inhab_val"><span class="id" title="instance">Inhab_val</span></a>. <span class="id" title="var">introv</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="var">xapp</span> <a class="idref" href="Arrays.html#Pivot.triple_array_swap_seg"><span class="id" title="lemma">triple_array_swap_seg</span></a>; <span class="id" title="var">rew_list</span>*.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#HS.himpl_of_eq"><span class="id" title="lemma">himpl_of_eq</span></a>. <span class="id" title="var">fequal</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">math_rewrite</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">j<sub>1</sub></span> <span class="id" title="notation">-</span> <span class="id" title="notation">i</span><span class="id" title="notation">)</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <span class="id" title="var">L<sub>1</sub></span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">math_rewrite</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">j<sub>2</sub></span> <span class="id" title="notation">-</span> <span class="id" title="notation">i</span><span class="id" title="notation">)</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> (<span class="id" title="definition">length</span> <span class="id" title="var">L<sub>1</sub></span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> 1 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="definition">length</span> <span class="id" title="var">L<sub>2</sub></span>)%<span class="id" title="var">nat</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">nth_middle</span>; [|<span class="id" title="var">rew_list</span>*].<br/>
&nbsp;&nbsp;<span class="id" title="var">asserts_rewrite</span> (<span class="id" title="var">L<sub>1</sub></span> <span class="id" title="notation">++</span> <span class="id" title="var">x</span> <span class="id" title="notation">::</span> <span class="id" title="var">L<sub>2</sub></span> <span class="id" title="notation">++</span> <span class="id" title="var">y</span> <span class="id" title="notation">::</span> <span class="id" title="var">L<sub>3</sub></span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="notation">(</span><span class="id" title="var">L<sub>1</sub></span> <span class="id" title="notation">++</span> <span class="id" title="var">x</span> <span class="id" title="notation">::</span> <span class="id" title="var">L<sub>2</sub></span><span class="id" title="notation">)</span> <span class="id" title="notation">++</span> <span class="id" title="var">y</span> <span class="id" title="notation">::</span> <span class="id" title="var">L<sub>3</sub></span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="var">rew_list</span>*. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">nth_middle</span>; [|<span class="id" title="var">rew_list</span>*]. <span class="id" title="var">rew_list</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span>* <span class="id" title="lemma">update_middle</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">asserts_rewrite</span> (<span class="id" title="var">L<sub>1</sub></span> <span class="id" title="notation">&amp;</span> <span class="id" title="var">y</span> <span class="id" title="notation">++</span> <span class="id" title="var">L<sub>2</sub></span> <span class="id" title="notation">++</span> <span class="id" title="var">y</span> <span class="id" title="notation">::</span> <span class="id" title="var">L<sub>3</sub></span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="notation">(</span><span class="id" title="var">L<sub>1</sub></span> <span class="id" title="notation">&amp;</span> <span class="id" title="var">y</span> <span class="id" title="notation">++</span> <span class="id" title="var">L<sub>2</sub></span><span class="id" title="notation">)</span> <span class="id" title="notation">++</span> <span class="id" title="var">y</span> <span class="id" title="notation">::</span> <span class="id" title="var">L<sub>3</sub></span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="var">rew_list</span>*. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span>* <span class="id" title="lemma">update_middle</span>; <span class="id" title="var">rew_list</span>*.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
We also derive a specification for <span class="inlinecode"><span class="id" title="var">swap</span></span> specialized for the case where it
    permutes an element with itself. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Pivot.triple_array_swap_seg_self" class="idref" href="#Pivot.triple_array_swap_seg_self"><span class="id" title="lemma">triple_array_swap_seg_self</span></a> : <span class="id" title="keyword">∀</span> <a id="L:397" class="idref" href="#L:397"><span class="id" title="binder">L</span></a> <a id="p:398" class="idref" href="#p:398"><span class="id" title="binder">p</span></a> <a id="i:399" class="idref" href="#i:399"><span class="id" title="binder">i</span></a> <a id="j<sub>1</sub>:400" class="idref" href="#j<sub>1</sub>:400"><span class="id" title="binder">j<sub>1</sub></span></a> <a id="j<sub>2</sub>:401" class="idref" href="#j<sub>2</sub>:401"><span class="id" title="binder">j<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;0 <span class="id" title="notation">≤</span> <a class="idref" href="Arrays.html#j<sub>1</sub>:400"><span class="id" title="variable">j<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#::Z_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="Arrays.html#i:399"><span class="id" title="variable">i</span></a> <span class="id" title="notation">&lt;</span> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:397"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#j<sub>2</sub>:401"><span class="id" title="variable">j<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#j<sub>1</sub>:400"><span class="id" title="variable">j<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#Pivot.val_array_swap"><span class="id" title="definition">val_array_swap</span></a> <a class="idref" href="Arrays.html#p:398"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#j<sub>1</sub>:400"><span class="id" title="variable">j<sub>1</sub></span></a> <a class="idref" href="Arrays.html#j<sub>2</sub>:401"><span class="id" title="variable">j<sub>2</sub></span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L:397"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:398"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:399"><span class="id" title="variable">i</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> <a class="idref" href="Arrays.html#L:397"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#p:398"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:399"><span class="id" title="variable">i</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">H<sub>1</sub></span> →. <span class="id" title="var">xapp</span>* <a class="idref" href="Arrays.html#Pivot.triple_array_swap_seg"><span class="id" title="lemma">triple_array_swap_seg</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span>* <span class="id" title="lemma">LibList.update_nth_same</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
We are now ready to prove the <span class="inlinecode"><span class="id" title="var">pivot</span></span> function. For the recursion, we need
    to furthermore assert in the postcondition that the pivot value <span class="inlinecode"><span class="id" title="var">x</span></span> is, at
    each recursive call, located at the head of the segment on which the
    recursive call is performed. This property is captured by the additional
    assertion <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">LibList.nth</span></span> <span class="inlinecode">0%<span class="id" title="var">nat</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span>. This assertion was not needed for the
    verification of <span class="inlinecode"><span class="id" title="var">quicksort</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Pivot.triple_pivot'" class="idref" href="#Pivot.triple_pivot'"><span class="id" title="lemma">triple_pivot'</span></a> : <span class="id" title="keyword">∀</span> <a id="n:402" class="idref" href="#n:402"><span class="id" title="binder">n</span></a> <a id="p:403" class="idref" href="#p:403"><span class="id" title="binder">p</span></a> <a id="i:404" class="idref" href="#i:404"><span class="id" title="binder">i</span></a> <a id="L:405" class="idref" href="#L:405"><span class="id" title="binder">L</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#n:402"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L:405"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Arrays.html#n:402"><span class="id" title="variable">n</span></a> <span class="id" title="notation">≥</span> 1 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Arrays.html#Pivot.val_pivot"><span class="id" title="definition">val_pivot</span></a> <a class="idref" href="Arrays.html#p:403"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:404"><span class="id" title="variable">i</span></a> <a class="idref" href="Arrays.html#n:402"><span class="id" title="variable">n</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> (<a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a> <a class="idref" href="Arrays.html#L:405"><span class="id" title="variable">L</span></a>) <a class="idref" href="Arrays.html#p:403"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:404"><span class="id" title="variable">i</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:406" class="idref" href="#r:406"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="j:407" class="idref" href="#j:407"><span class="id" title="binder">j</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Arrays.html#r:406"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Arrays.html#j:407"><span class="id" title="variable">j</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="x:408" class="idref" href="#x:408"><span class="id" title="binder">x</span></a> <a id="L':409" class="idref" href="#L':409"><span class="id" title="binder">L'</span></a> <a id="L<sub>1</sub>:410" class="idref" href="#L<sub>1</sub>:410"><span class="id" title="binder">L<sub>1</sub></span></a> <a id="L<sub>2</sub>:411" class="idref" href="#L<sub>2</sub>:411"><span class="id" title="binder">L<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Arrays.html#hseg"><span class="id" title="definition">hseg</span></a> (<a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a> <a class="idref" href="Arrays.html#L':409"><span class="id" title="variable">L'</span></a>) <a class="idref" href="Arrays.html#p:403"><span class="id" title="variable">p</span></a> <a class="idref" href="Arrays.html#i:404"><span class="id" title="variable">i</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Arrays.html#QuickSort.permut"><span class="id" title="inductive">permut</span></a> <a class="idref" href="Arrays.html#L:405"><span class="id" title="variable">L</span></a> <a class="idref" href="Arrays.html#L':409"><span class="id" title="variable">L'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Arrays.html#x:408"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">LibList.nth</span> 0%<span class="id" title="var">nat</span> <a class="idref" href="Arrays.html#L:405"><span class="id" title="variable">L</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Arrays.html#L':409"><span class="id" title="variable">L'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#L<sub>1</sub>:410"><span class="id" title="variable">L<sub>1</sub></span></a> <span class="id" title="notation">++</span> <a class="idref" href="Arrays.html#x:408"><span class="id" title="variable">x</span></a> <span class="id" title="notation">::</span> <a class="idref" href="Arrays.html#L<sub>2</sub>:411"><span class="id" title="variable">L<sub>2</sub></span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Arrays.html#j:407"><span class="id" title="variable">j</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#::Z_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="Arrays.html#i:404"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Arrays.html#L<sub>1</sub>:410"><span class="id" title="variable">L<sub>1</sub></span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Arrays.html#QuickSort.list_of_le"><span class="id" title="definition">list_of_le</span></a> <a class="idref" href="Arrays.html#x:408"><span class="id" title="variable">x</span></a> <a class="idref" href="Arrays.html#L<sub>1</sub>:410"><span class="id" title="variable">L<sub>1</sub></span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Arrays.html#QuickSort.list_of_gt"><span class="id" title="definition">list_of_gt</span></a> <a class="idref" href="Arrays.html#x:408"><span class="id" title="variable">x</span></a> <a class="idref" href="Arrays.html#L<sub>2</sub>:411"><span class="id" title="variable">L<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span>. <span class="id" title="var">induction_wf</span> <span class="id" title="var">IH</span>: (<span class="id" title="definition">downto</span> 0) <span class="id" title="var">n</span>; <span class="id" title="var">introv</span> <span class="id" title="var">HL</span> <span class="id" title="var">Hn</span>. <span class="id" title="var">xwp</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span>. <span class="id" title="var">xif</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">C</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xval</span>. <span class="id" title="var">xsimpl</span> (<span class="id" title="notation">&gt;&gt;</span> <span class="id" title="var">i</span> <span class="id" title="notation">(</span><span class="id" title="definition">LibList.nth</span> 0%<span class="id" title="var">nat</span> <span class="id" title="var">L</span><span class="id" title="notation">)</span> <span class="id" title="var">L</span> <span class="id" title="notation">(</span>@<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <span class="id" title="notation">int</span><span class="id" title="notation">)</span> <span class="id" title="notation">(</span>@<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <span class="id" title="notation">int</span><span class="id" title="notation">)</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> <span class="id" title="var">L</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">x</span> [|]]; <span class="id" title="var">rew_list</span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">try</span> (<span class="id" title="var">false</span>; <span class="id" title="var">math</span>). <span class="id" title="var">splits</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Arrays.html#QuickSort.permut_refl"><span class="id" title="lemma">permut_refl</span></a>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">rew_listx</span>*. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">rew_listx</span>*. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">math</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <span class="id" title="constructor">Forall_nil</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <span class="id" title="constructor">Forall_nil</span>. } } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xapp</span>* <a class="idref" href="Arrays.html#Pivot.triple_array_get_hseg_vals_int"><span class="id" title="lemma">triple_array_get_hseg_vals_int</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xapp</span>. <span class="id" title="var">xapp</span>* <a class="idref" href="Arrays.html#Pivot.triple_array_get_hseg_vals_int"><span class="id" title="lemma">triple_array_get_hseg_vals_int</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xapp</span>. <span class="id" title="var">xapp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">math_rewrite</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">i</span> <span class="id" title="notation">-</span> <span class="id" title="notation">i</span><span class="id" title="notation">)</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 0%<span class="id" title="var">nat</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">math_rewrite</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">i</span> <span class="id" title="notation">+</span> <span class="id" title="notation">1</span> <span class="id" title="notation">-</span> <span class="id" title="notation">i</span><span class="id" title="notation">)</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 1%<span class="id" title="var">nat</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lets</span>* (<span class="id" title="var">x</span>&amp;<span class="id" title="var">L'</span>&amp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>): <span class="id" title="lemma">length_pos_inv_cons</span> <span class="id" title="var">L</span>. <span class="id" title="var">rew_list</span> <span class="id" title="keyword">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lets</span>* (<span class="id" title="var">y</span>&amp;<span class="id" title="var">L''</span>&amp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>): <span class="id" title="lemma">length_pos_inv_cons</span> <span class="id" title="var">L'</span>. <span class="id" title="var">rew_listx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xif</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">C'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">xapp</span> (<span class="id" title="notation">&gt;&gt;</span> <a class="idref" href="Arrays.html#Pivot.triple_array_swap_seg_lists"><span class="id" title="lemma">triple_array_swap_seg_lists</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(</span>@<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">(</span>@<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">(</span><a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a> <span class="id" title="var">L''</span><span class="id" title="notation">)</span>); <span class="id" title="var">rew_list</span>*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xchange</span> <a class="idref" href="Arrays.html#hseg_cons"><span class="id" title="lemma">hseg_cons</span></a>. <span class="id" title="var">rew_list</span> <span class="id" title="keyword">in</span> *. <span class="id" title="var">xapp</span> (<span class="id" title="notation">&gt;&gt;</span> <span class="id" title="var">IH</span> <span class="id" title="notation">(</span><span class="id" title="var">x</span><span class="id" title="notation">::</span><span class="id" title="var">L''</span><span class="id" title="notation">)</span>); <span class="id" title="var">rew_list</span>*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">j'</span> <span class="id" title="var">x'</span> <span class="id" title="var">L'</span> <span class="id" title="var">L<sub>1</sub>'</span> <span class="id" title="var">L<sub>2</sub>'</span> (<span class="id" title="var">HP</span>&amp;<span class="id" title="var">Hx</span>&amp;<span class="id" title="var">HE</span>&amp;<span class="id" title="var">Hji</span>&amp;<span class="id" title="var">Hle</span>&amp;<span class="id" title="var">Hgt</span>). <span class="id" title="var">rew_listx</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hx</span>. <span class="id" title="tactic">subst</span> <span class="id" title="var">x'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xchange</span> &lt;- <a class="idref" href="Arrays.html#hseg_cons"><span class="id" title="lemma">hseg_cons</span></a>. <span class="id" title="var">xsimpl</span>* (<span class="id" title="notation">&gt;&gt;</span> <span class="id" title="var">j'</span> <span class="id" title="var">x</span> <span class="id" title="notation">(</span><span class="id" title="var">y</span><span class="id" title="notation">::</span><span class="id" title="var">L'</span><span class="id" title="notation">)</span> <span class="id" title="notation">(</span><span class="id" title="var">y</span><span class="id" title="notation">::</span><span class="id" title="var">L<sub>1</sub>'</span><span class="id" title="notation">)</span> <span class="id" title="var">L<sub>2</sub>'</span>). <span class="id" title="var">splits</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">subst</span> <span class="id" title="var">L'</span>. <span class="id" title="var">applys</span> <a class="idref" href="Arrays.html#QuickSort.permut_trans"><span class="id" title="constructor">permut_trans</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="Arrays.html#QuickSort.permut_swap_first_two"><span class="id" title="lemma">permut_swap_first_two</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">applys</span>* <a class="idref" href="Arrays.html#QuickSort.permut_cons"><span class="id" title="lemma">permut_cons</span></a>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">subst</span> <span class="id" title="var">L'</span>. <span class="id" title="var">rew_list</span>*. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">subst</span> <span class="id" title="var">L'</span>. <span class="id" title="var">rew_list</span>*. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">rew_list</span>*. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span>* <span class="id" title="constructor">Forall_cons</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">auto</span>. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">xapp</span>. <span class="id" title="var">tests</span> <span class="id" title="var">Cend</span>: (<span class="id" title="var">L''</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">rew_listx</span> <span class="id" title="keyword">in</span> *. <span class="id" title="var">xapp</span> <a class="idref" href="Arrays.html#Pivot.triple_array_swap_seg_self"><span class="id" title="lemma">triple_array_swap_seg_self</span></a>; <span class="id" title="var">rew_list</span>*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">change</span> (<a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <span class="id" title="var">x</span><span class="id" title="notation">::</span><a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <span class="id" title="var">y</span><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>) <span class="id" title="keyword">with</span> (<span class="id" title="notation">(</span><a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <span class="id" title="var">x</span><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">&amp;</span> <a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <span class="id" title="var">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xchange</span> <a class="idref" href="Arrays.html#hseg_last"><span class="id" title="lemma">hseg_last</span></a>. <span class="id" title="var">xapp</span> (<span class="id" title="notation">&gt;&gt;</span> <span class="id" title="var">IH</span> <span class="id" title="notation">(</span><span class="id" title="var">x</span><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a><span class="id" title="notation">)</span>); <span class="id" title="var">rew_list</span>*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">j'</span> <span class="id" title="var">L'</span> <span class="id" title="var">x'</span> <span class="id" title="var">L<sub>1</sub>'</span> <span class="id" title="var">L<sub>2</sub>'</span> (<span class="id" title="var">HP</span>&amp;<span class="id" title="var">Hx</span>&amp;<span class="id" title="var">HE</span>&amp;<span class="id" title="var">Hji</span>&amp;<span class="id" title="var">Hle</span>&amp;<span class="id" title="var">Hgt</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lets</span> <span class="id" title="var">HEQ</span>: <a class="idref" href="Arrays.html#QuickSort.permut_length"><span class="id" title="lemma">permut_length</span></a> <span class="id" title="var">HP</span>. <span class="id" title="tactic">subst</span> <span class="id" title="var">L'</span>. <span class="id" title="tactic">subst</span> <span class="id" title="var">x'</span>. <span class="id" title="var">rew_list</span> <span class="id" title="keyword">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">asserts</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>: (<span class="id" title="var">L<sub>1</sub>'</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>). <span class="id" title="var">applys</span>* <span class="id" title="lemma">length_zero_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">asserts</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>: (<span class="id" title="var">L<sub>2</sub>'</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>). <span class="id" title="var">applys</span>* <span class="id" title="lemma">length_zero_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xchange</span> <a class="idref" href="Arrays.html#hseg_last_r"><span class="id" title="lemma">hseg_last_r</span></a>. { <span class="id" title="var">rew_listx</span>. <span class="id" title="var">math</span>. } <span class="id" title="var">rew_listx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xsimpl</span>* (<span class="id" title="notation">&gt;&gt;</span> <span class="id" title="var">j'</span> <span class="id" title="var">x</span> <span class="id" title="notation">(</span><span class="id" title="var">x</span><span class="id" title="notation">::</span><span class="id" title="var">y</span><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">(</span>@<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <span class="id" title="notation">int</span><span class="id" title="notation">)</span> <span class="id" title="notation">(</span><span class="id" title="var">y</span><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a><span class="id" title="notation">)</span>); <span class="id" title="var">rew_listx</span>. <span class="id" title="var">splits</span>*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Arrays.html#QuickSort.permut_refl"><span class="id" title="lemma">permut_refl</span></a>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span>* <span class="id" title="constructor">Forall_cons</span>. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">lets</span>* (<span class="id" title="var">z</span>&amp;<span class="id" title="var">L'''</span>&amp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>): <span class="id" title="lemma">list_neq_nil_inv_last</span> <span class="id" title="var">L''</span>. <span class="id" title="var">rew_listx</span> <span class="id" title="keyword">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xapp</span> (<span class="id" title="notation">&gt;&gt;</span> <a class="idref" href="Arrays.html#Pivot.triple_array_swap_seg_lists"><span class="id" title="lemma">triple_array_swap_seg_lists</span></a> <span class="id" title="notation">(</span><a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <span class="id" title="var">x</span> <span class="id" title="notation">::</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a><span class="id" title="notation">)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(</span><a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a> <span class="id" title="var">L'''</span><span class="id" title="notation">)</span> <span class="id" title="notation">(</span>@<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><span class="id" title="notation">)</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span>); <span class="id" title="var">rew_list</span>*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <span class="id" title="var">x</span> <span class="id" title="notation">::</span> <a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <span class="id" title="var">z</span> <span class="id" title="notation">::</span> <a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a> <span class="id" title="var">L'''</span> <span class="id" title="notation">&amp;</span> <a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <span class="id" title="var">y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> (<span class="id" title="notation">(</span><a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <span class="id" title="var">x</span> <span class="id" title="notation">::</span> <a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <span class="id" title="var">z</span> <span class="id" title="notation">::</span> <a class="idref" href="Arrays.html#QuickSort.vals_int"><span class="id" title="definition">vals_int</span></a> <span class="id" title="var">L'''</span><span class="id" title="notation">)</span> <span class="id" title="notation">&amp;</span> <a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <span class="id" title="var">y</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id" title="var">rew_list</span>*].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xchange</span> <a class="idref" href="Arrays.html#hseg_last"><span class="id" title="lemma">hseg_last</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xapp</span> (<span class="id" title="notation">&gt;&gt;</span> <span class="id" title="var">IH</span> <span class="id" title="notation">(</span><span class="id" title="var">x</span><span class="id" title="notation">::</span><span class="id" title="var">z</span><span class="id" title="notation">::</span><span class="id" title="var">L'''</span><span class="id" title="notation">)</span>); <span class="id" title="var">rew_list</span>*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">j'</span> <span class="id" title="var">x'</span> <span class="id" title="var">L'</span> <span class="id" title="var">L<sub>1</sub>'</span> <span class="id" title="var">L<sub>2</sub>'</span> (<span class="id" title="var">HP</span>&amp;<span class="id" title="var">Hx</span>&amp;<span class="id" title="var">HE</span>&amp;<span class="id" title="var">Hji</span>&amp;<span class="id" title="var">Hle</span>&amp;<span class="id" title="var">Hgt</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lets</span> <span class="id" title="var">HEQ</span>: <a class="idref" href="Arrays.html#QuickSort.permut_length"><span class="id" title="lemma">permut_length</span></a> <span class="id" title="var">HP</span>. <span class="id" title="var">rew_listx</span> <span class="id" title="keyword">in</span> *. <span class="id" title="tactic">subst</span> <span class="id" title="var">x'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xchange</span> <a class="idref" href="Arrays.html#hseg_last_r"><span class="id" title="lemma">hseg_last_r</span></a>. { <span class="id" title="var">rew_list</span>*. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xsimpl</span>* (<span class="id" title="notation">&gt;&gt;</span> <span class="id" title="var">j'</span> <span class="id" title="var">x</span> <span class="id" title="notation">(</span><span class="id" title="var">L<sub>1</sub>'</span> <span class="id" title="notation">++</span> <span class="id" title="var">x</span> <span class="id" title="notation">::</span> <span class="id" title="var">L<sub>2</sub>'</span> <span class="id" title="notation">&amp;</span> <span class="id" title="var">y</span><span class="id" title="notation">)</span> <span class="id" title="var">L<sub>1</sub>'</span> <span class="id" title="notation">(</span><span class="id" title="var">L<sub>2</sub>'</span><span class="id" title="notation">&amp;</span><span class="id" title="var">y</span><span class="id" title="notation">)</span>). <span class="id" title="var">splits</span>*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">subst</span> <span class="id" title="var">L'</span>. <span class="id" title="var">applys</span> <a class="idref" href="Arrays.html#QuickSort.permut_trans"><span class="id" title="constructor">permut_trans</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="Arrays.html#QuickSort.permut_swap_first_two"><span class="id" title="lemma">permut_swap_first_two</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="Arrays.html#QuickSort.permut_trans"><span class="id" title="constructor">permut_trans</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="Arrays.html#QuickSort.permut_swap_first_last"><span class="id" title="lemma">permut_swap_first_last</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">asserts_rewrite</span> (<span class="id" title="var">L<sub>1</sub>'</span> <span class="id" title="notation">++</span> <span class="id" title="var">x</span> <span class="id" title="notation">::</span> <span class="id" title="var">L<sub>2</sub>'</span> <span class="id" title="notation">&amp;</span> <span class="id" title="var">y</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="notation">(</span><span class="id" title="var">L<sub>1</sub>'</span> <span class="id" title="notation">++</span> <span class="id" title="var">x</span> <span class="id" title="notation">::</span> <span class="id" title="var">L<sub>2</sub>'</span><span class="id" title="notation">)</span> <span class="id" title="notation">&amp;</span> <span class="id" title="var">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">rew_list</span>*. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="Arrays.html#QuickSort.permut_last"><span class="id" title="lemma">permut_last</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="Arrays.html#QuickSort.permut_trans"><span class="id" title="constructor">permut_trans</span></a> <span class="id" title="var">HP</span>. <span class="id" title="var">applys</span> <a class="idref" href="Arrays.html#QuickSort.permut_cons"><span class="id" title="lemma">permut_cons</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="Arrays.html#QuickSort.permut_sym"><span class="id" title="lemma">permut_sym</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="Arrays.html#QuickSort.permut_swap_first_last"><span class="id" title="lemma">permut_swap_first_last</span></a>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">subst</span> <span class="id" title="var">L'</span>. <span class="id" title="var">applys</span>* <span class="id" title="lemma">Forall_last</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">subst</span> <span class="id" title="var">L'</span>. <span class="id" title="var">rew_listx</span>*. } } } }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
As mentioned earlier, the proof is longer than we would like it to be. (It
    would be much simpler in the CFML tool, where invariants need not mention
    the <span class="inlinecode"><span class="id" title="var">vals_int</span></span> conversion function.) 
</div>
<div class="code">

<span class="id" title="keyword">End</span> <a class="idref" href="Arrays.html#Pivot"><span class="id" title="module">Pivot</span></a>.<br/><hr class='doublespaceincode'/>
<span class="comment">(*&nbsp;2024-12-24&nbsp;15:18&nbsp;*)</span><br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>