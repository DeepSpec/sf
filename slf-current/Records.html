<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>Records: Reasoning about Records</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/slf.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 6: Separation Logic Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">Records<span class="subtitle">Reasoning about Records</span></h1>


<div class="code">

<span class="id" title="keyword">Set Implicit Arguments</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">SLF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="LibSepReference.html#"><span class="id" title="library">LibSepReference</span></a> <span class="id" title="library">LibSepTLCbuffer</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">SLF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Arrays.html#"><span class="id" title="library">Arrays</span></a>. <span class="id" title="keyword">Import</span> <a class="idref" href="Arrays.html#Realization"><span class="id" title="module">Realization</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">P</span> : <span class="id" title="keyword">Prop</span>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">H</span> : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">Q</span> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span> : <a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">k</span> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">i</span> : <span class="id" title="notation">int</span>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">n</span> <span class="id" title="var">z</span> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">v</span> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">L</span> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
</div>

<div class="doc">
<a id="lab454"></a><h1 class="section">First Pass</h1>

<div class="paragraph"> </div>

 This chapter explains how to specify operations on ML-style records in
    Separation Logic. In ML-like languages, a record is an allocated object
    whose header field stores the number of fields of the record. Concretely,
    each field is stored at a specific offset relative to the header. For
    example, consider a mutable list cell allocated at location <span class="inlinecode"><span class="id" title="var">p</span></span>. It is
    represented in memory as:

<div class="paragraph"> </div>

<ul class="doclist">
<li> a header at location <span class="inlinecode"><span class="id" title="var">p</span></span>, storing the number of fields, that is, the value
      <span class="inlinecode">2</span>;

</li>
<li> a cell at location <span class="inlinecode"><span class="id" title="var">p</span>+1</span>, storing the contents of the head field,

</li>
<li> a cell at location <span class="inlinecode"><span class="id" title="var">p</span>+2</span>, storing the contents of the tail field.

</li>
</ul>

<div class="paragraph"> </div>

    Thus, at a low level, such a record can be represented by the heap
    predicate: <span class="inlinecode">(<span class="id" title="var">hheader</span></span> <span class="inlinecode">2</span> <span class="inlinecode"><span class="id" title="var">p</span>)</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode">((<span class="id" title="var">p</span>+1)</span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">x</span>)</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode">((<span class="id" title="var">p</span>+2)</span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">q</span>)</span>. To avoid
    exposing pointer arithmetic to the end user, we introduce the predicate
    <span class="inlinecode"><span class="id" title="var">hfield</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span>, written <span class="inlinecode"><span class="id" title="var">p</span>`.<span class="id" title="var">k</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">v</span></span>, to describe the contents of the field
    named <span class="inlinecode"><span class="id" title="var">k</span></span> of the record at location <span class="inlinecode"><span class="id" title="var">p</span></span>.

<div class="paragraph"> </div>

    The chapter starts by presenting the representation predicate <span class="inlinecode"><span class="id" title="var">hfield</span></span>, as
    well as a higher-level predicate named <span class="inlinecode"><span class="id" title="var">hrecord</span></span> for describing all fields
    at once. The second part of the chapter presents the specification of access
    and allocation operations. The last part explains how to implement and
    verify these operations using block allocation and pointer arithmetic. 
</div>

<div class="doc">
<a id="lab455"></a><h2 class="section">Representation of Individual Record Fields</h2>

<div class="paragraph"> </div>

 Let us assume that each field name corresponds to a nonnegative offset. Let
    <span class="inlinecode"><span class="id" title="tactic">field</span></span> denote the type of field names, an alias for <span class="inlinecode"><span class="id" title="var">nat</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="field" class="idref" href="#field"><span class="id" title="definition">field</span></a> : <span class="id" title="keyword">Type</span> := <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>.<br/>
</div>

<div class="doc">
The predicate <span class="inlinecode"><span class="id" title="var">hfield</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span>, written <span class="inlinecode"><span class="id" title="var">p</span>`.<span class="id" title="var">k</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">v</span></span>, asserts that the field
    <span class="inlinecode"><span class="id" title="var">k</span></span> of the record <span class="inlinecode"><span class="id" title="var">p</span></span> stores the value <span class="inlinecode"><span class="id" title="var">v</span></span>. This predicate is presented as
    an abstract predicate to the end user. Internally, it may be defined using
    pointer arithmetic. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="hfield" class="idref" href="#hfield"><span class="id" title="definition">hfield</span></a> (<a id="p:1" class="idref" href="#p:1"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) (<a id="k:2" class="idref" href="#k:2"><span class="id" title="binder">k</span></a>:<a class="idref" href="Records.html#field"><span class="id" title="definition">field</span></a>) (<a id="v:3" class="idref" href="#v:3"><span class="id" title="binder">v</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;(<a class="idref" href="Records.html#p:1"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a><a class="idref" href="Records.html#k:2"><span class="id" title="variable">k</span></a>)%<span class="id" title="var">nat</span> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Records.html#v:3"><span class="id" title="variable">v</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Global Opaque</span> <a class="idref" href="Records.html#hfield"><span class="id" title="definition">hfield</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <a id="75d25f73dacdf76a5f84e31928dc7807" class="idref" href="#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">&quot;</span></a>p `. k '~~&gt;' v" := (<a class="idref" href="Records.html#hfield"><span class="id" title="definition">hfield</span></a> <span class="id" title="var">p</span> <span class="id" title="var">k</span> <span class="id" title="var">v</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 32, <span class="id" title="var">k</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">format</span> "p `. k  '~~&gt;'  v").<br/>
</div>

<div class="doc">
Writing <span class="inlinecode">(<span class="id" title="var">hheader</span></span> <span class="inlinecode">2</span> <span class="inlinecode"><span class="id" title="var">p</span>)</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode">(<span class="id" title="var">p</span>`.<span class="id" title="var">head</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">x</span>)</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode">(<span class="id" title="var">p</span>`.<span class="id" title="var">tail</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">q</span>)</span> to describe a
    list cell record is fairly verbose and cumbersome to manipulate. To improve
    the situation, we introduce a generic representation predicate for records.
    This predicate allows us to describe the same list cell much more concisely
    as <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~~&gt;`{</span> <span class="inlinecode"><span class="id" title="var">head</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">x</span>;</span> <span class="inlinecode"><span class="id" title="var">tail</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">q</span></span> <span class="inlinecode">}</span>.

<div class="paragraph"> </div>

    It what follows, we show how to implement this notation by introducing the
    heap predicates <span class="inlinecode"><span class="id" title="var">hfields</span></span> and <span class="inlinecode"><span class="id" title="var">hrecords</span></span>. These predicates will be used for
    stating both small-footprint and large-footprint specifications for record
    operations. 
</div>

<div class="doc">
<a id="lab456"></a><h2 class="section">Representation of Sets of Fields</h2>

<div class="paragraph"> </div>

 A record field is described as the pair of a field and a value stored in
    this field. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="hrecord_field" class="idref" href="#hrecord_field"><span class="id" title="definition">hrecord_field</span></a> : <span class="id" title="keyword">Type</span> := (<a class="idref" href="Records.html#field"><span class="id" title="definition">field</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">*</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>).<br/>
</div>

<div class="doc">
A record is described as a list of fields. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="hrecord_fields" class="idref" href="#hrecord_fields"><span class="id" title="definition">hrecord_fields</span></a> : <span class="id" title="keyword">Type</span> := <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Records.html#hrecord_field"><span class="id" title="definition">hrecord_field</span></a>.<br/>
</div>

<div class="doc">
We let the meta-variable <span class="inlinecode"><span class="id" title="var">kvs</span></span> range over such lists. 
</div>
<div class="code">

<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">kvs</span> : <a class="idref" href="Records.html#hrecord_fields"><span class="id" title="definition">hrecord_fields</span></a>.<br/>
</div>

<div class="doc">
The heap predicate <span class="inlinecode"><span class="id" title="var">hfields</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> asserts that, at location <span class="inlinecode"><span class="id" title="var">p</span></span>, one finds
    the representation of the fields described by the list <span class="inlinecode"><span class="id" title="var">kvs</span></span>. The predicate
    <span class="inlinecode"><span class="id" title="var">hfields</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> is defined recursively on the list <span class="inlinecode"><span class="id" title="var">kvs</span></span>. If <span class="inlinecode"><span class="id" title="var">kvs</span></span> is empty,
    the predicate describes the empty heap predicate. Otherwise, <span class="inlinecode"><span class="id" title="var">kvs</span></span>
    decomposes as a head <span class="inlinecode">(<span class="id" title="var">k</span>,<span class="id" title="var">v</span>)</span> and a tail <span class="inlinecode"><span class="id" title="var">kvs'</span></span>. The predicate <span class="inlinecode"><span class="id" title="var">p</span>`.<span class="id" title="var">k</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">v</span></span>
    describes the field at offset <span class="inlinecode"><span class="id" title="var">k</span></span>, with contents <span class="inlinecode"><span class="id" title="var">v</span></span>. The predicate
    <span class="inlinecode"><span class="id" title="var">hfields</span></span> <span class="inlinecode"><span class="id" title="var">kvs'</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> describes the remaining fields. 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <a id="hfields" class="idref" href="#hfields"><span class="id" title="definition">hfields</span></a> (<a id="kvs:4" class="idref" href="#kvs:4"><span class="id" title="binder">kvs</span></a>:<a class="idref" href="Records.html#hrecord_fields"><span class="id" title="definition">hrecord_fields</span></a>) (<a id="p:5" class="idref" href="#p:5"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Records.html#kvs:4"><span class="id" title="variable">kvs</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> ⇒ <a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">v</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><span class="id" title="var">kvs'</span> ⇒ <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#p:5"><span class="id" title="variable">p</span></a><a class="idref" href="Records.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">`.</span></a><span class="id" title="var">k</span> <a class="idref" href="Records.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">~~&gt;</span></a> <span class="id" title="var">v</span><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#hfields:6"><span class="id" title="definition">hfields</span></a> <span class="id" title="var">kvs'</span> <a class="idref" href="Records.html#p:5"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
A list cell with head field <span class="inlinecode"><span class="id" title="var">x</span></span> and tail field <span class="inlinecode"><span class="id" title="var">q</span></span> is represented by the
    list <span class="inlinecode">(<span class="id" title="var">head</span>,<span class="id" title="var">x</span>)::(<span class="id" title="var">tail</span>,<span class="id" title="var">q</span>)::<span class="id" title="var">nil</span></span>. To support the syntax
    <span class="inlinecode">`{</span> <span class="inlinecode"><span class="id" title="var">head</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">x</span>;</span> <span class="inlinecode"><span class="id" title="var">tail</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">q</span></span> <span class="inlinecode">}</span>, we introduce the following notation. For
    technical reasons associated with coercions, we need to separately define
    notation for parsing, where a cast to the type <span class="inlinecode"><span class="id" title="var">val</span></span> is included, from
    notation for printing, where such a cast is not included. 
</div>
<div class="code">

<span class="id" title="keyword">Notation</span> <a id="31d448c3336e330e3a6d124a266f88b<sub>1</sub>" class="idref" href="#31d448c3336e330e3a6d124a266f88b<sub>1</sub>"><span class="id" title="notation">&quot;</span></a>`{ k<sub>1</sub> := v<sub>1</sub> }" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k<sub>1</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,(</span></a><span class="id" title="var">v<sub>1</sub></span>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">))</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">k<sub>1</sub></span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">only</span> <span class="id" title="var">parsing</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <a id="37128e1fb6646967e25a94496c592b<sub>58</sub>" class="idref" href="#37128e1fb6646967e25a94496c592b<sub>58</sub>"><span class="id" title="notation">&quot;</span></a>`{ k<sub>1</sub> := v<sub>1</sub> ; k<sub>2</sub> := v<sub>2</sub> }" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k<sub>1</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,(</span></a><span class="id" title="var">v<sub>1</sub></span>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">))</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k<sub>2</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,(</span></a><span class="id" title="var">v<sub>2</sub></span>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">))</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">k<sub>1</sub></span>, <span class="id" title="var">k<sub>2</sub></span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">only</span> <span class="id" title="var">parsing</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <a id="5a19cedf746e143a1d13090de2b5e61a" class="idref" href="#5a19cedf746e143a1d13090de2b5e61a"><span class="id" title="notation">&quot;</span></a>`{ k<sub>1</sub> := v<sub>1</sub> ; k<sub>2</sub> := v<sub>2</sub> ; k<sub>3</sub> := v<sub>3</sub> }" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k<sub>1</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,(</span></a><span class="id" title="var">v<sub>1</sub></span>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">))</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k<sub>2</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,(</span></a><span class="id" title="var">v<sub>2</sub></span>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">))</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k<sub>3</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,(</span></a><span class="id" title="var">v<sub>3</sub></span>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">))</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">k<sub>1</sub></span>, <span class="id" title="var">k<sub>2</sub></span>, <span class="id" title="var">k<sub>3</sub></span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">only</span> <span class="id" title="var">parsing</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <a id="31d448c3336e330e3a6d124a266f88b<sub>1</sub>" class="idref" href="#31d448c3336e330e3a6d124a266f88b<sub>1</sub>"><span class="id" title="notation">&quot;</span></a>`{ k<sub>1</sub> := v<sub>1</sub> }" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k<sub>1</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">v<sub>1</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">k<sub>1</sub></span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">only</span> <span class="id" title="var">printing</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <a id="37128e1fb6646967e25a94496c592b<sub>58</sub>" class="idref" href="#37128e1fb6646967e25a94496c592b<sub>58</sub>"><span class="id" title="notation">&quot;</span></a>`{ k<sub>1</sub> := v<sub>1</sub> ; k<sub>2</sub> := v<sub>2</sub> }" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k<sub>1</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">v<sub>1</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k<sub>2</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">v<sub>2</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">k<sub>1</sub></span>, <span class="id" title="var">k<sub>2</sub></span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">only</span> <span class="id" title="var">printing</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <a id="5a19cedf746e143a1d13090de2b5e61a" class="idref" href="#5a19cedf746e143a1d13090de2b5e61a"><span class="id" title="notation">&quot;</span></a>`{ k<sub>1</sub> := v<sub>1</sub> ; k<sub>2</sub> := v<sub>2</sub> ; k<sub>3</sub> := v<sub>3</sub> }" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k<sub>1</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">v<sub>1</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k<sub>2</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">v<sub>2</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k<sub>3</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">v<sub>3</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">k<sub>1</sub></span>, <span class="id" title="var">k<sub>2</sub></span>, <span class="id" title="var">k<sub>3</sub></span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">only</span> <span class="id" title="var">printing</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">val_scope</span>.<br/>
</div>

<div class="doc">
<a id="lab457"></a><h2 class="section">Representation of Records</h2>

<div class="paragraph"> </div>

 The heap predicate <span class="inlinecode"><span class="id" title="var">hrecord</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> describes a record by covering not just
    all the fields of the record but also the header. The cells are described by
    <span class="inlinecode"><span class="id" title="var">hfields</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>, and the header is described by <span class="inlinecode"><span class="id" title="var">hheader</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>, where <span class="inlinecode"><span class="id" title="var">n</span></span>
    should be such that the keys in the list <span class="inlinecode"><span class="id" title="var">kvs</span></span> are between <span class="inlinecode">0</span> inclusive and
    <span class="inlinecode"><span class="id" title="var">n</span></span> exclusive.

<div class="paragraph"> </div>

    A permissive definition of <span class="inlinecode"><span class="id" title="var">hrecord</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> would allow the fields from the
    list <span class="inlinecode"><span class="id" title="var">kvs</span></span> to be permuted arbitrarily. However, to avoid complications
    related to permutations, we make in this course the simplifying assumptions
    that fields are always listed in the order of their offsets.

<div class="paragraph"> </div>

    The auxiliary predicate <span class="inlinecode"><span class="id" title="var">maps_all_fields</span></span> <span class="inlinecode"><span class="id" title="var">z</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> asserts that the keys from
    the association list <span class="inlinecode"><span class="id" title="var">kvs</span></span> correspond exactly to the sequence made of the
    first <span class="inlinecode"><span class="id" title="var">n</span></span> natural numbers, that is, <span class="inlinecode">0;</span> <span class="inlinecode">1;</span> <span class="inlinecode">...;</span> <span class="inlinecode"><span class="id" title="var">n</span>-1</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="maps_all_fields" class="idref" href="#maps_all_fields"><span class="id" title="definition">maps_all_fields</span></a> (<a id="n:8" class="idref" href="#n:8"><span class="id" title="binder">n</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="kvs:9" class="idref" href="#kvs:9"><span class="id" title="binder">kvs</span></a>:<a class="idref" href="Records.html#hrecord_fields"><span class="id" title="definition">hrecord_fields</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="definition">LibList.map</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <a class="idref" href="Records.html#kvs:9"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">nat_seq</span> 0 <a class="idref" href="Records.html#n:8"><span class="id" title="variable">n</span></a>.<br/>
</div>

<div class="doc">
The predicate <span class="inlinecode"><span class="id" title="var">hrecord</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> exploits <span class="inlinecode"><span class="id" title="var">maps_all_fields</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> to relate the
    value <span class="inlinecode"><span class="id" title="var">n</span></span> stored in the header with the association list <span class="inlinecode"><span class="id" title="var">kvs</span></span> that
    describes the contents of the fields. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="hrecord" class="idref" href="#hrecord"><span class="id" title="definition">hrecord</span></a> (<a id="kvs:10" class="idref" href="#kvs:10"><span class="id" title="binder">kvs</span></a>:<a class="idref" href="Records.html#hrecord_fields"><span class="id" title="definition">hrecord_fields</span></a>) (<a id="p:11" class="idref" href="#p:11"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="n:12" class="idref" href="#n:12"><span class="id" title="binder">n</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Arrays.html#Realization.hheader"><span class="id" title="definition">hheader</span></a> <a class="idref" href="Records.html#n:12"><span class="id" title="variable">n</span></a> <a class="idref" href="Records.html#p:11"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Records.html#hfields"><span class="id" title="definition">hfields</span></a> <a class="idref" href="Records.html#kvs:10"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Records.html#p:11"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Records.html#maps_all_fields"><span class="id" title="definition">maps_all_fields</span></a> <a class="idref" href="Records.html#n:12"><span class="id" title="variable">n</span></a> <a class="idref" href="Records.html#kvs:10"><span class="id" title="variable">kvs</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>.<br/>
</div>

<div class="doc">
We introduce the notation <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~~&gt;</span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> for <span class="inlinecode"><span class="id" title="var">hrecord</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>, allowing to
    write, e.g., <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~~&gt;`{</span> <span class="inlinecode"><span class="id" title="var">head</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">x</span>;</span> <span class="inlinecode"><span class="id" title="var">tail</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">q</span></span> <span class="inlinecode">}</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Notation</span> <a id="4fdf8be3226dc6822dfa0caeb9414d<sub>46</sub>" class="idref" href="#4fdf8be3226dc6822dfa0caeb9414d<sub>46</sub>"><span class="id" title="notation">&quot;</span></a>p '~~~&gt;' kvs" := (<a class="idref" href="Records.html#hrecord"><span class="id" title="definition">hrecord</span></a> <span class="id" title="var">kvs</span> <span class="id" title="var">p</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 32).<br/>
</div>

<div class="doc">
The following lemma may be used to convert a concrete <span class="inlinecode"><span class="id" title="var">hrecord</span></span> predicate
    into a <span class="inlinecode"><span class="id" title="var">hheader</span></span> and a conjunction of <span class="inlinecode"><span class="id" title="var">hfield</span></span> predicates. In the statement
    below, <span class="inlinecode"><span class="id" title="var">LibListExec.length</span></span> is a variant of <span class="inlinecode"><span class="id" title="var">LibList.length</span></span> that computes
    in Coq using <span class="inlinecode"><span class="id" title="tactic">simpl</span></span> or <span class="inlinecode"><span class="id" title="tactic">reflexivity</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="hrecord_elim" class="idref" href="#hrecord_elim"><span class="id" title="lemma">hrecord_elim</span></a> : <span class="id" title="keyword">∀</span> <a id="p:13" class="idref" href="#p:13"><span class="id" title="binder">p</span></a> <a id="kvs:14" class="idref" href="#kvs:14"><span class="id" title="binder">kvs</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#hrecord"><span class="id" title="definition">hrecord</span></a> <a class="idref" href="Records.html#kvs:14"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Records.html#p:13"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Arrays.html#Realization.hheader"><span class="id" title="definition">hheader</span></a> (<span class="id" title="definition">LibListExec.length</span> <a class="idref" href="Records.html#kvs:14"><span class="id" title="variable">kvs</span></a>) <a class="idref" href="Records.html#p:13"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Records.html#hfields"><span class="id" title="definition">hfields</span></a> <a class="idref" href="Records.html#kvs:14"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Records.html#p:13"><span class="id" title="variable">p</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Records.html#hrecord"><span class="id" title="definition">hrecord</span></a>. <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">z</span> <span class="id" title="var">Hz</span>. <span class="id" title="var">xsimpl</span>. <span class="id" title="var">xsimpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">LibListExec.length_eq</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#HS.himpl_of_eq"><span class="id" title="lemma">himpl_of_eq</span></a>. <span class="id" title="var">fequal</span>. <span class="id" title="var">gen</span> <span class="id" title="var">Hz</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Records.html#maps_all_fields"><span class="id" title="definition">maps_all_fields</span></a>. <span class="id" title="tactic">generalize</span> 0%<span class="id" title="var">nat</span>. <span class="id" title="var">gen</span> <span class="id" title="var">z</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">kvs</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">z</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">z'</span>]; <span class="id" title="var">rew_listx</span> <span class="id" title="keyword">in</span> *; <span class="id" title="var">tryfalse</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">math</span>. } { <span class="id" title="var">inverts</span> <span class="id" title="var">Hz</span>. <span class="id" title="var">forwards</span>*: <span class="id" title="var">IHkvs</span> <span class="id" title="var">H<sub>1</sub></span>. <span class="id" title="var">math</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
For example, let us show how to convert from
    <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~~&gt;</span> <span class="inlinecode">`{</span> <span class="inlinecode"><span class="id" title="var">head</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">;</span> <span class="inlinecode"><span class="id" title="var">tail</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">q</span></span> <span class="inlinecode">}</span> to the conjunction of <span class="inlinecode"><span class="id" title="var">hheader</span></span> <span class="inlinecode">2</span> <span class="inlinecode"><span class="id" title="var">p</span></span> and
    <span class="inlinecode"><span class="id" title="var">p</span>`.<span class="id" title="var">head</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">x</span></span> and <span class="inlinecode"><span class="id" title="var">p</span>`.<span class="id" title="var">tail</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">q</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="head" class="idref" href="#head"><span class="id" title="definition">head</span></a> : <a class="idref" href="Records.html#field"><span class="id" title="definition">field</span></a> := 0%<span class="id" title="var">nat</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="tail" class="idref" href="#tail"><span class="id" title="definition">tail</span></a> : <a class="idref" href="Records.html#field"><span class="id" title="definition">field</span></a> := 1%<span class="id" title="var">nat</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="demo_hrecord_intro_elim" class="idref" href="#demo_hrecord_intro_elim"><span class="id" title="lemma">demo_hrecord_intro_elim</span></a> : <span class="id" title="keyword">∀</span> <a id="p:15" class="idref" href="#p:15"><span class="id" title="binder">p</span></a> <a id="x:16" class="idref" href="#x:16"><span class="id" title="binder">x</span></a> <a id="q:17" class="idref" href="#q:17"><span class="id" title="binder">q</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#p:15"><span class="id" title="variable">p</span></a> <a class="idref" href="Records.html#4fdf8be3226dc6822dfa0caeb9414d<sub>46</sub>"><span class="id" title="notation">~~~&gt;</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">`{</span></a> <a class="idref" href="Records.html#head"><span class="id" title="definition">head</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Records.html#x:16"><span class="id" title="variable">x</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Records.html#tail"><span class="id" title="definition">tail</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Records.html#q:17"><span class="id" title="variable">q</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">}</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">xchange</span> <a class="idref" href="Records.html#hrecord_elim"><span class="id" title="lemma">hrecord_elim</span></a>; <span class="id" title="tactic">simpl</span>. <span class="id" title="keyword">Abort</span>.<br/>
</div>

<div class="doc">
<a id="lab458"></a><h2 class="section">Reasoning about Reads from Record Fields</h2>

</div>
<div class="code">

<span class="id" title="keyword">Declare Scope</span> <span class="id" title="var">trm_scope_ext</span>.<br/>
</div>

<div class="doc">
The read operation is described by an expression of the form
    <span class="inlinecode"><span class="id" title="var">val_get_field</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>, where <span class="inlinecode"><span class="id" title="var">k</span></span> denotes a field name and <span class="inlinecode"><span class="id" title="var">p</span></span> denotes the
    location of a record.

<div class="paragraph"> </div>

    Observe that <span class="inlinecode"><span class="id" title="var">k</span></span> is <i>not</i> a program value of type <span class="inlinecode"><span class="id" title="var">val</span></span>, but rather a name
    for a natural number.

<div class="paragraph"> </div>

    The expression <span class="inlinecode"><span class="id" title="var">val_get_field</span></span> has type <span class="inlinecode"><span class="id" title="tactic">field</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">val</span></span>, and for a given
    field <span class="inlinecode"><span class="id" title="var">k</span></span> the expression <span class="inlinecode"><span class="id" title="var">val_get_field</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> is a value, which may be applied
    in the program syntax to a pointer <span class="inlinecode"><span class="id" title="var">p</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="val_get_field" class="idref" href="#val_get_field"><span class="id" title="axiom">val_get_field</span></a> : <a class="idref" href="Records.html#field"><span class="id" title="definition">field</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
</div>

<div class="doc">
The read operation <span class="inlinecode"><span class="id" title="var">val_get_field</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> is written <span class="inlinecode"><span class="id" title="var">p</span>`.<span class="id" title="var">k</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Notation</span> <a id="bc5af3b58d5c20163ac6d8a709b81319" class="idref" href="#bc5af3b58d5c20163ac6d8a709b81319"><span class="id" title="notation">&quot;</span></a>t<sub>1</sub> '`.' k" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="Records.html#val_get_field"><span class="id" title="axiom">val_get_field</span></a> <span class="id" title="var">k</span> <span class="id" title="var">t<sub>1</sub></span>)<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">trm</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 56, <span class="id" title="var">k</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">format</span> "t<sub>1</sub> '`.' k" )<br/>
&nbsp;&nbsp;: <span class="id" title="var">trm_scope_ext</span>.<br/>
</div>

<div class="doc">
The operation <span class="inlinecode"><span class="id" title="var">val_get_field</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> can be specified at three levels.

<div class="paragraph"> </div>

    First, its small-footprint specification operates at the level of a single
    field, described by <span class="inlinecode"><span class="id" title="var">p</span>`.<span class="id" title="var">k</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">v</span></span>. The specification is very similar to that
    of <span class="inlinecode"><span class="id" title="var">val_get</span></span>. The return value is exactly <span class="inlinecode"><span class="id" title="var">v</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_get_field" class="idref" href="#triple_get_field"><span class="id" title="axiom">triple_get_field</span></a> : <span class="id" title="keyword">∀</span> <a id="p:19" class="idref" href="#p:19"><span class="id" title="binder">p</span></a> <a id="k:20" class="idref" href="#k:20"><span class="id" title="binder">k</span></a> <a id="v:21" class="idref" href="#v:21"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Records.html#val_get_field"><span class="id" title="axiom">val_get_field</span></a> <a class="idref" href="Records.html#k:20"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#p:19"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#p:19"><span class="id" title="variable">p</span></a><a class="idref" href="Records.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">`.</span></a><a class="idref" href="Records.html#k:20"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Records.html#v:21"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:22" class="idref" href="#r:22"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Records.html#r:22"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Records.html#v:21"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#p:19"><span class="id" title="variable">p</span></a><a class="idref" href="Records.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">`.</span></a><a class="idref" href="Records.html#k:20"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Records.html#v:21"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>).<br/>
</div>

<div class="doc">
Second, the read operation <span class="inlinecode"><span class="id" title="var">val_get_field</span></span> can be specified with respect to
    a list of fields, described in the form <span class="inlinecode"><span class="id" title="var">hfields</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>. To that end, we
    introduce a function called <span class="inlinecode"><span class="id" title="var">hfields_lookup</span></span> for extracting the value <span class="inlinecode"><span class="id" title="var">v</span></span>
    associated with a field <span class="inlinecode"><span class="id" title="var">k</span></span> in a list of record fields <span class="inlinecode"><span class="id" title="var">kvs</span></span>. Note that the
    operation <span class="inlinecode"><span class="id" title="var">hfields_lookup</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> returns an <span class="inlinecode"><span class="id" title="var">option</span></span> <span class="inlinecode"><span class="id" title="var">val</span></span>, because we cannot
    presume that the field <span class="inlinecode"><span class="id" title="var">k</span></span> occurs in <span class="inlinecode"><span class="id" title="var">kvs</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <a id="hfields_lookup" class="idref" href="#hfields_lookup"><span class="id" title="definition">hfields_lookup</span></a> (<a id="k:24" class="idref" href="#k:24"><span class="id" title="binder">k</span></a>:<a class="idref" href="Records.html#field"><span class="id" title="definition">field</span></a>) (<a id="kvs:25" class="idref" href="#kvs:25"><span class="id" title="binder">kvs</span></a>:<a class="idref" href="Records.html#hrecord_fields"><span class="id" title="definition">hrecord_fields</span></a>) : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Records.html#kvs:25"><span class="id" title="variable">kvs</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">ki</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">vi</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><span class="id" title="var">kvs'</span> ⇒ <span class="id" title="keyword">if</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#Nat.eq_dec"><span class="id" title="lemma">Nat.eq_dec</span></a> <a class="idref" href="Records.html#k:24"><span class="id" title="variable">k</span></a> <span class="id" title="var">ki</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">vi</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <a class="idref" href="Records.html#hfields_lookup:26"><span class="id" title="definition">hfields_lookup</span></a> <a class="idref" href="Records.html#k:24"><span class="id" title="variable">k</span></a> <span class="id" title="var">kvs'</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
Under the assumption that <span class="inlinecode"><span class="id" title="var">hfields_lookup</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> returns <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span>, the read
    operation <span class="inlinecode"><span class="id" title="var">val_get_field</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> is specified to return <span class="inlinecode"><span class="id" title="var">v</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_get_field_hfields" class="idref" href="#triple_get_field_hfields"><span class="id" title="axiom">triple_get_field_hfields</span></a> : <span class="id" title="keyword">∀</span> <a id="kvs:28" class="idref" href="#kvs:28"><span class="id" title="binder">kvs</span></a> <a id="p:29" class="idref" href="#p:29"><span class="id" title="binder">p</span></a> <a id="k:30" class="idref" href="#k:30"><span class="id" title="binder">k</span></a> <a id="v:31" class="idref" href="#v:31"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#hfields_lookup"><span class="id" title="definition">hfields_lookup</span></a> <a class="idref" href="Records.html#k:30"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#kvs:28"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Records.html#v:31"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Records.html#val_get_field"><span class="id" title="axiom">val_get_field</span></a> <a class="idref" href="Records.html#k:30"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#p:29"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#hfields"><span class="id" title="definition">hfields</span></a> <a class="idref" href="Records.html#kvs:28"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Records.html#p:29"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:32" class="idref" href="#r:32"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Records.html#r:32"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Records.html#v:31"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Records.html#hfields"><span class="id" title="definition">hfields</span></a> <a class="idref" href="Records.html#kvs:28"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Records.html#p:29"><span class="id" title="variable">p</span></a>).<br/>
</div>

<div class="doc">
Third, the read operation <span class="inlinecode"><span class="id" title="var">val_get_field</span></span> can be specified with respect to
    the predicate <span class="inlinecode"><span class="id" title="var">hrecord</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>, describing the full record, including its
    header. The corresponding specification shown below follows a similar
    pattern as the specification of <span class="inlinecode"><span class="id" title="var">hfield</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_get_field_hrecord" class="idref" href="#triple_get_field_hrecord"><span class="id" title="axiom">triple_get_field_hrecord</span></a> : <span class="id" title="keyword">∀</span> <a id="kvs:34" class="idref" href="#kvs:34"><span class="id" title="binder">kvs</span></a> <a id="p:35" class="idref" href="#p:35"><span class="id" title="binder">p</span></a> <a id="k:36" class="idref" href="#k:36"><span class="id" title="binder">k</span></a> <a id="v:37" class="idref" href="#v:37"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#hfields_lookup"><span class="id" title="definition">hfields_lookup</span></a> <a class="idref" href="Records.html#k:36"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#kvs:34"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Records.html#v:37"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Records.html#val_get_field"><span class="id" title="axiom">val_get_field</span></a> <a class="idref" href="Records.html#k:36"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#p:35"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#hrecord"><span class="id" title="definition">hrecord</span></a> <a class="idref" href="Records.html#kvs:34"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Records.html#p:35"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:38" class="idref" href="#r:38"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Records.html#r:38"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Records.html#v:37"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Records.html#hrecord"><span class="id" title="definition">hrecord</span></a> <a class="idref" href="Records.html#kvs:34"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Records.html#p:35"><span class="id" title="variable">p</span></a>).<br/>
</div>

<div class="doc">
<a id="lab459"></a><h2 class="section">Reasoning about Writes To Record Fields</h2>

<div class="paragraph"> </div>

 The write operation is described by an expression of the form
    <span class="inlinecode"><span class="id" title="var">val_set_field</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span>, where <span class="inlinecode"><span class="id" title="var">k</span></span> denotes a field name, and where <span class="inlinecode"><span class="id" title="var">p</span></span> denotes
    the location of a record, and where <span class="inlinecode"><span class="id" title="var">v</span></span> is the new value for the field. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="val_set_field" class="idref" href="#val_set_field"><span class="id" title="axiom">val_set_field</span></a> : <a class="idref" href="Records.html#field"><span class="id" title="definition">field</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
</div>

<div class="doc">
The operation <span class="inlinecode"><span class="id" title="var">val_set_field</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> is abbreviated <span class="inlinecode"><span class="id" title="keyword">Set</span></span> <span class="inlinecode"><span class="id" title="var">p</span>`.<span class="id" title="var">k</span></span> <span class="inlinecode">':=</span> <span class="inlinecode"><span class="id" title="var">v</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Notation</span> <a id="9c37435ad2fd5658d2e72190079a1ccf" class="idref" href="#9c37435ad2fd5658d2e72190079a1ccf"><span class="id" title="notation">&quot;</span></a>t<sub>1</sub> '`.' k ':=' t<sub>2</sub>" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="Records.html#val_set_field"><span class="id" title="axiom">val_set_field</span></a> <span class="id" title="var">k</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>)<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">trm</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 56, <span class="id" title="var">k</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">format</span> "t<sub>1</sub> '`.' k  ':=' t<sub>2</sub>")<br/>
&nbsp;&nbsp;: <span class="id" title="var">trm_scope_ext</span>.<br/>
</div>

<div class="doc">
As for the read operation, the write operation can be specified at three
    levels. First, it may be specified at the level of an individual field. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_set_field" class="idref" href="#triple_set_field"><span class="id" title="axiom">triple_set_field</span></a> : <span class="id" title="keyword">∀</span> <a id="v:41" class="idref" href="#v:41"><span class="id" title="binder">v</span></a> <a id="p:42" class="idref" href="#p:42"><span class="id" title="binder">p</span></a> <a id="k:43" class="idref" href="#k:43"><span class="id" title="binder">k</span></a> <a id="v':44" class="idref" href="#v':44"><span class="id" title="binder">v'</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Records.html#val_set_field"><span class="id" title="axiom">val_set_field</span></a> <a class="idref" href="Records.html#k:43"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#p:42"><span class="id" title="variable">p</span></a> <a class="idref" href="Records.html#v:41"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#p:42"><span class="id" title="variable">p</span></a><a class="idref" href="Records.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">`.</span></a><a class="idref" href="Records.html#k:43"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Records.html#v':44"><span class="id" title="variable">v'</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Records.html#p:42"><span class="id" title="variable">p</span></a><a class="idref" href="Records.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">`.</span></a><a class="idref" href="Records.html#k:43"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Records.html#v:41"><span class="id" title="variable">v</span></a>).<br/>
</div>

<div class="doc">
Alternatively, it may be specified in terms of <span class="inlinecode"><span class="id" title="var">hfields</span></span> or <span class="inlinecode"><span class="id" title="var">hrecord</span></span>, using
    an auxiliary function called <span class="inlinecode"><span class="id" title="var">hrecord_update</span></span>. This function computes an
    updated list of fields to reflect the action of a write operation.

<div class="paragraph"> </div>

    Concretely, <span class="inlinecode"><span class="id" title="var">hrecord_update</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">w</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> replaces the contents of the field
    named <span class="inlinecode"><span class="id" title="var">k</span></span> with the value <span class="inlinecode"><span class="id" title="var">w</span></span>. It returns a description <span class="inlinecode"><span class="id" title="var">kvs'</span></span> of the record
    fields, provided the update operation succeeded, i.e., provided that the
    field <span class="inlinecode"><span class="id" title="var">k</span></span> on which the update is to be performed actually occurs in the list
    <span class="inlinecode"><span class="id" title="var">kvs</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <a id="hfields_update" class="idref" href="#hfields_update"><span class="id" title="definition">hfields_update</span></a> (<a id="k:46" class="idref" href="#k:46"><span class="id" title="binder">k</span></a>:<a class="idref" href="Records.html#field"><span class="id" title="definition">field</span></a>) (<a id="v:47" class="idref" href="#v:47"><span class="id" title="binder">v</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) (<a id="kvs:48" class="idref" href="#kvs:48"><span class="id" title="binder">kvs</span></a>:<a class="idref" href="Records.html#hrecord_fields"><span class="id" title="definition">hrecord_fields</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="Records.html#hrecord_fields"><span class="id" title="definition">hrecord_fields</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Records.html#kvs:48"><span class="id" title="variable">kvs</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">ki</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">vi</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><span class="id" title="var">kvs'</span> ⇒ <span class="id" title="keyword">if</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#Nat.eq_dec"><span class="id" title="lemma">Nat.eq_dec</span></a> <a class="idref" href="Records.html#k:46"><span class="id" title="variable">k</span></a> <span class="id" title="var">ki</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#k:46"><span class="id" title="variable">k</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Records.html#v:47"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><span class="id" title="var">kvs'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="keyword">match</span> <a class="idref" href="Records.html#hfields_update:49"><span class="id" title="definition">hfields_update</span></a> <a class="idref" href="Records.html#k:46"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#v:47"><span class="id" title="variable">v</span></a> <span class="id" title="var">kvs'</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">LR</span> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">ki</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">vi</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><span class="id" title="var">LR</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
The specification in terms of <span class="inlinecode"><span class="id" title="var">hfields</span></span> is as follows. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_set_field_hfields" class="idref" href="#triple_set_field_hfields"><span class="id" title="axiom">triple_set_field_hfields</span></a> : <span class="id" title="keyword">∀</span> <a id="kvs:51" class="idref" href="#kvs:51"><span class="id" title="binder">kvs</span></a> <a id="kvs':52" class="idref" href="#kvs':52"><span class="id" title="binder">kvs'</span></a> <a id="k:53" class="idref" href="#k:53"><span class="id" title="binder">k</span></a> <a id="p:54" class="idref" href="#p:54"><span class="id" title="binder">p</span></a> <a id="v:55" class="idref" href="#v:55"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#hfields_update"><span class="id" title="definition">hfields_update</span></a> <a class="idref" href="Records.html#k:53"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#v:55"><span class="id" title="variable">v</span></a> <a class="idref" href="Records.html#kvs:51"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Records.html#kvs':52"><span class="id" title="variable">kvs'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Records.html#val_set_field"><span class="id" title="axiom">val_set_field</span></a> <a class="idref" href="Records.html#k:53"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#p:54"><span class="id" title="variable">p</span></a> <a class="idref" href="Records.html#v:55"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#hfields"><span class="id" title="definition">hfields</span></a> <a class="idref" href="Records.html#kvs:51"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Records.html#p:54"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Records.html#hfields"><span class="id" title="definition">hfields</span></a> <a class="idref" href="Records.html#kvs':52"><span class="id" title="variable">kvs'</span></a> <a class="idref" href="Records.html#p:54"><span class="id" title="variable">p</span></a>).<br/>
</div>

<div class="doc">
The specification in terms of <span class="inlinecode"><span class="id" title="var">hrecord</span></span> follows a similar pattern. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_set_field_hrecord" class="idref" href="#triple_set_field_hrecord"><span class="id" title="axiom">triple_set_field_hrecord</span></a> : <span class="id" title="keyword">∀</span> <a id="kvs:57" class="idref" href="#kvs:57"><span class="id" title="binder">kvs</span></a> <a id="kvs':58" class="idref" href="#kvs':58"><span class="id" title="binder">kvs'</span></a> <a id="k:59" class="idref" href="#k:59"><span class="id" title="binder">k</span></a> <a id="p:60" class="idref" href="#p:60"><span class="id" title="binder">p</span></a> <a id="v:61" class="idref" href="#v:61"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#hfields_update"><span class="id" title="definition">hfields_update</span></a> <a class="idref" href="Records.html#k:59"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#v:61"><span class="id" title="variable">v</span></a> <a class="idref" href="Records.html#kvs:57"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Records.html#kvs':58"><span class="id" title="variable">kvs'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Records.html#val_set_field"><span class="id" title="axiom">val_set_field</span></a> <a class="idref" href="Records.html#k:59"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#p:60"><span class="id" title="variable">p</span></a> <a class="idref" href="Records.html#v:61"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#hrecord"><span class="id" title="definition">hrecord</span></a> <a class="idref" href="Records.html#kvs:57"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Records.html#p:60"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Records.html#hrecord"><span class="id" title="definition">hrecord</span></a> <a class="idref" href="Records.html#kvs':58"><span class="id" title="variable">kvs'</span></a> <a class="idref" href="Records.html#p:60"><span class="id" title="variable">p</span></a>).<br/>
</div>

<div class="doc">
<a id="lab460"></a><h2 class="section">Reasoning about Record Allocation with Initializers</h2>

<div class="paragraph"> </div>

 In ML, records may only be allocated by providing values to initialize every
    field. This allocation operation can be defined in an arity-generic way.
    However, to avoid technicalities, we here present only its specialization
    for arity 2. For example, the notation <span class="inlinecode">`{</span> <span class="inlinecode"><span class="id" title="var">head</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">x</span>;</span> <span class="inlinecode"><span class="id" title="var">tail</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">q</span></span> <span class="inlinecode">}</span> stands
    for the term <span class="inlinecode">(<span class="id" title="var">val_new_hrecord_2</span></span> <span class="inlinecode"><span class="id" title="var">head</span></span> <span class="inlinecode"><span class="id" title="var">tail</span>)</span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">q</span></span>.

<div class="paragraph"> </div>

    Here, <span class="inlinecode"><span class="id" title="var">val_new_hrecord_2</span></span> is a Coq function that expects two names as
    arguments and produces a value. For example, the expression
    <span class="inlinecode"><span class="id" title="var">val_new_hrecord_2</span></span> <span class="inlinecode"><span class="id" title="var">head</span></span> <span class="inlinecode"><span class="id" title="var">tail</span></span> is a value that may be applied to two
    arguments in the program syntax. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="val_new_hrecord_2" class="idref" href="#val_new_hrecord_2"><span class="id" title="axiom">val_new_hrecord_2</span></a> : <a class="idref" href="Records.html#field"><span class="id" title="definition">field</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#field"><span class="id" title="definition">field</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <a id="cc6cf683885a8ab62fa68148561e9169" class="idref" href="#cc6cf683885a8ab62fa68148561e9169"><span class="id" title="notation">&quot;</span></a>`{ k<sub>1</sub> := v<sub>1</sub> ; k<sub>2</sub> := v<sub>2</sub> }" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="Records.html#val_new_hrecord_2"><span class="id" title="axiom">val_new_hrecord_2</span></a> <span class="id" title="var">k<sub>1</sub></span> <span class="id" title="var">k<sub>2</sub></span> <span class="id" title="var">v<sub>1</sub></span> <span class="id" title="var">v<sub>2</sub></span>)<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">trm</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 65,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">k<sub>1</sub></span>, <span class="id" title="var">k<sub>2</sub></span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">v<sub>1</sub></span>, <span class="id" title="var">v<sub>2</sub></span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 65).<br/>
</div>

<div class="doc">
The record allocation operation <span class="inlinecode">`{</span> <span class="inlinecode"><span class="id" title="var">k<sub>1</sub></span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span> <span class="inlinecode">;</span> <span class="inlinecode"><span class="id" title="var">k<sub>2</sub></span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">v<sub>2</sub></span></span> <span class="inlinecode">}</span> is specified as
    follows. The premises <span class="inlinecode"><span class="id" title="var">k<sub>1</sub></span></span> <span class="inlinecode">=</span> <span class="inlinecode">0</span> and <span class="inlinecode"><span class="id" title="var">k<sub>2</sub></span></span> <span class="inlinecode">=</span> <span class="inlinecode">1</span> enforce the field names to be
    provided in increasing order, starting from zero. The postcondition
    describes a record at address <span class="inlinecode"><span class="id" title="var">p</span></span> using the predicate
    <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~~&gt;</span> <span class="inlinecode">`{</span> <span class="inlinecode"><span class="id" title="var">k<sub>1</sub></span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span> <span class="inlinecode">;</span> <span class="inlinecode"><span class="id" title="var">k<sub>2</sub></span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">v<sub>2</sub></span></span> <span class="inlinecode">}</span>, i.e.,
    <span class="inlinecode"><span class="id" title="var">hrecord</span></span> <span class="inlinecode">((<span class="id" title="var">k<sub>1</sub></span>,<span class="id" title="var">v<sub>1</sub></span>)::(<span class="id" title="var">k<sub>2</sub></span>,<span class="id" title="var">v<sub>2</sub></span>)::<span class="id" title="var">nil</span>)</span> <span class="inlinecode"><span class="id" title="var">p</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_new_hrecord_2" class="idref" href="#triple_new_hrecord_2"><span class="id" title="axiom">triple_new_hrecord_2</span></a> : <span class="id" title="keyword">∀</span> (<a id="k<sub>1</sub>:64" class="idref" href="#k<sub>1</sub>:64"><span class="id" title="binder">k<sub>1</sub></span></a> <a id="k<sub>2</sub>:65" class="idref" href="#k<sub>2</sub>:65"><span class="id" title="binder">k<sub>2</sub></span></a>:<a class="idref" href="Records.html#field"><span class="id" title="definition">field</span></a>) (<a id="v<sub>1</sub>:66" class="idref" href="#v<sub>1</sub>:66"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="v<sub>2</sub>:67" class="idref" href="#v<sub>2</sub>:67"><span class="id" title="binder">v<sub>2</sub></span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#k<sub>1</sub>:64"><span class="id" title="variable">k<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 0%<span class="id" title="var">nat</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#k<sub>2</sub>:65"><span class="id" title="variable">k<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 1%<span class="id" title="var">nat</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="Records.html#cc6cf683885a8ab62fa68148561e9169"><span class="id" title="notation">`{</span></a> <a class="idref" href="Records.html#k<sub>1</sub>:64"><span class="id" title="variable">k<sub>1</sub></span></a> <a class="idref" href="Records.html#cc6cf683885a8ab62fa68148561e9169"><span class="id" title="notation">:=</span></a> <a class="idref" href="Records.html#v<sub>1</sub>:66"><span class="id" title="variable">v<sub>1</sub></span></a><a class="idref" href="Records.html#cc6cf683885a8ab62fa68148561e9169"><span class="id" title="notation">;</span></a> <a class="idref" href="Records.html#k<sub>2</sub>:65"><span class="id" title="variable">k<sub>2</sub></span></a> <a class="idref" href="Records.html#cc6cf683885a8ab62fa68148561e9169"><span class="id" title="notation">:=</span></a> <a class="idref" href="Records.html#v<sub>2</sub>:67"><span class="id" title="variable">v<sub>2</sub></span></a> <a class="idref" href="Records.html#cc6cf683885a8ab62fa68148561e9169"><span class="id" title="notation">}</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:70" class="idref" href="#p:70"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Records.html#p:68"><span class="id" title="variable">p</span></a> <a class="idref" href="Records.html#4fdf8be3226dc6822dfa0caeb9414d<sub>46</sub>"><span class="id" title="notation">~~~&gt;</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">`{</span></a> <a class="idref" href="Records.html#k<sub>1</sub>:64"><span class="id" title="variable">k<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Records.html#v<sub>1</sub>:66"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Records.html#k<sub>2</sub>:65"><span class="id" title="variable">k<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Records.html#v<sub>2</sub>:67"><span class="id" title="variable">v<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">}</span></a>).<br/>
</div>

<div class="doc">
For example, the operation <span class="inlinecode"><span class="id" title="var">mcons</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">q</span></span> allocates a list cell with head value
    <span class="inlinecode"><span class="id" title="var">x</span></span> and tail pointer <span class="inlinecode"><span class="id" title="var">q</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="mcons" class="idref" href="#mcons"><span class="id" title="definition">mcons</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#val_new_hrecord_2"><span class="id" title="axiom">val_new_hrecord_2</span></a> <a class="idref" href="Records.html#head"><span class="id" title="definition">head</span></a> <a class="idref" href="Records.html#tail"><span class="id" title="definition">tail</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="triple_mcons" class="idref" href="#triple_mcons"><span class="id" title="lemma">triple_mcons</span></a> : <span class="id" title="keyword">∀</span> (<a id="x:72" class="idref" href="#x:72"><span class="id" title="binder">x</span></a> <a id="q:73" class="idref" href="#q:73"><span class="id" title="binder">q</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Records.html#mcons"><span class="id" title="definition">mcons</span></a> <a class="idref" href="Records.html#x:72"><span class="id" title="variable">x</span></a> <a class="idref" href="Records.html#q:73"><span class="id" title="variable">q</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:76" class="idref" href="#p:76"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Records.html#p:74"><span class="id" title="variable">p</span></a> <a class="idref" href="Records.html#4fdf8be3226dc6822dfa0caeb9414d<sub>46</sub>"><span class="id" title="notation">~~~&gt;</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">`{</span></a> <a class="idref" href="Records.html#head"><span class="id" title="definition">head</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Records.html#x:72"><span class="id" title="variable">x</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Records.html#tail"><span class="id" title="definition">tail</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Records.html#q:73"><span class="id" title="variable">q</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">}</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Records.html#triple_new_hrecord_2"><span class="id" title="axiom">triple_new_hrecord_2</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
This completes the presentation of the formalization of the mechanisms for
    reasoning about records. These mechanisms were illustrated throughout the
    chapter <a href="Repr.html"><span class="inlineref">Repr</span></a>. 
</div>

<div class="doc">
<a id="lab461"></a><h1 class="section">Optional Material</h1>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="Realization" class="idref" href="#Realization"><span class="id" title="module">Realization</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="LibSepReference.html#ProgramSyntax"><span class="id" title="module">ProgramSyntax</span></a>.<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">trm_scope_ext</span>.<br/>
</div>

<div class="doc">
In this section, we explain how <span class="inlinecode"><span class="id" title="var">val_get_field</span></span>, <span class="inlinecode"><span class="id" title="var">val_set_field</span></span>, and
    <span class="inlinecode"><span class="id" title="var">val_new_hrecord_2</span></span> can be realized in terms of block allocation and pointer
    arithmetic, following the same approach as in the previous chapter on
    arrays. In particular, we use a similar proof set up. 
</div>
<div class="code">

<span class="id" title="keyword">Global Transparent</span> <a class="idref" href="Records.html#hfield"><span class="id" title="definition">hfield</span></a>.<br/><hr class='doublespaceincode'/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Extern</span> 1 (<span class="id" title="var">_</span> <span class="id" title="notation">≥</span> <span class="id" title="var">_</span>) ⇒ <span class="id" title="var">math</span> : <span class="id" title="var">triple</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">is_additional_arith_type</span> <span class="id" title="var">T</span> <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">T</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a> ⇒ <span class="id" title="keyword">constr</span>:(<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>)<br/>
&nbsp;&nbsp;| <a class="idref" href="Records.html#field"><span class="id" title="definition">field</span></a> ⇒ <span class="id" title="keyword">constr</span>:(<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
<a id="lab462"></a><h2 class="section">Implementation of Record Accesses using Pointer Arithmetic</h2>

<div class="paragraph"> </div>

 The get operation on a field, written <span class="inlinecode"><span class="id" title="var">p</span>`.<span class="id" title="var">k</span></span>, is encoded as
    <span class="inlinecode"><span class="id" title="var">val_get</span></span> <span class="inlinecode">(<span class="id" title="var">p</span>+1+<span class="id" title="var">k</span>)</span>. In the definition shown below, the braces around
    <span class="inlinecode"><span class="id" title="var">nat_to_Z</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> are used to embed the Coq natural number <span class="inlinecode"><span class="id" title="var">k</span></span> into the code, in
    the form of an integer represented in the grammar of terms using the
    implicit coercion <span class="inlinecode"><span class="id" title="var">val_int</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="Realization.val_get_field" class="idref" href="#Realization.val_get_field"><span class="id" title="definition">val_get_field</span></a> (<a id="k:77" class="idref" href="#k:77"><span class="id" title="binder">k</span></a>:<a class="idref" href="Records.html#field"><span class="id" title="definition">field</span></a>) : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#Realization.val_ptr_add"><span class="id" title="axiom">val_ptr_add</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> 1 <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">q</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#Realization.val_ptr_add"><span class="id" title="axiom">val_ptr_add</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#a15607334da66bc8a82cc392003f629d"><span class="id" title="notation">{</span></a><span class="id" title="definition">nat_to_Z</span> <a class="idref" href="Records.html#k:77"><span class="id" title="variable">k</span></a><a class="idref" href="LibSepReference.html#a15607334da66bc8a82cc392003f629d"><span class="id" title="notation">}</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#val_get"><span class="id" title="constructor">val_get</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">q</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <a id="a5b8d2703d5233f6877a9afdeaf75af<sub>5</sub>" class="idref" href="#a5b8d2703d5233f6877a9afdeaf75af<sub>5</sub>"><span class="id" title="notation">&quot;</span></a>t<sub>1</sub> '`.' f" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="Records.html#Realization.val_get_field"><span class="id" title="definition">val_get_field</span></a> <span class="id" title="var">f</span> <span class="id" title="var">t<sub>1</sub></span>)<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">trm</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 56, <span class="id" title="var">f</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">format</span> "t<sub>1</sub> '`.' f" ).<br/><hr class='doublespaceincode'/>
#[<span class="id" title="var">export</span>]<span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Resolve</span> <span class="id" title="var">triple_ptr_add_nonneg</span> : <span class="id" title="var">triple</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_get_field" class="idref" href="#Realization.triple_get_field"><span class="id" title="lemma">triple_get_field</span></a> : <span class="id" title="keyword">∀</span> <a id="p:78" class="idref" href="#p:78"><span class="id" title="binder">p</span></a> <a id="k:79" class="idref" href="#k:79"><span class="id" title="binder">k</span></a> <a id="v:80" class="idref" href="#v:80"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> ((<a class="idref" href="Records.html#Realization.val_get_field"><span class="id" title="definition">val_get_field</span></a> <a class="idref" href="Records.html#k:79"><span class="id" title="variable">k</span></a>) <a class="idref" href="Records.html#p:78"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#p:78"><span class="id" title="variable">p</span></a><a class="idref" href="Records.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">`.</span></a><a class="idref" href="Records.html#k:79"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Records.html#v:80"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:81" class="idref" href="#r:81"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Records.html#r:81"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Records.html#v:80"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#p:78"><span class="id" title="variable">p</span></a><a class="idref" href="Records.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">`.</span></a><a class="idref" href="Records.html#k:79"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Records.html#v:80"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Records.html#hfield"><span class="id" title="definition">hfield</span></a>. <span class="id" title="var">xwp</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">unfolds</span> <a class="idref" href="Records.html#field"><span class="id" title="definition">field</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">math_rewrite</span> (<span class="id" title="var">p</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="notation">abs</span> <span class="id" title="notation">1</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="notation">abs</span> <span class="id" title="notation">k</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">p</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a><span class="id" title="var">k</span>)%<span class="id" title="var">nat</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xsimpl</span>*.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The set operation on a field, written <span class="inlinecode"><span class="id" title="keyword">Set</span></span> <span class="inlinecode"><span class="id" title="var">p</span>`.<span class="id" title="var">k</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">v</span></span>, is encoded as
    <span class="inlinecode"><span class="id" title="var">val_set</span></span> <span class="inlinecode">(<span class="id" title="var">p</span>+1+<span class="id" title="var">k</span>)</span> <span class="inlinecode"><span class="id" title="var">v</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="Realization.val_set_field" class="idref" href="#Realization.val_set_field"><span class="id" title="definition">val_set_field</span></a> (<a id="k:82" class="idref" href="#k:82"><span class="id" title="binder">k</span></a>:<a class="idref" href="Records.html#field"><span class="id" title="definition">field</span></a>) : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#bfe3f2ff4c10f23c7c7f24aa5367bca5"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">v</span></a> <a class="idref" href="LibSepReference.html#bfe3f2ff4c10f23c7c7f24aa5367bca5"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#Realization.val_ptr_add"><span class="id" title="axiom">val_ptr_add</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> 1 <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">q</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#Realization.val_ptr_add"><span class="id" title="axiom">val_ptr_add</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#a15607334da66bc8a82cc392003f629d"><span class="id" title="notation">{</span></a><span class="id" title="definition">nat_to_Z</span> <a class="idref" href="Records.html#k:82"><span class="id" title="variable">k</span></a><a class="idref" href="LibSepReference.html#a15607334da66bc8a82cc392003f629d"><span class="id" title="notation">}</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#val_set"><span class="id" title="constructor">val_set</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">q</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">v</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_set_field" class="idref" href="#Realization.triple_set_field"><span class="id" title="lemma">triple_set_field</span></a> : <span class="id" title="keyword">∀</span> <a id="v<sub>1</sub>:83" class="idref" href="#v<sub>1</sub>:83"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="p:84" class="idref" href="#p:84"><span class="id" title="binder">p</span></a> <a id="k:85" class="idref" href="#k:85"><span class="id" title="binder">k</span></a> <a id="v<sub>2</sub>:86" class="idref" href="#v<sub>2</sub>:86"><span class="id" title="binder">v<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> ((<a class="idref" href="Records.html#Realization.val_set_field"><span class="id" title="definition">val_set_field</span></a> <a class="idref" href="Records.html#k:85"><span class="id" title="variable">k</span></a>) <a class="idref" href="Records.html#p:84"><span class="id" title="variable">p</span></a> <a class="idref" href="Records.html#v<sub>2</sub>:86"><span class="id" title="variable">v<sub>2</sub></span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#p:84"><span class="id" title="variable">p</span></a><a class="idref" href="Records.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">`.</span></a><a class="idref" href="Records.html#k:85"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Records.html#v<sub>1</sub>:83"><span class="id" title="variable">v<sub>1</sub></span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Records.html#p:84"><span class="id" title="variable">p</span></a><a class="idref" href="Records.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">`.</span></a><a class="idref" href="Records.html#k:85"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Records.html#v<sub>2</sub>:86"><span class="id" title="variable">v<sub>2</sub></span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Records.html#hfield"><span class="id" title="definition">hfield</span></a>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">xwp</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xapp</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">math_rewrite</span> (<span class="id" title="var">p</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="notation">abs</span> <span class="id" title="notation">1</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="notation">abs</span> <span class="id" title="notation">k</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">p</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a><span class="id" title="var">k</span>)%<span class="id" title="var">nat</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xsimpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <a id="975e54956157dbd0f90c3fa0e2d977fe" class="idref" href="#975e54956157dbd0f90c3fa0e2d977fe"><span class="id" title="notation">&quot;</span></a>t<sub>1</sub> '`.' f ':=' t<sub>2</sub>" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="Records.html#Realization.val_set_field"><span class="id" title="definition">val_set_field</span></a> <span class="id" title="var">f</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>)<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">trm</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 56, <span class="id" title="var">f</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">format</span> "t<sub>1</sub> '`.' f  ':='  t<sub>2</sub>").<br/>
</div>

<div class="doc">
<a id="lab463"></a><h2 class="section">Specification of Record Accesses w.r.t. <span class="inlinecode"><span class="id" title="var">hfields</span></span></h2>

<div class="paragraph"> </div>

 The specifications <span class="inlinecode"><span class="id" title="var">triple_get_field</span></span> and <span class="inlinecode"><span class="id" title="var">triple_set_field</span></span> proved in the
    previous section correspond to small-footprint specifications, with
    preconditions mentioning a single field. Corollaries to these specifications
    can be established with preconditions mentioning a list of fields, with
    preconditions expressed using <span class="inlinecode"><span class="id" title="var">hfields</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_get_field_hfields" class="idref" href="#Realization.triple_get_field_hfields"><span class="id" title="lemma">triple_get_field_hfields</span></a> : <span class="id" title="keyword">∀</span> <a id="kvs:87" class="idref" href="#kvs:87"><span class="id" title="binder">kvs</span></a> <a id="p:88" class="idref" href="#p:88"><span class="id" title="binder">p</span></a> <a id="k:89" class="idref" href="#k:89"><span class="id" title="binder">k</span></a> <a id="v:90" class="idref" href="#v:90"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#hfields_lookup"><span class="id" title="definition">hfields_lookup</span></a> <a class="idref" href="Records.html#k:89"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#kvs:87"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Records.html#v:90"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Records.html#Realization.val_get_field"><span class="id" title="definition">val_get_field</span></a> <a class="idref" href="Records.html#k:89"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#p:88"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#hfields"><span class="id" title="definition">hfields</span></a> <a class="idref" href="Records.html#kvs:87"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Records.html#p:88"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:91" class="idref" href="#r:91"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Records.html#r:91"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Records.html#v:90"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Records.html#hfields"><span class="id" title="definition">hfields</span></a> <a class="idref" href="Records.html#kvs:87"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Records.html#p:88"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">L</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">L</span> <span class="id" title="keyword">as</span> [| [<span class="id" title="var">ki</span> <span class="id" title="var">vi</span>] <span class="id" title="var">L'</span>]; <span class="id" title="tactic">simpl</span>; <span class="id" title="var">introv</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">inverts</span> <span class="id" title="var">E</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">case_if</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">inverts</span> <span class="id" title="var">E</span>. <span class="id" title="tactic">subst</span> <span class="id" title="var">ki</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_conseq_frame"><span class="id" title="lemma">triple_conseq_frame</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Records.html#Realization.triple_get_field"><span class="id" title="lemma">triple_get_field</span></a>. } { <span class="id" title="var">xsimpl</span>. } { <span class="id" title="var">xsimpl</span>*. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_conseq_frame"><span class="id" title="lemma">triple_conseq_frame</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <span class="id" title="var">IHL'</span> <span class="id" title="var">E</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span>*. } } }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_set_field_hfields" class="idref" href="#Realization.triple_set_field_hfields"><span class="id" title="lemma">triple_set_field_hfields</span></a> : <span class="id" title="keyword">∀</span> <a id="kvs:92" class="idref" href="#kvs:92"><span class="id" title="binder">kvs</span></a> <a id="kvs':93" class="idref" href="#kvs':93"><span class="id" title="binder">kvs'</span></a> <a id="k:94" class="idref" href="#k:94"><span class="id" title="binder">k</span></a> <a id="p:95" class="idref" href="#p:95"><span class="id" title="binder">p</span></a> <a id="v:96" class="idref" href="#v:96"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#hfields_update"><span class="id" title="definition">hfields_update</span></a> <a class="idref" href="Records.html#k:94"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#v:96"><span class="id" title="variable">v</span></a> <a class="idref" href="Records.html#kvs:92"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Records.html#kvs':93"><span class="id" title="variable">kvs'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Records.html#Realization.val_set_field"><span class="id" title="definition">val_set_field</span></a> <a class="idref" href="Records.html#k:94"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#p:95"><span class="id" title="variable">p</span></a> <a class="idref" href="Records.html#v:96"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#hfields"><span class="id" title="definition">hfields</span></a> <a class="idref" href="Records.html#kvs:92"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Records.html#p:95"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Records.html#hfields"><span class="id" title="definition">hfields</span></a> <a class="idref" href="Records.html#kvs':93"><span class="id" title="variable">kvs'</span></a> <a class="idref" href="Records.html#p:95"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">kvs</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">kvs</span> <span class="id" title="keyword">as</span> [| [<span class="id" title="var">ki</span> <span class="id" title="var">vi</span>] <span class="id" title="var">kvs'</span>]; <span class="id" title="tactic">simpl</span>; <span class="id" title="var">introv</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">inverts</span> <span class="id" title="var">E</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">case_if</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">inverts</span> <span class="id" title="var">E</span>. <span class="id" title="tactic">subst</span> <span class="id" title="var">ki</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_conseq_frame"><span class="id" title="lemma">triple_conseq_frame</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Records.html#Realization.triple_set_field"><span class="id" title="lemma">triple_set_field</span></a>. } { <span class="id" title="var">xsimpl</span>. } { <span class="id" title="var">xsimpl</span>*. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">cases</span> (<a class="idref" href="Records.html#hfields_update"><span class="id" title="definition">hfields_update</span></a> <span class="id" title="var">k</span> <span class="id" title="var">v</span> <span class="id" title="var">kvs'</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">C<sub>2</sub></span>; <span class="id" title="var">tryfalse</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_conseq_frame"><span class="id" title="lemma">triple_conseq_frame</span></a>. { <span class="id" title="var">applys</span> <span class="id" title="var">IHkvs'</span> <span class="id" title="var">C<sub>2</sub></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span>. } { <span class="id" title="tactic">simpl</span>. <span class="id" title="var">xsimpl</span>*. } } }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab464"></a><h2 class="section">Specification of Record Accesses w.r.t. <span class="inlinecode"><span class="id" title="var">hrecord</span></span></h2>

<div class="paragraph"> </div>

 This section further refines the specification for <span class="inlinecode"><span class="id" title="var">val_get_field</span></span> and
    <span class="inlinecode"><span class="id" title="var">val_set_field</span></span>, into specification expressed using <span class="inlinecode"><span class="id" title="var">hrecord</span></span>. For
    <span class="inlinecode"><span class="id" title="var">val_get_field</span></span>, the proof is straightforward. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_get_field_hrecord" class="idref" href="#Realization.triple_get_field_hrecord"><span class="id" title="lemma">triple_get_field_hrecord</span></a> : <span class="id" title="keyword">∀</span> <a id="kvs:97" class="idref" href="#kvs:97"><span class="id" title="binder">kvs</span></a> <a id="p:98" class="idref" href="#p:98"><span class="id" title="binder">p</span></a> <a id="k:99" class="idref" href="#k:99"><span class="id" title="binder">k</span></a> <a id="v:100" class="idref" href="#v:100"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#hfields_lookup"><span class="id" title="definition">hfields_lookup</span></a> <a class="idref" href="Records.html#k:99"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#kvs:97"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Records.html#v:100"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Records.html#Realization.val_get_field"><span class="id" title="definition">val_get_field</span></a> <a class="idref" href="Records.html#k:99"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#p:98"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#hrecord"><span class="id" title="definition">hrecord</span></a> <a class="idref" href="Records.html#kvs:97"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Records.html#p:98"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:101" class="idref" href="#r:101"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Records.html#r:101"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Records.html#v:100"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Records.html#hrecord"><span class="id" title="definition">hrecord</span></a> <a class="idref" href="Records.html#kvs:97"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Records.html#p:98"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Records.html#hrecord"><span class="id" title="definition">hrecord</span></a>. <span class="id" title="var">xtriple</span>. <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">z</span> <span class="id" title="var">Hz</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span> (<span class="id" title="notation">&gt;&gt;</span> <a class="idref" href="Records.html#Realization.triple_get_field_hfields"><span class="id" title="lemma">triple_get_field_hfields</span></a> <span class="id" title="var">M</span>). <span class="id" title="var">xsimpl</span>*.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
For <span class="inlinecode"><span class="id" title="var">val_set_field</span></span>, however, we need an auxiliary lemma about
    <span class="inlinecode"><span class="id" title="var">hfields_update</span></span>, showing that the update operation preserves the names of
    the fields. This lemma is established in two steps. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.hfields_update_preserves_fields" class="idref" href="#Realization.hfields_update_preserves_fields"><span class="id" title="lemma">hfields_update_preserves_fields</span></a> : <span class="id" title="keyword">∀</span> <a id="kvs:102" class="idref" href="#kvs:102"><span class="id" title="binder">kvs</span></a> <a id="kvs':103" class="idref" href="#kvs':103"><span class="id" title="binder">kvs'</span></a> <a id="k:104" class="idref" href="#k:104"><span class="id" title="binder">k</span></a> <a id="v:105" class="idref" href="#v:105"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#hfields_update"><span class="id" title="definition">hfields_update</span></a> <a class="idref" href="Records.html#k:104"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#v:105"><span class="id" title="variable">v</span></a> <a class="idref" href="Records.html#kvs:102"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Records.html#kvs':103"><span class="id" title="variable">kvs'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">LibList.map</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <a class="idref" href="Records.html#kvs':103"><span class="id" title="variable">kvs'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">LibList.map</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <a class="idref" href="Records.html#kvs:102"><span class="id" title="variable">kvs</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">kvs</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">kvs</span> <span class="id" title="keyword">as</span> [|[<span class="id" title="var">ki</span> <span class="id" title="var">vi</span>] <span class="id" title="var">kvs1</span>]; <span class="id" title="tactic">simpl</span>; <span class="id" title="var">introv</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">_</span> <span class="id" title="var">H</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">H</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">case_if</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">inverts</span> <span class="id" title="var">E</span>. <span class="id" title="var">rew_listx</span>*. <span class="id" title="tactic">subst</span>. <span class="id" title="var">fequals</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">cases</span> (<a class="idref" href="Records.html#hfields_update"><span class="id" title="definition">hfields_update</span></a> <span class="id" title="var">k</span> <span class="id" title="var">v</span> <span class="id" title="var">kvs1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">inverts</span> <span class="id" title="var">E</span>. <span class="id" title="var">rew_listx</span>. <span class="id" title="var">fequals</span>*. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">inverts</span> <span class="id" title="var">E</span>. } } }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.hfields_update_preserves_maps_all_fields" class="idref" href="#Realization.hfields_update_preserves_maps_all_fields"><span class="id" title="lemma">hfields_update_preserves_maps_all_fields</span></a> : <span class="id" title="keyword">∀</span> <a id="kvs:106" class="idref" href="#kvs:106"><span class="id" title="binder">kvs</span></a> <a id="kvs':107" class="idref" href="#kvs':107"><span class="id" title="binder">kvs'</span></a> <a id="z:108" class="idref" href="#z:108"><span class="id" title="binder">z</span></a> <a id="k:109" class="idref" href="#k:109"><span class="id" title="binder">k</span></a> <a id="v:110" class="idref" href="#v:110"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#hfields_update"><span class="id" title="definition">hfields_update</span></a> <a class="idref" href="Records.html#k:109"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#v:110"><span class="id" title="variable">v</span></a> <a class="idref" href="Records.html#kvs:106"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Records.html#kvs':107"><span class="id" title="variable">kvs'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#maps_all_fields"><span class="id" title="definition">maps_all_fields</span></a> <a class="idref" href="Records.html#z:108"><span class="id" title="variable">z</span></a> <a class="idref" href="Records.html#kvs:106"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Records.html#maps_all_fields"><span class="id" title="definition">maps_all_fields</span></a> <a class="idref" href="Records.html#z:108"><span class="id" title="variable">z</span></a> <a class="idref" href="Records.html#kvs':107"><span class="id" title="variable">kvs'</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Records.html#maps_all_fields"><span class="id" title="definition">maps_all_fields</span></a>. <span class="id" title="var">extens</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">rewrites</span>* (<span class="id" title="notation">&gt;&gt;</span> <a class="idref" href="Records.html#Realization.hfields_update_preserves_fields"><span class="id" title="lemma">hfields_update_preserves_fields</span></a> <span class="id" title="var">M</span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
We are then ready to derive the specification for <span class="inlinecode"><span class="id" title="var">val_set_field</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_set_field_hrecord" class="idref" href="#Realization.triple_set_field_hrecord"><span class="id" title="lemma">triple_set_field_hrecord</span></a> : <span class="id" title="keyword">∀</span> <a id="kvs:111" class="idref" href="#kvs:111"><span class="id" title="binder">kvs</span></a> <a id="kvs':112" class="idref" href="#kvs':112"><span class="id" title="binder">kvs'</span></a> <a id="k:113" class="idref" href="#k:113"><span class="id" title="binder">k</span></a> <a id="p:114" class="idref" href="#p:114"><span class="id" title="binder">p</span></a> <a id="v:115" class="idref" href="#v:115"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#hfields_update"><span class="id" title="definition">hfields_update</span></a> <a class="idref" href="Records.html#k:113"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#v:115"><span class="id" title="variable">v</span></a> <a class="idref" href="Records.html#kvs:111"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Records.html#kvs':112"><span class="id" title="variable">kvs'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Records.html#Realization.val_set_field"><span class="id" title="definition">val_set_field</span></a> <a class="idref" href="Records.html#k:113"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#p:114"><span class="id" title="variable">p</span></a> <a class="idref" href="Records.html#v:115"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#hrecord"><span class="id" title="definition">hrecord</span></a> <a class="idref" href="Records.html#kvs:111"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Records.html#p:114"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Records.html#hrecord"><span class="id" title="definition">hrecord</span></a> <a class="idref" href="Records.html#kvs':112"><span class="id" title="variable">kvs'</span></a> <a class="idref" href="Records.html#p:114"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Records.html#hrecord"><span class="id" title="definition">hrecord</span></a>. <span class="id" title="var">xtriple</span>. <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">z</span> <span class="id" title="var">Hz</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span> (<span class="id" title="notation">&gt;&gt;</span> <a class="idref" href="Records.html#Realization.triple_set_field_hfields"><span class="id" title="lemma">triple_set_field_hfields</span></a> <span class="id" title="var">M</span>). <span class="id" title="var">xsimpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">rewrites</span>* &lt;- (<span class="id" title="notation">&gt;&gt;</span> <a class="idref" href="Records.html#Realization.hfields_update_preserves_maps_all_fields"><span class="id" title="lemma">hfields_update_preserves_maps_all_fields</span></a> <span class="id" title="var">z</span> <span class="id" title="var">M</span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab465"></a><h2 class="section">Implementation of Record Allocation without Initialization</h2>

<div class="paragraph"> </div>

 Recall that a record with <span class="inlinecode"><span class="id" title="var">n</span></span> fields is represented as a memory block of
    size <span class="inlinecode"><span class="id" title="var">n</span>+1</span>. The first memory cell in the block corresponds to the header,
    and stores the number of fields, that is, the value <span class="inlinecode"><span class="id" title="var">n</span></span>. The <span class="inlinecode"><span class="id" title="var">n</span></span> other cells
    store the value associated with each of the fields.

<div class="paragraph"> </div>

    The operation that allocates and initializes a fresh record with specific
    values can be implemented in two stages. The first function, named
    <span class="inlinecode"><span class="id" title="var">val_alloc_hrecord</span></span>, takes a list of <span class="inlinecode"><span class="id" title="var">n</span></span> field names, and allocates a record
    with <span class="inlinecode"><span class="id" title="var">n</span></span> fields, with contents specified as "uninitialized". The second
    function, named <span class="inlinecode"><span class="id" title="var">val_new_hrecord</span></span>, takes <span class="inlinecode"><span class="id" title="var">n</span></span> field names and <span class="inlinecode"><span class="id" title="var">n</span></span> values. It
    invokes the first function to allocate the record, then performs one write
    per field to store the provided values into the corresponding memory cells.

<div class="paragraph"> </div>

    The present section focuses on the first part, namely the allocation without
    initialization. The Coq value <span class="inlinecode"><span class="id" title="var">val_alloc_hrecord</span></span> <span class="inlinecode"><span class="id" title="var">ks</span></span> depends on a list of
    field names. This value corresponds to a function that, when applied to a
    unit argument, allocates a record with <span class="inlinecode"><span class="id" title="var">length</span></span> <span class="inlinecode"><span class="id" title="var">ks</span></span> fields. The operation
    <span class="inlinecode">(<span class="id" title="var">val_alloc_hrecord</span></span> <span class="inlinecode"><span class="id" title="var">ks</span>)</span> <span class="inlinecode">()</span> is only specified when <span class="inlinecode"><span class="id" title="var">ks</span></span> corresponds to a
    list of names whose unfolding is of the form <span class="inlinecode">0</span> <span class="inlinecode">::</span> <span class="inlinecode">1</span> <span class="inlinecode">::</span> <span class="inlinecode">2</span> <span class="inlinecode">::</span> <span class="inlinecode">...</span> <span class="inlinecode">(<span class="id" title="var">n</span>-1)</span>.

<div class="paragraph"> </div>

    The implementation of this operation allocates a block of size <span class="inlinecode"><span class="id" title="var">n</span>+1</span> at a
    fresh location <span class="inlinecode"><span class="id" title="var">p</span></span>, then sets the header cell to the value <span class="inlinecode"><span class="id" title="var">n</span></span>, then returns
    the address <span class="inlinecode"><span class="id" title="var">p</span></span>. In the statement below, the expression
    <span class="inlinecode">{<span class="id" title="var">LibListExec.length</span></span> <span class="inlinecode"><span class="id" title="var">ks</span>}</span> in braces computes in Coq the expression
    <span class="inlinecode"><span class="id" title="var">length</span></span> <span class="inlinecode"><span class="id" title="var">ks</span></span>, and inserts the result in the code as a constant integer --
    that is, as a value of the form <span class="inlinecode"><span class="id" title="var">val_int</span></span> <span class="inlinecode">(<span class="id" title="var">LibListExec.length</span></span> <span class="inlinecode"><span class="id" title="var">ks</span>)</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="Realization.val_alloc_hrecord" class="idref" href="#Realization.val_alloc_hrecord"><span class="id" title="definition">val_alloc_hrecord</span></a> (<a id="ks:116" class="idref" href="#ks:116"><span class="id" title="binder">ks</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Records.html#field"><span class="id" title="definition">field</span></a>) : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">v</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">m</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#a15607334da66bc8a82cc392003f629d"><span class="id" title="notation">{</span></a><span class="id" title="definition">LibListExec.length</span> <a class="idref" href="Records.html#ks:116"><span class="id" title="variable">ks</span></a><a class="idref" href="LibSepReference.html#a15607334da66bc8a82cc392003f629d"><span class="id" title="notation">}</span></a> <a class="idref" href="LibSepReference.html#590da34eb63eef1c68773c655749c128"><span class="id" title="notation">+</span></a> 1 <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#Realization.val_alloc"><span class="id" title="axiom">val_alloc</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">m</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#val_set"><span class="id" title="constructor">val_set</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#a15607334da66bc8a82cc392003f629d"><span class="id" title="notation">{</span></a><span class="id" title="definition">LibListExec.length</span> <a class="idref" href="Records.html#ks:116"><span class="id" title="variable">ks</span></a><a class="idref" href="LibSepReference.html#a15607334da66bc8a82cc392003f629d"><span class="id" title="notation">}</span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
A key auxiliary result asserts that, if <span class="inlinecode"><span class="id" title="var">kvs</span></span> is a list of key-value pairs
    such that the keys correspond to consecutive field names, then a list of
    fields described as <span class="inlinecode"><span class="id" title="var">hfields</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> corresponds to a range of consecutive
    cells as described by <span class="inlinecode"><span class="id" title="var">hrange</span></span> <span class="inlinecode">(<span class="id" title="var">List.map</span></span> <span class="inlinecode"><span class="id" title="var">snd</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span>)</span> <span class="inlinecode">(<span class="id" title="var">p</span>+1)</span>, for the definition
    of <span class="inlinecode"><span class="id" title="var">hrange</span></span> given in <a href="Arrays.html"><span class="inlineref">Arrays</span></a>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.hfields_eq_hrange" class="idref" href="#Realization.hfields_eq_hrange"><span class="id" title="lemma">hfields_eq_hrange</span></a> : <span class="id" title="keyword">∀</span> <a id="z:117" class="idref" href="#z:117"><span class="id" title="binder">z</span></a> <a id="L:118" class="idref" href="#L:118"><span class="id" title="binder">L</span></a> <a id="p:119" class="idref" href="#p:119"><span class="id" title="binder">p</span></a> <a id="kvs:120" class="idref" href="#kvs:120"><span class="id" title="binder">kvs</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#maps_all_fields"><span class="id" title="definition">maps_all_fields</span></a> <a class="idref" href="Records.html#z:117"><span class="id" title="variable">z</span></a> <a class="idref" href="Records.html#kvs:120"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#z:117"><span class="id" title="variable">z</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Records.html#L:118"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#L:118"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">LibList.map</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> <a class="idref" href="Records.html#kvs:120"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#hfields"><span class="id" title="definition">hfields</span></a> <a class="idref" href="Records.html#kvs:120"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Records.html#p:119"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#Realization.hrange"><span class="id" title="definition">hrange</span></a> <a class="idref" href="Records.html#L:118"><span class="id" title="variable">L</span></a> (<a class="idref" href="Records.html#p:119"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1)%<span class="id" title="var">nat</span>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">asserts</span> <span class="id" title="var">Ind</span>: (<span class="id" title="keyword">∀</span> <a id="L:125" class="idref" href="#L:125"><span class="id" title="binder">L</span></a> <a id="p:126" class="idref" href="#p:126"><span class="id" title="binder">p</span></a> <a id="kvs:127" class="idref" href="#kvs:127"><span class="id" title="binder">kvs</span></a> <a id="o:128" class="idref" href="#o:128"><span class="id" title="binder">o</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">LibList.map</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <a class="idref" href="Records.html#kvs:123"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">nat_seq</span> <a class="idref" href="Records.html#o:124"><span class="id" title="variable">o</span></a> (<span class="id" title="definition">length</span> <a class="idref" href="Records.html#L:121"><span class="id" title="variable">L</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#L:121"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">LibList.map</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> <a class="idref" href="Records.html#kvs:123"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#hfields"><span class="id" title="definition">hfields</span></a> <a class="idref" href="Records.html#kvs:123"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Records.html#p:122"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Arrays.html#Realization.hrange"><span class="id" title="definition">hrange</span></a> <a class="idref" href="Records.html#L:121"><span class="id" title="variable">L</span></a> (<a class="idref" href="Records.html#p:122"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a><a class="idref" href="Records.html#o:124"><span class="id" title="variable">o</span></a>)%<span class="id" title="var">nat</span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">L</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">L</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">v</span> <span class="id" title="var">L'</span>]; <span class="id" title="var">introv</span> <span class="id" title="var">M</span> <span class="id" title="var">E</span>; <span class="id" title="var">rew_listx</span> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">kvs</span> <span class="id" title="keyword">as</span> [|[<span class="id" title="var">k</span> <span class="id" title="var">v'</span>] <span class="id" title="var">kvs'</span>]; <span class="id" title="var">tryfalse</span>; <span class="id" title="var">rew_listx</span> <span class="id" title="keyword">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">simpls</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">M</span> <span class="id" title="keyword">as</span> <span class="id" title="var">M'</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">E</span> <span class="id" title="keyword">as</span> <span class="id" title="var">E'</span>. <span class="id" title="var">rew_listx</span> <span class="id" title="keyword">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Records.html#hfield"><span class="id" title="definition">hfield</span></a>. <span class="id" title="var">fequals</span>. <span class="id" title="var">math_rewrite</span> (<span class="id" title="var">p</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a><span class="id" title="var">o</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><span class="id" title="var">p</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+(</span></a><span class="id" title="var">o</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">nat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">applys</span>* <span class="id" title="var">IHL'</span>. <span class="id" title="var">math_rewrite</span>* (<span class="id" title="var">o</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">o</span>)%<span class="id" title="var">nat</span>. } }<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span> <span class="id" title="var">HL</span> <span class="id" title="var">E</span>. <span class="id" title="tactic">subst</span> <span class="id" title="var">z</span>. <span class="id" title="var">rewrites</span> (<span class="id" title="notation">&gt;&gt;</span> <span class="id" title="var">Ind</span> <span class="id" title="var">M</span> <span class="id" title="var">E</span>). <span class="id" title="var">fequals</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>. <span class="id" title="var">math</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The specification of <span class="inlinecode"><span class="id" title="var">val_alloc_hrecord</span></span> <span class="inlinecode"><span class="id" title="var">ks</span></span> involves an empty precondition
    and a postcondition of the form <span class="inlinecode"><span class="id" title="var">hrecord</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>, where the list <span class="inlinecode"><span class="id" title="var">kvs</span></span> maps
    the fields names from <span class="inlinecode"><span class="id" title="var">ks</span></span> to the value <span class="inlinecode"><span class="id" title="var">val_uninit</span></span>. The premise
    <span class="inlinecode"><span class="id" title="var">ks</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">nat_seq</span></span> <span class="inlinecode">0</span> <span class="inlinecode">(<span class="id" title="var">length</span></span> <span class="inlinecode"><span class="id" title="var">ks</span>)</span> checks that the list <span class="inlinecode"><span class="id" title="var">ks</span></span> contains consecutive
    offsets starting from zero.

<div class="paragraph"> </div>

    Recall that <span class="inlinecode"><span class="id" title="var">LibListExec.length</span></span> is a variant of <span class="inlinecode"><span class="id" title="var">LibList.length</span></span> that
    computes in Coq (using <span class="inlinecode"><span class="id" title="tactic">simpl</span></span> or <span class="inlinecode"><span class="id" title="tactic">reflexivity</span></span>). Likewise <span class="inlinecode"><span class="id" title="var">LibListExec.map</span></span>
    is a computable version of <span class="inlinecode"><span class="id" title="var">LibList.map</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_alloc_hrecord" class="idref" href="#Realization.triple_alloc_hrecord"><span class="id" title="lemma">triple_alloc_hrecord</span></a> : <span class="id" title="keyword">∀</span> <a id="ks:129" class="idref" href="#ks:129"><span class="id" title="binder">ks</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#ks:129"><span class="id" title="variable">ks</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">nat_seq</span> 0 (<span class="id" title="definition">LibListExec.length</span> <a class="idref" href="Records.html#ks:129"><span class="id" title="variable">ks</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> ((<a class="idref" href="Records.html#Realization.val_alloc_hrecord"><span class="id" title="definition">val_alloc_hrecord</span></a> <a class="idref" href="Records.html#ks:129"><span class="id" title="variable">ks</span></a>) <a class="idref" href="LibSepReference.html#3127c6bc552ca21a494fc6e3474a507d"><span class="id" title="notation">()</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:132" class="idref" href="#p:132"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Records.html#hrecord"><span class="id" title="definition">hrecord</span></a> (<span class="id" title="definition">LibListExec.map</span> (<span class="id" title="keyword">fun</span> <a id="k:133" class="idref" href="#k:133"><span class="id" title="binder">k</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#k:133"><span class="id" title="variable">k</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="LibSepReference.html#val_uninit"><span class="id" title="constructor">val_uninit</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>) <a class="idref" href="Records.html#ks:129"><span class="id" title="variable">ks</span></a>) <a class="idref" href="Records.html#p:130"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">Hks</span>. <span class="id" title="var">xwp</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xapp</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">p</span> <span class="id" title="var">Hp</span>. <span class="id" title="var">unfolds</span> <a class="idref" href="Records.html#field"><span class="id" title="definition">field</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">LibListExec.length_eq</span> <span class="id" title="keyword">in</span> *. <span class="id" title="tactic">set</span> (<span class="id" title="var">n</span> := <span class="id" title="definition">length</span> <span class="id" title="var">ks</span>) <span class="id" title="keyword">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="var">math_rewrite</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">n</span> <span class="id" title="notation">+</span> <span class="id" title="notation">1)</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">n</span>). <span class="id" title="var">rew_listx</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span>. <span class="id" title="var">xval</span>. <span class="id" title="var">xsimpl</span>*. <span class="id" title="tactic">unfold</span> <a class="idref" href="Records.html#hrecord"><span class="id" title="definition">hrecord</span></a>. <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">rew_list_exec</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">asserts</span> <span class="id" title="var">R</span>: (<a class="idref" href="Records.html#maps_all_fields"><span class="id" title="definition">maps_all_fields</span></a> <span class="id" title="var">n</span> (<span class="id" title="definition">LibList.map</span> (<span class="id" title="keyword">fun</span> <a id="k:135" class="idref" href="#k:135"><span class="id" title="binder">k</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#k:134"><span class="id" title="variable">k</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#val_uninit"><span class="id" title="constructor">val_uninit</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>) <span class="id" title="var">ks</span>)).<br/>
&nbsp;&nbsp;{ <span class="id" title="var">unfolds</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hks</span>. <span class="id" title="var">clears</span> <span class="id" title="var">ks</span> <span class="id" title="var">p</span>. <span class="id" title="tactic">generalize</span> 0%<span class="id" title="var">nat</span> <span class="id" title="keyword">as</span> <span class="id" title="var">o</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">n'</span>]; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="var">rew_listx</span>; <span class="id" title="var">fequals</span>*. }<br/>
&nbsp;&nbsp;<span class="id" title="var">xsimpl</span>* <span class="id" title="var">n</span>. <span class="id" title="var">xchange</span>* &lt;- (@<a class="idref" href="Records.html#Realization.hfields_eq_hrange"><span class="id" title="lemma">hfields_eq_hrange</span></a> <span class="id" title="var">n</span>). { <span class="id" title="var">rew_listx</span>*. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">unfold</span> <span class="id" title="var">n</span>. <span class="id" title="var">clears</span> <span class="id" title="var">n</span> <span class="id" title="var">p</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">ks</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">ks'</span>]; <span class="id" title="var">rew_listx</span>; <span class="id" title="var">fequals</span>*. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
#[<span class="id" title="var">global</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Resolve</span> <span class="id" title="var">triple_alloc_hrecord</span> : <span class="id" title="var">triple</span>.<br/>
</div>

<div class="doc">
The interest of using the computable counterparts of the function <span class="inlinecode"><span class="id" title="var">length</span></span>
    and <span class="inlinecode"><span class="id" title="var">map</span></span> is that a call to <span class="inlinecode"><span class="id" title="tactic">simpl</span></span> will yield exactly the expected result,
    with lists indexed using field names. For example, the allocation of a list
    cell is specified as follows. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_alloc_mcons" class="idref" href="#Realization.triple_alloc_mcons"><span class="id" title="lemma">triple_alloc_mcons</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Records.html#Realization.val_alloc_hrecord"><span class="id" title="definition">val_alloc_hrecord</span></a> (<a class="idref" href="Records.html#head"><span class="id" title="definition">head</span></a><span class="id" title="notation">::</span><a class="idref" href="Records.html#tail"><span class="id" title="definition">tail</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>) <a class="idref" href="LibSepReference.html#3127c6bc552ca21a494fc6e3474a507d"><span class="id" title="notation">()</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:138" class="idref" href="#p:138"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Records.html#p:136"><span class="id" title="variable">p</span></a> <a class="idref" href="Records.html#4fdf8be3226dc6822dfa0caeb9414d<sub>46</sub>"><span class="id" title="notation">~~~&gt;</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">`{</span></a> <a class="idref" href="Records.html#head"><span class="id" title="definition">head</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="LibSepReference.html#val_uninit"><span class="id" title="constructor">val_uninit</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Records.html#tail"><span class="id" title="definition">tail</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="LibSepReference.html#val_uninit"><span class="id" title="constructor">val_uninit</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">}</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">dup</span>.<br/>
&nbsp;&nbsp;{ <span class="comment">(*&nbsp;Detailed&nbsp;proof:&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="Records.html#Realization.triple_alloc_hrecord"><span class="id" title="lemma">triple_alloc_hrecord</span></a>. <span class="id" title="tactic">simpl</span>. <span class="id" title="var">rew_listx</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;{ <span class="comment">(*&nbsp;Short&nbsp;proof:&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">applys</span>* <a class="idref" href="Records.html#Realization.triple_alloc_hrecord"><span class="id" title="lemma">triple_alloc_hrecord</span></a>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab466"></a><h2 class="section">Implementation of Record Allocation with Initialization</h2>

<div class="paragraph"> </div>

 We now show the implementation of record initialization in the particular
    case of records with exactly 2 fields. Recall that <span class="inlinecode"><span class="id" title="var">val_new_hrecord_2</span></span> <span class="inlinecode"><span class="id" title="var">k<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">k<sub>2</sub></span></span>
    denotes a Coq value of type <span class="inlinecode"><span class="id" title="var">val</span></span>, which may be applied in the grammar of
    terms to two arguments, <span class="inlinecode"><span class="id" title="var">x<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">x<sub>2</sub></span></span>. The definition below shows an
    implementation for <span class="inlinecode"><span class="id" title="var">val_new_hrecord_2</span></span>. In this definition, the expression
    in braces <span class="inlinecode"><span class="id" title="var">val_alloc_hrecord</span></span> <span class="inlinecode">(<span class="id" title="var">k<sub>1</sub></span>::<span class="id" title="var">k<sub>2</sub></span>::<span class="id" title="var">nil</span>)</span> refers to a Coq term, embedded
    in the syntax of program terms. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="Realization.val_new_hrecord_2" class="idref" href="#Realization.val_new_hrecord_2"><span class="id" title="definition">val_new_hrecord_2</span></a> (<a id="k<sub>1</sub>:139" class="idref" href="#k<sub>1</sub>:139"><span class="id" title="binder">k<sub>1</sub></span></a>:<a class="idref" href="Records.html#field"><span class="id" title="definition">field</span></a>) (<a id="k<sub>2</sub>:140" class="idref" href="#k<sub>2</sub>:140"><span class="id" title="binder">k<sub>2</sub></span></a>:<a class="idref" href="Records.html#field"><span class="id" title="definition">field</span></a>) : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#bfe3f2ff4c10f23c7c7f24aa5367bca5"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x<sub>1</sub>'"><span class="id" title="notation">x<sub>1</sub></span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x<sub>2</sub>'"><span class="id" title="notation">x<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#bfe3f2ff4c10f23c7c7f24aa5367bca5"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#a15607334da66bc8a82cc392003f629d"><span class="id" title="notation">{</span></a><a class="idref" href="Records.html#Realization.val_alloc_hrecord"><span class="id" title="definition">val_alloc_hrecord</span></a> (<a class="idref" href="Records.html#k<sub>1</sub>:139"><span class="id" title="variable">k<sub>1</sub></span></a><span class="id" title="notation">::</span><a class="idref" href="Records.html#k<sub>2</sub>:140"><span class="id" title="variable">k<sub>2</sub></span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>)<a class="idref" href="LibSepReference.html#a15607334da66bc8a82cc392003f629d"><span class="id" title="notation">}</span></a> <a class="idref" href="LibSepReference.html#71337baa9b3f1f61552031a8e9cb9237"><span class="id" title="notation">()</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="Records.html#975e54956157dbd0f90c3fa0e2d977fe"><span class="id" title="notation">`.</span></a><a class="idref" href="Records.html#k<sub>1</sub>:139"><span class="id" title="variable">k<sub>1</sub></span></a> <a class="idref" href="Records.html#975e54956157dbd0f90c3fa0e2d977fe"><span class="id" title="notation">:=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x<sub>1</sub>'"><span class="id" title="notation">x<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="Records.html#975e54956157dbd0f90c3fa0e2d977fe"><span class="id" title="notation">`.</span></a><a class="idref" href="Records.html#k<sub>2</sub>:140"><span class="id" title="variable">k<sub>2</sub></span></a> <a class="idref" href="Records.html#975e54956157dbd0f90c3fa0e2d977fe"><span class="id" title="notation">:=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x<sub>2</sub>'"><span class="id" title="notation">x<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
To improve readability, we introduce notation to allow writing, e.g.,
    <span class="inlinecode">`{</span> <span class="inlinecode"><span class="id" title="var">head</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">x</span>;</span> <span class="inlinecode"><span class="id" title="var">tail</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">q</span></span> <span class="inlinecode">}</span> for the allocation and initialization of a list
    cell. 
</div>
<div class="code">

<span class="id" title="keyword">Notation</span> <a id="3b65ba0e5eac7befd5a9a6481d29d186" class="idref" href="#3b65ba0e5eac7befd5a9a6481d29d186"><span class="id" title="notation">&quot;</span></a>`{ k<sub>1</sub> := v<sub>1</sub> ; k<sub>2</sub> := v<sub>2</sub> }" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="Records.html#Realization.val_new_hrecord_2"><span class="id" title="definition">val_new_hrecord_2</span></a> <span class="id" title="var">k<sub>1</sub></span> <span class="id" title="var">k<sub>2</sub></span> <span class="id" title="var">v<sub>1</sub></span> <span class="id" title="var">v<sub>2</sub></span>)<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">trm</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 65,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">k<sub>1</sub></span>, <span class="id" title="var">k<sub>2</sub></span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">v<sub>1</sub></span>, <span class="id" title="var">v<sub>2</sub></span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 65) : <span class="id" title="var">trm_scope_ext</span>.<br/>
</div>

<div class="doc">
This operation is specified as follows. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_new_hrecord_2" class="idref" href="#Realization.triple_new_hrecord_2"><span class="id" title="lemma">triple_new_hrecord_2</span></a> : <span class="id" title="keyword">∀</span> <a id="k<sub>1</sub>:141" class="idref" href="#k<sub>1</sub>:141"><span class="id" title="binder">k<sub>1</sub></span></a> <a id="k<sub>2</sub>:142" class="idref" href="#k<sub>2</sub>:142"><span class="id" title="binder">k<sub>2</sub></span></a> <a id="v<sub>1</sub>:143" class="idref" href="#v<sub>1</sub>:143"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="v<sub>2</sub>:144" class="idref" href="#v<sub>2</sub>:144"><span class="id" title="binder">v<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#k<sub>1</sub>:141"><span class="id" title="variable">k<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 0%<span class="id" title="var">nat</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#k<sub>2</sub>:142"><span class="id" title="variable">k<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 1%<span class="id" title="var">nat</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="Records.html#3b65ba0e5eac7befd5a9a6481d29d186"><span class="id" title="notation">`{</span></a> <a class="idref" href="Records.html#k<sub>1</sub>:141"><span class="id" title="variable">k<sub>1</sub></span></a> <a class="idref" href="Records.html#3b65ba0e5eac7befd5a9a6481d29d186"><span class="id" title="notation">:=</span></a> <a class="idref" href="Records.html#v<sub>1</sub>:143"><span class="id" title="variable">v<sub>1</sub></span></a><a class="idref" href="Records.html#3b65ba0e5eac7befd5a9a6481d29d186"><span class="id" title="notation">;</span></a> <a class="idref" href="Records.html#k<sub>2</sub>:142"><span class="id" title="variable">k<sub>2</sub></span></a> <a class="idref" href="Records.html#3b65ba0e5eac7befd5a9a6481d29d186"><span class="id" title="notation">:=</span></a> <a class="idref" href="Records.html#v<sub>2</sub>:144"><span class="id" title="variable">v<sub>2</sub></span></a> <a class="idref" href="Records.html#3b65ba0e5eac7befd5a9a6481d29d186"><span class="id" title="notation">}</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:147" class="idref" href="#p:147"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Records.html#p:145"><span class="id" title="variable">p</span></a> <a class="idref" href="Records.html#4fdf8be3226dc6822dfa0caeb9414d<sub>46</sub>"><span class="id" title="notation">~~~&gt;</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">`{</span></a> <a class="idref" href="Records.html#k<sub>1</sub>:141"><span class="id" title="variable">k<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Records.html#v<sub>1</sub>:143"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Records.html#k<sub>2</sub>:142"><span class="id" title="variable">k<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Records.html#v<sub>2</sub>:144"><span class="id" title="variable">v<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">}</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> → →. <span class="id" title="var">xwp</span>. <span class="id" title="var">xapp</span> <a class="idref" href="Records.html#Realization.triple_alloc_hrecord"><span class="id" title="lemma">triple_alloc_hrecord</span></a>. { <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">p</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span> <a class="idref" href="Records.html#Realization.triple_set_field_hrecord"><span class="id" title="lemma">triple_set_field_hrecord</span></a>. { <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span> <a class="idref" href="Records.html#Realization.triple_set_field_hrecord"><span class="id" title="lemma">triple_set_field_hrecord</span></a>. { <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="var">xval</span>. <span class="id" title="var">xsimpl</span>*.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="Records.html#Realization"><span class="id" title="module">Realization</span></a>.<br/>
</div>

<div class="doc">
This completes the verification of the implementation of record operations
    in terms of block allocation and pointer arithmetic. The generalization of
    <span class="inlinecode"><span class="id" title="var">val_new_hrecord_2</span></span> to handle arbitrary arities involves more technical
    meta-programming, beyond the scope of this course. 
</div>

<div class="doc">
<a id="lab467"></a><h2 class="section">Extending <span class="inlinecode"><span class="id" title="var">xapp</span></span> to Support Record Access Operations</h2>

<div class="paragraph"> </div>

 This section generalizes the tactic <span class="inlinecode"><span class="id" title="var">xapp</span></span> to enable it to automatically
    reason about read and write on records specified using <span class="inlinecode"><span class="id" title="var">hrecord</span></span>. The lemma
    <span class="inlinecode"><span class="id" title="var">xapp_get_field_lemma</span></span> reformulates the specification
    <span class="inlinecode"><span class="id" title="var">triple_get_field_hrecord</span></span> in weakest-precondition form. Its statement takes
    the form:
    <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class='gray-font'>\</span><span class="id" title="tactic">∃</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span>,</span> <span class="inlinecode">(<span class="id" title="var">hrecord</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode"><span class="id" title="var">p</span>)</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode">(<span class="id" title="keyword">match</span></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="keyword">with</span></span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode">..</span> <span class="inlinecode">⇒</span> <span class="inlinecode">..)</span>,
    where the <span class="inlinecode"><span class="id" title="keyword">match</span></span> construct reflects the preconditions
    <span class="inlinecode"><span class="id" title="var">hfields_lookup</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="xapp_get_field_lemma" class="idref" href="#xapp_get_field_lemma"><span class="id" title="lemma">xapp_get_field_lemma</span></a> : <span class="id" title="keyword">∀</span> <a id="H:148" class="idref" href="#H:148"><span class="id" title="binder">H</span></a> <a id="k:149" class="idref" href="#k:149"><span class="id" title="binder">k</span></a> <a id="p:150" class="idref" href="#p:150"><span class="id" title="binder">p</span></a> <a id="Q:151" class="idref" href="#Q:151"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#H:148"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="kvs:152" class="idref" href="#kvs:152"><span class="id" title="binder">kvs</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#hrecord"><span class="id" title="definition">hrecord</span></a> <a class="idref" href="Records.html#kvs:152"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Records.html#p:150"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Records.html#hfields_lookup"><span class="id" title="definition">hfields_lookup</span></a> <a class="idref" href="Records.html#k:149"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#kvs:152"><span class="id" title="variable">kvs</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">v</span> ⇒ (<a class="idref" href="LibSepReference.html#5609a52f091556b9923d5758aa61f543"><span class="id" title="notation">(</span></a><span class="id" title="keyword">fun</span> <a id="r:153" class="idref" href="#r:153"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Records.html#r:153"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">v</span><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Records.html#hrecord"><span class="id" title="definition">hrecord</span></a> <a class="idref" href="Records.html#kvs:152"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Records.html#p:150"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#5609a52f091556b9923d5758aa61f543"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#5609a52f091556b9923d5758aa61f543"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="LibSepReference.html#HS.protect"><span class="id" title="definition">protect</span></a> <a class="idref" href="Records.html#Q:151"><span class="id" title="variable">Q</span></a>) <span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#H:148"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#wpgen_app"><span class="id" title="definition">wpgen_app</span></a> (<a class="idref" href="Records.html#val_get_field"><span class="id" title="axiom">val_get_field</span></a> <a class="idref" href="Records.html#k:149"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#p:150"><span class="id" title="variable">p</span></a>) <a class="idref" href="Records.html#Q:151"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">N</span>. <span class="id" title="var">xchange</span> <span class="id" title="var">N</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">kvs</span>. <span class="id" title="var">cases</span> (<a class="idref" href="Records.html#hfields_lookup"><span class="id" title="definition">hfields_lookup</span></a> <span class="id" title="var">k</span> <span class="id" title="var">kvs</span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">unfold</span> <a class="idref" href="LibSepReference.html#wpgen_app"><span class="id" title="definition">wpgen_app</span></a>. <span class="id" title="var">xsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#triple_conseq_frame"><span class="id" title="lemma">triple_conseq_frame</span></a> <a class="idref" href="Records.html#triple_get_field_hrecord"><span class="id" title="axiom">triple_get_field_hrecord</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">r</span> →. <span class="id" title="var">xchange</span> (<a class="idref" href="LibSepReference.html#SepSimplArgs.qwand_specialize"><span class="id" title="lemma">qwand_specialize</span></a> <span class="id" title="var">v</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span>* <a class="idref" href="LibSepReference.html#SepSimplArgs.hwand_hpure_l"><span class="id" title="lemma">hwand_hpure_l</span></a>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xpull</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Likewise, the lemma <span class="inlinecode"><span class="id" title="var">xapp_set_field_lemma</span></span> reformulates the specification
    <span class="inlinecode"><span class="id" title="var">triple_set_field_hrecord</span></span>. The assumption
    <span class="inlinecode"><span class="id" title="var">hfields_update</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode"><span class="id" title="var">ks'</span></span> is also captured by a pattern matching.
    
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="xapp_set_field_lemma" class="idref" href="#xapp_set_field_lemma"><span class="id" title="lemma">xapp_set_field_lemma</span></a> : <span class="id" title="keyword">∀</span> <a id="H:154" class="idref" href="#H:154"><span class="id" title="binder">H</span></a> <a id="k:155" class="idref" href="#k:155"><span class="id" title="binder">k</span></a> <a id="p:156" class="idref" href="#p:156"><span class="id" title="binder">p</span></a> <a id="v:157" class="idref" href="#v:157"><span class="id" title="binder">v</span></a> <a id="Q:158" class="idref" href="#Q:158"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#H:154"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="kvs:159" class="idref" href="#kvs:159"><span class="id" title="binder">kvs</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#hrecord"><span class="id" title="definition">hrecord</span></a> <a class="idref" href="Records.html#kvs:159"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Records.html#p:156"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Records.html#hfields_update"><span class="id" title="definition">hfields_update</span></a> <a class="idref" href="Records.html#k:155"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#v:157"><span class="id" title="variable">v</span></a> <a class="idref" href="Records.html#kvs:159"><span class="id" title="variable">kvs</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">kvs'</span> ⇒ (<a class="idref" href="LibSepReference.html#5609a52f091556b9923d5758aa61f543"><span class="id" title="notation">(</span></a><span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Records.html#hrecord"><span class="id" title="definition">hrecord</span></a> <span class="id" title="var">kvs'</span> <a class="idref" href="Records.html#p:156"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#5609a52f091556b9923d5758aa61f543"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#5609a52f091556b9923d5758aa61f543"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="LibSepReference.html#HS.protect"><span class="id" title="definition">protect</span></a> <a class="idref" href="Records.html#Q:158"><span class="id" title="variable">Q</span></a>) <span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#H:154"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#wpgen_app"><span class="id" title="definition">wpgen_app</span></a> (<a class="idref" href="Records.html#val_set_field"><span class="id" title="axiom">val_set_field</span></a> <a class="idref" href="Records.html#k:155"><span class="id" title="variable">k</span></a> <a class="idref" href="Records.html#p:156"><span class="id" title="variable">p</span></a> <a class="idref" href="Records.html#v:157"><span class="id" title="variable">v</span></a>) <a class="idref" href="Records.html#Q:158"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">N</span>. <span class="id" title="var">xchange</span> <span class="id" title="var">N</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">kvs</span>. <span class="id" title="var">cases</span> (<a class="idref" href="Records.html#hfields_update"><span class="id" title="definition">hfields_update</span></a> <span class="id" title="var">k</span> <span class="id" title="var">v</span> <span class="id" title="var">kvs</span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">unfold</span> <a class="idref" href="LibSepReference.html#wpgen_app"><span class="id" title="definition">wpgen_app</span></a>. <span class="id" title="var">xsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#triple_conseq_frame"><span class="id" title="lemma">triple_conseq_frame</span></a> <a class="idref" href="Records.html#triple_set_field_hrecord"><span class="id" title="axiom">triple_set_field_hrecord</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">r</span>. <span class="id" title="var">xchange</span> (<a class="idref" href="LibSepReference.html#SepSimplArgs.qwand_specialize"><span class="id" title="lemma">qwand_specialize</span></a> <span class="id" title="var">r</span>). } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xpull</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The hook <span class="inlinecode"><span class="id" title="var">xapp_nosubst_for_records</span></span>, invoked by <span class="inlinecode"><span class="id" title="var">xapp</span></span>, is then implemented
    by exploiting the two lemmas above, in conjunction with <span class="inlinecode"><span class="id" title="var">xsimpl</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Ltac</span> <span class="id" title="var">xapp_nosubst_for_records</span> <span class="id" title="var">tt</span> <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">first</span> [ <span class="id" title="var">applys</span> <a class="idref" href="Records.html#xapp_set_field_lemma"><span class="id" title="lemma">xapp_set_field_lemma</span></a>; <span class="id" title="var">xsimpl</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="var">xapp_simpl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">applys</span> <a class="idref" href="Records.html#xapp_get_field_lemma"><span class="id" title="lemma">xapp_get_field_lemma</span></a>; <span class="id" title="var">xsimpl</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="var">xapp_simpl</span> ].<br/>
</div>

<div class="doc">
The above definition is the one used in <span class="inlinecode"><span class="id" title="var">LibSepReference</span></span>. It was put to
    practice in the chapters <a href="Basic.html"><span class="inlineref">Basic</span></a> and <a href="Repr.html"><span class="inlineref">Repr</span></a>. 
</div>
<div class="code">

<span class="comment">(*&nbsp;2024-12-25&nbsp;21:19&nbsp;*)</span><br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>