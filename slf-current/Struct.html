<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>Struct: Arrays and Records</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/slf.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 6: Separation Logic Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">Struct<span class="subtitle">Arrays and Records</span></h1>


<div class="code">

<span class="id" title="keyword">Set Implicit Arguments</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">SLF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="LibSepReference.html#"><span class="id" title="library">LibSepReference</span></a> <span class="id" title="library">LibSepTLCbuffer</span>.<br/>
<span class="id" title="keyword">Hint Rewrite</span> <a class="idref" href="LibSepFmap.html#conseq_cons'"><span class="id" title="lemma">conseq_cons'</span></a> : <span class="id" title="var">rew_listx</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">P</span> : <span class="id" title="keyword">Prop</span>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">H</span> : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">Q</span> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span> : <a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">k</span> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> : <span class="id" title="notation">int</span>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">v</span> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">L</span> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">z</span> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>.<br/>
</div>

<div class="doc">
<a id="lab387"></a><h1 class="section">First Pass</h1>

<div class="paragraph"> </div>

 This chapter introduces support for reasoning about arrays and records.

<div class="paragraph"> </div>

    In the first part of this chapter, we present the representation predicates
    for these structures, and present the statement of the specifications
    associated with operations on arrays and records.

<div class="paragraph"> </div>

    In the second part of this chapter, we show how these specifications can
    be realized, with respect to a memory model that exposes a representation
    of headers for allocated blocks. More precisely, we show how to implement
    array and record operations using a pointer arithmetic primitive operation,
    and we establish the correctness of the specifications with respect to
    the semantics of the allocation, deallocation, and pointer arithmetic
    operations.

<div class="paragraph"> </div>

    The memory model that we consider is somewhat artificial, in the sense that
    it does not perfectly match the memory model of an existing language----it
    lies somewhere between the memory model of C and that of OCaml.
    Nevertheless, this memory model has the benefits of its simplicity, and it
    suffices to illustrate formal proofs involving block headers and pointer
    arithmetics. 
</div>

<div class="doc">
<a id="lab388"></a><h2 class="section">Representation of a Set of Consecutive Cells</h2>

<div class="paragraph"> </div>

 The cells from an array of length <span class="inlinecode"><span class="id" title="var">k</span></span> can be represented as a range of <span class="inlinecode"><span class="id" title="var">k</span></span>
    consecutive cells, starting at some location <span class="inlinecode"><span class="id" title="var">p</span></span>. In other words, the
    array cells have addresses from <span class="inlinecode"><span class="id" title="var">p</span></span> inclusive to <span class="inlinecode"><span class="id" title="var">p</span>+<span class="id" title="var">k</span></span> exclusive.

<div class="paragraph"> </div>

    The heap predicate <span class="inlinecode"><span class="id" title="var">hcells</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> represents a consecutive set of cells
    starting at location <span class="inlinecode"><span class="id" title="var">p</span></span> and whose elements are described by the list <span class="inlinecode"><span class="id" title="var">L</span></span>.
    The length of the list <span class="inlinecode"><span class="id" title="var">L</span></span> corresponds to the length of the array.

<div class="paragraph"> </div>

    On paper, we could write something along the lines of:
    <span class="inlinecode">\<span class="id" title="var">bigstar_</span>{<span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="tactic">at</span></span> <span class="inlinecode"><span class="id" title="var">index</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="id" title="keyword">in</span></span> <span class="inlinecode"><span class="id" title="var">L</span>}</span> <span class="inlinecode">{</span> <span class="inlinecode">(<span class="id" title="var">p</span>+<span class="id" title="var">i</span>)</span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">}</span>.

<div class="paragraph"> </div>

    In Coq, we define the predicate <span class="inlinecode"><span class="id" title="var">hcells</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> by recursion on the list <span class="inlinecode"><span class="id" title="var">L</span></span>,
    with the pointer <span class="inlinecode"><span class="id" title="var">p</span></span> incremented by one unit at each cell, as follows. 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <a id="hcells" class="idref" href="#hcells"><span class="id" title="definition">hcells</span></a> (<a id="L:1" class="idref" href="#L:1"><span class="id" title="binder">L</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) (<a id="p:2" class="idref" href="#p:2"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Struct.html#L:1"><span class="id" title="variable">L</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> ⇒ <a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;| <span class="id" title="var">x</span><span class="id" title="notation">::</span><span class="id" title="var">L'</span> ⇒ <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#p:2"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <span class="id" title="var">x</span><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#hcells:3"><span class="id" title="definition">hcells</span></a> <span class="id" title="var">L'</span> (<a class="idref" href="Struct.html#p:2"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1)%<span class="id" title="var">nat</span><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
The description of a set of consecutive cells can be split in two
    parts, at an arbitrary index. Concretely, if we have
    <span class="inlinecode"><span class="id" title="var">hcells</span></span> <span class="inlinecode">(<span class="id" title="var">L<sub>1</sub></span>++<span class="id" title="var">L<sub>2</sub></span>)</span> <span class="inlinecode"><span class="id" title="var">p</span></span>, then we can separate the left part
    <span class="inlinecode"><span class="id" title="var">hcells</span></span> <span class="inlinecode"><span class="id" title="var">L<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> from the right part <span class="inlinecode"><span class="id" title="var">hcells</span></span> <span class="inlinecode"><span class="id" title="var">L<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">q</span></span>, where the address
    <span class="inlinecode"><span class="id" title="var">q</span></span> is equal to <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">length</span></span> <span class="inlinecode"><span class="id" title="var">L<sub>1</sub></span></span>. Reciprocally, the two parts can
    be merged back into the original form at any time. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="hcells_concat_eq" class="idref" href="#hcells_concat_eq"><span class="id" title="axiom">hcells_concat_eq</span></a> : <span class="id" title="keyword">∀</span> <a id="p:5" class="idref" href="#p:5"><span class="id" title="binder">p</span></a> <a id="L<sub>1</sub>:6" class="idref" href="#L<sub>1</sub>:6"><span class="id" title="binder">L<sub>1</sub></span></a> <a id="L<sub>2</sub>:7" class="idref" href="#L<sub>2</sub>:7"><span class="id" title="binder">L<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#hcells"><span class="id" title="definition">hcells</span></a> (<a class="idref" href="Struct.html#L<sub>1</sub>:6"><span class="id" title="variable">L<sub>1</sub></span></a><span class="id" title="notation">++</span><a class="idref" href="Struct.html#L<sub>2</sub>:7"><span class="id" title="variable">L<sub>2</sub></span></a>) <a class="idref" href="Struct.html#p:5"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#hcells"><span class="id" title="definition">hcells</span></a> <a class="idref" href="Struct.html#L<sub>1</sub>:6"><span class="id" title="variable">L<sub>1</sub></span></a> <a class="idref" href="Struct.html#p:5"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Struct.html#hcells"><span class="id" title="definition">hcells</span></a> <a class="idref" href="Struct.html#L<sub>2</sub>:7"><span class="id" title="variable">L<sub>2</sub></span></a> (<span class="id" title="definition">length</span> <a class="idref" href="Struct.html#L<sub>1</sub>:6"><span class="id" title="variable">L<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="Struct.html#p:5"><span class="id" title="variable">p</span></a>)%<span class="id" title="var">nat</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
</div>

<div class="doc">
This "splitting lemma for arrays" is useful for carrying out local
    reasoning on arrays. For example, in the recursive quicksort algorithm,
    the specification requires a description of the segment to be sorted;
    the representation of this segment is split so that subsegments
    can be provided for reasoning about the recursive calls. One thereby
    obtains for free the fact that the cells outside of the targeted
    segment remain unmodified. 
</div>

<div class="doc">
<a id="lab389"></a><h2 class="section">Representation of an Array with a Block Header</h2>

<div class="paragraph"> </div>

 An array consists of a "header", and of the description of its cells.
    The header is a heap predicate that describes the length of the array.

<div class="paragraph"> </div>

<ul class="doclist">
<li> In OCaml, the header consists of a physical memory cell at the
      head of the array. This cell may be queried to obtain the length
      of the array.

</li>
<li> In C, the header is a logical notion. It describes the length of
      the allocated block, and it used in Separation Logic to specify
      the behavior of the deallocation function, which can only be called
      on the address of an allocated block, deallocating the full block
      at once.

</li>
</ul>

<div class="paragraph"> </div>

   In this course, we follow the OCaml view, with physical headers.

<div class="paragraph"> </div>

   The predicate <span class="inlinecode"><span class="id" title="var">hheader</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> asserts the existence of an allocated
   block at location <span class="inlinecode"><span class="id" title="var">p</span></span>, such that the contents of the block is made
   of <span class="inlinecode"><span class="id" title="var">k</span></span> cells, not counting the header cell. For the moment, we leave
   its definition abstract. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="hheader" class="idref" href="#hheader"><span class="id" title="axiom">hheader</span></a> : <span class="id" title="keyword">∀</span> (<a id="k:9" class="idref" href="#k:9"><span class="id" title="binder">k</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="p:10" class="idref" href="#p:10"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>), <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>.<br/>
</div>

<div class="doc">
The heap predicate <span class="inlinecode"><span class="id" title="var">hheader</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> should capture the information that <span class="inlinecode"><span class="id" title="var">p</span></span>
    is not null. Indeed blocks cannot be allocated at the null location. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="hheader_not_null" class="idref" href="#hheader_not_null"><span class="id" title="axiom">hheader_not_null</span></a> : <span class="id" title="keyword">∀</span> <a id="p:12" class="idref" href="#p:12"><span class="id" title="binder">p</span></a> <a id="k:13" class="idref" href="#k:13"><span class="id" title="binder">k</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#hheader"><span class="id" title="axiom">hheader</span></a> <a class="idref" href="Struct.html#k:13"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#p:12"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Struct.html#hheader"><span class="id" title="axiom">hheader</span></a> <a class="idref" href="Struct.html#k:13"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#p:12"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#p:12"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>.<br/>
</div>

<div class="doc">
An array is described by the predicate <span class="inlinecode"><span class="id" title="var">harray</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>, where the list
    <span class="inlinecode"><span class="id" title="var">L</span></span> describes the contents of the cells. This heap predicate covers
    both the header, which describes a block of length equal to <span class="inlinecode"><span class="id" title="var">length</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span>,
    and the contents of the cells, described by <span class="inlinecode"><span class="id" title="var">hcells</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode">(<span class="id" title="var">p</span>+1)</span>.

<div class="paragraph"> </div>

    Note that <span class="inlinecode"><span class="id" title="var">p</span>+1</span> corresponds to the address of the first cell of the array,
    located immediately past the header cell that sits at location <span class="inlinecode"><span class="id" title="var">p</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="harray" class="idref" href="#harray"><span class="id" title="definition">harray</span></a> (<a id="L:15" class="idref" href="#L:15"><span class="id" title="binder">L</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) (<a id="p:16" class="idref" href="#p:16"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#hheader"><span class="id" title="axiom">hheader</span></a> (<span class="id" title="definition">length</span> <a class="idref" href="Struct.html#L:15"><span class="id" title="variable">L</span></a>) <a class="idref" href="Struct.html#p:16"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Struct.html#hcells"><span class="id" title="definition">hcells</span></a> <a class="idref" href="Struct.html#L:15"><span class="id" title="variable">L</span></a> (<a class="idref" href="Struct.html#p:16"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1)%<span class="id" title="var">nat</span>.<br/>
</div>

<div class="doc">
<a id="lab390"></a><h2 class="section">Specification of Allocation</h2>

<div class="paragraph"> </div>

 The primitive operation <span class="inlinecode"><span class="id" title="var">val_alloc</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> allocates a block made of
    <span class="inlinecode"><span class="id" title="var">k</span></span> consecutive cells. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="val_alloc" class="idref" href="#val_alloc"><span class="id" title="axiom">val_alloc</span></a> : <a class="idref" href="LibSepReference.html#prim"><span class="id" title="inductive">prim</span></a>.<br/>
</div>

<div class="doc">
The operation <span class="inlinecode"><span class="id" title="var">val_alloc</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> is specified as producing an array
    whose cells contain the special "uninitialized value", written
    <span class="inlinecode"><span class="id" title="var">val_uninit</span></span>. The assume <span class="inlinecode"><span class="id" title="var">val_uninit</span></span> to be part of the grammar
    of values.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Check</span> <span class="id" title="var">val_uninit</span> : <span class="id" title="var">val</span>.
</span>
<div class="paragraph"> </div>

 More precisely, the postcondition of <span class="inlinecode"><span class="id" title="var">val_alloc</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> is of the form
   <span class="inlinecode"><span class="id" title="var">funloc</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">harray</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>, where the list <span class="inlinecode"><span class="id" title="var">L</span></span> is defined as the
   repetition of <span class="inlinecode"><span class="id" title="var">k</span></span> times the value <span class="inlinecode"><span class="id" title="var">val_uninit</span></span>. This list is written
   <span class="inlinecode"><span class="id" title="var">LibList.make</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">val_uninit</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_alloc_nat" class="idref" href="#triple_alloc_nat"><span class="id" title="axiom">triple_alloc_nat</span></a> : <span class="id" title="keyword">∀</span> <a id="k:18" class="idref" href="#k:18"><span class="id" title="binder">k</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#val_alloc"><span class="id" title="axiom">val_alloc</span></a> <a class="idref" href="Struct.html#k:18"><span class="id" title="variable">k</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:19" class="idref" href="#p:19"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> (<span class="id" title="definition">LibList.make</span> <a class="idref" href="Struct.html#k:18"><span class="id" title="variable">k</span></a> <a class="idref" href="LibSepReference.html#val_uninit"><span class="id" title="constructor">val_uninit</span></a>) <a class="idref" href="Struct.html#p:19"><span class="id" title="variable">p</span></a>).<br/>
</div>

<div class="doc">
In practice, the operation <span class="inlinecode"><span class="id" title="var">val_alloc</span></span> is applied to a non-negative
    integer, which might not necessarily be syntactically a natural number.
    Hence, the following lemma, which specifies <span class="inlinecode"><span class="id" title="var">val_alloc</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> for <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">≥</span> <span class="inlinecode">0</span>,
    is more handy to use. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_alloc" class="idref" href="#triple_alloc"><span class="id" title="axiom">triple_alloc</span></a> : <span class="id" title="keyword">∀</span> <a id="n:21" class="idref" href="#n:21"><span class="id" title="binder">n</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#n:21"><span class="id" title="variable">n</span></a> <span class="id" title="notation">≥</span> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#val_alloc"><span class="id" title="axiom">val_alloc</span></a> <a class="idref" href="Struct.html#n:21"><span class="id" title="variable">n</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:22" class="idref" href="#p:22"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> (<span class="id" title="definition">LibList.make</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">n</span>) <a class="idref" href="LibSepReference.html#val_uninit"><span class="id" title="constructor">val_uninit</span></a>) <a class="idref" href="Struct.html#p:22"><span class="id" title="variable">p</span></a>).<br/>
</div>

<div class="doc">
The specification above turns out to be often unnecessarily precise.
    For most applications, it is sufficient for the postcondition to
    describe the array as <span class="inlinecode"><span class="id" title="var">harray</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> for some unspecified list <span class="inlinecode"><span class="id" title="var">L</span></span>
    of length <span class="inlinecode"><span class="id" title="var">n</span></span>. This weaker specification is stated and proved next. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_alloc_array" class="idref" href="#triple_alloc_array"><span class="id" title="axiom">triple_alloc_array</span></a> : <span class="id" title="keyword">∀</span> <a id="n:24" class="idref" href="#n:24"><span class="id" title="binder">n</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#n:24"><span class="id" title="variable">n</span></a> <span class="id" title="notation">≥</span> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#val_alloc"><span class="id" title="axiom">val_alloc</span></a> <a class="idref" href="Struct.html#n:24"><span class="id" title="variable">n</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:25" class="idref" href="#p:25"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="L:26" class="idref" href="#L:26"><span class="id" title="binder">L</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#n:24"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Struct.html#L:26"><span class="id" title="variable">L</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Struct.html#L:26"><span class="id" title="variable">L</span></a> <a class="idref" href="Struct.html#p:25"><span class="id" title="variable">p</span></a>).<br/>
</div>

<div class="doc">
Remark: in OCaml, one must provide an initialization value explicitly,
    so there is no such thing as <span class="inlinecode"><span class="id" title="var">val_uninit</span></span>; in JavaScript, <span class="inlinecode"><span class="id" title="var">val_uninit</span></span>
    is called <span class="inlinecode"><span class="id" title="var">undefined</span></span>; in Java, arrays are initialized with zeros;
    in C, uninitialized data should not be read. In that language, one would
    typically implement this policy by restricting the evaluation rule for
    the read operation, adding a premise of the form <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode">≠</span> <span class="inlinecode"><span class="id" title="var">val_uninit</span></span> to
    ensure that uninitialized values cannot be read. 
</div>

<div class="doc">
<a id="lab391"></a><h2 class="section">Specification of the Deallocation</h2>

<div class="paragraph"> </div>

 The deallocation operation <span class="inlinecode"><span class="id" title="var">val_dealloc</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> deallocates the block
    allocated at location <span class="inlinecode"><span class="id" title="var">p</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="val_dealloc" class="idref" href="#val_dealloc"><span class="id" title="axiom">val_dealloc</span></a> : <a class="idref" href="LibSepReference.html#prim"><span class="id" title="inductive">prim</span></a>.<br/>
</div>

<div class="doc">
The specification of <span class="inlinecode"><span class="id" title="var">val_dealloc</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> features a precondition that
    requires an array of the form <span class="inlinecode"><span class="id" title="var">harray</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>, and an empty postcondition. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_dealloc" class="idref" href="#triple_dealloc"><span class="id" title="axiom">triple_dealloc</span></a> : <span class="id" title="keyword">∀</span> <a id="L:29" class="idref" href="#L:29"><span class="id" title="binder">L</span></a> <a id="p:30" class="idref" href="#p:30"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#val_dealloc"><span class="id" title="axiom">val_dealloc</span></a> <a class="idref" href="Struct.html#p:30"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Struct.html#L:29"><span class="id" title="variable">L</span></a> <a class="idref" href="Struct.html#p:30"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a>).<br/>
</div>

<div class="doc">
Observe that the <span class="inlinecode"><span class="id" title="var">harray</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> predicate includes a header of the form
    <span class="inlinecode"><span class="id" title="var">hheader</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>, ensuring that a block can be deallocated only once. 
</div>

<div class="doc">
<a id="lab392"></a><h2 class="section">Specification of Array Operations</h2>

<div class="paragraph"> </div>

 The operation <span class="inlinecode"><span class="id" title="var">val_array_get</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> returns the contents of the <span class="inlinecode"><span class="id" title="var">i</span></span>-th
    cell of the array at location <span class="inlinecode"><span class="id" title="var">p</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="val_array_get" class="idref" href="#val_array_get"><span class="id" title="axiom">val_array_get</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
</div>

<div class="doc">
The specification of <span class="inlinecode"><span class="id" title="var">val_array_get</span></span> is as follows. The precondition
    describes the array in the form <span class="inlinecode"><span class="id" title="var">harray</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>, with a premise that
    requires the index <span class="inlinecode"><span class="id" title="var">i</span></span> to be in the valid range, that is, between
    zero (inclusive) and the length of <span class="inlinecode"><span class="id" title="var">L</span></span> (exclusive). The postcondition
    asserts that the result value is <span class="inlinecode"><span class="id" title="var">nth</span></span> <span class="inlinecode">(<span class="id" title="var">abs</span></span> <span class="inlinecode"><span class="id" title="var">i</span>)</span> <span class="inlinecode"><span class="id" title="var">L</span></span>, and mentions
    the unmodified array, still described by <span class="inlinecode"><span class="id" title="var">harray</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_array_get" class="idref" href="#triple_array_get"><span class="id" title="axiom">triple_array_get</span></a> : <span class="id" title="keyword">∀</span> <a id="L:33" class="idref" href="#L:33"><span class="id" title="binder">L</span></a> <a id="p:34" class="idref" href="#p:34"><span class="id" title="binder">p</span></a> <a id="i:35" class="idref" href="#i:35"><span class="id" title="binder">i</span></a>,<br/>
&nbsp;&nbsp;0 <span class="id" title="notation">≤</span> <a class="idref" href="Struct.html#i:35"><span class="id" title="variable">i</span></a> <span class="id" title="notation">&lt;</span> <span class="id" title="definition">length</span> <a class="idref" href="Struct.html#L:33"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#val_array_get"><span class="id" title="axiom">val_array_get</span></a> <a class="idref" href="Struct.html#p:34"><span class="id" title="variable">p</span></a> <a class="idref" href="Struct.html#i:35"><span class="id" title="variable">i</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Struct.html#L:33"><span class="id" title="variable">L</span></a> <a class="idref" href="Struct.html#p:34"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:36" class="idref" href="#r:36"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#r:36"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">LibList.nth</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">i</span>) <a class="idref" href="Struct.html#L:33"><span class="id" title="variable">L</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Struct.html#L:33"><span class="id" title="variable">L</span></a> <a class="idref" href="Struct.html#p:34"><span class="id" title="variable">p</span></a>).<br/>
</div>

<div class="doc">
The operation <span class="inlinecode"><span class="id" title="var">val_array_set</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> updates the contents of the <span class="inlinecode"><span class="id" title="var">i</span></span>-th
    cell of the array at location <span class="inlinecode"><span class="id" title="var">p</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="val_array_set" class="idref" href="#val_array_set"><span class="id" title="axiom">val_array_set</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
</div>

<div class="doc">
The specification of <span class="inlinecode"><span class="id" title="var">val_array_set</span></span> admits the same precondition as
    <span class="inlinecode"><span class="id" title="var">val_array_get</span></span>, with <span class="inlinecode"><span class="id" title="var">harray</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> and the constraint <span class="inlinecode">0</span> <span class="inlinecode">≤</span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode">&lt;</span> <span class="inlinecode"><span class="id" title="var">length</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span>.
    Its postcondition describes the updated array using a predicate of the
    form <span class="inlinecode"><span class="id" title="var">harray</span></span> <span class="inlinecode"><span class="id" title="var">L'</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>, where <span class="inlinecode"><span class="id" title="var">L'</span></span> corresponds to <span class="inlinecode"><span class="id" title="var">update</span></span> <span class="inlinecode">(<span class="id" title="var">abs</span></span> <span class="inlinecode"><span class="id" title="var">i</span>)</span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_array_set" class="idref" href="#triple_array_set"><span class="id" title="axiom">triple_array_set</span></a> : <span class="id" title="keyword">∀</span> <a id="L:39" class="idref" href="#L:39"><span class="id" title="binder">L</span></a> <a id="p:40" class="idref" href="#p:40"><span class="id" title="binder">p</span></a> <a id="i:41" class="idref" href="#i:41"><span class="id" title="binder">i</span></a> <a id="v:42" class="idref" href="#v:42"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;0 <span class="id" title="notation">≤</span> <a class="idref" href="Struct.html#i:41"><span class="id" title="variable">i</span></a> <span class="id" title="notation">&lt;</span> <span class="id" title="definition">length</span> <a class="idref" href="Struct.html#L:39"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#val_array_set"><span class="id" title="axiom">val_array_set</span></a> <a class="idref" href="Struct.html#p:40"><span class="id" title="variable">p</span></a> <a class="idref" href="Struct.html#i:41"><span class="id" title="variable">i</span></a> <a class="idref" href="Struct.html#v:42"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Struct.html#L:39"><span class="id" title="variable">L</span></a> <a class="idref" href="Struct.html#p:40"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> (<span class="id" title="definition">LibList.update</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">i</span>) <a class="idref" href="Struct.html#v:42"><span class="id" title="variable">v</span></a> <a class="idref" href="Struct.html#L:39"><span class="id" title="variable">L</span></a>) <a class="idref" href="Struct.html#p:40"><span class="id" title="variable">p</span></a>).<br/>
</div>

<div class="doc">
The operation <span class="inlinecode"><span class="id" title="var">val_array_length</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> returns the length of the array
    allocated at location <span class="inlinecode"><span class="id" title="var">p</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="val_array_length" class="idref" href="#val_array_length"><span class="id" title="axiom">val_array_length</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
</div>

<div class="doc">
There are two useful specifications for <span class="inlinecode"><span class="id" title="var">val_array_length</span></span>. The first
    one operates with the heap predicate <span class="inlinecode"><span class="id" title="var">harray</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>. The return value is
    the length of the list <span class="inlinecode"><span class="id" title="var">L</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_array_length" class="idref" href="#triple_array_length"><span class="id" title="axiom">triple_array_length</span></a> : <span class="id" title="keyword">∀</span> <a id="L:45" class="idref" href="#L:45"><span class="id" title="binder">L</span></a> <a id="p:46" class="idref" href="#p:46"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#val_array_length"><span class="id" title="axiom">val_array_length</span></a> <a class="idref" href="Struct.html#p:46"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Struct.html#L:45"><span class="id" title="variable">L</span></a> <a class="idref" href="Struct.html#p:46"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:47" class="idref" href="#r:47"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#r:47"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Struct.html#L:45"><span class="id" title="variable">L</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Struct.html#L:45"><span class="id" title="variable">L</span></a> <a class="idref" href="Struct.html#p:46"><span class="id" title="variable">p</span></a>).<br/>
</div>

<div class="doc">
The second specification for <span class="inlinecode"><span class="id" title="var">val_array_length</span></span> operates only on the
    header of the array. This small-footprint specification is useful to
    read the length of an array whose cells are described by separated
    segments, that is, after <span class="inlinecode"><span class="id" title="var">hcells_concat_eq</span></span> has been exploited. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_array_length_header" class="idref" href="#triple_array_length_header"><span class="id" title="axiom">triple_array_length_header</span></a> : <span class="id" title="keyword">∀</span> <a id="k:49" class="idref" href="#k:49"><span class="id" title="binder">k</span></a> <a id="p:50" class="idref" href="#p:50"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#val_array_length"><span class="id" title="axiom">val_array_length</span></a> <a class="idref" href="Struct.html#p:50"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#hheader"><span class="id" title="axiom">hheader</span></a> <a class="idref" href="Struct.html#k:49"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#p:50"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:51" class="idref" href="#r:51"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#r:51"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#k:49"><span class="id" title="variable">k</span></a>:<span class="id" title="notation">int</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Struct.html#hheader"><span class="id" title="axiom">hheader</span></a> <a class="idref" href="Struct.html#k:49"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#p:50"><span class="id" title="variable">p</span></a>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">triple_array_get</span> <span class="id" title="var">triple_array_set</span> <span class="id" title="var">triple_array_length</span> : <span class="id" title="var">triple</span>.<br/>
</div>

<div class="doc">
<a id="lab393"></a><h2 class="section">Representation of Individual Records Fields</h2>

<div class="paragraph"> </div>

 A record can be represented just like an array, with the field names
    corresponding to offsets in that array.

<div class="paragraph"> </div>

    We let <span class="inlinecode"><span class="id" title="tactic">field</span></span> denote the type of field names, an alias for <span class="inlinecode"><span class="id" title="var">nat</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="field" class="idref" href="#field"><span class="id" title="definition">field</span></a> : <span class="id" title="keyword">Type</span> := <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>.<br/>
</div>

<div class="doc">
For example, consider a mutable list cell allocated at location <span class="inlinecode"><span class="id" title="var">p</span></span>.
    It is represented in memory as:

<div class="paragraph"> </div>

<ul class="doclist">
<li> a header at location <span class="inlinecode"><span class="id" title="var">p</span></span>, storing the number of fields, that is,
      the value <span class="inlinecode">2</span>;

</li>
<li> a cell at location <span class="inlinecode"><span class="id" title="var">p</span>+1</span>, storing the contents of the head field,

</li>
<li> a cell at location <span class="inlinecode"><span class="id" title="var">p</span>+2</span>, storing the contents of the tail field.

</li>
</ul>

<div class="paragraph"> </div>

    Concretely, the record can be represented by the heap predicate:
    <span class="inlinecode">(<span class="id" title="var">hheader</span></span> <span class="inlinecode">2</span> <span class="inlinecode"><span class="id" title="var">p</span>)</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode">((<span class="id" title="var">p</span>+1)</span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">x</span>)</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode">((<span class="id" title="var">p</span>+2)</span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">q</span>)</span>. 
<div class="paragraph"> </div>

 To avoid exposing pointer arithmetic to the end-user, we introduce
    the "record field" notation <span class="inlinecode"><span class="id" title="var">p</span>`.<span class="id" title="var">k</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">v</span></span> to denote <span class="inlinecode">(<span class="id" title="var">p</span>+1+<span class="id" title="var">k</span>)</span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">v</span></span>.

<div class="paragraph"> </div>

    For example, with the definition of the field offsets <span class="inlinecode"><span class="id" title="var">head</span></span> <span class="inlinecode">:=</span> <span class="inlinecode">0</span>
    and <span class="inlinecode"><span class="id" title="var">tail</span></span> <span class="inlinecode">:=</span> <span class="inlinecode">1</span>, the same record as before can be represented as:
    <span class="inlinecode">(<span class="id" title="var">hheader</span></span> <span class="inlinecode">2</span> <span class="inlinecode"><span class="id" title="var">p</span>)</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode">(<span class="id" title="var">p</span>`.<span class="id" title="var">head</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">x</span>)</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode">(<span class="id" title="var">p</span>`.<span class="id" title="var">tail</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">q</span>)</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="hfield" class="idref" href="#hfield"><span class="id" title="definition">hfield</span></a> (<a id="p:53" class="idref" href="#p:53"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) (<a id="k:54" class="idref" href="#k:54"><span class="id" title="binder">k</span></a>:<a class="idref" href="Struct.html#field"><span class="id" title="definition">field</span></a>) (<a id="v:55" class="idref" href="#v:55"><span class="id" title="binder">v</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;(<a class="idref" href="Struct.html#p:53"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a><a class="idref" href="Struct.html#k:54"><span class="id" title="variable">k</span></a>)%<span class="id" title="var">nat</span> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Struct.html#v:55"><span class="id" title="variable">v</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <a id="75d25f73dacdf76a5f84e31928dc7807" class="idref" href="#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">&quot;</span></a>p `. k '~~&gt;' v" := (<a class="idref" href="Struct.html#hfield"><span class="id" title="definition">hfield</span></a> <span class="id" title="var">p</span> <span class="id" title="var">k</span> <span class="id" title="var">v</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 32, <span class="id" title="var">k</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">format</span> "p `. k  '~~&gt;'  v").<br/>
</div>

<div class="doc">
<a id="lab394"></a><h2 class="section">Representation of Records</h2>

<div class="paragraph"> </div>

 Describing, e.g., a list cell record in the form
    <span class="inlinecode">(<span class="id" title="var">hheader</span></span> <span class="inlinecode">2</span> <span class="inlinecode"><span class="id" title="var">p</span>)</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode">(<span class="id" title="var">p</span>`.<span class="id" title="var">head</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">x</span>)</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode">(<span class="id" title="var">p</span>`.<span class="id" title="var">tail</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">q</span>)</span>
    in particularly verbose and cumbersome to manipulate.

<div class="paragraph"> </div>

    To improve the situation, we next introduce generic representation
    predicate for records that allows to describe the same list cell
    much more concisely, as <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~~&gt;`{</span> <span class="inlinecode"><span class="id" title="var">head</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">x</span>;</span> <span class="inlinecode"><span class="id" title="var">tail</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">q</span></span> <span class="inlinecode">}</span>.

<div class="paragraph"> </div>

    It what follows, we show how to implement this notation by introducing
    the heap predicates <span class="inlinecode"><span class="id" title="var">hfields</span></span> and <span class="inlinecode"><span class="id" title="var">hrecords</span></span>. We then represent the
    specifications of record operations with respect to those predicates. 
<div class="paragraph"> </div>

 A record field is described as the pair of a field and a value
    stored in this field. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="hrecord_field" class="idref" href="#hrecord_field"><span class="id" title="definition">hrecord_field</span></a> : <span class="id" title="keyword">Type</span> := (<a class="idref" href="Struct.html#field"><span class="id" title="definition">field</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">*</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>).<br/>
</div>

<div class="doc">
A record consists of a list of fields. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="hrecord_fields" class="idref" href="#hrecord_fields"><span class="id" title="definition">hrecord_fields</span></a> : <span class="id" title="keyword">Type</span> := <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Struct.html#hrecord_field"><span class="id" title="definition">hrecord_field</span></a>.<br/>
</div>

<div class="doc">
We let the meta-variable <span class="inlinecode"><span class="id" title="var">kvs</span></span> denote such lists. 
</div>
<div class="code">

<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">kvs</span> : <a class="idref" href="Struct.html#hrecord_fields"><span class="id" title="definition">hrecord_fields</span></a>.<br/>
</div>

<div class="doc">
A list cell with head field <span class="inlinecode"><span class="id" title="var">x</span></span> and tail field <span class="inlinecode"><span class="id" title="var">q</span></span> is represented
    by the list <span class="inlinecode">(<span class="id" title="var">head</span>,<span class="id" title="var">x</span>)::(<span class="id" title="var">tail</span>,<span class="id" title="var">q</span>)::<span class="id" title="var">nil</span></span>. To support the syntax
    <span class="inlinecode">`{</span> <span class="inlinecode"><span class="id" title="var">head</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">x</span>;</span> <span class="inlinecode"><span class="id" title="var">tail</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">q</span></span> <span class="inlinecode">}</span>, we introduce the following notation. 
</div>
<div class="code">

<span class="id" title="keyword">Notation</span> <a id="31d448c3336e330e3a6d124a266f88b<sub>1</sub>" class="idref" href="#31d448c3336e330e3a6d124a266f88b<sub>1</sub>"><span class="id" title="notation">&quot;</span></a>`{ k<sub>1</sub> := v<sub>1</sub> }" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k<sub>1</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,(</span></a><span class="id" title="var">v<sub>1</sub></span>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">))</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">k<sub>1</sub></span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">only</span> <span class="id" title="var">parsing</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <a id="37128e1fb6646967e25a94496c592b<sub>58</sub>" class="idref" href="#37128e1fb6646967e25a94496c592b<sub>58</sub>"><span class="id" title="notation">&quot;</span></a>`{ k<sub>1</sub> := v<sub>1</sub> ; k<sub>2</sub> := v<sub>2</sub> }" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k<sub>1</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,(</span></a><span class="id" title="var">v<sub>1</sub></span>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">))</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k<sub>2</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,(</span></a><span class="id" title="var">v<sub>2</sub></span>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">))</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">k<sub>1</sub></span>, <span class="id" title="var">k<sub>2</sub></span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">only</span> <span class="id" title="var">parsing</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <a id="5a19cedf746e143a1d13090de2b5e61a" class="idref" href="#5a19cedf746e143a1d13090de2b5e61a"><span class="id" title="notation">&quot;</span></a>`{ k<sub>1</sub> := v<sub>1</sub> ; k<sub>2</sub> := v<sub>2</sub> ; k<sub>3</sub> := v<sub>3</sub> }" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k<sub>1</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,(</span></a><span class="id" title="var">v<sub>1</sub></span>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">))</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k<sub>2</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,(</span></a><span class="id" title="var">v<sub>2</sub></span>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">))</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k<sub>3</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,(</span></a><span class="id" title="var">v<sub>3</sub></span>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">))</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">k<sub>1</sub></span>, <span class="id" title="var">k<sub>2</sub></span>, <span class="id" title="var">k<sub>3</sub></span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">only</span> <span class="id" title="var">parsing</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <a id="31d448c3336e330e3a6d124a266f88b<sub>1</sub>" class="idref" href="#31d448c3336e330e3a6d124a266f88b<sub>1</sub>"><span class="id" title="notation">&quot;</span></a>`{ k<sub>1</sub> := v<sub>1</sub> }" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k<sub>1</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">v<sub>1</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">k<sub>1</sub></span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">only</span> <span class="id" title="var">printing</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <a id="37128e1fb6646967e25a94496c592b<sub>58</sub>" class="idref" href="#37128e1fb6646967e25a94496c592b<sub>58</sub>"><span class="id" title="notation">&quot;</span></a>`{ k<sub>1</sub> := v<sub>1</sub> ; k<sub>2</sub> := v<sub>2</sub> }" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k<sub>1</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">v<sub>1</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k<sub>2</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">v<sub>2</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">k<sub>1</sub></span>, <span class="id" title="var">k<sub>2</sub></span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">only</span> <span class="id" title="var">printing</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <a id="5a19cedf746e143a1d13090de2b5e61a" class="idref" href="#5a19cedf746e143a1d13090de2b5e61a"><span class="id" title="notation">&quot;</span></a>`{ k<sub>1</sub> := v<sub>1</sub> ; k<sub>2</sub> := v<sub>2</sub> ; k<sub>3</sub> := v<sub>3</sub> }" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k<sub>1</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">v<sub>1</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k<sub>2</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">v<sub>2</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k<sub>3</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">v<sub>3</sub></span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">k<sub>1</sub></span>, <span class="id" title="var">k<sub>2</sub></span>, <span class="id" title="var">k<sub>3</sub></span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">only</span> <span class="id" title="var">printing</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">val_scope</span>.<br/>
</div>

<div class="doc">
The heap predicate <span class="inlinecode"><span class="id" title="var">hfields</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> asserts that, at location <span class="inlinecode"><span class="id" title="var">p</span></span>,
    one finds the representation of the fields described by the list <span class="inlinecode"><span class="id" title="var">kvs</span></span>.

<div class="paragraph"> </div>

    The predicate <span class="inlinecode"><span class="id" title="var">hfields</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> is defined recursively on the list <span class="inlinecode"><span class="id" title="var">kvs</span></span>.
    If <span class="inlinecode"><span class="id" title="var">kvs</span></span> is empty, the predicate describes the empty heap predicate.
    Otherwise, it describes a first field, at offset <span class="inlinecode"><span class="id" title="var">k</span></span> and with contents
    <span class="inlinecode"><span class="id" title="var">v</span></span>, as the predicate <span class="inlinecode"><span class="id" title="var">p</span>`.<span class="id" title="var">k</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">v</span></span>, and it describes the remaining
    fields recursively. 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <a id="hfields" class="idref" href="#hfields"><span class="id" title="definition">hfields</span></a> (<a id="kvs:56" class="idref" href="#kvs:56"><span class="id" title="binder">kvs</span></a>:<a class="idref" href="Struct.html#hrecord_fields"><span class="id" title="definition">hrecord_fields</span></a>) (<a id="p:57" class="idref" href="#p:57"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Struct.html#kvs:56"><span class="id" title="variable">kvs</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> ⇒ <a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">k</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">v</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><span class="id" title="var">kvs'</span> ⇒ <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#p:57"><span class="id" title="variable">p</span></a><a class="idref" href="Struct.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">`.</span></a><span class="id" title="var">k</span> <a class="idref" href="Struct.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">~~&gt;</span></a> <span class="id" title="var">v</span><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#hfields:58"><span class="id" title="definition">hfields</span></a> <span class="id" title="var">kvs'</span> <a class="idref" href="Struct.html#p:57"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
The heap predicate <span class="inlinecode"><span class="id" title="var">hrecord</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> describes a record: it covers
    not just all the fields of the record, but also the header.

<div class="paragraph"> </div>

    The cells are described by <span class="inlinecode"><span class="id" title="var">hfields</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>, and the header is
    described by <span class="inlinecode"><span class="id" title="var">hheader</span></span> <span class="inlinecode"><span class="id" title="var">z</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>, where <span class="inlinecode"><span class="id" title="var">nb</span></span> should be such that the
    keys in the list <span class="inlinecode"><span class="id" title="var">kvs</span></span> are between <span class="inlinecode">0</span> inclusive and <span class="inlinecode"><span class="id" title="var">nb</span></span> exclusive.

<div class="paragraph"> </div>

    A permissive definition of <span class="inlinecode"><span class="id" title="var">hrecord</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> would allow the fields
    from the list <span class="inlinecode"><span class="id" title="var">kvs</span></span> to be permuted arbitrarily. Yet, to avoid
    complications related to permutations, we make in this course the
    simplifying assumptions that fields are always listed in the order
    of their associated offsets.

<div class="paragraph"> </div>

    The auxiliary predicate <span class="inlinecode"><span class="id" title="var">maps_all_fields</span></span> <span class="inlinecode"><span class="id" title="var">z</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> asserts that the
    keys from the association list <span class="inlinecode"><span class="id" title="var">kvs</span></span> correspond exactly to the sequence
    made of the first <span class="inlinecode"><span class="id" title="var">nb</span></span> natural numbers, that is, <span class="inlinecode">0;</span> <span class="inlinecode">1;</span> <span class="inlinecode">...;</span> <span class="inlinecode"><span class="id" title="var">nb</span>-1</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="maps_all_fields" class="idref" href="#maps_all_fields"><span class="id" title="definition">maps_all_fields</span></a> (<a id="nb:60" class="idref" href="#nb:60"><span class="id" title="binder">nb</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="kvs:61" class="idref" href="#kvs:61"><span class="id" title="binder">kvs</span></a>:<a class="idref" href="Struct.html#hrecord_fields"><span class="id" title="definition">hrecord_fields</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="definition">LibList.map</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <a class="idref" href="Struct.html#kvs:61"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">nat_seq</span> 0 <a class="idref" href="Struct.html#nb:60"><span class="id" title="variable">nb</span></a>.<br/>
</div>

<div class="doc">
The predicate <span class="inlinecode"><span class="id" title="var">hrecord</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> exploits <span class="inlinecode"><span class="id" title="var">maps_all_fields</span></span> <span class="inlinecode"><span class="id" title="var">z</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span>
    to relate the value <span class="inlinecode"><span class="id" title="var">nb</span></span> stored in the header with the association
    list <span class="inlinecode"><span class="id" title="var">kvs</span></span> that describes the contents of the fields. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="hrecord" class="idref" href="#hrecord"><span class="id" title="definition">hrecord</span></a> (<a id="kvs:62" class="idref" href="#kvs:62"><span class="id" title="binder">kvs</span></a>:<a class="idref" href="Struct.html#hrecord_fields"><span class="id" title="definition">hrecord_fields</span></a>) (<a id="p:63" class="idref" href="#p:63"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="z:64" class="idref" href="#z:64"><span class="id" title="binder">z</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Struct.html#hheader"><span class="id" title="axiom">hheader</span></a> <a class="idref" href="Struct.html#z:64"><span class="id" title="variable">z</span></a> <a class="idref" href="Struct.html#p:63"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Struct.html#hfields"><span class="id" title="definition">hfields</span></a> <a class="idref" href="Struct.html#kvs:62"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Struct.html#p:63"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#maps_all_fields"><span class="id" title="definition">maps_all_fields</span></a> <a class="idref" href="Struct.html#z:64"><span class="id" title="variable">z</span></a> <a class="idref" href="Struct.html#kvs:62"><span class="id" title="variable">kvs</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>.<br/>
</div>

<div class="doc">
The heap predicate <span class="inlinecode"><span class="id" title="var">hrecord</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> captures in particular the
    invariant that the location <span class="inlinecode"><span class="id" title="var">p</span></span> is not null. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="hrecord_not_null" class="idref" href="#hrecord_not_null"><span class="id" title="lemma">hrecord_not_null</span></a> : <span class="id" title="keyword">∀</span> <a id="p:65" class="idref" href="#p:65"><span class="id" title="binder">p</span></a> <a id="kvs:66" class="idref" href="#kvs:66"><span class="id" title="binder">kvs</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#hrecord"><span class="id" title="definition">hrecord</span></a> <a class="idref" href="Struct.html#kvs:66"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Struct.html#p:65"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Struct.html#hrecord"><span class="id" title="definition">hrecord</span></a> <a class="idref" href="Struct.html#kvs:66"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Struct.html#p:65"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#p:65"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Struct.html#hrecord"><span class="id" title="definition">hrecord</span></a>. <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">z</span> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xchanges</span>* <a class="idref" href="Struct.html#hheader_not_null"><span class="id" title="axiom">hheader_not_null</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
We introduce the notation <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~~&gt;</span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> for <span class="inlinecode"><span class="id" title="var">hrecord</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>,
    allowing to write, e.g., <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~~&gt;`{</span> <span class="inlinecode"><span class="id" title="var">head</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">x</span>;</span> <span class="inlinecode"><span class="id" title="var">tail</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">q</span></span> <span class="inlinecode">}</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Notation</span> <a id="4fdf8be3226dc6822dfa0caeb9414d<sub>46</sub>" class="idref" href="#4fdf8be3226dc6822dfa0caeb9414d<sub>46</sub>"><span class="id" title="notation">&quot;</span></a>p '~~~&gt;' kvs" := (<a class="idref" href="Struct.html#hrecord"><span class="id" title="definition">hrecord</span></a> <span class="id" title="var">kvs</span> <span class="id" title="var">p</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 32).<br/>
</div>

<div class="doc">
<a id="lab395"></a><h2 class="section">Example with Mutable Linked Lists</h2>

<div class="paragraph"> </div>

 Recall the definition of the representation predicate <span class="inlinecode"><span class="id" title="var">MList</span></span>,
    which was introduced in <span class="inlinecode"><span class="id" title="var">Basic</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="head" class="idref" href="#head"><span class="id" title="definition">head</span></a> : <a class="idref" href="Struct.html#field"><span class="id" title="definition">field</span></a> := 0%<span class="id" title="var">nat</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="tail" class="idref" href="#tail"><span class="id" title="definition">tail</span></a> : <a class="idref" href="Struct.html#field"><span class="id" title="definition">field</span></a> := 1%<span class="id" title="var">nat</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <a id="MList" class="idref" href="#MList"><span class="id" title="definition">MList</span></a> (<a id="L:67" class="idref" href="#L:67"><span class="id" title="binder">L</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) (<a id="p:68" class="idref" href="#p:68"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Struct.html#L:67"><span class="id" title="variable">L</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#p:68"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;| <span class="id" title="var">x</span><span class="id" title="notation">::</span><span class="id" title="var">L'</span> ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="q:71" class="idref" href="#q:71"><span class="id" title="binder">q</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#p:68"><span class="id" title="variable">p</span></a> <a class="idref" href="Struct.html#4fdf8be3226dc6822dfa0caeb9414d<sub>46</sub>"><span class="id" title="notation">~~~&gt;</span></a><a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">`{</span></a> <a class="idref" href="Struct.html#head"><span class="id" title="definition">head</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <span class="id" title="var">x</span><a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Struct.html#tail"><span class="id" title="definition">tail</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Struct.html#q:71"><span class="id" title="variable">q</span></a><a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">}</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#MList:69"><span class="id" title="definition">MList</span></a> <span class="id" title="var">L'</span> <a class="idref" href="Struct.html#q:71"><span class="id" title="variable">q</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
Recall the statement of the lemma <span class="inlinecode"><span class="id" title="var">MList_if</span></span>, which reformulates
    the definition of <span class="inlinecode"><span class="id" title="var">MList</span></span> with a case analysis on <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">null</span></span>.

<div class="paragraph"> </div>

    Observe the use of the lemma <span class="inlinecode"><span class="id" title="var">hrecrod_not_null</span></span> to exploit the
    fact that a record cannot be allocated at the <span class="inlinecode"><span class="id" title="var">null</span></span> location. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="MList_if" class="idref" href="#MList_if"><span class="id" title="lemma">MList_if</span></a> : <span class="id" title="keyword">∀</span> (<a id="p:72" class="idref" href="#p:72"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) (<a id="L:73" class="idref" href="#L:73"><span class="id" title="binder">L</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Struct.html#L:73"><span class="id" title="variable">L</span></a> <a class="idref" href="Struct.html#p:72"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><span class="id" title="notation">If</span> <a class="idref" href="Struct.html#p:72"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">then</span> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#L:73"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">else</span> <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="x:74" class="idref" href="#x:74"><span class="id" title="binder">x</span></a> <a id="q:75" class="idref" href="#q:75"><span class="id" title="binder">q</span></a> <a id="L':76" class="idref" href="#L':76"><span class="id" title="binder">L'</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#L:73"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Struct.html#x:74"><span class="id" title="variable">x</span></a><span class="id" title="notation">::</span><a class="idref" href="Struct.html#L':76"><span class="id" title="variable">L'</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#p:72"><span class="id" title="variable">p</span></a> <a class="idref" href="Struct.html#4fdf8be3226dc6822dfa0caeb9414d<sub>46</sub>"><span class="id" title="notation">~~~&gt;</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">`{</span></a> <a class="idref" href="Struct.html#head"><span class="id" title="definition">head</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Struct.html#x:74"><span class="id" title="variable">x</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Struct.html#tail"><span class="id" title="definition">tail</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Struct.html#q:75"><span class="id" title="variable">q</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">}</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Struct.html#L':76"><span class="id" title="variable">L'</span></a> <a class="idref" href="Struct.html#q:75"><span class="id" title="variable">q</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">L</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">x</span> <span class="id" title="var">L'</span>]; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">M</span>. <span class="id" title="var">case_if</span>. <span class="id" title="var">xsimpl</span>*. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">q</span>. <span class="id" title="var">xchange</span> <a class="idref" href="Struct.html#hrecord_not_null"><span class="id" title="lemma">hrecord_not_null</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">N</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">case_if</span>. <span class="id" title="var">xsimpl</span>*. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Global Opaque</span> <a class="idref" href="Struct.html#MList"><span class="id" title="definition">MList</span></a>.<br/>
</div>

<div class="doc">
<a id="lab396"></a><h2 class="section">Reading in Record Fields</h2>

</div>
<div class="code">

<span class="id" title="var">Declare</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">trm_scope_ext</span>.<br/>
</div>

<div class="doc">
The read operation is described by an expression of the form
    <span class="inlinecode"><span class="id" title="var">val_get_field</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>, where <span class="inlinecode"><span class="id" title="var">k</span></span> denotes a field name, and where <span class="inlinecode"><span class="id" title="var">p</span></span>
    denotes the location of a record. Technically, <span class="inlinecode"><span class="id" title="var">val_get_field</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span>
    is a value, and this value is applied to the pointer <span class="inlinecode"><span class="id" title="var">p</span></span>. Hence,
    <span class="inlinecode"><span class="id" title="var">val_get_field</span></span> has type <span class="inlinecode"><span class="id" title="tactic">field</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">val</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="val_get_field" class="idref" href="#val_get_field"><span class="id" title="axiom">val_get_field</span></a> : <a class="idref" href="Struct.html#field"><span class="id" title="definition">field</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
</div>

<div class="doc">
The read operation <span class="inlinecode"><span class="id" title="var">val_get_field</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> is abbreviated as <span class="inlinecode"><span class="id" title="var">p'.k</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Notation</span> <a id="bc5af3b58d5c20163ac6d8a709b81319" class="idref" href="#bc5af3b58d5c20163ac6d8a709b81319"><span class="id" title="notation">&quot;</span></a>t<sub>1</sub> '`.' k" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="Struct.html#val_get_field"><span class="id" title="axiom">val_get_field</span></a> <span class="id" title="var">k</span> <span class="id" title="var">t<sub>1</sub></span>)<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">trm</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 56, <span class="id" title="var">k</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">format</span> "t<sub>1</sub> '`.' k" )<br/>
&nbsp;&nbsp;: <span class="id" title="var">trm_scope_ext</span>.<br/>
</div>

<div class="doc">
The operation <span class="inlinecode"><span class="id" title="var">val_get_field</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> can be specified at three levels.

<div class="paragraph"> </div>

    First, its small-footprint specification operates at the level of
    a single field, described by <span class="inlinecode"><span class="id" title="var">p</span>`.<span class="id" title="var">k</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">v</span></span>. The specification is
    very similar to that of <span class="inlinecode"><span class="id" title="var">val_get</span></span>. The return value is exactly <span class="inlinecode"><span class="id" title="var">v</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_get_field" class="idref" href="#triple_get_field"><span class="id" title="axiom">triple_get_field</span></a> : <span class="id" title="keyword">∀</span> <a id="p:78" class="idref" href="#p:78"><span class="id" title="binder">p</span></a> <a id="k:79" class="idref" href="#k:79"><span class="id" title="binder">k</span></a> <a id="v:80" class="idref" href="#v:80"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#val_get_field"><span class="id" title="axiom">val_get_field</span></a> <a class="idref" href="Struct.html#k:79"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#p:78"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#p:78"><span class="id" title="variable">p</span></a><a class="idref" href="Struct.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">`.</span></a><a class="idref" href="Struct.html#k:79"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Struct.html#v:80"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:81" class="idref" href="#r:81"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#r:81"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Struct.html#v:80"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#p:78"><span class="id" title="variable">p</span></a><a class="idref" href="Struct.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">`.</span></a><a class="idref" href="Struct.html#k:79"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Struct.html#v:80"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>).<br/>
</div>

<div class="doc">
Second, this operation can be specified with respect to a list of
    fields, described in the form <span class="inlinecode"><span class="id" title="var">hfields</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>. To that end, we introduce
    a function called <span class="inlinecode"><span class="id" title="var">hfields_lookup</span></span> for extracting the value <span class="inlinecode"><span class="id" title="var">v</span></span>
    associated with a field <span class="inlinecode"><span class="id" title="var">k</span></span> in a list of record fields <span class="inlinecode"><span class="id" title="var">kvs</span></span>.

<div class="paragraph"> </div>

    The operation <span class="inlinecode"><span class="id" title="var">hfields_lookup</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> returns a result of type <span class="inlinecode"><span class="id" title="var">option</span></span> <span class="inlinecode"><span class="id" title="var">val</span></span>,
    because we cannot presume that the field <span class="inlinecode"><span class="id" title="var">k</span></span> occurs in <span class="inlinecode"><span class="id" title="var">kvs</span></span>, even though
    it is always the case in practice. 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <a id="hfields_lookup" class="idref" href="#hfields_lookup"><span class="id" title="definition">hfields_lookup</span></a> (<a id="k:83" class="idref" href="#k:83"><span class="id" title="binder">k</span></a>:<a class="idref" href="Struct.html#field"><span class="id" title="definition">field</span></a>) (<a id="kvs:84" class="idref" href="#kvs:84"><span class="id" title="binder">kvs</span></a>:<a class="idref" href="Struct.html#hrecord_fields"><span class="id" title="definition">hrecord_fields</span></a>) : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Struct.html#kvs:84"><span class="id" title="variable">kvs</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">ki</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">vi</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><span class="id" title="var">kvs'</span> ⇒ <span class="id" title="keyword">if</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#Nat.eq_dec"><span class="id" title="lemma">Nat.eq_dec</span></a> <a class="idref" href="Struct.html#k:83"><span class="id" title="variable">k</span></a> <span class="id" title="var">ki</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">vi</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <a class="idref" href="Struct.html#hfields_lookup:85"><span class="id" title="definition">hfields_lookup</span></a> <a class="idref" href="Struct.html#k:83"><span class="id" title="variable">k</span></a> <span class="id" title="var">kvs'</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
Under the assumption that <span class="inlinecode"><span class="id" title="var">hfields_lookup</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> returns <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span>,
    the read operation <span class="inlinecode"><span class="id" title="var">val_get_field</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> is specified to return <span class="inlinecode"><span class="id" title="var">v</span></span>.
    The corresponding specification appears below. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_get_field_hfields" class="idref" href="#triple_get_field_hfields"><span class="id" title="axiom">triple_get_field_hfields</span></a> : <span class="id" title="keyword">∀</span> <a id="kvs:87" class="idref" href="#kvs:87"><span class="id" title="binder">kvs</span></a> <a id="p:88" class="idref" href="#p:88"><span class="id" title="binder">p</span></a> <a id="k:89" class="idref" href="#k:89"><span class="id" title="binder">k</span></a> <a id="v:90" class="idref" href="#v:90"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#hfields_lookup"><span class="id" title="definition">hfields_lookup</span></a> <a class="idref" href="Struct.html#k:89"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#kvs:87"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Struct.html#v:90"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#val_get_field"><span class="id" title="axiom">val_get_field</span></a> <a class="idref" href="Struct.html#k:89"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#p:88"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#hfields"><span class="id" title="definition">hfields</span></a> <a class="idref" href="Struct.html#kvs:87"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Struct.html#p:88"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:91" class="idref" href="#r:91"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#r:91"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Struct.html#v:90"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Struct.html#hfields"><span class="id" title="definition">hfields</span></a> <a class="idref" href="Struct.html#kvs:87"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Struct.html#p:88"><span class="id" title="variable">p</span></a>).<br/>
</div>

<div class="doc">
Third and last, the read operation can be specified with respect
    to the predicate <span class="inlinecode"><span class="id" title="var">hrecord</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>, describing the full record, including
    its header. The specification is similar to the previous one. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_get_field_hrecord" class="idref" href="#triple_get_field_hrecord"><span class="id" title="axiom">triple_get_field_hrecord</span></a> : <span class="id" title="keyword">∀</span> <a id="kvs:93" class="idref" href="#kvs:93"><span class="id" title="binder">kvs</span></a> <a id="p:94" class="idref" href="#p:94"><span class="id" title="binder">p</span></a> <a id="k:95" class="idref" href="#k:95"><span class="id" title="binder">k</span></a> <a id="v:96" class="idref" href="#v:96"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#hfields_lookup"><span class="id" title="definition">hfields_lookup</span></a> <a class="idref" href="Struct.html#k:95"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#kvs:93"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Struct.html#v:96"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#val_get_field"><span class="id" title="axiom">val_get_field</span></a> <a class="idref" href="Struct.html#k:95"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#p:94"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#hrecord"><span class="id" title="definition">hrecord</span></a> <a class="idref" href="Struct.html#kvs:93"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Struct.html#p:94"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:97" class="idref" href="#r:97"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#r:97"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Struct.html#v:96"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Struct.html#hrecord"><span class="id" title="definition">hrecord</span></a> <a class="idref" href="Struct.html#kvs:93"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Struct.html#p:94"><span class="id" title="variable">p</span></a>).<br/>
</div>

<div class="doc">
<a id="lab397"></a><h2 class="section">Writing in Record Fields</h2>

<div class="paragraph"> </div>

 The write operation is described by an expression of the form
    <span class="inlinecode"><span class="id" title="var">val_set_field</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span>, where <span class="inlinecode"><span class="id" title="var">k</span></span> denotes a field name, and where <span class="inlinecode"><span class="id" title="var">p</span></span>
    denotes the location of a record, and <span class="inlinecode"><span class="id" title="var">v</span></span> is the new value for the field. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="val_set_field" class="idref" href="#val_set_field"><span class="id" title="axiom">val_set_field</span></a> : <a class="idref" href="Struct.html#field"><span class="id" title="definition">field</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
</div>

<div class="doc">
The write operation <span class="inlinecode"><span class="id" title="var">val_get_field</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> is abbreviated as
    <span class="inlinecode"><span class="id" title="keyword">Set</span></span> <span class="inlinecode"><span class="id" title="var">p'.k</span></span> <span class="inlinecode">':=</span> <span class="inlinecode"><span class="id" title="var">v</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Notation</span> <a id="9c37435ad2fd5658d2e72190079a1ccf" class="idref" href="#9c37435ad2fd5658d2e72190079a1ccf"><span class="id" title="notation">&quot;</span></a>t<sub>1</sub> '`.' k ':=' t<sub>2</sub>" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="Struct.html#val_set_field"><span class="id" title="axiom">val_set_field</span></a> <span class="id" title="var">k</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>)<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">trm</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 56, <span class="id" title="var">k</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">format</span> "t<sub>1</sub> '`.' k  ':=' t<sub>2</sub>")<br/>
&nbsp;&nbsp;: <span class="id" title="var">trm_scope_ext</span>.<br/>
</div>

<div class="doc">
Like for the read operation, the write operation can be specified at three
    levels. First, at the level of an individual field. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_set_field" class="idref" href="#triple_set_field"><span class="id" title="axiom">triple_set_field</span></a> : <span class="id" title="keyword">∀</span> <a id="v:100" class="idref" href="#v:100"><span class="id" title="binder">v</span></a> <a id="p:101" class="idref" href="#p:101"><span class="id" title="binder">p</span></a> <a id="k:102" class="idref" href="#k:102"><span class="id" title="binder">k</span></a> <a id="v':103" class="idref" href="#v':103"><span class="id" title="binder">v'</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#val_set_field"><span class="id" title="axiom">val_set_field</span></a> <a class="idref" href="Struct.html#k:102"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#p:101"><span class="id" title="variable">p</span></a> <a class="idref" href="Struct.html#v:100"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#p:101"><span class="id" title="variable">p</span></a><a class="idref" href="Struct.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">`.</span></a><a class="idref" href="Struct.html#k:102"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Struct.html#v':103"><span class="id" title="variable">v'</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Struct.html#p:101"><span class="id" title="variable">p</span></a><a class="idref" href="Struct.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">`.</span></a><a class="idref" href="Struct.html#k:102"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Struct.html#v:100"><span class="id" title="variable">v</span></a>).<br/>
</div>

<div class="doc">
Then, at the level of <span class="inlinecode"><span class="id" title="var">hfields</span></span> and <span class="inlinecode"><span class="id" title="var">hrecord</span></span>. To that end, we
    introduce an auxiliary function called <span class="inlinecode"><span class="id" title="var">hrecord_update</span></span> for computing
    the updated list of fields following an write operation.
    Concretely, <span class="inlinecode"><span class="id" title="var">hrecord_update</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">w</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> replaces the contents of the field
    named <span class="inlinecode"><span class="id" title="var">k</span></span> with the value <span class="inlinecode"><span class="id" title="var">w</span></span>. It returns some description <span class="inlinecode"><span class="id" title="var">kvs'</span></span> of the
    record fields, provided the update operation succeeded, i.e., provided that
    the field <span class="inlinecode"><span class="id" title="var">k</span></span> on which the update is to be performed actually occurs in the
    list <span class="inlinecode"><span class="id" title="var">kvs</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <a id="hfields_update" class="idref" href="#hfields_update"><span class="id" title="definition">hfields_update</span></a> (<a id="k:105" class="idref" href="#k:105"><span class="id" title="binder">k</span></a>:<a class="idref" href="Struct.html#field"><span class="id" title="definition">field</span></a>) (<a id="v:106" class="idref" href="#v:106"><span class="id" title="binder">v</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) (<a id="kvs:107" class="idref" href="#kvs:107"><span class="id" title="binder">kvs</span></a>:<a class="idref" href="Struct.html#hrecord_fields"><span class="id" title="definition">hrecord_fields</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="Struct.html#hrecord_fields"><span class="id" title="definition">hrecord_fields</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Struct.html#kvs:107"><span class="id" title="variable">kvs</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">ki</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">vi</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><span class="id" title="var">kvs'</span> ⇒ <span class="id" title="keyword">if</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#Nat.eq_dec"><span class="id" title="lemma">Nat.eq_dec</span></a> <a class="idref" href="Struct.html#k:105"><span class="id" title="variable">k</span></a> <span class="id" title="var">ki</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#k:105"><span class="id" title="variable">k</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Struct.html#v:106"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><span class="id" title="var">kvs'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="keyword">match</span> <a class="idref" href="Struct.html#hfields_update:108"><span class="id" title="definition">hfields_update</span></a> <a class="idref" href="Struct.html#k:105"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#v:106"><span class="id" title="variable">v</span></a> <span class="id" title="var">kvs'</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">LR</span> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">ki</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">vi</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><span class="id" title="var">LR</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
The specification in terms of <span class="inlinecode"><span class="id" title="var">hfields</span></span> is as follows. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_set_field_hfields" class="idref" href="#triple_set_field_hfields"><span class="id" title="axiom">triple_set_field_hfields</span></a> : <span class="id" title="keyword">∀</span> <a id="kvs:110" class="idref" href="#kvs:110"><span class="id" title="binder">kvs</span></a> <a id="kvs':111" class="idref" href="#kvs':111"><span class="id" title="binder">kvs'</span></a> <a id="k:112" class="idref" href="#k:112"><span class="id" title="binder">k</span></a> <a id="p:113" class="idref" href="#p:113"><span class="id" title="binder">p</span></a> <a id="v:114" class="idref" href="#v:114"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#hfields_update"><span class="id" title="definition">hfields_update</span></a> <a class="idref" href="Struct.html#k:112"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#v:114"><span class="id" title="variable">v</span></a> <a class="idref" href="Struct.html#kvs:110"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Struct.html#kvs':111"><span class="id" title="variable">kvs'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#val_set_field"><span class="id" title="axiom">val_set_field</span></a> <a class="idref" href="Struct.html#k:112"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#p:113"><span class="id" title="variable">p</span></a> <a class="idref" href="Struct.html#v:114"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#hfields"><span class="id" title="definition">hfields</span></a> <a class="idref" href="Struct.html#kvs:110"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Struct.html#p:113"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Struct.html#hfields"><span class="id" title="definition">hfields</span></a> <a class="idref" href="Struct.html#kvs':111"><span class="id" title="variable">kvs'</span></a> <a class="idref" href="Struct.html#p:113"><span class="id" title="variable">p</span></a>).<br/>
</div>

<div class="doc">
The specification in terms of <span class="inlinecode"><span class="id" title="var">hrecord</span></span> is similar. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_set_field_hrecord" class="idref" href="#triple_set_field_hrecord"><span class="id" title="axiom">triple_set_field_hrecord</span></a> : <span class="id" title="keyword">∀</span> <a id="kvs:116" class="idref" href="#kvs:116"><span class="id" title="binder">kvs</span></a> <a id="kvs':117" class="idref" href="#kvs':117"><span class="id" title="binder">kvs'</span></a> <a id="k:118" class="idref" href="#k:118"><span class="id" title="binder">k</span></a> <a id="p:119" class="idref" href="#p:119"><span class="id" title="binder">p</span></a> <a id="v:120" class="idref" href="#v:120"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#hfields_update"><span class="id" title="definition">hfields_update</span></a> <a class="idref" href="Struct.html#k:118"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#v:120"><span class="id" title="variable">v</span></a> <a class="idref" href="Struct.html#kvs:116"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Struct.html#kvs':117"><span class="id" title="variable">kvs'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#val_set_field"><span class="id" title="axiom">val_set_field</span></a> <a class="idref" href="Struct.html#k:118"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#p:119"><span class="id" title="variable">p</span></a> <a class="idref" href="Struct.html#v:120"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#hrecord"><span class="id" title="definition">hrecord</span></a> <a class="idref" href="Struct.html#kvs:116"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Struct.html#p:119"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Struct.html#hrecord"><span class="id" title="definition">hrecord</span></a> <a class="idref" href="Struct.html#kvs':117"><span class="id" title="variable">kvs'</span></a> <a class="idref" href="Struct.html#p:119"><span class="id" title="variable">p</span></a>).<br/>
</div>

<div class="doc">
<a id="lab398"></a><h2 class="section">Allocation of Records</h2>

<div class="paragraph"> </div>

 Because records are internally described like arrays, records may
    be allocated and deallocated using the operations <span class="inlinecode"><span class="id" title="var">val_alloc</span></span> and
    <span class="inlinecode"><span class="id" title="var">val_dealloc</span></span>, just like for arrays. That said, it is useful to
    express derived specifications for these two operations stated in
    terms of representation predicate <span class="inlinecode"><span class="id" title="var">hrecord</span></span>, which describes a
    full record in terms of the list of its fields. 
<div class="paragraph"> </div>

 For allocation, one needs to provide, at some point, the fields names
    for the record being allocated. These fields names may be described
    by a list of field names of type <span class="inlinecode"><span class="id" title="var">list</span></span> <span class="inlinecode"><span class="id" title="tactic">field</span></span>.

<div class="paragraph"> </div>

    This list, written <span class="inlinecode"><span class="id" title="var">ks</span></span>, should be equivalent to a list of
    consecutive natural numbers <span class="inlinecode">0</span> <span class="inlinecode">::</span> <span class="inlinecode">1</span> <span class="inlinecode">::</span> <span class="inlinecode">...</span> <span class="inlinecode">::</span> <span class="inlinecode"><span class="id" title="var">n</span>-1</span>, where <span class="inlinecode"><span class="id" title="var">n</span></span>
    denotes the number of fields. The interest of introducing the list
    <span class="inlinecode"><span class="id" title="var">ks</span></span> is to provide readable names in place of numbers.

<div class="paragraph"> </div>

    The operation <span class="inlinecode"><span class="id" title="var">val_alloc_hrecord</span></span> <span class="inlinecode"><span class="id" title="var">ks</span></span> is implemented by invoking
    <span class="inlinecode"><span class="id" title="var">val_alloc</span></span> on the length of <span class="inlinecode"><span class="id" title="var">ks</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="val_alloc_hrecord" class="idref" href="#val_alloc_hrecord"><span class="id" title="definition">val_alloc_hrecord</span></a> (<a id="ks:122" class="idref" href="#ks:122"><span class="id" title="binder">ks</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Struct.html#field"><span class="id" title="definition">field</span></a>) : <a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#val_alloc"><span class="id" title="axiom">val_alloc</span></a> (<span class="id" title="definition">length</span> <a class="idref" href="Struct.html#ks:122"><span class="id" title="variable">ks</span></a>).<br/>
</div>

<div class="doc">
The specification of <span class="inlinecode"><span class="id" title="var">val_alloc_hrecord</span></span> <span class="inlinecode"><span class="id" title="var">ks</span></span> involves an empty
    precondition and a postcondition of the form <span class="inlinecode"><span class="id" title="var">hrecord</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>,
    where the list <span class="inlinecode"><span class="id" title="var">kvs</span></span> maps the fields names from <span class="inlinecode"><span class="id" title="var">ks</span></span> to the
    value <span class="inlinecode"><span class="id" title="var">val_uninit</span></span>. The premise expressed in terms of <span class="inlinecode"><span class="id" title="var">nat_seq</span></span>
    ensures that the list <span class="inlinecode"><span class="id" title="var">ks</span></span> contains consecutive offsets starting
    from zero.

<div class="paragraph"> </div>

    In the statement below, <span class="inlinecode"><span class="id" title="var">LibListExec.length</span></span> is a variant of
    <span class="inlinecode"><span class="id" title="var">LibList.length</span></span> that computes in Coq (using <span class="inlinecode"><span class="id" title="tactic">simpl</span></span> or <span class="inlinecode"><span class="id" title="tactic">reflexivity</span></span>).
    Likewise for <span class="inlinecode"><span class="id" title="var">LibListExec.map</span></span>, which is equivalent to <span class="inlinecode"><span class="id" title="var">LibList.map</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_alloc_hrecord" class="idref" href="#triple_alloc_hrecord"><span class="id" title="axiom">triple_alloc_hrecord</span></a> : <span class="id" title="keyword">∀</span> <a id="ks:123" class="idref" href="#ks:123"><span class="id" title="binder">ks</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#ks:123"><span class="id" title="variable">ks</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">nat_seq</span> 0 (<span class="id" title="definition">LibListExec.length</span> <a class="idref" href="Struct.html#ks:123"><span class="id" title="variable">ks</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#val_alloc_hrecord"><span class="id" title="definition">val_alloc_hrecord</span></a> <a class="idref" href="Struct.html#ks:123"><span class="id" title="variable">ks</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:124" class="idref" href="#p:124"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Struct.html#hrecord"><span class="id" title="definition">hrecord</span></a> (<span class="id" title="definition">LibListExec.map</span> (<span class="id" title="keyword">fun</span> <a id="k:125" class="idref" href="#k:125"><span class="id" title="binder">k</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#k:125"><span class="id" title="variable">k</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="LibSepReference.html#val_uninit"><span class="id" title="constructor">val_uninit</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>) <a class="idref" href="Struct.html#ks:123"><span class="id" title="variable">ks</span></a>) <a class="idref" href="Struct.html#p:124"><span class="id" title="variable">p</span></a>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">triple_alloc_hrecord</span> : <span class="id" title="var">triple</span>.<br/>
</div>

<div class="doc">
For example, the allocation of a list cell is specified as follows. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_alloc_mcons" class="idref" href="#triple_alloc_mcons"><span class="id" title="lemma">triple_alloc_mcons</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#val_alloc_hrecord"><span class="id" title="definition">val_alloc_hrecord</span></a> (<a class="idref" href="Struct.html#head"><span class="id" title="definition">head</span></a><span class="id" title="notation">::</span><a class="idref" href="Struct.html#tail"><span class="id" title="definition">tail</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:127" class="idref" href="#p:127"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Struct.html#p:127"><span class="id" title="variable">p</span></a> <a class="idref" href="Struct.html#4fdf8be3226dc6822dfa0caeb9414d<sub>46</sub>"><span class="id" title="notation">~~~&gt;</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">`{</span></a> <a class="idref" href="Struct.html#head"><span class="id" title="definition">head</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="LibSepReference.html#val_uninit"><span class="id" title="constructor">val_uninit</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Struct.html#tail"><span class="id" title="definition">tail</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="LibSepReference.html#val_uninit"><span class="id" title="constructor">val_uninit</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">}</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Struct.html#triple_alloc_hrecord"><span class="id" title="axiom">triple_alloc_hrecord</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab399"></a><h2 class="section">Deallocation of Records</h2>

<div class="paragraph"> </div>

 Deallocation of a record, written <span class="inlinecode"><span class="id" title="var">val_dealloc_hrecord</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>, is
    implemented as <span class="inlinecode"><span class="id" title="var">val_dealloc</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="val_dealloc_hrecord" class="idref" href="#val_dealloc_hrecord"><span class="id" title="definition">val_dealloc_hrecord</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#val_dealloc"><span class="id" title="axiom">val_dealloc</span></a>.<br/>
</div>

<div class="doc">
The specification of this operation simply requires as precondition
    the full record description, in the form <span class="inlinecode"><span class="id" title="var">hrecord</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>, and yields
    the empty postcondition. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_dealloc_hrecord" class="idref" href="#triple_dealloc_hrecord"><span class="id" title="axiom">triple_dealloc_hrecord</span></a> : <span class="id" title="keyword">∀</span> <a id="kvs:128" class="idref" href="#kvs:128"><span class="id" title="binder">kvs</span></a> <a id="p:129" class="idref" href="#p:129"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#val_dealloc_hrecord"><span class="id" title="definition">val_dealloc_hrecord</span></a> <a class="idref" href="Struct.html#p:129"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#hrecord"><span class="id" title="definition">hrecord</span></a> <a class="idref" href="Struct.html#kvs:128"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Struct.html#p:129"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">triple_dealloc_hrecord</span> : <span class="id" title="var">triple</span>.<br/>
</div>

<div class="doc">
To improve readability, we introduce the notation <span class="inlinecode"><span class="id" title="var">Delete</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>
    for record deallocation. 
</div>
<div class="code">

<span class="id" title="keyword">Notation</span> <a id=":trm:trm_scope_ext:'delete'" class="idref" href="#:trm:trm_scope_ext:'delete'"><span class="id" title="notation">&quot;</span></a>'delete'" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <a class="idref" href="Struct.html#val_dealloc_hrecord"><span class="id" title="definition">val_dealloc_hrecord</span></a>)<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">trm</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0) : <span class="id" title="var">trm_scope_ext</span>.<br/>
</div>

<div class="doc">
For example, the following corollary to <span class="inlinecode"><span class="id" title="var">triple_dealloc_hrecord</span></span> may be
    used to reason about the deallocation of a list cell. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_dealloc_mcons" class="idref" href="#triple_dealloc_mcons"><span class="id" title="lemma">triple_dealloc_mcons</span></a> : <span class="id" title="keyword">∀</span> <a id="p:131" class="idref" href="#p:131"><span class="id" title="binder">p</span></a> <a id="x:132" class="idref" href="#x:132"><span class="id" title="binder">x</span></a> <a id="q:133" class="idref" href="#q:133"><span class="id" title="binder">q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#val_dealloc_hrecord"><span class="id" title="definition">val_dealloc_hrecord</span></a> <a class="idref" href="Struct.html#p:131"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#p:131"><span class="id" title="variable">p</span></a> <a class="idref" href="Struct.html#4fdf8be3226dc6822dfa0caeb9414d<sub>46</sub>"><span class="id" title="notation">~~~&gt;</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">`{</span></a> <a class="idref" href="Struct.html#head"><span class="id" title="definition">head</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Struct.html#x:132"><span class="id" title="variable">x</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Struct.html#tail"><span class="id" title="definition">tail</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Struct.html#q:133"><span class="id" title="variable">q</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">}</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Struct.html#triple_dealloc_hrecord"><span class="id" title="axiom">triple_dealloc_hrecord</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab400"></a><h2 class="section">Combined Record Allocation and Initialization</h2>

<div class="paragraph"> </div>

 It is often useful to allocate a record and immediately initialize
    its fields. To that end, we introduce the operation <span class="inlinecode"><span class="id" title="var">val_new_hrecord</span></span>,
    which applies to a list of fields and to values for these fields.

<div class="paragraph"> </div>

    This operation can be defined in an arity-generic way, yet, to avoid
    technicalities, we only present its specialization for arity 2. 
</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="RecordInit" class="idref" href="#RecordInit"><span class="id" title="module">RecordInit</span></a>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ProgramSyntax</span>.<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">trm_scope_ext</span>.<br/>
</div>

<div class="doc">
In the definition below, the expression in braces
    <span class="inlinecode"><span class="id" title="var">val_alloc_hrecord</span></span> <span class="inlinecode">(<span class="id" title="var">k<sub>1</sub></span>::<span class="id" title="var">k<sub>2</sub></span>::<span class="id" title="var">nil</span>)</span> refers to a Coq term,
    embedded in the syntax of program terms. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="RecordInit.val_new_hrecord_2" class="idref" href="#RecordInit.val_new_hrecord_2"><span class="id" title="definition">val_new_hrecord_2</span></a> (<a id="k<sub>1</sub>:134" class="idref" href="#k<sub>1</sub>:134"><span class="id" title="binder">k<sub>1</sub></span></a>:<a class="idref" href="Struct.html#field"><span class="id" title="definition">field</span></a>) (<a id="k<sub>2</sub>:135" class="idref" href="#k<sub>2</sub>:135"><span class="id" title="binder">k<sub>2</sub></span></a>:<a class="idref" href="Struct.html#field"><span class="id" title="definition">field</span></a>) : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#938475157e31b8b3433e07bd510fd74f"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x<sub>1</sub>'"><span class="id" title="notation">x<sub>1</sub></span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x<sub>2</sub>'"><span class="id" title="notation">x<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#938475157e31b8b3433e07bd510fd74f"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#a15607334da66bc8a82cc392003f629d"><span class="id" title="notation">{</span></a><a class="idref" href="Struct.html#val_alloc_hrecord"><span class="id" title="definition">val_alloc_hrecord</span></a> (<a class="idref" href="Struct.html#k<sub>1</sub>:134"><span class="id" title="variable">k<sub>1</sub></span></a><span class="id" title="notation">::</span><a class="idref" href="Struct.html#k<sub>2</sub>:135"><span class="id" title="variable">k<sub>2</sub></span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>)<a class="idref" href="LibSepReference.html#a15607334da66bc8a82cc392003f629d"><span class="id" title="notation">}</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="Struct.html#9c37435ad2fd5658d2e72190079a1ccf"><span class="id" title="notation">`.</span></a><a class="idref" href="Struct.html#k<sub>1</sub>:134"><span class="id" title="variable">k<sub>1</sub></span></a> <a class="idref" href="Struct.html#9c37435ad2fd5658d2e72190079a1ccf"><span class="id" title="notation">:=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x<sub>1</sub>'"><span class="id" title="notation">x<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="Struct.html#9c37435ad2fd5658d2e72190079a1ccf"><span class="id" title="notation">`.</span></a><a class="idref" href="Struct.html#k<sub>2</sub>:135"><span class="id" title="variable">k<sub>2</sub></span></a> <a class="idref" href="Struct.html#9c37435ad2fd5658d2e72190079a1ccf"><span class="id" title="notation">:=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x<sub>2</sub>'"><span class="id" title="notation">x<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
To improve readability, we introduce notation to allow writing, e.g.,
    <span class="inlinecode">`{</span> <span class="inlinecode"><span class="id" title="var">head</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">x</span>;</span> <span class="inlinecode"><span class="id" title="var">tail</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">q</span></span> <span class="inlinecode">}</span> for the allocation and initialization
    of a list cell. 
</div>
<div class="code">

<span class="id" title="keyword">Notation</span> <a id="f62af5f1c1516b5bcfb867232f3f0ed<sub>3</sub>" class="idref" href="#f62af5f1c1516b5bcfb867232f3f0ed<sub>3</sub>"><span class="id" title="notation">&quot;</span></a>`{ k<sub>1</sub> := v<sub>1</sub> ; k<sub>2</sub> := v<sub>2</sub> }" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="Struct.html#RecordInit.val_new_hrecord_2"><span class="id" title="definition">val_new_hrecord_2</span></a> <span class="id" title="var">k<sub>1</sub></span> <span class="id" title="var">k<sub>2</sub></span> <span class="id" title="var">v<sub>1</sub></span> <span class="id" title="var">v<sub>2</sub></span>)<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">trm</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 65,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">k<sub>1</sub></span>, <span class="id" title="var">k<sub>2</sub></span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">v<sub>1</sub></span>, <span class="id" title="var">v<sub>2</sub></span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 65) : <span class="id" title="var">trm_scope_ext</span>.<br/>
</div>

<div class="doc">
This operation is specified as follows. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="RecordInit.triple_new_hrecord_2" class="idref" href="#RecordInit.triple_new_hrecord_2"><span class="id" title="lemma">triple_new_hrecord_2</span></a> : <span class="id" title="keyword">∀</span> <a id="k<sub>1</sub>:136" class="idref" href="#k<sub>1</sub>:136"><span class="id" title="binder">k<sub>1</sub></span></a> <a id="k<sub>2</sub>:137" class="idref" href="#k<sub>2</sub>:137"><span class="id" title="binder">k<sub>2</sub></span></a> <a id="v<sub>1</sub>:138" class="idref" href="#v<sub>1</sub>:138"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="v<sub>2</sub>:139" class="idref" href="#v<sub>2</sub>:139"><span class="id" title="binder">v<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#k<sub>1</sub>:136"><span class="id" title="variable">k<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 0%<span class="id" title="var">nat</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#k<sub>2</sub>:137"><span class="id" title="variable">k<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 1%<span class="id" title="var">nat</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="Struct.html#f62af5f1c1516b5bcfb867232f3f0ed<sub>3</sub>"><span class="id" title="notation">`{</span></a> <a class="idref" href="Struct.html#k<sub>1</sub>:136"><span class="id" title="variable">k<sub>1</sub></span></a> <a class="idref" href="Struct.html#f62af5f1c1516b5bcfb867232f3f0ed<sub>3</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Struct.html#v<sub>1</sub>:138"><span class="id" title="variable">v<sub>1</sub></span></a><a class="idref" href="Struct.html#f62af5f1c1516b5bcfb867232f3f0ed<sub>3</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Struct.html#k<sub>2</sub>:137"><span class="id" title="variable">k<sub>2</sub></span></a> <a class="idref" href="Struct.html#f62af5f1c1516b5bcfb867232f3f0ed<sub>3</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Struct.html#v<sub>2</sub>:139"><span class="id" title="variable">v<sub>2</sub></span></a> <a class="idref" href="Struct.html#f62af5f1c1516b5bcfb867232f3f0ed<sub>3</sub>"><span class="id" title="notation">}</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:140" class="idref" href="#p:140"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Struct.html#p:140"><span class="id" title="variable">p</span></a> <a class="idref" href="Struct.html#4fdf8be3226dc6822dfa0caeb9414d<sub>46</sub>"><span class="id" title="notation">~~~&gt;</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">`{</span></a> <a class="idref" href="Struct.html#k<sub>1</sub>:136"><span class="id" title="variable">k<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Struct.html#v<sub>1</sub>:138"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Struct.html#k<sub>2</sub>:137"><span class="id" title="variable">k<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Struct.html#v<sub>2</sub>:139"><span class="id" title="variable">v<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">}</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> → →. <span class="id" title="var">xwp</span>. <span class="id" title="var">xapp</span> <a class="idref" href="Struct.html#triple_alloc_hrecord"><span class="id" title="axiom">triple_alloc_hrecord</span></a>. { <span class="id" title="tactic">auto</span>. } <span class="id" title="tactic">intros</span> <span class="id" title="var">p</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span> <a class="idref" href="Struct.html#triple_set_field_hrecord"><span class="id" title="axiom">triple_set_field_hrecord</span></a>. { <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span> <a class="idref" href="Struct.html#triple_set_field_hrecord"><span class="id" title="axiom">triple_set_field_hrecord</span></a>. { <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="var">xval</span>. <span class="id" title="var">xsimpl</span>*.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
For example, the operation <span class="inlinecode"><span class="id" title="var">mcons</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">q</span></span> allocates a list cell with
    head value <span class="inlinecode"><span class="id" title="var">x</span></span> and tail pointer <span class="inlinecode"><span class="id" title="var">q</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="RecordInit.mcons" class="idref" href="#RecordInit.mcons"><span class="id" title="definition">mcons</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#RecordInit.val_new_hrecord_2"><span class="id" title="definition">val_new_hrecord_2</span></a> <a class="idref" href="Struct.html#head"><span class="id" title="definition">head</span></a> <a class="idref" href="Struct.html#tail"><span class="id" title="definition">tail</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="RecordInit.triple_mcons" class="idref" href="#RecordInit.triple_mcons"><span class="id" title="lemma">triple_mcons</span></a> : <span class="id" title="keyword">∀</span> (<a id="x:141" class="idref" href="#x:141"><span class="id" title="binder">x</span></a> <a id="q:142" class="idref" href="#q:142"><span class="id" title="binder">q</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#RecordInit.mcons"><span class="id" title="definition">mcons</span></a> <a class="idref" href="Struct.html#x:141"><span class="id" title="variable">x</span></a> <a class="idref" href="Struct.html#q:142"><span class="id" title="variable">q</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:143" class="idref" href="#p:143"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Struct.html#p:143"><span class="id" title="variable">p</span></a> <a class="idref" href="Struct.html#4fdf8be3226dc6822dfa0caeb9414d<sub>46</sub>"><span class="id" title="notation">~~~&gt;</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">`{</span></a> <a class="idref" href="Struct.html#head"><span class="id" title="definition">head</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Struct.html#x:141"><span class="id" title="variable">x</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Struct.html#tail"><span class="id" title="definition">tail</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Struct.html#q:142"><span class="id" title="variable">q</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">}</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Struct.html#RecordInit.triple_new_hrecord_2"><span class="id" title="lemma">triple_new_hrecord_2</span></a>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="Struct.html#RecordInit"><span class="id" title="module">RecordInit</span></a>.<br/>
</div>

<div class="doc">
<a id="lab401"></a><h1 class="section">More Details</h1>

</div>

<div class="doc">
<a id="lab402"></a><h2 class="section">Extending <span class="inlinecode"><span class="id" title="var">xapp</span></span> to Support Record Access Operations</h2>

<div class="paragraph"> </div>

 The tactic <span class="inlinecode"><span class="id" title="var">xapp</span></span> can be refined to automatically invoke the
    lemmas <span class="inlinecode"><span class="id" title="var">triple_get_field_hrecord</span></span> and <span class="inlinecode"><span class="id" title="var">triple_set_field_hrecord</span></span>,
    which involve preconditions of the form
    <span class="inlinecode"><span class="id" title="var">hfields_lookup</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> and
    <span class="inlinecode"><span class="id" title="var">hfields_update</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode"><span class="id" title="var">ks'</span></span>, respectively.

<div class="paragraph"> </div>

    The auxiliary lemmas reformulate the specification triples in
    weakest-precondition form. The premise takes the form
    <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class='gray-font'>\</span><span class="id" title="tactic">∃</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span>,</span> <span class="inlinecode">(<span class="id" title="var">hrecord</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode"><span class="id" title="var">p</span>)</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="keyword">match</span></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="keyword">with</span></span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode">..</span> <span class="inlinecode">⇒</span> <span class="inlinecode">..</span>.

<div class="paragraph"> </div>

    This presentation enables using <span class="inlinecode"><span class="id" title="var">xsimpl</span></span> to extract the description
    of the record, named <span class="inlinecode"><span class="id" title="var">kvs</span></span>, before evaluating the <span class="inlinecode"><span class="id" title="var">lookup</span></span> or
    <span class="inlinecode"><span class="id" title="var">update</span></span> function for producing the suitable postcondition. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="xapp_get_field_lemma" class="idref" href="#xapp_get_field_lemma"><span class="id" title="lemma">xapp_get_field_lemma</span></a> : <span class="id" title="keyword">∀</span> <a id="H:144" class="idref" href="#H:144"><span class="id" title="binder">H</span></a> <a id="k:145" class="idref" href="#k:145"><span class="id" title="binder">k</span></a> <a id="p:146" class="idref" href="#p:146"><span class="id" title="binder">p</span></a> <a id="Q:147" class="idref" href="#Q:147"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#H:144"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="kvs:148" class="idref" href="#kvs:148"><span class="id" title="binder">kvs</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#hrecord"><span class="id" title="definition">hrecord</span></a> <a class="idref" href="Struct.html#kvs:148"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Struct.html#p:146"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Struct.html#hfields_lookup"><span class="id" title="definition">hfields_lookup</span></a> <a class="idref" href="Struct.html#k:145"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#kvs:148"><span class="id" title="variable">kvs</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">v</span> ⇒ (<a class="idref" href="LibSepReference.html#5609a52f091556b9923d5758aa61f543"><span class="id" title="notation">(</span></a><span class="id" title="keyword">fun</span> <a id="r:149" class="idref" href="#r:149"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#r:149"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">v</span><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Struct.html#hrecord"><span class="id" title="definition">hrecord</span></a> <a class="idref" href="Struct.html#kvs:148"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Struct.html#p:146"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#5609a52f091556b9923d5758aa61f543"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#5609a52f091556b9923d5758aa61f543"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="LibSepReference.html#HS.protect"><span class="id" title="definition">protect</span></a> <a class="idref" href="Struct.html#Q:147"><span class="id" title="variable">Q</span></a>) <span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#H:144"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="Struct.html#val_get_field"><span class="id" title="axiom">val_get_field</span></a> <a class="idref" href="Struct.html#k:145"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#p:146"><span class="id" title="variable">p</span></a>) <a class="idref" href="Struct.html#Q:147"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">N</span>. <span class="id" title="var">xchange</span> <span class="id" title="var">N</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">kvs</span>. <span class="id" title="var">cases</span> (<a class="idref" href="Struct.html#hfields_lookup"><span class="id" title="definition">hfields_lookup</span></a> <span class="id" title="var">k</span> <span class="id" title="var">kvs</span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#triple_conseq_frame"><span class="id" title="lemma">triple_conseq_frame</span></a> <a class="idref" href="Struct.html#triple_get_field_hrecord"><span class="id" title="axiom">triple_get_field_hrecord</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">r</span> →. <span class="id" title="var">xchange</span> (<a class="idref" href="LibSepReference.html#SepSimplArgs.qwand_specialize"><span class="id" title="lemma">qwand_specialize</span></a> <span class="id" title="var">v</span>). <span class="id" title="tactic">rewrite</span>* <a class="idref" href="LibSepReference.html#SepSimplArgs.hwand_hpure_l"><span class="id" title="lemma">hwand_hpure_l</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xpull</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="xapp_set_field_lemma" class="idref" href="#xapp_set_field_lemma"><span class="id" title="lemma">xapp_set_field_lemma</span></a> : <span class="id" title="keyword">∀</span> <a id="H:150" class="idref" href="#H:150"><span class="id" title="binder">H</span></a> <a id="k:151" class="idref" href="#k:151"><span class="id" title="binder">k</span></a> <a id="p:152" class="idref" href="#p:152"><span class="id" title="binder">p</span></a> <a id="v:153" class="idref" href="#v:153"><span class="id" title="binder">v</span></a> <a id="Q:154" class="idref" href="#Q:154"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#H:150"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="kvs:155" class="idref" href="#kvs:155"><span class="id" title="binder">kvs</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#hrecord"><span class="id" title="definition">hrecord</span></a> <a class="idref" href="Struct.html#kvs:155"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Struct.html#p:152"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Struct.html#hfields_update"><span class="id" title="definition">hfields_update</span></a> <a class="idref" href="Struct.html#k:151"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#v:153"><span class="id" title="variable">v</span></a> <a class="idref" href="Struct.html#kvs:155"><span class="id" title="variable">kvs</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">kvs'</span> ⇒ (<a class="idref" href="LibSepReference.html#5609a52f091556b9923d5758aa61f543"><span class="id" title="notation">(</span></a><span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Struct.html#hrecord"><span class="id" title="definition">hrecord</span></a> <span class="id" title="var">kvs'</span> <a class="idref" href="Struct.html#p:152"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#5609a52f091556b9923d5758aa61f543"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#5609a52f091556b9923d5758aa61f543"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="LibSepReference.html#HS.protect"><span class="id" title="definition">protect</span></a> <a class="idref" href="Struct.html#Q:154"><span class="id" title="variable">Q</span></a>) <span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#H:150"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="Struct.html#val_set_field"><span class="id" title="axiom">val_set_field</span></a> <a class="idref" href="Struct.html#k:151"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#p:152"><span class="id" title="variable">p</span></a> <a class="idref" href="Struct.html#v:153"><span class="id" title="variable">v</span></a>) <a class="idref" href="Struct.html#Q:154"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">N</span>. <span class="id" title="var">xchange</span> <span class="id" title="var">N</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">kvs</span>. <span class="id" title="var">cases</span> (<a class="idref" href="Struct.html#hfields_update"><span class="id" title="definition">hfields_update</span></a> <span class="id" title="var">k</span> <span class="id" title="var">v</span> <span class="id" title="var">kvs</span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#triple_conseq_frame"><span class="id" title="lemma">triple_conseq_frame</span></a> <a class="idref" href="Struct.html#triple_set_field_hrecord"><span class="id" title="axiom">triple_set_field_hrecord</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">r</span>. <span class="id" title="var">xchange</span> (<a class="idref" href="LibSepReference.html#SepSimplArgs.qwand_specialize"><span class="id" title="lemma">qwand_specialize</span></a> <span class="id" title="var">r</span>). }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xpull</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">xapp_nosubst_for_records</span> <span class="id" title="var">tt</span> <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">first</span> [ <span class="id" title="var">applys</span> <a class="idref" href="Struct.html#xapp_set_field_lemma"><span class="id" title="lemma">xapp_set_field_lemma</span></a>; <span class="id" title="var">xsimpl</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="var">xapp_simpl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">applys</span> <a class="idref" href="Struct.html#xapp_get_field_lemma"><span class="id" title="lemma">xapp_get_field_lemma</span></a>; <span class="id" title="var">xsimpl</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="var">xapp_simpl</span> ].<br/>
</div>

<div class="doc">
<a id="lab403"></a><h2 class="section">Deallocation Function for Lists</h2>

<div class="paragraph"> </div>

 Recall that our Separation Logic set up enforces that all allocated
    data eventually gets properly deallocated. In what follows, we present
    a function for recursively deallocating an entire mutable list. 
</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="ListDealloc" class="idref" href="#ListDealloc"><span class="id" title="module">ListDealloc</span></a>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ProgramSyntax</span> <span class="id" title="var">RecordInit</span>.<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">trm_scope_ext</span>.<br/>
</div>

<div class="doc">
The operation <span class="inlinecode"><span class="id" title="var">mfree_list</span></span> deallocates all the cells in a given list.
    It is implemented as a recursive function that invokes <span class="inlinecode"><span class="id" title="var">mfree_cell</span></span>
    on every cell that it traverses.

<div class="paragraph"> </div>

<span class="inlinecode-ocaml">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="keyword">rec</span> <span class="id" title="var">mfree_list</span> <span class="id" title="var">p</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">p</span> != <span class="id" title="var">null</span> <span class="id" title="keyword">then</span> <span class="id" title="var">begin</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">q</span> = <span class="id" title="var">p.tail</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">delete</span> <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mfree_list</span> <span class="id" title="var">q</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>
</span>
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="ListDealloc.mfree_list" class="idref" href="#ListDealloc.mfree_list"><span class="id" title="definition">mfree_list</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#7809db93a49fc4341c1251bb4de79a<sub>62</sub>"><span class="id" title="notation">fix</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#7809db93a49fc4341c1251bb4de79a<sub>62</sub>"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a><a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'end'"><span class="id" title="notation">if</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'end'"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">q</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="Struct.html#bc5af3b58d5c20163ac6d8a709b81319"><span class="id" title="notation">`.</span></a><a class="idref" href="Struct.html#tail"><span class="id" title="definition">tail</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Struct.html#:trm:trm_scope_ext:'delete'"><span class="id" title="notation">delete</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">q</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'end'"><span class="id" title="notation">end</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
The precondition of <span class="inlinecode"><span class="id" title="var">mfree_list</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> requires a full list <span class="inlinecode"><span class="id" title="var">MList</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>.
    The postcondition is empty: the entire list is destroyed. 
<div class="paragraph"> </div>

<a id="lab404"></a><h4 class="section">Exercise: 3 stars, standard, especially useful (Triple_mfree_list)</h4>
 Verify the function <span class="inlinecode"><span class="id" title="var">mfree_list</span></span>.
    Hint: the overall pattern of the proof follows that used for the
    function <span class="inlinecode"><span class="id" title="var">triple_mcopy</span></span>, from chapter <a href="Basic.html"><span class="inlineref">Basic</span></a>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="ListDealloc.triple_mfree_list" class="idref" href="#ListDealloc.triple_mfree_list"><span class="id" title="lemma">triple_mfree_list</span></a> : <span class="id" title="keyword">∀</span> <a id="L:156" class="idref" href="#L:156"><span class="id" title="binder">L</span></a> <a id="p:157" class="idref" href="#p:157"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#ListDealloc.mfree_list"><span class="id" title="definition">mfree_list</span></a> <a class="idref" href="Struct.html#p:157"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Struct.html#L:156"><span class="id" title="variable">L</span></a> <a class="idref" href="Struct.html#p:157"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<span class="id" title="keyword">End</span> <a class="idref" href="Struct.html#ListDealloc"><span class="id" title="module">ListDealloc</span></a>.<br/>
</div>

<div class="doc">
<a id="lab405"></a><h1 class="section">Optional Material</h1>

<div class="paragraph"> </div>

 The aim of this bonus section is to show how to establish
    the specifications presented in this chapter.

<div class="paragraph"> </div>

    To that end, we consider an extended language, featuring the
    operations <span class="inlinecode"><span class="id" title="var">val_alloc</span></span> and <span class="inlinecode"><span class="id" title="var">val_dealloc</span></span>, which operates on
    blocks of cells. 
</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="Realization" class="idref" href="#Realization"><span class="id" title="module">Realization</span></a>.<br/>
</div>

<div class="doc">
<a id="lab406"></a><h2 class="section">Refined Source Language</h2>

<div class="paragraph"> </div>

 We assume that every allocated block features a "header cell",
    represented explicitly in the memory state.

<div class="paragraph"> </div>

    To describe this header cell, we introduce a special value,
    written <span class="inlinecode"><span class="id" title="var">val_header</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span>, where <span class="inlinecode"><span class="id" title="var">k</span></span> denotes the length of the block
    that follows the header. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="Realization.val_header" class="idref" href="#Realization.val_header"><span class="id" title="axiom">val_header</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
</div>

<div class="doc">
Note that values of the form <span class="inlinecode"><span class="id" title="var">val_header</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> should never be
    introduced by source terms. They are only introduced in heaps
    by the evaluation of <span class="inlinecode"><span class="id" title="var">val_alloc</span></span>, and they should never leak
    in program terms. 
<div class="paragraph"> </div>

 The operation <span class="inlinecode"><span class="id" title="var">val_alloc</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> is specified as shown below. Starting from
    a state <span class="inlinecode"><span class="id" title="var">sa</span></span>, it produces a state <span class="inlinecode"><span class="id" title="var">sb</span></span> <span class="inlinecode">\<span class="id" title="var">u</span></span> <span class="inlinecode"><span class="id" title="var">sa</span></span> (i.e., the union of <span class="inlinecode"><span class="id" title="var">sb</span></span>
    and <span class="inlinecode"><span class="id" title="var">sa</span></span>), where <span class="inlinecode"><span class="id" title="var">sb</span></span> consists of consecutive of <span class="inlinecode"><span class="id" title="var">k</span>+1</span> consecutive
    cells. The head cell stores the special value <span class="inlinecode"><span class="id" title="var">val_header</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span>, while
    the <span class="inlinecode"><span class="id" title="var">k</span></span> following cells store the special value <span class="inlinecode"><span class="id" title="var">val_uninit</span></span>, describing
    uninitialized cells. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="Realization.eval_alloc" class="idref" href="#Realization.eval_alloc"><span class="id" title="axiom">eval_alloc</span></a> : <span class="id" title="keyword">∀</span> <a id="k:159" class="idref" href="#k:159"><span class="id" title="binder">k</span></a> <a id="n:160" class="idref" href="#n:160"><span class="id" title="binder">n</span></a> <a id="sa:161" class="idref" href="#sa:161"><span class="id" title="binder">sa</span></a> <a id="sb:162" class="idref" href="#sb:162"><span class="id" title="binder">sb</span></a> <a id="p:163" class="idref" href="#p:163"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#sb:162"><span class="id" title="variable">sb</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#Fmap.conseq"><span class="id" title="definition">Fmap.conseq</span></a> (<a class="idref" href="Struct.html#Realization.val_header"><span class="id" title="axiom">val_header</span></a> <a class="idref" href="Struct.html#k:159"><span class="id" title="variable">k</span></a> <span class="id" title="notation">::</span> <span class="id" title="definition">LibList.make</span> <a class="idref" href="Struct.html#k:159"><span class="id" title="variable">k</span></a> <a class="idref" href="LibSepReference.html#val_uninit"><span class="id" title="constructor">val_uninit</span></a>) <a class="idref" href="Struct.html#p:163"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#n:160"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">nat_to_Z</span> <a class="idref" href="Struct.html#k:159"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#p:163"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#Fmap.disjoint"><span class="id" title="definition">Fmap.disjoint</span></a> <a class="idref" href="Struct.html#sa:161"><span class="id" title="variable">sa</span></a> <a class="idref" href="Struct.html#sb:162"><span class="id" title="variable">sb</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Struct.html#sa:161"><span class="id" title="variable">sa</span></a> (<a class="idref" href="Struct.html#val_alloc"><span class="id" title="axiom">val_alloc</span></a> (<a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Struct.html#n:160"><span class="id" title="variable">n</span></a>)) (<a class="idref" href="Struct.html#sb:162"><span class="id" title="variable">sb</span></a> <a class="idref" href="LibSepReference.html#11dbc5cc324072f557c3f348a31ba1a<sub>0</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#11dbc5cc324072f557c3f348a31ba1a<sub>0</sub>"><span class="id" title="notation">u</span></a> <a class="idref" href="Struct.html#sa:161"><span class="id" title="variable">sa</span></a>) (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Struct.html#p:163"><span class="id" title="variable">p</span></a>).<br/>
</div>

<div class="doc">
The operation <span class="inlinecode"><span class="id" title="var">val_dealloc</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> is specified as shown below. Assume
    a state of the form <span class="inlinecode"><span class="id" title="var">sb</span></span> <span class="inlinecode">\<span class="id" title="var">u</span></span> <span class="inlinecode"><span class="id" title="var">sa</span></span>, where <span class="inlinecode"><span class="id" title="var">sb</span></span> consists of consecutive of
    <span class="inlinecode"><span class="id" title="var">k</span>+1</span> consecutive cells. Assume the first of these cells to store the
    special value <span class="inlinecode"><span class="id" title="var">val_header</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span>. Then, the deallocation operation removes
    the block described by <span class="inlinecode"><span class="id" title="var">sb</span></span>, and leaves the state <span class="inlinecode"><span class="id" title="var">sa</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="Realization.eval_dealloc" class="idref" href="#Realization.eval_dealloc"><span class="id" title="axiom">eval_dealloc</span></a> : <span class="id" title="keyword">∀</span> <a id="k:165" class="idref" href="#k:165"><span class="id" title="binder">k</span></a> <a id="vs:166" class="idref" href="#vs:166"><span class="id" title="binder">vs</span></a> <a id="sa:167" class="idref" href="#sa:167"><span class="id" title="binder">sa</span></a> <a id="sb:168" class="idref" href="#sb:168"><span class="id" title="binder">sb</span></a> <a id="p:169" class="idref" href="#p:169"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#sb:168"><span class="id" title="variable">sb</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#Fmap.conseq"><span class="id" title="definition">Fmap.conseq</span></a> (<a class="idref" href="Struct.html#Realization.val_header"><span class="id" title="axiom">val_header</span></a> <a class="idref" href="Struct.html#k:165"><span class="id" title="variable">k</span></a> <span class="id" title="notation">::</span> <a class="idref" href="Struct.html#vs:166"><span class="id" title="variable">vs</span></a>) <a class="idref" href="Struct.html#p:169"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#k:165"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">LibList.length</span> <a class="idref" href="Struct.html#vs:166"><span class="id" title="variable">vs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#Fmap.disjoint"><span class="id" title="definition">Fmap.disjoint</span></a> <a class="idref" href="Struct.html#sa:167"><span class="id" title="variable">sa</span></a> <a class="idref" href="Struct.html#sb:168"><span class="id" title="variable">sb</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> (<a class="idref" href="Struct.html#sb:168"><span class="id" title="variable">sb</span></a> <a class="idref" href="LibSepReference.html#11dbc5cc324072f557c3f348a31ba1a<sub>0</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#11dbc5cc324072f557c3f348a31ba1a<sub>0</sub>"><span class="id" title="notation">u</span></a> <a class="idref" href="Struct.html#sa:167"><span class="id" title="variable">sa</span></a>) (<a class="idref" href="Struct.html#val_dealloc"><span class="id" title="axiom">val_dealloc</span></a> (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Struct.html#p:169"><span class="id" title="variable">p</span></a>)) <a class="idref" href="Struct.html#sa:167"><span class="id" title="variable">sa</span></a> <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a>.<br/>
</div>

<div class="doc">
Rather than extending the language with primitive operations
    for reading and writing in array cells and record fields,
    we simply include a pointer arithmetic operation, named
    <span class="inlinecode"><span class="id" title="var">val_ptr_add</span></span>, and use it to encode all other access operations. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="Realization.val_ptr_add" class="idref" href="#Realization.val_ptr_add"><span class="id" title="axiom">val_ptr_add</span></a> : <a class="idref" href="LibSepReference.html#prim"><span class="id" title="inductive">prim</span></a>.<br/>
</div>

<div class="doc">
The operation <span class="inlinecode"><span class="id" title="var">val_ptr</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> applies to a pointer <span class="inlinecode"><span class="id" title="var">p</span></span> and an integer <span class="inlinecode"><span class="id" title="var">n</span></span>,
    and returns the address <span class="inlinecode"><span class="id" title="var">p</span>+<span class="id" title="var">n</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="Realization.eval_ptr_add" class="idref" href="#Realization.eval_ptr_add"><span class="id" title="axiom">eval_ptr_add</span></a> : <span class="id" title="keyword">∀</span> <a id="p<sub>1</sub>:172" class="idref" href="#p<sub>1</sub>:172"><span class="id" title="binder">p<sub>1</sub></span></a> <a id="p<sub>2</sub>:173" class="idref" href="#p<sub>2</sub>:173"><span class="id" title="binder">p<sub>2</sub></span></a> <a id="n:174" class="idref" href="#n:174"><span class="id" title="binder">n</span></a> <a id="s:175" class="idref" href="#s:175"><span class="id" title="binder">s</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#p<sub>2</sub>:173"><span class="id" title="variable">p<sub>2</sub></span></a>:<span class="id" title="notation">int</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Struct.html#p<sub>1</sub>:172"><span class="id" title="variable">p<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="Struct.html#n:174"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Struct.html#s:175"><span class="id" title="variable">s</span></a> (<a class="idref" href="Struct.html#Realization.val_ptr_add"><span class="id" title="axiom">val_ptr_add</span></a> (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Struct.html#p<sub>1</sub>:172"><span class="id" title="variable">p<sub>1</sub></span></a>) (<a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Struct.html#n:174"><span class="id" title="variable">n</span></a>)) <a class="idref" href="Struct.html#s:175"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Struct.html#p<sub>2</sub>:173"><span class="id" title="variable">p<sub>2</sub></span></a>).<br/>
</div>

<div class="doc">
Note that the specification above allows the integer <span class="inlinecode"><span class="id" title="var">n</span></span> to be negative,
    as long as <span class="inlinecode"><span class="id" title="var">p</span>+<span class="id" title="var">n</span></span> is nonnegative. That said, thereafter we only apply
    <span class="inlinecode"><span class="id" title="var">eval_ptr_add</span></span> to nonnegative arguments. 
<div class="paragraph"> </div>

 We also introduce the primitive operation <span class="inlinecode"><span class="id" title="var">val_length</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>, which returns
    the number stored in the header block at address <span class="inlinecode"><span class="id" title="var">p</span></span>. This operation is
    useful to implement the function <span class="inlinecode"><span class="id" title="var">val_array_length</span></span>, which reads the
    length of an array. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="Realization.val_length" class="idref" href="#Realization.val_length"><span class="id" title="axiom">val_length</span></a> : <a class="idref" href="LibSepReference.html#prim"><span class="id" title="inductive">prim</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Parameter</span> <a id="Realization.eval_length" class="idref" href="#Realization.eval_length"><span class="id" title="axiom">eval_length</span></a> : <span class="id" title="keyword">∀</span> <a id="s:178" class="idref" href="#s:178"><span class="id" title="binder">s</span></a> <a id="p:179" class="idref" href="#p:179"><span class="id" title="binder">p</span></a> <a id="k:180" class="idref" href="#k:180"><span class="id" title="binder">k</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#Fmap.indom"><span class="id" title="definition">Fmap.indom</span></a> <a class="idref" href="Struct.html#s:178"><span class="id" title="variable">s</span></a> <a class="idref" href="Struct.html#p:179"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#Realization.val_header"><span class="id" title="axiom">val_header</span></a> <a class="idref" href="Struct.html#k:180"><span class="id" title="variable">k</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#Fmap.read"><span class="id" title="definition">Fmap.read</span></a> <a class="idref" href="Struct.html#s:178"><span class="id" title="variable">s</span></a> <a class="idref" href="Struct.html#p:179"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Struct.html#s:178"><span class="id" title="variable">s</span></a> (<a class="idref" href="Struct.html#Realization.val_length"><span class="id" title="axiom">val_length</span></a> (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Struct.html#p:179"><span class="id" title="variable">p</span></a>)) <a class="idref" href="Struct.html#s:178"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Struct.html#k:180"><span class="id" title="variable">k</span></a>).<br/>
</div>

<div class="doc">
<a id="lab407"></a><h2 class="section">Realization of <span class="inlinecode"><span class="id" title="var">hheader</span></span></h2>

<div class="paragraph"> </div>

 The heap predicate <span class="inlinecode"><span class="id" title="var">hheader</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> describes a cell at location
    whose contents is the special value <span class="inlinecode"><span class="id" title="var">val_header</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span>, and with
    the invariant that <span class="inlinecode"><span class="id" title="var">p</span></span> is not null.

<div class="paragraph"> </div>

    <span class="inlinecode"><span class="id" title="var">hheader</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> is defined as <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode">(<span class="id" title="var">val_header</span></span> <span class="inlinecode"><span class="id" title="var">k</span>)</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">p</span></span> <span class="inlinecode">≠</span> <span class="inlinecode"><span class="id" title="var">null</span>]</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="Realization.hheader_def" class="idref" href="#Realization.hheader_def"><span class="id" title="axiom">hheader_def</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#hheader"><span class="id" title="axiom">hheader</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><span class="id" title="keyword">fun</span> (<a id="k:182" class="idref" href="#k:182"><span class="id" title="binder">k</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="p:183" class="idref" href="#p:183"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) ⇒ <a class="idref" href="Struct.html#p:183"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#Realization.val_header"><span class="id" title="axiom">val_header</span></a> <a class="idref" href="Struct.html#k:182"><span class="id" title="variable">k</span></a><a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#p:183"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
</div>

<div class="doc">
Like other heap predicates, the definition of <span class="inlinecode"><span class="id" title="var">hheader</span></span> is associated
    with an introduction and an elimination lemma. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.hheader_intro" class="idref" href="#Realization.hheader_intro"><span class="id" title="lemma">hheader_intro</span></a> : <span class="id" title="keyword">∀</span> <a id="p:185" class="idref" href="#p:185"><span class="id" title="binder">p</span></a> <a id="k:186" class="idref" href="#k:186"><span class="id" title="binder">k</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#p:185"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;(<a class="idref" href="Struct.html#hheader"><span class="id" title="axiom">hheader</span></a> <a class="idref" href="Struct.html#k:186"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#p:185"><span class="id" title="variable">p</span></a>) (<a class="idref" href="LibSepReference.html#Fmap.single"><span class="id" title="definition">Fmap.single</span></a> <a class="idref" href="Struct.html#p:185"><span class="id" title="variable">p</span></a> (<a class="idref" href="Struct.html#Realization.val_header"><span class="id" title="axiom">val_header</span></a> <a class="idref" href="Struct.html#k:186"><span class="id" title="variable">k</span></a>)).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">N</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="Struct.html#Realization.hheader_def"><span class="id" title="axiom">hheader_def</span></a>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_hpure_r"><span class="id" title="lemma">hstar_hpure_r</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>*. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hsingle_intro"><span class="id" title="lemma">hsingle_intro</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.hheader_inv" class="idref" href="#Realization.hheader_inv"><span class="id" title="lemma">hheader_inv</span></a>: <span class="id" title="keyword">∀</span> <a id="h:187" class="idref" href="#h:187"><span class="id" title="binder">h</span></a> <a id="p:188" class="idref" href="#p:188"><span class="id" title="binder">p</span></a> <a id="k:189" class="idref" href="#k:189"><span class="id" title="binder">k</span></a>,<br/>
&nbsp;&nbsp;(<a class="idref" href="Struct.html#hheader"><span class="id" title="axiom">hheader</span></a> <a class="idref" href="Struct.html#k:189"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#p:188"><span class="id" title="variable">p</span></a>) <a class="idref" href="Struct.html#h:187"><span class="id" title="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#h:187"><span class="id" title="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#Fmap.single"><span class="id" title="definition">Fmap.single</span></a> <a class="idref" href="Struct.html#p:188"><span class="id" title="variable">p</span></a> (<a class="idref" href="Struct.html#Realization.val_header"><span class="id" title="axiom">val_header</span></a> <a class="idref" href="Struct.html#k:189"><span class="id" title="variable">k</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Struct.html#p:188"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">E</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="Struct.html#Realization.hheader_def"><span class="id" title="axiom">hheader_def</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">E</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_hpure_r"><span class="id" title="lemma">hstar_hpure_r</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>*.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The heap predicate <span class="inlinecode"><span class="id" title="var">hheader</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> captures the invariant <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">≠</span> <span class="inlinecode"><span class="id" title="var">null</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.hheader_not_null" class="idref" href="#Realization.hheader_not_null"><span class="id" title="lemma">hheader_not_null</span></a> : <span class="id" title="keyword">∀</span> <a id="p:190" class="idref" href="#p:190"><span class="id" title="binder">p</span></a> <a id="k:191" class="idref" href="#k:191"><span class="id" title="binder">k</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#hheader"><span class="id" title="axiom">hheader</span></a> <a class="idref" href="Struct.html#k:191"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#p:190"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Struct.html#hheader"><span class="id" title="axiom">hheader</span></a> <a class="idref" href="Struct.html#k:191"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#p:190"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#p:190"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="Struct.html#Realization.hheader_def"><span class="id" title="axiom">hheader_def</span></a>. <span class="id" title="var">xsimpl</span>*. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The definition of <span class="inlinecode"><span class="id" title="var">hheader</span></span> is meant to show that one can prove all
    the specifications axiomatized so far. Note, however, that this
    definition should not be revealed to the end user. In other words,
    it should be made "strongly opaque". (Technically, this could be
    achieved by means of a functor in Coq.)

<div class="paragraph"> </div>

    Otherwise, the user could exploit the <span class="inlinecode"><span class="id" title="var">val_set</span></span> operation to update
    the contents of a header field, replacing <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode">(<span class="id" title="var">val_header</span></span> <span class="inlinecode"><span class="id" title="var">k</span>)</span>
    with <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">v</span></span> for another value <span class="inlinecode"><span class="id" title="var">v</span></span>, thereby compromising the
    invariants of the memory model. 
</div>

<div class="doc">
<a id="lab408"></a><h2 class="section">Introduction and Elimination Lemmas for <span class="inlinecode"><span class="id" title="var">hcells</span></span> and <span class="inlinecode"><span class="id" title="var">harray</span></span></h2>

<div class="paragraph"> </div>

 The heap predicates <span class="inlinecode"><span class="id" title="var">hcells</span></span> and <span class="inlinecode"><span class="id" title="var">harray</span></span> have their introduction
    and elimination lemmas stated as follows. These lemmas are useful
    for establishing the specifications of the allocation and of the
    deallocation operations. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.hcells_intro" class="idref" href="#Realization.hcells_intro"><span class="id" title="lemma">hcells_intro</span></a> : <span class="id" title="keyword">∀</span> <a id="L:192" class="idref" href="#L:192"><span class="id" title="binder">L</span></a> <a id="p:193" class="idref" href="#p:193"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;(<a class="idref" href="Struct.html#hcells"><span class="id" title="definition">hcells</span></a> <a class="idref" href="Struct.html#L:192"><span class="id" title="variable">L</span></a> <a class="idref" href="Struct.html#p:193"><span class="id" title="variable">p</span></a>) (<a class="idref" href="LibSepReference.html#Fmap.conseq"><span class="id" title="definition">Fmap.conseq</span></a> <a class="idref" href="Struct.html#L:192"><span class="id" title="variable">L</span></a> <a class="idref" href="Struct.html#p:193"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">L</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">L</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">L'</span>]; <span class="id" title="tactic">intros</span>; <span class="id" title="var">rew_listx</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hempty_intro"><span class="id" title="lemma">hempty_intro</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">simpl</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_intro"><span class="id" title="lemma">hstar_intro</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#SepSimplArgs.hsingle_intro"><span class="id" title="lemma">hsingle_intro</span></a>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <span class="id" title="var">IHL</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#Fmap.disjoint_single_conseq"><span class="id" title="lemma">Fmap.disjoint_single_conseq</span></a>. <span class="id" title="tactic">left</span>. <span class="id" title="var">math</span>. } }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.hcells_inv" class="idref" href="#Realization.hcells_inv"><span class="id" title="lemma">hcells_inv</span></a> : <span class="id" title="keyword">∀</span> <a id="p:194" class="idref" href="#p:194"><span class="id" title="binder">p</span></a> <a id="L:195" class="idref" href="#L:195"><span class="id" title="binder">L</span></a> <a id="h:196" class="idref" href="#h:196"><span class="id" title="binder">h</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#hcells"><span class="id" title="definition">hcells</span></a> <a class="idref" href="Struct.html#L:195"><span class="id" title="variable">L</span></a> <a class="idref" href="Struct.html#p:194"><span class="id" title="variable">p</span></a> <a class="idref" href="Struct.html#h:196"><span class="id" title="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#h:196"><span class="id" title="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#Fmap.conseq"><span class="id" title="definition">Fmap.conseq</span></a> <a class="idref" href="Struct.html#L:195"><span class="id" title="variable">L</span></a> <a class="idref" href="Struct.html#p:194"><span class="id" title="variable">p</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">N</span>. <span class="id" title="var">gen</span> <span class="id" title="var">p</span> <span class="id" title="var">h</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">L</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">x</span> <span class="id" title="var">L'</span>];<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="var">rew_listx</span>; <span class="id" title="var">simpls</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hempty_inv"><span class="id" title="lemma">hempty_inv</span></a> <span class="id" title="var">N</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">lets</span> (<span class="id" title="var">h<sub>1</sub></span>&amp;<span class="id" title="var">h<sub>2</sub></span>&amp;<span class="id" title="var">N<sub>1</sub></span>&amp;<span class="id" title="var">N<sub>2</sub></span>&amp;<span class="id" title="var">N<sub>3</sub></span>&amp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>): <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_inv"><span class="id" title="lemma">hstar_inv</span></a> <span class="id" title="var">N</span>. <span class="id" title="var">fequal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hsingle_inv"><span class="id" title="lemma">hsingle_inv</span></a> <span class="id" title="var">N<sub>1</sub></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <span class="id" title="var">IHL'</span> <span class="id" title="var">N<sub>2</sub></span>. } }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.harray_intro" class="idref" href="#Realization.harray_intro"><span class="id" title="lemma">harray_intro</span></a> : <span class="id" title="keyword">∀</span> <a id="k:197" class="idref" href="#k:197"><span class="id" title="binder">k</span></a> <a id="p:198" class="idref" href="#p:198"><span class="id" title="binder">p</span></a> <a id="L:199" class="idref" href="#L:199"><span class="id" title="binder">L</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#k:197"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Struct.html#L:199"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#p:198"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;(<a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Struct.html#L:199"><span class="id" title="variable">L</span></a> <a class="idref" href="Struct.html#p:198"><span class="id" title="variable">p</span></a>) (<a class="idref" href="LibSepReference.html#Fmap.conseq"><span class="id" title="definition">Fmap.conseq</span></a> (<a class="idref" href="Struct.html#Realization.val_header"><span class="id" title="axiom">val_header</span></a> <a class="idref" href="Struct.html#k:197"><span class="id" title="variable">k</span></a> <span class="id" title="notation">::</span> <a class="idref" href="Struct.html#L:199"><span class="id" title="variable">L</span></a>) <a class="idref" href="Struct.html#p:198"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">E</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a>. <span class="id" title="var">rew_listx</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_intro"><span class="id" title="lemma">hstar_intro</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">subst</span> <span class="id" title="var">k</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Struct.html#Realization.hheader_intro"><span class="id" title="lemma">hheader_intro</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Struct.html#Realization.hcells_intro"><span class="id" title="lemma">hcells_intro</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepFmap.html#disjoint_single_conseq"><span class="id" title="lemma">disjoint_single_conseq</span></a>. <span class="id" title="tactic">left</span>. <span class="id" title="var">math</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.harray_inv" class="idref" href="#Realization.harray_inv"><span class="id" title="lemma">harray_inv</span></a> : <span class="id" title="keyword">∀</span> <a id="p:200" class="idref" href="#p:200"><span class="id" title="binder">p</span></a> <a id="L:201" class="idref" href="#L:201"><span class="id" title="binder">L</span></a> <a id="h:202" class="idref" href="#h:202"><span class="id" title="binder">h</span></a>,<br/>
&nbsp;&nbsp;(<a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Struct.html#L:201"><span class="id" title="variable">L</span></a> <a class="idref" href="Struct.html#p:200"><span class="id" title="variable">p</span></a>) <a class="idref" href="Struct.html#h:202"><span class="id" title="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#h:202"><span class="id" title="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#Fmap.conseq"><span class="id" title="definition">Fmap.conseq</span></a> (<a class="idref" href="Struct.html#Realization.val_header"><span class="id" title="axiom">val_header</span></a> (<span class="id" title="definition">length</span> <a class="idref" href="Struct.html#L:201"><span class="id" title="variable">L</span></a>) <span class="id" title="notation">::</span> <a class="idref" href="Struct.html#L:201"><span class="id" title="variable">L</span></a>) <a class="idref" href="Struct.html#p:200"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Struct.html#p:200"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">N</span>. <span class="id" title="var">unfolds</span> <a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a>. <span class="id" title="var">rew_listx</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">lets</span> (<span class="id" title="var">h<sub>1</sub></span>&amp;<span class="id" title="var">h<sub>2</sub></span>&amp;<span class="id" title="var">N<sub>1</sub></span>&amp;<span class="id" title="var">N<sub>2</sub></span>&amp;<span class="id" title="var">N<sub>3</sub></span>&amp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>): <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_inv"><span class="id" title="lemma">hstar_inv</span></a> (<span class="id" title="definition">rm</span> <span class="id" title="var">N</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">lets</span> (<span class="id" title="var">N<sub>4</sub></span>&amp;<span class="id" title="var">Np</span>): <a class="idref" href="Struct.html#Realization.hheader_inv"><span class="id" title="lemma">hheader_inv</span></a> (<span class="id" title="definition">rm</span> <span class="id" title="var">N<sub>1</sub></span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">lets</span> <span class="id" title="var">N<sub>2</sub>'</span>: <a class="idref" href="Struct.html#Realization.hcells_inv"><span class="id" title="lemma">hcells_inv</span></a> (<span class="id" title="definition">rm</span> <span class="id" title="var">N<sub>2</sub></span>). <span class="id" title="tactic">subst</span>*.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab409"></a><h2 class="section">Proving the Specification of Allocation and Deallocation</h2>

<div class="paragraph"> </div>

 Following the usual pattern, we first establish a reasoning rule
    for allocation at the level of Hoare logic. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.hoare_alloc_nat" class="idref" href="#Realization.hoare_alloc_nat"><span class="id" title="lemma">hoare_alloc_nat</span></a> : <span class="id" title="keyword">∀</span> <a id="H:203" class="idref" href="#H:203"><span class="id" title="binder">H</span></a> <a id="k:204" class="idref" href="#k:204"><span class="id" title="binder">k</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#hoare"><span class="id" title="definition">hoare</span></a> (<a class="idref" href="Struct.html#val_alloc"><span class="id" title="axiom">val_alloc</span></a> <a class="idref" href="Struct.html#k:204"><span class="id" title="variable">k</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Struct.html#H:203"><span class="id" title="variable">H</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:205" class="idref" href="#p:205"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> (<span class="id" title="definition">LibList.make</span> <a class="idref" href="Struct.html#k:204"><span class="id" title="variable">k</span></a> <a class="idref" href="LibSepReference.html#val_uninit"><span class="id" title="constructor">val_uninit</span></a>) <a class="idref" href="Struct.html#p:205"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Struct.html#H:203"><span class="id" title="variable">H</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">Hh</span>. <span class="id" title="var">sets</span> <span class="id" title="var">L</span>: (<span class="id" title="definition">LibList.make</span> <span class="id" title="var">k</span> <a class="idref" href="LibSepReference.html#val_uninit"><span class="id" title="constructor">val_uninit</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="var">sets</span> <span class="id" title="var">L'</span>: (<a class="idref" href="Struct.html#Realization.val_header"><span class="id" title="axiom">val_header</span></a> <span class="id" title="var">k</span> <span class="id" title="notation">::</span> <span class="id" title="var">L</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">forwards</span>¬(<span class="id" title="var">p</span>&amp;<span class="id" title="var">Dp</span>&amp;<span class="id" title="var">Np</span>): (<a class="idref" href="LibSepReference.html#Fmap.conseq_fresh"><span class="id" title="lemma">Fmap.conseq_fresh</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a> <span class="id" title="var">h</span> <span class="id" title="var">L'</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<a class="idref" href="LibSepReference.html#11dbc5cc324072f557c3f348a31ba1a<sub>0</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#Fmap.conseq"><span class="id" title="definition">Fmap.conseq</span></a> <span class="id" title="var">L'</span> <span class="id" title="var">p</span><a class="idref" href="LibSepReference.html#11dbc5cc324072f557c3f348a31ba1a<sub>0</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#11dbc5cc324072f557c3f348a31ba1a<sub>0</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#11dbc5cc324072f557c3f348a31ba1a<sub>0</sub>"><span class="id" title="notation">u</span></a> <span class="id" title="var">h</span>) (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <span class="id" title="var">p</span>). <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span>¬(@<a class="idref" href="Struct.html#Realization.eval_alloc"><span class="id" title="axiom">eval_alloc</span></a> <span class="id" title="var">k</span>). }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hexists_intro"><span class="id" title="lemma">hexists_intro</span></a> <span class="id" title="var">p</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_hpure_l"><span class="id" title="lemma">hstar_hpure_l</span></a>. <span class="id" title="tactic">split</span>*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_intro"><span class="id" title="lemma">hstar_intro</span></a>. <span class="id" title="var">applys</span>* <a class="idref" href="Struct.html#Realization.harray_intro"><span class="id" title="lemma">harray_intro</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="var">L</span>. <span class="id" title="var">rew_listx</span>*. } }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
We then derive the Separation Logic reasoning rule. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_alloc_nat" class="idref" href="#Realization.triple_alloc_nat"><span class="id" title="lemma">triple_alloc_nat</span></a> : <span class="id" title="keyword">∀</span> <a id="k:206" class="idref" href="#k:206"><span class="id" title="binder">k</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#val_alloc"><span class="id" title="axiom">val_alloc</span></a> <a class="idref" href="Struct.html#k:206"><span class="id" title="variable">k</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:207" class="idref" href="#p:207"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> (<span class="id" title="definition">LibList.make</span> <a class="idref" href="Struct.html#k:206"><span class="id" title="variable">k</span></a> <a class="idref" href="LibSepReference.html#val_uninit"><span class="id" title="constructor">val_uninit</span></a>) <a class="idref" href="Struct.html#p:207"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H'</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#hoare_conseq"><span class="id" title="lemma">hoare_conseq</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Struct.html#Realization.hoare_alloc_nat"><span class="id" title="lemma">hoare_alloc_nat</span></a> <span class="id" title="var">H'</span>. } { <span class="id" title="var">xsimpl</span>. } { <span class="id" title="var">xsimpl</span>*. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The two corollaries to <span class="inlinecode"><span class="id" title="var">triple_alloc_nat</span></span> follow. The first one
    applies to an integer argument, as opposed to a natural number. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_alloc" class="idref" href="#Realization.triple_alloc"><span class="id" title="lemma">triple_alloc</span></a> : <span class="id" title="keyword">∀</span> <a id="n:208" class="idref" href="#n:208"><span class="id" title="binder">n</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#n:208"><span class="id" title="variable">n</span></a> <span class="id" title="notation">≥</span> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#val_alloc"><span class="id" title="axiom">val_alloc</span></a> <a class="idref" href="Struct.html#n:208"><span class="id" title="variable">n</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:209" class="idref" href="#p:209"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> (<span class="id" title="definition">LibList.make</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">n</span>) <a class="idref" href="LibSepReference.html#val_uninit"><span class="id" title="constructor">val_uninit</span></a>) <a class="idref" href="Struct.html#p:209"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">N</span>. <span class="id" title="tactic">rewrite</span> &lt;- (@<span class="id" title="lemma">abs_nonneg</span> <span class="id" title="var">n</span>) <span class="id" title="tactic">at</span> 1; [|<span class="id" title="tactic">auto</span>].<br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span> <a class="idref" href="Struct.html#Realization.triple_alloc_nat"><span class="id" title="lemma">triple_alloc_nat</span></a>. <span class="id" title="var">xsimpl</span>*.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The second corollary weakens the postcondition by not specifying
    the contents of the allocated cells. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_alloc_array" class="idref" href="#Realization.triple_alloc_array"><span class="id" title="lemma">triple_alloc_array</span></a> : <span class="id" title="keyword">∀</span> <a id="n:210" class="idref" href="#n:210"><span class="id" title="binder">n</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#n:210"><span class="id" title="variable">n</span></a> <span class="id" title="notation">≥</span> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#val_alloc"><span class="id" title="axiom">val_alloc</span></a> <a class="idref" href="Struct.html#n:210"><span class="id" title="variable">n</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:211" class="idref" href="#p:211"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="L:212" class="idref" href="#L:212"><span class="id" title="binder">L</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#n:210"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Struct.html#L:212"><span class="id" title="variable">L</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Struct.html#L:212"><span class="id" title="variable">L</span></a> <a class="idref" href="Struct.html#p:211"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">N</span>. <span class="id" title="var">xapp</span> <a class="idref" href="Struct.html#Realization.triple_alloc"><span class="id" title="lemma">triple_alloc</span></a>. { <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">p</span>. <span class="id" title="var">xsimpl</span>*. { <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">length_make</span>. <span class="id" title="tactic">rewrite</span>* <span class="id" title="lemma">abs_nonneg</span>. } }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
We also establish the specification of deallocation, first w.r.t.
    Hoare triples, then w.r.t. Separation Logic triples. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.hoare_dealloc" class="idref" href="#Realization.hoare_dealloc"><span class="id" title="lemma">hoare_dealloc</span></a> : <span class="id" title="keyword">∀</span> <a id="H:213" class="idref" href="#H:213"><span class="id" title="binder">H</span></a> <a id="L:214" class="idref" href="#L:214"><span class="id" title="binder">L</span></a> <a id="p:215" class="idref" href="#p:215"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#hoare"><span class="id" title="definition">hoare</span></a> (<a class="idref" href="Struct.html#val_dealloc"><span class="id" title="axiom">val_dealloc</span></a> <a class="idref" href="Struct.html#p:215"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Struct.html#L:214"><span class="id" title="variable">L</span></a> <a class="idref" href="Struct.html#p:215"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Struct.html#H:213"><span class="id" title="variable">H</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Struct.html#H:213"><span class="id" title="variable">H</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">Hh</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">Hh</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">h<sub>1</sub></span>&amp;<span class="id" title="var">h<sub>2</sub></span>&amp;<span class="id" title="var">N<sub>1</sub></span>&amp;<span class="id" title="var">N<sub>2</sub></span>&amp;<span class="id" title="var">N<sub>3</sub></span>&amp;<span class="id" title="var">N<sub>4</sub></span>). <span class="id" title="tactic">subst</span> <span class="id" title="var">h</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">h<sub>2</sub></span> <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a>. <span class="id" title="tactic">split</span>; [|<span class="id" title="tactic">auto</span>].<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span>* <a class="idref" href="Struct.html#Realization.eval_dealloc"><span class="id" title="axiom">eval_dealloc</span></a> <span class="id" title="var">L</span>. <span class="id" title="var">applys</span> <a class="idref" href="Struct.html#Realization.harray_inv"><span class="id" title="lemma">harray_inv</span></a> <span class="id" title="var">N<sub>1</sub></span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_dealloc" class="idref" href="#Realization.triple_dealloc"><span class="id" title="lemma">triple_dealloc</span></a> : <span class="id" title="keyword">∀</span> <a id="L:216" class="idref" href="#L:216"><span class="id" title="binder">L</span></a> <a id="p:217" class="idref" href="#p:217"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#val_dealloc"><span class="id" title="axiom">val_dealloc</span></a> <a class="idref" href="Struct.html#p:217"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Struct.html#L:216"><span class="id" title="variable">L</span></a> <a class="idref" href="Struct.html#p:217"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H'</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#hoare_conseq"><span class="id" title="lemma">hoare_conseq</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Struct.html#Realization.hoare_dealloc"><span class="id" title="lemma">hoare_dealloc</span></a> <span class="id" title="var">H'</span>. } { <span class="id" title="var">xsimpl</span>. } { <span class="id" title="var">xsimpl</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab410"></a><h2 class="section">Splitting Lemmas for <span class="inlinecode"><span class="id" title="var">hcells</span></span></h2>

<div class="paragraph"> </div>

 The description of the cells of an array can be split in pieces,
    allowing to describe only portions of the array. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.hcells_nil_eq" class="idref" href="#Realization.hcells_nil_eq"><span class="id" title="lemma">hcells_nil_eq</span></a> : <span class="id" title="keyword">∀</span> <a id="p:218" class="idref" href="#p:218"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#hcells"><span class="id" title="definition">hcells</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="Struct.html#p:218"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.hcells_cons_eq" class="idref" href="#Realization.hcells_cons_eq"><span class="id" title="lemma">hcells_cons_eq</span></a> : <span class="id" title="keyword">∀</span> <a id="p:219" class="idref" href="#p:219"><span class="id" title="binder">p</span></a> <a id="x:220" class="idref" href="#x:220"><span class="id" title="binder">x</span></a> <a id="L:221" class="idref" href="#L:221"><span class="id" title="binder">L</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#hcells"><span class="id" title="definition">hcells</span></a> (<a class="idref" href="Struct.html#x:220"><span class="id" title="variable">x</span></a><span class="id" title="notation">::</span><a class="idref" href="Struct.html#L:221"><span class="id" title="variable">L</span></a>) <a class="idref" href="Struct.html#p:219"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#p:219"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Struct.html#x:220"><span class="id" title="variable">x</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Struct.html#hcells"><span class="id" title="definition">hcells</span></a> <a class="idref" href="Struct.html#L:221"><span class="id" title="variable">L</span></a> (<a class="idref" href="Struct.html#p:219"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1)%<span class="id" title="var">nat</span>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="var">xsimpl</span>*. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.hcells_one_eq" class="idref" href="#Realization.hcells_one_eq"><span class="id" title="lemma">hcells_one_eq</span></a> : <span class="id" title="keyword">∀</span> <a id="p:222" class="idref" href="#p:222"><span class="id" title="binder">p</span></a> <a id="x:223" class="idref" href="#x:223"><span class="id" title="binder">x</span></a> <a id="L:224" class="idref" href="#L:224"><span class="id" title="binder">L</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#hcells"><span class="id" title="definition">hcells</span></a> (<a class="idref" href="Struct.html#x:223"><span class="id" title="variable">x</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>) <a class="idref" href="Struct.html#p:222"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#p:222"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Struct.html#x:223"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="Struct.html#Realization.hcells_cons_eq"><span class="id" title="lemma">hcells_cons_eq</span></a>, <a class="idref" href="Struct.html#Realization.hcells_nil_eq"><span class="id" title="lemma">hcells_nil_eq</span></a>. <span class="id" title="var">xsimpl</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.hcells_concat_eq" class="idref" href="#Realization.hcells_concat_eq"><span class="id" title="lemma">hcells_concat_eq</span></a> : <span class="id" title="keyword">∀</span> <a id="p:225" class="idref" href="#p:225"><span class="id" title="binder">p</span></a> <a id="L<sub>1</sub>:226" class="idref" href="#L<sub>1</sub>:226"><span class="id" title="binder">L<sub>1</sub></span></a> <a id="L<sub>2</sub>:227" class="idref" href="#L<sub>2</sub>:227"><span class="id" title="binder">L<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#hcells"><span class="id" title="definition">hcells</span></a> (<a class="idref" href="Struct.html#L<sub>1</sub>:226"><span class="id" title="variable">L<sub>1</sub></span></a><span class="id" title="notation">++</span><a class="idref" href="Struct.html#L<sub>2</sub>:227"><span class="id" title="variable">L<sub>2</sub></span></a>) <a class="idref" href="Struct.html#p:225"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#hcells"><span class="id" title="definition">hcells</span></a> <a class="idref" href="Struct.html#L<sub>1</sub>:226"><span class="id" title="variable">L<sub>1</sub></span></a> <a class="idref" href="Struct.html#p:225"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Struct.html#hcells"><span class="id" title="definition">hcells</span></a> <a class="idref" href="Struct.html#L<sub>2</sub>:227"><span class="id" title="variable">L<sub>2</sub></span></a> (<span class="id" title="definition">length</span> <a class="idref" href="Struct.html#L<sub>1</sub>:226"><span class="id" title="variable">L<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="Struct.html#p:225"><span class="id" title="variable">p</span></a>)%<span class="id" title="var">nat</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">gen</span> <span class="id" title="var">p</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">L<sub>1</sub></span>; <span class="id" title="tactic">intros</span>; <span class="id" title="var">rew_list</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHL1</span>. <span class="id" title="var">math_rewrite</span> (<span class="id" title="definition">length</span> <span class="id" title="var">L<sub>1</sub></span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">(</span></a><span class="id" title="var">p</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> 1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (<span class="id" title="definition">length</span> <span class="id" title="var">L<sub>1</sub></span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="var">p</span>))%<span class="id" title="var">nat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xsimpl</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
In order to reason about the read or write operation on a specific
    cell, we need to isolate this cell from the other cells of the array.
    Then, after the operation, we need to fold back to the view on the
    entire array.

<div class="paragraph"> </div>

    The isolation process is captured in a general way by the following
    "focus lemma". It reads as follows. Assume <span class="inlinecode"><span class="id" title="var">hcells</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> to initially
    describe a segment of an array. Then, the <span class="inlinecode"><span class="id" title="var">k</span></span>-th cell from this segment
    can be isolated as a predicate <span class="inlinecode">(<span class="id" title="var">p</span>+<span class="id" title="var">k</span>)</span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">v</span></span>, where <span class="inlinecode"><span class="id" title="var">v</span></span> denotes the
    <span class="inlinecode"><span class="id" title="var">k</span></span>-th item of <span class="inlinecode"><span class="id" title="var">L</span></span>, that is <span class="inlinecode"><span class="id" title="var">LibList.nth</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span>.

<div class="paragraph"> </div>

    What remains of the heap can be described using the magic wand operator
    as <span class="inlinecode">((<span class="id" title="var">p</span>+<span class="id" title="var">k</span>)</span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">v</span>)</span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode">(<span class="id" title="var">hcells</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span>)</span>, which captures the idea that when
    providing back the cell at location <span class="inlinecode"><span class="id" title="var">p</span>+<span class="id" title="var">k</span></span>, one regains the ownership of
    the original segment. 
<div class="paragraph"> </div>

 The following statement describes a focus lemma. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="Realization.hcells_focus_read" class="idref" href="#Realization.hcells_focus_read"><span class="id" title="axiom">hcells_focus_read</span></a> : <span class="id" title="keyword">∀</span> <a id="k:228" class="idref" href="#k:228"><span class="id" title="binder">k</span></a> <a id="p:229" class="idref" href="#p:229"><span class="id" title="binder">p</span></a> <a id="v:230" class="idref" href="#v:230"><span class="id" title="binder">v</span></a> <a id="L:231" class="idref" href="#L:231"><span class="id" title="binder">L</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#k:228"><span class="id" title="variable">k</span></a> <span class="id" title="notation">&lt;</span> <span class="id" title="definition">length</span> <a class="idref" href="Struct.html#L:231"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#v:230"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">LibList.nth</span> <a class="idref" href="Struct.html#k:228"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#L:231"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#hcells"><span class="id" title="definition">hcells</span></a> <a class="idref" href="Struct.html#L:231"><span class="id" title="variable">L</span></a> <a class="idref" href="Struct.html#p:229"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a>(<a class="idref" href="Struct.html#p:229"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a><a class="idref" href="Struct.html#k:228"><span class="id" title="variable">k</span></a>)%<span class="id" title="var">nat</span> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Struct.html#v:230"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a>(<a class="idref" href="Struct.html#p:229"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a><a class="idref" href="Struct.html#k:228"><span class="id" title="variable">k</span></a>)%<span class="id" title="var">nat</span> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Struct.html#v:230"><span class="id" title="variable">v</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Struct.html#hcells"><span class="id" title="definition">hcells</span></a> <a class="idref" href="Struct.html#L:231"><span class="id" title="variable">L</span></a> <a class="idref" href="Struct.html#p:229"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>.<br/>
</div>

<div class="doc">
The above lemma is, however, limited to read operations. Indeed, it imposes
    the cell <span class="inlinecode">(<span class="id" title="var">p</span>+<span class="id" title="var">k</span>)</span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">v</span></span> to be merged back into the array segment, without
    modification to the original contents <span class="inlinecode"><span class="id" title="var">v</span></span>.

<div class="paragraph"> </div>

    The lemma can be generalized into a form that takes into account the
    possibility of folding back the array segment with a modified contents
    for the cell at <span class="inlinecode"><span class="id" title="var">p</span>+<span class="id" title="var">k</span></span>, described by <span class="inlinecode">(<span class="id" title="var">p</span>+<span class="id" title="var">k</span>)</span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">w</span></span>, for any value <span class="inlinecode"><span class="id" title="var">w</span></span>.
    The updated segment gets described as <span class="inlinecode"><span class="id" title="var">update</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">w</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.hcells_focus" class="idref" href="#Realization.hcells_focus"><span class="id" title="lemma">hcells_focus</span></a> : <span class="id" title="keyword">∀</span> <a id="k:233" class="idref" href="#k:233"><span class="id" title="binder">k</span></a> <a id="p:234" class="idref" href="#p:234"><span class="id" title="binder">p</span></a> <a id="L:235" class="idref" href="#L:235"><span class="id" title="binder">L</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#k:233"><span class="id" title="variable">k</span></a> <span class="id" title="notation">&lt;</span> <span class="id" title="definition">length</span> <a class="idref" href="Struct.html#L:235"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#hcells"><span class="id" title="definition">hcells</span></a> <a class="idref" href="Struct.html#L:235"><span class="id" title="variable">L</span></a> <a class="idref" href="Struct.html#p:234"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a>(<a class="idref" href="Struct.html#p:234"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a><a class="idref" href="Struct.html#k:233"><span class="id" title="variable">k</span></a>)%<span class="id" title="var">nat</span> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <span class="id" title="definition">LibList.nth</span> <a class="idref" href="Struct.html#k:233"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#L:235"><span class="id" title="variable">L</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">∀</span></a> <a id="w:236" class="idref" href="#w:236"><span class="id" title="binder">w</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">(</span></a>(<a class="idref" href="Struct.html#p:234"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a><a class="idref" href="Struct.html#k:233"><span class="id" title="variable">k</span></a>)%<span class="id" title="var">nat</span> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Struct.html#w:236"><span class="id" title="variable">w</span></a><a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Struct.html#hcells"><span class="id" title="definition">hcells</span></a> (<span class="id" title="definition">LibList.update</span> <a class="idref" href="Struct.html#k:233"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#w:236"><span class="id" title="variable">w</span></a> <a class="idref" href="Struct.html#L:235"><span class="id" title="variable">L</span></a>) <a class="idref" href="Struct.html#p:234"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">E</span>. <span class="id" title="var">gen</span> <span class="id" title="var">k</span> <span class="id" title="var">p</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">L</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">x</span> <span class="id" title="var">L'</span>]; <span class="id" title="var">rew_list</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">false</span>. <span class="id" title="var">math</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">nth_cons_case</span>. <span class="id" title="var">case_if</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">subst</span>. <span class="id" title="var">math_rewrite</span> (<span class="id" title="var">p</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">p</span>)%<span class="id" title="var">nat</span>. <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">w</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">update_zero</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="Struct.html#Realization.hcells_cons_eq"><span class="id" title="lemma">hcells_cons_eq</span></a>. <span class="id" title="var">xsimpl</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">forwards</span> <span class="id" title="var">R</span>: <span class="id" title="var">IHL'</span> (<span class="id" title="var">k</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a>1)%<span class="id" title="var">nat</span> (<span class="id" title="var">p</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1)%<span class="id" title="var">nat</span>. { <span class="id" title="var">math</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">math_rewrite</span> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">(</span></a><span class="id" title="var">p</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">)+(</span></a><span class="id" title="var">k</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">p</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a><span class="id" title="var">k</span>)%<span class="id" title="var">nat</span> <span class="id" title="keyword">in</span> <span class="id" title="var">R</span>. <span class="id" title="var">xchange</span> (<span class="id" title="definition">rm</span> <span class="id" title="var">R</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">w</span>. <span class="id" title="var">xchange</span> (<a class="idref" href="LibSepReference.html#SepSimplArgs.hforall_specialize"><span class="id" title="lemma">hforall_specialize</span></a> <span class="id" title="var">w</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">update_cons_pos</span>; [|<span class="id" title="var">math</span>]. <span class="id" title="tactic">rewrite</span> <a class="idref" href="Struct.html#Realization.hcells_cons_eq"><span class="id" title="lemma">hcells_cons_eq</span></a>. <span class="id" title="var">xsimpl</span>. } }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The above focus lemma immediately extends to a full array described
    in the form <span class="inlinecode"><span class="id" title="var">harray</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.harray_focus" class="idref" href="#Realization.harray_focus"><span class="id" title="lemma">harray_focus</span></a> : <span class="id" title="keyword">∀</span> <a id="k:237" class="idref" href="#k:237"><span class="id" title="binder">k</span></a> <a id="p:238" class="idref" href="#p:238"><span class="id" title="binder">p</span></a> <a id="L:239" class="idref" href="#L:239"><span class="id" title="binder">L</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#k:237"><span class="id" title="variable">k</span></a> <span class="id" title="notation">&lt;</span> <span class="id" title="definition">length</span> <a class="idref" href="Struct.html#L:239"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Struct.html#L:239"><span class="id" title="variable">L</span></a> <a class="idref" href="Struct.html#p:238"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a>(<a class="idref" href="Struct.html#p:238"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a><a class="idref" href="Struct.html#k:237"><span class="id" title="variable">k</span></a>)%<span class="id" title="var">nat</span> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <span class="id" title="definition">LibList.nth</span> <a class="idref" href="Struct.html#k:237"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#L:239"><span class="id" title="variable">L</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">∀</span></a> <a id="w:240" class="idref" href="#w:240"><span class="id" title="binder">w</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">(</span></a>(<a class="idref" href="Struct.html#p:238"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a><a class="idref" href="Struct.html#k:237"><span class="id" title="variable">k</span></a>)%<span class="id" title="var">nat</span> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Struct.html#w:240"><span class="id" title="variable">w</span></a><a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> (<span class="id" title="definition">LibList.update</span> <a class="idref" href="Struct.html#k:237"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#w:240"><span class="id" title="variable">w</span></a> <a class="idref" href="Struct.html#L:239"><span class="id" title="variable">L</span></a>) <a class="idref" href="Struct.html#p:238"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">E</span>. <span class="id" title="var">unfolds</span> <a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a>. <span class="id" title="var">xchanges</span> (<span class="id" title="notation">&gt;&gt;</span> <a class="idref" href="Struct.html#Realization.hcells_focus"><span class="id" title="lemma">hcells_focus</span></a> <span class="id" title="var">E</span>). <span class="id" title="tactic">intros</span> <span class="id" title="var">w</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xchange</span> (<a class="idref" href="LibSepReference.html#SepSimplArgs.hforall_specialize"><span class="id" title="lemma">hforall_specialize</span></a> <span class="id" title="var">w</span>). <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">rewrite</span>* <span class="id" title="lemma">length_update</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab411"></a><h2 class="section">Specification of Pointer Arithmetic</h2>

<div class="paragraph"> </div>

 The operation <span class="inlinecode"><span class="id" title="var">val_ptr_add</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> adds an integer <span class="inlinecode"><span class="id" title="var">n</span></span> to the
    address <span class="inlinecode"><span class="id" title="var">p</span></span>. This operation is used for encoding array and
    record operations by accessing cells at specific offsets.

<div class="paragraph"> </div>

    The specification of <span class="inlinecode"><span class="id" title="var">val_ptr_add</span></span> directly reformulates the
    evaluation rule. It is established following the usual pattern
    for primitive operations. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.hoare_ptr_add" class="idref" href="#Realization.hoare_ptr_add"><span class="id" title="lemma">hoare_ptr_add</span></a> : <span class="id" title="keyword">∀</span> <a id="p:241" class="idref" href="#p:241"><span class="id" title="binder">p</span></a> <a id="n:242" class="idref" href="#n:242"><span class="id" title="binder">n</span></a> <a id="H:243" class="idref" href="#H:243"><span class="id" title="binder">H</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#p:241"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="Struct.html#n:242"><span class="id" title="variable">n</span></a> <span class="id" title="notation">≥</span> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#hoare"><span class="id" title="definition">hoare</span></a> (<a class="idref" href="Struct.html#Realization.val_ptr_add"><span class="id" title="axiom">val_ptr_add</span></a> <a class="idref" href="Struct.html#p:241"><span class="id" title="variable">p</span></a> <a class="idref" href="Struct.html#n:242"><span class="id" title="variable">n</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Struct.html#H:243"><span class="id" title="variable">H</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:244" class="idref" href="#r:244"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#r:244"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> (<span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">p</span> <span class="id" title="notation">+</span> <span class="id" title="notation">n</span><span class="id" title="notation">)</span>)<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Struct.html#H:243"><span class="id" title="variable">H</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">N</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">s</span> <span class="id" title="var">K<sub>0</sub></span>. <span class="id" title="tactic">∃</span> <span class="id" title="var">s</span> (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> (<span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">p</span> <span class="id" title="notation">+</span> <span class="id" title="notation">n</span><span class="id" title="notation">)</span>)). <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Struct.html#Realization.eval_ptr_add"><span class="id" title="axiom">eval_ptr_add</span></a>. <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">abs_nonneg</span>; <span class="id" title="var">math</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span>* <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_hpure_l"><span class="id" title="lemma">hstar_hpure_l</span></a>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_ptr_add" class="idref" href="#Realization.triple_ptr_add"><span class="id" title="lemma">triple_ptr_add</span></a> : <span class="id" title="keyword">∀</span> <a id="p:245" class="idref" href="#p:245"><span class="id" title="binder">p</span></a> <a id="n:246" class="idref" href="#n:246"><span class="id" title="binder">n</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#p:245"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="Struct.html#n:246"><span class="id" title="variable">n</span></a> <span class="id" title="notation">≥</span> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#Realization.val_ptr_add"><span class="id" title="axiom">val_ptr_add</span></a> <a class="idref" href="Struct.html#p:245"><span class="id" title="variable">p</span></a> <a class="idref" href="Struct.html#n:246"><span class="id" title="variable">n</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:247" class="idref" href="#r:247"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#r:247"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> (<span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">p</span> <span class="id" title="notation">+</span> <span class="id" title="notation">n</span><span class="id" title="notation">)</span>)<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">N</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#hoare_conseq"><span class="id" title="lemma">hoare_conseq</span></a> <a class="idref" href="Struct.html#Realization.hoare_ptr_add"><span class="id" title="lemma">hoare_ptr_add</span></a>; <span class="id" title="var">xsimpl</span>*.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The following lemma specializes the specification for the case
    where the argument <span class="inlinecode"><span class="id" title="var">n</span></span> is equal to a natural number <span class="inlinecode"><span class="id" title="var">k</span></span>. This
    reformulation avoids the <span class="inlinecode"><span class="id" title="var">abs</span></span> function, and is more practical for
    the encodings that we consider further in the subsequent sections. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_ptr_add_nat" class="idref" href="#Realization.triple_ptr_add_nat"><span class="id" title="lemma">triple_ptr_add_nat</span></a> : <span class="id" title="keyword">∀</span> <a id="p:248" class="idref" href="#p:248"><span class="id" title="binder">p</span></a> <a id="k:249" class="idref" href="#k:249"><span class="id" title="binder">k</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#Realization.val_ptr_add"><span class="id" title="axiom">val_ptr_add</span></a> <a class="idref" href="Struct.html#p:248"><span class="id" title="variable">p</span></a> <a class="idref" href="Struct.html#k:249"><span class="id" title="variable">k</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:250" class="idref" href="#r:250"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#r:250"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> (<a class="idref" href="Struct.html#p:248"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a><a class="idref" href="Struct.html#k:249"><span class="id" title="variable">k</span></a>)%<span class="id" title="var">nat</span><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_conseq"><span class="id" title="lemma">triple_conseq</span></a> <a class="idref" href="Struct.html#Realization.triple_ptr_add"><span class="id" title="lemma">triple_ptr_add</span></a>. { <span class="id" title="var">math</span>. } { <span class="id" title="var">xsimpl</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="var">fequals</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">applys</span> <span class="id" title="lemma">eq_nat_of_eq_int</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">abs_nonneg</span>; <span class="id" title="var">math</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab412"></a><h2 class="section">Specification of the <span class="inlinecode"><span class="id" title="var">length</span></span> Operation to Read the Header</h2>

<div class="paragraph"> </div>

 To establish <span class="inlinecode"><span class="id" title="var">triple_length</span></span>, we follow the same proof pattern
    as for <span class="inlinecode"><span class="id" title="var">triple_get</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.eval_length_sep" class="idref" href="#Realization.eval_length_sep"><span class="id" title="lemma">eval_length_sep</span></a> : <span class="id" title="keyword">∀</span> <a id="s:251" class="idref" href="#s:251"><span class="id" title="binder">s</span></a> <a id="s<sub>2</sub>:252" class="idref" href="#s<sub>2</sub>:252"><span class="id" title="binder">s<sub>2</sub></span></a> <a id="p:253" class="idref" href="#p:253"><span class="id" title="binder">p</span></a> <a id="k:254" class="idref" href="#k:254"><span class="id" title="binder">k</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#s:251"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#Fmap.union"><span class="id" title="definition">Fmap.union</span></a> (<a class="idref" href="LibSepReference.html#Fmap.single"><span class="id" title="definition">Fmap.single</span></a> <a class="idref" href="Struct.html#p:253"><span class="id" title="variable">p</span></a> (<a class="idref" href="Struct.html#Realization.val_header"><span class="id" title="axiom">val_header</span></a> <a class="idref" href="Struct.html#k:254"><span class="id" title="variable">k</span></a>)) <a class="idref" href="Struct.html#s<sub>2</sub>:252"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Struct.html#s:251"><span class="id" title="variable">s</span></a> (<a class="idref" href="Struct.html#Realization.val_length"><span class="id" title="axiom">val_length</span></a> (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Struct.html#p:253"><span class="id" title="variable">p</span></a>)) <a class="idref" href="Struct.html#s:251"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Struct.html#k:254"><span class="id" title="variable">k</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> →. <span class="id" title="var">forwards</span> <span class="id" title="var">Dv</span>: <a class="idref" href="LibSepReference.html#Fmap.indom_single"><span class="id" title="lemma">Fmap.indom_single</span></a> <span class="id" title="var">p</span> (<a class="idref" href="Struct.html#Realization.val_header"><span class="id" title="axiom">val_header</span></a> <span class="id" title="var">k</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="Struct.html#Realization.eval_length"><span class="id" title="axiom">eval_length</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span>¬<a class="idref" href="LibSepReference.html#Fmap.indom_union_l"><span class="id" title="lemma">Fmap.indom_union_l</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span>¬<a class="idref" href="LibSepReference.html#Fmap.read_union_l"><span class="id" title="lemma">Fmap.read_union_l</span></a>. <span class="id" title="tactic">rewrite</span>¬<a class="idref" href="LibSepReference.html#Fmap.read_single"><span class="id" title="lemma">Fmap.read_single</span></a>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.hoare_length" class="idref" href="#Realization.hoare_length"><span class="id" title="lemma">hoare_length</span></a> : <span class="id" title="keyword">∀</span> <a id="H:255" class="idref" href="#H:255"><span class="id" title="binder">H</span></a> <a id="k:256" class="idref" href="#k:256"><span class="id" title="binder">k</span></a> <a id="p:257" class="idref" href="#p:257"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#hoare"><span class="id" title="definition">hoare</span></a> (<a class="idref" href="Struct.html#Realization.val_length"><span class="id" title="axiom">val_length</span></a> <a class="idref" href="Struct.html#p:257"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#hheader"><span class="id" title="axiom">hheader</span></a> <a class="idref" href="Struct.html#k:256"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#p:257"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Struct.html#H:255"><span class="id" title="variable">H</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:258" class="idref" href="#r:258"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#r:258"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Struct.html#k:256"><span class="id" title="variable">k</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#hheader"><span class="id" title="axiom">hheader</span></a> <a class="idref" href="Struct.html#k:256"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#p:257"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Struct.html#H:255"><span class="id" title="variable">H</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">s</span> <span class="id" title="var">K<sub>0</sub></span>. <span class="id" title="tactic">∃</span> <span class="id" title="var">s</span> (<a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <span class="id" title="var">k</span>). <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> <span class="id" title="var">K<sub>0</sub></span> <span class="id" title="keyword">as</span> (<span class="id" title="var">s<sub>1</sub></span>&amp;<span class="id" title="var">s<sub>2</sub></span>&amp;<span class="id" title="var">P<sub>1</sub></span>&amp;<span class="id" title="var">P<sub>2</sub></span>&amp;<span class="id" title="var">D</span>&amp;<span class="id" title="var">U</span>). <span class="id" title="var">lets</span> (<span class="id" title="var">E<sub>1</sub></span>&amp;<span class="id" title="var">N</span>): <a class="idref" href="Struct.html#Realization.hheader_inv"><span class="id" title="lemma">hheader_inv</span></a> <span class="id" title="var">P<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="var">s<sub>1</sub></span>. <span class="id" title="var">applys</span> <a class="idref" href="Struct.html#Realization.eval_length_sep"><span class="id" title="lemma">eval_length_sep</span></a> <span class="id" title="var">U</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span>¬<a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_hpure_l"><span class="id" title="lemma">hstar_hpure_l</span></a>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_length" class="idref" href="#Realization.triple_length"><span class="id" title="lemma">triple_length</span></a> : <span class="id" title="keyword">∀</span> <a id="k:259" class="idref" href="#k:259"><span class="id" title="binder">k</span></a> <a id="p:260" class="idref" href="#p:260"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#Realization.val_length"><span class="id" title="axiom">val_length</span></a> <a class="idref" href="Struct.html#p:260"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#hheader"><span class="id" title="axiom">hheader</span></a> <a class="idref" href="Struct.html#k:259"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#p:260"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:261" class="idref" href="#r:261"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#r:261"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Struct.html#k:259"><span class="id" title="variable">k</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Struct.html#hheader"><span class="id" title="axiom">hheader</span></a> <a class="idref" href="Struct.html#k:259"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#p:260"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H'</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#hoare_conseq"><span class="id" title="lemma">hoare_conseq</span></a> <a class="idref" href="Struct.html#Realization.hoare_length"><span class="id" title="lemma">hoare_length</span></a>; <span class="id" title="var">xsimpl</span>¬.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">triple_length</span> : <span class="id" title="var">triple</span>.<br/>
</div>

<div class="doc">
<a id="lab413"></a><h2 class="section">Encoding of Array Operations using Pointer Arithmetic</h2>

<div class="paragraph"> </div>

 An access to the <span class="inlinecode"><span class="id" title="var">i</span></span>-th cell of an array at location <span class="inlinecode"><span class="id" title="var">p</span></span> can be encoded
    as an access to the cell at location <span class="inlinecode"><span class="id" title="var">p</span>+<span class="id" title="var">i</span>+1</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Module</span> <span class="id" title="keyword">Export</span> <a id="Realization.ArrayAccessDef" class="idref" href="#Realization.ArrayAccessDef"><span class="id" title="module">ArrayAccessDef</span></a>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ProgramSyntax</span>.<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">wp_scope</span>.<br/>
</div>

<div class="doc">
Let's first state and prove two auxiliary arithmetic lemmas that
    are needed in the proofs below. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.ArrayAccessDef.abs_lt_inbound" class="idref" href="#Realization.ArrayAccessDef.abs_lt_inbound"><span class="id" title="lemma">abs_lt_inbound</span></a> : <span class="id" title="keyword">∀</span> <a id="i:262" class="idref" href="#i:262"><span class="id" title="binder">i</span></a> <a id="k:263" class="idref" href="#k:263"><span class="id" title="binder">k</span></a>,<br/>
&nbsp;&nbsp;0 <span class="id" title="notation">≤</span> <a class="idref" href="Struct.html#i:262"><span class="id" title="variable">i</span></a> <span class="id" title="notation">&lt;</span> <span class="id" title="definition">nat_to_Z</span> <a class="idref" href="Struct.html#k:263"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="notation">abs</span> <span class="id" title="notation">i</span> <span class="id" title="notation">&lt;</span> <a class="idref" href="Struct.html#k:263"><span class="id" title="variable">k</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">N</span>. <span class="id" title="tactic">apply</span> <span class="id" title="lemma">lt_nat_of_lt_int</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">abs_nonneg</span>; <span class="id" title="var">math</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.ArrayAccessDef.succ_int_plus_abs" class="idref" href="#Realization.ArrayAccessDef.succ_int_plus_abs"><span class="id" title="lemma">succ_int_plus_abs</span></a> : <span class="id" title="keyword">∀</span> <a id="p:264" class="idref" href="#p:264"><span class="id" title="binder">p</span></a> <a id="i:265" class="idref" href="#i:265"><span class="id" title="binder">i</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#i:265"><span class="id" title="variable">i</span></a> <span class="id" title="notation">≥</span> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#p:264"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> 1 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="notation">abs</span> <span class="id" title="notation">i</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="notation">abs</span> <span class="id" title="notation">(</span><span class="id" title="notation">nat_to_Z</span> <span class="id" title="notation">p</span> <span class="id" title="notation">+</span> <span class="id" title="notation">(</span><span class="id" title="notation">i</span> <span class="id" title="notation">+</span> <span class="id" title="notation">1))</span>)%<span class="id" title="var">nat</span>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">N</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">abs_nat_plus_nonneg</span>; [|<span class="id" title="var">math</span>].<br/>
&nbsp;&nbsp;<span class="id" title="var">math_rewrite</span> (<span class="id" title="var">i</span><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 1 <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">i</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="lemma">succ_abs_eq_abs_one_plus</span>; <span class="id" title="var">math</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The length operation on an array, written <span class="inlinecode"><span class="id" title="var">val_array_length</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>,
    is encoded as <span class="inlinecode"><span class="id" title="var">val_length</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>, where <span class="inlinecode"><span class="id" title="var">val_length</span></span> is the
    primitive operation for reading the contents of a header. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="Realization.ArrayAccessDef.val_array_length" class="idref" href="#Realization.ArrayAccessDef.val_array_length"><span class="id" title="definition">val_array_length</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> := <a class="idref" href="Struct.html#Realization.val_length"><span class="id" title="axiom">val_length</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.ArrayAccessDef.triple_array_length_header" class="idref" href="#Realization.ArrayAccessDef.triple_array_length_header"><span class="id" title="lemma">triple_array_length_header</span></a> : <span class="id" title="keyword">∀</span> <a id="k:266" class="idref" href="#k:266"><span class="id" title="binder">k</span></a> <a id="p:267" class="idref" href="#p:267"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#Realization.ArrayAccessDef.val_array_length"><span class="id" title="definition">val_array_length</span></a> <a class="idref" href="Struct.html#p:267"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#hheader"><span class="id" title="axiom">hheader</span></a> <a class="idref" href="Struct.html#k:266"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#p:267"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:268" class="idref" href="#r:268"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#r:268"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Struct.html#k:266"><span class="id" title="variable">k</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Struct.html#hheader"><span class="id" title="axiom">hheader</span></a> <a class="idref" href="Struct.html#k:266"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#p:267"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span> <a class="idref" href="Struct.html#Realization.triple_length"><span class="id" title="lemma">triple_length</span></a>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.ArrayAccessDef.triple_array_length" class="idref" href="#Realization.ArrayAccessDef.triple_array_length"><span class="id" title="lemma">triple_array_length</span></a> : <span class="id" title="keyword">∀</span> <a id="L:269" class="idref" href="#L:269"><span class="id" title="binder">L</span></a> <a id="p:270" class="idref" href="#p:270"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#Realization.ArrayAccessDef.val_array_length"><span class="id" title="definition">val_array_length</span></a> <a class="idref" href="Struct.html#p:270"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Struct.html#L:269"><span class="id" title="variable">L</span></a> <a class="idref" href="Struct.html#p:270"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:271" class="idref" href="#r:271"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#r:271"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Struct.html#L:269"><span class="id" title="variable">L</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Struct.html#L:269"><span class="id" title="variable">L</span></a> <a class="idref" href="Struct.html#p:270"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_conseq_frame"><span class="id" title="lemma">triple_conseq_frame</span></a> <a class="idref" href="Struct.html#Realization.triple_length"><span class="id" title="lemma">triple_length</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span>. } { <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">auto</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The get operation on an array, written <span class="inlinecode"><span class="id" title="var">val_array_get</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span>,
    is encoded as <span class="inlinecode"><span class="id" title="var">val_get</span></span> <span class="inlinecode">(<span class="id" title="var">p</span>+<span class="id" title="var">i</span>+1)</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="Realization.ArrayAccessDef.val_array_get" class="idref" href="#Realization.ArrayAccessDef.val_array_get"><span class="id" title="definition">val_array_get</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#938475157e31b8b3433e07bd510fd74f"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">i</span></a> <a class="idref" href="LibSepReference.html#938475157e31b8b3433e07bd510fd74f"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">j</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">i</span></a> <a class="idref" href="LibSepReference.html#590da34eb63eef1c68773c655749c128"><span class="id" title="notation">+</span></a> 1 <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="Struct.html#Realization.val_ptr_add"><span class="id" title="axiom">val_ptr_add</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">j</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#val_get"><span class="id" title="constructor">val_get</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.ArrayAccessDef.triple_array_get" class="idref" href="#Realization.ArrayAccessDef.triple_array_get"><span class="id" title="lemma">triple_array_get</span></a> : <span class="id" title="keyword">∀</span> <a id="p:272" class="idref" href="#p:272"><span class="id" title="binder">p</span></a> <a id="i:273" class="idref" href="#i:273"><span class="id" title="binder">i</span></a> <a id="v:274" class="idref" href="#v:274"><span class="id" title="binder">v</span></a> <a id="L:275" class="idref" href="#L:275"><span class="id" title="binder">L</span></a>,<br/>
&nbsp;&nbsp;0 <span class="id" title="notation">≤</span> <a class="idref" href="Struct.html#i:273"><span class="id" title="variable">i</span></a> <span class="id" title="notation">&lt;</span> <span class="id" title="definition">length</span> <a class="idref" href="Struct.html#L:275"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">LibList.nth</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">i</span>) <a class="idref" href="Struct.html#L:275"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Struct.html#v:274"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#Realization.ArrayAccessDef.val_array_get"><span class="id" title="definition">val_array_get</span></a> <a class="idref" href="Struct.html#p:272"><span class="id" title="variable">p</span></a> <a class="idref" href="Struct.html#i:273"><span class="id" title="variable">i</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Struct.html#L:275"><span class="id" title="variable">L</span></a> <a class="idref" href="Struct.html#p:272"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:276" class="idref" href="#r:276"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#r:276"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Struct.html#v:274"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Struct.html#L:275"><span class="id" title="variable">L</span></a> <a class="idref" href="Struct.html#p:272"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">N</span> <span class="id" title="var">E</span>. <span class="id" title="var">xwp</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xapp</span> <a class="idref" href="Struct.html#Realization.triple_ptr_add"><span class="id" title="lemma">triple_ptr_add</span></a>. { <span class="id" title="var">math</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="var">xchange</span> (@<a class="idref" href="Struct.html#Realization.harray_focus"><span class="id" title="lemma">harray_focus</span></a> (<span class="id" title="notation">abs</span> <span class="id" title="notation">i</span>) <span class="id" title="var">p</span> <span class="id" title="var">L</span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="var">rew_listx</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Struct.html#Realization.ArrayAccessDef.abs_lt_inbound"><span class="id" title="lemma">abs_lt_inbound</span></a>. }<br/>
&nbsp;&nbsp;<span class="id" title="var">sets</span> <span class="id" title="var">w</span>: (<span class="id" title="definition">LibList.nth</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">i</span>) <span class="id" title="var">L</span>). <span class="id" title="tactic">rewrite</span> <a class="idref" href="Struct.html#Realization.ArrayAccessDef.succ_int_plus_abs"><span class="id" title="lemma">succ_int_plus_abs</span></a>; [|<span class="id" title="var">math</span>].<br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span> <a class="idref" href="LibSepReference.html#triple_get"><span class="id" title="lemma">triple_get</span></a>. <span class="id" title="var">xchange</span> (<a class="idref" href="LibSepReference.html#SepSimplArgs.hforall_specialize"><span class="id" title="lemma">hforall_specialize</span></a> <span class="id" title="var">w</span>). <span class="id" title="tactic">subst</span> <span class="id" title="var">w</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">update_nth_same</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">E</span>. <span class="id" title="var">xsimpl</span>*.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">rew_listx</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Struct.html#Realization.ArrayAccessDef.abs_lt_inbound"><span class="id" title="lemma">abs_lt_inbound</span></a>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The set operation on an array, written <span class="inlinecode"><span class="id" title="var">val_array_set</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span>,
    is encoded as <span class="inlinecode"><span class="id" title="var">val_set</span></span> <span class="inlinecode">(<span class="id" title="var">p</span>+<span class="id" title="var">i</span>+1)</span> <span class="inlinecode"><span class="id" title="var">v</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="Realization.ArrayAccessDef.val_array_set" class="idref" href="#Realization.ArrayAccessDef.val_array_set"><span class="id" title="definition">val_array_set</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#b6d801b3aa81391158443a1134f53d<sub>41</sub>"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">i</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">v</span></a> <a class="idref" href="LibSepReference.html#b6d801b3aa81391158443a1134f53d<sub>41</sub>"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">j</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''i'"><span class="id" title="notation">i</span></a> <a class="idref" href="LibSepReference.html#590da34eb63eef1c68773c655749c128"><span class="id" title="notation">+</span></a> 1 <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="Struct.html#Realization.val_ptr_add"><span class="id" title="axiom">val_ptr_add</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''j'"><span class="id" title="notation">j</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#val_set"><span class="id" title="constructor">val_set</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">v</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.ArrayAccessDef.triple_array_set" class="idref" href="#Realization.ArrayAccessDef.triple_array_set"><span class="id" title="lemma">triple_array_set</span></a> : <span class="id" title="keyword">∀</span> <a id="p:277" class="idref" href="#p:277"><span class="id" title="binder">p</span></a> <a id="i:278" class="idref" href="#i:278"><span class="id" title="binder">i</span></a> <a id="v:279" class="idref" href="#v:279"><span class="id" title="binder">v</span></a> <a id="L:280" class="idref" href="#L:280"><span class="id" title="binder">L</span></a>,<br/>
&nbsp;&nbsp;0 <span class="id" title="notation">≤</span> <a class="idref" href="Struct.html#i:278"><span class="id" title="variable">i</span></a> <span class="id" title="notation">&lt;</span> <span class="id" title="definition">length</span> <a class="idref" href="Struct.html#L:280"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#Realization.ArrayAccessDef.val_array_set"><span class="id" title="definition">val_array_set</span></a> <a class="idref" href="Struct.html#p:277"><span class="id" title="variable">p</span></a> <a class="idref" href="Struct.html#i:278"><span class="id" title="variable">i</span></a> <a class="idref" href="Struct.html#v:279"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> <a class="idref" href="Struct.html#L:280"><span class="id" title="variable">L</span></a> <a class="idref" href="Struct.html#p:277"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> (<span class="id" title="definition">LibList.update</span> (<span class="id" title="notation">abs</span> <span class="id" title="notation">i</span>) <a class="idref" href="Struct.html#v:279"><span class="id" title="variable">v</span></a> <a class="idref" href="Struct.html#L:280"><span class="id" title="variable">L</span></a>) <a class="idref" href="Struct.html#p:277"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">R</span>. <span class="id" title="var">xwp</span>. <span class="id" title="var">xpull</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xapp</span> <a class="idref" href="Struct.html#Realization.triple_ptr_add"><span class="id" title="lemma">triple_ptr_add</span></a>. { <span class="id" title="var">math</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="var">xchange</span> (@<a class="idref" href="Struct.html#Realization.harray_focus"><span class="id" title="lemma">harray_focus</span></a> (<span class="id" title="notation">abs</span> <span class="id" title="notation">i</span>) <span class="id" title="var">p</span> <span class="id" title="var">L</span>). { <span class="id" title="var">applys</span>* <a class="idref" href="Struct.html#Realization.ArrayAccessDef.abs_lt_inbound"><span class="id" title="lemma">abs_lt_inbound</span></a>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="Struct.html#Realization.ArrayAccessDef.succ_int_plus_abs"><span class="id" title="lemma">succ_int_plus_abs</span></a>; [|<span class="id" title="var">math</span>].<br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span> <a class="idref" href="LibSepReference.html#triple_set"><span class="id" title="lemma">triple_set</span></a>. <span class="id" title="tactic">auto</span>. <span class="id" title="var">xchange</span> (<a class="idref" href="LibSepReference.html#SepSimplArgs.hforall_specialize"><span class="id" title="lemma">hforall_specialize</span></a> <span class="id" title="var">v</span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="Struct.html#Realization.ArrayAccessDef"><span class="id" title="module">ArrayAccessDef</span></a>.<br/>
</div>

<div class="doc">
<a id="lab414"></a><h2 class="section">Encoding of Record Operations using Pointer Arithmetic</h2>

<div class="paragraph"> </div>

 An access to the <span class="inlinecode"><span class="id" title="var">k</span></span>-th field of a record at location <span class="inlinecode"><span class="id" title="var">p</span></span> can be
    encoded as an access to the cell at location <span class="inlinecode"><span class="id" title="var">p</span>+<span class="id" title="var">k</span>+1</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Module</span> <span class="id" title="keyword">Export</span> <a id="Realization.FieldAccessDef" class="idref" href="#Realization.FieldAccessDef"><span class="id" title="module">FieldAccessDef</span></a>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ProgramSyntax</span>.<br/>
</div>

<div class="doc">
The get operation on a field, written <span class="inlinecode"><span class="id" title="var">p'.k</span></span>,
    is encoded as <span class="inlinecode"><span class="id" title="var">val_get</span></span> <span class="inlinecode">(<span class="id" title="var">p</span>+<span class="id" title="var">k</span>+1)</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="Realization.FieldAccessDef.val_get_field" class="idref" href="#Realization.FieldAccessDef.val_get_field"><span class="id" title="definition">val_get_field</span></a> (<a id="k:281" class="idref" href="#k:281"><span class="id" title="binder">k</span></a>:<a class="idref" href="Struct.html#field"><span class="id" title="definition">field</span></a>) : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">q</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="Struct.html#Realization.val_ptr_add"><span class="id" title="axiom">val_ptr_add</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#a15607334da66bc8a82cc392003f629d"><span class="id" title="notation">{</span></a><span class="id" title="definition">nat_to_Z</span> (<a class="idref" href="Struct.html#k:281"><span class="id" title="variable">k</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1)<a class="idref" href="LibSepReference.html#a15607334da66bc8a82cc392003f629d"><span class="id" title="notation">}</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#val_get"><span class="id" title="constructor">val_get</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">q</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <a id="38eeae9f5458d96b95a3bc581948ccd4" class="idref" href="#38eeae9f5458d96b95a3bc581948ccd4"><span class="id" title="notation">&quot;</span></a>t<sub>1</sub> '`.' f" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="Struct.html#Realization.FieldAccessDef.val_get_field"><span class="id" title="definition">val_get_field</span></a> <span class="id" title="var">f</span> <span class="id" title="var">t<sub>1</sub></span>)<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">trm</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 56, <span class="id" title="var">f</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">format</span> "t<sub>1</sub> '`.' f" ).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.FieldAccessDef.triple_get_field" class="idref" href="#Realization.FieldAccessDef.triple_get_field"><span class="id" title="lemma">triple_get_field</span></a> : <span class="id" title="keyword">∀</span> <a id="p:282" class="idref" href="#p:282"><span class="id" title="binder">p</span></a> <a id="k:283" class="idref" href="#k:283"><span class="id" title="binder">k</span></a> <a id="v:284" class="idref" href="#v:284"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> ((<a class="idref" href="Struct.html#Realization.FieldAccessDef.val_get_field"><span class="id" title="definition">val_get_field</span></a> <a class="idref" href="Struct.html#k:283"><span class="id" title="variable">k</span></a>) <a class="idref" href="Struct.html#p:282"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#p:282"><span class="id" title="variable">p</span></a><a class="idref" href="Struct.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">`.</span></a><a class="idref" href="Struct.html#k:283"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Struct.html#v:284"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:285" class="idref" href="#r:285"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#r:285"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Struct.html#v:284"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#p:282"><span class="id" title="variable">p</span></a><a class="idref" href="Struct.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">`.</span></a><a class="idref" href="Struct.html#k:283"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Struct.html#v:284"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xwp</span>. <span class="id" title="var">xapp</span> <a class="idref" href="Struct.html#Realization.triple_ptr_add_nat"><span class="id" title="lemma">triple_ptr_add_nat</span></a>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Struct.html#hfield"><span class="id" title="definition">hfield</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">math_rewrite</span> (<span class="id" title="var">p</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a><span class="id" title="var">k</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">p</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+(</span></a><span class="id" title="var">k</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">nat</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span> <a class="idref" href="LibSepReference.html#triple_get"><span class="id" title="lemma">triple_get</span></a>. <span class="id" title="var">xsimpl</span>*.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The set operation on a field, written <span class="inlinecode"><span class="id" title="keyword">Set</span></span> <span class="inlinecode"><span class="id" title="var">p'.k</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">v</span></span>,
    is encoded as <span class="inlinecode"><span class="id" title="var">val_set</span></span> <span class="inlinecode">(<span class="id" title="var">p</span>+<span class="id" title="var">k</span>+1)</span> <span class="inlinecode"><span class="id" title="var">v</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="Realization.FieldAccessDef.val_set_field" class="idref" href="#Realization.FieldAccessDef.val_set_field"><span class="id" title="definition">val_set_field</span></a> (<a id="k:286" class="idref" href="#k:286"><span class="id" title="binder">k</span></a>:<a class="idref" href="Struct.html#field"><span class="id" title="definition">field</span></a>) : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#938475157e31b8b3433e07bd510fd74f"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">v</span></a> <a class="idref" href="LibSepReference.html#938475157e31b8b3433e07bd510fd74f"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">q</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="Struct.html#Realization.val_ptr_add"><span class="id" title="axiom">val_ptr_add</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#a15607334da66bc8a82cc392003f629d"><span class="id" title="notation">{</span></a><span class="id" title="definition">nat_to_Z</span> (<a class="idref" href="Struct.html#k:286"><span class="id" title="variable">k</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1)<a class="idref" href="LibSepReference.html#a15607334da66bc8a82cc392003f629d"><span class="id" title="notation">}</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#val_set"><span class="id" title="constructor">val_set</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">q</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''v'"><span class="id" title="notation">v</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.FieldAccessDef.triple_set_field" class="idref" href="#Realization.FieldAccessDef.triple_set_field"><span class="id" title="lemma">triple_set_field</span></a> : <span class="id" title="keyword">∀</span> <a id="v<sub>1</sub>:287" class="idref" href="#v<sub>1</sub>:287"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="p:288" class="idref" href="#p:288"><span class="id" title="binder">p</span></a> <a id="k:289" class="idref" href="#k:289"><span class="id" title="binder">k</span></a> <a id="v<sub>2</sub>:290" class="idref" href="#v<sub>2</sub>:290"><span class="id" title="binder">v<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> ((<a class="idref" href="Struct.html#Realization.FieldAccessDef.val_set_field"><span class="id" title="definition">val_set_field</span></a> <a class="idref" href="Struct.html#k:289"><span class="id" title="variable">k</span></a>) <a class="idref" href="Struct.html#p:288"><span class="id" title="variable">p</span></a> <a class="idref" href="Struct.html#v<sub>2</sub>:290"><span class="id" title="variable">v<sub>2</sub></span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#p:288"><span class="id" title="variable">p</span></a><a class="idref" href="Struct.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">`.</span></a><a class="idref" href="Struct.html#k:289"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Struct.html#v<sub>1</sub>:287"><span class="id" title="variable">v<sub>1</sub></span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Struct.html#p:288"><span class="id" title="variable">p</span></a><a class="idref" href="Struct.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">`.</span></a><a class="idref" href="Struct.html#k:289"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#75d25f73dacdf76a5f84e31928dc7807"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Struct.html#v<sub>2</sub>:290"><span class="id" title="variable">v<sub>2</sub></span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">xwp</span>. <span class="id" title="var">xapp</span> <a class="idref" href="Struct.html#Realization.triple_ptr_add_nat"><span class="id" title="lemma">triple_ptr_add_nat</span></a>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Struct.html#hfield"><span class="id" title="definition">hfield</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">math_rewrite</span> (<span class="id" title="var">p</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a><span class="id" title="var">k</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">p</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+(</span></a><span class="id" title="var">k</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">nat</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span> <a class="idref" href="LibSepReference.html#triple_set"><span class="id" title="lemma">triple_set</span></a>. <span class="id" title="var">xsimpl</span>*.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <a id="2784c584fbef1ebf50e3bdbb29346822" class="idref" href="#2784c584fbef1ebf50e3bdbb29346822"><span class="id" title="notation">&quot;</span></a>t<sub>1</sub> '`.' f ':=' t<sub>2</sub>" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="Struct.html#Realization.FieldAccessDef.val_set_field"><span class="id" title="definition">val_set_field</span></a> <span class="id" title="var">f</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>)<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">trm</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 56, <span class="id" title="var">f</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">format</span> "t<sub>1</sub> '`.' f  ':='  t<sub>2</sub>").<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="Struct.html#Realization.FieldAccessDef"><span class="id" title="module">FieldAccessDef</span></a>.<br/>
</div>

<div class="doc">
<a id="lab415"></a><h2 class="section">Specification of Record Operations w.r.t. <span class="inlinecode"><span class="id" title="var">hfields</span></span> and <span class="inlinecode"><span class="id" title="var">hrecord</span></span></h2>

<div class="paragraph"> </div>

 The specifications <span class="inlinecode"><span class="id" title="var">triple_get_field</span></span> and <span class="inlinecode"><span class="id" title="var">triple_set_field</span></span>
    established above correspond to small-footprint specifications,
    with preconditions mentioning a single field. Corollaries to these
    specifications can be established with preconditions mentioning a
    list of fields (predicate <span class="inlinecode"><span class="id" title="var">hfields</span></span>), or a full record (predicate
    <span class="inlinecode"><span class="id" title="var">hrecord</span></span>). 
<div class="paragraph"> </div>

 Get operation on a list of fields 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_get_field_hfields" class="idref" href="#Realization.triple_get_field_hfields"><span class="id" title="lemma">triple_get_field_hfields</span></a> : <span class="id" title="keyword">∀</span> <a id="kvs:291" class="idref" href="#kvs:291"><span class="id" title="binder">kvs</span></a> <a id="p:292" class="idref" href="#p:292"><span class="id" title="binder">p</span></a> <a id="k:293" class="idref" href="#k:293"><span class="id" title="binder">k</span></a> <a id="v:294" class="idref" href="#v:294"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#hfields_lookup"><span class="id" title="definition">hfields_lookup</span></a> <a class="idref" href="Struct.html#k:293"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#kvs:291"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Struct.html#v:294"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#Realization.val_get_field"><span class="id" title="definition">val_get_field</span></a> <a class="idref" href="Struct.html#k:293"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#p:292"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#hfields"><span class="id" title="definition">hfields</span></a> <a class="idref" href="Struct.html#kvs:291"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Struct.html#p:292"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:295" class="idref" href="#r:295"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#r:295"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Struct.html#v:294"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Struct.html#hfields"><span class="id" title="definition">hfields</span></a> <a class="idref" href="Struct.html#kvs:291"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Struct.html#p:292"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">L</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">L</span> <span class="id" title="keyword">as</span> [| [<span class="id" title="var">ki</span> <span class="id" title="var">vi</span>] <span class="id" title="var">L'</span>]; <span class="id" title="tactic">simpl</span>; <span class="id" title="var">introv</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">inverts</span> <span class="id" title="var">E</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">case_if</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">inverts</span> <span class="id" title="var">E</span>. <span class="id" title="tactic">subst</span> <span class="id" title="var">ki</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_conseq_frame"><span class="id" title="lemma">triple_conseq_frame</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Struct.html#Realization.triple_get_field"><span class="id" title="lemma">triple_get_field</span></a>. } { <span class="id" title="var">xsimpl</span>. } { <span class="id" title="var">xsimpl</span>*. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_conseq_frame"><span class="id" title="lemma">triple_conseq_frame</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <span class="id" title="var">IHL'</span> <span class="id" title="var">E</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span>*. } } }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Get operation on a record 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_get_field_hrecord" class="idref" href="#Realization.triple_get_field_hrecord"><span class="id" title="lemma">triple_get_field_hrecord</span></a> : <span class="id" title="keyword">∀</span> <a id="kvs:296" class="idref" href="#kvs:296"><span class="id" title="binder">kvs</span></a> <a id="p:297" class="idref" href="#p:297"><span class="id" title="binder">p</span></a> <a id="k:298" class="idref" href="#k:298"><span class="id" title="binder">k</span></a> <a id="v:299" class="idref" href="#v:299"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#hfields_lookup"><span class="id" title="definition">hfields_lookup</span></a> <a class="idref" href="Struct.html#k:298"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#kvs:296"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Struct.html#v:299"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#Realization.val_get_field"><span class="id" title="definition">val_get_field</span></a> <a class="idref" href="Struct.html#k:298"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#p:297"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#p:297"><span class="id" title="variable">p</span></a> <a class="idref" href="Struct.html#4fdf8be3226dc6822dfa0caeb9414d<sub>46</sub>"><span class="id" title="notation">~~~&gt;</span></a> <a class="idref" href="Struct.html#kvs:296"><span class="id" title="variable">kvs</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:300" class="idref" href="#r:300"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Struct.html#r:300"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Struct.html#v:299"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Struct.html#p:297"><span class="id" title="variable">p</span></a> <a class="idref" href="Struct.html#4fdf8be3226dc6822dfa0caeb9414d<sub>46</sub>"><span class="id" title="notation">~~~&gt;</span></a> <a class="idref" href="Struct.html#kvs:296"><span class="id" title="variable">kvs</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Struct.html#hrecord"><span class="id" title="definition">hrecord</span></a>. <span class="id" title="var">xtriple</span>. <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">z</span> <span class="id" title="var">Hz</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span> (<span class="id" title="notation">&gt;&gt;</span> <a class="idref" href="Struct.html#Realization.triple_get_field_hfields"><span class="id" title="lemma">triple_get_field_hfields</span></a> <span class="id" title="var">M</span>). <span class="id" title="var">xsimpl</span>*.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Set operation on a list of fields 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_set_field_hfields" class="idref" href="#Realization.triple_set_field_hfields"><span class="id" title="lemma">triple_set_field_hfields</span></a> : <span class="id" title="keyword">∀</span> <a id="kvs:301" class="idref" href="#kvs:301"><span class="id" title="binder">kvs</span></a> <a id="kvs':302" class="idref" href="#kvs':302"><span class="id" title="binder">kvs'</span></a> <a id="k:303" class="idref" href="#k:303"><span class="id" title="binder">k</span></a> <a id="p:304" class="idref" href="#p:304"><span class="id" title="binder">p</span></a> <a id="v:305" class="idref" href="#v:305"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#hfields_update"><span class="id" title="definition">hfields_update</span></a> <a class="idref" href="Struct.html#k:303"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#v:305"><span class="id" title="variable">v</span></a> <a class="idref" href="Struct.html#kvs:301"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Struct.html#kvs':302"><span class="id" title="variable">kvs'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#Realization.val_set_field"><span class="id" title="definition">val_set_field</span></a> <a class="idref" href="Struct.html#k:303"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#p:304"><span class="id" title="variable">p</span></a> <a class="idref" href="Struct.html#v:305"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#hfields"><span class="id" title="definition">hfields</span></a> <a class="idref" href="Struct.html#kvs:301"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Struct.html#p:304"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Struct.html#hfields"><span class="id" title="definition">hfields</span></a> <a class="idref" href="Struct.html#kvs':302"><span class="id" title="variable">kvs'</span></a> <a class="idref" href="Struct.html#p:304"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">kvs</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">kvs</span> <span class="id" title="keyword">as</span> [| [<span class="id" title="var">ki</span> <span class="id" title="var">vi</span>] <span class="id" title="var">kvs'</span>]; <span class="id" title="tactic">simpl</span>; <span class="id" title="var">introv</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">inverts</span> <span class="id" title="var">E</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">case_if</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">inverts</span> <span class="id" title="var">E</span>. <span class="id" title="tactic">subst</span> <span class="id" title="var">ki</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_conseq_frame"><span class="id" title="lemma">triple_conseq_frame</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Struct.html#Realization.triple_set_field"><span class="id" title="lemma">triple_set_field</span></a>. } { <span class="id" title="var">xsimpl</span>. } { <span class="id" title="var">xsimpl</span>*. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">cases</span> (<a class="idref" href="Struct.html#hfields_update"><span class="id" title="definition">hfields_update</span></a> <span class="id" title="var">k</span> <span class="id" title="var">v</span> <span class="id" title="var">kvs'</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">C<sub>2</sub></span>; <span class="id" title="var">tryfalse</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_conseq_frame"><span class="id" title="lemma">triple_conseq_frame</span></a>. { <span class="id" title="var">applys</span> <span class="id" title="var">IHkvs'</span> <span class="id" title="var">C<sub>2</sub></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span>. } { <span class="id" title="tactic">simpl</span>. <span class="id" title="var">xsimpl</span>*. } } }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Auxiliary lemma about <span class="inlinecode"><span class="id" title="var">hfields_update</span></span>, showing that the update
    operation preserves the names of the fields. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.hfields_update_preserves_fields" class="idref" href="#Realization.hfields_update_preserves_fields"><span class="id" title="lemma">hfields_update_preserves_fields</span></a> : <span class="id" title="keyword">∀</span> <a id="kvs:306" class="idref" href="#kvs:306"><span class="id" title="binder">kvs</span></a> <a id="kvs':307" class="idref" href="#kvs':307"><span class="id" title="binder">kvs'</span></a> <a id="k:308" class="idref" href="#k:308"><span class="id" title="binder">k</span></a> <a id="v:309" class="idref" href="#v:309"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#hfields_update"><span class="id" title="definition">hfields_update</span></a> <a class="idref" href="Struct.html#k:308"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#v:309"><span class="id" title="variable">v</span></a> <a class="idref" href="Struct.html#kvs:306"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Struct.html#kvs':307"><span class="id" title="variable">kvs'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">LibList.map</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <a class="idref" href="Struct.html#kvs':307"><span class="id" title="variable">kvs'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">LibList.map</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <a class="idref" href="Struct.html#kvs:306"><span class="id" title="variable">kvs</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">kvs</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">kvs</span> <span class="id" title="keyword">as</span> [|[<span class="id" title="var">ki</span> <span class="id" title="var">vi</span>] <span class="id" title="var">kvs1</span>]; <span class="id" title="tactic">simpl</span>; <span class="id" title="var">introv</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">_</span> <span class="id" title="var">H</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">H</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">case_if</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">inverts</span> <span class="id" title="var">E</span>. <span class="id" title="var">rew_listx</span>*. <span class="id" title="tactic">subst</span>. <span class="id" title="var">fequals</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">cases</span> (<a class="idref" href="Struct.html#hfields_update"><span class="id" title="definition">hfields_update</span></a> <span class="id" title="var">k</span> <span class="id" title="var">v</span> <span class="id" title="var">kvs1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">inverts</span> <span class="id" title="var">E</span>. <span class="id" title="var">rew_listx</span>. <span class="id" title="var">fequals</span>*. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">inverts</span> <span class="id" title="var">E</span>. } } }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="Realization.hfields_update_preserves_maps_all_fields" class="idref" href="#Realization.hfields_update_preserves_maps_all_fields"><span class="id" title="lemma">hfields_update_preserves_maps_all_fields</span></a> : <span class="id" title="keyword">∀</span> <a id="kvs:310" class="idref" href="#kvs:310"><span class="id" title="binder">kvs</span></a> <a id="kvs':311" class="idref" href="#kvs':311"><span class="id" title="binder">kvs'</span></a> <a id="z:312" class="idref" href="#z:312"><span class="id" title="binder">z</span></a> <a id="k:313" class="idref" href="#k:313"><span class="id" title="binder">k</span></a> <a id="v:314" class="idref" href="#v:314"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#hfields_update"><span class="id" title="definition">hfields_update</span></a> <a class="idref" href="Struct.html#k:313"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#v:314"><span class="id" title="variable">v</span></a> <a class="idref" href="Struct.html#kvs:310"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Struct.html#kvs':311"><span class="id" title="variable">kvs'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#maps_all_fields"><span class="id" title="definition">maps_all_fields</span></a> <a class="idref" href="Struct.html#z:312"><span class="id" title="variable">z</span></a> <a class="idref" href="Struct.html#kvs:310"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Struct.html#maps_all_fields"><span class="id" title="definition">maps_all_fields</span></a> <a class="idref" href="Struct.html#z:312"><span class="id" title="variable">z</span></a> <a class="idref" href="Struct.html#kvs':311"><span class="id" title="variable">kvs'</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Struct.html#maps_all_fields"><span class="id" title="definition">maps_all_fields</span></a>. <span class="id" title="var">extens</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">rewrites</span>* (<span class="id" title="notation">&gt;&gt;</span> <a class="idref" href="Struct.html#Realization.hfields_update_preserves_fields"><span class="id" title="lemma">hfields_update_preserves_fields</span></a> <span class="id" title="var">M</span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Set operation on a record 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_set_field_hrecord" class="idref" href="#Realization.triple_set_field_hrecord"><span class="id" title="lemma">triple_set_field_hrecord</span></a> : <span class="id" title="keyword">∀</span> <a id="kvs:315" class="idref" href="#kvs:315"><span class="id" title="binder">kvs</span></a> <a id="kvs':316" class="idref" href="#kvs':316"><span class="id" title="binder">kvs'</span></a> <a id="k:317" class="idref" href="#k:317"><span class="id" title="binder">k</span></a> <a id="p:318" class="idref" href="#p:318"><span class="id" title="binder">p</span></a> <a id="v:319" class="idref" href="#v:319"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#hfields_update"><span class="id" title="definition">hfields_update</span></a> <a class="idref" href="Struct.html#k:317"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#v:319"><span class="id" title="variable">v</span></a> <a class="idref" href="Struct.html#kvs:315"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Struct.html#kvs':316"><span class="id" title="variable">kvs'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#Realization.val_set_field"><span class="id" title="definition">val_set_field</span></a> <a class="idref" href="Struct.html#k:317"><span class="id" title="variable">k</span></a> <a class="idref" href="Struct.html#p:318"><span class="id" title="variable">p</span></a> <a class="idref" href="Struct.html#v:319"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#p:318"><span class="id" title="variable">p</span></a> <a class="idref" href="Struct.html#4fdf8be3226dc6822dfa0caeb9414d<sub>46</sub>"><span class="id" title="notation">~~~&gt;</span></a> <a class="idref" href="Struct.html#kvs:315"><span class="id" title="variable">kvs</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Struct.html#p:318"><span class="id" title="variable">p</span></a> <a class="idref" href="Struct.html#4fdf8be3226dc6822dfa0caeb9414d<sub>46</sub>"><span class="id" title="notation">~~~&gt;</span></a> <a class="idref" href="Struct.html#kvs':316"><span class="id" title="variable">kvs'</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Struct.html#hrecord"><span class="id" title="definition">hrecord</span></a>. <span class="id" title="var">xtriple</span>. <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">z</span> <span class="id" title="var">Hz</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span> (<span class="id" title="notation">&gt;&gt;</span> <a class="idref" href="Struct.html#Realization.triple_set_field_hfields"><span class="id" title="lemma">triple_set_field_hfields</span></a> <span class="id" title="var">M</span>). <span class="id" title="var">xsimpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">rewrites</span>* &lt;- (<span class="id" title="notation">&gt;&gt;</span> <a class="idref" href="Struct.html#Realization.hfields_update_preserves_maps_all_fields"><span class="id" title="lemma">hfields_update_preserves_maps_all_fields</span></a> <span class="id" title="var">z</span> <span class="id" title="var">M</span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab416"></a><h2 class="section">Specification of Record Allocation and Deallocation</h2>

<div class="paragraph"> </div>

 Recall that record allocation, written <span class="inlinecode"><span class="id" title="var">val_alloc_hrecord</span></span> <span class="inlinecode"><span class="id" title="var">ks</span></span>,
    is encoded as <span class="inlinecode"><span class="id" title="var">val_alloc</span></span> <span class="inlinecode">(<span class="id" title="var">length</span></span> <span class="inlinecode"><span class="id" title="var">ks</span>)</span>, and that record deallocation,
    written <span class="inlinecode"><span class="id" title="var">val_dealloc_hrecord</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>, is encoded as <span class="inlinecode"><span class="id" title="var">val_dealloc</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>.

<div class="paragraph"> </div>

    The operations <span class="inlinecode"><span class="id" title="var">val_alloc</span></span> and <span class="inlinecode"><span class="id" title="var">val_dealloc</span></span> have already been
    specified, via lemmas <span class="inlinecode"><span class="id" title="var">triple_alloc</span></span> and <span class="inlinecode"><span class="id" title="var">triple_dealloc</span></span>.

<div class="paragraph"> </div>

    In this section, we show that the specifications for <span class="inlinecode"><span class="id" title="var">val_alloc_hrecord</span></span>
    and <span class="inlinecode"><span class="id" title="var">val_dealloc_hrecord</span></span> can be derived from those.

<div class="paragraph"> </div>

    The proofs are not completely trivial because we need to convert
    between the view of a list of consecutive cells, as captured by
    the predicate <span class="inlinecode"><span class="id" title="var">hcells</span></span>, and the view of a list of fields, as captured
    by the predicate <span class="inlinecode"><span class="id" title="var">hfields</span></span>.

<div class="paragraph"> </div>

    To that end, the lemma <span class="inlinecode"><span class="id" title="var">hfields_eq_hcells</span></span> asserts the equality
    between <span class="inlinecode"><span class="id" title="var">hfields</span></span> <span class="inlinecode"><span class="id" title="var">kvs</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> and <span class="inlinecode"><span class="id" title="var">hcells</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode">(<span class="id" title="var">p</span>+1)</span> under a suitable relation
    between the list of values <span class="inlinecode"><span class="id" title="var">L</span></span> and the description of the fields <span class="inlinecode"><span class="id" title="var">kvs</span></span>:
    the values from the association list <span class="inlinecode"><span class="id" title="var">kvs</span></span> must correspond to the list <span class="inlinecode"><span class="id" title="var">L</span></span>,
    and the keys from the association list <span class="inlinecode"><span class="id" title="var">kvs</span></span> must correspond to the
    <span class="inlinecode"><span class="id" title="var">length</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> first natural numbers.

<div class="paragraph"> </div>

    The proof is carried out by induction, on the following statement. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.hfields_eq_hcells_ind" class="idref" href="#Realization.hfields_eq_hcells_ind"><span class="id" title="lemma">hfields_eq_hcells_ind</span></a> : <span class="id" title="keyword">∀</span> <a id="L:320" class="idref" href="#L:320"><span class="id" title="binder">L</span></a> <a id="p:321" class="idref" href="#p:321"><span class="id" title="binder">p</span></a> <a id="kvs:322" class="idref" href="#kvs:322"><span class="id" title="binder">kvs</span></a> <a id="o:323" class="idref" href="#o:323"><span class="id" title="binder">o</span></a>,<br/>
&nbsp;&nbsp;<span class="id" title="definition">LibList.map</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <a class="idref" href="Struct.html#kvs:322"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">nat_seq</span> <a class="idref" href="Struct.html#o:323"><span class="id" title="variable">o</span></a> (<span class="id" title="definition">length</span> <a class="idref" href="Struct.html#L:320"><span class="id" title="variable">L</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#L:320"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">LibList.map</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> <a class="idref" href="Struct.html#kvs:322"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#hfields"><span class="id" title="definition">hfields</span></a> <a class="idref" href="Struct.html#kvs:322"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Struct.html#p:321"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Struct.html#hcells"><span class="id" title="definition">hcells</span></a> <a class="idref" href="Struct.html#L:320"><span class="id" title="variable">L</span></a> (<a class="idref" href="Struct.html#p:321"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a><a class="idref" href="Struct.html#o:323"><span class="id" title="variable">o</span></a>)%<span class="id" title="var">nat</span>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">L</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">L</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">v</span> <span class="id" title="var">L'</span>]; <span class="id" title="var">introv</span> <span class="id" title="var">M</span> <span class="id" title="var">E</span>; <span class="id" title="var">rew_listx</span> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">kvs</span> <span class="id" title="keyword">as</span> [|[<span class="id" title="var">k</span> <span class="id" title="var">v'</span>] <span class="id" title="var">kvs'</span>]; <span class="id" title="var">tryfalse</span>; <span class="id" title="var">rew_listx</span> <span class="id" title="keyword">in</span> *.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">simpls</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">M</span> <span class="id" title="keyword">as</span> <span class="id" title="var">M'</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">E</span> <span class="id" title="keyword">as</span> <span class="id" title="var">E'</span>. <span class="id" title="var">rew_listx</span> <span class="id" title="keyword">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Struct.html#hfield"><span class="id" title="definition">hfield</span></a>. <span class="id" title="var">fequals</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">math_rewrite</span> (<span class="id" title="var">p</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a><span class="id" title="var">o</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><span class="id" title="var">p</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+(</span></a><span class="id" title="var">o</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">nat</span>. <span class="id" title="var">applys</span>* <span class="id" title="var">IHL'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">math_rewrite</span>* (<span class="id" title="var">o</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">o</span>)%<span class="id" title="var">nat</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The statement of the lemma <span class="inlinecode"><span class="id" title="var">hfields_eq_hcells</span></span> involves the predicate
    <span class="inlinecode"><span class="id" title="var">maps_all_fields</span></span>, which appears in the definition of <span class="inlinecode"><span class="id" title="var">hrecord</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.hfields_eq_hcells" class="idref" href="#Realization.hfields_eq_hcells"><span class="id" title="lemma">hfields_eq_hcells</span></a> : <span class="id" title="keyword">∀</span> <a id="z:324" class="idref" href="#z:324"><span class="id" title="binder">z</span></a> <a id="L:325" class="idref" href="#L:325"><span class="id" title="binder">L</span></a> <a id="p:326" class="idref" href="#p:326"><span class="id" title="binder">p</span></a> <a id="kvs:327" class="idref" href="#kvs:327"><span class="id" title="binder">kvs</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#maps_all_fields"><span class="id" title="definition">maps_all_fields</span></a> <a class="idref" href="Struct.html#z:324"><span class="id" title="variable">z</span></a> <a class="idref" href="Struct.html#kvs:327"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#z:324"><span class="id" title="variable">z</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Struct.html#L:325"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#L:325"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">LibList.map</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> <a class="idref" href="Struct.html#kvs:327"><span class="id" title="variable">kvs</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#hfields"><span class="id" title="definition">hfields</span></a> <a class="idref" href="Struct.html#kvs:327"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Struct.html#p:326"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Struct.html#hcells"><span class="id" title="definition">hcells</span></a> <a class="idref" href="Struct.html#L:325"><span class="id" title="variable">L</span></a> (<a class="idref" href="Struct.html#p:326"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1)%<span class="id" title="var">nat</span>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span> <span class="id" title="var">HL</span> <span class="id" title="var">E</span>. <span class="id" title="tactic">subst</span> <span class="id" title="var">z</span>. <span class="id" title="var">rewrites</span> (<span class="id" title="notation">&gt;&gt;</span> <a class="idref" href="Struct.html#Realization.hfields_eq_hcells_ind"><span class="id" title="lemma">hfields_eq_hcells_ind</span></a> <span class="id" title="var">M</span> <span class="id" title="var">E</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">fequals</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>. <span class="id" title="var">math</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The following lemma converts from the <span class="inlinecode"><span class="id" title="var">harray</span></span> view to the <span class="inlinecode"><span class="id" title="var">hrecord</span></span>
    view, for an array of uninitialized values. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.harray_uninit_himpl_hrecord" class="idref" href="#Realization.harray_uninit_himpl_hrecord"><span class="id" title="lemma">harray_uninit_himpl_hrecord</span></a> : <span class="id" title="keyword">∀</span> <a id="p:328" class="idref" href="#p:328"><span class="id" title="binder">p</span></a> <a id="z:329" class="idref" href="#z:329"><span class="id" title="binder">z</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> (<span class="id" title="definition">LibList.make</span> <a class="idref" href="Struct.html#z:329"><span class="id" title="variable">z</span></a> <a class="idref" href="LibSepReference.html#val_uninit"><span class="id" title="constructor">val_uninit</span></a>) <a class="idref" href="Struct.html#p:328"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#hrecord"><span class="id" title="definition">hrecord</span></a> (<span class="id" title="definition">LibList.map</span> (<span class="id" title="keyword">fun</span> <a id="k:330" class="idref" href="#k:330"><span class="id" title="binder">k</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#k:330"><span class="id" title="variable">k</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="LibSepReference.html#val_uninit"><span class="id" title="constructor">val_uninit</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>) (<span class="id" title="definition">nat_seq</span> 0 <a class="idref" href="Struct.html#z:329"><span class="id" title="variable">z</span></a>)) <a class="idref" href="Struct.html#p:328"><span class="id" title="variable">p</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">unfolds</span> <a class="idref" href="Struct.html#hrecord"><span class="id" title="definition">hrecord</span></a>, <a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a>. <span class="id" title="var">rew_listx</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">sets</span> <span class="id" title="var">kvs</span>: ((<span class="id" title="definition">LibList.map</span> (<span class="id" title="keyword">fun</span> <a id="k:332" class="idref" href="#k:332"><span class="id" title="binder">k</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#k:331"><span class="id" title="variable">k</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="LibSepReference.html#val_uninit"><span class="id" title="constructor">val_uninit</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>) (<span class="id" title="definition">nat_seq</span> 0 <span class="id" title="var">z</span>))).<br/>
&nbsp;&nbsp;<span class="id" title="var">asserts</span> (<span class="id" title="var">M<sub>1</sub></span>&amp;<span class="id" title="var">M<sub>2</sub></span>): (<span class="id" title="definition">LibList.map</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <span class="id" title="var">kvs</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">nat_seq</span> 0 <span class="id" title="var">z</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <span class="id" title="definition">LibList.map</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> <span class="id" title="var">kvs</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">LibList.make</span> <span class="id" title="var">z</span> <a class="idref" href="LibSepReference.html#val_uninit"><span class="id" title="constructor">val_uninit</span></a>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">subst</span> <span class="id" title="var">kvs</span>. <span class="id" title="tactic">generalize</span> 0%<span class="id" title="var">nat</span> <span class="id" title="keyword">as</span> <span class="id" title="var">o</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">z</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">z'</span>]; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="var">rew_listx</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">forwards</span>* (<span class="id" title="var">N<sub>1</sub></span>&amp;<span class="id" title="var">N<sub>2</sub></span>): <span class="id" title="var">IHz'</span> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">o</span>). <span class="id" title="tactic">split</span>; <span class="id" title="var">fequals</span>*. } }<br/>
&nbsp;&nbsp;<span class="id" title="var">xsimpl</span> <span class="id" title="var">z</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <span class="id" title="var">M<sub>1</sub></span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">rewrites</span>* &lt;- (<span class="id" title="notation">&gt;&gt;</span> <a class="idref" href="Struct.html#Realization.hfields_eq_hcells"><span class="id" title="lemma">hfields_eq_hcells</span></a> <span class="id" title="var">M<sub>1</sub></span>). <span class="id" title="var">rew_listx</span>*. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Exploiting the above lemma, we derive the specification of record
    allocation. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_alloc_hrecord" class="idref" href="#Realization.triple_alloc_hrecord"><span class="id" title="lemma">triple_alloc_hrecord</span></a> : <span class="id" title="keyword">∀</span> <a id="ks:333" class="idref" href="#ks:333"><span class="id" title="binder">ks</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#ks:333"><span class="id" title="variable">ks</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">nat_seq</span> 0 (<span class="id" title="definition">LibListExec.length</span> <a class="idref" href="Struct.html#ks:333"><span class="id" title="variable">ks</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#val_alloc_hrecord"><span class="id" title="definition">val_alloc_hrecord</span></a> <a class="idref" href="Struct.html#ks:333"><span class="id" title="variable">ks</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:334" class="idref" href="#p:334"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Struct.html#hrecord"><span class="id" title="definition">hrecord</span></a> (<span class="id" title="definition">LibListExec.map</span> (<span class="id" title="keyword">fun</span> <a id="k:335" class="idref" href="#k:335"><span class="id" title="binder">k</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Struct.html#k:335"><span class="id" title="variable">k</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="LibSepReference.html#val_uninit"><span class="id" title="constructor">val_uninit</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>) <a class="idref" href="Struct.html#ks:333"><span class="id" title="variable">ks</span></a>) <a class="idref" href="Struct.html#p:334"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">E</span>. <span class="id" title="var">xapp</span> <a class="idref" href="Struct.html#Realization.triple_alloc_nat"><span class="id" title="lemma">triple_alloc_nat</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xsimpl</span> <span class="id" title="var">p</span>. { <span class="id" title="tactic">auto</span>. } <span class="id" title="tactic">rewrite</span> <span class="id" title="var">E</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">length_nat_seq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">LibListExec.map_eq</span>. <span class="id" title="var">xchange</span> <a class="idref" href="Struct.html#Realization.harray_uninit_himpl_hrecord"><span class="id" title="lemma">harray_uninit_himpl_hrecord</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The following lemma converts in the other direction, from the <span class="inlinecode"><span class="id" title="var">hrecord</span></span>
    view to the <span class="inlinecode"><span class="id" title="var">harray</span></span> view.
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.hrecord_himpl_harray" class="idref" href="#Realization.hrecord_himpl_harray"><span class="id" title="lemma">hrecord_himpl_harray</span></a> : <span class="id" title="keyword">∀</span> <a id="p:336" class="idref" href="#p:336"><span class="id" title="binder">p</span></a> <a id="kvs:337" class="idref" href="#kvs:337"><span class="id" title="binder">kvs</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Struct.html#hrecord"><span class="id" title="definition">hrecord</span></a> <a class="idref" href="Struct.html#kvs:337"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Struct.html#p:336"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a> (<span class="id" title="definition">LibList.map</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> <a class="idref" href="Struct.html#kvs:337"><span class="id" title="variable">kvs</span></a>) <a class="idref" href="Struct.html#p:336"><span class="id" title="variable">p</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">unfolds</span> <a class="idref" href="Struct.html#hrecord"><span class="id" title="definition">hrecord</span></a>, <a class="idref" href="Struct.html#harray"><span class="id" title="definition">harray</span></a>. <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">z</span> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">asserts</span> <span class="id" title="var">Hz</span>: (<span class="id" title="var">z</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <span class="id" title="var">kvs</span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="var">lets</span> <span class="id" title="var">E</span>: <span class="id" title="lemma">length_nat_seq</span> 0%<span class="id" title="var">nat</span> <span class="id" title="var">z</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">M</span> <span class="id" title="keyword">in</span> <span class="id" title="var">E</span>. <span class="id" title="var">rew_listx</span>* <span class="id" title="keyword">in</span> *. }<br/>
&nbsp;&nbsp;<span class="id" title="var">xchange</span>* (<span class="id" title="notation">&gt;&gt;</span> <a class="idref" href="Struct.html#Realization.hfields_eq_hcells"><span class="id" title="lemma">hfields_eq_hcells</span></a> <span class="id" title="var">p</span> <span class="id" title="var">M</span>). { <span class="id" title="var">rew_listx</span>*. }<br/>
&nbsp;&nbsp;<span class="id" title="var">xsimpl</span>. <span class="id" title="var">rew_listx</span>. <span class="id" title="tactic">rewrite</span>* <span class="id" title="var">Hz</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Exploiting the above lemma, we derive the specification of record
    deallocation. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Realization.triple_dealloc_hrecord" class="idref" href="#Realization.triple_dealloc_hrecord"><span class="id" title="lemma">triple_dealloc_hrecord</span></a> : <span class="id" title="keyword">∀</span> <a id="kvs:338" class="idref" href="#kvs:338"><span class="id" title="binder">kvs</span></a> <a id="p:339" class="idref" href="#p:339"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Struct.html#val_dealloc"><span class="id" title="axiom">val_dealloc</span></a> <a class="idref" href="Struct.html#p:339"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Struct.html#hrecord"><span class="id" title="definition">hrecord</span></a> <a class="idref" href="Struct.html#kvs:338"><span class="id" title="variable">kvs</span></a> <a class="idref" href="Struct.html#p:339"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">xtriple</span>. <span class="id" title="var">xchange</span> <a class="idref" href="Struct.html#Realization.hrecord_himpl_harray"><span class="id" title="lemma">hrecord_himpl_harray</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span> <a class="idref" href="Struct.html#Realization.triple_dealloc"><span class="id" title="lemma">triple_dealloc</span></a>. <span class="id" title="var">xsimpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="Struct.html#Realization"><span class="id" title="module">Realization</span></a>.<br/><hr class='doublespaceincode'/>
<span class="comment">(*&nbsp;2021-06-29&nbsp;22:03&nbsp;*)</span><br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>