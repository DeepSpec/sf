<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>Wand: The Magic Wand Operator</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/slf.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 6: Separation Logic Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">Wand<span class="subtitle">The Magic Wand Operator</span></h1>


<div class="code">

<span class="id" title="keyword">Set Implicit Arguments</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">SLF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="LibSepReference.html#"><span class="id" title="library">LibSepReference</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">SLF</span> <span class="id" title="keyword">Require</span> <a class="idref" href="Repr.html#"><span class="id" title="library">Repr</span></a>.<br/>
<span class="id" title="keyword">Close</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">trm_scope</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">h</span> : <a class="idref" href="LibSepReference.html#heap"><span class="id" title="definition">heap</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">P</span> : <span class="id" title="keyword">Prop</span>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">H</span> : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">Q</span> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>.<br/>
</div>

<div class="doc">
<a id="lab306"></a><h1 class="section">First Pass</h1>

<div class="paragraph"> </div>

 This chapter introduces an additional Separation Logic operator,
    called the "magic wand", and written <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>.

<div class="paragraph"> </div>

    This operator has multiple use:
<ul class="doclist">
<li> it helps reformulate the consequence-frame rule in an improved manner,
      through a rule called the "ramified frame rule",

</li>
<li> it helps stating the weakest-preconditions of a number of
      languages constructs in a concise manner,

</li>
<li> it can be useful to state specification for certain data structures.

</li>
</ul>

<div class="paragraph"> </div>

    This chapter is organized as follows:
<ul class="doclist">
<li> definition and properties of the magic wand operator,

</li>
<li> generalization of the magic wand to postconditions,

</li>
<li> statement and benefits of the ramified frame rule,

</li>
<li> statement of the ramified frame rule in weakest-precondition style,

</li>
<li> generalized definition of <span class="inlinecode"><span class="id" title="var">wpgen</span></span> that recurses in local functions.

</li>
</ul>

<div class="paragraph"> </div>

    The addition and bonus section includes further discussion, including:
<ul class="doclist">
<li> presentation of alternative, equivalent definitions of the magic wand,

</li>
<li> statement and proofs of additional properties of the magic wand,

</li>
<li> a revised definition of <span class="inlinecode"><span class="id" title="var">mkstruct</span></span> using the magic wand.

</li>
<li> "Texan triples", which express function specifications using the
      magic wand instead of using triples,

</li>
<li> two other operators, disjunction and non-separating conjunction,
      so as to complete the presentation of all Separation Logic operators. 

</li>
</ul>
</div>

<div class="doc">
<a id="lab307"></a><h2 class="section">Intuition for the Magic Wand</h2>

<div class="paragraph"> </div>

 The magic wand operation <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>, to be read "H<sub>1</sub> wand H<sub>2</sub>",
    defines a heap predicate such that, if we extend it with <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span>,
    we obtain <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>. Formally, the following entailment holds:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H<sub>1</sub></span> <span class='gray-font'>\</span>* (<span class="id" title="var">H<sub>1</sub></span> <span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span> <span class="id" title="var">H<sub>2</sub></span>) ==&gt; <span class="id" title="var">H<sub>2</sub></span>.
</span>    Intuitively, if one can think of the star <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> as the addition
    <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>, then one can think of <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> as the subtraction
    <span class="inlinecode">-<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>. The entailment stated above essentially captures the idea
    that <span class="inlinecode">(-<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span>)</span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> simplifies to <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>.

<div class="paragraph"> </div>

    Note, however, that the operation <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> only makes sense if <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span>
    describes a piece of heap that "can" be subtracted from <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>. Otherwise,
    the predicate <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> characterizes a heap that cannot possibly exist.
    Informally speaking, <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> must somehow be a subset of <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> for the
    subtraction <span class="inlinecode">-<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> to make sense.

<div class="paragraph"> </div>

    Another possible analogy is that of logical operators. If <span class="inlinecode"><span class="id" title="var">P<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">P<sub>2</sub></span></span>
    were propositions (of type <span class="inlinecode"><span class="id" title="keyword">Prop</span></span>), then <span class="inlinecode"><span class="id" title="var">P<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">P<sub>2</sub></span></span> would mean <span class="inlinecode"><span class="id" title="var">P<sub>1</sub></span></span> <span class="inlinecode">∧</span> <span class="inlinecode"><span class="id" title="var">P<sub>2</sub></span></span>
    and <span class="inlinecode"><span class="id" title="var">P<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">P<sub>2</sub></span></span> would mean <span class="inlinecode"><span class="id" title="var">P<sub>1</sub></span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">P<sub>2</sub></span></span>. The entailment
    <span class="inlinecode"><span class="id" title="var">P<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode">(<span class="id" title="var">P<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">P<sub>2</sub></span>)</span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">P<sub>2</sub></span></span> then corresponds to the tautology
    <span class="inlinecode">(<span class="id" title="var">P<sub>1</sub></span></span> <span class="inlinecode">∧</span> <span class="inlinecode">(<span class="id" title="var">P<sub>1</sub></span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">P<sub>2</sub></span>))</span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">P<sub>2</sub></span></span>. 
</div>

<div class="doc">
<a id="lab308"></a><h2 class="section">Definition of the Magic Wand</h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="WandDef" class="idref" href="#WandDef"><span class="id" title="module">WandDef</span></a>.<br/>
</div>

<div class="doc">
Technically, <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> holds of a heap <span class="inlinecode"><span class="id" title="var">h</span></span> if, for any heap
    <span class="inlinecode"><span class="id" title="var">h'</span></span> disjoint from <span class="inlinecode"><span class="id" title="var">h</span></span> and that satisfies <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span>, the union
    of <span class="inlinecode"><span class="id" title="var">h</span></span> and <span class="inlinecode"><span class="id" title="var">h'</span></span> satisfies <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>.

<div class="paragraph"> </div>

    The operator <span class="inlinecode"><span class="id" title="var">hwand</span></span>, which implements the notation <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>,
    may thus be defined as follows. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="WandDef.hwand'" class="idref" href="#WandDef.hwand'"><span class="id" title="definition">hwand'</span></a> (<a id="H<sub>1</sub>:1" class="idref" href="#H<sub>1</sub>:1"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:2" class="idref" href="#H<sub>2</sub>:2"><span class="id" title="binder">H<sub>2</sub></span></a>:<a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="h:3" class="idref" href="#h:3"><span class="id" title="binder">h</span></a> ⇒ <span class="id" title="keyword">∀</span> <a id="h':4" class="idref" href="#h':4"><span class="id" title="binder">h'</span></a>, <a class="idref" href="LibSepReference.html#Fmap.disjoint"><span class="id" title="definition">Fmap.disjoint</span></a> <a class="idref" href="Wand.html#h:3"><span class="id" title="variable">h</span></a> <a class="idref" href="Wand.html#h':4"><span class="id" title="variable">h'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:1"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#h':4"><span class="id" title="variable">h'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:2"><span class="id" title="variable">H<sub>2</sub></span></a> (<a class="idref" href="Wand.html#h:3"><span class="id" title="variable">h</span></a> <a class="idref" href="LibSepReference.html#11dbc5cc324072f557c3f348a31ba1a<sub>0</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#11dbc5cc324072f557c3f348a31ba1a<sub>0</sub>"><span class="id" title="notation">u</span></a> <a class="idref" href="Wand.html#h':4"><span class="id" title="variable">h'</span></a>).<br/>
</div>

<div class="doc">
The definition above is perfectly fine, however it is more practical
    to use an alternative, equivalent definition of <span class="inlinecode"><span class="id" title="var">hwand</span></span>, expressed
    in terms of previously introduced Separation Logic operators.

<div class="paragraph"> </div>

    The alternative definition asserts that <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> corresponds to
    some heap predicate, called <span class="inlinecode"><span class="id" title="var">H<sub>0</sub></span></span>, such that <span class="inlinecode"><span class="id" title="var">H<sub>0</sub></span></span> starred with <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span>
    yields <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>. In other words, <span class="inlinecode"><span class="id" title="var">H<sub>0</sub></span></span> is such that <span class="inlinecode">(<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H<sub>0</sub></span>)</span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>.
    In the definition of <span class="inlinecode"><span class="id" title="var">hwand</span></span> shown below, observe how <span class="inlinecode"><span class="id" title="var">H<sub>0</sub></span></span> is
    existentially quantified. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="WandDef.hwand" class="idref" href="#WandDef.hwand"><span class="id" title="definition">hwand</span></a> (<a id="H<sub>1</sub>:5" class="idref" href="#H<sub>1</sub>:5"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:6" class="idref" href="#H<sub>2</sub>:6"><span class="id" title="binder">H<sub>2</sub></span></a>:<a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="H<sub>0</sub>:7" class="idref" href="#H<sub>0</sub>:7"><span class="id" title="binder">H<sub>0</sub></span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Wand.html#H<sub>0</sub>:7"><span class="id" title="variable">H<sub>0</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:5"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>0</sub>:7"><span class="id" title="variable">H<sub>0</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:6"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <a id="cadd6f49c30621202b890edaa339e04b" class="idref" href="#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation">&quot;</span></a>H<sub>1</sub> <span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span> H<sub>2</sub>" := (<a class="idref" href="Wand.html#WandDef.hwand"><span class="id" title="definition">hwand</span></a> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 43, <span class="id" title="tactic">right</span> <span class="id" title="keyword">associativity</span>).<br/>
</div>

<div class="doc">
As we establish further in this file, one can prove that <span class="inlinecode"><span class="id" title="var">hwand</span></span>
    and <span class="inlinecode"><span class="id" title="var">hwand'</span></span> define the same operator.

<div class="paragraph"> </div>

    The reason we prefer taking <span class="inlinecode"><span class="id" title="var">hwand</span></span> as definition rather than <span class="inlinecode"><span class="id" title="var">hwand'</span></span>
    is that it enables us to establish all the properties of the magic wand
    by exploiting the tactic <span class="inlinecode"><span class="id" title="var">xsimpl</span></span>, conducting all the reasoning at the
    level of <span class="inlinecode"><span class="id" title="var">hprop</span></span> rather than having to work with explicit heaps of type
    <span class="inlinecode"><span class="id" title="var">heap</span></span>. 
</div>

<div class="doc">
<a id="lab309"></a><h2 class="section">Characteristic Property of the Magic Wand</h2>

<div class="paragraph"> </div>

 The magic wand is not so easy to make sense of, at first. Reading
    its introduction and elimination rules may help further appreciate
    its meaning.

<div class="paragraph"> </div>

    The operator <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> satisfies the following equivalence.
    Informally speaking, think of <span class="inlinecode"><span class="id" title="var">H<sub>0</sub></span></span> <span class="inlinecode">=</span> <span class="inlinecode">-<span class="id" title="var">H<sub>1</sub></span>+<span class="id" title="var">H<sub>2</sub></span></span> and <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span>+<span class="id" title="var">H<sub>0</sub></span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>
    being equivalent. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandDef.hwand_equiv" class="idref" href="#WandDef.hwand_equiv"><span class="id" title="lemma">hwand_equiv</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>0</sub>:8" class="idref" href="#H<sub>0</sub>:8"><span class="id" title="binder">H<sub>0</sub></span></a> <a id="H<sub>1</sub>:9" class="idref" href="#H<sub>1</sub>:9"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:10" class="idref" href="#H<sub>2</sub>:10"><span class="id" title="binder">H<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>0</sub>:8"><span class="id" title="variable">H<sub>0</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:9"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:10"><span class="id" title="variable">H<sub>2</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>1</sub>:9"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>0</sub>:8"><span class="id" title="variable">H<sub>0</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:10"><span class="id" title="variable">H<sub>2</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Wand.html#WandDef.hwand"><span class="id" title="definition">hwand</span></a>. <span class="id" title="var">iff</span> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xchange</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span> <span class="id" title="var">N</span>. <span class="id" title="var">xchange</span> <span class="id" title="var">N</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span> <span class="id" title="var">H<sub>0</sub></span>. <span class="id" title="var">xchange</span> <span class="id" title="var">M</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
It turns out that the magic wand operator is uniquely defined by the
    equivalence <span class="inlinecode">(<span class="id" title="var">H<sub>0</sub></span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span>)</span> <span class="inlinecode">↔</span> <span class="inlinecode">(<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H<sub>0</sub></span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span>)</span>.
    In other words, as we establish further on, any operator that satisfies
    the above equivalence for all arguments is provably equal to <span class="inlinecode"><span class="id" title="var">hwand</span></span>. 
<div class="paragraph"> </div>

 The right-to-left direction of the equivalence is an introduction rule:
    it tells what needs to be proved for constructing a magic wand <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>
    from a state <span class="inlinecode"><span class="id" title="var">H<sub>0</sub></span></span>. What needs to be proved to establish <span class="inlinecode"><span class="id" title="var">H<sub>0</sub></span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode">(<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span>)</span>
    is that <span class="inlinecode"><span class="id" title="var">H<sub>0</sub></span></span>, when starred with <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span>, yields <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandDef.himpl_hwand_r" class="idref" href="#WandDef.himpl_hwand_r"><span class="id" title="lemma">himpl_hwand_r</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>0</sub>:11" class="idref" href="#H<sub>0</sub>:11"><span class="id" title="binder">H<sub>0</sub></span></a> <a id="H<sub>1</sub>:12" class="idref" href="#H<sub>1</sub>:12"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:13" class="idref" href="#H<sub>2</sub>:13"><span class="id" title="binder">H<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>1</sub>:12"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>0</sub>:11"><span class="id" title="variable">H<sub>0</sub></span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:13"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H<sub>0</sub>:11"><span class="id" title="variable">H<sub>0</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>1</sub>:12"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:13"><span class="id" title="variable">H<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#WandDef.hwand_equiv"><span class="id" title="lemma">hwand_equiv</span></a>. <span class="id" title="var">applys</span> <span class="id" title="var">M</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The left-to-right direction of the equivalence is an elimination rule:
    it tells what can be deduced from an entailment <span class="inlinecode"><span class="id" title="var">H<sub>0</sub></span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode">(<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span>)</span>.
    What can be deduced from this entailment is that if <span class="inlinecode"><span class="id" title="var">H<sub>0</sub></span></span> is starred
    with <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span>, then <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> can be recovered. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandDef.himpl_hwand_r_inv" class="idref" href="#WandDef.himpl_hwand_r_inv"><span class="id" title="lemma">himpl_hwand_r_inv</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>0</sub>:14" class="idref" href="#H<sub>0</sub>:14"><span class="id" title="binder">H<sub>0</sub></span></a> <a id="H<sub>1</sub>:15" class="idref" href="#H<sub>1</sub>:15"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:16" class="idref" href="#H<sub>2</sub>:16"><span class="id" title="binder">H<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H<sub>0</sub>:14"><span class="id" title="variable">H<sub>0</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>1</sub>:15"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:16"><span class="id" title="variable">H<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>1</sub>:15"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>0</sub>:14"><span class="id" title="variable">H<sub>0</sub></span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:16"><span class="id" title="variable">H<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#WandDef.hwand_equiv"><span class="id" title="lemma">hwand_equiv</span></a>. <span class="id" title="var">applys</span> <span class="id" title="var">M</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
This elimination rule can be equivalently reformulated in the following
    form, which makes clearer that <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>, when starred with <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span>,
    yields <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandDef.hwand_cancel" class="idref" href="#WandDef.hwand_cancel"><span class="id" title="lemma">hwand_cancel</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:17" class="idref" href="#H<sub>1</sub>:17"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:18" class="idref" href="#H<sub>2</sub>:18"><span class="id" title="binder">H<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H<sub>1</sub>:17"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>1</sub>:17"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:18"><span class="id" title="variable">H<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:18"><span class="id" title="variable">H<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#WandDef.himpl_hwand_r_inv"><span class="id" title="lemma">himpl_hwand_r_inv</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_refl"><span class="id" title="lemma">himpl_refl</span></a>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="var">Arguments</span> <a class="idref" href="Wand.html#WandDef.hwand_cancel"><span class="id" title="lemma">hwand_cancel</span></a> : <span class="id" title="tactic">clear</span> <span class="id" title="var">implicits</span>.<br/>
</div>

<div class="doc">
<a id="lab310"></a><h4 class="section">Exercise: 3 stars, standard, especially useful (hwand_inv)</h4>
 Prove the following inversion lemma for <span class="inlinecode"><span class="id" title="var">hwand</span></span>. This lemma
    essentially captures the fact that <span class="inlinecode"><span class="id" title="var">hwand</span></span> entails its alternative
    definition <span class="inlinecode"><span class="id" title="var">hwand'</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandDef.hwand_inv" class="idref" href="#WandDef.hwand_inv"><span class="id" title="lemma">hwand_inv</span></a> : <span class="id" title="keyword">∀</span> <a id="h<sub>1</sub>:19" class="idref" href="#h<sub>1</sub>:19"><span class="id" title="binder">h<sub>1</sub></span></a> <a id="h<sub>2</sub>:20" class="idref" href="#h<sub>2</sub>:20"><span class="id" title="binder">h<sub>2</sub></span></a> <a id="H<sub>1</sub>:21" class="idref" href="#H<sub>1</sub>:21"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:22" class="idref" href="#H<sub>2</sub>:22"><span class="id" title="binder">H<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>1</sub>:21"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:22"><span class="id" title="variable">H<sub>2</sub></span></a><a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation">)</span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation">h<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H<sub>1</sub>:21"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#h<sub>1</sub>:19"><span class="id" title="variable">h<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#Fmap.disjoint"><span class="id" title="definition">Fmap.disjoint</span></a> <a class="idref" href="Wand.html#h<sub>1</sub>:19"><span class="id" title="variable">h<sub>1</sub></span></a> <a class="idref" href="Wand.html#h<sub>2</sub>:20"><span class="id" title="variable">h<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H<sub>2</sub>:22"><span class="id" title="variable">H<sub>2</sub></span></a> (<a class="idref" href="Wand.html#h<sub>1</sub>:19"><span class="id" title="variable">h<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#11dbc5cc324072f557c3f348a31ba1a<sub>0</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#11dbc5cc324072f557c3f348a31ba1a<sub>0</sub>"><span class="id" title="notation">u</span></a> <a class="idref" href="Wand.html#h<sub>2</sub>:20"><span class="id" title="variable">h<sub>2</sub></span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab311"></a><h2 class="section">Magic Wand for Postconditions</h2>

<div class="paragraph"> </div>

 In what follows, we generalize the magic wand to operate on postconditions,
    introducing a heap predicate of the form <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span></span>, of type <span class="inlinecode"><span class="id" title="var">hprop</span></span>.
    Note that the magic wand between two postconditions produces a heap
    predicate, and not a postcondition.

<div class="paragraph"> </div>

    The definition follows exactly the same pattern as <span class="inlinecode"><span class="id" title="var">hwand</span></span>: it quantifies
    some heap predicate <span class="inlinecode"><span class="id" title="var">H<sub>0</sub></span></span> such that <span class="inlinecode"><span class="id" title="var">H<sub>0</sub></span></span> starred with <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> yields <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="WandDef.qwand" class="idref" href="#WandDef.qwand"><span class="id" title="definition">qwand</span></a> (<a id="Q<sub>1</sub>:23" class="idref" href="#Q<sub>1</sub>:23"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:24" class="idref" href="#Q<sub>2</sub>:24"><span class="id" title="binder">Q<sub>2</sub></span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="H<sub>0</sub>:25" class="idref" href="#H<sub>0</sub>:25"><span class="id" title="binder">H<sub>0</sub></span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Wand.html#H<sub>0</sub>:25"><span class="id" title="variable">H<sub>0</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a> <a class="idref" href="Wand.html#Q<sub>1</sub>:23"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="Wand.html#H<sub>0</sub>:25"><span class="id" title="variable">H<sub>0</sub></span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:24"><span class="id" title="variable">Q<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <a id="33e591d79fe48e7eab3066907349cc3a" class="idref" href="#33e591d79fe48e7eab3066907349cc3a"><span class="id" title="notation">&quot;</span></a>Q<sub>1</sub> <span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span> Q<sub>2</sub>" := (<a class="idref" href="Wand.html#WandDef.qwand"><span class="id" title="definition">qwand</span></a> <span class="id" title="var">Q<sub>1</sub></span> <span class="id" title="var">Q<sub>2</sub></span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 43).<br/>
</div>

<div class="doc">
The operator <span class="inlinecode"><span class="id" title="var">qwand</span></span> satisfies essentially the same properties as <span class="inlinecode"><span class="id" title="var">hwand</span></span>.
    Let us begin with the associated equivalence rule, which captures both
    the introduction and the elimination rule. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandDef.qwand_equiv" class="idref" href="#WandDef.qwand_equiv"><span class="id" title="lemma">qwand_equiv</span></a> : <span class="id" title="keyword">∀</span> <a id="H:26" class="idref" href="#H:26"><span class="id" title="binder">H</span></a> <a id="Q<sub>1</sub>:27" class="idref" href="#Q<sub>1</sub>:27"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:28" class="idref" href="#Q<sub>2</sub>:28"><span class="id" title="binder">Q<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H:26"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:27"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Wand.html#33e591d79fe48e7eab3066907349cc3a"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:28"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>  <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a>  <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:27"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="Wand.html#H:26"><span class="id" title="variable">H</span></a><a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:28"><span class="id" title="variable">Q<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Wand.html#WandDef.qwand"><span class="id" title="definition">qwand</span></a>. <span class="id" title="var">iff</span> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">v</span>. <span class="id" title="var">xchange</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H<sub>4</sub></span> <span class="id" title="var">N</span>. <span class="id" title="var">xchange</span> <span class="id" title="var">N</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span> <span class="id" title="var">H</span>. <span class="id" title="var">xchange</span> <span class="id" title="var">M</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The cancellation rule follows. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandDef.qwand_cancel" class="idref" href="#WandDef.qwand_cancel"><span class="id" title="lemma">qwand_cancel</span></a> : <span class="id" title="keyword">∀</span> <a id="Q<sub>1</sub>:29" class="idref" href="#Q<sub>1</sub>:29"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:30" class="idref" href="#Q<sub>2</sub>:30"><span class="id" title="binder">Q<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#Q<sub>1</sub>:29"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:29"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Wand.html#33e591d79fe48e7eab3066907349cc3a"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:30"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:30"><span class="id" title="variable">Q<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="Wand.html#WandDef.qwand_equiv"><span class="id" title="lemma">qwand_equiv</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.qimpl_refl"><span class="id" title="lemma">qimpl_refl</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
An interesting property of <span class="inlinecode"><span class="id" title="var">qwand</span></span> is the fact that we can specialize
    <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span></span> to <span class="inlinecode">(<span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">v</span>)</span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode">(<span class="id" title="var">Q<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">v</span>)</span>, for any value <span class="inlinecode"><span class="id" title="var">v</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandDef.qwand_specialize" class="idref" href="#WandDef.qwand_specialize"><span class="id" title="lemma">qwand_specialize</span></a> : <span class="id" title="keyword">∀</span> (<a id="v:31" class="idref" href="#v:31"><span class="id" title="binder">v</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) (<a id="Q<sub>1</sub>:32" class="idref" href="#Q<sub>1</sub>:32"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:33" class="idref" href="#Q<sub>2</sub>:33"><span class="id" title="binder">Q<sub>2</sub></span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:32"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Wand.html#33e591d79fe48e7eab3066907349cc3a"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:33"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:32"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Wand.html#v:31"><span class="id" title="variable">v</span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:33"><span class="id" title="variable">Q<sub>2</sub></span></a> <a class="idref" href="Wand.html#v:31"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Wand.html#WandDef.qwand"><span class="id" title="definition">qwand</span></a>, <a class="idref" href="Wand.html#WandDef.hwand"><span class="id" title="definition">hwand</span></a>. <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H<sub>0</sub></span> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xsimpl</span> <span class="id" title="var">H<sub>0</sub></span>. <span class="id" title="var">xchange</span> <span class="id" title="var">M</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab312"></a><h2 class="section">Frame Expressed with <span class="inlinecode"><span class="id" title="var">hwand</span></span>: the Ramified Frame Rule</h2>

<div class="paragraph"> </div>

 Recall the consequence-frame rule, which is pervasively used
    for example by the tactic <span class="inlinecode"><span class="id" title="var">xapp</span></span> for reasoning about applications. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="WandDef.triple_conseq_frame" class="idref" href="#WandDef.triple_conseq_frame"><span class="id" title="axiom">triple_conseq_frame</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>2</sub>:34" class="idref" href="#H<sub>2</sub>:34"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="H<sub>1</sub>:35" class="idref" href="#H<sub>1</sub>:35"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="Q<sub>1</sub>:36" class="idref" href="#Q<sub>1</sub>:36"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="t:37" class="idref" href="#t:37"><span class="id" title="binder">t</span></a> <a id="H:38" class="idref" href="#H:38"><span class="id" title="binder">H</span></a> <a id="Q:39" class="idref" href="#Q:39"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Wand.html#t:37"><span class="id" title="variable">t</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:35"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#Q<sub>1</sub>:36"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H:38"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:35"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:34"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#Q<sub>1</sub>:36"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:34"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Wand.html#Q:39"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Wand.html#t:37"><span class="id" title="variable">t</span></a> <a class="idref" href="Wand.html#H:38"><span class="id" title="variable">H</span></a> <a class="idref" href="Wand.html#Q:39"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
This rule suffers from a practical issue, which we illustrate in
    details on a concrete example further on. For now, let us just
    attempt to describe the issue at a high-level.

<div class="paragraph"> </div>

    In short, the problem stems from the fact that we need to instantiate
    <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> for applying the rule. Providing <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> by hand is not practical, thus
    we need to infer it. The value of <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> can be computed as the subtraction
    of <span class="inlinecode"><span class="id" title="var">H</span></span> minus <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span>. The resulting value may then exploited in the last
    premise for constructing <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*+</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>. This transfer of information via <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>
    from one subgoal to another can be obtained by introducing an "evar" (Coq
    unification variable) for <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>. However this approach does not work
    well in the cases where <span class="inlinecode"><span class="id" title="var">H</span></span> contains existential quantifiers. Indeed,
    such existential quantifiers are typically first extracted out of the
    entailment <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> by the tactic <span class="inlinecode"><span class="id" title="var">xsimpl</span></span>. However, these
    existentially quantified variables are not in the scope of <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>, hence
    the instantiation of the evar associated with <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> typically fails. 
<div class="paragraph"> </div>

 The "ramified frame rule" exploits the magic wand operator to circumvent
    the problem, by merging the two premises <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> and
    <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*+</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> <span class="inlinecode">===&gt;</span> <span class="inlinecode"><span class="id" title="var">Q</span></span> into a single premise that no longer mentions <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>.

<div class="paragraph"> </div>

    This replacement premise is <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode">(<span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>)</span>. To understand where
    it comes from, observe first that the second premise <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*+</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> <span class="inlinecode">===&gt;</span> <span class="inlinecode"><span class="id" title="var">Q</span></span>
    is equivalent to <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode">(<span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>)</span>. By replacing <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> with <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>
    inside the first premise <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>, we obtain the new premise
    <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode">(<span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>)</span>.

<div class="paragraph"> </div>

    This merging of the two entailments leads us to the statement of the
    "ramified frame rule" shown below. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandDef.triple_ramified_frame" class="idref" href="#WandDef.triple_ramified_frame"><span class="id" title="lemma">triple_ramified_frame</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:41" class="idref" href="#H<sub>1</sub>:41"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="Q<sub>1</sub>:42" class="idref" href="#Q<sub>1</sub>:42"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="t:43" class="idref" href="#t:43"><span class="id" title="binder">t</span></a> <a id="H:44" class="idref" href="#H:44"><span class="id" title="binder">H</span></a> <a id="Q:45" class="idref" href="#Q:45"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Wand.html#t:43"><span class="id" title="variable">t</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:41"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#Q<sub>1</sub>:42"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H:44"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:41"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:42"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Wand.html#33e591d79fe48e7eab3066907349cc3a"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q:45"><span class="id" title="variable">Q</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Wand.html#t:43"><span class="id" title="variable">t</span></a> <a class="idref" href="Wand.html#H:44"><span class="id" title="variable">H</span></a> <a class="idref" href="Wand.html#Q:45"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span> <span class="id" title="var">W</span>. <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#WandDef.triple_conseq_frame"><span class="id" title="axiom">triple_conseq_frame</span></a> (<span class="id" title="var">Q<sub>1</sub></span> <a class="idref" href="Wand.html#33e591d79fe48e7eab3066907349cc3a"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <span class="id" title="var">Q</span>) <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <span class="id" title="var">W</span>. } { <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#WandDef.qwand_cancel"><span class="id" title="lemma">qwand_cancel</span></a>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Reciprocally, we can prove that the ramified frame rule entails
    the consequence-frame rule. Hence, the ramified frame rule has
    the same expressive power as the consequence-frame rule. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandDef.triple_conseq_frame_of_ramified_frame" class="idref" href="#WandDef.triple_conseq_frame_of_ramified_frame"><span class="id" title="lemma">triple_conseq_frame_of_ramified_frame</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>2</sub>:46" class="idref" href="#H<sub>2</sub>:46"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="H<sub>1</sub>:47" class="idref" href="#H<sub>1</sub>:47"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="Q<sub>1</sub>:48" class="idref" href="#Q<sub>1</sub>:48"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="t:49" class="idref" href="#t:49"><span class="id" title="binder">t</span></a> <a id="H:50" class="idref" href="#H:50"><span class="id" title="binder">H</span></a> <a id="Q:51" class="idref" href="#Q:51"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Wand.html#t:49"><span class="id" title="variable">t</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:47"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#Q<sub>1</sub>:48"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H:50"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:47"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:46"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#Q<sub>1</sub>:48"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:46"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Wand.html#Q:51"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Wand.html#t:49"><span class="id" title="variable">t</span></a> <a class="idref" href="Wand.html#H:50"><span class="id" title="variable">H</span></a> <a class="idref" href="Wand.html#Q:51"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span> <span class="id" title="var">WH</span> <span class="id" title="var">WQ</span>. <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#WandDef.triple_ramified_frame"><span class="id" title="lemma">triple_ramified_frame</span></a> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xchange</span> <span class="id" title="var">WH</span>. <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="Wand.html#WandDef.qwand_equiv"><span class="id" title="lemma">qwand_equiv</span></a>. <span class="id" title="var">applys</span> <span class="id" title="var">WQ</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab313"></a><h2 class="section">Ramified Frame Rule in Weakest-Precondition Style</h2>

<div class="paragraph"> </div>

 The ramified frame rule, which we have just stated for triples,
    features a counterpart expressed in weakest-precondition style (<span class="inlinecode"><span class="id" title="var">wp</span></span>).

<div class="paragraph"> </div>

    In what follows, we present the "wp ramified rule", named <span class="inlinecode"><span class="id" title="var">wp_ramified</span></span>.
    This rule admits a concise statement and subsumes all other
    structural rules of Separation Logic. Its statement is as follows.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">wp</span> <span class="id" title="var">t</span> <span class="id" title="var">Q<sub>1</sub></span>) <span class='gray-font'>\</span>* (<span class="id" title="var">Q<sub>1</sub></span> <span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span> <span class="id" title="var">Q<sub>2</sub></span>) ==&gt; (<span class="id" title="var">wp</span> <span class="id" title="var">t</span> <span class="id" title="var">Q<sub>2</sub></span>).
</span>
<div class="paragraph"> </div>

 To see where this statement comes from, recall from the chapter
    <a href="WPsem.html"><span class="inlineref">WPsem</span></a> the rule named <span class="inlinecode"><span class="id" title="var">wp_conseq_frame</span></span>, which combines
    the consequence rule and the frame rule for <span class="inlinecode"><span class="id" title="var">wp</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="WandDef.wp_conseq_frame" class="idref" href="#WandDef.wp_conseq_frame"><span class="id" title="axiom">wp_conseq_frame</span></a> : <span class="id" title="keyword">∀</span> <a id="t:52" class="idref" href="#t:52"><span class="id" title="binder">t</span></a> <a id="H:53" class="idref" href="#H:53"><span class="id" title="binder">H</span></a> <a id="Q<sub>1</sub>:54" class="idref" href="#Q<sub>1</sub>:54"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:55" class="idref" href="#Q<sub>2</sub>:55"><span class="id" title="binder">Q<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#Q<sub>1</sub>:54"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="Wand.html#H:53"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:55"><span class="id" title="variable">Q<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="Wand.html#t:52"><span class="id" title="variable">t</span></a> <a class="idref" href="Wand.html#Q<sub>1</sub>:54"><span class="id" title="variable">Q<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H:53"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="Wand.html#t:52"><span class="id" title="variable">t</span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:55"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
</div>

<div class="doc">
Let us reformulate this rule using a magic wand. The premise
    <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*+</span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">===&gt;</span> <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span></span> can be rewritten as <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode">(<span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span>)</span>.
    By replacing <span class="inlinecode"><span class="id" title="var">H</span></span> with <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span></span> in the conclusion of
    <span class="inlinecode"><span class="id" title="var">wp_conseq_frame</span></span>, we obtain the ramified rule for <span class="inlinecode"><span class="id" title="var">wp</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandDef.wp_ramified" class="idref" href="#WandDef.wp_ramified"><span class="id" title="lemma">wp_ramified</span></a> : <span class="id" title="keyword">∀</span> <a id="t:57" class="idref" href="#t:57"><span class="id" title="binder">t</span></a> <a id="Q<sub>1</sub>:58" class="idref" href="#Q<sub>1</sub>:58"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:59" class="idref" href="#Q<sub>2</sub>:59"><span class="id" title="binder">Q<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="Wand.html#t:57"><span class="id" title="variable">t</span></a> <a class="idref" href="Wand.html#Q<sub>1</sub>:58"><span class="id" title="variable">Q<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:58"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Wand.html#33e591d79fe48e7eab3066907349cc3a"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:59"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="Wand.html#t:57"><span class="id" title="variable">t</span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:59"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#WandDef.wp_conseq_frame"><span class="id" title="axiom">wp_conseq_frame</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#WandDef.qwand_cancel"><span class="id" title="lemma">qwand_cancel</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab314"></a><h4 class="section">Exercise: 3 stars, standard, especially useful (wp_conseq_frame_of_wp_ramified)</h4>
 Prove that <span class="inlinecode"><span class="id" title="var">wp_conseq_frame</span></span> is derivable from <span class="inlinecode"><span class="id" title="var">wp_ramified</span></span>.
    To that end, prove the statement of <span class="inlinecode"><span class="id" title="var">wp_conseq_frame</span></span> by using
    only <span class="inlinecode"><span class="id" title="var">wp_ramified</span></span>, the characteristic property of the magic
    wand <span class="inlinecode"><span class="id" title="var">qwand_equiv</span></span>, and properties of the entailment relation. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandDef.wp_conseq_frame_of_wp_ramified" class="idref" href="#WandDef.wp_conseq_frame_of_wp_ramified"><span class="id" title="lemma">wp_conseq_frame_of_wp_ramified</span></a> : <span class="id" title="keyword">∀</span> <a id="t:60" class="idref" href="#t:60"><span class="id" title="binder">t</span></a> <a id="H:61" class="idref" href="#H:61"><span class="id" title="binder">H</span></a> <a id="Q<sub>1</sub>:62" class="idref" href="#Q<sub>1</sub>:62"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:63" class="idref" href="#Q<sub>2</sub>:63"><span class="id" title="binder">Q<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#Q<sub>1</sub>:62"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="Wand.html#H:61"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:63"><span class="id" title="variable">Q<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="Wand.html#t:60"><span class="id" title="variable">t</span></a> <a class="idref" href="Wand.html#Q<sub>1</sub>:62"><span class="id" title="variable">Q<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H:61"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="Wand.html#t:60"><span class="id" title="variable">t</span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:63"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 The following reformulation of <span class="inlinecode"><span class="id" title="var">wp_ramified</span></span> can be more practical
    to exploit in practice, because it applies to any goal of the form
    <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandDef.wp_ramified_trans" class="idref" href="#WandDef.wp_ramified_trans"><span class="id" title="lemma">wp_ramified_trans</span></a> : <span class="id" title="keyword">∀</span> <a id="t:64" class="idref" href="#t:64"><span class="id" title="binder">t</span></a> <a id="H:65" class="idref" href="#H:65"><span class="id" title="binder">H</span></a> <a id="Q<sub>1</sub>:66" class="idref" href="#Q<sub>1</sub>:66"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:67" class="idref" href="#Q<sub>2</sub>:67"><span class="id" title="binder">Q<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H:65"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="Wand.html#t:64"><span class="id" title="variable">t</span></a> <a class="idref" href="Wand.html#Q<sub>1</sub>:66"><span class="id" title="variable">Q<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:66"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Wand.html#33e591d79fe48e7eab3066907349cc3a"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:67"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H:65"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="Wand.html#t:64"><span class="id" title="variable">t</span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:67"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">xchange</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#WandDef.wp_ramified"><span class="id" title="lemma">wp_ramified</span></a>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="Wand.html#WandDef"><span class="id" title="module">WandDef</span></a>.<br/>
</div>

<div class="doc">
<a id="lab315"></a><h2 class="section">Automation with <span class="inlinecode"><span class="id" title="var">xsimpl</span></span> for <span class="inlinecode"><span class="id" title="var">hwand</span></span> Expressions</h2>

<div class="paragraph"> </div>

 One can extend the tactic <span class="inlinecode"><span class="id" title="var">xsimpl</span></span> to recognize the magic wand,
    and automatically perform a number of obvious simplifications.
    This extension is implemented in the file <span class="inlinecode"><span class="id" title="var">LibSepSimpl</span></span>, which
    exports the tactic <span class="inlinecode"><span class="id" title="var">xsimpl</span></span> illustrated in this section. 
</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="XsimplDemo" class="idref" href="#XsimplDemo"><span class="id" title="module">XsimplDemo</span></a>.<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">xsimpl</span></span> is able to spot a magic wand that cancels out.
    For example, if an iterated separating conjunction includes
    both <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span></span> and <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>, then these two heap predicates can
    be merged, leaving just <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="XsimplDemo.xsimpl_demo_hwand_cancel" class="idref" href="#XsimplDemo.xsimpl_demo_hwand_cancel"><span class="id" title="lemma">xsimpl_demo_hwand_cancel</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:68" class="idref" href="#H<sub>1</sub>:68"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:69" class="idref" href="#H<sub>2</sub>:69"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="H<sub>3</sub>:70" class="idref" href="#H<sub>3</sub>:70"><span class="id" title="binder">H<sub>3</sub></span></a> <a id="H<sub>4</sub>:71" class="idref" href="#H<sub>4</sub>:71"><span class="id" title="binder">H<sub>4</sub></span></a> <a id="H<sub>5</sub>:72" class="idref" href="#H<sub>5</sub>:72"><span class="id" title="binder">H<sub>5</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H<sub>1</sub>:68"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>2</sub>:69"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H<sub>3</sub>:70"><span class="id" title="variable">H<sub>3</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>4</sub>:71"><span class="id" title="variable">H<sub>4</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:69"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>5</sub>:72"><span class="id" title="variable">H<sub>5</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">xsimpl</span>. <span class="id" title="keyword">Abort</span>.<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">xsimpl</span></span> is able to simplify uncurried magic wands.
    For example, if an iterated separating conjunction includes
    <span class="inlinecode">(<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span>)</span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>4</sub></span></span> and <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>, the two predicates can be
    merged, leaving <span class="inlinecode">(<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span>)</span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>4</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="XsimplDemo.xsimpl_demo_hwand_cancel_partial" class="idref" href="#XsimplDemo.xsimpl_demo_hwand_cancel_partial"><span class="id" title="lemma">xsimpl_demo_hwand_cancel_partial</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:73" class="idref" href="#H<sub>1</sub>:73"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:74" class="idref" href="#H<sub>2</sub>:74"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="H<sub>3</sub>:75" class="idref" href="#H<sub>3</sub>:75"><span class="id" title="binder">H<sub>3</sub></span></a> <a id="H<sub>4</sub>:76" class="idref" href="#H<sub>4</sub>:76"><span class="id" title="binder">H<sub>4</sub></span></a> <a id="H<sub>5</sub>:77" class="idref" href="#H<sub>5</sub>:77"><span class="id" title="binder">H<sub>5</sub></span></a> <a id="H<sub>6</sub>:78" class="idref" href="#H<sub>6</sub>:78"><span class="id" title="binder">H<sub>6</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>1</sub>:73"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:74"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>3</sub>:75"><span class="id" title="variable">H<sub>3</sub></span></a><a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H<sub>4</sub>:76"><span class="id" title="variable">H<sub>4</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>5</sub>:77"><span class="id" title="variable">H<sub>5</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:74"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>6</sub>:78"><span class="id" title="variable">H<sub>6</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">xsimpl</span>. <span class="id" title="keyword">Abort</span>.<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">xsimpl</span></span> automatically applies the introduction rule <span class="inlinecode"><span class="id" title="var">himpl_hwand_r</span></span>
    when the right-hand-side, after prior simplification, reduces to
    just a magic wand. In the example below, <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> is first cancelled out
    from both sides, then <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span></span> is moved from the RHS to the LHS. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="XsimplDemo.xsimpl_demo_himpl_hwand_r" class="idref" href="#XsimplDemo.xsimpl_demo_himpl_hwand_r"><span class="id" title="lemma">xsimpl_demo_himpl_hwand_r</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:79" class="idref" href="#H<sub>1</sub>:79"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:80" class="idref" href="#H<sub>2</sub>:80"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="H<sub>3</sub>:81" class="idref" href="#H<sub>3</sub>:81"><span class="id" title="binder">H<sub>3</sub></span></a> <a id="H<sub>4</sub>:82" class="idref" href="#H<sub>4</sub>:82"><span class="id" title="binder">H<sub>4</sub></span></a> <a id="H<sub>5</sub>:83" class="idref" href="#H<sub>5</sub>:83"><span class="id" title="binder">H<sub>5</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H<sub>1</sub>:79"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:80"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:79"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>3</sub>:81"><span class="id" title="variable">H<sub>3</sub></span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>4</sub>:82"><span class="id" title="variable">H<sub>4</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>5</sub>:83"><span class="id" title="variable">H<sub>5</sub></span></a><a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">)</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">xsimpl</span>. <span class="id" title="keyword">Abort</span>.<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">xsimpl</span></span> can iterate a number of simplifications involving
    different magic wands. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="XsimplDemo.xsimpl_demo_hwand_iter" class="idref" href="#XsimplDemo.xsimpl_demo_hwand_iter"><span class="id" title="lemma">xsimpl_demo_hwand_iter</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:84" class="idref" href="#H<sub>1</sub>:84"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:85" class="idref" href="#H<sub>2</sub>:85"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="H<sub>3</sub>:86" class="idref" href="#H<sub>3</sub>:86"><span class="id" title="binder">H<sub>3</sub></span></a> <a id="H<sub>4</sub>:87" class="idref" href="#H<sub>4</sub>:87"><span class="id" title="binder">H<sub>4</sub></span></a> <a id="H<sub>5</sub>:88" class="idref" href="#H<sub>5</sub>:88"><span class="id" title="binder">H<sub>5</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H<sub>1</sub>:84"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:85"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>1</sub>:84"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>3</sub>:86"><span class="id" title="variable">H<sub>3</sub></span></a><a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>4</sub>:87"><span class="id" title="variable">H<sub>4</sub></span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H<sub>5</sub>:88"><span class="id" title="variable">H<sub>5</sub></span></a><a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">)</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>4</sub>:87"><span class="id" title="variable">H<sub>4</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>2</sub>:85"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H<sub>3</sub>:86"><span class="id" title="variable">H<sub>3</sub></span></a><a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H<sub>5</sub>:88"><span class="id" title="variable">H<sub>5</sub></span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">xsimpl</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">xsimpl</span></span> is also able to deal with the magic wand for postconditions.
    In particular, it is able to merge <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span></span> with <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">v</span></span>,
    leaving <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">v</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="XsimplDemo.xsimpl_demo_qwand_cancel" class="idref" href="#XsimplDemo.xsimpl_demo_qwand_cancel"><span class="id" title="lemma">xsimpl_demo_qwand_cancel</span></a> : <span class="id" title="keyword">∀</span> <a id="v:89" class="idref" href="#v:89"><span class="id" title="binder">v</span></a> (<a id="Q<sub>1</sub>:90" class="idref" href="#Q<sub>1</sub>:90"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:91" class="idref" href="#Q<sub>2</sub>:91"><span class="id" title="binder">Q<sub>2</sub></span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) <a id="H<sub>1</sub>:92" class="idref" href="#H<sub>1</sub>:92"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:93" class="idref" href="#H<sub>2</sub>:93"><span class="id" title="binder">H<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:90"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#5609a52f091556b9923d5758aa61f543"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:91"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:92"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:90"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Wand.html#v:89"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:93"><span class="id" title="variable">H<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">xsimpl</span>. <span class="id" title="keyword">Abort</span>.<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">xsimpl</span></span> is able to prove entailments whose right-hand side is
    a magic wand.  
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="XsimplDemo.xsimpl_hwand_frame" class="idref" href="#XsimplDemo.xsimpl_hwand_frame"><span class="id" title="lemma">xsimpl_hwand_frame</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:94" class="idref" href="#H<sub>1</sub>:94"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:95" class="idref" href="#H<sub>2</sub>:95"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="H<sub>3</sub>:96" class="idref" href="#H<sub>3</sub>:96"><span class="id" title="binder">H<sub>3</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>1</sub>:94"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:95"><span class="id" title="variable">H<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>1</sub>:94"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>3</sub>:96"><span class="id" title="variable">H<sub>3</sub></span></a><a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>2</sub>:95"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>3</sub>:96"><span class="id" title="variable">H<sub>3</sub></span></a><a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">)</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">xsimpl</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">xsimpl</span></span>&nbsp;first&nbsp;step&nbsp;is&nbsp;to&nbsp;turn&nbsp;the&nbsp;goal&nbsp;into:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode">(<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span>)</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode">(<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span>)</span> <span class="inlinecode">==&gt;</span> <span class="inlinecode">(<span class="id" title="var">H<sub>2</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span>)</span>.&nbsp;*)</span><br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="Wand.html#XsimplDemo"><span class="id" title="module">XsimplDemo</span></a>.<br/>
</div>

<div class="doc">
<a id="lab316"></a><h2 class="section">Evaluation of <span class="inlinecode"><span class="id" title="var">wpgen</span></span> Recursively in Locally Defined Functions</h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="WPgenRec" class="idref" href="#WPgenRec"><span class="id" title="module">WPgenRec</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">vx</span> <span class="id" title="var">vf</span> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
</div>

<div class="doc">
Recall from chapter <a href="WPgen.html"><span class="inlineref">WPgen</span></a> the original definition of <span class="inlinecode"><span class="id" title="var">wpgen</span></span>,
    that is, before numerous refactoring. It admitted the following shape.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">wpgen</span> (<span class="id" title="var">t</span>:<span class="id" title="var">trm</span>) (<span class="id" title="var">Q</span>:<span class="id" title="var">val</span>→<span class="id" title="var">hprop</span>) : <span class="id" title="var">hprop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">trm_val</span> <span class="id" title="var">v</span>      ⇒ <span class="id" title="var">Q</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">trm_fun</span> <span class="id" title="var">x</span> <span class="id" title="var">t<sub>1</sub></span>   ⇒ <span class="id" title="var">Q</span> (<span class="id" title="var">val_fun</span> <span class="id" title="var">x</span> <span class="id" title="var">t<sub>1</sub></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">trm_fix</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">t<sub>1</sub></span> ⇒ <span class="id" title="var">Q</span> (<span class="id" title="var">val_fix</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">t<sub>1</sub></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.
</span>    This definition of <span class="inlinecode"><span class="id" title="var">wpgen</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> does not recurse inside the body
    of functions that occur in the argument <span class="inlinecode"><span class="id" title="var">t</span></span>. Instead, it treats
    such locally defined functions just like values. 
<div class="paragraph"> </div>

 Not processing local functions does not limit expressiveness, because
    it is always possible for the user to manually invoke <span class="inlinecode"><span class="id" title="var">wpgen</span></span>
    for each locally defined function, during the verification proof.

<div class="paragraph"> </div>

    Nevertheless, it is much more satisfying and much more practical
    to set up <span class="inlinecode"><span class="id" title="var">wpgen</span></span> so that it recursively computes the weakest
    precondition of all the local functions that it encounters during
    its evaluation.

<div class="paragraph"> </div>

    In what follows, we show how such a version of <span class="inlinecode"><span class="id" title="var">wpgen</span></span> can be set up.
    We begin with the case of non-recursive functions of the form
    <span class="inlinecode"><span class="id" title="var">trm_fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>, then generalize the definition to the slightly more complex
    case of recursive functions of the form <span class="inlinecode"><span class="id" title="var">trm_fix</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>. In both cases,
    the function <span class="inlinecode"><span class="id" title="var">wpgen</span></span> will get recursively invoked on the body <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>
    of the function, in a context extended with the appropriate bindings.

<div class="paragraph"> </div>

    The new definition of <span class="inlinecode"><span class="id" title="var">wpgen</span></span> will take the shape shown below, for
    well-suited definitions of <span class="inlinecode"><span class="id" title="var">wpgen_fun</span></span> and <span class="inlinecode"><span class="id" title="var">wpgen_fix</span></span> yet to be
    introduced. In the code snippet below, <span class="inlinecode"><span class="id" title="var">vx</span></span> denotes a value to
    which the function may be applied, and <span class="inlinecode"><span class="id" title="var">vf</span></span> denotes the value
    associated with the function itself, this value being used in particular
    in the case of recursive calls.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">wpgen</span> (<span class="id" title="var">E</span>:<span class="id" title="var">ctx</span>) (<span class="id" title="var">t</span>:<span class="id" title="var">trm</span>) : <span class="id" title="var">formula</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mkstruct</span> <span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">trm_val</span> <span class="id" title="var">v</span>      ⇒ <span class="id" title="var">wpgen_val</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">trm_fun</span> <span class="id" title="var">x</span> <span class="id" title="var">t<sub>1</sub></span>   ⇒ <span class="id" title="var">wpgen_fun</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">vx</span> ⇒ <span class="id" title="var">wpgen</span> ((<span class="id" title="var">x</span>,<span class="id" title="var">vx</span>)::<span class="id" title="var">E</span>) <span class="id" title="var">t<sub>1</sub></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">trm_fix</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">t<sub>1</sub></span> ⇒ <span class="id" title="var">wpgen_fix</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">vf</span> <span class="id" title="var">vx</span> ⇒ <span class="id" title="var">wpgen</span> ((<span class="id" title="var">f</span>,<span class="id" title="var">vf</span>)::(<span class="id" title="var">x</span>,<span class="id" title="var">vx</span>)::<span class="id" title="var">E</span>) <span class="id" title="var">t<sub>1</sub></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.
</span>
</div>

<div class="doc">
<a id="lab317"></a><h3 class="section">1. Treatment of Non-Recursive Functions</h3>

<div class="paragraph"> </div>

 For simplicity, let us assume for now the substitution context <span class="inlinecode"><span class="id" title="var">E</span></span> to be
    empty, and let us ignore the presence of the predicate <span class="inlinecode"><span class="id" title="var">mkstruct</span></span>.
    Our goal task is to provide a definition for <span class="inlinecode"><span class="id" title="var">wpgen</span></span> <span class="inlinecode">(<span class="id" title="var">trm_fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span>)</span> <span class="inlinecode"><span class="id" title="var">Q</span></span>,
    expressed in terms of <span class="inlinecode"><span class="id" title="var">wpgen</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>.

<div class="paragraph"> </div>

    Let <span class="inlinecode"><span class="id" title="var">vf</span></span> denote the function <span class="inlinecode"><span class="id" title="var">val_fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>, which the term <span class="inlinecode"><span class="id" title="var">trm_fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>
    evaluates to. The heap predicate <span class="inlinecode"><span class="id" title="var">wpgen</span></span> <span class="inlinecode">(<span class="id" title="var">trm_fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span>)</span> <span class="inlinecode"><span class="id" title="var">Q</span></span> should
    assert that that the postcondition <span class="inlinecode"><span class="id" title="var">Q</span></span> holds of the result value <span class="inlinecode"><span class="id" title="var">vf</span></span>,
    i.e., that <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode"><span class="id" title="var">vf</span></span> should hold.

<div class="paragraph"> </div>

    Rather than specifying that <span class="inlinecode"><span class="id" title="var">vf</span></span> is equal to <span class="inlinecode"><span class="id" title="var">val_fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> as we were
    doing previously, we would like to specify that <span class="inlinecode"><span class="id" title="var">vf</span></span> denotes a function
    whose body admits <span class="inlinecode"><span class="id" title="var">wpgen</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> as weakest precondition. This information
    no longer exposes the syntax of the term <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>, and is nevertheless
    sufficient for the user to reason about the behavior of the function <span class="inlinecode"><span class="id" title="var">vf</span></span>.

<div class="paragraph"> </div>

    To that end, we define the heap predicate <span class="inlinecode"><span class="id" title="var">wpgen</span></span> <span class="inlinecode">(<span class="id" title="var">trm_fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span>)</span> <span class="inlinecode"><span class="id" title="var">Q</span></span> to
    be of the form <span class="inlinecode">\<span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">vf</span>,</span> <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">vf</span>]</span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode"><span class="id" title="var">vf</span></span> for a carefully crafted
    predicate <span class="inlinecode"><span class="id" title="var">P</span></span> that describes the behavior of the function by means of its
    weakest precondition. <span class="inlinecode"><span class="id" title="var">P</span></span> is defined further on.

<div class="paragraph"> </div>

    The universal quantification on <span class="inlinecode"><span class="id" title="var">vf</span></span> is intended to hide away from the
    user the fact that <span class="inlinecode"><span class="id" title="var">vf</span></span> actually denotes <span class="inlinecode"><span class="id" title="var">val_fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>. It would be
    correct to replace <span class="inlinecode">\<span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">vf</span>,</span> <span class="inlinecode">...</span> with <span class="inlinecode"><span class="id" title="keyword">let</span></span> <span class="inlinecode"><span class="id" title="var">vf</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">val_fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="keyword">in</span></span> <span class="inlinecode">...</span>,
    yet we are purposely trying to abstract away from the syntax of <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>, hence
    the universal quantification of <span class="inlinecode"><span class="id" title="var">vf</span></span>.

<div class="paragraph"> </div>

    In the heap predicate <span class="inlinecode">\<span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">vf</span>,</span> <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">vf</span>]</span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode"><span class="id" title="var">vf</span></span>, the magic wand
    features a left-hand side of the form <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">vf</span>]</span> is intended to provide
    to the user the knowledge of the weakest precondition of the body <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> of
    the function, in such a way that the user is able to derive the
    specification aimed for the local function <span class="inlinecode"><span class="id" title="var">vf</span></span>.

<div class="paragraph"> </div>

    Concretely, the proposition <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">vf</span></span> should enable the user establishing
    properties of applications of the form <span class="inlinecode"><span class="id" title="var">trm_app</span></span> <span class="inlinecode"><span class="id" title="var">vf</span></span> <span class="inlinecode"><span class="id" title="var">vx</span></span>, where <span class="inlinecode"><span class="id" title="var">vf</span></span> denotes
    the function and <span class="inlinecode"><span class="id" title="var">vx</span></span> denotes an argument to which the function is applied.

<div class="paragraph"> </div>

    To figure out the details of the statement of <span class="inlinecode"><span class="id" title="var">P</span></span>, it is useful to recall
    from chapter <a href="WPgen.html"><span class="inlineref">WPgen</span></a> the statement of the lemma
    <span class="inlinecode"><span class="id" title="var">triple_app_fun_from_wpgen</span></span>, which we used for reasoning about top-level
    functions. Its statement appears below---variables were renamed to better
    match the current context. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="WPgenRec.triple_app_fun_from_wpgen" class="idref" href="#WPgenRec.triple_app_fun_from_wpgen"><span class="id" title="axiom">triple_app_fun_from_wpgen</span></a> : <span class="id" title="keyword">∀</span> <a id="vf:97" class="idref" href="#vf:97"><span class="id" title="binder">vf</span></a> <a id="vx:98" class="idref" href="#vx:98"><span class="id" title="binder">vx</span></a> <a id="x:99" class="idref" href="#x:99"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:100" class="idref" href="#t<sub>1</sub>:100"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="H':101" class="idref" href="#H':101"><span class="id" title="binder">H'</span></a> <a id="Q':102" class="idref" href="#Q':102"><span class="id" title="binder">Q'</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#vf:97"><span class="id" title="variable">vf</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_fun"><span class="id" title="constructor">val_fun</span></a> <a class="idref" href="Wand.html#x:99"><span class="id" title="variable">x</span></a> <a class="idref" href="Wand.html#t<sub>1</sub>:100"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H':101"><span class="id" title="variable">H'</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#wpgen"><span class="id" title="definition">wpgen</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#x:99"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Wand.html#vx:98"><span class="id" title="variable">vx</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>) <a class="idref" href="Wand.html#t<sub>1</sub>:100"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Wand.html#Q':102"><span class="id" title="variable">Q'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="Wand.html#vf:97"><span class="id" title="variable">vf</span></a> <a class="idref" href="Wand.html#vx:98"><span class="id" title="variable">vx</span></a>) <a class="idref" href="Wand.html#H':101"><span class="id" title="variable">H'</span></a> <a class="idref" href="Wand.html#Q':102"><span class="id" title="variable">Q'</span></a>.<br/>
</div>

<div class="doc">
The lemma above enables establishing a triple for an application
    <span class="inlinecode"><span class="id" title="var">trm_app</span></span> <span class="inlinecode"><span class="id" title="var">vf</span></span> <span class="inlinecode"><span class="id" title="var">vx</span></span> with precondition <span class="inlinecode"><span class="id" title="var">H'</span></span> and postcondition <span class="inlinecode"><span class="id" title="var">Q'</span></span>,
    from the premise <span class="inlinecode"><span class="id" title="var">H'</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wgen</span></span> <span class="inlinecode">((<span class="id" title="var">x</span>,<span class="id" title="var">vx</span>)::<span class="id" title="var">nil</span>)</span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">Q'</span></span>.

<div class="paragraph"> </div>

    It therefore makes sense, in our definition of the predicate
    <span class="inlinecode"><span class="id" title="var">wpgen</span></span> <span class="inlinecode">(<span class="id" title="var">trm_fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span>)</span> <span class="inlinecode"><span class="id" title="var">Q</span></span>, which we said would take the form
    <span class="inlinecode">\<span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">vf</span>,</span> <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">vf</span>]</span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode"><span class="id" title="var">vf</span></span>, to define <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">vf</span></span> as:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">vx</span> <span class="id" title="var">H'</span> <span class="id" title="var">Q'</span>, (<span class="id" title="var">H'</span> ==&gt; <span class="id" title="var">wpgen</span> ((<span class="id" title="var">x</span>,<span class="id" title="var">vx</span>)::<span class="id" title="var">nil</span>) <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">Q'</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">triple</span> (<span class="id" title="var">trm_app</span> <span class="id" title="var">vf</span> <span class="id" title="var">vx</span>) <span class="id" title="var">H'</span> <span class="id" title="var">Q'</span>
</span>    This proposition can be slightly simplified, by using <span class="inlinecode"><span class="id" title="var">wp</span></span> instead
    of <span class="inlinecode"><span class="id" title="var">triple</span></span>, allowing to eliminate <span class="inlinecode"><span class="id" title="var">H'</span></span>. We thus define <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">vf</span></span> as:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">vx</span> <span class="id" title="var">H'</span>, <span class="id" title="var">wpgen</span> ((<span class="id" title="var">x</span>,<span class="id" title="var">vx</span>)::<span class="id" title="var">nil</span>) <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">Q'</span> ==&gt; <span class="id" title="var">wp</span> (<span class="id" title="var">trm_app</span> <span class="id" title="var">vf</span> <span class="id" title="var">vx</span>) <span class="id" title="var">Q'</span>
</span>
<div class="paragraph"> </div>

 Overall, the definition of <span class="inlinecode"><span class="id" title="var">wpgen</span></span> <span class="inlinecode"><span class="id" title="var">E</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> is as follows. Note that
    the occurence of <span class="inlinecode"><span class="id" title="var">nil</span></span> is replaced with <span class="inlinecode"><span class="id" title="var">E</span></span> to account for the
    case of a nonempty context.
<br/>
<span class="inlinecode">&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">wpgen</span> (<span class="id" title="var">E</span>:<span class="id" title="var">ctx</span>) (<span class="id" title="var">t</span>:<span class="id" title="var">trm</span>) : <span class="id" title="var">formula</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mkstruct</span> <span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">trm_fun</span> <span class="id" title="var">x</span> <span class="id" title="var">t<sub>1</sub></span> ⇒ <span class="id" title="keyword">fun</span> <span class="id" title="var">Q</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">P</span> <span class="id" title="var">vf</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">vx</span> <span class="id" title="var">H'</span>, <span class="id" title="var">wpgen</span> ((<span class="id" title="var">x</span>,<span class="id" title="var">vx</span>)::<span class="id" title="var">nil</span>) <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">Q'</span> ==&gt; <span class="id" title="var">wp</span> (<span class="id" title="var">trm_app</span> <span class="id" title="var">vf</span> <span class="id" title="var">vx</span>) <span class="id" title="var">Q'</span>) <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\<span class="id" title="keyword">∀</span> <span class="id" title="var">vf</span>, <span class='gray-font'>\</span>[<span class="id" title="var">P</span> <span class="id" title="var">vf</span>] <span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span> <span class="id" title="var">Q</span> <span class="id" title="var">vf</span><br/>
&nbsp;&nbsp;&nbsp;...<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.
</span>
<div class="paragraph"> </div>

 The actual definition of <span class="inlinecode"><span class="id" title="var">wpgen</span></span> exploits an intermediate definition
    called <span class="inlinecode"><span class="id" title="var">wpgen_fun</span></span>, as shown below:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">wpgen</span> (<span class="id" title="var">E</span>:<span class="id" title="var">ctx</span>) (<span class="id" title="var">t</span>:<span class="id" title="var">trm</span>) : <span class="id" title="var">formula</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mkstruct</span> <span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">trm_fun</span> <span class="id" title="var">x</span> <span class="id" title="var">t<sub>1</sub></span> ⇒ <span class="id" title="var">wpgen_fun</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">vx</span> ⇒ <span class="id" title="var">wpgen</span> ((<span class="id" title="var">x</span>,<span class="id" title="var">vx</span>)::<span class="id" title="var">E</span>) <span class="id" title="var">t<sub>1</sub></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.
</span>    where <span class="inlinecode"><span class="id" title="var">wpgen_fun</span></span> is defined as follows:

</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="WPgenRec.wpgen_fun" class="idref" href="#WPgenRec.wpgen_fun"><span class="id" title="definition">wpgen_fun</span></a> (<a id="Fof:104" class="idref" href="#Fof:104"><span class="id" title="binder">Fof</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#formula"><span class="id" title="definition">formula</span></a>) : <a class="idref" href="LibSepReference.html#formula"><span class="id" title="definition">formula</span></a> := <span class="id" title="keyword">fun</span> <a id="Q:105" class="idref" href="#Q:105"><span class="id" title="binder">Q</span></a> ⇒<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">∀</span></a> <a id="vf:106" class="idref" href="#vf:106"><span class="id" title="binder">vf</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><span class="id" title="keyword">∀</span> <a id="vx:107" class="idref" href="#vx:107"><span class="id" title="binder">vx</span></a> <a id="Q':108" class="idref" href="#Q':108"><span class="id" title="binder">Q'</span></a>, <a class="idref" href="Wand.html#Fof:104"><span class="id" title="variable">Fof</span></a> <a class="idref" href="Wand.html#vx:107"><span class="id" title="variable">vx</span></a> <a class="idref" href="Wand.html#Q':108"><span class="id" title="variable">Q'</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="Wand.html#vf:106"><span class="id" title="variable">vf</span></a> <a class="idref" href="Wand.html#vx:107"><span class="id" title="variable">vx</span></a>) <a class="idref" href="Wand.html#Q':108"><span class="id" title="variable">Q'</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q:105"><span class="id" title="variable">Q</span></a> <a class="idref" href="Wand.html#vf:106"><span class="id" title="variable">vf</span></a>.<br/>
</div>

<div class="doc">
The soundness lemma for this construct follows from the wp-style
    reasoning rule for applications, called <span class="inlinecode"><span class="id" title="var">wp_app_fun</span></span>, introduced in
    chapter <a href="WPsem.html"><span class="inlineref">WPsem</span></a>. It is not needed to follow at this stage through
    the details of the proof. (The proof involves lemmas about <span class="inlinecode">\<span class="id" title="keyword">∀</span></span>
    and about <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> that are stated and proved only further on in this
    chapter.) 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WPgenRec.wpgen_fun_sound" class="idref" href="#WPgenRec.wpgen_fun_sound"><span class="id" title="lemma">wpgen_fun_sound</span></a> : <span class="id" title="keyword">∀</span> <a id="x:109" class="idref" href="#x:109"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:110" class="idref" href="#t<sub>1</sub>:110"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="Fof:111" class="idref" href="#Fof:111"><span class="id" title="binder">Fof</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="vx:112" class="idref" href="#vx:112"><span class="id" title="binder">vx</span></a>, <a class="idref" href="LibSepReference.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Wand.html#x:109"><span class="id" title="variable">x</span></a> <a class="idref" href="Wand.html#vx:112"><span class="id" title="variable">vx</span></a> <a class="idref" href="Wand.html#t<sub>1</sub>:110"><span class="id" title="variable">t<sub>1</sub></span></a>) (<a class="idref" href="Wand.html#Fof:111"><span class="id" title="variable">Fof</span></a> <a class="idref" href="Wand.html#vx:112"><span class="id" title="variable">vx</span></a>)<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a class="idref" href="LibSepReference.html#trm_fun"><span class="id" title="constructor">trm_fun</span></a> <a class="idref" href="Wand.html#x:109"><span class="id" title="variable">x</span></a> <a class="idref" href="Wand.html#t<sub>1</sub>:110"><span class="id" title="variable">t<sub>1</sub></span></a>) (<a class="idref" href="Wand.html#WPgenRec.wpgen_fun"><span class="id" title="definition">wpgen_fun</span></a> <a class="idref" href="Wand.html#Fof:111"><span class="id" title="variable">Fof</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span>. <span class="id" title="var">unfolds</span> <a class="idref" href="Wand.html#WPgenRec.wpgen_fun"><span class="id" title="definition">wpgen_fun</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_hforall_l"><span class="id" title="lemma">himpl_hforall_l</span></a> (<a class="idref" href="LibSepReference.html#val_fun"><span class="id" title="constructor">val_fun</span></a> <span class="id" title="var">x</span> <span class="id" title="var">t<sub>1</sub></span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">xchange</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hwand_hpure_l"><span class="id" title="lemma">hwand_hpure_l</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans_r"><span class="id" title="lemma">himpl_trans_r</span></a>. { <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#wp_app_fun"><span class="id" title="lemma">wp_app_fun</span></a>. } { <span class="id" title="var">applys</span>* <span class="id" title="var">M</span>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#wp_fun"><span class="id" title="lemma">wp_fun</span></a>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
When we carry out the proof of soundness for the new version of <span class="inlinecode"><span class="id" title="var">wpgen</span></span>
    that features <span class="inlinecode"><span class="id" title="var">wpgen_fun</span></span>, we obtain the following new proof obligation.
    (To see it, play the proof of lemma <span class="inlinecode"><span class="id" title="var">wpgen_sound</span></span>,
    in file <span class="inlinecode"><span class="id" title="var">LibSepDirect.v</span></span>.) 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WPgenRec.wpgen_fun_proof_obligation" class="idref" href="#WPgenRec.wpgen_fun_proof_obligation"><span class="id" title="lemma">wpgen_fun_proof_obligation</span></a> : <span class="id" title="keyword">∀</span> <a id="E:113" class="idref" href="#E:113"><span class="id" title="binder">E</span></a> <a id="x:114" class="idref" href="#x:114"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:115" class="idref" href="#t<sub>1</sub>:115"><span class="id" title="binder">t<sub>1</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="E:116" class="idref" href="#E:116"><span class="id" title="binder">E</span></a>, <a class="idref" href="LibSepReference.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a class="idref" href="LibSepReference.html#isubst"><span class="id" title="definition">isubst</span></a> <a class="idref" href="Wand.html#E:116"><span class="id" title="variable">E</span></a> <a class="idref" href="Wand.html#t<sub>1</sub>:115"><span class="id" title="variable">t<sub>1</sub></span></a>) (<a class="idref" href="LibSepReference.html#wpgen"><span class="id" title="definition">wpgen</span></a> <a class="idref" href="Wand.html#E:116"><span class="id" title="variable">E</span></a> <a class="idref" href="Wand.html#t<sub>1</sub>:115"><span class="id" title="variable">t<sub>1</sub></span></a>)<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a class="idref" href="LibSepReference.html#trm_fun"><span class="id" title="constructor">trm_fun</span></a> <a class="idref" href="Wand.html#x:114"><span class="id" title="variable">x</span></a> (<a class="idref" href="LibSepReference.html#isubst"><span class="id" title="definition">isubst</span></a> (<a class="idref" href="LibSepReference.html#rem"><span class="id" title="definition">rem</span></a> <a class="idref" href="Wand.html#x:114"><span class="id" title="variable">x</span></a> <a class="idref" href="Wand.html#E:113"><span class="id" title="variable">E</span></a>) <a class="idref" href="Wand.html#t<sub>1</sub>:115"><span class="id" title="variable">t<sub>1</sub></span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Wand.html#WPgenRec.wpgen_fun"><span class="id" title="definition">wpgen_fun</span></a> (<span class="id" title="keyword">fun</span> <a id="v:117" class="idref" href="#v:117"><span class="id" title="binder">v</span></a> ⇒ <a class="idref" href="LibSepReference.html#wpgen"><span class="id" title="definition">wpgen</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#x:114"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Wand.html#v:117"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="Wand.html#E:113"><span class="id" title="variable">E</span></a>) <a class="idref" href="Wand.html#t<sub>1</sub>:115"><span class="id" title="variable">t<sub>1</sub></span></a>)).<br/>
</div>

<div class="doc">
The proof exploits the lemma <span class="inlinecode"><span class="id" title="var">wpgen_fun_sound</span></span> that we just established,
    as well as a substitution lemma, the same as the one used to justify the
    soundness of the <span class="inlinecode"><span class="id" title="var">wpgen</span></span> of a let-binding. 
</div>
<div class="code">

<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">IH</span>. <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#WPgenRec.wpgen_fun_sound"><span class="id" title="lemma">wpgen_fun_sound</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">vx</span>. <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="LibSepReference.html#isubst_rem"><span class="id" title="lemma">isubst_rem</span></a>. <span class="id" title="var">applys</span> <span class="id" title="var">IH</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Like for other auxiliary functions associated with <span class="inlinecode"><span class="id" title="var">wpgen</span></span>, we introduce
    a custom notation for <span class="inlinecode"><span class="id" title="var">wpgen_fun</span></span>. Here, we let <span class="inlinecode"><span class="id" title="var">Fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">F</span></span> stand for
    <span class="inlinecode"><span class="id" title="var">wpgen_fun</span></span> <span class="inlinecode">(<span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">F</span>)</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Notation</span> <a id="a72f42993dcbd144b3dcd14bb8c0feaa" class="idref" href="#a72f42993dcbd144b3dcd14bb8c0feaa"><span class="id" title="notation">&quot;</span></a>'Fun' x ':=' F<sub>1</sub>" :=<br/>
&nbsp;&nbsp;((<a class="idref" href="Wand.html#WPgenRec.wpgen_fun"><span class="id" title="definition">wpgen_fun</span></a> (<span class="id" title="keyword">fun</span> <a id="x:118" class="idref" href="#x:118"><span class="id" title="binder">x</span></a> ⇒ <span class="id" title="var">F<sub>1</sub></span>)))<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 69, <span class="id" title="var">x</span> <span class="id" title="var">ident</span>, <span class="id" title="tactic">right</span> <span class="id" title="keyword">associativity</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">format</span> "'[v' '[' 'Fun'  x  ':='  F<sub>1</sub>  ']' ']'").<br/>
</div>

<div class="doc">
<a id="lab318"></a><h3 class="section">2. Treatment of Recursive Functions</h3>

<div class="paragraph"> </div>

 The formula produced by <span class="inlinecode"><span class="id" title="var">wpgen</span></span> for a recursive function <span class="inlinecode"><span class="id" title="var">trm_fix</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>
    is almost the same as for a non-recursive function, the main difference
    being that we need to add a binding in the context to associate the name <span class="inlinecode"><span class="id" title="var">f</span></span>
    of the recursive function with the value <span class="inlinecode"><span class="id" title="var">vf</span></span> that corresponds to the
    recursive function.

<div class="paragraph"> </div>

    Here again, the heap predicate <span class="inlinecode"><span class="id" title="var">wpgen</span></span> <span class="inlinecode">(<span class="id" title="var">trm_fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span>)</span> <span class="inlinecode"><span class="id" title="var">Q</span></span> will be of the
    form <span class="inlinecode">\<span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">vf</span>,</span> <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">vf</span>]</span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode"><span class="id" title="var">vf</span></span>.

<div class="paragraph"> </div>

    To figure out the details of the statement of <span class="inlinecode"><span class="id" title="var">P</span></span>, recall from <span class="inlinecode"><span class="id" title="var">WPgen</span></span>
    the statement of <span class="inlinecode"><span class="id" title="var">triple_app_fix_from_wpgen</span></span>, which is useful for reasoning
    about top-level recursive functions. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="WPgenRec.triple_app_fix_from_wpgen" class="idref" href="#WPgenRec.triple_app_fix_from_wpgen"><span class="id" title="axiom">triple_app_fix_from_wpgen</span></a> : <span class="id" title="keyword">∀</span> <a id="vf:119" class="idref" href="#vf:119"><span class="id" title="binder">vf</span></a> <a id="vx:120" class="idref" href="#vx:120"><span class="id" title="binder">vx</span></a> <a id="f:121" class="idref" href="#f:121"><span class="id" title="binder">f</span></a> <a id="x:122" class="idref" href="#x:122"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:123" class="idref" href="#t<sub>1</sub>:123"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="H':124" class="idref" href="#H':124"><span class="id" title="binder">H'</span></a> <a id="Q':125" class="idref" href="#Q':125"><span class="id" title="binder">Q'</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#vf:119"><span class="id" title="variable">vf</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_fix"><span class="id" title="constructor">val_fix</span></a> <a class="idref" href="Wand.html#f:121"><span class="id" title="variable">f</span></a> <a class="idref" href="Wand.html#x:122"><span class="id" title="variable">x</span></a> <a class="idref" href="Wand.html#t<sub>1</sub>:123"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H':124"><span class="id" title="variable">H'</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#wpgen"><span class="id" title="definition">wpgen</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#f:121"><span class="id" title="variable">f</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Wand.html#vf:119"><span class="id" title="variable">vf</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#x:122"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Wand.html#vx:120"><span class="id" title="variable">vx</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>) <a class="idref" href="Wand.html#t<sub>1</sub>:123"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Wand.html#Q':125"><span class="id" title="variable">Q'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="Wand.html#vf:119"><span class="id" title="variable">vf</span></a> <a class="idref" href="Wand.html#vx:120"><span class="id" title="variable">vx</span></a>) <a class="idref" href="Wand.html#H':124"><span class="id" title="variable">H'</span></a> <a class="idref" href="Wand.html#Q':125"><span class="id" title="variable">Q'</span></a>.<br/>
</div>

<div class="doc">
It therefore makes sense to define <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">vf</span></span> as:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">vx</span> <span class="id" title="var">H'</span> <span class="id" title="var">Q'</span>, (<span class="id" title="var">H'</span> ==&gt; <span class="id" title="var">wpgen</span> ((<span class="id" title="var">f</span>,<span class="id" title="var">vf</span>)::(<span class="id" title="var">x</span>,<span class="id" title="var">vx</span>)::<span class="id" title="var">nil</span>) <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">Q'</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">triple</span> (<span class="id" title="var">trm_app</span> <span class="id" title="var">vf</span> <span class="id" title="var">vx</span>) <span class="id" title="var">H'</span> <span class="id" title="var">Q'</span>
</span>    which can be rewritten as:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">vx</span> <span class="id" title="var">H'</span>, <span class="id" title="var">wpgen</span> ((<span class="id" title="var">f</span>,<span class="id" title="var">vf</span>)::(<span class="id" title="var">x</span>,<span class="id" title="var">vx</span>)::<span class="id" title="var">nil</span>) <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">Q'</span> ==&gt; <span class="id" title="var">wp</span> (<span class="id" title="var">trm_app</span> <span class="id" title="var">vf</span> <span class="id" title="var">vx</span>) <span class="id" title="var">Q'</span>
</span>    We thus consider:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">wpgen</span> (<span class="id" title="var">E</span>:<span class="id" title="var">ctx</span>) (<span class="id" title="var">t</span>:<span class="id" title="var">trm</span>) : <span class="id" title="var">formula</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mkstruct</span> <span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| ..<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">trm_fix</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">t<sub>1</sub></span> ⇒ <span class="id" title="var">wpgen_fix</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">vf</span> <span class="id" title="var">v</span> ⇒ <span class="id" title="var">wpgen</span> ((<span class="id" title="var">f</span>,<span class="id" title="var">vf</span>)::(<span class="id" title="var">x</span>,<span class="id" title="var">v</span>)::<span class="id" title="var">E</span>) <span class="id" title="var">t<sub>1</sub></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| ..<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>
</span>    with the following definition for <span class="inlinecode"><span class="id" title="var">wpgen_fix</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="WPgenRec.wpgen_fix" class="idref" href="#WPgenRec.wpgen_fix"><span class="id" title="definition">wpgen_fix</span></a> (<a id="Fof:127" class="idref" href="#Fof:127"><span class="id" title="binder">Fof</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#formula"><span class="id" title="definition">formula</span></a>) : <a class="idref" href="LibSepReference.html#formula"><span class="id" title="definition">formula</span></a> := <span class="id" title="keyword">fun</span> <a id="Q:128" class="idref" href="#Q:128"><span class="id" title="binder">Q</span></a> ⇒<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">∀</span></a> <a id="vf:129" class="idref" href="#vf:129"><span class="id" title="binder">vf</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><span class="id" title="keyword">∀</span> <a id="vx:130" class="idref" href="#vx:130"><span class="id" title="binder">vx</span></a> <a id="Q':131" class="idref" href="#Q':131"><span class="id" title="binder">Q'</span></a>, <a class="idref" href="Wand.html#Fof:127"><span class="id" title="variable">Fof</span></a> <a class="idref" href="Wand.html#vf:129"><span class="id" title="variable">vf</span></a> <a class="idref" href="Wand.html#vx:130"><span class="id" title="variable">vx</span></a> <a class="idref" href="Wand.html#Q':131"><span class="id" title="variable">Q'</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="Wand.html#vf:129"><span class="id" title="variable">vf</span></a> <a class="idref" href="Wand.html#vx:130"><span class="id" title="variable">vx</span></a>) <a class="idref" href="Wand.html#Q':131"><span class="id" title="variable">Q'</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q:128"><span class="id" title="variable">Q</span></a> <a class="idref" href="Wand.html#vf:129"><span class="id" title="variable">vf</span></a>.<br/>
</div>

<div class="doc">
The soundness lemma for <span class="inlinecode"><span class="id" title="var">wpgen_fix</span></span> is very similar to that of <span class="inlinecode"><span class="id" title="var">wpgen_fun</span></span>.
    Again, it is not needed to follow through the details of this proof. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WPgenRec.wpgen_fix_sound" class="idref" href="#WPgenRec.wpgen_fix_sound"><span class="id" title="lemma">wpgen_fix_sound</span></a> : <span class="id" title="keyword">∀</span> <a id="f:132" class="idref" href="#f:132"><span class="id" title="binder">f</span></a> <a id="x:133" class="idref" href="#x:133"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:134" class="idref" href="#t<sub>1</sub>:134"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="Fof:135" class="idref" href="#Fof:135"><span class="id" title="binder">Fof</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="vf:136" class="idref" href="#vf:136"><span class="id" title="binder">vf</span></a> <a id="vx:137" class="idref" href="#vx:137"><span class="id" title="binder">vx</span></a>, <a class="idref" href="LibSepReference.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Wand.html#x:133"><span class="id" title="variable">x</span></a> <a class="idref" href="Wand.html#vx:137"><span class="id" title="variable">vx</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Wand.html#f:132"><span class="id" title="variable">f</span></a> <a class="idref" href="Wand.html#vf:136"><span class="id" title="variable">vf</span></a> <a class="idref" href="Wand.html#t<sub>1</sub>:134"><span class="id" title="variable">t<sub>1</sub></span></a>)) (<a class="idref" href="Wand.html#Fof:135"><span class="id" title="variable">Fof</span></a> <a class="idref" href="Wand.html#vf:136"><span class="id" title="variable">vf</span></a> <a class="idref" href="Wand.html#vx:137"><span class="id" title="variable">vx</span></a>)<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a class="idref" href="LibSepReference.html#trm_fix"><span class="id" title="constructor">trm_fix</span></a> <a class="idref" href="Wand.html#f:132"><span class="id" title="variable">f</span></a> <a class="idref" href="Wand.html#x:133"><span class="id" title="variable">x</span></a> <a class="idref" href="Wand.html#t<sub>1</sub>:134"><span class="id" title="variable">t<sub>1</sub></span></a>) (<a class="idref" href="Wand.html#WPgenRec.wpgen_fix"><span class="id" title="definition">wpgen_fix</span></a> <a class="idref" href="Wand.html#Fof:135"><span class="id" title="variable">Fof</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span>. <span class="id" title="var">unfolds</span> <a class="idref" href="Wand.html#WPgenRec.wpgen_fix"><span class="id" title="definition">wpgen_fix</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_hforall_l"><span class="id" title="lemma">himpl_hforall_l</span></a> (<a class="idref" href="LibSepReference.html#val_fix"><span class="id" title="constructor">val_fix</span></a> <span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">t<sub>1</sub></span>). <span class="id" title="var">xchange</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hwand_hpure_l"><span class="id" title="lemma">hwand_hpure_l</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans_r"><span class="id" title="lemma">himpl_trans_r</span></a>. { <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#wp_app_fix"><span class="id" title="lemma">wp_app_fix</span></a>. } { <span class="id" title="var">applys</span>* <span class="id" title="var">M</span>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#wp_fix"><span class="id" title="lemma">wp_fix</span></a>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The proof of soundness of <span class="inlinecode"><span class="id" title="var">wpgen</span></span> involves the following proof obligation
    to handle the case of recursive functions. (To see it, play the proof of
    lemma <span class="inlinecode"><span class="id" title="var">wpgen_sound</span></span>, in file <span class="inlinecode"><span class="id" title="var">LibSepDirect.v</span></span>.) 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WPgenRec.wpgen_fix_proof_obligation" class="idref" href="#WPgenRec.wpgen_fix_proof_obligation"><span class="id" title="lemma">wpgen_fix_proof_obligation</span></a> : <span class="id" title="keyword">∀</span> <a id="E:138" class="idref" href="#E:138"><span class="id" title="binder">E</span></a> <a id="f:139" class="idref" href="#f:139"><span class="id" title="binder">f</span></a> <a id="x:140" class="idref" href="#x:140"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:141" class="idref" href="#t<sub>1</sub>:141"><span class="id" title="binder">t<sub>1</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="E:142" class="idref" href="#E:142"><span class="id" title="binder">E</span></a>, <a class="idref" href="LibSepReference.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a class="idref" href="LibSepReference.html#isubst"><span class="id" title="definition">isubst</span></a> <a class="idref" href="Wand.html#E:142"><span class="id" title="variable">E</span></a> <a class="idref" href="Wand.html#t<sub>1</sub>:141"><span class="id" title="variable">t<sub>1</sub></span></a>) (<a class="idref" href="LibSepReference.html#wpgen"><span class="id" title="definition">wpgen</span></a> <a class="idref" href="Wand.html#E:142"><span class="id" title="variable">E</span></a> <a class="idref" href="Wand.html#t<sub>1</sub>:141"><span class="id" title="variable">t<sub>1</sub></span></a>)<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#formula_sound"><span class="id" title="definition">formula_sound</span></a> (<a class="idref" href="LibSepReference.html#trm_fix"><span class="id" title="constructor">trm_fix</span></a> <a class="idref" href="Wand.html#f:139"><span class="id" title="variable">f</span></a> <a class="idref" href="Wand.html#x:140"><span class="id" title="variable">x</span></a> (<a class="idref" href="LibSepReference.html#isubst"><span class="id" title="definition">isubst</span></a> (<a class="idref" href="LibSepReference.html#rem"><span class="id" title="definition">rem</span></a> <a class="idref" href="Wand.html#x:140"><span class="id" title="variable">x</span></a> (<a class="idref" href="LibSepReference.html#rem"><span class="id" title="definition">rem</span></a> <a class="idref" href="Wand.html#f:139"><span class="id" title="variable">f</span></a> <a class="idref" href="Wand.html#E:138"><span class="id" title="variable">E</span></a>)) <a class="idref" href="Wand.html#t<sub>1</sub>:141"><span class="id" title="variable">t<sub>1</sub></span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Wand.html#WPgenRec.wpgen_fix"><span class="id" title="definition">wpgen_fix</span></a> (<span class="id" title="keyword">fun</span> <a id="vf:143" class="idref" href="#vf:143"><span class="id" title="binder">vf</span></a> <a id="vx:144" class="idref" href="#vx:144"><span class="id" title="binder">vx</span></a> ⇒ <a class="idref" href="LibSepReference.html#wpgen"><span class="id" title="definition">wpgen</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#f:139"><span class="id" title="variable">f</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Wand.html#vf:143"><span class="id" title="variable">vf</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#x:140"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Wand.html#vx:144"><span class="id" title="variable">vx</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="Wand.html#E:138"><span class="id" title="variable">E</span></a>) <a class="idref" href="Wand.html#t<sub>1</sub>:141"><span class="id" title="variable">t<sub>1</sub></span></a>)).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">IH</span>. <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#WPgenRec.wpgen_fix_sound"><span class="id" title="lemma">wpgen_fix_sound</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">vf</span> <span class="id" title="var">vx</span>. <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="LibSepReference.html#isubst_rem_2"><span class="id" title="lemma">isubst_rem_2</span></a>. <span class="id" title="var">applys</span> <span class="id" title="var">IH</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Here again, we introduce a piece of notation for <span class="inlinecode"><span class="id" title="var">wpgen_fix</span></span>. We let
    <span class="inlinecode"><span class="id" title="keyword">Fix</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">F</span></span> stand for <span class="inlinecode"><span class="id" title="var">wpgen_fix</span></span> <span class="inlinecode">(<span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">F</span>)</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Notation</span> <a id="4c5078ddaf826ed91da3bc8edba85b8b" class="idref" href="#4c5078ddaf826ed91da3bc8edba85b8b"><span class="id" title="notation">&quot;</span></a>'Fix' f x ':=' F<sub>1</sub>" :=<br/>
&nbsp;&nbsp;((<a class="idref" href="Wand.html#WPgenRec.wpgen_fix"><span class="id" title="definition">wpgen_fix</span></a> (<span class="id" title="keyword">fun</span> <a id="f:145" class="idref" href="#f:145"><span class="id" title="binder">f</span></a> <a id="x:146" class="idref" href="#x:146"><span class="id" title="binder">x</span></a> ⇒ <span class="id" title="var">F<sub>1</sub></span>)))<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 69, <span class="id" title="var">f</span> <span class="id" title="var">ident</span>, <span class="id" title="var">x</span> <span class="id" title="var">ident</span>, <span class="id" title="tactic">right</span> <span class="id" title="keyword">associativity</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">format</span> "'[v' '[' 'Fix'  f  x  ':='  F<sub>1</sub>  ']' ']'").<br/>
</div>

<div class="doc">
Remark: similarly to <span class="inlinecode"><span class="id" title="var">xfun</span></span>, one could devise a <span class="inlinecode"><span class="id" title="var">xfix</span></span> tactic.
    We omit the details. 
</div>

<div class="doc">
<a id="lab319"></a><h3 class="section">3. Final Definition of <span class="inlinecode"><span class="id" title="var">wpgen</span></span>, with Processing a Local Functions</h3>

<div class="paragraph"> </div>

 The final definition of <span class="inlinecode"><span class="id" title="var">wpgen</span></span> appears below. 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <a id="WPgenRec.wpgen" class="idref" href="#WPgenRec.wpgen"><span class="id" title="definition">wpgen</span></a> (<a id="E:147" class="idref" href="#E:147"><span class="id" title="binder">E</span></a>:<a class="idref" href="LibSepReference.html#ctx"><span class="id" title="definition">ctx</span></a>) (<a id="t:148" class="idref" href="#t:148"><span class="id" title="binder">t</span></a>:<a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>) : <a class="idref" href="LibSepReference.html#formula"><span class="id" title="definition">formula</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#mkstruct"><span class="id" title="definition">mkstruct</span></a> <span class="id" title="keyword">match</span> <a class="idref" href="Wand.html#t:148"><span class="id" title="variable">t</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <span class="id" title="var">v</span> ⇒ <a class="idref" href="LibSepReference.html#wpgen_val"><span class="id" title="definition">wpgen_val</span></a> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;| <a class="idref" href="LibSepReference.html#trm_var"><span class="id" title="constructor">trm_var</span></a> <span class="id" title="var">x</span> ⇒ <a class="idref" href="LibSepReference.html#wpgen_var"><span class="id" title="definition">wpgen_var</span></a> <a class="idref" href="Wand.html#E:147"><span class="id" title="variable">E</span></a> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;| <a class="idref" href="LibSepReference.html#trm_fun"><span class="id" title="constructor">trm_fun</span></a> <span class="id" title="var">x</span> <span class="id" title="var">t<sub>1</sub></span> ⇒ <a class="idref" href="Wand.html#WPgenRec.wpgen_fun"><span class="id" title="definition">wpgen_fun</span></a> (<span class="id" title="keyword">fun</span> <a id="v:151" class="idref" href="#v:151"><span class="id" title="binder">v</span></a> ⇒ <a class="idref" href="Wand.html#wpgen:149"><span class="id" title="definition">wpgen</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">x</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Wand.html#v:151"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="Wand.html#E:147"><span class="id" title="variable">E</span></a>) <span class="id" title="var">t<sub>1</sub></span>)<br/>
&nbsp;&nbsp;| <a class="idref" href="LibSepReference.html#trm_fix"><span class="id" title="constructor">trm_fix</span></a> <span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">t<sub>1</sub></span> ⇒ <a class="idref" href="Wand.html#WPgenRec.wpgen_fix"><span class="id" title="definition">wpgen_fix</span></a> (<span class="id" title="keyword">fun</span> <a id="vf:152" class="idref" href="#vf:152"><span class="id" title="binder">vf</span></a> <a id="v:153" class="idref" href="#v:153"><span class="id" title="binder">v</span></a> ⇒ <a class="idref" href="Wand.html#wpgen:149"><span class="id" title="definition">wpgen</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">f</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Wand.html#vf:152"><span class="id" title="variable">vf</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">x</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Wand.html#v:153"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="Wand.html#E:147"><span class="id" title="variable">E</span></a>) <span class="id" title="var">t<sub>1</sub></span>)<br/>
&nbsp;&nbsp;| <a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> <span class="id" title="var">t<sub>0</sub></span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> ⇒ <a class="idref" href="LibSepReference.html#wpgen_if"><span class="id" title="definition">wpgen_if</span></a> <span class="id" title="var">t<sub>0</sub></span> (<a class="idref" href="Wand.html#wpgen:149"><span class="id" title="definition">wpgen</span></a> <a class="idref" href="Wand.html#E:147"><span class="id" title="variable">E</span></a> <span class="id" title="var">t<sub>1</sub></span>) (<a class="idref" href="Wand.html#wpgen:149"><span class="id" title="definition">wpgen</span></a> <a class="idref" href="Wand.html#E:147"><span class="id" title="variable">E</span></a> <span class="id" title="var">t<sub>2</sub></span>)<br/>
&nbsp;&nbsp;| <a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> ⇒ <a class="idref" href="LibSepReference.html#wpgen_seq"><span class="id" title="definition">wpgen_seq</span></a> (<a class="idref" href="Wand.html#wpgen:149"><span class="id" title="definition">wpgen</span></a> <a class="idref" href="Wand.html#E:147"><span class="id" title="variable">E</span></a> <span class="id" title="var">t<sub>1</sub></span>) (<a class="idref" href="Wand.html#wpgen:149"><span class="id" title="definition">wpgen</span></a> <a class="idref" href="Wand.html#E:147"><span class="id" title="variable">E</span></a> <span class="id" title="var">t<sub>2</sub></span>)<br/>
&nbsp;&nbsp;| <a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <span class="id" title="var">x</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> ⇒ <a class="idref" href="LibSepReference.html#wpgen_let"><span class="id" title="definition">wpgen_let</span></a> (<a class="idref" href="Wand.html#wpgen:149"><span class="id" title="definition">wpgen</span></a> <a class="idref" href="Wand.html#E:147"><span class="id" title="variable">E</span></a> <span class="id" title="var">t<sub>1</sub></span>) (<span class="id" title="keyword">fun</span> <a id="v:154" class="idref" href="#v:154"><span class="id" title="binder">v</span></a> ⇒ <a class="idref" href="Wand.html#wpgen:149"><span class="id" title="definition">wpgen</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">x</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><a class="idref" href="Wand.html#v:154"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">::</span><a class="idref" href="Wand.html#E:147"><span class="id" title="variable">E</span></a>) <span class="id" title="var">t<sub>2</sub></span>)<br/>
&nbsp;&nbsp;| <a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> ⇒ <a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#isubst"><span class="id" title="definition">isubst</span></a> <a class="idref" href="Wand.html#E:147"><span class="id" title="variable">E</span></a> <a class="idref" href="Wand.html#t:148"><span class="id" title="variable">t</span></a>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
The full soundness proof appears in file <span class="inlinecode"><span class="id" title="var">LibSepDirect</span></span>, lemma
    <span class="inlinecode"><span class="id" title="var">wpgen_sound</span></span>. 
</div>

<div class="doc">
<a id="lab320"></a><h3 class="section">4. Tactic to Reason About Functions</h3>

<div class="paragraph"> </div>

 Like for other language constructs, we introduce a custom tactic
    for <span class="inlinecode"><span class="id" title="var">wpgen_fun</span></span>. It is called <span class="inlinecode"><span class="id" title="var">xfun</span></span>, and helps the user to process a
    local function definition in the course of a verification script.

<div class="paragraph"> </div>

    The tactic <span class="inlinecode"><span class="id" title="var">xfun</span></span> can be invoked either with or without providing a
    specification for the local function. 
<div class="paragraph"> </div>

 First, we describe the tactic <span class="inlinecode"><span class="id" title="var">xfun</span></span> <span class="inlinecode"><span class="id" title="var">S</span></span>, where <span class="inlinecode"><span class="id" title="var">S</span></span> describes the
    specification of the local function. A typical call is of the form
    <span class="inlinecode"><span class="id" title="var">xfun</span></span> <span class="inlinecode">(<span class="id" title="keyword">fun</span></span> <span class="inlinecode">(<span class="id" title="var">f</span>:<span class="id" title="var">val</span>)</span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode">...,</span> <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode">(<span class="id" title="var">f</span></span> <span class="inlinecode">..)</span> <span class="inlinecode">..</span> <span class="inlinecode">..)</span>.

<div class="paragraph"> </div>

    The tactic <span class="inlinecode"><span class="id" title="var">xfun</span></span> <span class="inlinecode"><span class="id" title="var">S</span></span> generates two subgoals. The first one requires the
    user to establish the specification <span class="inlinecode"><span class="id" title="var">S</span></span> for the function whose body admits
    the weakest precondition <span class="inlinecode"><span class="id" title="var">Fof</span></span>. The second one requires the user to prove
    that the rest of the program is correct, in a context where the local
    function can be assumed to satisfy the specification <span class="inlinecode"><span class="id" title="var">S</span></span>.

<div class="paragraph"> </div>

    The definition of <span class="inlinecode"><span class="id" title="var">xfun</span></span> <span class="inlinecode"><span class="id" title="var">S</span></span> appears next. It is not required to understand
    the details. An example use case appears further on. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WPgenRec.xfun_spec_lemma" class="idref" href="#WPgenRec.xfun_spec_lemma"><span class="id" title="lemma">xfun_spec_lemma</span></a> : <span class="id" title="keyword">∀</span> (<a id="S:155" class="idref" href="#S:155"><span class="id" title="binder">S</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><span class="id" title="keyword">Prop</span>) <a id="H:156" class="idref" href="#H:156"><span class="id" title="binder">H</span></a> <a id="Q:157" class="idref" href="#Q:157"><span class="id" title="binder">Q</span></a> <a id="Fof:158" class="idref" href="#Fof:158"><span class="id" title="binder">Fof</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="vf:159" class="idref" href="#vf:159"><span class="id" title="binder">vf</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="vx:160" class="idref" href="#vx:160"><span class="id" title="binder">vx</span></a> <a id="H':161" class="idref" href="#H':161"><span class="id" title="binder">H'</span></a> <a id="Q':162" class="idref" href="#Q':162"><span class="id" title="binder">Q'</span></a>, <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H':161"><span class="id" title="variable">H'</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#Fof:158"><span class="id" title="variable">Fof</span></a> <a class="idref" href="Wand.html#vx:160"><span class="id" title="variable">vx</span></a> <a class="idref" href="Wand.html#Q':162"><span class="id" title="variable">Q'</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="Wand.html#vf:159"><span class="id" title="variable">vf</span></a> <a class="idref" href="Wand.html#vx:160"><span class="id" title="variable">vx</span></a>) <a class="idref" href="Wand.html#H':161"><span class="id" title="variable">H'</span></a> <a class="idref" href="Wand.html#Q':162"><span class="id" title="variable">Q'</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Wand.html#S:155"><span class="id" title="variable">S</span></a> <a class="idref" href="Wand.html#vf:159"><span class="id" title="variable">vf</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="vf:163" class="idref" href="#vf:163"><span class="id" title="binder">vf</span></a>, <a class="idref" href="Wand.html#S:155"><span class="id" title="variable">S</span></a> <a class="idref" href="Wand.html#vf:163"><span class="id" title="variable">vf</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H:156"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#Q:157"><span class="id" title="variable">Q</span></a> <a class="idref" href="Wand.html#vf:163"><span class="id" title="variable">vf</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">))</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H:156"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#WPgenRec.wpgen_fun"><span class="id" title="definition">wpgen_fun</span></a> <a class="idref" href="Wand.html#Fof:158"><span class="id" title="variable">Fof</span></a> <a class="idref" href="Wand.html#Q:157"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Wand.html#WPgenRec.wpgen_fun"><span class="id" title="definition">wpgen_fun</span></a>. <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">vf</span> <span class="id" title="var">N</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="var">applys</span> <span class="id" title="var">M<sub>1</sub></span>. <span class="id" title="var">introv</span> <span class="id" title="var">K</span>. <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="LibSepReference.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="var">xchange</span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span> <span class="id" title="var">N</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Tactic Notation</span> "xfun" <span class="id" title="keyword">constr</span>(<span class="id" title="var">S</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">xseq_xlet_if_needed</span>; <span class="id" title="var">xstruct_if_needed</span>; <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#WPgenRec.xfun_spec_lemma"><span class="id" title="lemma">xfun_spec_lemma</span></a> <span class="id" title="var">S</span>.<br/>
</div>

<div class="doc">
Second, we describe the tactic <span class="inlinecode"><span class="id" title="var">xfun</span></span> without argument. It applies to a goal
    of the form <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wpgen_fun</span></span> <span class="inlinecode"><span class="id" title="var">Fof</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>. The tactic <span class="inlinecode"><span class="id" title="var">xfun</span></span> simply makes
    available an hypothesis about the local function. The user may subsequently
    exploit this hypothesis for reasoning about a call to that function, just
    like if the code of the function was inlined at its call site. The use of
    <span class="inlinecode"><span class="id" title="var">xfun</span></span> without argument is usually relevant only for local functions that
    are invoked exactly once (as is often the case for functions passed to
    higher-order iterators). Again, an example use case appears further on. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WPgenRec.xfun_nospec_lemma" class="idref" href="#WPgenRec.xfun_nospec_lemma"><span class="id" title="lemma">xfun_nospec_lemma</span></a> : <span class="id" title="keyword">∀</span> <a id="H:164" class="idref" href="#H:164"><span class="id" title="binder">H</span></a> <a id="Q:165" class="idref" href="#Q:165"><span class="id" title="binder">Q</span></a> <a id="Fof:166" class="idref" href="#Fof:166"><span class="id" title="binder">Fof</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="vf:167" class="idref" href="#vf:167"><span class="id" title="binder">vf</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="vx:168" class="idref" href="#vx:168"><span class="id" title="binder">vx</span></a> <a id="H':169" class="idref" href="#H':169"><span class="id" title="binder">H'</span></a> <a id="Q':170" class="idref" href="#Q':170"><span class="id" title="binder">Q'</span></a>, <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H':169"><span class="id" title="variable">H'</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#Fof:166"><span class="id" title="variable">Fof</span></a> <a class="idref" href="Wand.html#vx:168"><span class="id" title="variable">vx</span></a> <a class="idref" href="Wand.html#Q':170"><span class="id" title="variable">Q'</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="Wand.html#vf:167"><span class="id" title="variable">vf</span></a> <a class="idref" href="Wand.html#vx:168"><span class="id" title="variable">vx</span></a>) <a class="idref" href="Wand.html#H':169"><span class="id" title="variable">H'</span></a> <a class="idref" href="Wand.html#Q':170"><span class="id" title="variable">Q'</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H:164"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#Q:165"><span class="id" title="variable">Q</span></a> <a class="idref" href="Wand.html#vf:167"><span class="id" title="variable">vf</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">))</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H:164"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#WPgenRec.wpgen_fun"><span class="id" title="definition">wpgen_fun</span></a> <a class="idref" href="Wand.html#Fof:166"><span class="id" title="variable">Fof</span></a> <a class="idref" href="Wand.html#Q:165"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Wand.html#WPgenRec.wpgen_fun"><span class="id" title="definition">wpgen_fun</span></a>. <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">vf</span> <span class="id" title="var">N</span>. <span class="id" title="var">applys</span> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">K</span>. <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="LibSepReference.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="var">xchange</span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span> <span class="id" title="var">N</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Tactic Notation</span> "xfun" :=<br/>
&nbsp;&nbsp;<span class="id" title="var">xseq_xlet_if_needed</span>; <span class="id" title="var">xstruct_if_needed</span>; <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#WPgenRec.xfun_nospec_lemma"><span class="id" title="lemma">xfun_nospec_lemma</span></a>.<br/>
</div>

<div class="doc">
A generalization of <span class="inlinecode"><span class="id" title="var">xfun</span></span> that handles recursive functions may be defined
    following exactly the same pattern. 
<div class="paragraph"> </div>

 This completes our presentation of a version of <span class="inlinecode"><span class="id" title="var">wpgen</span></span> that recursively
    processes the local definition of non-recursive functions. An practical
    example is presented next. 
</div>

<div class="doc">
<a id="lab321"></a><h3 class="section">5. Example Computation of <span class="inlinecode"><span class="id" title="var">wpgen</span></span> in Presence of a Local Function</h3>

<div class="paragraph"> </div>

 In the example that follows, we assume all the set up from <span class="inlinecode"><span class="id" title="var">WPgen</span></span> to
    be reproduced with the definition of <span class="inlinecode"><span class="id" title="var">wpgen</span></span> that leverages <span class="inlinecode"><span class="id" title="var">wpgen_fun</span></span>
    and <span class="inlinecode"><span class="id" title="var">wpgen_fix</span></span>. This set up is formalized in full in the file
    <span class="inlinecode"><span class="id" title="var">LibSepDirect</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Import</span> <span class="id" title="var">DemoPrograms</span>.<br/>
</div>

<div class="doc">
Consider the following example program, which involves a local function
    definition, then two successive calls to that local function. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="WPgenRec.myfun" class="idref" href="#WPgenRec.myfun"><span class="id" title="definition">myfun</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#6de150166dc2b6b515065825fd7ae19d"><span class="id" title="notation">fun_</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''u'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''u'"><span class="id" title="notation">u</span></a> <a class="idref" href="LibSepReference.html#6de150166dc2b6b515065825fd7ae19d"><span class="id" title="notation">⇒</span></a> <a class="idref" href="LibSepReference.html#DemoPrograms.incr"><span class="id" title="definition">incr</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepReference.html#71337baa9b3f1f61552031a8e9cb9237"><span class="id" title="notation">()</span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepReference.html#71337baa9b3f1f61552031a8e9cb9237"><span class="id" title="notation">()</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
We first illustrate a call to <span class="inlinecode"><span class="id" title="var">xfun</span></span> with an explicit specification.
    Here, the function <span class="inlinecode"><span class="id" title="var">f</span></span> is specified as incrementing the reference <span class="inlinecode"><span class="id" title="var">p</span></span>.
    Observe that the body function of the function <span class="inlinecode"><span class="id" title="var">f</span></span> is verified only
    once. The reasoning about the two calls to the function <span class="inlinecode"><span class="id" title="var">f</span></span> that appears
    in the code are done with respect to the specification that we provide
    as argument to <span class="inlinecode"><span class="id" title="var">xfun</span></span> at the moment of the definition of <span class="inlinecode"><span class="id" title="var">f</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WPgenRec.triple_myfun" class="idref" href="#WPgenRec.triple_myfun"><span class="id" title="lemma">triple_myfun</span></a> : <span class="id" title="keyword">∀</span> (<a id="p:171" class="idref" href="#p:171"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) (<a id="n:172" class="idref" href="#n:172"><span class="id" title="binder">n</span></a>:<span class="id" title="notation">int</span>),<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="Wand.html#WPgenRec.myfun"><span class="id" title="definition">myfun</span></a> <a class="idref" href="Wand.html#p:171"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Wand.html#p:171"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#n:172"><span class="id" title="variable">n</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Wand.html#p:171"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#n:172"><span class="id" title="variable">n</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>2<a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">)</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xwp</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xfun</span> (<span class="id" title="keyword">fun</span> (<a id="f:175" class="idref" href="#f:175"><span class="id" title="binder">f</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) ⇒ <span class="id" title="keyword">∀</span> (<a id="m:176" class="idref" href="#m:176"><span class="id" title="binder">m</span></a>:<span class="id" title="notation">int</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Wand.html#f:173"><span class="id" title="variable">f</span></a><a class="idref" href="LibSepReference.html#3127c6bc552ca21a494fc6e3474a507d"><span class="id" title="notation">()</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">p</span> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#m:174"><span class="id" title="variable">m</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">p</span> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#m:174"><span class="id" title="variable">m</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1<a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">)</span></a>)); <span class="id" title="tactic">intros</span> <span class="id" title="var">f</span> <span class="id" title="var">Hf</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span> <span class="id" title="var">Hf</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">Hf</span>. <span class="id" title="var">xapp</span>. <span class="comment">(*&nbsp;exploits&nbsp;<span class="inlinecode"><span class="id" title="var">triple_incr</span></span>&nbsp;*)</span> <span class="id" title="var">xsimpl</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span>. <span class="comment">(*&nbsp;exploits&nbsp;<span class="inlinecode"><span class="id" title="var">Hf</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span>. <span class="comment">(*&nbsp;exploits&nbsp;<span class="inlinecode"><span class="id" title="var">Hf</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">n</span><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1) <span class="id" title="keyword">with</span> (<span class="id" title="var">n</span><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>2); [|<span class="id" title="var">math</span>]. <span class="id" title="var">xsimpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
We next illustrate a call to <span class="inlinecode"><span class="id" title="var">xfun</span></span> without argument. The "generic
    specification" that comes as hypothesis about the local function
    is a proposition that describes the behavior of the function in terms
    of the weakest-precondition of its body.

<div class="paragraph"> </div>

    When reasoning about a call to the function, one can invoke this
    generic specification. The effect is equivalent to that of inlining
    the code of the function at its call site.

<div class="paragraph"> </div>

    Here, there are two calls to the function. We will thus have to exploit
    twice the generic specification of <span class="inlinecode"><span class="id" title="var">f</span></span>, which corresponds to its body
    <span class="inlinecode"><span class="id" title="var">incr</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>. We will therefore have to reason twice about the increment
    function. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WPgenRec.triple_myfun'" class="idref" href="#WPgenRec.triple_myfun'"><span class="id" title="lemma">triple_myfun'</span></a> : <span class="id" title="keyword">∀</span> (<a id="p:177" class="idref" href="#p:177"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) (<a id="n:178" class="idref" href="#n:178"><span class="id" title="binder">n</span></a>:<span class="id" title="notation">int</span>),<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="Wand.html#WPgenRec.myfun"><span class="id" title="definition">myfun</span></a> <a class="idref" href="Wand.html#p:177"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Wand.html#p:177"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#n:178"><span class="id" title="variable">n</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Wand.html#p:177"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#n:178"><span class="id" title="variable">n</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>2<a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">)</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xwp</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xfun</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">f</span> <span class="id" title="var">Hf</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span>. <span class="comment">(*&nbsp;exploits&nbsp;<span class="inlinecode"><span class="id" title="var">Hf</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span>. <span class="comment">(*&nbsp;exploits&nbsp;<span class="inlinecode"><span class="id" title="var">triple_incr</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span>. <span class="comment">(*&nbsp;exploits&nbsp;<span class="inlinecode"><span class="id" title="var">Hf</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="var">xapp</span>. <span class="comment">(*&nbsp;exploits&nbsp;<span class="inlinecode"><span class="id" title="var">triple_incr</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">n</span><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1) <span class="id" title="keyword">with</span> (<span class="id" title="var">n</span><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>2); [|<span class="id" title="var">math</span>]. <span class="id" title="var">xsimpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="Wand.html#WPgenRec"><span class="id" title="module">WPgenRec</span></a>.<br/>
</div>

<div class="doc">
<a id="lab322"></a><h1 class="section">More Details</h1>

</div>

<div class="doc">
<a id="lab323"></a><h2 class="section">Benefits of the Ramified Rule over the Consequence-Frame Rule</h2>

<div class="paragraph"> </div>

 Earlier on, we sketched an argument claiming that the consequence-
    frame rule is not very well suited for carrying out proofs in
    practice, due to issues with working with evars for instantiating
    the heap predicate <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> in the rule. Let us come back to this point
    and describe the issue in depth on a concrete example, and show
    how the ramified frame rule smoothly handles that same example. 
</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="WandBenefits" class="idref" href="#WandBenefits"><span class="id" title="module">WandBenefits</span></a>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">WandDef</span>.<br/>
</div>

<div class="doc">
Recall the consequence-frame rule. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="WandBenefits.triple_conseq_frame" class="idref" href="#WandBenefits.triple_conseq_frame"><span class="id" title="axiom">triple_conseq_frame</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>2</sub>:179" class="idref" href="#H<sub>2</sub>:179"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="H<sub>1</sub>:180" class="idref" href="#H<sub>1</sub>:180"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="Q<sub>1</sub>:181" class="idref" href="#Q<sub>1</sub>:181"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="t:182" class="idref" href="#t:182"><span class="id" title="binder">t</span></a> <a id="H:183" class="idref" href="#H:183"><span class="id" title="binder">H</span></a> <a id="Q:184" class="idref" href="#Q:184"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Wand.html#t:182"><span class="id" title="variable">t</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:180"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#Q<sub>1</sub>:181"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H:183"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:180"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:179"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#Q<sub>1</sub>:181"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:179"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Wand.html#Q:184"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Wand.html#t:182"><span class="id" title="variable">t</span></a> <a class="idref" href="Wand.html#H:183"><span class="id" title="variable">H</span></a> <a class="idref" href="Wand.html#Q:184"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
One practical caveat with this rule is that we must resolve <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>,
    which corresponds to the difference between <span class="inlinecode"><span class="id" title="var">H</span></span> and <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span>.
    In practice, providing <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> explicitly is extremely tedious.
    The alternative is to leave <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> as an evar, and count on the
    fact that the tactic <span class="inlinecode"><span class="id" title="var">xsimpl</span></span>, when applied to <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>,
    will correctly instantiate <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>.

<div class="paragraph"> </div>

    This approach works in simple cases, but fails in particular in
    the case where <span class="inlinecode"><span class="id" title="var">H</span></span> contains an existential quantifier.
    For a concrete example, consider the specification of the
    function <span class="inlinecode"><span class="id" title="var">ref</span></span>, which allocates a reference. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="WandBenefits.triple_ref" class="idref" href="#WandBenefits.triple_ref"><span class="id" title="axiom">triple_ref</span></a> : <span class="id" title="keyword">∀</span> (<a id="v:186" class="idref" href="#v:186"><span class="id" title="binder">v</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_ref"><span class="id" title="constructor">val_ref</span></a> <a class="idref" href="Wand.html#v:186"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:189" class="idref" href="#p:189"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Wand.html#p:187"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#v:186"><span class="id" title="variable">v</span></a>).<br/>
</div>

<div class="doc">
Assume that wish to derive the following triple, which extends
    both the precondition and the postcondition of the above specification
    <span class="inlinecode"><span class="id" title="var">triple_ref</span></span> with the heap predicate <span class="inlinecode"><span class='gray-font'>\</span><span class="id" title="tactic">∃</span></span> <span class="inlinecode"><span class="id" title="var">l'</span></span> <span class="inlinecode"><span class="id" title="var">v'</span>,</span> <span class="inlinecode"><span class="id" title="var">l'</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">v'</span></span>.
    This predicate describes the existence of some, totally unspecified,
    reference cell. It is a bit artificial but illustrates well the issue. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandBenefits.triple_ref_extended" class="idref" href="#WandBenefits.triple_ref_extended"><span class="id" title="lemma">triple_ref_extended</span></a> : <span class="id" title="keyword">∀</span> (<a id="v:191" class="idref" href="#v:191"><span class="id" title="binder">v</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_ref"><span class="id" title="constructor">val_ref</span></a> <a class="idref" href="Wand.html#v:191"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="l':197" class="idref" href="#l':197"><span class="id" title="binder">l'</span></a> <a id="v':198" class="idref" href="#v':198"><span class="id" title="binder">v'</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Wand.html#l':197"><span class="id" title="variable">l'</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#v':198"><span class="id" title="variable">v'</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:194" class="idref" href="#p:194"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Wand.html#p:192"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#v:191"><span class="id" title="variable">v</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="l':195" class="idref" href="#l':195"><span class="id" title="binder">l'</span></a> <a id="v':196" class="idref" href="#v':196"><span class="id" title="binder">v'</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Wand.html#l':195"><span class="id" title="variable">l'</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#v':196"><span class="id" title="variable">v'</span></a>).<br/>
</div>

<div class="doc">
Let us prove that this specification is derivable from the
    original one, namely <span class="inlinecode"><span class="id" title="var">triple_ref</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#WandBenefits.triple_conseq_frame"><span class="id" title="axiom">triple_conseq_frame</span></a>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;observe&nbsp;the&nbsp;evar&nbsp;<span class="inlinecode">?<span class="id" title="var">H<sub>2</sub></span></span>&nbsp;that&nbsp;appears&nbsp;in&nbsp;the&nbsp;second&nbsp;and&nbsp;third&nbsp;subgoals&nbsp;*)</span><br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#WandBenefits.triple_ref"><span class="id" title="axiom">triple_ref</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="comment">(*&nbsp;here,&nbsp;<span class="inlinecode">?<span class="id" title="var">H<sub>2</sub></span></span>&nbsp;should&nbsp;be&nbsp;in&nbsp;theory&nbsp;instantiated&nbsp;with&nbsp;the&nbsp;LHS.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;but&nbsp;<span class="inlinecode"><span class="id" title="var">xsimpl</span></span>&nbsp;strategy&nbsp;is&nbsp;to&nbsp;first&nbsp;extract&nbsp;the&nbsp;quantifiers<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;the&nbsp;LHS.&nbsp;After&nbsp;that,&nbsp;the&nbsp;instantiation&nbsp;of&nbsp;<span class="inlinecode">?<span class="id" title="var">H<sub>2</sub></span></span>&nbsp;fails,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;because&nbsp;the&nbsp;LHS&nbsp;contains&nbsp;variables&nbsp;that&nbsp;are&nbsp;not&nbsp;defined&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;scope&nbsp;of&nbsp;the&nbsp;evar&nbsp;<span class="inlinecode">?<span class="id" title="var">H<sub>2</sub></span></span>&nbsp;at&nbsp;the&nbsp;time&nbsp;it&nbsp;was&nbsp;introduced.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xsimpl</span>.<br/>
<span class="id" title="keyword">Abort</span>.<br/>
</div>

<div class="doc">
Now, let us apply the ramified frame rule to carry out the same
    proof, and observe how the problem does not show up. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandBenefits.triple_ref_extended'" class="idref" href="#WandBenefits.triple_ref_extended'"><span class="id" title="lemma">triple_ref_extended'</span></a> : <span class="id" title="keyword">∀</span> (<a id="v:199" class="idref" href="#v:199"><span class="id" title="binder">v</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_ref"><span class="id" title="constructor">val_ref</span></a> <a class="idref" href="Wand.html#v:199"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="l':205" class="idref" href="#l':205"><span class="id" title="binder">l'</span></a> <a id="v':206" class="idref" href="#v':206"><span class="id" title="binder">v'</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Wand.html#l':205"><span class="id" title="variable">l'</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#v':206"><span class="id" title="variable">v'</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:202" class="idref" href="#p:202"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Wand.html#p:200"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#v:199"><span class="id" title="variable">v</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="l':203" class="idref" href="#l':203"><span class="id" title="binder">l'</span></a> <a id="v':204" class="idref" href="#v':204"><span class="id" title="binder">v'</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Wand.html#l':203"><span class="id" title="variable">l'</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#v':204"><span class="id" title="variable">v'</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#WandDef.triple_ramified_frame"><span class="id" title="lemma">triple_ramified_frame</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#WandBenefits.triple_ref"><span class="id" title="axiom">triple_ref</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Here&nbsp;again,&nbsp;<span class="inlinecode"><span class="id" title="var">xsimpl</span></span>&nbsp;strategy&nbsp;works&nbsp;on&nbsp;the&nbsp;LHS,&nbsp;and&nbsp;pulls&nbsp;out<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;existentially&nbsp;quantified&nbsp;variables.&nbsp;But&nbsp;it&nbsp;works&nbsp;here<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;because&nbsp;the&nbsp;remaining&nbsp;of&nbsp;the&nbsp;reasoning&nbsp;takes&nbsp;place&nbsp;in&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;same&nbsp;subgoal,&nbsp;in&nbsp;the&nbsp;scope&nbsp;of&nbsp;the&nbsp;extended&nbsp;Coq&nbsp;context.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">l'</span> <span class="id" title="var">v'</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="Wand.html#WandDef.qwand_equiv"><span class="id" title="lemma">qwand_equiv</span></a>. <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">auto</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="Wand.html#WandBenefits"><span class="id" title="module">WandBenefits</span></a>.<br/>
</div>

<div class="doc">
<a id="lab324"></a><h2 class="section">Properties of <span class="inlinecode"><span class="id" title="var">hwand</span></span></h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="WandProperties" class="idref" href="#WandProperties"><span class="id" title="module">WandProperties</span></a>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">WandDef</span>.<br/>
</div>

<div class="doc">
We next present the most important properties of <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>.

<div class="paragraph"> </div>

    Thereafter, the tactic <span class="inlinecode"><span class="id" title="var">xsimpl</span></span> is accessible, but in a form
    that does not provide support for the magic wand.

<div class="paragraph"> </div>

    The actual tactic would trivially solve many of these lemmas,
    but using it would be cheating because the implementation of
    <span class="inlinecode"><span class="id" title="var">xsimpl</span></span> relies on several of these lemmas. 
</div>

<div class="doc">
<a id="lab325"></a><h3 class="section">Structural Properties of <span class="inlinecode"><span class="id" title="var">hwand</span></span></h3>

<div class="paragraph"> </div>

 The operator <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> is contravariant in <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> and covariant
    in <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>, similarly to the implication operator <span class="inlinecode">→</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandProperties.hwand_himpl" class="idref" href="#WandProperties.hwand_himpl"><span class="id" title="lemma">hwand_himpl</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:207" class="idref" href="#H<sub>1</sub>:207"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>1</sub>':208" class="idref" href="#H<sub>1</sub>':208"><span class="id" title="binder">H<sub>1</sub>'</span></a> <a id="H<sub>2</sub>:209" class="idref" href="#H<sub>2</sub>:209"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="H<sub>2</sub>':210" class="idref" href="#H<sub>2</sub>':210"><span class="id" title="binder">H<sub>2</sub>'</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H<sub>1</sub>':208"><span class="id" title="variable">H<sub>1</sub>'</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:207"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H<sub>2</sub>:209"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>':210"><span class="id" title="variable">H<sub>2</sub>'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>1</sub>:207"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:209"><span class="id" title="variable">H<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>1</sub>':208"><span class="id" title="variable">H<sub>1</sub>'</span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H<sub>2</sub>':210"><span class="id" title="variable">H<sub>2</sub>'</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#WandDef.himpl_hwand_r"><span class="id" title="lemma">himpl_hwand_r</span></a>. <span class="id" title="var">xchange</span> <span class="id" title="var">M<sub>1</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xchange</span> (<a class="idref" href="Wand.html#WandDef.hwand_cancel"><span class="id" title="lemma">hwand_cancel</span></a> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>). <span class="id" title="var">applys</span> <span class="id" title="var">M<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Two predicates <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> ans <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span></span> may simplify
    to <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span></span>. This simplification is reminiscent of the
    arithmetic operation <span class="inlinecode">(-<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span>)</span> <span class="inlinecode">+</span> <span class="inlinecode">(-<span class="id" title="var">H<sub>2</sub></span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span>)</span> <span class="inlinecode">=</span> <span class="inlinecode">(-<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span>)</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandProperties.hwand_trans_elim" class="idref" href="#WandProperties.hwand_trans_elim"><span class="id" title="lemma">hwand_trans_elim</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:211" class="idref" href="#H<sub>1</sub>:211"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:212" class="idref" href="#H<sub>2</sub>:212"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="H<sub>3</sub>:213" class="idref" href="#H<sub>3</sub>:213"><span class="id" title="binder">H<sub>3</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>1</sub>:211"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:212"><span class="id" title="variable">H<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>2</sub>:212"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H<sub>3</sub>:213"><span class="id" title="variable">H<sub>3</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>1</sub>:211"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H<sub>3</sub>:213"><span class="id" title="variable">H<sub>3</sub></span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#WandDef.himpl_hwand_r"><span class="id" title="lemma">himpl_hwand_r</span></a>. <span class="id" title="var">xchange</span> (<a class="idref" href="Wand.html#WandDef.hwand_cancel"><span class="id" title="lemma">hwand_cancel</span></a> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The predicate <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> holds of the empty heap.
    Intuitively, one can rewrite <span class="inlinecode">0</span> as <span class="inlinecode">-<span class="id" title="var">H</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">H</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandProperties.himpl_hempty_hwand_same" class="idref" href="#WandProperties.himpl_hempty_hwand_same"><span class="id" title="lemma">himpl_hempty_hwand_same</span></a> : <span class="id" title="keyword">∀</span> <a id="H:214" class="idref" href="#H:214"><span class="id" title="binder">H</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H:214"><span class="id" title="variable">H</span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H:214"><span class="id" title="variable">H</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="Wand.html#WandDef.himpl_hwand_r"><span class="id" title="lemma">himpl_hwand_r</span></a>. <span class="id" title="var">xsimpl</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab326"></a><h3 class="section">Tempting Yet False Properties for <span class="inlinecode"><span class="id" title="var">hwand</span></span></h3>

<div class="paragraph"> </div>

 The reciprocal entailement <span class="inlinecode">(<span class="id" title="var">H</span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H</span>)</span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class='gray-font'>\</span>[]</span> is false, however.
    For a counterexample, instantiate <span class="inlinecode"><span class="id" title="var">H</span></span> as <span class="inlinecode"><span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">h</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">True</span></span>, or,
    equivalently, <span class="inlinecode"><span class='gray-font'>\</span><span class="id" title="tactic">∃</span></span> <span class="inlinecode"><span class="id" title="var">H'</span>,</span> <span class="inlinecode"><span class="id" title="var">H'</span></span>. A singleton heap does satisfy
    <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span>, although it clearly does not satisfy the empty
    predicate <span class="inlinecode"><span class='gray-font'>\</span>[]</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandProperties.himpl_hwand_same_hempty_counterexample" class="idref" href="#WandProperties.himpl_hwand_same_hempty_counterexample"><span class="id" title="lemma">himpl_hwand_same_hempty_counterexample</span></a> : <span class="id" title="keyword">∀</span> <a id="p:215" class="idref" href="#p:215"><span class="id" title="binder">p</span></a> <a id="v:216" class="idref" href="#v:216"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="H:218" class="idref" href="#H:218"><span class="id" title="binder">H</span></a> := (<a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="H':217" class="idref" href="#H':217"><span class="id" title="binder">H'</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Wand.html#H':217"><span class="id" title="variable">H'</span></a>) <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#p:215"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#v:216"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H:218"><span class="id" title="variable">H</span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H:218"><span class="id" title="variable">H</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">subst</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="Wand.html#WandDef.hwand_equiv"><span class="id" title="lemma">hwand_equiv</span></a>. <span class="id" title="var">xsimpl</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
In technical terms, <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> characterizes the empty heap only
    in the case where <span class="inlinecode"><span class="id" title="var">H</span></span> is "precise", that is, when it describes
    a heap of a specific shape. In the above counterexample, <span class="inlinecode"><span class="id" title="var">H</span></span> is
    clearly not precise, because it is satisfied by heaps of any shape.
    The notion of "preciseness" can be defined formally, yet it is
    out of the scope of this course. 
<div class="paragraph"> </div>

 As another tempting yet false property of the magic wand,
    consider the reciprocal entailment to the cancellation lemma,
    that is, <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode">(<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span>)</span>. It does not hold in general.

<div class="paragraph"> </div>

    As counter-example, consider <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class='gray-font'>\</span>[]</span> and <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">False</span>]</span>.
    We can prove that the empty heap does not satisfies
    <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">False</span>]</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode">(<span class='gray-font'>\</span>[<span class="id" title="var">False</span>]</span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class='gray-font'>\</span>[])</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandProperties.not_himpl_hwand_r_inv_reciprocal" class="idref" href="#WandProperties.not_himpl_hwand_r_inv_reciprocal"><span class="id" title="lemma">not_himpl_hwand_r_inv_reciprocal</span></a> : <span class="id" title="notation">∃</span> <a id="H<sub>1</sub>:219" class="idref" href="#H<sub>1</sub>:219"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:220" class="idref" href="#H<sub>2</sub>:220"><span class="id" title="binder">H<sub>2</sub></span></a><span class="id" title="notation">,</span><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">¬</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>2</sub>:220"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:219"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>1</sub>:219"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:220"><span class="id" title="variable">H<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">N</span>. <span class="id" title="var">forwards</span> <span class="id" title="var">K</span>: <span class="id" title="var">N</span> (<a class="idref" href="LibSepReference.html#Fmap.empty"><span class="id" title="definition">Fmap.empty</span></a>:<a class="idref" href="LibSepReference.html#heap"><span class="id" title="definition">heap</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hempty_intro"><span class="id" title="lemma">hempty_intro</span></a>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_hpure_l"><span class="id" title="lemma">hstar_hpure_l</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">K</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">K</span>. <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
More generally, one has to be suspicious of any entailment
    that introduces wands "out of nowhere".

<div class="paragraph"> </div>

    The entailment <span class="inlinecode"><span class="id" title="var">hwand_trans_elim</span></span>:
    <span class="inlinecode">(<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span>)</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode">(<span class="id" title="var">H<sub>2</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span>)</span> <span class="inlinecode">==&gt;</span> <span class="inlinecode">(<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span>)</span>
    is correct because, intuitively, the left-hand-side captures
    that <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode">≤</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> and that <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> <span class="inlinecode">≤</span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span></span> for some vaguely defined
    notion of <span class="inlinecode">≤</span> as "being a subset of". From that, we can derive
    <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode">≤</span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span></span>, and justify that the right-hand-side makes sense.

<div class="paragraph"> </div>

    On the contrary, the reciprocal entailment
    <span class="inlinecode">(<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span>)</span> <span class="inlinecode">==&gt;</span> <span class="inlinecode">(<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span>)</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode">(<span class="id" title="var">H<sub>2</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span>)</span>
    is certainly false, because from <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode">≤</span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span></span> there is no way
    to justify <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode">≤</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> nor <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> <span class="inlinecode">≤</span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span></span>. 
</div>

<div class="doc">
<a id="lab327"></a><h3 class="section">Interaction of <span class="inlinecode"><span class="id" title="var">hwand</span></span> with <span class="inlinecode"><span class="id" title="var">hempty</span></span> and <span class="inlinecode"><span class="id" title="var">hpure</span></span></h3>

<div class="paragraph"> </div>

 The heap predicate <span class="inlinecode"><span class='gray-font'>\</span>[]</span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> is equivalent to <span class="inlinecode"><span class="id" title="var">H</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandProperties.hwand_hempty_l" class="idref" href="#WandProperties.hwand_hempty_l"><span class="id" title="lemma">hwand_hempty_l</span></a> : <span class="id" title="keyword">∀</span> <a id="H:221" class="idref" href="#H:221"><span class="id" title="binder">H</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H:221"><span class="id" title="variable">H</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Wand.html#H:221"><span class="id" title="variable">H</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Wand.html#WandDef.hwand"><span class="id" title="definition">hwand</span></a>. <span class="id" title="var">xsimpl</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">H<sub>0</sub></span> <span class="id" title="var">M</span>. <span class="id" title="var">xchange</span> <span class="id" title="var">M</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The lemma above shows that the empty predicate <span class="inlinecode"><span class='gray-font'>\</span>[]</span> can
    be removed from the LHS of a magic wand.

<div class="paragraph"> </div>

    More generally, a pure predicate <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">P</span>]</span> can be removed from
    the LHS of a magic wand, as long as <span class="inlinecode"><span class="id" title="var">P</span></span> is true. Formally: 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandProperties.hwand_hpure_l" class="idref" href="#WandProperties.hwand_hpure_l"><span class="id" title="lemma">hwand_hpure_l</span></a> : <span class="id" title="keyword">∀</span> <a id="P:222" class="idref" href="#P:222"><span class="id" title="binder">P</span></a> <a id="H:223" class="idref" href="#H:223"><span class="id" title="binder">H</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#P:222"><span class="id" title="variable">P</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Wand.html#P:222"><span class="id" title="variable">P</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H:223"><span class="id" title="variable">H</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Wand.html#H:223"><span class="id" title="variable">H</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">HP</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Wand.html#WandDef.hwand"><span class="id" title="definition">hwand</span></a>. <span class="id" title="var">xsimpl</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">H<sub>0</sub></span> <span class="id" title="var">M</span>. <span class="id" title="var">xchange</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <span class="id" title="var">HP</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xpull</span>. <span class="id" title="tactic">auto</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Reciprocally, to prove that a heap satisfies <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">P</span>]</span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span>,
    it suffices to prove that this heap satisfies <span class="inlinecode"><span class="id" title="var">H</span></span> under the
    assumption that <span class="inlinecode"><span class="id" title="var">P</span></span> is true. Formally: 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandProperties.himpl_hwand_hpure_r" class="idref" href="#WandProperties.himpl_hwand_hpure_r"><span class="id" title="lemma">himpl_hwand_hpure_r</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:224" class="idref" href="#H<sub>1</sub>:224"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:225" class="idref" href="#H<sub>2</sub>:225"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="P:226" class="idref" href="#P:226"><span class="id" title="binder">P</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#P:226"><span class="id" title="variable">P</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:224"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:225"><span class="id" title="variable">H<sub>2</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H<sub>1</sub>:224"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Wand.html#P:226"><span class="id" title="variable">P</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:225"><span class="id" title="variable">H<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#WandDef.himpl_hwand_r"><span class="id" title="lemma">himpl_hwand_r</span></a>. <span class="id" title="var">xsimpl</span>. <span class="id" title="var">applys</span> <span class="id" title="var">M</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab328"></a><h4 class="section">Exercise: 2 stars, standard, optional (himpl_hwand_hpure_lr)</h4>
 Prove that <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">P<sub>1</sub></span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">P<sub>2</sub></span>]</span> entails <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">P<sub>1</sub></span>]</span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">P<sub>2</sub></span>]</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandProperties.himpl_hwand_hpure_lr" class="idref" href="#WandProperties.himpl_hwand_hpure_lr"><span class="id" title="lemma">himpl_hwand_hpure_lr</span></a> : <span class="id" title="keyword">∀</span> (<a id="P<sub>1</sub>:227" class="idref" href="#P<sub>1</sub>:227"><span class="id" title="binder">P<sub>1</sub></span></a> <a id="P<sub>2</sub>:228" class="idref" href="#P<sub>2</sub>:228"><span class="id" title="binder">P<sub>2</sub></span></a>:<span class="id" title="keyword">Prop</span>),<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Wand.html#P<sub>1</sub>:227"><span class="id" title="variable">P<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Wand.html#P<sub>2</sub>:228"><span class="id" title="variable">P<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Wand.html#P<sub>1</sub>:227"><span class="id" title="variable">P<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Wand.html#P<sub>2</sub>:228"><span class="id" title="variable">P<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab329"></a><h3 class="section">Interaction of <span class="inlinecode"><span class="id" title="var">hwand</span></span> with <span class="inlinecode"><span class="id" title="var">hstar</span></span></h3>

<div class="paragraph"> </div>

 An interesting property is that arguments on the LHS of a magic
    wand can equivalently be "curried" or "uncurried", just like a
    function of type "(A * B) <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> C" is equivalent to a function of
    type "A <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> B <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> C".

<div class="paragraph"> </div>

    The heap predicates <span class="inlinecode">(<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span>)</span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span></span> and <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode">(<span class="id" title="var">H<sub>2</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span>)</span>
    and <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode">(<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span>)</span> are all equivalent. Intuitively, they all
    describe the predicate <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span></span> with the missing pieces <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>.

<div class="paragraph"> </div>

    The equivalence between the uncurried form <span class="inlinecode">(<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span>)</span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span></span>
    and the curried form <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode">(<span class="id" title="var">H<sub>2</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span>)</span> is formalized by the
    lemma shown below. The third form, <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode">(<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span>)</span>, follows
    from the commutativity property <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandProperties.hwand_curry_eq" class="idref" href="#WandProperties.hwand_curry_eq"><span class="id" title="lemma">hwand_curry_eq</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:229" class="idref" href="#H<sub>1</sub>:229"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:230" class="idref" href="#H<sub>2</sub>:230"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="H<sub>3</sub>:231" class="idref" href="#H<sub>3</sub>:231"><span class="id" title="binder">H<sub>3</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>1</sub>:229"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:230"><span class="id" title="variable">H<sub>2</sub></span></a><a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation">)</span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H<sub>3</sub>:231"><span class="id" title="variable">H<sub>3</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:229"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>2</sub>:230"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H<sub>3</sub>:231"><span class="id" title="variable">H<sub>3</sub></span></a><a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_antisym"><span class="id" title="lemma">himpl_antisym</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <a class="idref" href="Wand.html#WandDef.himpl_hwand_r"><span class="id" title="lemma">himpl_hwand_r</span></a>. <span class="id" title="tactic">apply</span> <a class="idref" href="Wand.html#WandDef.himpl_hwand_r"><span class="id" title="lemma">himpl_hwand_r</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xchange</span> (<a class="idref" href="Wand.html#WandDef.hwand_cancel"><span class="id" title="lemma">hwand_cancel</span></a> (<span class="id" title="var">H<sub>1</sub></span> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <span class="id" title="var">H<sub>2</sub></span>) <span class="id" title="var">H<sub>3</sub></span>). }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <a class="idref" href="Wand.html#WandDef.himpl_hwand_r"><span class="id" title="lemma">himpl_hwand_r</span></a>. <span class="id" title="var">xchange</span> (<a class="idref" href="Wand.html#WandDef.hwand_cancel"><span class="id" title="lemma">hwand_cancel</span></a> <span class="id" title="var">H<sub>1</sub></span> (<span class="id" title="var">H<sub>2</sub></span> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <span class="id" title="var">H<sub>3</sub></span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xchange</span> (<a class="idref" href="Wand.html#WandDef.hwand_cancel"><span class="id" title="lemma">hwand_cancel</span></a> <span class="id" title="var">H<sub>2</sub></span> <span class="id" title="var">H<sub>3</sub></span>). }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Another interesting property is that the RHS of a magic wand
    can absorb resources that the magic wand is starred with.

<div class="paragraph"> </div>

    Concretely, from <span class="inlinecode">(<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span>)</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span></span>, one can get the predicate
    <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span></span> to be absorbed by the <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> in the magic wand, yielding
    <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode">(<span class="id" title="var">H<sub>2</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span>)</span>.

<div class="paragraph"> </div>

    One way to read this: "if you own <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span></span> and, when given <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span>
    you own <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>, then, when given <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span>, you own both <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> and <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span></span>." 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandProperties.hstar_hwand" class="idref" href="#WandProperties.hstar_hwand"><span class="id" title="lemma">hstar_hwand</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:232" class="idref" href="#H<sub>1</sub>:232"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:233" class="idref" href="#H<sub>2</sub>:233"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="H<sub>3</sub>:234" class="idref" href="#H<sub>3</sub>:234"><span class="id" title="binder">H<sub>3</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>1</sub>:232"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:233"><span class="id" title="variable">H<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>3</sub>:234"><span class="id" title="variable">H<sub>3</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:232"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>2</sub>:233"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>3</sub>:234"><span class="id" title="variable">H<sub>3</sub></span></a><a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#WandDef.himpl_hwand_r"><span class="id" title="lemma">himpl_hwand_r</span></a>. <span class="id" title="var">xsimpl</span>. <span class="id" title="var">xchange</span> (<a class="idref" href="Wand.html#WandDef.hwand_cancel"><span class="id" title="lemma">hwand_cancel</span></a> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Remark: the reciprocal entailment is false: it is not possible
    to extract a heap predicate out of the LHS of an entailment.
    Indeed, that heap predicate might not exist if it is mentioned
    in the RHS of the magic wand. 
<div class="paragraph"> </div>

<a id="lab330"></a><h4 class="section">Exercise: 1 star, standard, especially useful (himpl_hwand_hstar_same_r)</h4>
 Prove that <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> entails <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode">(<span class="id" title="var">H<sub>2</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span>)</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandProperties.himpl_hwand_hstar_same_r" class="idref" href="#WandProperties.himpl_hwand_hstar_same_r"><span class="id" title="lemma">himpl_hwand_hstar_same_r</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:235" class="idref" href="#H<sub>1</sub>:235"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:236" class="idref" href="#H<sub>2</sub>:236"><span class="id" title="binder">H<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H<sub>1</sub>:235"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>2</sub>:236"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>2</sub>:236"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:235"><span class="id" title="variable">H<sub>1</sub></span></a><a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation">)</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a id="lab331"></a><h4 class="section">Exercise: 2 stars, standard, especially useful (hwand_cancel_part)</h4>
 Prove that <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode">((<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span>)</span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span>)</span> simplifies to <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandProperties.hwand_cancel_part" class="idref" href="#WandProperties.hwand_cancel_part"><span class="id" title="lemma">hwand_cancel_part</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:237" class="idref" href="#H<sub>1</sub>:237"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:238" class="idref" href="#H<sub>2</sub>:238"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="H<sub>3</sub>:239" class="idref" href="#H<sub>3</sub>:239"><span class="id" title="binder">H<sub>3</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H<sub>1</sub>:237"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>1</sub>:237"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:238"><span class="id" title="variable">H<sub>2</sub></span></a><a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation">)</span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H<sub>3</sub>:239"><span class="id" title="variable">H<sub>3</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>2</sub>:238"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H<sub>3</sub>:239"><span class="id" title="variable">H<sub>3</sub></span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a id="lab332"></a><h4 class="section">Exercise: 3 stars, standard, optional (hwand_frame)</h4>
 Prove that <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> entails to <span class="inlinecode">(<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span>)</span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode">(<span class="id" title="var">H<sub>2</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span>)</span>.
    Hint: you can use <span class="inlinecode"><span class="id" title="var">xsimpl</span></span> during the proof. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WandProperties.hwand_frame" class="idref" href="#WandProperties.hwand_frame"><span class="id" title="lemma">hwand_frame</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:240" class="idref" href="#H<sub>1</sub>:240"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:241" class="idref" href="#H<sub>2</sub>:241"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="H<sub>3</sub>:242" class="idref" href="#H<sub>3</sub>:242"><span class="id" title="binder">H<sub>3</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H<sub>1</sub>:240"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:241"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>1</sub>:240"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>3</sub>:242"><span class="id" title="variable">H<sub>3</sub></span></a><a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation">)</span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>2</sub>:241"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>3</sub>:242"><span class="id" title="variable">H<sub>3</sub></span></a><a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<span class="id" title="keyword">End</span> <a class="idref" href="Wand.html#WandProperties"><span class="id" title="module">WandProperties</span></a>.<br/>
</div>

<div class="doc">
<a id="lab333"></a><h1 class="section">Optional Material</h1>

</div>

<div class="doc">
<a id="lab334"></a><h2 class="section">Equivalence Between Alternative Definitions of the Magic Wand</h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="HwandEquiv" class="idref" href="#HwandEquiv"><span class="id" title="module">HwandEquiv</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">op</span> : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>.<br/>
</div>

<div class="doc">
In what follows we prove the equivalence between the three
    characterizations of <span class="inlinecode"><span class="id" title="var">hwand</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> that we have presented:

<div class="paragraph"> </div>

    1. The definition <span class="inlinecode"><span class="id" title="var">hwand'</span></span>, expressed directly in terms of heaps:
       <span class="inlinecode"><span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">h</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">h'</span>,</span> <span class="inlinecode"><span class="id" title="var">Fmap.disjoint</span></span> <span class="inlinecode"><span class="id" title="var">h</span></span> <span class="inlinecode"><span class="id" title="var">h'</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">h'</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> <span class="inlinecode">(<span class="id" title="var">h'</span></span> <span class="inlinecode">\<span class="id" title="var">u</span></span> <span class="inlinecode"><span class="id" title="var">h</span>)</span>

<div class="paragraph"> </div>

    2. The definition <span class="inlinecode"><span class="id" title="var">hwand</span></span>, expressed in terms of existing operators:
       <span class="inlinecode"><span class='gray-font'>\</span><span class="id" title="tactic">∃</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>0</sub></span>,</span> <span class="inlinecode"><span class="id" title="var">H<sub>0</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class='gray-font'>\</span>[</span> <span class="inlinecode">(<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H<sub>0</sub></span>)</span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span>]</span>

<div class="paragraph"> </div>

    3. The characterization via the equivalence <span class="inlinecode"><span class="id" title="var">hwand_equiv</span></span>:
       <span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>0</sub></span></span> <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span>,</span> <span class="inlinecode">(<span class="id" title="var">H<sub>0</sub></span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span>)</span> <span class="inlinecode">↔</span> <span class="inlinecode">(<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H<sub>0</sub></span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span>)</span>.

<div class="paragraph"> </div>

    4. The characterization via the pair of the introduction rule
       <span class="inlinecode"><span class="id" title="var">himpl_hwand_r</span></span> and the elimination rule <span class="inlinecode"><span class="id" title="var">hwand_cancel</span></span>.

<div class="paragraph"> </div>

    To prove the 4-way equivalence, we first prove the equivalence
    between (1) and (2), then prove the equivalence between (2) and (3),
    and finally the equivalence between (3) and (4).

</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="HwandEquiv.hwand_characterization_1" class="idref" href="#HwandEquiv.hwand_characterization_1"><span class="id" title="definition">hwand_characterization_1</span></a> (<a id="op:243" class="idref" href="#op:243"><span class="id" title="binder">op</span></a>:<a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) :=<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#op:243"><span class="id" title="variable">op</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><span class="id" title="keyword">fun</span> <a id="H<sub>1</sub>:244" class="idref" href="#H<sub>1</sub>:244"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:245" class="idref" href="#H<sub>2</sub>:245"><span class="id" title="binder">H<sub>2</sub></span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="h:246" class="idref" href="#h:246"><span class="id" title="binder">h</span></a> ⇒ <span class="id" title="keyword">∀</span> <a id="h':247" class="idref" href="#h':247"><span class="id" title="binder">h'</span></a>, <a class="idref" href="LibSepReference.html#Fmap.disjoint"><span class="id" title="definition">Fmap.disjoint</span></a> <a class="idref" href="Wand.html#h:246"><span class="id" title="variable">h</span></a> <a class="idref" href="Wand.html#h':247"><span class="id" title="variable">h'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:244"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#h':247"><span class="id" title="variable">h'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:245"><span class="id" title="variable">H<sub>2</sub></span></a> (<a class="idref" href="Wand.html#h':247"><span class="id" title="variable">h'</span></a> <a class="idref" href="LibSepReference.html#11dbc5cc324072f557c3f348a31ba1a<sub>0</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#11dbc5cc324072f557c3f348a31ba1a<sub>0</sub>"><span class="id" title="notation">u</span></a> <a class="idref" href="Wand.html#h:246"><span class="id" title="variable">h</span></a>))<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="HwandEquiv.hwand_characterization_2" class="idref" href="#HwandEquiv.hwand_characterization_2"><span class="id" title="definition">hwand_characterization_2</span></a> (<a id="op:248" class="idref" href="#op:248"><span class="id" title="binder">op</span></a>:<a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) :=<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#op:248"><span class="id" title="variable">op</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><span class="id" title="keyword">fun</span> <a id="H<sub>1</sub>:249" class="idref" href="#H<sub>1</sub>:249"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:250" class="idref" href="#H<sub>2</sub>:250"><span class="id" title="binder">H<sub>2</sub></span></a> ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="H<sub>0</sub>:251" class="idref" href="#H<sub>0</sub>:251"><span class="id" title="binder">H<sub>0</sub></span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Wand.html#H<sub>0</sub>:251"><span class="id" title="variable">H<sub>0</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:249"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>0</sub>:251"><span class="id" title="variable">H<sub>0</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:250"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="HwandEquiv.hwand_characterization_3" class="idref" href="#HwandEquiv.hwand_characterization_3"><span class="id" title="definition">hwand_characterization_3</span></a> (<a id="op:252" class="idref" href="#op:252"><span class="id" title="binder">op</span></a>:<a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="H<sub>0</sub>:253" class="idref" href="#H<sub>0</sub>:253"><span class="id" title="binder">H<sub>0</sub></span></a> <a id="H<sub>1</sub>:254" class="idref" href="#H<sub>1</sub>:254"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:255" class="idref" href="#H<sub>2</sub>:255"><span class="id" title="binder">H<sub>2</sub></span></a>, <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>0</sub>:253"><span class="id" title="variable">H<sub>0</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#op:252"><span class="id" title="variable">op</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:254"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:255"><span class="id" title="variable">H<sub>2</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>1</sub>:254"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>0</sub>:253"><span class="id" title="variable">H<sub>0</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:255"><span class="id" title="variable">H<sub>2</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="HwandEquiv.hwand_characterization_4" class="idref" href="#HwandEquiv.hwand_characterization_4"><span class="id" title="definition">hwand_characterization_4</span></a> (<a id="op:256" class="idref" href="#op:256"><span class="id" title="binder">op</span></a>:<a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="H<sub>0</sub>:257" class="idref" href="#H<sub>0</sub>:257"><span class="id" title="binder">H<sub>0</sub></span></a> <a id="H<sub>1</sub>:258" class="idref" href="#H<sub>1</sub>:258"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:259" class="idref" href="#H<sub>2</sub>:259"><span class="id" title="binder">H<sub>2</sub></span></a>, <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>1</sub>:258"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>0</sub>:257"><span class="id" title="variable">H<sub>0</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:259"><span class="id" title="variable">H<sub>2</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>0</sub>:257"><span class="id" title="variable">H<sub>0</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#op:256"><span class="id" title="variable">op</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:258"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:259"><span class="id" title="variable">H<sub>2</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:260" class="idref" href="#H<sub>1</sub>:260"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:261" class="idref" href="#H<sub>2</sub>:261"><span class="id" title="binder">H<sub>2</sub></span></a>, (<a class="idref" href="Wand.html#H<sub>1</sub>:260"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#op:256"><span class="id" title="variable">op</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:260"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:261"><span class="id" title="variable">H<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:261"><span class="id" title="variable">H<sub>2</sub></span></a>)<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a>.<br/>
</div>

<div class="doc">
The equivalence proofs are given here for reference. It is not needed
    to follow through the technical details. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="HwandEquiv.hwand_characterization_1_eq_2" class="idref" href="#HwandEquiv.hwand_characterization_1_eq_2"><span class="id" title="lemma">hwand_characterization_1_eq_2</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#HwandEquiv.hwand_characterization_1"><span class="id" title="definition">hwand_characterization_1</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Wand.html#HwandEquiv.hwand_characterization_2"><span class="id" title="definition">hwand_characterization_2</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <span class="id" title="lemma">pred_ext_1</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">op</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Wand.html#HwandEquiv.hwand_characterization_1"><span class="id" title="definition">hwand_characterization_1</span></a>, <a class="idref" href="Wand.html#HwandEquiv.hwand_characterization_2"><span class="id" title="definition">hwand_characterization_2</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">asserts</span> <span class="id" title="var">K</span>: (<span class="id" title="keyword">∀</span> <a id="A:264" class="idref" href="#A:264"><span class="id" title="binder">A</span></a> <a id="B:265" class="idref" href="#B:265"><span class="id" title="binder">B</span></a>, <a class="idref" href="Wand.html#A:262"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Wand.html#B:263"><span class="id" title="variable">B</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="var">op</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Wand.html#A:262"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <span class="id" title="var">op</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Wand.html#B:263"><span class="id" title="variable">B</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span>. <span class="id" title="var">iff</span>; <span class="id" title="tactic">subst</span>*. } <span class="id" title="tactic">apply</span> <span class="id" title="var">K</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">K</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">pred_ext_3</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span> <span class="id" title="var">h</span>. <span class="id" title="var">iff</span> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">∃</span> (<span class="id" title="notation">=</span><span class="id" title="var">h</span>). <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_hpure_r"><span class="id" title="lemma">hstar_hpure_r</span></a>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">h<sub>3</sub></span> <span class="id" title="var">K<sub>3</sub></span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_comm"><span class="id" title="lemma">hstar_comm</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">K<sub>3</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">K<sub>3</sub></span> <span class="id" title="keyword">as</span> (<span class="id" title="var">h<sub>1</sub></span>&amp;<span class="id" title="var">h<sub>2</sub></span>&amp;<span class="id" title="var">K<sub>1</sub></span>&amp;<span class="id" title="var">K<sub>2</sub></span>&amp;<span class="id" title="var">D</span>&amp;<span class="id" title="var">U</span>). <span class="id" title="tactic">subst</span> <span class="id" title="var">h<sub>1</sub></span> <span class="id" title="var">h<sub>3</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rewrites</span> (<span class="id" title="notation">&gt;&gt;</span> <a class="idref" href="LibSepFmap.html#union_comm_of_disjoint"><span class="id" title="lemma">union_comm_of_disjoint</span></a> <span class="id" title="var">D</span>). <span class="id" title="var">applys</span> <span class="id" title="var">M</span> <span class="id" title="var">D</span> <span class="id" title="var">K<sub>2</sub></span>. } }<br/>
&nbsp;&nbsp;{ <span class="comment">(*&nbsp;This&nbsp;direction&nbsp;reproduces&nbsp;the&nbsp;proof&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">hwand_inv</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">h<sub>1</sub></span> <span class="id" title="var">D</span> <span class="id" title="var">K<sub>1</sub></span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">M</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">H<sub>0</sub></span>&amp;<span class="id" title="var">M</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">M</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">h<sub>0</sub></span>&amp;<span class="id" title="var">h<sub>2</sub></span>&amp;<span class="id" title="var">K<sub>0</sub></span>&amp;<span class="id" title="var">K<sub>2</sub></span>&amp;<span class="id" title="var">D'</span>&amp;<span class="id" title="var">U</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lets</span> (<span class="id" title="var">N</span>&amp;<span class="id" title="var">E</span>): <a class="idref" href="LibSepReference.html#SepSimplArgs.hpure_inv"><span class="id" title="lemma">hpure_inv</span></a> (<span class="id" title="definition">rm</span> <span class="id" title="var">K<sub>2</sub></span>). <span class="id" title="tactic">subst</span> <span class="id" title="var">h</span> <span class="id" title="var">h<sub>2</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#Fmap.union_empty_r"><span class="id" title="lemma">Fmap.union_empty_r</span></a> <span class="id" title="keyword">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">applys</span> <span class="id" title="var">N</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_intro"><span class="id" title="lemma">hstar_intro</span></a> <span class="id" title="var">K<sub>1</sub></span> <span class="id" title="var">K<sub>0</sub></span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepFmap.html#disjoint_sym"><span class="id" title="lemma">disjoint_sym</span></a> <span class="id" title="var">D</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="HwandEquiv.hwand_characterization_2_eq_3" class="idref" href="#HwandEquiv.hwand_characterization_2_eq_3"><span class="id" title="lemma">hwand_characterization_2_eq_3</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#HwandEquiv.hwand_characterization_2"><span class="id" title="definition">hwand_characterization_2</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Wand.html#HwandEquiv.hwand_characterization_3"><span class="id" title="definition">hwand_characterization_3</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <span class="id" title="lemma">pred_ext_1</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">op</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Wand.html#HwandEquiv.hwand_characterization_2"><span class="id" title="definition">hwand_characterization_2</span></a>, <a class="idref" href="Wand.html#HwandEquiv.hwand_characterization_3"><span class="id" title="definition">hwand_characterization_3</span></a>. <span class="id" title="var">iff</span> <span class="id" title="var">K</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">intros</span>. <span class="comment">(*&nbsp;apply&nbsp;hwand_equiv.&nbsp;*)</span> <span class="id" title="var">iff</span> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">xchange</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H<sub>3</sub></span> <span class="id" title="var">N</span>. <span class="id" title="var">xchange</span> <span class="id" title="var">N</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span> <span class="id" title="var">H<sub>0</sub></span>. <span class="id" title="var">xchange</span> <span class="id" title="var">M</span>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="lemma">fun_ext_2</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="tactic">apply</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_antisym"><span class="id" title="lemma">himpl_antisym</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">lets</span> (<span class="id" title="var">M</span>&amp;<span class="id" title="var">_</span>): (<span class="id" title="var">K</span> (<span class="id" title="var">op</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>) <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>). <span class="id" title="var">xsimpl</span> (<span class="id" title="var">op</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">applys</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_refl"><span class="id" title="lemma">himpl_refl</span></a>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H<sub>0</sub></span> <span class="id" title="var">M</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span> <span class="id" title="var">M</span>. } }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="HwandEquiv.hwand_characterization_3_eq_4" class="idref" href="#HwandEquiv.hwand_characterization_3_eq_4"><span class="id" title="lemma">hwand_characterization_3_eq_4</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#HwandEquiv.hwand_characterization_3"><span class="id" title="definition">hwand_characterization_3</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Wand.html#HwandEquiv.hwand_characterization_4"><span class="id" title="definition">hwand_characterization_4</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <span class="id" title="lemma">pred_ext_1</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">op</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Wand.html#HwandEquiv.hwand_characterization_3"><span class="id" title="definition">hwand_characterization_3</span></a>, <a class="idref" href="Wand.html#HwandEquiv.hwand_characterization_4"><span class="id" title="definition">hwand_characterization_4</span></a>. <span class="id" title="var">iff</span> <span class="id" title="var">K</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">apply</span> &lt;- <span class="id" title="var">K</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">M</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">K</span>. <span class="id" title="tactic">auto</span>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> <span class="id" title="var">K</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">K<sub>1</sub></span>&amp;<span class="id" title="var">K<sub>2</sub></span>). <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">xchange</span> <span class="id" title="var">M</span>. <span class="id" title="var">xchange</span> (<span class="id" title="var">K<sub>2</sub></span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>). }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <span class="id" title="var">K<sub>1</sub></span>. <span class="id" title="var">applys</span> <span class="id" title="var">M</span>. } }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="Wand.html#HwandEquiv"><span class="id" title="module">HwandEquiv</span></a>.<br/>
</div>

<div class="doc">
<a id="lab335"></a><h2 class="section">Operator <span class="inlinecode"><span class="id" title="var">hforall</span></span></h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="NewQwand" class="idref" href="#NewQwand"><span class="id" title="module">NewQwand</span></a>.<br/>
<span class="id" title="keyword">Export</span> <span class="id" title="var">WandDef</span>.<br/>
</div>

<div class="doc">
In the beginning of this chapter, we defined <span class="inlinecode"><span class="id" title="var">qwand</span></span> following the pattern
    of <span class="inlinecode"><span class="id" title="var">hwand</span></span>, as <span class="inlinecode"></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="id" title="tactic">∃</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>0</sub></span>,</span> <span class="inlinecode"><span class="id" title="var">H<sub>0</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class='gray-font'>\</span>[</span> <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*+</span> <span class="inlinecode"><span class="id" title="var">H<sub>0</sub></span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span></span> <span class="inlinecode">]</span> <span class="inlinecode"></span>.
    An alternative approach consists of defining <span class="inlinecode"><span class="id" title="var">qwand</span></span> in terms of <span class="inlinecode"><span class="id" title="var">hwand</span></span>.

<div class="paragraph"> </div>

    This alternative definition involves the universal quantifier for heap
    predicates, written <span class="inlinecode">\<span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">x</span>,</span> <span class="inlinecode"><span class="id" title="var">H</span></span>. The universal quantifier is the
    counterpart of the existential quantifier <span class="inlinecode"><span class='gray-font'>\</span><span class="id" title="tactic">∃</span></span> <span class="inlinecode"><span class="id" title="var">x</span>,</span> <span class="inlinecode"><span class="id" title="var">H</span></span>.

<div class="paragraph"> </div>

    Using the <span class="inlinecode">\<span class="id" title="keyword">∀</span></span> quantifier, we may define <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span></span> as the heap
    predicate <span class="inlinecode">\<span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">v</span>,</span> <span class="inlinecode">(<span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">v</span>)</span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode">(<span class="id" title="var">Q<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">v</span>)</span>. 
<div class="paragraph"> </div>

 Let us first formalize the definition of the universal quantifier on
    <span class="inlinecode"><span class="id" title="var">hprop</span></span>. Technically, a heap predicate of the form <span class="inlinecode">\<span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">x</span>,</span> <span class="inlinecode"><span class="id" title="var">H</span></span> stands for
    <span class="inlinecode"><span class="id" title="var">hforall</span></span> <span class="inlinecode">(<span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">H</span>)</span>, where the definition of <span class="inlinecode"><span class="id" title="var">hforall</span></span> follows the
    exact same pattern as for <span class="inlinecode"><span class="id" title="var">hexists</span></span>. The definition shown below is somewhat
    technical---details may be safely skipped over. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="NewQwand.hforall" class="idref" href="#NewQwand.hforall"><span class="id" title="definition">hforall</span></a> (<a id="A:266" class="idref" href="#A:266"><span class="id" title="binder">A</span></a> : <span class="id" title="keyword">Type</span>) (<a id="J:267" class="idref" href="#J:267"><span class="id" title="binder">J</span></a> : <a class="idref" href="Wand.html#A:266"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="h:268" class="idref" href="#h:268"><span class="id" title="binder">h</span></a> ⇒ <span class="id" title="keyword">∀</span> <a id="x:269" class="idref" href="#x:269"><span class="id" title="binder">x</span></a>, <a class="idref" href="Wand.html#J:267"><span class="id" title="variable">J</span></a> <a class="idref" href="Wand.html#x:269"><span class="id" title="variable">x</span></a> <a class="idref" href="Wand.html#h:268"><span class="id" title="variable">h</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <a id="6603aec78c9eb740e019d90c70dd37f<sub>7</sub>" class="idref" href="#6603aec78c9eb740e019d90c70dd37f<sub>7</sub>"><span class="id" title="notation">&quot;</span></a>'\forall' x<sub>1</sub> .. xn , H" :=<br/>
&nbsp;&nbsp;(<a class="idref" href="Wand.html#NewQwand.hforall"><span class="id" title="definition">hforall</span></a> (<span class="id" title="keyword">fun</span> <a id="x<sub>1</sub>:270" class="idref" href="#x<sub>1</sub>:270"><span class="id" title="binder">x<sub>1</sub></span></a> ⇒ .. (<a class="idref" href="Wand.html#NewQwand.hforall"><span class="id" title="definition">hforall</span></a> (<span class="id" title="keyword">fun</span> <a id="xn:271" class="idref" href="#xn:271"><span class="id" title="binder">xn</span></a> ⇒ <span class="id" title="var">H</span>)) ..))<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 39, <span class="id" title="var">x<sub>1</sub></span> <span class="id" title="var">binder</span>, <span class="id" title="var">H</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 50, <span class="id" title="tactic">right</span> <span class="id" title="keyword">associativity</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">format</span> "'[' '\forall' '/ '  x<sub>1</sub>  ..  xn , '/ '  H ']'").<br/>
</div>

<div class="doc">
The introduction and elimination rule for <span class="inlinecode"><span class="id" title="var">hforall</span></span> are as follows. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="NewQwand.hforall_intro" class="idref" href="#NewQwand.hforall_intro"><span class="id" title="lemma">hforall_intro</span></a> : <span class="id" title="keyword">∀</span> <a id="A:272" class="idref" href="#A:272"><span class="id" title="binder">A</span></a> (<a id="J:273" class="idref" href="#J:273"><span class="id" title="binder">J</span></a>:<a class="idref" href="Wand.html#A:272"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) <a id="h:274" class="idref" href="#h:274"><span class="id" title="binder">h</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="x:275" class="idref" href="#x:275"><span class="id" title="binder">x</span></a>, <a class="idref" href="Wand.html#J:273"><span class="id" title="variable">J</span></a> <a class="idref" href="Wand.html#x:275"><span class="id" title="variable">x</span></a> <a class="idref" href="Wand.html#h:274"><span class="id" title="variable">h</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;(<a class="idref" href="Wand.html#NewQwand.hforall"><span class="id" title="definition">hforall</span></a> <a class="idref" href="Wand.html#J:273"><span class="id" title="variable">J</span></a>) <a class="idref" href="Wand.html#h:274"><span class="id" title="variable">h</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span>* <span class="id" title="var">M</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="NewQwand.hforall_inv" class="idref" href="#NewQwand.hforall_inv"><span class="id" title="lemma">hforall_inv</span></a> : <span class="id" title="keyword">∀</span> <a id="A:276" class="idref" href="#A:276"><span class="id" title="binder">A</span></a> (<a id="J:277" class="idref" href="#J:277"><span class="id" title="binder">J</span></a>:<a class="idref" href="Wand.html#A:276"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) <a id="h:278" class="idref" href="#h:278"><span class="id" title="binder">h</span></a>,<br/>
&nbsp;&nbsp;(<a class="idref" href="Wand.html#NewQwand.hforall"><span class="id" title="definition">hforall</span></a> <a class="idref" href="Wand.html#J:277"><span class="id" title="variable">J</span></a>) <a class="idref" href="Wand.html#h:278"><span class="id" title="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="x:279" class="idref" href="#x:279"><span class="id" title="binder">x</span></a>, <a class="idref" href="Wand.html#J:277"><span class="id" title="variable">J</span></a> <a class="idref" href="Wand.html#x:279"><span class="id" title="variable">x</span></a> <a class="idref" href="Wand.html#h:278"><span class="id" title="variable">h</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span>* <span class="id" title="var">M</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The introduction rule in an entailement for <span class="inlinecode">\<span class="id" title="keyword">∀</span></span> appears below.
    To prove that a heap satisfies <span class="inlinecode">\<span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">x</span>,</span> <span class="inlinecode"><span class="id" title="var">J</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span>, one must show that,
     for any <span class="inlinecode"><span class="id" title="var">x</span></span>, this heap satisfies <span class="inlinecode"><span class="id" title="var">J</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="NewQwand.himpl_hforall_r" class="idref" href="#NewQwand.himpl_hforall_r"><span class="id" title="lemma">himpl_hforall_r</span></a> : <span class="id" title="keyword">∀</span> <a id="A:280" class="idref" href="#A:280"><span class="id" title="binder">A</span></a> (<a id="J:281" class="idref" href="#J:281"><span class="id" title="binder">J</span></a>:<a class="idref" href="Wand.html#A:280"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) <a id="H:282" class="idref" href="#H:282"><span class="id" title="binder">H</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="x:283" class="idref" href="#x:283"><span class="id" title="binder">x</span></a>, <a class="idref" href="Wand.html#H:282"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#J:281"><span class="id" title="variable">J</span></a> <a class="idref" href="Wand.html#x:283"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H:282"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#6603aec78c9eb740e019d90c70dd37f<sub>7</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Wand.html#6603aec78c9eb740e019d90c70dd37f<sub>7</sub>"><span class="id" title="notation">∀</span></a> <a id="x:284" class="idref" href="#x:284"><span class="id" title="binder">x</span></a><a class="idref" href="Wand.html#6603aec78c9eb740e019d90c70dd37f<sub>7</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="Wand.html#J:281"><span class="id" title="variable">J</span></a> <a class="idref" href="Wand.html#x:284"><span class="id" title="variable">x</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">K</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">apply</span>¬<span class="id" title="var">M</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The elimination rule in an entailment for <span class="inlinecode">\<span class="id" title="keyword">∀</span></span> appears below.
    Assuming a heap satisfies <span class="inlinecode">\<span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">x</span>,</span> <span class="inlinecode"><span class="id" title="var">J</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span>, one can derive that the
    same heap satisfies <span class="inlinecode"><span class="id" title="var">J</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> for any desired value <span class="inlinecode"><span class="id" title="var">v</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="NewQwand.hforall_specialize" class="idref" href="#NewQwand.hforall_specialize"><span class="id" title="lemma">hforall_specialize</span></a> : <span class="id" title="keyword">∀</span> <a id="A:285" class="idref" href="#A:285"><span class="id" title="binder">A</span></a> (<a id="v:286" class="idref" href="#v:286"><span class="id" title="binder">v</span></a>:<a class="idref" href="Wand.html#A:285"><span class="id" title="variable">A</span></a>) (<a id="J:287" class="idref" href="#J:287"><span class="id" title="binder">J</span></a>:<a class="idref" href="Wand.html#A:285"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#6603aec78c9eb740e019d90c70dd37f<sub>7</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Wand.html#6603aec78c9eb740e019d90c70dd37f<sub>7</sub>"><span class="id" title="notation">∀</span></a> <a id="x:288" class="idref" href="#x:288"><span class="id" title="binder">x</span></a><a class="idref" href="Wand.html#6603aec78c9eb740e019d90c70dd37f<sub>7</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="Wand.html#J:287"><span class="id" title="variable">J</span></a> <a class="idref" href="Wand.html#x:288"><span class="id" title="variable">x</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#J:287"><span class="id" title="variable">J</span></a> <a class="idref" href="Wand.html#v:286"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">K</span>. <span class="id" title="tactic">apply</span>* <span class="id" title="var">K</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
This last lemma can equivalently be formulated in the following way,
    which makes it easier to apply in some cases. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="NewQwand.himpl_hforall_l" class="idref" href="#NewQwand.himpl_hforall_l"><span class="id" title="lemma">himpl_hforall_l</span></a> : <span class="id" title="keyword">∀</span> <a id="A:289" class="idref" href="#A:289"><span class="id" title="binder">A</span></a> (<a id="v:290" class="idref" href="#v:290"><span class="id" title="binder">v</span></a>:<a class="idref" href="Wand.html#A:289"><span class="id" title="variable">A</span></a>) (<a id="J:291" class="idref" href="#J:291"><span class="id" title="binder">J</span></a>:<a class="idref" href="Wand.html#A:289"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) <a id="H:292" class="idref" href="#H:292"><span class="id" title="binder">H</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#J:291"><span class="id" title="variable">J</span></a> <a class="idref" href="Wand.html#v:290"><span class="id" title="variable">v</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H:292"><span class="id" title="variable">H</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#6603aec78c9eb740e019d90c70dd37f<sub>7</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Wand.html#6603aec78c9eb740e019d90c70dd37f<sub>7</sub>"><span class="id" title="notation">∀</span></a> <a id="x:293" class="idref" href="#x:293"><span class="id" title="binder">x</span></a><a class="idref" href="Wand.html#6603aec78c9eb740e019d90c70dd37f<sub>7</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="Wand.html#J:291"><span class="id" title="variable">J</span></a> <a class="idref" href="Wand.html#x:293"><span class="id" title="variable">x</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H:292"><span class="id" title="variable">H</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans"><span class="id" title="lemma">himpl_trans</span></a> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#NewQwand.hforall_specialize"><span class="id" title="lemma">hforall_specialize</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Universal quantifers that appear in the precondition of a triple
    may be specialized, just like those in the left-hand side of an
    entailment. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="NewQwand.triple_hforall" class="idref" href="#NewQwand.triple_hforall"><span class="id" title="lemma">triple_hforall</span></a> : <span class="id" title="keyword">∀</span> <a id="A:294" class="idref" href="#A:294"><span class="id" title="binder">A</span></a> (<a id="v:295" class="idref" href="#v:295"><span class="id" title="binder">v</span></a>:<a class="idref" href="Wand.html#A:294"><span class="id" title="variable">A</span></a>) <a id="t:296" class="idref" href="#t:296"><span class="id" title="binder">t</span></a> (<a id="J:297" class="idref" href="#J:297"><span class="id" title="binder">J</span></a>:<a class="idref" href="Wand.html#A:294"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) <a id="Q:298" class="idref" href="#Q:298"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Wand.html#t:296"><span class="id" title="variable">t</span></a> (<a class="idref" href="Wand.html#J:297"><span class="id" title="variable">J</span></a> <a class="idref" href="Wand.html#v:295"><span class="id" title="variable">v</span></a>) <a class="idref" href="Wand.html#Q:298"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Wand.html#t:296"><span class="id" title="variable">t</span></a> (<a class="idref" href="Wand.html#6603aec78c9eb740e019d90c70dd37f<sub>7</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Wand.html#6603aec78c9eb740e019d90c70dd37f<sub>7</sub>"><span class="id" title="notation">∀</span></a> <a id="x:299" class="idref" href="#x:299"><span class="id" title="binder">x</span></a><a class="idref" href="Wand.html#6603aec78c9eb740e019d90c70dd37f<sub>7</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="Wand.html#J:297"><span class="id" title="variable">J</span></a> <a class="idref" href="Wand.html#x:299"><span class="id" title="variable">x</span></a>) <a class="idref" href="Wand.html#Q:298"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_conseq"><span class="id" title="lemma">triple_conseq</span></a> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#NewQwand.hforall_specialize"><span class="id" title="lemma">hforall_specialize</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.qimpl_refl"><span class="id" title="lemma">qimpl_refl</span></a>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab336"></a><h2 class="section">Alternative Definition of <span class="inlinecode"><span class="id" title="var">qwand</span></span></h2>

</div>
<div class="code">

<span class="id" title="var">Declare</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">qwand_scope</span>.<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">qwand_scope</span>.<br/>
</div>

<div class="doc">
We are now read to state the alternative definition of <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span></span>,
    as the heap predicate <span class="inlinecode">\<span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">v</span>,</span> <span class="inlinecode">(<span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">v</span>)</span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode">(<span class="id" title="var">Q<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">v</span>)</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="NewQwand.qwand" class="idref" href="#NewQwand.qwand"><span class="id" title="definition">qwand</span></a> (<a id="Q<sub>1</sub>:300" class="idref" href="#Q<sub>1</sub>:300"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:301" class="idref" href="#Q<sub>2</sub>:301"><span class="id" title="binder">Q<sub>2</sub></span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#6603aec78c9eb740e019d90c70dd37f<sub>7</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Wand.html#6603aec78c9eb740e019d90c70dd37f<sub>7</sub>"><span class="id" title="notation">∀</span></a> <a id="v:302" class="idref" href="#v:302"><span class="id" title="binder">v</span></a><a class="idref" href="Wand.html#6603aec78c9eb740e019d90c70dd37f<sub>7</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:300"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Wand.html#v:302"><span class="id" title="variable">v</span></a><a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation">)</span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>2</sub>:301"><span class="id" title="variable">Q<sub>2</sub></span></a> <a class="idref" href="Wand.html#v:302"><span class="id" title="variable">v</span></a><a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation">)</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <a id="0f15db512d698ddeb3443f1a5ef0c869" class="idref" href="#0f15db512d698ddeb3443f1a5ef0c869"><span class="id" title="notation">&quot;</span></a>Q<sub>1</sub> <span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span> Q<sub>2</sub>" := (<a class="idref" href="Wand.html#NewQwand.qwand"><span class="id" title="definition">qwand</span></a> <span class="id" title="var">Q<sub>1</sub></span> <span class="id" title="var">Q<sub>2</sub></span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 43) : <span class="id" title="var">qwand_scope</span>.<br/>
</div>

<div class="doc">
Let us establish the properties of the new definition of <span class="inlinecode"><span class="id" title="var">qwand</span></span>.

<div class="paragraph"> </div>

    We begin by the specialization lemma, which asserts that <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span></span>
    can be specialized to <span class="inlinecode">(<span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">v</span>)</span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode">(<span class="id" title="var">Q<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">v</span>)</span> for any value <span class="inlinecode"><span class="id" title="var">v</span></span>. This
    result is a direct consequence of the corresponding specialization
    property of <span class="inlinecode">\<span class="id" title="keyword">∀</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="NewQwand.qwand_specialize" class="idref" href="#NewQwand.qwand_specialize"><span class="id" title="lemma">qwand_specialize</span></a> : <span class="id" title="keyword">∀</span> (<a id="v:303" class="idref" href="#v:303"><span class="id" title="binder">v</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) (<a id="Q<sub>1</sub>:304" class="idref" href="#Q<sub>1</sub>:304"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:305" class="idref" href="#Q<sub>2</sub>:305"><span class="id" title="binder">Q<sub>2</sub></span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:304"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Wand.html#0f15db512d698ddeb3443f1a5ef0c869"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:305"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:304"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Wand.html#v:303"><span class="id" title="variable">v</span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:305"><span class="id" title="variable">Q<sub>2</sub></span></a> <a class="idref" href="Wand.html#v:303"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Wand.html#NewQwand.qwand"><span class="id" title="definition">qwand</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#NewQwand.himpl_hforall_l"><span class="id" title="lemma">himpl_hforall_l</span></a> <span class="id" title="var">v</span>. <span class="id" title="var">xsimpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
We next prove the equivalence rule. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="NewQwand.qwand_equiv" class="idref" href="#NewQwand.qwand_equiv"><span class="id" title="lemma">qwand_equiv</span></a> : <span class="id" title="keyword">∀</span> <a id="H:306" class="idref" href="#H:306"><span class="id" title="binder">H</span></a> <a id="Q<sub>1</sub>:307" class="idref" href="#Q<sub>1</sub>:307"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:308" class="idref" href="#Q<sub>2</sub>:308"><span class="id" title="binder">Q<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H:306"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:307"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Wand.html#0f15db512d698ddeb3443f1a5ef0c869"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:308"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>  <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a>  <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:307"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="Wand.html#H:306"><span class="id" title="variable">H</span></a><a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:308"><span class="id" title="variable">Q<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">iff</span> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>. <span class="id" title="var">xchange</span> <span class="id" title="var">M</span>. <span class="id" title="var">xchange</span> (<a class="idref" href="Wand.html#NewQwand.qwand_specialize"><span class="id" title="lemma">qwand_specialize</span></a> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xchange</span> (<a class="idref" href="Wand.html#WandDef.hwand_cancel"><span class="id" title="lemma">hwand_cancel</span></a> (<span class="id" title="var">Q<sub>1</sub></span> <span class="id" title="var">x</span>)). }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#NewQwand.himpl_hforall_r"><span class="id" title="lemma">himpl_hforall_r</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>. <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#WandDef.himpl_hwand_r"><span class="id" title="lemma">himpl_hwand_r</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xchange</span> (<span class="id" title="var">M</span> <span class="id" title="var">x</span>). }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The cancellation rule follows. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="NewQwand.qwand_cancel" class="idref" href="#NewQwand.qwand_cancel"><span class="id" title="lemma">qwand_cancel</span></a> : <span class="id" title="keyword">∀</span> <a id="Q<sub>1</sub>:309" class="idref" href="#Q<sub>1</sub>:309"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:310" class="idref" href="#Q<sub>2</sub>:310"><span class="id" title="binder">Q<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#Q<sub>1</sub>:309"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:309"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Wand.html#0f15db512d698ddeb3443f1a5ef0c869"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:310"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:310"><span class="id" title="variable">Q<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="Wand.html#NewQwand.qwand_equiv"><span class="id" title="lemma">qwand_equiv</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.qimpl_refl"><span class="id" title="lemma">qimpl_refl</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Like <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>, the operation <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span></span> is contravariant in <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span>
    and covariant in <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="NewQwand.qwand_himpl" class="idref" href="#NewQwand.qwand_himpl"><span class="id" title="lemma">qwand_himpl</span></a> : <span class="id" title="keyword">∀</span> <a id="Q<sub>1</sub>:311" class="idref" href="#Q<sub>1</sub>:311"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>1</sub>':312" class="idref" href="#Q<sub>1</sub>':312"><span class="id" title="binder">Q<sub>1</sub>'</span></a> <a id="Q<sub>2</sub>:313" class="idref" href="#Q<sub>2</sub>:313"><span class="id" title="binder">Q<sub>2</sub></span></a> <a id="Q<sub>2</sub>':314" class="idref" href="#Q<sub>2</sub>':314"><span class="id" title="binder">Q<sub>2</sub>'</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#Q<sub>1</sub>':312"><span class="id" title="variable">Q<sub>1</sub>'</span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Wand.html#Q<sub>1</sub>:311"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#Q<sub>2</sub>:313"><span class="id" title="variable">Q<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>':314"><span class="id" title="variable">Q<sub>2</sub>'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:311"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Wand.html#0f15db512d698ddeb3443f1a5ef0c869"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:313"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>':312"><span class="id" title="variable">Q<sub>1</sub>'</span></a> <a class="idref" href="Wand.html#0f15db512d698ddeb3443f1a5ef0c869"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>':314"><span class="id" title="variable">Q<sub>2</sub>'</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="Wand.html#NewQwand.qwand_equiv"><span class="id" title="lemma">qwand_equiv</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xchange</span> (<a class="idref" href="Wand.html#NewQwand.qwand_specialize"><span class="id" title="lemma">qwand_specialize</span></a> <span class="id" title="var">x</span>). <span class="id" title="var">xchange</span> <span class="id" title="var">M<sub>1</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xchange</span> (<a class="idref" href="Wand.html#WandDef.hwand_cancel"><span class="id" title="lemma">hwand_cancel</span></a> (<span class="id" title="var">Q<sub>1</sub></span> <span class="id" title="var">x</span>)). <span class="id" title="var">xchange</span> <span class="id" title="var">M<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Like <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>, the operation <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span></span> can absorb in its RHS
    resources to which it is starred. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="NewQwand.hstar_qwand" class="idref" href="#NewQwand.hstar_qwand"><span class="id" title="lemma">hstar_qwand</span></a> : <span class="id" title="keyword">∀</span> <a id="Q<sub>1</sub>:315" class="idref" href="#Q<sub>1</sub>:315"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:316" class="idref" href="#Q<sub>2</sub>:316"><span class="id" title="binder">Q<sub>2</sub></span></a> <a id="H:317" class="idref" href="#H:317"><span class="id" title="binder">H</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:315"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Wand.html#0f15db512d698ddeb3443f1a5ef0c869"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:316"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H:317"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#Q<sub>1</sub>:315"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Wand.html#0f15db512d698ddeb3443f1a5ef0c869"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#0f15db512d698ddeb3443f1a5ef0c869"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>2</sub>:316"><span class="id" title="variable">Q<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="Wand.html#H:317"><span class="id" title="variable">H</span></a><a class="idref" href="Wand.html#0f15db512d698ddeb3443f1a5ef0c869"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="Wand.html#NewQwand.qwand_equiv"><span class="id" title="lemma">qwand_equiv</span></a>. <span class="id" title="var">xchange</span> (@<a class="idref" href="Wand.html#NewQwand.qwand_cancel"><span class="id" title="lemma">qwand_cancel</span></a> <span class="id" title="var">Q<sub>1</sub></span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab337"></a><h4 class="section">Exercise: 1 star, standard, especially useful (himpl_qwand_hstar_same_r)</h4>
 Prove that <span class="inlinecode"><span class="id" title="var">H</span></span> entails <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span> <span class="inlinecode">(<span class="id" title="var">Q</span></span> <span class="inlinecode"><span class='gray-font'>\</span>*+</span> <span class="inlinecode"><span class="id" title="var">H</span>)</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="NewQwand.himpl_qwand_hstar_same_r" class="idref" href="#NewQwand.himpl_qwand_hstar_same_r"><span class="id" title="lemma">himpl_qwand_hstar_same_r</span></a> : <span class="id" title="keyword">∀</span> <a id="H:318" class="idref" href="#H:318"><span class="id" title="binder">H</span></a> <a id="Q:319" class="idref" href="#Q:319"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H:318"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#Q:319"><span class="id" title="variable">Q</span></a> <a class="idref" href="Wand.html#0f15db512d698ddeb3443f1a5ef0c869"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#0f15db512d698ddeb3443f1a5ef0c869"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q:319"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="Wand.html#H:318"><span class="id" title="variable">H</span></a><a class="idref" href="Wand.html#0f15db512d698ddeb3443f1a5ef0c869"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a id="lab338"></a><h4 class="section">Exercise: 2 stars, standard, optional (qwand_cancel_part)</h4>
 Prove that <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode">((<span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*+</span> <span class="inlinecode"><span class="id" title="var">H</span>)</span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span>)</span> simplifies to <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span></span>.
    Hint: use <span class="inlinecode"><span class="id" title="var">xchange</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="NewQwand.qwand_cancel_part" class="idref" href="#NewQwand.qwand_cancel_part"><span class="id" title="lemma">qwand_cancel_part</span></a> : <span class="id" title="keyword">∀</span> <a id="H:320" class="idref" href="#H:320"><span class="id" title="binder">H</span></a> <a id="Q<sub>1</sub>:321" class="idref" href="#Q<sub>1</sub>:321"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:322" class="idref" href="#Q<sub>2</sub>:322"><span class="id" title="binder">Q<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H:320"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#0f15db512d698ddeb3443f1a5ef0c869"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:321"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="Wand.html#H:320"><span class="id" title="variable">H</span></a><a class="idref" href="Wand.html#0f15db512d698ddeb3443f1a5ef0c869"><span class="id" title="notation">)</span></a> <a class="idref" href="Wand.html#0f15db512d698ddeb3443f1a5ef0c869"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:322"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:321"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Wand.html#0f15db512d698ddeb3443f1a5ef0c869"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:322"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab339"></a><h2 class="section">Equivalence between Alternative Definitions of the Magic Wand</h2>

       for Postconditions 
</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="NewQwand.QwandEquiv" class="idref" href="#NewQwand.QwandEquiv"><span class="id" title="module">QwandEquiv</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">op</span> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>(</span></a><a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>.<br/>
</div>

<div class="doc">
In what follows we prove the equivalence between five equivalent
    characterizations of <span class="inlinecode"><span class="id" title="var">qwand</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>:

<div class="paragraph"> </div>

    1. The definition expressed directly in terms of heaps:
       <span class="inlinecode"><span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">h</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">h'</span>,</span> <span class="inlinecode"><span class="id" title="var">Fmap.disjoint</span></span> <span class="inlinecode"><span class="id" title="var">h</span></span> <span class="inlinecode"><span class="id" title="var">h'</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">h'</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode">(<span class="id" title="var">h</span></span> <span class="inlinecode">\<span class="id" title="var">u</span></span> <span class="inlinecode"><span class="id" title="var">h'</span>)</span>

<div class="paragraph"> </div>

    2. The definition <span class="inlinecode"><span class="id" title="var">qwand</span></span>, expressed in terms of existing operators:
       <span class="inlinecode"><span class='gray-font'>\</span><span class="id" title="tactic">∃</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>0</sub></span>,</span> <span class="inlinecode"><span class="id" title="var">H<sub>0</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class='gray-font'>\</span>[</span> <span class="inlinecode">(<span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*+</span> <span class="inlinecode"><span class="id" title="var">H<sub>0</sub></span>)</span> <span class="inlinecode">===&gt;</span> <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span>]</span>

<div class="paragraph"> </div>

    3. The definition expressed using the universal quantifier:
       <span class="inlinecode">\<span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">v</span>,</span> <span class="inlinecode">(<span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">v</span>)</span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode">(<span class="id" title="var">Q<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">v</span>)</span>

<div class="paragraph"> </div>

    4. The characterization via the equivalence <span class="inlinecode"><span class="id" title="var">hwand_equiv</span></span>:
       <span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>0</sub></span></span> <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span>,</span> <span class="inlinecode">(<span class="id" title="var">H<sub>0</sub></span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span>)</span> <span class="inlinecode">↔</span> <span class="inlinecode">(<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H<sub>0</sub></span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span>)</span>.

<div class="paragraph"> </div>

    5. The characterization via the pair of the introduction rule
       <span class="inlinecode"><span class="id" title="var">himpl_qwand_r</span></span> and the elimination rule <span class="inlinecode"><span class="id" title="var">qwand_cancel</span></span>.

<div class="paragraph"> </div>

    The proof are essentially identical to the equivalence proofs for <span class="inlinecode"><span class="id" title="var">hwand</span></span>,
    except for definition (3), which is specific to <span class="inlinecode"><span class="id" title="var">qwand</span></span>.

</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="NewQwand.QwandEquiv.qwand_characterization_1" class="idref" href="#NewQwand.QwandEquiv.qwand_characterization_1"><span class="id" title="definition">qwand_characterization_1</span></a> <a id="op:323" class="idref" href="#op:323"><span class="id" title="binder">op</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#op:323"><span class="id" title="variable">op</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><span class="id" title="keyword">fun</span> <a id="Q<sub>1</sub>:324" class="idref" href="#Q<sub>1</sub>:324"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:325" class="idref" href="#Q<sub>2</sub>:325"><span class="id" title="binder">Q<sub>2</sub></span></a> ⇒ (<span class="id" title="keyword">fun</span> <a id="h:326" class="idref" href="#h:326"><span class="id" title="binder">h</span></a> ⇒ <span class="id" title="keyword">∀</span> <a id="v:327" class="idref" href="#v:327"><span class="id" title="binder">v</span></a> <a id="h':328" class="idref" href="#h':328"><span class="id" title="binder">h'</span></a>, <a class="idref" href="LibSepReference.html#Fmap.disjoint"><span class="id" title="definition">Fmap.disjoint</span></a> <a class="idref" href="Wand.html#h:326"><span class="id" title="variable">h</span></a> <a class="idref" href="Wand.html#h':328"><span class="id" title="variable">h'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Wand.html#Q<sub>1</sub>:324"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Wand.html#v:327"><span class="id" title="variable">v</span></a> <a class="idref" href="Wand.html#h':328"><span class="id" title="variable">h'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:325"><span class="id" title="variable">Q<sub>2</sub></span></a> <a class="idref" href="Wand.html#v:327"><span class="id" title="variable">v</span></a> (<a class="idref" href="Wand.html#h:326"><span class="id" title="variable">h</span></a> <a class="idref" href="LibSepReference.html#11dbc5cc324072f557c3f348a31ba1a<sub>0</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#11dbc5cc324072f557c3f348a31ba1a<sub>0</sub>"><span class="id" title="notation">u</span></a> <a class="idref" href="Wand.html#h':328"><span class="id" title="variable">h'</span></a>))<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="NewQwand.QwandEquiv.qwand_characterization_2" class="idref" href="#NewQwand.QwandEquiv.qwand_characterization_2"><span class="id" title="definition">qwand_characterization_2</span></a> <a id="op:329" class="idref" href="#op:329"><span class="id" title="binder">op</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#op:329"><span class="id" title="variable">op</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><span class="id" title="keyword">fun</span> <a id="Q<sub>1</sub>:330" class="idref" href="#Q<sub>1</sub>:330"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:331" class="idref" href="#Q<sub>2</sub>:331"><span class="id" title="binder">Q<sub>2</sub></span></a> ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="H<sub>0</sub>:332" class="idref" href="#H<sub>0</sub>:332"><span class="id" title="binder">H<sub>0</sub></span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Wand.html#H<sub>0</sub>:332"><span class="id" title="variable">H<sub>0</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a> <a class="idref" href="Wand.html#Q<sub>1</sub>:330"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="Wand.html#H<sub>0</sub>:332"><span class="id" title="variable">H<sub>0</sub></span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:331"><span class="id" title="variable">Q<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="NewQwand.QwandEquiv.qwand_characterization_3" class="idref" href="#NewQwand.QwandEquiv.qwand_characterization_3"><span class="id" title="definition">qwand_characterization_3</span></a> <a id="op:333" class="idref" href="#op:333"><span class="id" title="binder">op</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#op:333"><span class="id" title="variable">op</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><span class="id" title="keyword">fun</span> <a id="Q<sub>1</sub>:334" class="idref" href="#Q<sub>1</sub>:334"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:335" class="idref" href="#Q<sub>2</sub>:335"><span class="id" title="binder">Q<sub>2</sub></span></a> ⇒ <a class="idref" href="Wand.html#6603aec78c9eb740e019d90c70dd37f<sub>7</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Wand.html#6603aec78c9eb740e019d90c70dd37f<sub>7</sub>"><span class="id" title="notation">∀</span></a> <a id="v:336" class="idref" href="#v:336"><span class="id" title="binder">v</span></a><a class="idref" href="Wand.html#6603aec78c9eb740e019d90c70dd37f<sub>7</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:334"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Wand.html#v:336"><span class="id" title="variable">v</span></a><a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation">)</span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>2</sub>:335"><span class="id" title="variable">Q<sub>2</sub></span></a> <a class="idref" href="Wand.html#v:336"><span class="id" title="variable">v</span></a><a class="idref" href="Wand.html#cadd6f49c30621202b890edaa339e04b"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="NewQwand.QwandEquiv.qwand_characterization_4" class="idref" href="#NewQwand.QwandEquiv.qwand_characterization_4"><span class="id" title="definition">qwand_characterization_4</span></a> <a id="op:337" class="idref" href="#op:337"><span class="id" title="binder">op</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="H<sub>0</sub>:338" class="idref" href="#H<sub>0</sub>:338"><span class="id" title="binder">H<sub>0</sub></span></a> <a id="Q<sub>1</sub>:339" class="idref" href="#Q<sub>1</sub>:339"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:340" class="idref" href="#Q<sub>2</sub>:340"><span class="id" title="binder">Q<sub>2</sub></span></a>, <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>0</sub>:338"><span class="id" title="variable">H<sub>0</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#op:337"><span class="id" title="variable">op</span></a> <a class="idref" href="Wand.html#Q<sub>1</sub>:339"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:340"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:339"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="Wand.html#H<sub>0</sub>:338"><span class="id" title="variable">H<sub>0</sub></span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:340"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="NewQwand.QwandEquiv.qwand_characterization_5" class="idref" href="#NewQwand.QwandEquiv.qwand_characterization_5"><span class="id" title="definition">qwand_characterization_5</span></a> <a id="op:341" class="idref" href="#op:341"><span class="id" title="binder">op</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="H<sub>0</sub>:342" class="idref" href="#H<sub>0</sub>:342"><span class="id" title="binder">H<sub>0</sub></span></a> <a id="Q<sub>1</sub>:343" class="idref" href="#Q<sub>1</sub>:343"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:344" class="idref" href="#Q<sub>2</sub>:344"><span class="id" title="binder">Q<sub>2</sub></span></a>, <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:343"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="Wand.html#H<sub>0</sub>:342"><span class="id" title="variable">H<sub>0</sub></span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:344"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>0</sub>:342"><span class="id" title="variable">H<sub>0</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#op:341"><span class="id" title="variable">op</span></a> <a class="idref" href="Wand.html#Q<sub>1</sub>:343"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:344"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="Q<sub>1</sub>:345" class="idref" href="#Q<sub>1</sub>:345"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:346" class="idref" href="#Q<sub>2</sub>:346"><span class="id" title="binder">Q<sub>2</sub></span></a>, (<a class="idref" href="Wand.html#Q<sub>1</sub>:345"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#op:341"><span class="id" title="variable">op</span></a> <a class="idref" href="Wand.html#Q<sub>1</sub>:345"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:346"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:346"><span class="id" title="variable">Q<sub>2</sub></span></a>)<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="NewQwand.QwandEquiv.hwand_characterization_1_eq_2" class="idref" href="#NewQwand.QwandEquiv.hwand_characterization_1_eq_2"><span class="id" title="lemma">hwand_characterization_1_eq_2</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#NewQwand.QwandEquiv.qwand_characterization_1"><span class="id" title="definition">qwand_characterization_1</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Wand.html#NewQwand.QwandEquiv.qwand_characterization_2"><span class="id" title="definition">qwand_characterization_2</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <span class="id" title="lemma">pred_ext_1</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">op</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Wand.html#NewQwand.QwandEquiv.qwand_characterization_1"><span class="id" title="definition">qwand_characterization_1</span></a>, <a class="idref" href="Wand.html#NewQwand.QwandEquiv.qwand_characterization_2"><span class="id" title="definition">qwand_characterization_2</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">asserts</span> <span class="id" title="var">K</span>: (<span class="id" title="keyword">∀</span> <a id="A:349" class="idref" href="#A:349"><span class="id" title="binder">A</span></a> <a id="B:350" class="idref" href="#B:350"><span class="id" title="binder">B</span></a>, <a class="idref" href="Wand.html#A:347"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Wand.html#B:348"><span class="id" title="variable">B</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="var">op</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Wand.html#A:347"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <span class="id" title="var">op</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Wand.html#B:348"><span class="id" title="variable">B</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span>. <span class="id" title="var">iff</span>; <span class="id" title="tactic">subst</span>*. } <span class="id" title="tactic">apply</span> <span class="id" title="var">K</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">K</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">pred_ext_3</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Q<sub>1</sub></span> <span class="id" title="var">Q<sub>2</sub></span> <span class="id" title="var">h</span>. <span class="id" title="var">iff</span> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">∃</span> (<span class="id" title="notation">=</span><span class="id" title="var">h</span>). <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_hpure_r"><span class="id" title="lemma">hstar_hpure_r</span></a>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">v</span> <span class="id" title="var">h<sub>3</sub></span> <span class="id" title="var">K<sub>3</sub></span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_comm"><span class="id" title="lemma">hstar_comm</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">K<sub>3</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">K<sub>3</sub></span> <span class="id" title="keyword">as</span> (<span class="id" title="var">h<sub>1</sub></span>&amp;<span class="id" title="var">h<sub>2</sub></span>&amp;<span class="id" title="var">K<sub>1</sub></span>&amp;<span class="id" title="var">K<sub>2</sub></span>&amp;<span class="id" title="var">D</span>&amp;<span class="id" title="var">U</span>). <span class="id" title="tactic">subst</span> <span class="id" title="var">h<sub>1</sub></span> <span class="id" title="var">h<sub>3</sub></span>. <span class="id" title="var">applys</span> <span class="id" title="var">M</span> <span class="id" title="var">D</span> <span class="id" title="var">K<sub>2</sub></span>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">v</span> <span class="id" title="var">h<sub>1</sub></span> <span class="id" title="var">D</span> <span class="id" title="var">K<sub>1</sub></span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">M</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">H<sub>0</sub></span>&amp;<span class="id" title="var">M</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">M</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">h<sub>0</sub></span>&amp;<span class="id" title="var">h<sub>2</sub></span>&amp;<span class="id" title="var">K<sub>0</sub></span>&amp;<span class="id" title="var">K<sub>2</sub></span>&amp;<span class="id" title="var">D'</span>&amp;<span class="id" title="var">U</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lets</span> (<span class="id" title="var">N</span>&amp;<span class="id" title="var">E</span>): <a class="idref" href="LibSepReference.html#SepSimplArgs.hpure_inv"><span class="id" title="lemma">hpure_inv</span></a> (<span class="id" title="definition">rm</span> <span class="id" title="var">K<sub>2</sub></span>). <span class="id" title="tactic">subst</span> <span class="id" title="var">h</span> <span class="id" title="var">h<sub>2</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#Fmap.union_empty_r"><span class="id" title="lemma">Fmap.union_empty_r</span></a> <span class="id" title="keyword">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">applys</span> <span class="id" title="var">N</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_comm"><span class="id" title="lemma">hstar_comm</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_intro"><span class="id" title="lemma">hstar_intro</span></a> <span class="id" title="var">K<sub>0</sub></span> <span class="id" title="var">K<sub>1</sub></span> <span class="id" title="var">D</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="NewQwand.QwandEquiv.qwand_characterization_2_eq_3" class="idref" href="#NewQwand.QwandEquiv.qwand_characterization_2_eq_3"><span class="id" title="lemma">qwand_characterization_2_eq_3</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#NewQwand.QwandEquiv.qwand_characterization_2"><span class="id" title="definition">qwand_characterization_2</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Wand.html#NewQwand.QwandEquiv.qwand_characterization_3"><span class="id" title="definition">qwand_characterization_3</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <span class="id" title="lemma">pred_ext_1</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">op</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Wand.html#NewQwand.QwandEquiv.qwand_characterization_2"><span class="id" title="definition">qwand_characterization_2</span></a>, <a class="idref" href="Wand.html#NewQwand.QwandEquiv.qwand_characterization_3"><span class="id" title="definition">qwand_characterization_3</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">asserts</span> <span class="id" title="var">K</span>: (<span class="id" title="keyword">∀</span> <a id="A:353" class="idref" href="#A:353"><span class="id" title="binder">A</span></a> <a id="B:354" class="idref" href="#B:354"><span class="id" title="binder">B</span></a>, <a class="idref" href="Wand.html#A:351"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Wand.html#B:352"><span class="id" title="variable">B</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="var">op</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Wand.html#A:351"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <span class="id" title="var">op</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Wand.html#B:352"><span class="id" title="variable">B</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span>. <span class="id" title="var">iff</span>; <span class="id" title="tactic">subst</span>*. } <span class="id" title="tactic">apply</span> <span class="id" title="var">K</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">K</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">fun_ext_2</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Q<sub>1</sub></span> <span class="id" title="var">Q<sub>2</sub></span>. <span class="id" title="tactic">apply</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_antisym"><span class="id" title="lemma">himpl_antisym</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H<sub>0</sub></span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#NewQwand.himpl_hforall_r"><span class="id" title="lemma">himpl_hforall_r</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">v</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="Wand.html#WandDef.hwand_equiv"><span class="id" title="lemma">hwand_equiv</span></a>. <span class="id" title="var">xchange</span> <span class="id" title="var">M</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span> (<a class="idref" href="Wand.html#NewQwand.qwand"><span class="id" title="definition">qwand</span></a> <span class="id" title="var">Q<sub>1</sub></span> <span class="id" title="var">Q<sub>2</sub></span>). <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#NewQwand.qwand_cancel"><span class="id" title="lemma">qwand_cancel</span></a>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="NewQwand.QwandEquiv.qwand_characterization_2_eq_4" class="idref" href="#NewQwand.QwandEquiv.qwand_characterization_2_eq_4"><span class="id" title="lemma">qwand_characterization_2_eq_4</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#NewQwand.QwandEquiv.qwand_characterization_2"><span class="id" title="definition">qwand_characterization_2</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Wand.html#NewQwand.QwandEquiv.qwand_characterization_4"><span class="id" title="definition">qwand_characterization_4</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <span class="id" title="lemma">pred_ext_1</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">op</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Wand.html#NewQwand.QwandEquiv.qwand_characterization_2"><span class="id" title="definition">qwand_characterization_2</span></a>, <a class="idref" href="Wand.html#NewQwand.QwandEquiv.qwand_characterization_4"><span class="id" title="definition">qwand_characterization_4</span></a>. <span class="id" title="var">iff</span> <span class="id" title="var">K</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">iff</span> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">xchange</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">v</span> <span class="id" title="var">H<sub>3</sub></span> <span class="id" title="var">N</span>. <span class="id" title="var">xchange</span> <span class="id" title="var">N</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span> <span class="id" title="var">H<sub>0</sub></span>. <span class="id" title="var">xchange</span> <span class="id" title="var">M</span>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="lemma">fun_ext_2</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="tactic">apply</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_antisym"><span class="id" title="lemma">himpl_antisym</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">lets</span> (<span class="id" title="var">M</span>&amp;<span class="id" title="var">_</span>): (<span class="id" title="var">K</span> (<span class="id" title="var">op</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>) <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>). <span class="id" title="var">xsimpl</span> (<span class="id" title="var">op</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">applys</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_refl"><span class="id" title="lemma">himpl_refl</span></a>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H<sub>0</sub></span> <span class="id" title="var">M</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span> <span class="id" title="var">M</span>. } }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="NewQwand.QwandEquiv.qwand_characterization_4_eq_5" class="idref" href="#NewQwand.QwandEquiv.qwand_characterization_4_eq_5"><span class="id" title="lemma">qwand_characterization_4_eq_5</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#NewQwand.QwandEquiv.qwand_characterization_4"><span class="id" title="definition">qwand_characterization_4</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Wand.html#NewQwand.QwandEquiv.qwand_characterization_5"><span class="id" title="definition">qwand_characterization_5</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <span class="id" title="lemma">pred_ext_1</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">op</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Wand.html#NewQwand.QwandEquiv.qwand_characterization_4"><span class="id" title="definition">qwand_characterization_4</span></a>, <a class="idref" href="Wand.html#NewQwand.QwandEquiv.qwand_characterization_5"><span class="id" title="definition">qwand_characterization_5</span></a>. <span class="id" title="var">iff</span> <span class="id" title="var">K</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">apply</span> &lt;- <span class="id" title="var">K</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">M</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">K</span>. <span class="id" title="tactic">auto</span>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> <span class="id" title="var">K</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">K<sub>1</sub></span>&amp;<span class="id" title="var">K<sub>2</sub></span>). <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">xchange</span> <span class="id" title="var">M</span>. <span class="id" title="var">xchange</span> (<span class="id" title="var">K<sub>2</sub></span> <span class="id" title="var">Q<sub>1</sub></span> <span class="id" title="var">Q<sub>2</sub></span>). }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <span class="id" title="var">K<sub>1</sub></span>. <span class="id" title="var">applys</span> <span class="id" title="var">M</span>. } }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="Wand.html#NewQwand.QwandEquiv"><span class="id" title="module">QwandEquiv</span></a>.<br/>
</div>

<div class="doc">
<a id="lab340"></a><h2 class="section">Simplified Definition of <span class="inlinecode"><span class="id" title="var">mkstruct</span></span></h2>

<div class="paragraph"> </div>

 The definition of <span class="inlinecode"><span class="id" title="var">mkstruct</span></span> can be simplified using the magic
    wand operator for postconditions.

<div class="paragraph"> </div>

    Recall the definition of <span class="inlinecode"><span class="id" title="var">mkstruct</span></span> from chapter <a href="WPgen.html"><span class="inlineref">WPgen</span></a>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="NewQwand.mkstruct'" class="idref" href="#NewQwand.mkstruct'"><span class="id" title="definition">mkstruct'</span></a> (<a id="F:355" class="idref" href="#F:355"><span class="id" title="binder">F</span></a>:<a class="idref" href="LibSepReference.html#formula"><span class="id" title="definition">formula</span></a>) : <a class="idref" href="LibSepReference.html#formula"><span class="id" title="definition">formula</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<a id="Q:356" class="idref" href="#Q:356"><span class="id" title="binder">Q</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="Q<sub>1</sub>:357" class="idref" href="#Q<sub>1</sub>:357"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="H:358" class="idref" href="#H:358"><span class="id" title="binder">H</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Wand.html#F:355"><span class="id" title="variable">F</span></a> <a class="idref" href="Wand.html#Q<sub>1</sub>:357"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H:358"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:357"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="Wand.html#H:358"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Wand.html#Q:356"><span class="id" title="variable">Q</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>.<br/>
</div>

<div class="doc">
Observe that the fragment <span class="inlinecode"><span class='gray-font'>\</span><span class="id" title="tactic">∃</span></span> <span class="inlinecode"><span class="id" title="var">H</span>,</span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*+</span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">===&gt;</span> <span class="inlinecode"><span class="id" title="var">Q</span>]</span>
    is equivalent to <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>. This observation leads to the following
    more concise reformulation of the definition of <span class="inlinecode"><span class="id" title="var">mkstruct</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="NewQwand.mkstruct" class="idref" href="#NewQwand.mkstruct"><span class="id" title="definition">mkstruct</span></a> (<a id="F:359" class="idref" href="#F:359"><span class="id" title="binder">F</span></a>:<a class="idref" href="LibSepReference.html#formula"><span class="id" title="definition">formula</span></a>) : <a class="idref" href="LibSepReference.html#formula"><span class="id" title="definition">formula</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="Q:360" class="idref" href="#Q:360"><span class="id" title="binder">Q</span></a> ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="Q<sub>1</sub>:361" class="idref" href="#Q<sub>1</sub>:361"><span class="id" title="binder">Q<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Wand.html#F:359"><span class="id" title="variable">F</span></a> <a class="idref" href="Wand.html#Q<sub>1</sub>:361"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:361"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Wand.html#0f15db512d698ddeb3443f1a5ef0c869"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q:360"><span class="id" title="variable">Q</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>.<br/>
</div>

<div class="doc">
Let us prove, for this revised definition, that <span class="inlinecode"><span class="id" title="var">mkstruct</span></span> satisfies
    the three required properties (recall <span class="inlinecode"><span class="id" title="var">WPgen</span></span>): <span class="inlinecode"><span class="id" title="var">mkstruct_erase</span></span>,
    <span class="inlinecode"><span class="id" title="var">mkstruct_frame</span></span>, and <span class="inlinecode"><span class="id" title="var">mkstruct_conseq</span></span>. In these proofs, we assume
    the revised definition of <span class="inlinecode"><span class="id" title="var">qwand</span></span> expressed in terms of <span class="inlinecode"><span class="id" title="var">hwand</span></span>
    and <span class="inlinecode"><span class="id" title="var">hforall</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="NewQwand.mkstruct_erase" class="idref" href="#NewQwand.mkstruct_erase"><span class="id" title="lemma">mkstruct_erase</span></a> : <span class="id" title="keyword">∀</span> <a id="F:362" class="idref" href="#F:362"><span class="id" title="binder">F</span></a> <a id="Q:363" class="idref" href="#Q:363"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#F:362"><span class="id" title="variable">F</span></a> <a class="idref" href="Wand.html#Q:363"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#NewQwand.mkstruct"><span class="id" title="definition">mkstruct</span></a> <a class="idref" href="Wand.html#F:362"><span class="id" title="variable">F</span></a> <a class="idref" href="Wand.html#Q:363"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Wand.html#NewQwand.mkstruct"><span class="id" title="definition">mkstruct</span></a>. <span class="id" title="var">xsimpl</span> <span class="id" title="var">Q</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="Wand.html#NewQwand.qwand_equiv"><span class="id" title="lemma">qwand_equiv</span></a>. <span class="id" title="var">xsimpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="NewQwand.mkstruct_conseq" class="idref" href="#NewQwand.mkstruct_conseq"><span class="id" title="lemma">mkstruct_conseq</span></a> : <span class="id" title="keyword">∀</span> <a id="F:364" class="idref" href="#F:364"><span class="id" title="binder">F</span></a> <a id="Q<sub>1</sub>:365" class="idref" href="#Q<sub>1</sub>:365"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:366" class="idref" href="#Q<sub>2</sub>:366"><span class="id" title="binder">Q<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#Q<sub>1</sub>:365"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:366"><span class="id" title="variable">Q<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#NewQwand.mkstruct"><span class="id" title="definition">mkstruct</span></a> <a class="idref" href="Wand.html#F:364"><span class="id" title="variable">F</span></a> <a class="idref" href="Wand.html#Q<sub>1</sub>:365"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#NewQwand.mkstruct"><span class="id" title="definition">mkstruct</span></a> <a class="idref" href="Wand.html#F:364"><span class="id" title="variable">F</span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:366"><span class="id" title="variable">Q<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">WQ</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Wand.html#NewQwand.mkstruct"><span class="id" title="definition">mkstruct</span></a>. <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Q'</span>. <span class="id" title="var">xsimpl</span> <span class="id" title="var">Q'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="Wand.html#NewQwand.qwand_equiv"><span class="id" title="lemma">qwand_equiv</span></a>. <span class="id" title="var">xchange</span> <a class="idref" href="Wand.html#NewQwand.qwand_cancel"><span class="id" title="lemma">qwand_cancel</span></a>. <span class="id" title="var">xchange</span> <span class="id" title="var">WQ</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="NewQwand.mkstruct_frame" class="idref" href="#NewQwand.mkstruct_frame"><span class="id" title="lemma">mkstruct_frame</span></a> : <span class="id" title="keyword">∀</span> <a id="F:367" class="idref" href="#F:367"><span class="id" title="binder">F</span></a> <a id="H:368" class="idref" href="#H:368"><span class="id" title="binder">H</span></a> <a id="Q:369" class="idref" href="#Q:369"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#NewQwand.mkstruct"><span class="id" title="definition">mkstruct</span></a> <a class="idref" href="Wand.html#F:367"><span class="id" title="variable">F</span></a> <a class="idref" href="Wand.html#Q:369"><span class="id" title="variable">Q</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H:368"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#NewQwand.mkstruct"><span class="id" title="definition">mkstruct</span></a> <a class="idref" href="Wand.html#F:367"><span class="id" title="variable">F</span></a> (<a class="idref" href="Wand.html#Q:369"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="Wand.html#H:368"><span class="id" title="variable">H</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Wand.html#NewQwand.mkstruct"><span class="id" title="definition">mkstruct</span></a>. <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Q'</span>. <span class="id" title="var">xsimpl</span> <span class="id" title="var">Q'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="Wand.html#NewQwand.qwand_equiv"><span class="id" title="lemma">qwand_equiv</span></a>. <span class="id" title="var">xchange</span> <a class="idref" href="Wand.html#NewQwand.qwand_cancel"><span class="id" title="lemma">qwand_cancel</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="Wand.html#NewQwand"><span class="id" title="module">NewQwand</span></a>.<br/>
</div>

<div class="doc">
<a id="lab341"></a><h2 class="section">Texan Triples</h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="TexanTriples" class="idref" href="#TexanTriples"><span class="id" title="module">TexanTriples</span></a>.<br/>
</div>

<div class="doc">
In this section, we assume a version of <span class="inlinecode"><span class="id" title="var">xsimpl</span></span> that handles
    the magic wand. Note that <span class="inlinecode"><span class="id" title="var">hforall</span></span> and other operators are
    set "Opaque", their definitions cannot be unfolded. 
</div>
<div class="code">

<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">v</span> <span class="id" title="var">w</span> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">p</span> : <a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>.<br/>
</div>

<div class="doc">
<a id="lab342"></a><h3 class="section">1. Example of Texan Triples</h3>

<div class="paragraph"> </div>

 In this section, we show that specification triples can be presented
    in a different style using weakest preconditions. 
<div class="paragraph"> </div>

 Consider for example the specification triple for allocation. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="TexanTriples.triple_ref" class="idref" href="#TexanTriples.triple_ref"><span class="id" title="axiom">triple_ref</span></a> : <span class="id" title="keyword">∀</span> <a id="v:370" class="idref" href="#v:370"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_ref"><span class="id" title="constructor">val_ref</span></a> <a class="idref" href="Wand.html#v:370"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:373" class="idref" href="#p:373"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Wand.html#p:371"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#v:370"><span class="id" title="variable">v</span></a>).<br/>
</div>

<div class="doc">
This specification can be equivalently reformulated in the following
    form. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="TexanTriples.wp_ref" class="idref" href="#TexanTriples.wp_ref"><span class="id" title="axiom">wp_ref</span></a> : <span class="id" title="keyword">∀</span> <a id="Q:375" class="idref" href="#Q:375"><span class="id" title="binder">Q</span></a> <a id="v:376" class="idref" href="#v:376"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">∀</span></a> <a id="p:377" class="idref" href="#p:377"><span class="id" title="binder">p</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="Wand.html#p:377"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#v:376"><span class="id" title="variable">v</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q:375"><span class="id" title="variable">Q</span></a> (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Wand.html#p:377"><span class="id" title="variable">p</span></a>)<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#val_ref"><span class="id" title="constructor">val_ref</span></a> <a class="idref" href="Wand.html#v:376"><span class="id" title="variable">v</span></a>) <a class="idref" href="Wand.html#Q:375"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
Above, we purposely left the empty heap predicate to the front to
    indicate where the precondition, if it were not empty, would go in
    the reformulation. 
<div class="paragraph"> </div>

 In what follows, we describe the chain of transformation that can take us
    from the triple form to the <span class="inlinecode"><span class="id" title="var">wp</span></span> form, and establish the reciprocal.
    We then formalize the general pattern for translating a triple
    into a "texan triple" (i.e., the wp-based specification). 
<div class="paragraph"> </div>

 By replacing <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> with <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>, the specification
    <span class="inlinecode"><span class="id" title="var">triple_ref</span></span> can be reformulated as follows. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="TexanTriples.wp_ref_0" class="idref" href="#TexanTriples.wp_ref_0"><span class="id" title="lemma">wp_ref_0</span></a> : <span class="id" title="keyword">∀</span> <a id="v:379" class="idref" href="#v:379"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#val_ref"><span class="id" title="constructor">val_ref</span></a> <a class="idref" href="Wand.html#v:379"><span class="id" title="variable">v</span></a>) (<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:382" class="idref" href="#p:382"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Wand.html#p:380"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#v:379"><span class="id" title="variable">v</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#TexanTriples.triple_ref"><span class="id" title="axiom">triple_ref</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
We wish to cast the RHS in the form <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode">(<span class="id" title="var">val_ref</span></span> <span class="inlinecode"><span class="id" title="var">v</span>)</span> <span class="inlinecode"><span class="id" title="var">Q</span></span> for an abstract
    variable <span class="inlinecode"><span class="id" title="var">Q</span></span>. To that end, we reformulate the above statement by including
    a magic wand relating the current postcondition, which is
    <span class="inlinecode">(<span class="id" title="var">funloc</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">v</span>)</span>, and <span class="inlinecode"><span class="id" title="var">Q</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="TexanTriples.wp_ref_1" class="idref" href="#TexanTriples.wp_ref_1"><span class="id" title="lemma">wp_ref_1</span></a> : <span class="id" title="keyword">∀</span> <a id="Q:383" class="idref" href="#Q:383"><span class="id" title="binder">Q</span></a> <a id="v:384" class="idref" href="#v:384"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#5609a52f091556b9923d5758aa61f543"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:387" class="idref" href="#p:387"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Wand.html#p:385"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#v:384"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#5609a52f091556b9923d5758aa61f543"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#5609a52f091556b9923d5758aa61f543"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q:383"><span class="id" title="variable">Q</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#val_ref"><span class="id" title="constructor">val_ref</span></a> <a class="idref" href="Wand.html#v:384"><span class="id" title="variable">v</span></a>) <a class="idref" href="Wand.html#Q:383"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">xchange</span> (<a class="idref" href="Wand.html#TexanTriples.wp_ref_0"><span class="id" title="lemma">wp_ref_0</span></a> <span class="id" title="var">v</span>). <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#wp_ramified"><span class="id" title="lemma">wp_ramified</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
This statement can be made slightly more readable by unfolding the
    definition of the magic wand for postconditions, as shown next. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="TexanTriples.wp_ref_2" class="idref" href="#TexanTriples.wp_ref_2"><span class="id" title="lemma">wp_ref_2</span></a> : <span class="id" title="keyword">∀</span> <a id="Q:388" class="idref" href="#Q:388"><span class="id" title="binder">Q</span></a> <a id="v:389" class="idref" href="#v:389"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">∀</span></a> <a id="r:390" class="idref" href="#r:390"><span class="id" title="binder">r</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">,</span></a>     <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="p:391" class="idref" href="#p:391"><span class="id" title="binder">p</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Wand.html#r:390"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Wand.html#p:391"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#p:391"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#v:389"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q:388"><span class="id" title="variable">Q</span></a> <a class="idref" href="Wand.html#r:390"><span class="id" title="variable">r</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#val_ref"><span class="id" title="constructor">val_ref</span></a> <a class="idref" href="Wand.html#v:389"><span class="id" title="variable">v</span></a>) <a class="idref" href="Wand.html#Q:388"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans"><span class="id" title="lemma">himpl_trans</span></a> <a class="idref" href="Wand.html#TexanTriples.wp_ref_1"><span class="id" title="lemma">wp_ref_1</span></a>. <span class="id" title="var">xsimpl</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Interestingly, the variable <span class="inlinecode"><span class="id" title="var">r</span></span>, which is equal to <span class="inlinecode"><span class="id" title="var">val_loc</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>,
    can now be substituted away, further increasing readability.
    We obtain the specificaiton of <span class="inlinecode"><span class="id" title="var">val_ref</span></span> in "Texan triple style". 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="TexanTriples.wp_ref_3" class="idref" href="#TexanTriples.wp_ref_3"><span class="id" title="lemma">wp_ref_3</span></a> : <span class="id" title="keyword">∀</span> <a id="Q:392" class="idref" href="#Q:392"><span class="id" title="binder">Q</span></a> <a id="v:393" class="idref" href="#v:393"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">∀</span></a> <a id="p:394" class="idref" href="#p:394"><span class="id" title="binder">p</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#p:394"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#v:393"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q:392"><span class="id" title="variable">Q</span></a> (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Wand.html#p:394"><span class="id" title="variable">p</span></a>)<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#val_ref"><span class="id" title="constructor">val_ref</span></a> <a class="idref" href="Wand.html#v:393"><span class="id" title="variable">v</span></a>) <a class="idref" href="Wand.html#Q:392"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans"><span class="id" title="lemma">himpl_trans</span></a> <a class="idref" href="Wand.html#TexanTriples.wp_ref_2"><span class="id" title="lemma">wp_ref_2</span></a>. <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> ? <span class="id" title="var">p</span> →.<br/>
&nbsp;&nbsp;<span class="id" title="var">xchange</span> (<a class="idref" href="LibSepReference.html#SepSimplArgs.hforall_specialize"><span class="id" title="lemma">hforall_specialize</span></a> <span class="id" title="var">p</span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab343"></a><h3 class="section">2. The General Pattern</h3>

<div class="paragraph"> </div>

 In practice, specification triples can (pretty much) all be casted
    in the form: <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">(<span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">r</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="tactic">∃</span></span> <span class="inlinecode"><span class="id" title="var">x<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">x<sub>2</sub></span>,</span> <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">r</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">v</span>]</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H'</span>)</span>.
    In such a specification:

<div class="paragraph"> </div>

<ul class="doclist">
<li> the value <span class="inlinecode"><span class="id" title="var">v</span></span> may depend on the <span class="inlinecode"><span class="id" title="var">xi</span></span>,

</li>
<li> the heap predicate <span class="inlinecode"><span class="id" title="var">H'</span></span> may depend on <span class="inlinecode"><span class="id" title="var">r</span></span> and the <span class="inlinecode"><span class="id" title="var">xi</span></span>,

</li>
<li> the number of existentials <span class="inlinecode"><span class="id" title="var">xi</span></span> may vary, possibly be zero,

</li>
<li> the equality <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">r</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">v</span>]</span> may be removed if no pure fact is needed about <span class="inlinecode"><span class="id" title="var">r</span></span>.

</li>
</ul>

<div class="paragraph"> </div>

    Such a specification triple of the form
    <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">(<span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">r</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="tactic">∃</span></span> <span class="inlinecode"><span class="id" title="var">x<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">x<sub>2</sub></span>,</span> <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">r</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">v</span>]</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H'</span></span>
    can be be reformulated as the Texan triple:
    <span class="inlinecode">(\<span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">x<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">x<sub>2</sub></span>,</span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode"><span class="id" title="var">v</span>)</span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>.

<div class="paragraph"> </div>

    We next formalize the equivalence between the two presentations, for
    the specific case where the specification involves a single auxiliary
    variable, called <span class="inlinecode"><span class="id" title="var">x</span></span>. The statement below makes it explicit that
    <span class="inlinecode"><span class="id" title="var">v</span></span> may depend on <span class="inlinecode"><span class="id" title="var">x</span></span>, and that <span class="inlinecode"><span class="id" title="var">H</span></span> may depend on <span class="inlinecode"><span class="id" title="var">r</span></span> and <span class="inlinecode"><span class="id" title="var">x</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="TexanTriples.texan_triple_equiv" class="idref" href="#TexanTriples.texan_triple_equiv"><span class="id" title="lemma">texan_triple_equiv</span></a> : <span class="id" title="keyword">∀</span> <a id="t:395" class="idref" href="#t:395"><span class="id" title="binder">t</span></a> <a id="H:396" class="idref" href="#H:396"><span class="id" title="binder">H</span></a> <a id="A:397" class="idref" href="#A:397"><span class="id" title="binder">A</span></a> (<a id="Hof:398" class="idref" href="#Hof:398"><span class="id" title="binder">Hof</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="Wand.html#A:397"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) (<a id="vof:399" class="idref" href="#vof:399"><span class="id" title="binder">vof</span></a>:<a class="idref" href="Wand.html#A:397"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Wand.html#t:395"><span class="id" title="variable">t</span></a> <a class="idref" href="Wand.html#H:396"><span class="id" title="variable">H</span></a> (<span class="id" title="keyword">fun</span> <a id="r:400" class="idref" href="#r:400"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="x:401" class="idref" href="#x:401"><span class="id" title="binder">x</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Wand.html#r:400"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Wand.html#vof:399"><span class="id" title="variable">vof</span></a> <a class="idref" href="Wand.html#x:401"><span class="id" title="variable">x</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#Hof:398"><span class="id" title="variable">Hof</span></a> <a class="idref" href="Wand.html#r:400"><span class="id" title="variable">r</span></a> <a class="idref" href="Wand.html#x:401"><span class="id" title="variable">x</span></a>)<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="Q:402" class="idref" href="#Q:402"><span class="id" title="binder">Q</span></a>, <a class="idref" href="Wand.html#H:396"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">∀</span></a> <a id="x:403" class="idref" href="#x:403"><span class="id" title="binder">x</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="Wand.html#Hof:398"><span class="id" title="variable">Hof</span></a> (<a class="idref" href="Wand.html#vof:399"><span class="id" title="variable">vof</span></a> <a class="idref" href="Wand.html#x:403"><span class="id" title="variable">x</span></a>) <a class="idref" href="Wand.html#x:403"><span class="id" title="variable">x</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q:402"><span class="id" title="variable">Q</span></a> (<a class="idref" href="Wand.html#vof:399"><span class="id" title="variable">vof</span></a> <a class="idref" href="Wand.html#x:403"><span class="id" title="variable">x</span></a>)<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="Wand.html#t:395"><span class="id" title="variable">t</span></a> <a class="idref" href="Wand.html#Q:402"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="LibSepReference.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="var">iff</span> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span>. <span class="id" title="var">xchange</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#wp_ramified_trans"><span class="id" title="lemma">wp_ramified_trans</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">r</span> <span class="id" title="var">x</span> →.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xchange</span> (<a class="idref" href="LibSepReference.html#SepSimplArgs.hforall_specialize"><span class="id" title="lemma">hforall_specialize</span></a> <span class="id" title="var">x</span>). }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans"><span class="id" title="lemma">himpl_trans</span></a> <span class="id" title="var">M</span>. <span class="id" title="var">xsimpl</span>¬. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab344"></a><h3 class="section">3. Other Examples</h3>

</div>
<div class="code">

<span class="id" title="keyword">Section</span> <a id="TexanTriples.WpSpecRef" class="idref" href="#TexanTriples.WpSpecRef"><span class="id" title="section">WpSpecRef</span></a>.<br/>
</div>

<div class="doc">
The wp-style specification of <span class="inlinecode"><span class="id" title="var">ref</span></span>, <span class="inlinecode"><span class="id" title="var">get</span></span> and <span class="inlinecode"><span class="id" title="tactic">set</span></span> follow. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="TexanTriples.wp_get" class="idref" href="#TexanTriples.wp_get"><span class="id" title="lemma">wp_get</span></a> : <span class="id" title="keyword">∀</span> <a id="v:404" class="idref" href="#v:404"><span class="id" title="binder">v</span></a> <a id="p:405" class="idref" href="#p:405"><span class="id" title="binder">p</span></a> <a id="Q:406" class="idref" href="#Q:406"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#p:405"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#v:404"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#p:405"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#v:404"><span class="id" title="variable">v</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q:406"><span class="id" title="variable">Q</span></a> <a class="idref" href="Wand.html#v:404"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#val_get"><span class="id" title="constructor">val_get</span></a> <a class="idref" href="Wand.html#p:405"><span class="id" title="variable">p</span></a>) <a class="idref" href="Wand.html#Q:406"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_conseq_frame"><span class="id" title="lemma">triple_conseq_frame</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_get"><span class="id" title="lemma">triple_get</span></a>. } { <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_refl"><span class="id" title="lemma">himpl_refl</span></a>. } { <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> ? →. <span class="id" title="tactic">auto</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="TexanTriples.wp_set" class="idref" href="#TexanTriples.wp_set"><span class="id" title="lemma">wp_set</span></a> : <span class="id" title="keyword">∀</span> <a id="v:407" class="idref" href="#v:407"><span class="id" title="binder">v</span></a> <a id="w:408" class="idref" href="#w:408"><span class="id" title="binder">w</span></a> <a id="p:409" class="idref" href="#p:409"><span class="id" title="binder">p</span></a> <a id="Q:410" class="idref" href="#Q:410"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#p:409"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#v:407"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">∀</span></a> <a id="r:411" class="idref" href="#r:411"><span class="id" title="binder">r</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="Wand.html#p:409"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#w:408"><span class="id" title="variable">w</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q:410"><span class="id" title="variable">Q</span></a> <a class="idref" href="Wand.html#r:411"><span class="id" title="variable">r</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#val_set"><span class="id" title="constructor">val_set</span></a> <a class="idref" href="Wand.html#p:409"><span class="id" title="variable">p</span></a> <a class="idref" href="Wand.html#w:408"><span class="id" title="variable">w</span></a>) <a class="idref" href="Wand.html#Q:410"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_conseq_frame"><span class="id" title="lemma">triple_conseq_frame</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_set"><span class="id" title="lemma">triple_set</span></a>. } { <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_refl"><span class="id" title="lemma">himpl_refl</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">r</span>. <span class="id" title="var">xchange</span> (<a class="idref" href="LibSepReference.html#SepSimplArgs.hforall_specialize"><span class="id" title="lemma">hforall_specialize</span></a> <span class="id" title="var">r</span>). }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="TexanTriples.wp_free" class="idref" href="#TexanTriples.wp_free"><span class="id" title="lemma">wp_free</span></a> : <span class="id" title="keyword">∀</span> <a id="v:412" class="idref" href="#v:412"><span class="id" title="binder">v</span></a> <a id="p:413" class="idref" href="#p:413"><span class="id" title="binder">p</span></a> <a id="Q:414" class="idref" href="#Q:414"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#p:413"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#v:412"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">∀</span></a> <a id="r:415" class="idref" href="#r:415"><span class="id" title="binder">r</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="Wand.html#Q:414"><span class="id" title="variable">Q</span></a> <a class="idref" href="Wand.html#r:415"><span class="id" title="variable">r</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#val_free"><span class="id" title="constructor">val_free</span></a> <a class="idref" href="Wand.html#p:413"><span class="id" title="variable">p</span></a>) <a class="idref" href="Wand.html#Q:414"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_conseq_frame"><span class="id" title="lemma">triple_conseq_frame</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_free"><span class="id" title="lemma">triple_free</span></a>. } { <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_refl"><span class="id" title="lemma">himpl_refl</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">r</span>. <span class="id" title="var">xchange</span> (<a class="idref" href="LibSepReference.html#SepSimplArgs.hforall_specialize"><span class="id" title="lemma">hforall_specialize</span></a> <span class="id" title="var">r</span>). }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Alternatively, we can advertize that <span class="inlinecode"><span class="id" title="tactic">set</span></span> and <span class="inlinecode"><span class="id" title="var">free</span></span> output the unit
    value. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="TexanTriples.triple_set'" class="idref" href="#TexanTriples.triple_set'"><span class="id" title="axiom">triple_set'</span></a> : <span class="id" title="keyword">∀</span> <a id="w:416" class="idref" href="#w:416"><span class="id" title="binder">w</span></a> <a id="p:417" class="idref" href="#p:417"><span class="id" title="binder">p</span></a> <a id="v:418" class="idref" href="#v:418"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_set"><span class="id" title="constructor">val_set</span></a> <a class="idref" href="Wand.html#p:417"><span class="id" title="variable">p</span></a> <a class="idref" href="Wand.html#w:416"><span class="id" title="variable">w</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Wand.html#p:417"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#v:418"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:419" class="idref" href="#r:419"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Wand.html#r:419"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#p:417"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#w:416"><span class="id" title="variable">w</span></a>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Parameter</span> <a id="TexanTriples.triple_free'" class="idref" href="#TexanTriples.triple_free'"><span class="id" title="axiom">triple_free'</span></a> : <span class="id" title="keyword">∀</span> <a id="p:421" class="idref" href="#p:421"><span class="id" title="binder">p</span></a> <a id="v:422" class="idref" href="#v:422"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_free"><span class="id" title="constructor">val_free</span></a> <a class="idref" href="Wand.html#p:421"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Wand.html#p:421"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#v:422"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:423" class="idref" href="#r:423"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Wand.html#r:423"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="TexanTriples.wp_set'" class="idref" href="#TexanTriples.wp_set'"><span class="id" title="lemma">wp_set'</span></a> : <span class="id" title="keyword">∀</span> <a id="v:425" class="idref" href="#v:425"><span class="id" title="binder">v</span></a> <a id="w:426" class="idref" href="#w:426"><span class="id" title="binder">w</span></a> <a id="p:427" class="idref" href="#p:427"><span class="id" title="binder">p</span></a> <a id="Q:428" class="idref" href="#Q:428"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#p:427"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#v:425"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#p:427"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#w:426"><span class="id" title="variable">w</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q:428"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#val_set"><span class="id" title="constructor">val_set</span></a> <a class="idref" href="Wand.html#p:427"><span class="id" title="variable">p</span></a> <a class="idref" href="Wand.html#w:426"><span class="id" title="variable">w</span></a>) <a class="idref" href="Wand.html#Q:428"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_conseq_frame"><span class="id" title="lemma">triple_conseq_frame</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#TexanTriples.triple_set'"><span class="id" title="axiom">triple_set'</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_refl"><span class="id" title="lemma">himpl_refl</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> ? →. <span class="id" title="tactic">auto</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="TexanTriples.wp_free'" class="idref" href="#TexanTriples.wp_free'"><span class="id" title="lemma">wp_free'</span></a> : <span class="id" title="keyword">∀</span> <a id="v:429" class="idref" href="#v:429"><span class="id" title="binder">v</span></a> <a id="w:430" class="idref" href="#w:430"><span class="id" title="binder">w</span></a> <a id="p:431" class="idref" href="#p:431"><span class="id" title="binder">p</span></a> <a id="Q:432" class="idref" href="#Q:432"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#p:431"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#v:429"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q:432"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#val_free"><span class="id" title="constructor">val_free</span></a> <a class="idref" href="Wand.html#p:431"><span class="id" title="variable">p</span></a>) <a class="idref" href="Wand.html#Q:432"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_conseq_frame"><span class="id" title="lemma">triple_conseq_frame</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#TexanTriples.triple_free'"><span class="id" title="axiom">triple_free'</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_refl"><span class="id" title="lemma">himpl_refl</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> ? →. <span class="id" title="tactic">auto</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="Wand.html#TexanTriples.WpSpecRef"><span class="id" title="section">WpSpecRef</span></a>.<br/>
</div>

<div class="doc">
<a id="lab345"></a><h3 class="section">4. Equivalent expressiveness</h3>

<div class="paragraph"> </div>

 Let's show that the specification <span class="inlinecode"><span class="id" title="var">wp_ref_3</span></span> is
    as strong as the original specification <span class="inlinecode"><span class="id" title="var">triple_ref</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="TexanTriples.triple_ref_of_wp_ref_3" class="idref" href="#TexanTriples.triple_ref_of_wp_ref_3"><span class="id" title="lemma">triple_ref_of_wp_ref_3</span></a> : <span class="id" title="keyword">∀</span> <a id="v:433" class="idref" href="#v:433"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_ref"><span class="id" title="constructor">val_ref</span></a> <a class="idref" href="Wand.html#v:433"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:436" class="idref" href="#p:436"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Wand.html#p:434"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#v:433"><span class="id" title="variable">v</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="LibSepReference.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans"><span class="id" title="lemma">himpl_trans</span></a>; [| <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#TexanTriples.wp_ref_3"><span class="id" title="lemma">wp_ref_3</span></a> ].<br/>
&nbsp;&nbsp;<span class="id" title="var">xsimpl</span>*.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Likewise for the other three operations: the triple-based specification
    is derivable from the wp-based specification. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="TexanTriples.triple_get_of_wp_get" class="idref" href="#TexanTriples.triple_get_of_wp_get"><span class="id" title="lemma">triple_get_of_wp_get</span></a> : <span class="id" title="keyword">∀</span> <a id="v:437" class="idref" href="#v:437"><span class="id" title="binder">v</span></a> <a id="p:438" class="idref" href="#p:438"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_get"><span class="id" title="constructor">val_get</span></a> <a class="idref" href="Wand.html#p:438"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Wand.html#p:438"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#v:437"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:439" class="idref" href="#r:439"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Wand.html#r:439"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Wand.html#v:437"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#p:438"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#v:437"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="LibSepReference.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans"><span class="id" title="lemma">himpl_trans</span></a>; [| <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#TexanTriples.wp_get"><span class="id" title="lemma">wp_get</span></a> ].<br/>
&nbsp;&nbsp;<span class="id" title="var">xsimpl</span>*.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="TexanTriples.triple_set" class="idref" href="#TexanTriples.triple_set"><span class="id" title="lemma">triple_set</span></a> : <span class="id" title="keyword">∀</span> <a id="w:440" class="idref" href="#w:440"><span class="id" title="binder">w</span></a> <a id="p:441" class="idref" href="#p:441"><span class="id" title="binder">p</span></a> <a id="v:442" class="idref" href="#v:442"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_set"><span class="id" title="constructor">val_set</span></a> (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Wand.html#p:441"><span class="id" title="variable">p</span></a>) <a class="idref" href="Wand.html#v:442"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Wand.html#p:441"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#w:440"><span class="id" title="variable">w</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Wand.html#p:441"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#v:442"><span class="id" title="variable">v</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="LibSepReference.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans"><span class="id" title="lemma">himpl_trans</span></a>; [| <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#TexanTriples.wp_set"><span class="id" title="lemma">wp_set</span></a> ].<br/>
&nbsp;&nbsp;<span class="id" title="var">xsimpl</span>*.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="TexanTriples.triple_free" class="idref" href="#TexanTriples.triple_free"><span class="id" title="lemma">triple_free</span></a> : <span class="id" title="keyword">∀</span> <a id="p:443" class="idref" href="#p:443"><span class="id" title="binder">p</span></a> <a id="v:444" class="idref" href="#v:444"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_free"><span class="id" title="constructor">val_free</span></a> (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Wand.html#p:443"><span class="id" title="variable">p</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Wand.html#p:443"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#v:444"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="LibSepReference.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans"><span class="id" title="lemma">himpl_trans</span></a>; [| <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#TexanTriples.wp_free"><span class="id" title="lemma">wp_free</span></a> ].<br/>
&nbsp;&nbsp;<span class="id" title="var">xsimpl</span>*.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab346"></a><h3 class="section">5. Exercise</h3>

<div class="paragraph"> </div>

 Let us put to practice the use of a Texan triple on a different example.
    Recall the function <span class="inlinecode"><span class="id" title="var">incr</span></span> and its specification (from <span class="inlinecode"><span class="id" title="var">Hprop.v</span></span>). 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="TexanTriples.incr" class="idref" href="#TexanTriples.incr"><span class="id" title="axiom">incr</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Parameter</span> <a id="TexanTriples.triple_incr" class="idref" href="#TexanTriples.triple_incr"><span class="id" title="axiom">triple_incr</span></a> : <span class="id" title="keyword">∀</span> (<a id="p:446" class="idref" href="#p:446"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) (<a id="n:447" class="idref" href="#n:447"><span class="id" title="binder">n</span></a>:<span class="id" title="notation">int</span>),<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Wand.html#TexanTriples.incr"><span class="id" title="axiom">incr</span></a> <a class="idref" href="Wand.html#p:446"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Wand.html#p:446"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Wand.html#n:447"><span class="id" title="variable">n</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="v:448" class="idref" href="#v:448"><span class="id" title="binder">v</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Wand.html#v:448"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#p:446"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#n:447"><span class="id" title="variable">n</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1<a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">)</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>).<br/>
</div>

<div class="doc">
<a id="lab347"></a><h4 class="section">Exercise: 3 stars, standard, especially useful (wp_incr)</h4>
 State a Texan triple for <span class="inlinecode"><span class="id" title="var">incr</span></span> as a lemma called <span class="inlinecode"><span class="id" title="var">wp_incr</span></span>,
    then prove this lemma from <span class="inlinecode"><span class="id" title="var">triple_incr</span></span>.

<div class="paragraph"> </div>

    Hint: the proof is a bit easier by first turning the <span class="inlinecode"><span class="id" title="var">wp</span></span> into a <span class="inlinecode"><span class="id" title="var">triple</span></span>
    and then reasoning about triples, compared to working on the <span class="inlinecode"><span class="id" title="var">wp</span></span> form. 
</div>
<div class="code">

<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<span class="id" title="keyword">End</span> <a class="idref" href="Wand.html#TexanTriples"><span class="id" title="module">TexanTriples</span></a>.<br/>
</div>

<div class="doc">
<a id="lab348"></a><h2 class="section">Direct Proof of <span class="inlinecode"><span class="id" title="var">wp_ramified</span></span> Directly from Hoare Triples</h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="WpFromHoare" class="idref" href="#WpFromHoare"><span class="id" title="module">WpFromHoare</span></a>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">NewQwand</span>.<br/>
</div>

<div class="doc">
Recall from the last section of the chapter <a href="WPsem.html"><span class="inlineref">WPsem</span></a> that it can
    be interesting to define <span class="inlinecode"><span class="id" title="var">wp</span></span>-style rules directly from the <span class="inlinecode"><span class="id" title="var">hoare</span></span>
    rules, so as to bypass the statements and proofs of rules for triples.

<div class="paragraph"> </div>

    In the first part of this chapter, we proved that the rule
    <span class="inlinecode"><span class="id" title="var">wp_ramified</span></span> is derivable from the consequence-frame rule for triples.
    Let us now show how to prove the rule <span class="inlinecode"><span class="id" title="var">wp_ramified</span></span> directly from
    the rules of Hoare logic. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WpFromHoare.wp_ramified" class="idref" href="#WpFromHoare.wp_ramified"><span class="id" title="lemma">wp_ramified</span></a> : <span class="id" title="keyword">∀</span> <a id="t:450" class="idref" href="#t:450"><span class="id" title="binder">t</span></a> <a id="Q<sub>1</sub>:451" class="idref" href="#Q<sub>1</sub>:451"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:452" class="idref" href="#Q<sub>2</sub>:452"><span class="id" title="binder">Q<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="Wand.html#t:450"><span class="id" title="variable">t</span></a> <a class="idref" href="Wand.html#Q<sub>1</sub>:451"><span class="id" title="variable">Q<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:451"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Wand.html#0f15db512d698ddeb3443f1a5ef0c869"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:452"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="Wand.html#t:450"><span class="id" title="variable">t</span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:452"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="LibSepReference.html#wp"><span class="id" title="definition">wp</span></a>. <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xsimpl</span> (<span class="id" title="var">H</span> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><span class="id" title="var">Q<sub>1</sub></span> <a class="idref" href="Wand.html#0f15db512d698ddeb3443f1a5ef0c869"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <span class="id" title="var">Q<sub>2</sub></span><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>). <span class="id" title="tactic">intros</span> <span class="id" title="var">H'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#hoare_conseq"><span class="id" title="lemma">hoare_conseq</span></a> <span class="id" title="var">M</span>. { <span class="id" title="var">xsimpl</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">r</span>. <span class="id" title="var">xchange</span> (<a class="idref" href="Wand.html#NewQwand.qwand_specialize"><span class="id" title="lemma">qwand_specialize</span></a> <span class="id" title="var">r</span>). <span class="id" title="var">xsimpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_comm"><span class="id" title="lemma">hstar_comm</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#WandDef.hwand_cancel"><span class="id" title="lemma">hwand_cancel</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="Wand.html#WpFromHoare"><span class="id" title="module">WpFromHoare</span></a>.<br/>
</div>

<div class="doc">
<a id="lab349"></a><h2 class="section">Conjunction and Disjunction Operators on <span class="inlinecode"><span class="id" title="var">hprop</span></span></h2>

<div class="paragraph"> </div>

 The disjunction and the (non-separating) conjunction are two
    other Separation Logic operators. The are not so useful in
    practice, because they can be trivially encoded using Coq
    conditional construct, or using Coq pattern matching.
    Nevertheless, these two operators can prove useful in specific
    contexts. We present them also for the sake of completeness. 
</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="ConjDisj" class="idref" href="#ConjDisj"><span class="id" title="module">ConjDisj</span></a>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">NewQwand</span>.<br/>
</div>

<div class="doc">
<a id="lab350"></a><h3 class="section">Definition of <span class="inlinecode"><span class="id" title="var">hor</span></span></h3>

<div class="paragraph"> </div>

 The heap predicate <span class="inlinecode"><span class="id" title="var">hor</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> lifts the disjunction operator
    <span class="inlinecode"><span class="id" title="var">P<sub>1</sub></span></span> <span class="inlinecode">∨</span> <span class="inlinecode"><span class="id" title="var">P<sub>2</sub></span></span> from <span class="inlinecode"><span class="id" title="keyword">Prop</span></span> to <span class="inlinecode"><span class="id" title="var">hprop</span></span>.

<div class="paragraph"> </div>

    Concretely, the heap predicate <span class="inlinecode"><span class="id" title="var">hor</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> describes a heap
    that satisfies <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> or satifies <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> (possibly both).

<div class="paragraph"> </div>

    The heap predicate <span class="inlinecode"><span class="id" title="var">hor</span></span> admits a direct definition as a
    function over heaps. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="ConjDisj.hor'" class="idref" href="#ConjDisj.hor'"><span class="id" title="definition">hor'</span></a> (<a id="H<sub>1</sub>:453" class="idref" href="#H<sub>1</sub>:453"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:454" class="idref" href="#H<sub>2</sub>:454"><span class="id" title="binder">H<sub>2</sub></span></a> : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="h:455" class="idref" href="#h:455"><span class="id" title="binder">h</span></a> ⇒ <a class="idref" href="Wand.html#H<sub>1</sub>:453"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#h:455"><span class="id" title="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e<sub>25</sub>"><span class="id" title="notation">∨</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:454"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="Wand.html#h:455"><span class="id" title="variable">h</span></a>.<br/>
</div>

<div class="doc">
An alternative definition leverages the <span class="inlinecode"><span class='gray-font'>\</span><span class="id" title="tactic">∃</span></span> quantifier.
    The definition, shown below, reads as follows: "there exists
    an unspecified boolean value <span class="inlinecode"><span class="id" title="var">b</span></span> such that if <span class="inlinecode"><span class="id" title="var">b</span></span> is true
    then <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> holds, else if <span class="inlinecode"><span class="id" title="var">b</span></span> is false then <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> holds".

<div class="paragraph"> </div>

    The benefits of this definition is that the proof of its properties
    can be established without manipulating heaps explicitly. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="ConjDisj.hor" class="idref" href="#ConjDisj.hor"><span class="id" title="definition">hor</span></a> (<a id="H<sub>1</sub>:456" class="idref" href="#H<sub>1</sub>:456"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:457" class="idref" href="#H<sub>2</sub>:457"><span class="id" title="binder">H<sub>2</sub></span></a> : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">(</span></a><a id="b:458" class="idref" href="#b:458"><span class="id" title="binder">b</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">),</span></a> <span class="id" title="keyword">if</span> <a class="idref" href="Wand.html#b:458"><span class="id" title="variable">b</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="Wand.html#H<sub>1</sub>:456"><span class="id" title="variable">H<sub>1</sub></span></a> <span class="id" title="keyword">else</span> <a class="idref" href="Wand.html#H<sub>2</sub>:457"><span class="id" title="variable">H<sub>2</sub></span></a>.<br/>
</div>

<div class="doc">
<a id="lab351"></a><h4 class="section">Exercise: 3 stars, standard, optional (hor_eq_hor')</h4>
 Prove the equivalence of the definitions <span class="inlinecode"><span class="id" title="var">hor</span></span> and <span class="inlinecode"><span class="id" title="var">hor'</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="ConjDisj.hor_eq_hor'" class="idref" href="#ConjDisj.hor_eq_hor'"><span class="id" title="lemma">hor_eq_hor'</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#ConjDisj.hor"><span class="id" title="definition">hor</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Wand.html#ConjDisj.hor'"><span class="id" title="definition">hor'</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 The introduction and elimination rules for <span class="inlinecode"><span class="id" title="var">hor</span></span> are as follows.

<div class="paragraph"> </div>

<ul class="doclist">
<li> If <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> holds, then "<span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> or <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>" holds.

</li>
<li> Symmetrically, if <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> holds, then "<span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> or <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>" holds.

</li>
<li> Reciprocally, if "<span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> or <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>" holds, then one can perform a case
      analysis on whether it is <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> or <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> that holds. Concretely, to
      show that "<span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> or <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>" entails <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span></span>, one must show both that
      <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> entails <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span></span> and that <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> entails <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span></span>. 

</li>
</ul>
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="ConjDisj.himpl_hor_r_l" class="idref" href="#ConjDisj.himpl_hor_r_l"><span class="id" title="lemma">himpl_hor_r_l</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:459" class="idref" href="#H<sub>1</sub>:459"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:460" class="idref" href="#H<sub>2</sub>:460"><span class="id" title="binder">H<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H<sub>1</sub>:459"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#ConjDisj.hor"><span class="id" title="definition">hor</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:459"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:460"><span class="id" title="variable">H<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">unfolds</span> <a class="idref" href="Wand.html#ConjDisj.hor"><span class="id" title="definition">hor</span></a>. <span class="id" title="tactic">∃</span>* <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="ConjDisj.himpl_hor_r_r" class="idref" href="#ConjDisj.himpl_hor_r_r"><span class="id" title="lemma">himpl_hor_r_r</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:461" class="idref" href="#H<sub>1</sub>:461"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:462" class="idref" href="#H<sub>2</sub>:462"><span class="id" title="binder">H<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H<sub>2</sub>:462"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#ConjDisj.hor"><span class="id" title="definition">hor</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:461"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:462"><span class="id" title="variable">H<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">unfolds</span> <a class="idref" href="Wand.html#ConjDisj.hor"><span class="id" title="definition">hor</span></a>. <span class="id" title="tactic">∃</span>* <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
In practice, these two rules are easier to exploit when combined with a
    transitivity step. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="ConjDisj.himpl_hor_r_l_trans" class="idref" href="#ConjDisj.himpl_hor_r_l_trans"><span class="id" title="lemma">himpl_hor_r_l_trans</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:463" class="idref" href="#H<sub>1</sub>:463"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:464" class="idref" href="#H<sub>2</sub>:464"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="H<sub>3</sub>:465" class="idref" href="#H<sub>3</sub>:465"><span class="id" title="binder">H<sub>3</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H<sub>3</sub>:465"><span class="id" title="variable">H<sub>3</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:463"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H<sub>3</sub>:465"><span class="id" title="variable">H<sub>3</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#ConjDisj.hor"><span class="id" title="definition">hor</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:463"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:464"><span class="id" title="variable">H<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">W</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans"><span class="id" title="lemma">himpl_trans</span></a> <span class="id" title="var">W</span>. <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#ConjDisj.himpl_hor_r_l"><span class="id" title="lemma">himpl_hor_r_l</span></a>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="ConjDisj.himpl_hor_r_r_trans" class="idref" href="#ConjDisj.himpl_hor_r_r_trans"><span class="id" title="lemma">himpl_hor_r_r_trans</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:466" class="idref" href="#H<sub>1</sub>:466"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:467" class="idref" href="#H<sub>2</sub>:467"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="H<sub>3</sub>:468" class="idref" href="#H<sub>3</sub>:468"><span class="id" title="binder">H<sub>3</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H<sub>3</sub>:468"><span class="id" title="variable">H<sub>3</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:467"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H<sub>3</sub>:468"><span class="id" title="variable">H<sub>3</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#ConjDisj.hor"><span class="id" title="definition">hor</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:466"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:467"><span class="id" title="variable">H<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">W</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans"><span class="id" title="lemma">himpl_trans</span></a> <span class="id" title="var">W</span>. <span class="id" title="var">applys</span> <a class="idref" href="Wand.html#ConjDisj.himpl_hor_r_r"><span class="id" title="lemma">himpl_hor_r_r</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The elimination rule is stated as follows. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="ConjDisj.himpl_hor_l" class="idref" href="#ConjDisj.himpl_hor_l"><span class="id" title="lemma">himpl_hor_l</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:469" class="idref" href="#H<sub>1</sub>:469"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:470" class="idref" href="#H<sub>2</sub>:470"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="H<sub>3</sub>:471" class="idref" href="#H<sub>3</sub>:471"><span class="id" title="binder">H<sub>3</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H<sub>1</sub>:469"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>3</sub>:471"><span class="id" title="variable">H<sub>3</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H<sub>2</sub>:470"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>3</sub>:471"><span class="id" title="variable">H<sub>3</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#ConjDisj.hor"><span class="id" title="definition">hor</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:469"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:470"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>3</sub>:471"><span class="id" title="variable">H<sub>3</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="var">unfolds</span> <a class="idref" href="Wand.html#ConjDisj.hor"><span class="id" title="definition">hor</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_hexists_l"><span class="id" title="lemma">himpl_hexists_l</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">b</span>. <span class="id" title="var">case_if</span>*.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The operator <span class="inlinecode"><span class="id" title="var">hor</span></span> is commutative. To establish this property, it is
    handy to exploit the following lemma, called <span class="inlinecode"><span class="id" title="var">if_neg</span></span>, which swaps the
    two branches of a conditional by negating the boolean condition. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="ConjDisj.if_neg" class="idref" href="#ConjDisj.if_neg"><span class="id" title="lemma">if_neg</span></a> : <span class="id" title="keyword">∀</span> (<a id="b:472" class="idref" href="#b:472"><span class="id" title="binder">b</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>) <a id="A:473" class="idref" href="#A:473"><span class="id" title="binder">A</span></a> (<a id="X:474" class="idref" href="#X:474"><span class="id" title="binder">X</span></a> <a id="Y:475" class="idref" href="#Y:475"><span class="id" title="binder">Y</span></a>:<a class="idref" href="Wand.html#A:473"><span class="id" title="variable">A</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><span class="id" title="keyword">if</span> <a class="idref" href="Wand.html#b:472"><span class="id" title="variable">b</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="Wand.html#X:474"><span class="id" title="variable">X</span></a> <span class="id" title="keyword">else</span> <a class="idref" href="Wand.html#Y:475"><span class="id" title="variable">Y</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><span class="id" title="keyword">if</span> <span class="id" title="definition">neg</span> <a class="idref" href="Wand.html#b:472"><span class="id" title="variable">b</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="Wand.html#Y:475"><span class="id" title="variable">Y</span></a> <span class="id" title="keyword">else</span> <a class="idref" href="Wand.html#X:474"><span class="id" title="variable">X</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">case_if</span>*. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab352"></a><h4 class="section">Exercise: 2 stars, standard, especially useful (hor_comm)</h4>
 Prove that <span class="inlinecode"><span class="id" title="var">hor</span></span> is a symmetric operator.
    Hint: exploit <span class="inlinecode"><span class="id" title="var">if_neg</span></span> and <span class="inlinecode"><span class="id" title="var">hprop_op_comm</span></span> (from chapter <a href="Himpl.html"><span class="inlineref">Himpl</span></a>). 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="ConjDisj.hor_comm" class="idref" href="#ConjDisj.hor_comm"><span class="id" title="lemma">hor_comm</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:476" class="idref" href="#H<sub>1</sub>:476"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:477" class="idref" href="#H<sub>2</sub>:477"><span class="id" title="binder">H<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#ConjDisj.hor"><span class="id" title="definition">hor</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:476"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:477"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Wand.html#ConjDisj.hor"><span class="id" title="definition">hor</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:477"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:476"><span class="id" title="variable">H<sub>1</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<span class="id" title="keyword">Module</span> <a id="ConjDisj.HorExample" class="idref" href="#ConjDisj.HorExample"><span class="id" title="module">HorExample</span></a>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">Repr</span>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">q</span> : <a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>.<br/>
</div>

<div class="doc">
Recall from chapter <a href="Repr.html"><span class="inlineref">Repr</span></a> the definition of <span class="inlinecode"><span class="id" title="var">MList</span></span>, and the two
    lemmas <span class="inlinecode"><span class="id" title="var">MList_nil</span></span> and <span class="inlinecode"><span class="id" title="var">MList_cons</span></span> that reformulates that definition. 
<div class="paragraph"> </div>

<a id="lab353"></a><h4 class="section">Exercise: 4 stars, standard, especially useful (hor_comm)</h4>
 Prove that <span class="inlinecode"><span class="id" title="var">MList</span></span> can be characterized by a disjunction expressed using
    <span class="inlinecode"><span class="id" title="var">hor</span></span> as shown below. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="ConjDisj.HorExample.MList_using_hor" class="idref" href="#ConjDisj.HorExample.MList_using_hor"><span class="id" title="lemma">MList_using_hor</span></a> : <span class="id" title="keyword">∀</span> <a id="L:478" class="idref" href="#L:478"><span class="id" title="binder">L</span></a> <a id="p:479" class="idref" href="#p:479"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Wand.html#L:478"><span class="id" title="variable">L</span></a> <a class="idref" href="Wand.html#p:479"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Wand.html#ConjDisj.hor"><span class="id" title="definition">hor</span></a> (<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Wand.html#L:478"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Wand.html#p:479"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="x:480" class="idref" href="#x:480"><span class="id" title="binder">x</span></a> <a id="q:481" class="idref" href="#q:481"><span class="id" title="binder">q</span></a> <a id="L':482" class="idref" href="#L':482"><span class="id" title="binder">L'</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Wand.html#L:478"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Wand.html#x:480"><span class="id" title="variable">x</span></a><span class="id" title="notation">::</span><a class="idref" href="Wand.html#L':482"><span class="id" title="variable">L'</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#p:479"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#3a1f4def71aa7ea77c87b41e2bd7edb0"><span class="id" title="notation">~~~&gt;</span></a><a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">`{</span></a> <a class="idref" href="Repr.html#head"><span class="id" title="definition">head</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Wand.html#x:480"><span class="id" title="variable">x</span></a><a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Repr.html#tail"><span class="id" title="definition">tail</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Wand.html#q:481"><span class="id" title="variable">q</span></a><a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">}</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Wand.html#L':482"><span class="id" title="variable">L'</span></a> <a class="idref" href="Wand.html#q:481"><span class="id" title="variable">q</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<span class="id" title="keyword">End</span> <a class="idref" href="Wand.html#ConjDisj.HorExample"><span class="id" title="module">HorExample</span></a>.<br/>
</div>

<div class="doc">
<a id="lab354"></a><h3 class="section">Definition of <span class="inlinecode"><span class="id" title="var">hand</span></span></h3>

<div class="paragraph"> </div>

 The heap predicate <span class="inlinecode"><span class="id" title="var">hand</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> lifts the disjunction operator
    <span class="inlinecode"><span class="id" title="var">P<sub>1</sub></span></span> <span class="inlinecode">∧</span> <span class="inlinecode"><span class="id" title="var">P<sub>2</sub></span></span> from <span class="inlinecode"><span class="id" title="keyword">Prop</span></span> to <span class="inlinecode"><span class="id" title="var">hprop</span></span>.

<div class="paragraph"> </div>

    Concretely, the heap predicate <span class="inlinecode"><span class="id" title="var">hand</span></span> <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> describes a heap
    that satisfies <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> and at the same time satifies <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>.

<div class="paragraph"> </div>

    The heap predicate <span class="inlinecode"><span class="id" title="var">hand</span></span> admits a direct definition as a
    function over heaps. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="ConjDisj.hand'" class="idref" href="#ConjDisj.hand'"><span class="id" title="definition">hand'</span></a> (<a id="H<sub>1</sub>:483" class="idref" href="#H<sub>1</sub>:483"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:484" class="idref" href="#H<sub>2</sub>:484"><span class="id" title="binder">H<sub>2</sub></span></a> : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="h:485" class="idref" href="#h:485"><span class="id" title="binder">h</span></a> ⇒ <a class="idref" href="Wand.html#H<sub>1</sub>:483"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#h:485"><span class="id" title="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:484"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="Wand.html#h:485"><span class="id" title="variable">h</span></a>.<br/>
</div>

<div class="doc">
An alternative definition leverages the <span class="inlinecode">\<span class="id" title="keyword">∀</span></span> quantifier.
    The definition, shown below, reads as follows: "for any
    boolean value <span class="inlinecode"><span class="id" title="var">b</span></span>, if <span class="inlinecode"><span class="id" title="var">b</span></span> is true then <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> should hold, and
    if <span class="inlinecode"><span class="id" title="var">b</span></span> is false then <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> should hold". 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="ConjDisj.hand" class="idref" href="#ConjDisj.hand"><span class="id" title="definition">hand</span></a> (<a id="H<sub>1</sub>:486" class="idref" href="#H<sub>1</sub>:486"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:487" class="idref" href="#H<sub>2</sub>:487"><span class="id" title="binder">H<sub>2</sub></span></a> : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#6603aec78c9eb740e019d90c70dd37f<sub>7</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Wand.html#6603aec78c9eb740e019d90c70dd37f<sub>7</sub>"><span class="id" title="notation">∀</span></a> <a class="idref" href="Wand.html#6603aec78c9eb740e019d90c70dd37f<sub>7</sub>"><span class="id" title="notation">(</span></a><a id="b:488" class="idref" href="#b:488"><span class="id" title="binder">b</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a><a class="idref" href="Wand.html#6603aec78c9eb740e019d90c70dd37f<sub>7</sub>"><span class="id" title="notation">),</span></a> <span class="id" title="keyword">if</span> <a class="idref" href="Wand.html#b:488"><span class="id" title="variable">b</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="Wand.html#H<sub>1</sub>:486"><span class="id" title="variable">H<sub>1</sub></span></a> <span class="id" title="keyword">else</span> <a class="idref" href="Wand.html#H<sub>2</sub>:487"><span class="id" title="variable">H<sub>2</sub></span></a>.<br/>
</div>

<div class="doc">
<a id="lab355"></a><h4 class="section">Exercise: 2 stars, standard, especially useful (hand_eq_hand')</h4>
 Prove the equivalence of the definitions <span class="inlinecode"><span class="id" title="var">hand</span></span> and <span class="inlinecode"><span class="id" title="var">hand'</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="ConjDisj.hand_eq_hand'" class="idref" href="#ConjDisj.hand_eq_hand'"><span class="id" title="lemma">hand_eq_hand'</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#ConjDisj.hand"><span class="id" title="definition">hand</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Wand.html#ConjDisj.hand'"><span class="id" title="definition">hand'</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 The introduction and elimination rules for <span class="inlinecode"><span class="id" title="var">hand</span></span> are as follows.

<div class="paragraph"> </div>

<ul class="doclist">
<li> If "<span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>" holds, then in particular <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> holds.

</li>
<li> Symmetrically, if "<span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>" holds, then in particular <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> holds.

</li>
<li> Reciprocally, to prove that a heap predicate <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span></span> entails
      "<span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>", one must prove that <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span></span> entails <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span>, and that
      <span class="inlinecode"><span class="id" title="var">H<sub>3</sub></span></span> satisfies <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>.

</li>
</ul>

</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="ConjDisj.himpl_hand_l_r" class="idref" href="#ConjDisj.himpl_hand_l_r"><span class="id" title="lemma">himpl_hand_l_r</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:489" class="idref" href="#H<sub>1</sub>:489"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:490" class="idref" href="#H<sub>2</sub>:490"><span class="id" title="binder">H<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#ConjDisj.hand"><span class="id" title="definition">hand</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:489"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:490"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:489"><span class="id" title="variable">H<sub>1</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">unfolds</span> <a class="idref" href="Wand.html#ConjDisj.hand"><span class="id" title="definition">hand</span></a>. <span class="id" title="var">applys</span>* <a class="idref" href="Wand.html#NewQwand.himpl_hforall_l"><span class="id" title="lemma">himpl_hforall_l</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="ConjDisj.himpl_hand_l_l" class="idref" href="#ConjDisj.himpl_hand_l_l"><span class="id" title="lemma">himpl_hand_l_l</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:491" class="idref" href="#H<sub>1</sub>:491"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:492" class="idref" href="#H<sub>2</sub>:492"><span class="id" title="binder">H<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#ConjDisj.hand"><span class="id" title="definition">hand</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:491"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:492"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:492"><span class="id" title="variable">H<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">unfolds</span> <a class="idref" href="Wand.html#ConjDisj.hand"><span class="id" title="definition">hand</span></a>. <span class="id" title="var">applys</span>* <a class="idref" href="Wand.html#NewQwand.himpl_hforall_l"><span class="id" title="lemma">himpl_hforall_l</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="ConjDisj.himpl_hand_r" class="idref" href="#ConjDisj.himpl_hand_r"><span class="id" title="lemma">himpl_hand_r</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:493" class="idref" href="#H<sub>1</sub>:493"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:494" class="idref" href="#H<sub>2</sub>:494"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="H<sub>3</sub>:495" class="idref" href="#H<sub>3</sub>:495"><span class="id" title="binder">H<sub>3</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H<sub>3</sub>:495"><span class="id" title="variable">H<sub>3</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:493"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H<sub>3</sub>:495"><span class="id" title="variable">H<sub>3</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:494"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#H<sub>3</sub>:495"><span class="id" title="variable">H<sub>3</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#ConjDisj.hand"><span class="id" title="definition">hand</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:493"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:494"><span class="id" title="variable">H<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">M<sub>2</sub></span> <span class="id" title="var">Hh</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">b</span>. <span class="id" title="var">case_if</span>*. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab356"></a><h4 class="section">Exercise: 1 star, standard, especially useful (hand_comm)</h4>
 Prove that <span class="inlinecode"><span class="id" title="var">hand</span></span> is a symmetric operator.
    Hint: use <span class="inlinecode"><span class="id" title="var">hprop_op_comm</span></span>, and <span class="inlinecode"><span class="id" title="tactic">rewrite</span></span> <span class="inlinecode"><span class="id" title="var">if_neg</span></span> (or a case analysis
    on the boolean value coming from <span class="inlinecode"><span class="id" title="var">hand</span></span>). 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="ConjDisj.hand_comm" class="idref" href="#ConjDisj.hand_comm"><span class="id" title="lemma">hand_comm</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:496" class="idref" href="#H<sub>1</sub>:496"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:497" class="idref" href="#H<sub>2</sub>:497"><span class="id" title="binder">H<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Wand.html#ConjDisj.hand"><span class="id" title="definition">hand</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:496"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:497"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Wand.html#ConjDisj.hand"><span class="id" title="definition">hand</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:497"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:496"><span class="id" title="variable">H<sub>1</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<span class="id" title="keyword">End</span> <a class="idref" href="Wand.html#ConjDisj"><span class="id" title="module">ConjDisj</span></a>.<br/>
</div>

<div class="doc">
<a id="lab357"></a><h2 class="section">Summary of All Separation Logic Operators</h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="SummaryHprop" class="idref" href="#SummaryHprop"><span class="id" title="module">SummaryHprop</span></a>.<br/>
</div>

<div class="doc">
The core operators are defined as functions over heaps. 
</div>
<div class="code">

&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="SummaryHprop.hempty" class="idref" href="#SummaryHprop.hempty"><span class="id" title="definition">hempty</span></a> : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="h:498" class="idref" href="#h:498"><span class="id" title="binder">h</span></a> ⇒ (<a class="idref" href="Wand.html#h:498"><span class="id" title="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#Fmap.empty"><span class="id" title="definition">Fmap.empty</span></a>).<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="SummaryHprop.hsingle" class="idref" href="#SummaryHprop.hsingle"><span class="id" title="definition">hsingle</span></a> (<a id="p:499" class="idref" href="#p:499"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) (<a id="v:500" class="idref" href="#v:500"><span class="id" title="binder">v</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="h:501" class="idref" href="#h:501"><span class="id" title="binder">h</span></a> ⇒ (<a class="idref" href="Wand.html#h:501"><span class="id" title="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#Fmap.single"><span class="id" title="definition">Fmap.single</span></a> <a class="idref" href="Wand.html#p:499"><span class="id" title="variable">p</span></a> <a class="idref" href="Wand.html#v:500"><span class="id" title="variable">v</span></a>).<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="SummaryHprop.hstar" class="idref" href="#SummaryHprop.hstar"><span class="id" title="definition">hstar</span></a> (<a id="H<sub>1</sub>:502" class="idref" href="#H<sub>1</sub>:502"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:503" class="idref" href="#H<sub>2</sub>:503"><span class="id" title="binder">H<sub>2</sub></span></a> : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="h:504" class="idref" href="#h:504"><span class="id" title="binder">h</span></a> ⇒ <span class="id" title="notation">∃</span> <a id="h<sub>1</sub>:505" class="idref" href="#h<sub>1</sub>:505"><span class="id" title="binder">h<sub>1</sub></span></a> <a id="h<sub>2</sub>:506" class="idref" href="#h<sub>2</sub>:506"><span class="id" title="binder">h<sub>2</sub></span></a><span class="id" title="notation">,</span> <a class="idref" href="Wand.html#H<sub>1</sub>:502"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#h<sub>1</sub>:505"><span class="id" title="variable">h<sub>1</sub></span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:503"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="Wand.html#h<sub>2</sub>:506"><span class="id" title="variable">h<sub>2</sub></span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="LibSepReference.html#Fmap.disjoint"><span class="id" title="definition">Fmap.disjoint</span></a> <a class="idref" href="Wand.html#h<sub>1</sub>:505"><span class="id" title="variable">h<sub>1</sub></span></a> <a class="idref" href="Wand.html#h<sub>2</sub>:506"><span class="id" title="variable">h<sub>2</sub></span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Wand.html#h:504"><span class="id" title="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#Fmap.union"><span class="id" title="definition">Fmap.union</span></a> <a class="idref" href="Wand.html#h<sub>1</sub>:505"><span class="id" title="variable">h<sub>1</sub></span></a> <a class="idref" href="Wand.html#h<sub>2</sub>:506"><span class="id" title="variable">h<sub>2</sub></span></a>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="SummaryHprop.hexists" class="idref" href="#SummaryHprop.hexists"><span class="id" title="definition">hexists</span></a> <a id="A:507" class="idref" href="#A:507"><span class="id" title="binder">A</span></a> (<a id="J:508" class="idref" href="#J:508"><span class="id" title="binder">J</span></a>:<a class="idref" href="Wand.html#A:507"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="h:509" class="idref" href="#h:509"><span class="id" title="binder">h</span></a> ⇒ <span class="id" title="notation">∃</span> <a id="x:510" class="idref" href="#x:510"><span class="id" title="binder">x</span></a><span class="id" title="notation">,</span> <a class="idref" href="Wand.html#J:508"><span class="id" title="variable">J</span></a> <a class="idref" href="Wand.html#x:510"><span class="id" title="variable">x</span></a> <a class="idref" href="Wand.html#h:509"><span class="id" title="variable">h</span></a>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="SummaryHprop.hforall" class="idref" href="#SummaryHprop.hforall"><span class="id" title="definition">hforall</span></a> (<a id="A:511" class="idref" href="#A:511"><span class="id" title="binder">A</span></a> : <span class="id" title="keyword">Type</span>) (<a id="J:512" class="idref" href="#J:512"><span class="id" title="binder">J</span></a> : <a class="idref" href="Wand.html#A:511"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="h:513" class="idref" href="#h:513"><span class="id" title="binder">h</span></a> ⇒ <span class="id" title="keyword">∀</span> <a id="x:514" class="idref" href="#x:514"><span class="id" title="binder">x</span></a>, <a class="idref" href="Wand.html#J:512"><span class="id" title="variable">J</span></a> <a class="idref" href="Wand.html#x:514"><span class="id" title="variable">x</span></a> <a class="idref" href="Wand.html#h:513"><span class="id" title="variable">h</span></a>.<br/>
</div>

<div class="doc">
The remaining operators can be defined either as functions over
    heaps, or as derived definitions expressed in terms of the core
    operators defined above. 
<div class="paragraph"> </div>

 Direct definition for the remaining operators. 
</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="SummaryHprop.ReaminingOperatorsDirect" class="idref" href="#SummaryHprop.ReaminingOperatorsDirect"><span class="id" title="module">ReaminingOperatorsDirect</span></a>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="SummaryHprop.ReaminingOperatorsDirect.hpure" class="idref" href="#SummaryHprop.ReaminingOperatorsDirect.hpure"><span class="id" title="definition">hpure</span></a> (<a id="P:515" class="idref" href="#P:515"><span class="id" title="binder">P</span></a>:<span class="id" title="keyword">Prop</span>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="h:516" class="idref" href="#h:516"><span class="id" title="binder">h</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#h:516"><span class="id" title="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#Fmap.empty"><span class="id" title="definition">Fmap.empty</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Wand.html#P:515"><span class="id" title="variable">P</span></a>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="SummaryHprop.ReaminingOperatorsDirect.hwand" class="idref" href="#SummaryHprop.ReaminingOperatorsDirect.hwand"><span class="id" title="definition">hwand</span></a> (<a id="H<sub>1</sub>:517" class="idref" href="#H<sub>1</sub>:517"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:518" class="idref" href="#H<sub>2</sub>:518"><span class="id" title="binder">H<sub>2</sub></span></a>:<a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="h:519" class="idref" href="#h:519"><span class="id" title="binder">h</span></a> ⇒ <span class="id" title="keyword">∀</span> <a id="h':520" class="idref" href="#h':520"><span class="id" title="binder">h'</span></a>, <a class="idref" href="LibSepReference.html#Fmap.disjoint"><span class="id" title="definition">Fmap.disjoint</span></a> <a class="idref" href="Wand.html#h:519"><span class="id" title="variable">h</span></a> <a class="idref" href="Wand.html#h':520"><span class="id" title="variable">h'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Wand.html#H<sub>1</sub>:517"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#h':520"><span class="id" title="variable">h'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:518"><span class="id" title="variable">H<sub>2</sub></span></a> (<a class="idref" href="Wand.html#h:519"><span class="id" title="variable">h</span></a> <a class="idref" href="LibSepReference.html#11dbc5cc324072f557c3f348a31ba1a<sub>0</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#11dbc5cc324072f557c3f348a31ba1a<sub>0</sub>"><span class="id" title="notation">u</span></a> <a class="idref" href="Wand.html#h':520"><span class="id" title="variable">h'</span></a>).<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="SummaryHprop.ReaminingOperatorsDirect.qwand" class="idref" href="#SummaryHprop.ReaminingOperatorsDirect.qwand"><span class="id" title="definition">qwand</span></a> (<a id="Q<sub>1</sub>:521" class="idref" href="#Q<sub>1</sub>:521"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:522" class="idref" href="#Q<sub>2</sub>:522"><span class="id" title="binder">Q<sub>2</sub></span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="h:523" class="idref" href="#h:523"><span class="id" title="binder">h</span></a> ⇒ <span class="id" title="keyword">∀</span> <a id="v:524" class="idref" href="#v:524"><span class="id" title="binder">v</span></a> <a id="h':525" class="idref" href="#h':525"><span class="id" title="binder">h'</span></a>, <a class="idref" href="LibSepReference.html#Fmap.disjoint"><span class="id" title="definition">Fmap.disjoint</span></a> <a class="idref" href="Wand.html#h:523"><span class="id" title="variable">h</span></a> <a class="idref" href="Wand.html#h':525"><span class="id" title="variable">h'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Wand.html#Q<sub>1</sub>:521"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Wand.html#v:524"><span class="id" title="variable">v</span></a> <a class="idref" href="Wand.html#h':525"><span class="id" title="variable">h'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:522"><span class="id" title="variable">Q<sub>2</sub></span></a> <a class="idref" href="Wand.html#v:524"><span class="id" title="variable">v</span></a> (<a class="idref" href="Wand.html#h:523"><span class="id" title="variable">h</span></a> <a class="idref" href="LibSepReference.html#11dbc5cc324072f557c3f348a31ba1a<sub>0</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#11dbc5cc324072f557c3f348a31ba1a<sub>0</sub>"><span class="id" title="notation">u</span></a> <a class="idref" href="Wand.html#h':525"><span class="id" title="variable">h'</span></a>).<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="SummaryHprop.ReaminingOperatorsDirect.hor" class="idref" href="#SummaryHprop.ReaminingOperatorsDirect.hor"><span class="id" title="definition">hor</span></a> (<a id="H<sub>1</sub>:526" class="idref" href="#H<sub>1</sub>:526"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:527" class="idref" href="#H<sub>2</sub>:527"><span class="id" title="binder">H<sub>2</sub></span></a> : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="h:528" class="idref" href="#h:528"><span class="id" title="binder">h</span></a> ⇒ <a class="idref" href="Wand.html#H<sub>1</sub>:526"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#h:528"><span class="id" title="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e<sub>25</sub>"><span class="id" title="notation">∨</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:527"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="Wand.html#h:528"><span class="id" title="variable">h</span></a>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="SummaryHprop.ReaminingOperatorsDirect.hand" class="idref" href="#SummaryHprop.ReaminingOperatorsDirect.hand"><span class="id" title="definition">hand</span></a> (<a id="H<sub>1</sub>:529" class="idref" href="#H<sub>1</sub>:529"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:530" class="idref" href="#H<sub>2</sub>:530"><span class="id" title="binder">H<sub>2</sub></span></a> : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="h:531" class="idref" href="#h:531"><span class="id" title="binder">h</span></a> ⇒ <a class="idref" href="Wand.html#H<sub>1</sub>:529"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Wand.html#h:531"><span class="id" title="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:530"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="Wand.html#h:531"><span class="id" title="variable">h</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="Wand.html#SummaryHprop.ReaminingOperatorsDirect"><span class="id" title="module">ReaminingOperatorsDirect</span></a>.<br/>
</div>

<div class="doc">
Alternative definitions for the same operators, expressed in terms
    of the core operators. 
</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="SummaryHprop.ReaminingOperatorsDerived" class="idref" href="#SummaryHprop.ReaminingOperatorsDerived"><span class="id" title="module">ReaminingOperatorsDerived</span></a>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="SummaryHprop.ReaminingOperatorsDerived.hpure" class="idref" href="#SummaryHprop.ReaminingOperatorsDerived.hpure"><span class="id" title="definition">hpure</span></a> (<a id="P:532" class="idref" href="#P:532"><span class="id" title="binder">P</span></a>:<span class="id" title="keyword">Prop</span>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">(</span></a><a id="p:533" class="idref" href="#p:533"><span class="id" title="binder">p</span></a>:<a class="idref" href="Wand.html#P:532"><span class="id" title="variable">P</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">),</span></a> <a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="SummaryHprop.ReaminingOperatorsDerived.hwand" class="idref" href="#SummaryHprop.ReaminingOperatorsDerived.hwand"><span class="id" title="definition">hwand</span></a> (<a id="H<sub>1</sub>:534" class="idref" href="#H<sub>1</sub>:534"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:535" class="idref" href="#H<sub>2</sub>:535"><span class="id" title="binder">H<sub>2</sub></span></a> : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="H<sub>0</sub>:536" class="idref" href="#H<sub>0</sub>:536"><span class="id" title="binder">H<sub>0</sub></span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Wand.html#H<sub>0</sub>:536"><span class="id" title="variable">H<sub>0</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#H<sub>1</sub>:534"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Wand.html#H<sub>0</sub>:536"><span class="id" title="variable">H<sub>0</sub></span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Wand.html#H<sub>2</sub>:535"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="SummaryHprop.ReaminingOperatorsDerived.qwand" class="idref" href="#SummaryHprop.ReaminingOperatorsDerived.qwand"><span class="id" title="definition">qwand</span></a> (<a id="Q<sub>1</sub>:537" class="idref" href="#Q<sub>1</sub>:537"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:538" class="idref" href="#Q<sub>2</sub>:538"><span class="id" title="binder">Q<sub>2</sub></span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">∀</span></a> <a id="v:539" class="idref" href="#v:539"><span class="id" title="binder">v</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:537"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Wand.html#v:539"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>2</sub>:538"><span class="id" title="variable">Q<sub>2</sub></span></a> <a class="idref" href="Wand.html#v:539"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">)</span></a>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="SummaryHprop.ReaminingOperatorsDerived.qwand'" class="idref" href="#SummaryHprop.ReaminingOperatorsDerived.qwand'"><span class="id" title="definition">qwand'</span></a> (<a id="Q<sub>1</sub>:540" class="idref" href="#Q<sub>1</sub>:540"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:541" class="idref" href="#Q<sub>2</sub>:541"><span class="id" title="binder">Q<sub>2</sub></span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> := <span class="comment">(*&nbsp;alternative&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="H<sub>0</sub>:542" class="idref" href="#H<sub>0</sub>:542"><span class="id" title="binder">H<sub>0</sub></span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Wand.html#H<sub>0</sub>:542"><span class="id" title="variable">H<sub>0</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">(</span></a><a class="idref" href="Wand.html#Q<sub>1</sub>:540"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="Wand.html#H<sub>0</sub>:542"><span class="id" title="variable">H<sub>0</sub></span></a><a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Wand.html#Q<sub>2</sub>:541"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="SummaryHprop.ReaminingOperatorsDerived.hand" class="idref" href="#SummaryHprop.ReaminingOperatorsDerived.hand"><span class="id" title="definition">hand</span></a> (<a id="H<sub>1</sub>:543" class="idref" href="#H<sub>1</sub>:543"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:544" class="idref" href="#H<sub>2</sub>:544"><span class="id" title="binder">H<sub>2</sub></span></a> : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">∀</span></a> <a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">(</span></a><a id="b:545" class="idref" href="#b:545"><span class="id" title="binder">b</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">),</span></a> <span class="id" title="keyword">if</span> <a class="idref" href="Wand.html#b:545"><span class="id" title="variable">b</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="Wand.html#H<sub>1</sub>:543"><span class="id" title="variable">H<sub>1</sub></span></a> <span class="id" title="keyword">else</span> <a class="idref" href="Wand.html#H<sub>2</sub>:544"><span class="id" title="variable">H<sub>2</sub></span></a>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="SummaryHprop.ReaminingOperatorsDerived.hor" class="idref" href="#SummaryHprop.ReaminingOperatorsDerived.hor"><span class="id" title="definition">hor</span></a> (<a id="H<sub>1</sub>:546" class="idref" href="#H<sub>1</sub>:546"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:547" class="idref" href="#H<sub>2</sub>:547"><span class="id" title="binder">H<sub>2</sub></span></a> : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">(</span></a><a id="b:548" class="idref" href="#b:548"><span class="id" title="binder">b</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">),</span></a> <span class="id" title="keyword">if</span> <a class="idref" href="Wand.html#b:548"><span class="id" title="variable">b</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="Wand.html#H<sub>1</sub>:546"><span class="id" title="variable">H<sub>1</sub></span></a> <span class="id" title="keyword">else</span> <a class="idref" href="Wand.html#H<sub>2</sub>:547"><span class="id" title="variable">H<sub>2</sub></span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="Wand.html#SummaryHprop.ReaminingOperatorsDerived"><span class="id" title="module">ReaminingOperatorsDerived</span></a>.<br/>
</div>

<div class="doc">
In practice, it saves a lot of effort to use the derived definitions,
    because using derived definitions all the properties of these definitions
    can be established with the help of the <span class="inlinecode"><span class="id" title="var">xsimpl</span></span> tactic, through reasoning
    taking place exclusively at the level of <span class="inlinecode"><span class="id" title="var">hprop</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">End</span> <a class="idref" href="Wand.html#SummaryHprop"><span class="id" title="module">SummaryHprop</span></a>.<br/>
</div>

<div class="doc">
<a id="lab358"></a><h2 class="section">Historical Notes</h2>

<div class="paragraph"> </div>

 The magic wand is an operator that was introduced in the very first days
    of Separation Logic. From a logical perspective, it makes total sense to
    have it. From a practical perspective, however, it was not always entirely
    obvious how the magic wand could simplify specifications and proofs.

<div class="paragraph"> </div>

    Experience with CFML 1.0 shows that it is possible to develop an entire
    verification frameworks and verify thousands of lines of advanced data
    structures and algorithms without ever involving the magic wand operator.

<div class="paragraph"> </div>

    The magic wand, however, reveals its interest when exploited (1) in the
    ramified frame rule, and (2) in weakest-precondition style reasoning rules.

<div class="paragraph"> </div>

    The idea of the ramified frame rule was introduced by
    <a href="Bib.html#Krishnaswami,-Birkedal, and Aldrich 2010"><span class="inlineref">[Krishnaswami, Birkedal, and Aldrich 2010]</span></a>. Its general statement,
    as formulated in the present chapter, was proposed by
    <a href="Bib.html#Hobor-and Villard 2013"><span class="inlineref">[Hobor and Villard 2013]</span></a>. Developers of the tools VST and Iris
    have advertised for the interest of this rule. The ramified frame
    rule was integrated in CFML 2.0 in 2018. 
</div>
<div class="code">

<span class="comment">(*&nbsp;2022-01-29&nbsp;23:27&nbsp;*)</span><br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>