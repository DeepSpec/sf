<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>Partial: Triples for Partial Correctness</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/slf.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 6: Separation Logic Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">Partial<span class="subtitle">Triples for Partial Correctness</span></h1>


<div class="code">

<span class="id" title="keyword">Set Implicit Arguments</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">SLF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="Nondet.html#"><span class="id" title="library">Nondet</span></a>.<br/>
<span class="id" title="keyword">Close</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">val_scope</span>.<br/>
<span class="id" title="keyword">Close</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">trm_scope</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">f</span> : <a class="idref" href="LibSepVar.html#var"><span class="id" title="definition">var</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">b</span> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">s</span> : <a class="idref" href="LibSepReference.html#state"><span class="id" title="definition">state</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">t</span> : <a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">v</span> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">n</span> : <span class="id" title="notation">int</span>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">p</span> : <a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">h</span> : <a class="idref" href="LibSepReference.html#heap"><span class="id" title="definition">heap</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">P</span> : <span class="id" title="keyword">Prop</span>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">H</span> : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">Q</span> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>.<br/>
</div>

<div class="doc">
<a id="lab476"></a><h1 class="section">First Pass</h1>

<div class="paragraph"> </div>

 In this chapter, we investigate definitions of Hoare triples and Separation
    Logic triples with respect to partial correctness, that is, without imposing
    termination.

<div class="paragraph"> </div>

    Partial correctness is a weaker property than total correctness. However,
    it may be suited for reasoning about programs that are not meant to
    terminate, and may be interesting to consider as an intermediate target
    when reasoning about programs for which termination is much harder to
    establish than correctness.

<div class="paragraph"> </div>

    This chapter is organized as follows:

<div class="paragraph"> </div>

<ul class="doclist">
<li> Partial correctness with respect to big-step semantics.

</li>
<li> Bonus contents: partial correctness with respect to small-step semantics.

</li>
</ul>

<div class="paragraph"> </div>

    This chapter, like the previous chapter <span class="inlinecode"><span class="id" title="var">Nondet</span></span>, omits sequences and
    non-recursive functions, as these features can be encoded. 
</div>

<div class="doc">
<a id="lab477"></a><h2 class="section">Big-Step Characterization of Partial Correctness</h2>

<div class="paragraph"> </div>

 For total correctness, the judgment <span class="inlinecode"><span class="id" title="var">evals</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> asserts that any
    execution of the program <span class="inlinecode">(<span class="id" title="var">s</span>,<span class="id" title="var">t</span>)</span> terminates on an output satisfying <span class="inlinecode"><span class="id" title="var">Q</span></span>.
    In contrast, the partial correctness judgment <span class="inlinecode"><span class="id" title="var">evalnp</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> asserts that
    any execution of the program <span class="inlinecode">(<span class="id" title="var">s</span>,<span class="id" title="var">t</span>)</span> either terminates on an output
    satisfying <span class="inlinecode"><span class="id" title="var">Q</span></span>, or diverges (that is, executes forever).

<div class="paragraph"> </div>

    The definition of the predicate <span class="inlinecode"><span class="id" title="var">evalnp</span></span> is obtained by taking the
    constructors from the inductive definition of <span class="inlinecode"><span class="id" title="var">evaln</span></span>, and considering
    the coinductive interpretation of these constructors. The coinductive
    interpretation allows for infinite derivation. It thereby introduces the
    possibility of diverging executions. Importantly, the predicate <span class="inlinecode"><span class="id" title="var">evalnp</span></span>
    still disallows executions that get stuck. 
</div>
<div class="code">

<span class="id" title="keyword">CoInductive</span> <a id="evalnp" class="idref" href="#evalnp"><span class="id" title="inductive">evalnp</span></a> : <a class="idref" href="LibSepReference.html#state"><span class="id" title="definition">state</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#state"><span class="id" title="definition">state</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><span class="id" title="keyword">Prop</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="evalnp_val" class="idref" href="#evalnp_val"><span class="id" title="constructor">evalnp_val</span></a> : <span class="id" title="keyword">∀</span> <a id="s:3" class="idref" href="#s:3"><span class="id" title="binder">s</span></a> <a id="v:4" class="idref" href="#v:4"><span class="id" title="binder">v</span></a> <a id="Q:5" class="idref" href="#Q:5"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#Q:5"><span class="id" title="variable">Q</span></a> <a class="idref" href="Partial.html#v:4"><span class="id" title="variable">v</span></a> <a class="idref" href="Partial.html#s:3"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnp:1"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s:3"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <a class="idref" href="Partial.html#v:4"><span class="id" title="variable">v</span></a>) <a class="idref" href="Partial.html#Q:5"><span class="id" title="variable">Q</span></a><br/>
&nbsp;&nbsp;| <a id="evalnp_fix" class="idref" href="#evalnp_fix"><span class="id" title="constructor">evalnp_fix</span></a> : <span class="id" title="keyword">∀</span> <a id="s:6" class="idref" href="#s:6"><span class="id" title="binder">s</span></a> <a id="f:7" class="idref" href="#f:7"><span class="id" title="binder">f</span></a> <a id="x:8" class="idref" href="#x:8"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:9" class="idref" href="#t<sub>1</sub>:9"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="Q:10" class="idref" href="#Q:10"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#Q:10"><span class="id" title="variable">Q</span></a> (<a class="idref" href="LibSepReference.html#val_fix"><span class="id" title="constructor">val_fix</span></a> <a class="idref" href="Partial.html#f:7"><span class="id" title="variable">f</span></a> <a class="idref" href="Partial.html#x:8"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:9"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="Partial.html#s:6"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnp:1"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s:6"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#trm_fix"><span class="id" title="constructor">trm_fix</span></a> <a class="idref" href="Partial.html#f:7"><span class="id" title="variable">f</span></a> <a class="idref" href="Partial.html#x:8"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:9"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="Partial.html#Q:10"><span class="id" title="variable">Q</span></a><br/>
&nbsp;&nbsp;| <a id="evalnp_app_fix" class="idref" href="#evalnp_app_fix"><span class="id" title="constructor">evalnp_app_fix</span></a> : <span class="id" title="keyword">∀</span> <a id="s<sub>1</sub>:11" class="idref" href="#s<sub>1</sub>:11"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="v<sub>1</sub>:12" class="idref" href="#v<sub>1</sub>:12"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="v<sub>2</sub>:13" class="idref" href="#v<sub>2</sub>:13"><span class="id" title="binder">v<sub>2</sub></span></a> <a id="f:14" class="idref" href="#f:14"><span class="id" title="binder">f</span></a> <a id="x:15" class="idref" href="#x:15"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:16" class="idref" href="#t<sub>1</sub>:16"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="Q:17" class="idref" href="#Q:17"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#v<sub>1</sub>:12"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_fix"><span class="id" title="constructor">val_fix</span></a> <a class="idref" href="Partial.html#f:14"><span class="id" title="variable">f</span></a> <a class="idref" href="Partial.html#x:15"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:16"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnp:1"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:11"><span class="id" title="variable">s<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Partial.html#x:15"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#v<sub>2</sub>:13"><span class="id" title="variable">v<sub>2</sub></span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Partial.html#f:14"><span class="id" title="variable">f</span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:12"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:16"><span class="id" title="variable">t<sub>1</sub></span></a>)) <a class="idref" href="Partial.html#Q:17"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnp:1"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:11"><span class="id" title="variable">s<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:12"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Partial.html#v<sub>2</sub>:13"><span class="id" title="variable">v<sub>2</sub></span></a>) <a class="idref" href="Partial.html#Q:17"><span class="id" title="variable">Q</span></a><br/>
&nbsp;&nbsp;| <a id="evalnp_let" class="idref" href="#evalnp_let"><span class="id" title="constructor">evalnp_let</span></a> : <span class="id" title="keyword">∀</span> <a id="Q<sub>1</sub>:18" class="idref" href="#Q<sub>1</sub>:18"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="s<sub>1</sub>:19" class="idref" href="#s<sub>1</sub>:19"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="x:20" class="idref" href="#x:20"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:21" class="idref" href="#t<sub>1</sub>:21"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:22" class="idref" href="#t<sub>2</sub>:22"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="Q:23" class="idref" href="#Q:23"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnp:1"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:19"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:21"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#Q<sub>1</sub>:18"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="v<sub>1</sub>:24" class="idref" href="#v<sub>1</sub>:24"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="s<sub>2</sub>:25" class="idref" href="#s<sub>2</sub>:25"><span class="id" title="binder">s<sub>2</sub></span></a>, <a class="idref" href="Partial.html#Q<sub>1</sub>:18"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:24"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Partial.html#s<sub>2</sub>:25"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Partial.html#evalnp:1"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s<sub>2</sub>:25"><span class="id" title="variable">s<sub>2</sub></span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Partial.html#x:20"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:24"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:22"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Partial.html#Q:23"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnp:1"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:19"><span class="id" title="variable">s<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="Partial.html#x:20"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:21"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:22"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Partial.html#Q:23"><span class="id" title="variable">Q</span></a><br/>
&nbsp;&nbsp;| <a id="evalnp_if" class="idref" href="#evalnp_if"><span class="id" title="constructor">evalnp_if</span></a> : <span class="id" title="keyword">∀</span> <a id="s<sub>1</sub>:26" class="idref" href="#s<sub>1</sub>:26"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="b:27" class="idref" href="#b:27"><span class="id" title="binder">b</span></a> <a id="t<sub>1</sub>:28" class="idref" href="#t<sub>1</sub>:28"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:29" class="idref" href="#t<sub>2</sub>:29"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="Q:30" class="idref" href="#Q:30"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnp:1"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:26"><span class="id" title="variable">s<sub>1</sub></span></a> (<span class="id" title="keyword">if</span> <a class="idref" href="Partial.html#b:27"><span class="id" title="variable">b</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="Partial.html#t<sub>1</sub>:28"><span class="id" title="variable">t<sub>1</sub></span></a> <span class="id" title="keyword">else</span> <a class="idref" href="Partial.html#t<sub>2</sub>:29"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Partial.html#Q:30"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnp:1"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:26"><span class="id" title="variable">s<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> (<a class="idref" href="LibSepReference.html#val_bool"><span class="id" title="constructor">val_bool</span></a> <a class="idref" href="Partial.html#b:27"><span class="id" title="variable">b</span></a>) <a class="idref" href="Partial.html#t<sub>1</sub>:28"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:29"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Partial.html#Q:30"><span class="id" title="variable">Q</span></a><br/>
&nbsp;&nbsp;| <a id="evalnp_add" class="idref" href="#evalnp_add"><span class="id" title="constructor">evalnp_add</span></a> : <span class="id" title="keyword">∀</span> <a id="s:31" class="idref" href="#s:31"><span class="id" title="binder">s</span></a> <a id="n<sub>1</sub>:32" class="idref" href="#n<sub>1</sub>:32"><span class="id" title="binder">n<sub>1</sub></span></a> <a id="n<sub>2</sub>:33" class="idref" href="#n<sub>2</sub>:33"><span class="id" title="binder">n<sub>2</sub></span></a> <a id="Q:34" class="idref" href="#Q:34"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#Q:34"><span class="id" title="variable">Q</span></a> (<a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> (<a class="idref" href="Partial.html#n<sub>1</sub>:32"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="Partial.html#n<sub>2</sub>:33"><span class="id" title="variable">n<sub>2</sub></span></a>)) <a class="idref" href="Partial.html#s:31"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnp:1"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s:31"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#val_add"><span class="id" title="constructor">val_add</span></a> (<a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Partial.html#n<sub>1</sub>:32"><span class="id" title="variable">n<sub>1</sub></span></a>) (<a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Partial.html#n<sub>2</sub>:33"><span class="id" title="variable">n<sub>2</sub></span></a>)) <a class="idref" href="Partial.html#Q:34"><span class="id" title="variable">Q</span></a><br/>
&nbsp;&nbsp;| <a id="evalnp_rand" class="idref" href="#evalnp_rand"><span class="id" title="constructor">evalnp_rand</span></a> : <span class="id" title="keyword">∀</span> <a id="s:35" class="idref" href="#s:35"><span class="id" title="binder">s</span></a> <a id="n:36" class="idref" href="#n:36"><span class="id" title="binder">n</span></a> <a id="Q:37" class="idref" href="#Q:37"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#n:36"><span class="id" title="variable">n</span></a> <span class="id" title="notation">&gt;</span> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="n<sub>1</sub>:38" class="idref" href="#n<sub>1</sub>:38"><span class="id" title="binder">n<sub>1</sub></span></a>, 0 <span class="id" title="notation">≤</span> <a class="idref" href="Partial.html#n<sub>1</sub>:38"><span class="id" title="variable">n<sub>1</sub></span></a> <span class="id" title="notation">&lt;</span> <a class="idref" href="Partial.html#n:36"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Partial.html#Q:37"><span class="id" title="variable">Q</span></a> <a class="idref" href="Partial.html#n<sub>1</sub>:38"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Partial.html#s:35"><span class="id" title="variable">s</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnp:1"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s:35"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#val_rand"><span class="id" title="constructor">val_rand</span></a> (<a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Partial.html#n:36"><span class="id" title="variable">n</span></a>)) <a class="idref" href="Partial.html#Q:37"><span class="id" title="variable">Q</span></a><br/>
&nbsp;&nbsp;| <a id="evalnp_ref" class="idref" href="#evalnp_ref"><span class="id" title="constructor">evalnp_ref</span></a> : <span class="id" title="keyword">∀</span> <a id="s:39" class="idref" href="#s:39"><span class="id" title="binder">s</span></a> <a id="v:40" class="idref" href="#v:40"><span class="id" title="binder">v</span></a> <a id="Q:41" class="idref" href="#Q:41"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="p:42" class="idref" href="#p:42"><span class="id" title="binder">p</span></a>, <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">¬</span></a> <a class="idref" href="LibSepReference.html#Fmap.indom"><span class="id" title="definition">Fmap.indom</span></a> <a class="idref" href="Partial.html#s:39"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#p:42"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#Q:41"><span class="id" title="variable">Q</span></a> (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Partial.html#p:42"><span class="id" title="variable">p</span></a>) (<a class="idref" href="LibSepReference.html#Fmap.update"><span class="id" title="definition">Fmap.update</span></a> <a class="idref" href="Partial.html#s:39"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#p:42"><span class="id" title="variable">p</span></a> <a class="idref" href="Partial.html#v:40"><span class="id" title="variable">v</span></a>)<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnp:1"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s:39"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#val_ref"><span class="id" title="constructor">val_ref</span></a> <a class="idref" href="Partial.html#v:40"><span class="id" title="variable">v</span></a>) <a class="idref" href="Partial.html#Q:41"><span class="id" title="variable">Q</span></a><br/>
&nbsp;&nbsp;| <a id="evalnp_get" class="idref" href="#evalnp_get"><span class="id" title="constructor">evalnp_get</span></a> : <span class="id" title="keyword">∀</span> <a id="s:43" class="idref" href="#s:43"><span class="id" title="binder">s</span></a> <a id="p:44" class="idref" href="#p:44"><span class="id" title="binder">p</span></a> <a id="Q:45" class="idref" href="#Q:45"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#Fmap.indom"><span class="id" title="definition">Fmap.indom</span></a> <a class="idref" href="Partial.html#s:43"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#p:44"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#Q:45"><span class="id" title="variable">Q</span></a> (<a class="idref" href="LibSepReference.html#Fmap.read"><span class="id" title="definition">Fmap.read</span></a> <a class="idref" href="Partial.html#s:43"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#p:44"><span class="id" title="variable">p</span></a>) <a class="idref" href="Partial.html#s:43"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnp:1"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s:43"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#val_get"><span class="id" title="constructor">val_get</span></a> (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Partial.html#p:44"><span class="id" title="variable">p</span></a>)) <a class="idref" href="Partial.html#Q:45"><span class="id" title="variable">Q</span></a><br/>
&nbsp;&nbsp;| <a id="evalnp_set" class="idref" href="#evalnp_set"><span class="id" title="constructor">evalnp_set</span></a> : <span class="id" title="keyword">∀</span> <a id="s:46" class="idref" href="#s:46"><span class="id" title="binder">s</span></a> <a id="p:47" class="idref" href="#p:47"><span class="id" title="binder">p</span></a> <a id="v:48" class="idref" href="#v:48"><span class="id" title="binder">v</span></a> <a id="Q:49" class="idref" href="#Q:49"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#Fmap.indom"><span class="id" title="definition">Fmap.indom</span></a> <a class="idref" href="Partial.html#s:46"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#p:47"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#Q:49"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a> (<a class="idref" href="LibSepReference.html#Fmap.update"><span class="id" title="definition">Fmap.update</span></a> <a class="idref" href="Partial.html#s:46"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#p:47"><span class="id" title="variable">p</span></a> <a class="idref" href="Partial.html#v:48"><span class="id" title="variable">v</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnp:1"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s:46"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#val_set"><span class="id" title="constructor">val_set</span></a> (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Partial.html#p:47"><span class="id" title="variable">p</span></a>) <a class="idref" href="Partial.html#v:48"><span class="id" title="variable">v</span></a>) <a class="idref" href="Partial.html#Q:49"><span class="id" title="variable">Q</span></a><br/>
&nbsp;&nbsp;| <a id="evalnp_free" class="idref" href="#evalnp_free"><span class="id" title="constructor">evalnp_free</span></a> : <span class="id" title="keyword">∀</span> <a id="s:50" class="idref" href="#s:50"><span class="id" title="binder">s</span></a> <a id="p:51" class="idref" href="#p:51"><span class="id" title="binder">p</span></a> <a id="Q:52" class="idref" href="#Q:52"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#Fmap.indom"><span class="id" title="definition">Fmap.indom</span></a> <a class="idref" href="Partial.html#s:50"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#p:51"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#Q:52"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a> (<a class="idref" href="LibSepReference.html#Fmap.remove"><span class="id" title="definition">Fmap.remove</span></a> <a class="idref" href="Partial.html#s:50"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#p:51"><span class="id" title="variable">p</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnp:1"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s:50"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#val_free"><span class="id" title="constructor">val_free</span></a> (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Partial.html#p:51"><span class="id" title="variable">p</span></a>)) <a class="idref" href="Partial.html#Q:52"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
The judgment <span class="inlinecode"><span class="id" title="var">hoarenp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> captures partial correctness, in terms of
    <span class="inlinecode"><span class="id" title="var">evalnp</span></span>. It is defined through the usual pattern for Hoare triples. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="hoarenp" class="idref" href="#hoarenp"><span class="id" title="definition">hoarenp</span></a> (<a id="t:53" class="idref" href="#t:53"><span class="id" title="binder">t</span></a>:<a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>) (<a id="H:54" class="idref" href="#H:54"><span class="id" title="binder">H</span></a>:<a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) (<a id="Q:55" class="idref" href="#Q:55"><span class="id" title="binder">Q</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s:56" class="idref" href="#s:56"><span class="id" title="binder">s</span></a>, <a class="idref" href="Partial.html#H:54"><span class="id" title="variable">H</span></a> <a class="idref" href="Partial.html#s:56"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Partial.html#evalnp"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s:56"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:53"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#Q:55"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
One key property is the covariance of <span class="inlinecode"><span class="id" title="var">evalnp</span></span>, which induces the rule
    of consequence for <span class="inlinecode"><span class="id" title="var">hoarenp</span></span>. An interesting about the proof of covariance
    is that it is not carried out by induction, like <span class="inlinecode"><span class="id" title="var">evaln_conseq</span></span>, but by
    coinduction. Observe carefully the details of that proof. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="evalnp_conseq" class="idref" href="#evalnp_conseq"><span class="id" title="lemma">evalnp_conseq</span></a> : <span class="id" title="keyword">∀</span> <a id="s:57" class="idref" href="#s:57"><span class="id" title="binder">s</span></a> <a id="t:58" class="idref" href="#t:58"><span class="id" title="binder">t</span></a> <a id="Q<sub>1</sub>:59" class="idref" href="#Q<sub>1</sub>:59"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:60" class="idref" href="#Q<sub>2</sub>:60"><span class="id" title="binder">Q<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnp"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s:57"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:58"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#Q<sub>1</sub>:59"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#Q<sub>1</sub>:59"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Partial.html#Q<sub>2</sub>:60"><span class="id" title="variable">Q<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnp"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s:57"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:58"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#Q<sub>2</sub>:60"><span class="id" title="variable">Q<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span> <span class="id" title="var">W</span>. <span class="id" title="var">unfolds</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.qimpl"><span class="id" title="definition">qimpl</span></a>, <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl"><span class="id" title="definition">himpl</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">gen</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span> <span class="id" title="var">Q<sub>1</sub></span> <span class="id" title="var">Q<sub>2</sub></span>. <span class="id" title="keyword">cofix</span> <span class="id" title="var">IH</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">M</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [ <span class="id" title="var">constructors</span>* ].<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab478"></a><h4 class="section">Exercise: 3 stars, standard, optional (evalnp_inv_eval)</h4>
 Assume <span class="inlinecode"><span class="id" title="var">evalnp</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> to hold. Prove that the postcondition <span class="inlinecode"><span class="id" title="var">Q</span></span> holds of
    any output that <span class="inlinecode">(<span class="id" title="var">s</span>,<span class="id" title="var">t</span>)</span> may evaluate to according to the judgment <span class="inlinecode"><span class="id" title="tactic">eval</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="evalnp_inv_eval" class="idref" href="#evalnp_inv_eval"><span class="id" title="lemma">evalnp_inv_eval</span></a> : <span class="id" title="keyword">∀</span> <a id="s:61" class="idref" href="#s:61"><span class="id" title="binder">s</span></a> <a id="t:62" class="idref" href="#t:62"><span class="id" title="binder">t</span></a> <a id="v:63" class="idref" href="#v:63"><span class="id" title="binder">v</span></a> <a id="s':64" class="idref" href="#s':64"><span class="id" title="binder">s'</span></a> <a id="Q:65" class="idref" href="#Q:65"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnp"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s:61"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:62"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#Q:65"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Nondet.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Partial.html#s:61"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:62"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#s':64"><span class="id" title="variable">s'</span></a> <a class="idref" href="Partial.html#v:63"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#Q:65"><span class="id" title="variable">Q</span></a> <a class="idref" href="Partial.html#v:63"><span class="id" title="variable">v</span></a> <a class="idref" href="Partial.html#s':64"><span class="id" title="variable">s'</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab479"></a><h2 class="section">From Total to Partial Correctness</h2>

<div class="paragraph"> </div>

 Total correctness is a stronger property than partial correctness:
    <span class="inlinecode"><span class="id" title="var">hoaren</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> entails <span class="inlinecode"><span class="id" title="var">hoarenp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>. To formalize this result, we first
    establish that <span class="inlinecode"><span class="id" title="var">evaln</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>, which is defined inductively, entails
    <span class="inlinecode"><span class="id" title="var">evalnp</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>, which is defined coinductively.

<div class="paragraph"> </div>

    The proof is a straightforward induction, reflecting on the fact that a
    coinductive interpretation of a set of rules is always derivable from an
    inductive interpretation of a same set of derivation rules. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="evalnp_of_evaln" class="idref" href="#evalnp_of_evaln"><span class="id" title="lemma">evalnp_of_evaln</span></a> : <span class="id" title="keyword">∀</span> <a id="s:66" class="idref" href="#s:66"><span class="id" title="binder">s</span></a> <a id="t:67" class="idref" href="#t:67"><span class="id" title="binder">t</span></a> <a id="Q:68" class="idref" href="#Q:68"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Nondet.html#evaln"><span class="id" title="inductive">evaln</span></a> <a class="idref" href="Partial.html#s:66"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:67"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#Q:68"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnp"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s:66"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:67"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#Q:68"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">M</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [ <span class="id" title="var">constructors</span>* ]. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="hoaren_of_cohoare" class="idref" href="#hoaren_of_cohoare"><span class="id" title="lemma">hoaren_of_cohoare</span></a> : <span class="id" title="keyword">∀</span> <a id="t:69" class="idref" href="#t:69"><span class="id" title="binder">t</span></a> <a id="H:70" class="idref" href="#H:70"><span class="id" title="binder">H</span></a> <a id="Q:71" class="idref" href="#Q:71"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Nondet.html#hoaren"><span class="id" title="definition">hoaren</span></a> <a class="idref" href="Partial.html#t:69"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#H:70"><span class="id" title="variable">H</span></a> <a class="idref" href="Partial.html#Q:71"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenp"><span class="id" title="definition">hoarenp</span></a> <a class="idref" href="Partial.html#t:69"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#H:70"><span class="id" title="variable">H</span></a> <a class="idref" href="Partial.html#Q:71"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">s</span> <span class="id" title="var">K</span>. <span class="id" title="var">specializes</span> <span class="id" title="var">M</span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span> <a class="idref" href="Partial.html#evalnp_of_evaln"><span class="id" title="lemma">evalnp_of_evaln</span></a> <span class="id" title="var">M</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab480"></a><h2 class="section">Characterization of Divergence</h2>

<div class="paragraph"> </div>

 The judgment partial correctness judgment <span class="inlinecode"><span class="id" title="var">evalnp</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> asserts that
    any execution of the program <span class="inlinecode">(<span class="id" title="var">s</span>,<span class="id" title="var">t</span>)</span> either terminates on an output
    satisfying <span class="inlinecode"><span class="id" title="var">Q</span></span>, or diverge. By instantiating <span class="inlinecode"><span class="id" title="var">Q</span></span> as the predicate that is
    always false, we are thus able to assert that "every possible execution of
    the program <span class="inlinecode">(<span class="id" title="var">s</span>,<span class="id" title="var">t</span>)</span> diverges".

<div class="paragraph"> </div>

    Let us name <span class="inlinecode"><span class="id" title="var">Empty</span></span> this "empty" postcondition, which characterizes an
    empty set of output configurations. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="Empty" class="idref" href="#Empty"><span class="id" title="definition">Empty</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#state"><span class="id" title="definition">state</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="v:72" class="idref" href="#v:72"><span class="id" title="binder">v</span></a> <a id="s:73" class="idref" href="#s:73"><span class="id" title="binder">s</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>
</div>

<div class="doc">
The judgment <span class="inlinecode"><span class="id" title="var">divn</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>, defined as <span class="inlinecode"><span class="id" title="var">evalnp</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Empty</span></span>, asserts that every
    possible execution of the program <span class="inlinecode">(<span class="id" title="var">s</span>,<span class="id" title="var">t</span>)</span> diverges. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="divn" class="idref" href="#divn"><span class="id" title="definition">divn</span></a> (<a id="s:74" class="idref" href="#s:74"><span class="id" title="binder">s</span></a>:<a class="idref" href="LibSepReference.html#state"><span class="id" title="definition">state</span></a>) (<a id="t:75" class="idref" href="#t:75"><span class="id" title="binder">t</span></a>:<a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnp"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s:74"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:75"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#Empty"><span class="id" title="definition">Empty</span></a>.<br/>
</div>

<div class="doc">
<a id="lab481"></a><h2 class="section">Big-Step-Based Reasoning Rules</h2>

<div class="paragraph"> </div>

 For the partial correctness triple (<span class="inlinecode"><span class="id" title="var">hoarenp</span></span>), we can derive all the usual
    reasoning rules. The proofs are the same as for the reasoning rules for
    deriving total correctness triples (<span class="inlinecode"><span class="id" title="var">hoaren</span></span>). 
<div class="paragraph"> </div>

 Structural rules 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="hoarenp_conseq" class="idref" href="#hoarenp_conseq"><span class="id" title="lemma">hoarenp_conseq</span></a> : <span class="id" title="keyword">∀</span> <a id="t:76" class="idref" href="#t:76"><span class="id" title="binder">t</span></a> <a id="H':77" class="idref" href="#H':77"><span class="id" title="binder">H'</span></a> <a id="Q':78" class="idref" href="#Q':78"><span class="id" title="binder">Q'</span></a> <a id="H:79" class="idref" href="#H:79"><span class="id" title="binder">H</span></a> <a id="Q:80" class="idref" href="#Q:80"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenp"><span class="id" title="definition">hoarenp</span></a> <a class="idref" href="Partial.html#t:76"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#H':77"><span class="id" title="variable">H'</span></a> <a class="idref" href="Partial.html#Q':78"><span class="id" title="variable">Q'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#H:79"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Partial.html#H':77"><span class="id" title="variable">H'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#Q':78"><span class="id" title="variable">Q'</span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Partial.html#Q:80"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenp"><span class="id" title="definition">hoarenp</span></a> <a class="idref" href="Partial.html#t:76"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#H:79"><span class="id" title="variable">H</span></a> <a class="idref" href="Partial.html#Q:80"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">unfolds</span> <a class="idref" href="Partial.html#hoarenp"><span class="id" title="definition">hoarenp</span></a>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span> <span class="id" title="var">MH</span> <span class="id" title="var">MQ</span> <span class="id" title="var">HF</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_conseq"><span class="id" title="lemma">evalnp_conseq</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="hoarenp_hexists" class="idref" href="#hoarenp_hexists"><span class="id" title="lemma">hoarenp_hexists</span></a> : <span class="id" title="keyword">∀</span> <a id="t:81" class="idref" href="#t:81"><span class="id" title="binder">t</span></a> (<a id="A:82" class="idref" href="#A:82"><span class="id" title="binder">A</span></a>:<span class="id" title="keyword">Type</span>) (<a id="J:83" class="idref" href="#J:83"><span class="id" title="binder">J</span></a>:<a class="idref" href="Partial.html#A:82"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) <a id="Q:84" class="idref" href="#Q:84"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="x:85" class="idref" href="#x:85"><span class="id" title="binder">x</span></a>, <a class="idref" href="Partial.html#hoarenp"><span class="id" title="definition">hoarenp</span></a> <a class="idref" href="Partial.html#t:81"><span class="id" title="variable">t</span></a> (<a class="idref" href="Partial.html#J:83"><span class="id" title="variable">J</span></a> <a class="idref" href="Partial.html#x:85"><span class="id" title="variable">x</span></a>) <a class="idref" href="Partial.html#Q:84"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenp"><span class="id" title="definition">hoarenp</span></a> <a class="idref" href="Partial.html#t:81"><span class="id" title="variable">t</span></a> (<a class="idref" href="LibSepReference.html#SepSimplArgs.hexists"><span class="id" title="definition">hexists</span></a> <a class="idref" href="Partial.html#J:83"><span class="id" title="variable">J</span></a>) <a class="idref" href="Partial.html#Q:84"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> (<span class="id" title="var">x</span>&amp;<span class="id" title="var">Hh</span>). <span class="id" title="var">applys</span> <span class="id" title="var">M</span> <span class="id" title="var">Hh</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="hoarenp_hpure" class="idref" href="#hoarenp_hpure"><span class="id" title="lemma">hoarenp_hpure</span></a> : <span class="id" title="keyword">∀</span> <a id="t:86" class="idref" href="#t:86"><span class="id" title="binder">t</span></a> (<a id="P:87" class="idref" href="#P:87"><span class="id" title="binder">P</span></a>:<span class="id" title="keyword">Prop</span>) <a id="H:88" class="idref" href="#H:88"><span class="id" title="binder">H</span></a> <a id="Q:89" class="idref" href="#Q:89"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Partial.html#P:87"><span class="id" title="variable">P</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Partial.html#hoarenp"><span class="id" title="definition">hoarenp</span></a> <a class="idref" href="Partial.html#t:86"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#H:88"><span class="id" title="variable">H</span></a> <a class="idref" href="Partial.html#Q:89"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenp"><span class="id" title="definition">hoarenp</span></a> <a class="idref" href="Partial.html#t:86"><span class="id" title="variable">t</span></a> (<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Partial.html#P:87"><span class="id" title="variable">P</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Partial.html#H:88"><span class="id" title="variable">H</span></a>) <a class="idref" href="Partial.html#Q:89"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> (<span class="id" title="var">h<sub>1</sub></span>&amp;<span class="id" title="var">h<sub>2</sub></span>&amp;<span class="id" title="var">M<sub>1</sub></span>&amp;<span class="id" title="var">M<sub>2</sub></span>&amp;<span class="id" title="var">D</span>&amp;<span class="id" title="var">U</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="keyword">as</span> (<span class="id" title="var">M<sub>1</sub></span>&amp;<span class="id" title="var">HP</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">lets</span> <span class="id" title="var">E</span>: <a class="idref" href="LibSepReference.html#SepSimplArgs.hempty_inv"><span class="id" title="lemma">hempty_inv</span></a> <span class="id" title="var">HP</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#Fmap.union_empty_l"><span class="id" title="lemma">Fmap.union_empty_l</span></a>. <span class="id" title="var">applys</span>¬<span class="id" title="var">M</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Rules for term constructs 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="hoarenp_val" class="idref" href="#hoarenp_val"><span class="id" title="lemma">hoarenp_val</span></a> : <span class="id" title="keyword">∀</span> <a id="v:90" class="idref" href="#v:90"><span class="id" title="binder">v</span></a> <a id="H:91" class="idref" href="#H:91"><span class="id" title="binder">H</span></a> <a id="Q:92" class="idref" href="#Q:92"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#H:91"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Partial.html#Q:92"><span class="id" title="variable">Q</span></a> <a class="idref" href="Partial.html#v:90"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenp"><span class="id" title="definition">hoarenp</span></a> (<a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <a class="idref" href="Partial.html#v:90"><span class="id" title="variable">v</span></a>) <a class="idref" href="Partial.html#H:91"><span class="id" title="variable">H</span></a> <a class="idref" href="Partial.html#Q:92"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_val"><span class="id" title="constructor">evalnp_val</span></a>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="hoarenp_fix" class="idref" href="#hoarenp_fix"><span class="id" title="lemma">hoarenp_fix</span></a> : <span class="id" title="keyword">∀</span> <a id="f:93" class="idref" href="#f:93"><span class="id" title="binder">f</span></a> <a id="x:94" class="idref" href="#x:94"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:95" class="idref" href="#t<sub>1</sub>:95"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="H:96" class="idref" href="#H:96"><span class="id" title="binder">H</span></a> <a id="Q:97" class="idref" href="#Q:97"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#H:96"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Partial.html#Q:97"><span class="id" title="variable">Q</span></a> (<a class="idref" href="LibSepReference.html#val_fix"><span class="id" title="constructor">val_fix</span></a> <a class="idref" href="Partial.html#f:93"><span class="id" title="variable">f</span></a> <a class="idref" href="Partial.html#x:94"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:95"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenp"><span class="id" title="definition">hoarenp</span></a> (<a class="idref" href="LibSepReference.html#trm_fix"><span class="id" title="constructor">trm_fix</span></a> <a class="idref" href="Partial.html#f:93"><span class="id" title="variable">f</span></a> <a class="idref" href="Partial.html#x:94"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:95"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="Partial.html#H:96"><span class="id" title="variable">H</span></a> <a class="idref" href="Partial.html#Q:97"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_fix"><span class="id" title="constructor">evalnp_fix</span></a>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="hoarenp_app_fix" class="idref" href="#hoarenp_app_fix"><span class="id" title="lemma">hoarenp_app_fix</span></a> : <span class="id" title="keyword">∀</span> <a id="v<sub>1</sub>:98" class="idref" href="#v<sub>1</sub>:98"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="v<sub>2</sub>:99" class="idref" href="#v<sub>2</sub>:99"><span class="id" title="binder">v<sub>2</sub></span></a> <a id="f:100" class="idref" href="#f:100"><span class="id" title="binder">f</span></a> <a id="x:101" class="idref" href="#x:101"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:102" class="idref" href="#t<sub>1</sub>:102"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="H:103" class="idref" href="#H:103"><span class="id" title="binder">H</span></a> <a id="Q:104" class="idref" href="#Q:104"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#v<sub>1</sub>:98"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_fix"><span class="id" title="constructor">val_fix</span></a> <a class="idref" href="Partial.html#f:100"><span class="id" title="variable">f</span></a> <a class="idref" href="Partial.html#x:101"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:102"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenp"><span class="id" title="definition">hoarenp</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Partial.html#x:101"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#v<sub>2</sub>:99"><span class="id" title="variable">v<sub>2</sub></span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Partial.html#f:100"><span class="id" title="variable">f</span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:98"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:102"><span class="id" title="variable">t<sub>1</sub></span></a>)) <a class="idref" href="Partial.html#H:103"><span class="id" title="variable">H</span></a> <a class="idref" href="Partial.html#Q:104"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenp"><span class="id" title="definition">hoarenp</span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:98"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Partial.html#v<sub>2</sub>:99"><span class="id" title="variable">v<sub>2</sub></span></a>) <a class="idref" href="Partial.html#H:103"><span class="id" title="variable">H</span></a> <a class="idref" href="Partial.html#Q:104"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">E</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_app_fix"><span class="id" title="constructor">evalnp_app_fix</span></a>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="hoarenp_let" class="idref" href="#hoarenp_let"><span class="id" title="lemma">hoarenp_let</span></a> : <span class="id" title="keyword">∀</span> <a id="x:105" class="idref" href="#x:105"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:106" class="idref" href="#t<sub>1</sub>:106"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:107" class="idref" href="#t<sub>2</sub>:107"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="H:108" class="idref" href="#H:108"><span class="id" title="binder">H</span></a> <a id="Q:109" class="idref" href="#Q:109"><span class="id" title="binder">Q</span></a> <a id="Q<sub>1</sub>:110" class="idref" href="#Q<sub>1</sub>:110"><span class="id" title="binder">Q<sub>1</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenp"><span class="id" title="definition">hoarenp</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:106"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#H:108"><span class="id" title="variable">H</span></a> <a class="idref" href="Partial.html#Q<sub>1</sub>:110"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="v<sub>1</sub>:111" class="idref" href="#v<sub>1</sub>:111"><span class="id" title="binder">v<sub>1</sub></span></a>, <a class="idref" href="Partial.html#hoarenp"><span class="id" title="definition">hoarenp</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Partial.html#x:105"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:111"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:107"><span class="id" title="variable">t<sub>2</sub></span></a>) (<a class="idref" href="Partial.html#Q<sub>1</sub>:110"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:111"><span class="id" title="variable">v<sub>1</sub></span></a>) <a class="idref" href="Partial.html#Q:109"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenp"><span class="id" title="definition">hoarenp</span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="Partial.html#x:105"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:106"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:107"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Partial.html#H:108"><span class="id" title="variable">H</span></a> <a class="idref" href="Partial.html#Q:109"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_let"><span class="id" title="constructor">evalnp_let</span></a>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="hoarenp_if" class="idref" href="#hoarenp_if"><span class="id" title="lemma">hoarenp_if</span></a> : <span class="id" title="keyword">∀</span> (<a id="b:112" class="idref" href="#b:112"><span class="id" title="binder">b</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>) <a id="t<sub>1</sub>:113" class="idref" href="#t<sub>1</sub>:113"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:114" class="idref" href="#t<sub>2</sub>:114"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="H:115" class="idref" href="#H:115"><span class="id" title="binder">H</span></a> <a id="Q:116" class="idref" href="#Q:116"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenp"><span class="id" title="definition">hoarenp</span></a> (<span class="id" title="keyword">if</span> <a class="idref" href="Partial.html#b:112"><span class="id" title="variable">b</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="Partial.html#t<sub>1</sub>:113"><span class="id" title="variable">t<sub>1</sub></span></a> <span class="id" title="keyword">else</span> <a class="idref" href="Partial.html#t<sub>2</sub>:114"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Partial.html#H:115"><span class="id" title="variable">H</span></a> <a class="idref" href="Partial.html#Q:116"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenp"><span class="id" title="definition">hoarenp</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> <a class="idref" href="Partial.html#b:112"><span class="id" title="variable">b</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:113"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:114"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Partial.html#H:115"><span class="id" title="variable">H</span></a> <a class="idref" href="Partial.html#Q:116"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_if"><span class="id" title="constructor">evalnp_if</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Rules for primitive operations 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="hoarenp_add" class="idref" href="#hoarenp_add"><span class="id" title="lemma">hoarenp_add</span></a> : <span class="id" title="keyword">∀</span> <a id="H:117" class="idref" href="#H:117"><span class="id" title="binder">H</span></a> <a id="n<sub>1</sub>:118" class="idref" href="#n<sub>1</sub>:118"><span class="id" title="binder">n<sub>1</sub></span></a> <a id="n<sub>2</sub>:119" class="idref" href="#n<sub>2</sub>:119"><span class="id" title="binder">n<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenp"><span class="id" title="definition">hoarenp</span></a> (<a class="idref" href="LibSepReference.html#val_add"><span class="id" title="constructor">val_add</span></a> <a class="idref" href="Partial.html#n<sub>1</sub>:118"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Partial.html#n<sub>2</sub>:119"><span class="id" title="variable">n<sub>2</sub></span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#H:117"><span class="id" title="variable">H</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:120" class="idref" href="#r:120"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Partial.html#r:120"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> (<a class="idref" href="Partial.html#n<sub>1</sub>:118"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="Partial.html#n<sub>2</sub>:119"><span class="id" title="variable">n<sub>2</sub></span></a>)<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Partial.html#H:117"><span class="id" title="variable">H</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_add"><span class="id" title="constructor">evalnp_add</span></a>. <span class="id" title="tactic">rewrite</span>* <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_hpure_l"><span class="id" title="lemma">hstar_hpure_l</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="hoarenp_rand" class="idref" href="#hoarenp_rand"><span class="id" title="lemma">hoarenp_rand</span></a> : <span class="id" title="keyword">∀</span> <a id="n:121" class="idref" href="#n:121"><span class="id" title="binder">n</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#n:121"><span class="id" title="variable">n</span></a> <span class="id" title="notation">&gt;</span> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenp"><span class="id" title="definition">hoarenp</span></a> (<a class="idref" href="LibSepReference.html#val_rand"><span class="id" title="constructor">val_rand</span></a> <a class="idref" href="Partial.html#n:121"><span class="id" title="variable">n</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:122" class="idref" href="#r:122"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="n<sub>1</sub>:123" class="idref" href="#n<sub>1</sub>:123"><span class="id" title="binder">n<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a>0 <span class="id" title="notation">≤</span> <a class="idref" href="Partial.html#n<sub>1</sub>:123"><span class="id" title="variable">n<sub>1</sub></span></a> <span class="id" title="notation">&lt;</span> <a class="idref" href="Partial.html#n:121"><span class="id" title="variable">n</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Partial.html#r:122"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Partial.html#n<sub>1</sub>:123"><span class="id" title="variable">n<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">N</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_rand"><span class="id" title="constructor">evalnp_rand</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">lets</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>: <a class="idref" href="LibSepReference.html#SepSimplArgs.hempty_inv"><span class="id" title="lemma">hempty_inv</span></a> <span class="id" title="var">K</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n<sub>1</sub></span> <span class="id" title="var">H<sub>1</sub></span>. <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#SepSimplArgs.hexists_intro"><span class="id" title="lemma">hexists_intro</span></a> <span class="id" title="var">n<sub>1</sub></span>. <span class="id" title="tactic">rewrite</span>* <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_hpure_l"><span class="id" title="lemma">hstar_hpure_l</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>*. <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#SepSimplArgs.hpure_intro"><span class="id" title="lemma">hpure_intro</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="hoarenp_ref" class="idref" href="#hoarenp_ref"><span class="id" title="lemma">hoarenp_ref</span></a> : <span class="id" title="keyword">∀</span> <a id="H:124" class="idref" href="#H:124"><span class="id" title="binder">H</span></a> <a id="v:125" class="idref" href="#v:125"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenp"><span class="id" title="definition">hoarenp</span></a> (<a class="idref" href="LibSepReference.html#val_ref"><span class="id" title="constructor">val_ref</span></a> <a class="idref" href="Partial.html#v:125"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#H:124"><span class="id" title="variable">H</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:126" class="idref" href="#r:126"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="p:127" class="idref" href="#p:127"><span class="id" title="binder">p</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Partial.html#r:126"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Partial.html#p:127"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Partial.html#p:127"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Partial.html#v:125"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Partial.html#H:124"><span class="id" title="variable">H</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span> <a class="idref" href="Partial.html#evalnp_ref"><span class="id" title="constructor">evalnp_ref</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">p</span> <span class="id" title="var">D</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">unfolds</span> <a class="idref" href="LibSepFmap.html#update"><span class="id" title="definition">update</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_intro"><span class="id" title="lemma">hstar_intro</span></a> <span class="id" title="var">K</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hexists_intro"><span class="id" title="lemma">hexists_intro</span></a> <span class="id" title="var">p</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_hpure_l"><span class="id" title="lemma">hstar_hpure_l</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>*. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hsingle_intro"><span class="id" title="lemma">hsingle_intro</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span>* <a class="idref" href="LibSepFmap.html#disjoint_single_of_not_indom"><span class="id" title="lemma">disjoint_single_of_not_indom</span></a>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="hoarenp_get" class="idref" href="#hoarenp_get"><span class="id" title="lemma">hoarenp_get</span></a> : <span class="id" title="keyword">∀</span> <a id="H:128" class="idref" href="#H:128"><span class="id" title="binder">H</span></a> <a id="v:129" class="idref" href="#v:129"><span class="id" title="binder">v</span></a> <a id="p:130" class="idref" href="#p:130"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenp"><span class="id" title="definition">hoarenp</span></a> (<a class="idref" href="LibSepReference.html#val_get"><span class="id" title="constructor">val_get</span></a> <a class="idref" href="Partial.html#p:130"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Partial.html#p:130"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Partial.html#v:129"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Partial.html#H:128"><span class="id" title="variable">H</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:131" class="idref" href="#r:131"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Partial.html#r:131"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Partial.html#v:129"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Partial.html#p:130"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Partial.html#v:129"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Partial.html#H:128"><span class="id" title="variable">H</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">s</span> <span class="id" title="var">K</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">lets</span> (<span class="id" title="var">h<sub>1</sub></span>&amp;<span class="id" title="var">h<sub>2</sub></span>&amp;<span class="id" title="var">P<sub>1</sub></span>&amp;<span class="id" title="var">P<sub>2</sub></span>&amp;<span class="id" title="var">D</span>&amp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>): <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_inv"><span class="id" title="lemma">hstar_inv</span></a> (<span class="id" title="definition">rm</span> <span class="id" title="var">K</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">lets</span> <span class="id" title="var">E<sub>1</sub></span>: <a class="idref" href="LibSepReference.html#SepSimplArgs.hsingle_inv"><span class="id" title="lemma">hsingle_inv</span></a> <span class="id" title="var">P<sub>1</sub></span>. <span class="id" title="var">lets</span> <span class="id" title="var">I<sub>1</sub></span>: <a class="idref" href="LibSepFmap.html#indom_single"><span class="id" title="lemma">indom_single</span></a> <span class="id" title="var">p</span> <span class="id" title="var">v</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="Partial.html#evalnp_get"><span class="id" title="constructor">evalnp_get</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#Fmap.indom_union_l"><span class="id" title="lemma">Fmap.indom_union_l</span></a>. <span class="id" title="tactic">subst</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepFmap.html#indom_single"><span class="id" title="lemma">indom_single</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_hpure_l"><span class="id" title="lemma">hstar_hpure_l</span></a>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">subst</span> <span class="id" title="var">h<sub>1</sub></span>. <span class="id" title="tactic">rewrite</span>* <a class="idref" href="LibSepReference.html#Fmap.read_union_l"><span class="id" title="lemma">Fmap.read_union_l</span></a>. <span class="id" title="tactic">rewrite</span>* <a class="idref" href="LibSepReference.html#Fmap.read_single"><span class="id" title="lemma">Fmap.read_single</span></a>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_intro"><span class="id" title="lemma">hstar_intro</span></a>. } }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="hoarenp_set" class="idref" href="#hoarenp_set"><span class="id" title="lemma">hoarenp_set</span></a> : <span class="id" title="keyword">∀</span> <a id="H:132" class="idref" href="#H:132"><span class="id" title="binder">H</span></a> <a id="w:133" class="idref" href="#w:133"><span class="id" title="binder">w</span></a> <a id="p:134" class="idref" href="#p:134"><span class="id" title="binder">p</span></a> <a id="v:135" class="idref" href="#v:135"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenp"><span class="id" title="definition">hoarenp</span></a> (<a class="idref" href="LibSepReference.html#val_set"><span class="id" title="constructor">val_set</span></a> (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Partial.html#p:134"><span class="id" title="variable">p</span></a>) <a class="idref" href="Partial.html#v:135"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Partial.html#p:134"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Partial.html#w:133"><span class="id" title="variable">w</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Partial.html#H:132"><span class="id" title="variable">H</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:136" class="idref" href="#r:136"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Partial.html#r:136"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Partial.html#p:134"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Partial.html#v:135"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Partial.html#H:132"><span class="id" title="variable">H</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">K</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">lets</span> (<span class="id" title="var">h<sub>1</sub></span>&amp;<span class="id" title="var">h<sub>2</sub></span>&amp;<span class="id" title="var">P<sub>1</sub></span>&amp;<span class="id" title="var">P<sub>2</sub></span>&amp;<span class="id" title="var">D</span>&amp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>): <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_inv"><span class="id" title="lemma">hstar_inv</span></a> (<span class="id" title="definition">rm</span> <span class="id" title="var">K</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">lets</span> <span class="id" title="var">E<sub>1</sub></span>: <a class="idref" href="LibSepReference.html#SepSimplArgs.hsingle_inv"><span class="id" title="lemma">hsingle_inv</span></a> <span class="id" title="var">P<sub>1</sub></span>. <span class="id" title="var">lets</span> <span class="id" title="var">I<sub>1</sub></span>: <a class="idref" href="LibSepFmap.html#indom_single"><span class="id" title="lemma">indom_single</span></a> <span class="id" title="var">p</span> <span class="id" title="var">v</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="Partial.html#evalnp_set"><span class="id" title="constructor">evalnp_set</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#Fmap.indom_union_l"><span class="id" title="lemma">Fmap.indom_union_l</span></a>. <span class="id" title="tactic">subst</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepFmap.html#indom_single"><span class="id" title="lemma">indom_single</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_hpure_l"><span class="id" title="lemma">hstar_hpure_l</span></a>. <span class="id" title="tactic">split</span>*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">subst</span> <span class="id" title="var">h<sub>1</sub></span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#Fmap.update_union_l"><span class="id" title="lemma">Fmap.update_union_l</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepFmap.html#indom_single"><span class="id" title="lemma">indom_single</span></a>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepFmap.html#update_single"><span class="id" title="lemma">update_single</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_intro"><span class="id" title="lemma">hstar_intro</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hsingle_intro"><span class="id" title="lemma">hsingle_intro</span></a>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <span class="id" title="var">P<sub>2</sub></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#Fmap.disjoint_single_set"><span class="id" title="lemma">Fmap.disjoint_single_set</span></a> <span class="id" title="var">D</span>. } } }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="hoarenp_free" class="idref" href="#hoarenp_free"><span class="id" title="lemma">hoarenp_free</span></a> : <span class="id" title="keyword">∀</span> <a id="H:137" class="idref" href="#H:137"><span class="id" title="binder">H</span></a> <a id="p:138" class="idref" href="#p:138"><span class="id" title="binder">p</span></a> <a id="v:139" class="idref" href="#v:139"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenp"><span class="id" title="definition">hoarenp</span></a> (<a class="idref" href="LibSepReference.html#val_free"><span class="id" title="constructor">val_free</span></a> (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Partial.html#p:138"><span class="id" title="variable">p</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Partial.html#p:138"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Partial.html#v:139"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Partial.html#H:137"><span class="id" title="variable">H</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:140" class="idref" href="#r:140"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Partial.html#r:140"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Partial.html#H:137"><span class="id" title="variable">H</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">K</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">lets</span> (<span class="id" title="var">h<sub>1</sub></span>&amp;<span class="id" title="var">h<sub>2</sub></span>&amp;<span class="id" title="var">P<sub>1</sub></span>&amp;<span class="id" title="var">P<sub>2</sub></span>&amp;<span class="id" title="var">D</span>&amp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>): <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_inv"><span class="id" title="lemma">hstar_inv</span></a> (<span class="id" title="definition">rm</span> <span class="id" title="var">K</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">lets</span> <span class="id" title="var">E<sub>1</sub></span>: <a class="idref" href="LibSepReference.html#SepSimplArgs.hsingle_inv"><span class="id" title="lemma">hsingle_inv</span></a> <span class="id" title="var">P<sub>1</sub></span>. <span class="id" title="var">lets</span> <span class="id" title="var">I<sub>1</sub></span>: <a class="idref" href="LibSepFmap.html#indom_single"><span class="id" title="lemma">indom_single</span></a> <span class="id" title="var">p</span> <span class="id" title="var">v</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="Partial.html#evalnp_free"><span class="id" title="constructor">evalnp_free</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#Fmap.indom_union_l"><span class="id" title="lemma">Fmap.indom_union_l</span></a>. <span class="id" title="tactic">subst</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepFmap.html#indom_single"><span class="id" title="lemma">indom_single</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_hpure_l"><span class="id" title="lemma">hstar_hpure_l</span></a>. <span class="id" title="tactic">split</span>*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">subst</span> <span class="id" title="var">h<sub>1</sub></span>. <span class="id" title="tactic">rewrite</span>* <a class="idref" href="LibSepReference.html#Fmap.remove_union_single_l"><span class="id" title="lemma">Fmap.remove_union_single_l</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">Dl</span>. <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#Fmap.disjoint_inv_not_indom_both"><span class="id" title="lemma">Fmap.disjoint_inv_not_indom_both</span></a> <span class="id" title="var">D</span> <span class="id" title="var">Dl</span>. } } }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab482"></a><h2 class="section">Big-Step-Based Reasoning Rules for Divergence</h2>

<div class="paragraph"> </div>

 In a partial correctness setting, it is also interesting to derive
    reasoning rules for establishing that a program diverges. These rules
    are stated and proved next. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="divn_app_fix" class="idref" href="#divn_app_fix"><span class="id" title="lemma">divn_app_fix</span></a> : <span class="id" title="keyword">∀</span> <a id="s<sub>1</sub>:141" class="idref" href="#s<sub>1</sub>:141"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="v<sub>1</sub>:142" class="idref" href="#v<sub>1</sub>:142"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="v<sub>2</sub>:143" class="idref" href="#v<sub>2</sub>:143"><span class="id" title="binder">v<sub>2</sub></span></a> <a id="f:144" class="idref" href="#f:144"><span class="id" title="binder">f</span></a> <a id="x:145" class="idref" href="#x:145"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:146" class="idref" href="#t<sub>1</sub>:146"><span class="id" title="binder">t<sub>1</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#v<sub>1</sub>:142"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_fix"><span class="id" title="constructor">val_fix</span></a> <a class="idref" href="Partial.html#f:144"><span class="id" title="variable">f</span></a> <a class="idref" href="Partial.html#x:145"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:146"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#divn"><span class="id" title="definition">divn</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:141"><span class="id" title="variable">s<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Partial.html#x:145"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#v<sub>2</sub>:143"><span class="id" title="variable">v<sub>2</sub></span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Partial.html#f:144"><span class="id" title="variable">f</span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:142"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:146"><span class="id" title="variable">t<sub>1</sub></span></a>)) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#divn"><span class="id" title="definition">divn</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:141"><span class="id" title="variable">s<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:142"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Partial.html#v<sub>2</sub>:143"><span class="id" title="variable">v<sub>2</sub></span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">E</span> <span class="id" title="var">M</span>. <span class="id" title="var">unfolds</span> <a class="idref" href="Partial.html#divn"><span class="id" title="definition">divn</span></a>. <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_app_fix"><span class="id" title="constructor">evalnp_app_fix</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab483"></a><h4 class="section">Exercise: 2 stars, standard, especially useful (divn_let_ctx)</h4>
 Prove the divergence rule for a let-binding covering the case where the
    first subterm diverges. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="divn_let_ctx" class="idref" href="#divn_let_ctx"><span class="id" title="lemma">divn_let_ctx</span></a> : <span class="id" title="keyword">∀</span> <a id="s<sub>1</sub>:147" class="idref" href="#s<sub>1</sub>:147"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="x:148" class="idref" href="#x:148"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:149" class="idref" href="#t<sub>1</sub>:149"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:150" class="idref" href="#t<sub>2</sub>:150"><span class="id" title="binder">t<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#divn"><span class="id" title="definition">divn</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:147"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:149"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#divn"><span class="id" title="definition">divn</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:147"><span class="id" title="variable">s<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="Partial.html#x:148"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:149"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:150"><span class="id" title="variable">t<sub>2</sub></span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="divn_let" class="idref" href="#divn_let"><span class="id" title="lemma">divn_let</span></a> : <span class="id" title="keyword">∀</span> <a id="s<sub>1</sub>:151" class="idref" href="#s<sub>1</sub>:151"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="x:152" class="idref" href="#x:152"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:153" class="idref" href="#t<sub>1</sub>:153"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:154" class="idref" href="#t<sub>2</sub>:154"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="Q<sub>1</sub>:155" class="idref" href="#Q<sub>1</sub>:155"><span class="id" title="binder">Q<sub>1</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnp"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:151"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:153"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#Q<sub>1</sub>:155"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="s<sub>2</sub>:156" class="idref" href="#s<sub>2</sub>:156"><span class="id" title="binder">s<sub>2</sub></span></a> <a id="v<sub>1</sub>:157" class="idref" href="#v<sub>1</sub>:157"><span class="id" title="binder">v<sub>1</sub></span></a>, <a class="idref" href="Partial.html#divn"><span class="id" title="definition">divn</span></a> <a class="idref" href="Partial.html#s<sub>2</sub>:156"><span class="id" title="variable">s<sub>2</sub></span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Partial.html#x:152"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:157"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:154"><span class="id" title="variable">t<sub>2</sub></span></a>)<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#divn"><span class="id" title="definition">divn</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:151"><span class="id" title="variable">s<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="Partial.html#x:152"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:153"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:154"><span class="id" title="variable">t<sub>2</sub></span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="var">unfolds</span> <a class="idref" href="Partial.html#divn"><span class="id" title="definition">divn</span></a>. <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_let"><span class="id" title="constructor">evalnp_let</span></a> <span class="id" title="var">M<sub>1</sub></span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="divn_if" class="idref" href="#divn_if"><span class="id" title="lemma">divn_if</span></a> : <span class="id" title="keyword">∀</span> <a id="s<sub>1</sub>:158" class="idref" href="#s<sub>1</sub>:158"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="b:159" class="idref" href="#b:159"><span class="id" title="binder">b</span></a> <a id="t<sub>1</sub>:160" class="idref" href="#t<sub>1</sub>:160"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:161" class="idref" href="#t<sub>2</sub>:161"><span class="id" title="binder">t<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#divn"><span class="id" title="definition">divn</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:158"><span class="id" title="variable">s<sub>1</sub></span></a> (<span class="id" title="keyword">if</span> <a class="idref" href="Partial.html#b:159"><span class="id" title="variable">b</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="Partial.html#t<sub>1</sub>:160"><span class="id" title="variable">t<sub>1</sub></span></a> <span class="id" title="keyword">else</span> <a class="idref" href="Partial.html#t<sub>2</sub>:161"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#divn"><span class="id" title="definition">divn</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:158"><span class="id" title="variable">s<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> (<a class="idref" href="LibSepReference.html#val_bool"><span class="id" title="constructor">val_bool</span></a> <a class="idref" href="Partial.html#b:159"><span class="id" title="variable">b</span></a>) <a class="idref" href="Partial.html#t<sub>1</sub>:160"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:161"><span class="id" title="variable">t<sub>2</sub></span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">unfolds</span> <a class="idref" href="Partial.html#divn"><span class="id" title="definition">divn</span></a>. <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_if"><span class="id" title="constructor">evalnp_if</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab484"></a><h1 class="section">Optional Material</h1>

</div>

<div class="doc">
<a id="lab485"></a><h2 class="section">Interpretation of <span class="inlinecode"><span class="id" title="var">evalnp</span></span> w.r.t. <span class="inlinecode"><span class="id" title="tactic">eval</span></span> and <span class="inlinecode"><span class="id" title="var">safe</span></span></h2>

<div class="paragraph"> </div>

 The predicate <span class="inlinecode"><span class="id" title="var">safe</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> asserts that an execution of the configuration
    <span class="inlinecode"><span class="id" title="var">t</span>/<span class="id" title="var">s</span></span> can never get stuck. Its definition is a simplified version of
    <span class="inlinecode"><span class="id" title="var">evalnp</span></span> where all occurences of <span class="inlinecode"><span class="id" title="var">Q</span></span> are removed. In the rule for let-
    bindings, namely <span class="inlinecode"><span class="id" title="var">safe_let</span></span>, the quantification over the configuration
    <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span>/<span class="id" title="var">s<sub>2</sub></span></span> is done by refering to the big-step judgment <span class="inlinecode"><span class="id" title="tactic">eval</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">CoInductive</span> <a id="safe" class="idref" href="#safe"><span class="id" title="inductive">safe</span></a> : <a class="idref" href="LibSepReference.html#state"><span class="id" title="definition">state</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="safe_val" class="idref" href="#safe_val"><span class="id" title="constructor">safe_val</span></a> : <span class="id" title="keyword">∀</span> <a id="s:164" class="idref" href="#s:164"><span class="id" title="binder">s</span></a> <a id="v:165" class="idref" href="#v:165"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#safe:162"><span class="id" title="inductive">safe</span></a> <a class="idref" href="Partial.html#s:164"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <a class="idref" href="Partial.html#v:165"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;| <a id="safe_fix" class="idref" href="#safe_fix"><span class="id" title="constructor">safe_fix</span></a> : <span class="id" title="keyword">∀</span> <a id="s:166" class="idref" href="#s:166"><span class="id" title="binder">s</span></a> <a id="f:167" class="idref" href="#f:167"><span class="id" title="binder">f</span></a> <a id="x:168" class="idref" href="#x:168"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:169" class="idref" href="#t<sub>1</sub>:169"><span class="id" title="binder">t<sub>1</sub></span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#safe:162"><span class="id" title="inductive">safe</span></a> <a class="idref" href="Partial.html#s:166"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#trm_fix"><span class="id" title="constructor">trm_fix</span></a> <a class="idref" href="Partial.html#f:167"><span class="id" title="variable">f</span></a> <a class="idref" href="Partial.html#x:168"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:169"><span class="id" title="variable">t<sub>1</sub></span></a>)<br/>
&nbsp;&nbsp;| <a id="safe_app_fix" class="idref" href="#safe_app_fix"><span class="id" title="constructor">safe_app_fix</span></a> : <span class="id" title="keyword">∀</span> <a id="s:170" class="idref" href="#s:170"><span class="id" title="binder">s</span></a> <a id="v<sub>1</sub>:171" class="idref" href="#v<sub>1</sub>:171"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="v<sub>2</sub>:172" class="idref" href="#v<sub>2</sub>:172"><span class="id" title="binder">v<sub>2</sub></span></a> <a id="f:173" class="idref" href="#f:173"><span class="id" title="binder">f</span></a> <a id="x:174" class="idref" href="#x:174"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:175" class="idref" href="#t<sub>1</sub>:175"><span class="id" title="binder">t<sub>1</sub></span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#v<sub>1</sub>:171"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_fix"><span class="id" title="constructor">val_fix</span></a> <a class="idref" href="Partial.html#f:173"><span class="id" title="variable">f</span></a> <a class="idref" href="Partial.html#x:174"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:175"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#safe:162"><span class="id" title="inductive">safe</span></a> <a class="idref" href="Partial.html#s:170"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Partial.html#x:174"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#v<sub>2</sub>:172"><span class="id" title="variable">v<sub>2</sub></span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Partial.html#f:173"><span class="id" title="variable">f</span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:171"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:175"><span class="id" title="variable">t<sub>1</sub></span></a>)) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#safe:162"><span class="id" title="inductive">safe</span></a> <a class="idref" href="Partial.html#s:170"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:171"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Partial.html#v<sub>2</sub>:172"><span class="id" title="variable">v<sub>2</sub></span></a>)<br/>
&nbsp;&nbsp;| <a id="safe_let" class="idref" href="#safe_let"><span class="id" title="constructor">safe_let</span></a> : <span class="id" title="keyword">∀</span> <a id="s:176" class="idref" href="#s:176"><span class="id" title="binder">s</span></a> <a id="x:177" class="idref" href="#x:177"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:178" class="idref" href="#t<sub>1</sub>:178"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:179" class="idref" href="#t<sub>2</sub>:179"><span class="id" title="binder">t<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#safe:162"><span class="id" title="inductive">safe</span></a> <a class="idref" href="Partial.html#s:176"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:178"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="v<sub>1</sub>:180" class="idref" href="#v<sub>1</sub>:180"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="s<sub>2</sub>:181" class="idref" href="#s<sub>2</sub>:181"><span class="id" title="binder">s<sub>2</sub></span></a>, <a class="idref" href="Nondet.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Partial.html#s:176"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:178"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#s<sub>2</sub>:181"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:180"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Partial.html#safe:162"><span class="id" title="inductive">safe</span></a> <a class="idref" href="Partial.html#s<sub>2</sub>:181"><span class="id" title="variable">s<sub>2</sub></span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Partial.html#x:177"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:180"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:179"><span class="id" title="variable">t<sub>2</sub></span></a>)<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#safe:162"><span class="id" title="inductive">safe</span></a> <a class="idref" href="Partial.html#s:176"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="Partial.html#x:177"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:178"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:179"><span class="id" title="variable">t<sub>2</sub></span></a>)<br/>
&nbsp;&nbsp;| <a id="safe_if" class="idref" href="#safe_if"><span class="id" title="constructor">safe_if</span></a> : <span class="id" title="keyword">∀</span> <a id="s:182" class="idref" href="#s:182"><span class="id" title="binder">s</span></a> <a id="b:183" class="idref" href="#b:183"><span class="id" title="binder">b</span></a> <a id="t<sub>1</sub>:184" class="idref" href="#t<sub>1</sub>:184"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:185" class="idref" href="#t<sub>2</sub>:185"><span class="id" title="binder">t<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#safe:162"><span class="id" title="inductive">safe</span></a> <a class="idref" href="Partial.html#s:182"><span class="id" title="variable">s</span></a> (<span class="id" title="keyword">if</span> <a class="idref" href="Partial.html#b:183"><span class="id" title="variable">b</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="Partial.html#t<sub>1</sub>:184"><span class="id" title="variable">t<sub>1</sub></span></a> <span class="id" title="keyword">else</span> <a class="idref" href="Partial.html#t<sub>2</sub>:185"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#safe:162"><span class="id" title="inductive">safe</span></a> <a class="idref" href="Partial.html#s:182"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> (<a class="idref" href="LibSepReference.html#val_bool"><span class="id" title="constructor">val_bool</span></a> <a class="idref" href="Partial.html#b:183"><span class="id" title="variable">b</span></a>) <a class="idref" href="Partial.html#t<sub>1</sub>:184"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:185"><span class="id" title="variable">t<sub>2</sub></span></a>)<br/>
&nbsp;&nbsp;| <a id="safe_add" class="idref" href="#safe_add"><span class="id" title="constructor">safe_add</span></a> : <span class="id" title="keyword">∀</span> <a id="s:186" class="idref" href="#s:186"><span class="id" title="binder">s</span></a> <a id="n<sub>1</sub>:187" class="idref" href="#n<sub>1</sub>:187"><span class="id" title="binder">n<sub>1</sub></span></a> <a id="n<sub>2</sub>:188" class="idref" href="#n<sub>2</sub>:188"><span class="id" title="binder">n<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#safe:162"><span class="id" title="inductive">safe</span></a> <a class="idref" href="Partial.html#s:186"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#val_add"><span class="id" title="constructor">val_add</span></a> (<a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Partial.html#n<sub>1</sub>:187"><span class="id" title="variable">n<sub>1</sub></span></a>) (<a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Partial.html#n<sub>2</sub>:188"><span class="id" title="variable">n<sub>2</sub></span></a>))<br/>
&nbsp;&nbsp;| <a id="safe_rand" class="idref" href="#safe_rand"><span class="id" title="constructor">safe_rand</span></a> : <span class="id" title="keyword">∀</span> <a id="s:189" class="idref" href="#s:189"><span class="id" title="binder">s</span></a> <a id="n:190" class="idref" href="#n:190"><span class="id" title="binder">n</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#n:190"><span class="id" title="variable">n</span></a> <span class="id" title="notation">&gt;</span> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#safe:162"><span class="id" title="inductive">safe</span></a> <a class="idref" href="Partial.html#s:189"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#val_rand"><span class="id" title="constructor">val_rand</span></a> (<a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Partial.html#n:190"><span class="id" title="variable">n</span></a>))<br/>
&nbsp;&nbsp;| <a id="safe_ref" class="idref" href="#safe_ref"><span class="id" title="constructor">safe_ref</span></a> : <span class="id" title="keyword">∀</span> <a id="s:191" class="idref" href="#s:191"><span class="id" title="binder">s</span></a> <a id="v:192" class="idref" href="#v:192"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#safe:162"><span class="id" title="inductive">safe</span></a> <a class="idref" href="Partial.html#s:191"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#val_ref"><span class="id" title="constructor">val_ref</span></a> <a class="idref" href="Partial.html#v:192"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;| <a id="safe_get" class="idref" href="#safe_get"><span class="id" title="constructor">safe_get</span></a> : <span class="id" title="keyword">∀</span> <a id="s:193" class="idref" href="#s:193"><span class="id" title="binder">s</span></a> <a id="p:194" class="idref" href="#p:194"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#Fmap.indom"><span class="id" title="definition">Fmap.indom</span></a> <a class="idref" href="Partial.html#s:193"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#p:194"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#safe:162"><span class="id" title="inductive">safe</span></a> <a class="idref" href="Partial.html#s:193"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#val_get"><span class="id" title="constructor">val_get</span></a> (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Partial.html#p:194"><span class="id" title="variable">p</span></a>))<br/>
&nbsp;&nbsp;| <a id="safe_set" class="idref" href="#safe_set"><span class="id" title="constructor">safe_set</span></a> : <span class="id" title="keyword">∀</span> <a id="s:195" class="idref" href="#s:195"><span class="id" title="binder">s</span></a> <a id="p:196" class="idref" href="#p:196"><span class="id" title="binder">p</span></a> <a id="v:197" class="idref" href="#v:197"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#Fmap.indom"><span class="id" title="definition">Fmap.indom</span></a> <a class="idref" href="Partial.html#s:195"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#p:196"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#safe:162"><span class="id" title="inductive">safe</span></a> <a class="idref" href="Partial.html#s:195"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#val_set"><span class="id" title="constructor">val_set</span></a> (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Partial.html#p:196"><span class="id" title="variable">p</span></a>) <a class="idref" href="Partial.html#v:197"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;| <a id="safe_free" class="idref" href="#safe_free"><span class="id" title="constructor">safe_free</span></a> : <span class="id" title="keyword">∀</span> <a id="s:198" class="idref" href="#s:198"><span class="id" title="binder">s</span></a> <a id="p:199" class="idref" href="#p:199"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#Fmap.indom"><span class="id" title="definition">Fmap.indom</span></a> <a class="idref" href="Partial.html#s:198"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#p:199"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#safe:162"><span class="id" title="inductive">safe</span></a> <a class="idref" href="Partial.html#s:198"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#val_free"><span class="id" title="constructor">val_free</span></a> (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Partial.html#p:199"><span class="id" title="variable">p</span></a>)).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Section</span> <a id="EvalnpSafe" class="idref" href="#EvalnpSafe"><span class="id" title="section">EvalnpSafe</span></a>.<br/>
<span class="id" title="keyword">Hint Constructors</span> <a class="idref" href="Partial.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Partial.html#evalnp"><span class="id" title="inductive">evalnp</span></a>.<br/>
</div>

<div class="doc">
<a id="lab486"></a><h4 class="section">Exercise: 5 stars, standard, especially useful (evalnp_iff_safe_and_post)</h4>
 Prove that <span class="inlinecode"><span class="id" title="var">evalnp</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> is equivalent to the conjunction of <span class="inlinecode"><span class="id" title="var">safe</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>
    and to a partial correctness result asserting that if an evaluation of
    <span class="inlinecode"><span class="id" title="var">t</span>/<span class="id" title="var">s</span></span> terminates on a particular result, then this result satisfies <span class="inlinecode"><span class="id" title="var">Q</span></span>.
    Hint: make sure to split the equivalence and the conjunction before
    entering the coinductive proofs. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="evalnp_iff_safe_and_post" class="idref" href="#evalnp_iff_safe_and_post"><span class="id" title="lemma">evalnp_iff_safe_and_post</span></a> : <span class="id" title="keyword">∀</span> <a id="s:200" class="idref" href="#s:200"><span class="id" title="binder">s</span></a> <a id="t:201" class="idref" href="#t:201"><span class="id" title="binder">t</span></a> <a id="Q:202" class="idref" href="#Q:202"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnp"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s:200"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:201"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#Q:202"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Partial.html#safe"><span class="id" title="inductive">safe</span></a> <a class="idref" href="Partial.html#s:200"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:201"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="v:203" class="idref" href="#v:203"><span class="id" title="binder">v</span></a> <a id="s':204" class="idref" href="#s':204"><span class="id" title="binder">s'</span></a>, <a class="idref" href="Nondet.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Partial.html#s:200"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:201"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#s':204"><span class="id" title="variable">s'</span></a> <a class="idref" href="Partial.html#v:203"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Partial.html#Q:202"><span class="id" title="variable">Q</span></a> <a class="idref" href="Partial.html#v:203"><span class="id" title="variable">v</span></a> <a class="idref" href="Partial.html#s':204"><span class="id" title="variable">s'</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 Let <span class="inlinecode"><span class="id" title="var">Any</span></span> denotes the postcondition that accepts any result. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="Any" class="idref" href="#Any"><span class="id" title="definition">Any</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#state"><span class="id" title="definition">state</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="v:205" class="idref" href="#v:205"><span class="id" title="binder">v</span></a> <a id="s:206" class="idref" href="#s:206"><span class="id" title="binder">s</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#True"><span class="id" title="inductive">True</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Hint Unfold</span> <a class="idref" href="Partial.html#Any"><span class="id" title="definition">Any</span></a>.<br/>
</div>

<div class="doc">
<a id="lab487"></a><h4 class="section">Exercise: 2 stars, standard, especially useful (safe_iff_evalnp_any)</h4>
 Prove that <span class="inlinecode"><span class="id" title="var">safe</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> is equivalent to <span class="inlinecode"><span class="id" title="var">evalnp</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Any</span></span>.
    Hint: a direct proof fails---why?
    The solution is to exploit <span class="inlinecode"><span class="id" title="var">evalnp_iff_safe_and_post</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="safe_iff_evalnp_any" class="idref" href="#safe_iff_evalnp_any"><span class="id" title="lemma">safe_iff_evalnp_any</span></a> : <span class="id" title="keyword">∀</span> <a id="s:207" class="idref" href="#s:207"><span class="id" title="binder">s</span></a> <a id="t:208" class="idref" href="#t:208"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#safe"><span class="id" title="inductive">safe</span></a> <a class="idref" href="Partial.html#s:207"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:208"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="Partial.html#evalnp"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s:207"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:208"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#Any"><span class="id" title="definition">Any</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<span class="id" title="keyword">End</span> <a class="idref" href="Partial.html#EvalnpSafe"><span class="id" title="section">EvalnpSafe</span></a>.<br/>
</div>

<div class="doc">
<a id="lab488"></a><h2 class="section">Small-Step Characterization of Partial Correctness</h2>

<div class="paragraph"> </div>

 So far, this chapter has focused on handling partial correctness using
    a big-step semantics. In this bonus section, we investigate the treatment
    of partial correctness using a small-step semantics. 
<div class="paragraph"> </div>

 Before we get started, let us state and prove a basic lemma asserting
    that values cannot take a step. It will useful throughout the section. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="exists_step_val_inv" class="idref" href="#exists_step_val_inv"><span class="id" title="lemma">exists_step_val_inv</span></a> : <span class="id" title="keyword">∀</span> <a id="s:209" class="idref" href="#s:209"><span class="id" title="binder">s</span></a> <a id="v:210" class="idref" href="#v:210"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="notation">∃</span> <a id="s':211" class="idref" href="#s':211"><span class="id" title="binder">s'</span></a> <a id="t':212" class="idref" href="#t':212"><span class="id" title="binder">t'</span></a><span class="id" title="notation">,</span> <a class="idref" href="Nondet.html#step"><span class="id" title="inductive">step</span></a> <a class="idref" href="Partial.html#s:209"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#v:210"><span class="id" title="variable">v</span></a> <a class="idref" href="Partial.html#s':211"><span class="id" title="variable">s'</span></a> <a class="idref" href="Partial.html#t':212"><span class="id" title="variable">t'</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> (<span class="id" title="var">s'</span>&amp;<span class="id" title="var">t'</span>&amp;<span class="id" title="var">S</span>). <span class="id" title="var">inverts</span> <span class="id" title="var">S</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
In the chapter <a href="Nondet.html"><span class="inlineref">Nondet</span></a>, we presented a definition named
    <span class="inlinecode"><span class="id" title="var">evals_attempt_3</span></span> that defined a small-step characterization of partial
    correctness. Let us rename this definition to <span class="inlinecode"><span class="id" title="var">evalnps</span></span>.

<div class="paragraph"> </div>

    The judgment <span class="inlinecode"><span class="id" title="var">evalnps</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> asserts that, for any configuration
    <span class="inlinecode">(<span class="id" title="var">s'</span>,<span class="id" title="var">t'</span>)</span> that can be reached from <span class="inlinecode">(<span class="id" title="var">s'</span>,<span class="id" title="var">t'</span>)</span>, either <span class="inlinecode"><span class="id" title="var">t'</span></span> is a value that,
    together with <span class="inlinecode"><span class="id" title="var">s'</span></span>, satisfy the postcondition <span class="inlinecode"><span class="id" title="var">Q</span></span>; or the configuration
    <span class="inlinecode">(<span class="id" title="var">s'</span>,<span class="id" title="var">t'</span>)</span> can take a step, that is, it is not a stuck configuration. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="evalnps" class="idref" href="#evalnps"><span class="id" title="definition">evalnps</span></a> (<a id="s:213" class="idref" href="#s:213"><span class="id" title="binder">s</span></a>:<a class="idref" href="LibSepReference.html#state"><span class="id" title="definition">state</span></a>) (<a id="t:214" class="idref" href="#t:214"><span class="id" title="binder">t</span></a>:<a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>) (<a id="Q:215" class="idref" href="#Q:215"><span class="id" title="binder">Q</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#state"><span class="id" title="definition">state</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><span class="id" title="keyword">Prop</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s':216" class="idref" href="#s':216"><span class="id" title="binder">s'</span></a> <a id="t':217" class="idref" href="#t':217"><span class="id" title="binder">t'</span></a>, <a class="idref" href="Nondet.html#evals"><span class="id" title="inductive">evals</span></a> <a class="idref" href="Partial.html#s:213"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:214"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#s':216"><span class="id" title="variable">s'</span></a> <a class="idref" href="Partial.html#t':217"><span class="id" title="variable">t'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e<sub>25</sub>"><span class="id" title="notation">(</span></a><span class="id" title="notation">∃</span> <a id="v:218" class="idref" href="#v:218"><span class="id" title="binder">v</span></a><span class="id" title="notation">,</span> <a class="idref" href="Partial.html#t':217"><span class="id" title="variable">t'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <a class="idref" href="Partial.html#v:218"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Partial.html#Q:215"><span class="id" title="variable">Q</span></a> <a class="idref" href="Partial.html#v:218"><span class="id" title="variable">v</span></a> <a class="idref" href="Partial.html#s':216"><span class="id" title="variable">s'</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e<sub>25</sub>"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e<sub>25</sub>"><span class="id" title="notation">∨</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e<sub>25</sub>"><span class="id" title="notation">(</span></a><span class="id" title="notation">∃</span> <a id="s'':219" class="idref" href="#s'':219"><span class="id" title="binder">s''</span></a> <a id="t'':220" class="idref" href="#t'':220"><span class="id" title="binder">t''</span></a><span class="id" title="notation">,</span> <a class="idref" href="Nondet.html#step"><span class="id" title="inductive">step</span></a> <a class="idref" href="Partial.html#s':216"><span class="id" title="variable">s'</span></a> <a class="idref" href="Partial.html#t':217"><span class="id" title="variable">t'</span></a> <a class="idref" href="Partial.html#s'':219"><span class="id" title="variable">s''</span></a> <a class="idref" href="Partial.html#t'':220"><span class="id" title="variable">t''</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e<sub>25</sub>"><span class="id" title="notation">)</span></a>.<br/>
</div>

<div class="doc">
On top of <span class="inlinecode"><span class="id" title="var">evalnps</span></span>, we define a partial correctness Hoare triple
    judgment <span class="inlinecode"><span class="id" title="var">hoarenps</span></span> in the usual way. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="hoarenps" class="idref" href="#hoarenps"><span class="id" title="definition">hoarenps</span></a> (<a id="t:221" class="idref" href="#t:221"><span class="id" title="binder">t</span></a>:<a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>) (<a id="H:222" class="idref" href="#H:222"><span class="id" title="binder">H</span></a>:<a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) (<a id="Q:223" class="idref" href="#Q:223"><span class="id" title="binder">Q</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s:224" class="idref" href="#s:224"><span class="id" title="binder">s</span></a>, <a class="idref" href="Partial.html#H:222"><span class="id" title="variable">H</span></a> <a class="idref" href="Partial.html#s:224"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Partial.html#evalnps"><span class="id" title="definition">evalnps</span></a> <a class="idref" href="Partial.html#s:224"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:221"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#Q:223"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
The property <span class="inlinecode"><span class="id" title="var">evalnps</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> may be viewed as a form of typing:
    the configuration <span class="inlinecode">(<span class="id" title="var">s</span>,<span class="id" title="var">t</span>)</span> admits the "type" <span class="inlinecode"><span class="id" title="var">Q</span></span>.

<div class="paragraph"> </div>

<ul class="doclist">
<li> Base case: if <span class="inlinecode"><span class="id" title="var">t</span></span> is a value, we assert that a configuration <span class="inlinecode">(<span class="id" title="var">s</span>,<span class="id" title="var">v</span>)</span> has
      type <span class="inlinecode"><span class="id" title="var">Q</span></span> iff <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> holds.

<div class="paragraph"> </div>


</li>
<li> Preservation property: if the configuration <span class="inlinecode">(<span class="id" title="var">s</span>,<span class="id" title="var">t</span>)</span> has type <span class="inlinecode"><span class="id" title="var">Q</span></span> and
      reduces to <span class="inlinecode">(<span class="id" title="var">s'</span>,<span class="id" title="var">t'</span>)</span>, then the configuration <span class="inlinecode">(<span class="id" title="var">s'</span>,<span class="id" title="var">t'</span>)</span> also admits the
      same type <span class="inlinecode"><span class="id" title="var">Q</span></span>.

<div class="paragraph"> </div>


</li>
<li> Progress property: if the configuration <span class="inlinecode">(<span class="id" title="var">s</span>,<span class="id" title="var">t</span>)</span> has type <span class="inlinecode"><span class="id" title="var">Q</span></span>, then
      either <span class="inlinecode"><span class="id" title="var">t</span></span> is of the form <span class="inlinecode"><span class="id" title="var">trm_val</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> and <span class="inlinecode">(<span class="id" title="var">s</span>,<span class="id" title="var">v</span>)</span> admits type <span class="inlinecode"><span class="id" title="var">Q</span></span>,
      or the configuration <span class="inlinecode">(<span class="id" title="var">s</span>,<span class="id" title="var">t</span>)</span> can take a reduction step to some
      configuration <span class="inlinecode">(<span class="id" title="var">s'</span>,<span class="id" title="var">t'</span>)</span>.

</li>
</ul>

<div class="paragraph"> </div>

    The progress property is, in essence, a partial correctness
    property. Indeed, it ensures that programs never get stuck, yet without
    imposing termination.

<div class="paragraph"> </div>

    In what follows, we formally state and prove the three properties
    associated with the judgment <span class="inlinecode"><span class="id" title="var">evalnps</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>: the characterization of the
    base case, the preservation property, and the progress property. 
<div class="paragraph"> </div>

 First, let's prove an introduction lemma and an inversion lemma for the
    base case, that is, the characteriation of values. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="evalnps_val" class="idref" href="#evalnps_val"><span class="id" title="lemma">evalnps_val</span></a> : <span class="id" title="keyword">∀</span> <a id="s:225" class="idref" href="#s:225"><span class="id" title="binder">s</span></a> <a id="v:226" class="idref" href="#v:226"><span class="id" title="binder">v</span></a> <a id="Q:227" class="idref" href="#Q:227"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#Q:227"><span class="id" title="variable">Q</span></a> <a class="idref" href="Partial.html#v:226"><span class="id" title="variable">v</span></a> <a class="idref" href="Partial.html#s:225"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnps"><span class="id" title="definition">evalnps</span></a> <a class="idref" href="Partial.html#s:225"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#v:226"><span class="id" title="variable">v</span></a> <a class="idref" href="Partial.html#Q:227"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span> <span class="id" title="var">R</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">R</span> <span class="id" title="keyword">as</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">left</span>*. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">R<sub>1</sub></span> <span class="id" title="var">R<sub>2</sub></span>. <span class="id" title="var">false</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">R<sub>1</sub></span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="evalnps_val_inv" class="idref" href="#evalnps_val_inv"><span class="id" title="lemma">evalnps_val_inv</span></a> : <span class="id" title="keyword">∀</span> <a id="s:228" class="idref" href="#s:228"><span class="id" title="binder">s</span></a> <a id="v:229" class="idref" href="#v:229"><span class="id" title="binder">v</span></a> <a id="Q:230" class="idref" href="#Q:230"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnps"><span class="id" title="definition">evalnps</span></a> <a class="idref" href="Partial.html#s:228"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#v:229"><span class="id" title="variable">v</span></a> <a class="idref" href="Partial.html#Q:230"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#Q:230"><span class="id" title="variable">Q</span></a> <a class="idref" href="Partial.html#v:229"><span class="id" title="variable">v</span></a> <a class="idref" href="Partial.html#s:228"><span class="id" title="variable">s</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">forwards</span> <span class="id" title="var">N</span>: <span class="id" title="var">M</span> <span class="id" title="var">s</span> <span class="id" title="var">v</span>. { <span class="id" title="var">applys</span> <a class="idref" href="Nondet.html#evals_refl"><span class="id" title="constructor">evals_refl</span></a>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">N</span> <span class="id" title="keyword">as</span> [(<span class="id" title="var">v<sub>1</sub></span>&amp;<span class="id" title="var">E<sub>1</sub></span>&amp;<span class="id" title="var">P<sub>1</sub></span>)|(<span class="id" title="var">s<sub>2</sub></span>&amp;<span class="id" title="var">t<sub>2</sub></span>&amp;<span class="id" title="var">R</span>)].<br/>
&nbsp;&nbsp;{ <span class="id" title="var">inverts</span>* <span class="id" title="var">E<sub>1</sub></span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">inverts</span> <span class="id" title="var">R</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Second, let's prove the preservation property. 
<div class="paragraph"> </div>

<a id="lab489"></a><h4 class="section">Exercise: 3 stars, standard, especially useful (evalnps_inv_step)</h4>
 Prove that the property <span class="inlinecode"><span class="id" title="var">evalnps</span></span> for a given postcondition <span class="inlinecode"><span class="id" title="var">Q</span></span> is
    preserved when a program takes a reduction step. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="evalnps_inv_step" class="idref" href="#evalnps_inv_step"><span class="id" title="lemma">evalnps_inv_step</span></a> : <span class="id" title="keyword">∀</span> <a id="s<sub>1</sub>:231" class="idref" href="#s<sub>1</sub>:231"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="t<sub>1</sub>:232" class="idref" href="#t<sub>1</sub>:232"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="s<sub>2</sub>:233" class="idref" href="#s<sub>2</sub>:233"><span class="id" title="binder">s<sub>2</sub></span></a> <a id="t<sub>2</sub>:234" class="idref" href="#t<sub>2</sub>:234"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="Q:235" class="idref" href="#Q:235"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnps"><span class="id" title="definition">evalnps</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:231"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:232"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#Q:235"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Nondet.html#step"><span class="id" title="inductive">step</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:231"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:232"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#s<sub>2</sub>:233"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:234"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnps"><span class="id" title="definition">evalnps</span></a> <a class="idref" href="Partial.html#s<sub>2</sub>:233"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:234"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="Partial.html#Q:235"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 Third, let's prove the progress property. 
<div class="paragraph"> </div>

<a id="lab490"></a><h4 class="section">Exercise: 4 stars, standard, especially useful (evalnps_not_val_inv)</h4>
 Prove that if the property <span class="inlinecode"><span class="id" title="var">evalnps</span></span> holds for a given postcondition <span class="inlinecode"><span class="id" title="var">Q</span></span>,
    and for a configuration that has not already reached a value, then this
    configuration can take a step. Moreover, the configuration reached also
    satisfies the property <span class="inlinecode"><span class="id" title="var">evalnps</span></span> for that same <span class="inlinecode"><span class="id" title="var">Q</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="evalnps_not_val_inv" class="idref" href="#evalnps_not_val_inv"><span class="id" title="lemma">evalnps_not_val_inv</span></a> : <span class="id" title="keyword">∀</span> <a id="s<sub>1</sub>:236" class="idref" href="#s<sub>1</sub>:236"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="t<sub>1</sub>:237" class="idref" href="#t<sub>1</sub>:237"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="Q:238" class="idref" href="#Q:238"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnps"><span class="id" title="definition">evalnps</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:236"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:237"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#Q:238"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="v:239" class="idref" href="#v:239"><span class="id" title="binder">v</span></a>, <a class="idref" href="Partial.html#t<sub>1</sub>:237"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <a class="idref" href="Partial.html#v:239"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">∃</span> <a id="s<sub>2</sub>:240" class="idref" href="#s<sub>2</sub>:240"><span class="id" title="binder">s<sub>2</sub></span></a> <a id="t<sub>2</sub>:241" class="idref" href="#t<sub>2</sub>:241"><span class="id" title="binder">t<sub>2</sub></span></a><span class="id" title="notation">,</span> <a class="idref" href="Nondet.html#step"><span class="id" title="inductive">step</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:236"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:237"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#s<sub>2</sub>:240"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:241"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Partial.html#evalnps"><span class="id" title="definition">evalnps</span></a> <a class="idref" href="Partial.html#s<sub>2</sub>:240"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:241"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="Partial.html#Q:238"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab491"></a><h2 class="section">Reasoning Rules w.r.t. Small-Step Characterization</h2>

<div class="paragraph"> </div>

 We present two proofs of reasoning rules established with respect to the
    judgment <span class="inlinecode"><span class="id" title="var">hoarenps</span></span>. The first proof targets the rule of consequence. This
    result leverages the covariance property for <span class="inlinecode"><span class="id" title="var">evalnps</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="evalnps_conseq" class="idref" href="#evalnps_conseq"><span class="id" title="lemma">evalnps_conseq</span></a> : <span class="id" title="keyword">∀</span> <a id="s:242" class="idref" href="#s:242"><span class="id" title="binder">s</span></a> <a id="t:243" class="idref" href="#t:243"><span class="id" title="binder">t</span></a> <a id="Q:244" class="idref" href="#Q:244"><span class="id" title="binder">Q</span></a> <a id="Q':245" class="idref" href="#Q':245"><span class="id" title="binder">Q'</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnps"><span class="id" title="definition">evalnps</span></a> <a class="idref" href="Partial.html#s:242"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:243"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#Q':245"><span class="id" title="variable">Q'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#Q':245"><span class="id" title="variable">Q'</span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Partial.html#Q:244"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnps"><span class="id" title="definition">evalnps</span></a> <a class="idref" href="Partial.html#s:242"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:243"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#Q:244"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span> <span class="id" title="var">WQ</span>. <span class="id" title="var">introv</span> <span class="id" title="var">R</span>. <span class="id" title="var">lets</span> [(<span class="id" title="var">v</span>&amp;<span class="id" title="var">E</span>&amp;<span class="id" title="var">P</span>)|<span class="id" title="var">N</span>]: <span class="id" title="var">M</span> <span class="id" title="var">R</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">left</span>. <span class="id" title="tactic">∃</span> <span class="id" title="var">v</span>. <span class="id" title="tactic">split</span>¬. <span class="id" title="var">applys</span>* <span class="id" title="var">WQ</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">right</span>*. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="hoarenps_conseq" class="idref" href="#hoarenps_conseq"><span class="id" title="lemma">hoarenps_conseq</span></a> : <span class="id" title="keyword">∀</span> <a id="t:246" class="idref" href="#t:246"><span class="id" title="binder">t</span></a> <a id="H':247" class="idref" href="#H':247"><span class="id" title="binder">H'</span></a> <a id="Q':248" class="idref" href="#Q':248"><span class="id" title="binder">Q'</span></a> <a id="H:249" class="idref" href="#H:249"><span class="id" title="binder">H</span></a> <a id="Q:250" class="idref" href="#Q:250"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenps"><span class="id" title="definition">hoarenps</span></a> <a class="idref" href="Partial.html#t:246"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#H':247"><span class="id" title="variable">H'</span></a> <a class="idref" href="Partial.html#Q':248"><span class="id" title="variable">Q'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#H:249"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Partial.html#H':247"><span class="id" title="variable">H'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#Q':248"><span class="id" title="variable">Q'</span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Partial.html#Q:250"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenps"><span class="id" title="definition">hoarenps</span></a> <a class="idref" href="Partial.html#t:246"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#H:249"><span class="id" title="variable">H</span></a> <a class="idref" href="Partial.html#Q:250"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span> <span class="id" title="var">WH</span> <span class="id" title="var">WQ</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span> <a class="idref" href="Partial.html#evalnps_conseq"><span class="id" title="lemma">evalnps_conseq</span></a> <span class="id" title="var">WQ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <span class="id" title="var">WH</span> <span class="id" title="var">K</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The second proof targets the reasoning rule for let-bindings, stated
    for the judgment <span class="inlinecode"><span class="id" title="var">hoarenps</span></span>. This result leverages as key intermediate
    lemma an introduction rule for let-bindings with respect to <span class="inlinecode"><span class="id" title="var">evalnps</span></span>. 
<div class="paragraph"> </div>

<a id="lab492"></a><h4 class="section">Exercise: 5 stars, standard, especially useful (evalnps_let)</h4>
 Prove the reasoning rule for let-bindings for <span class="inlinecode"><span class="id" title="var">evalnps</span></span>.
    Hint: in the proof, you can use <span class="inlinecode"><span class="id" title="var">tests</span></span> <span class="inlinecode"><span class="id" title="var">C</span>:</span> <span class="inlinecode">(<span class="id" title="tactic">∃</span></span> <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span>,</span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">trm_val</span></span> <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span>)</span>
    to make a case analysis on whether <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> is a value or not. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="evalnps_let" class="idref" href="#evalnps_let"><span class="id" title="lemma">evalnps_let</span></a> : <span class="id" title="keyword">∀</span> <a id="s:251" class="idref" href="#s:251"><span class="id" title="binder">s</span></a> <a id="x:252" class="idref" href="#x:252"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:253" class="idref" href="#t<sub>1</sub>:253"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:254" class="idref" href="#t<sub>2</sub>:254"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="Q<sub>1</sub>:255" class="idref" href="#Q<sub>1</sub>:255"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q:256" class="idref" href="#Q:256"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnps"><span class="id" title="definition">evalnps</span></a> <a class="idref" href="Partial.html#s:251"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:253"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#Q<sub>1</sub>:255"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="s<sub>1</sub>:257" class="idref" href="#s<sub>1</sub>:257"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="v<sub>1</sub>:258" class="idref" href="#v<sub>1</sub>:258"><span class="id" title="binder">v<sub>1</sub></span></a>, <a class="idref" href="Partial.html#Q<sub>1</sub>:255"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:258"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:257"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Partial.html#evalnps"><span class="id" title="definition">evalnps</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:257"><span class="id" title="variable">s<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Partial.html#x:252"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:258"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:254"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Partial.html#Q:256"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnps"><span class="id" title="definition">evalnps</span></a> <a class="idref" href="Partial.html#s:251"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="Partial.html#x:252"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:253"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:254"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Partial.html#Q:256"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="hoarenps_let" class="idref" href="#hoarenps_let"><span class="id" title="lemma">hoarenps_let</span></a> : <span class="id" title="keyword">∀</span> <a id="x:259" class="idref" href="#x:259"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:260" class="idref" href="#t<sub>1</sub>:260"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:261" class="idref" href="#t<sub>2</sub>:261"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="H:262" class="idref" href="#H:262"><span class="id" title="binder">H</span></a> <a id="Q:263" class="idref" href="#Q:263"><span class="id" title="binder">Q</span></a> <a id="Q<sub>1</sub>:264" class="idref" href="#Q<sub>1</sub>:264"><span class="id" title="binder">Q<sub>1</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenps"><span class="id" title="definition">hoarenps</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:260"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#H:262"><span class="id" title="variable">H</span></a> <a class="idref" href="Partial.html#Q<sub>1</sub>:264"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="v<sub>1</sub>:265" class="idref" href="#v<sub>1</sub>:265"><span class="id" title="binder">v<sub>1</sub></span></a>, <a class="idref" href="Partial.html#hoarenps"><span class="id" title="definition">hoarenps</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Partial.html#x:259"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:265"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:261"><span class="id" title="variable">t<sub>2</sub></span></a>) (<a class="idref" href="Partial.html#Q<sub>1</sub>:264"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:265"><span class="id" title="variable">v<sub>1</sub></span></a>) <a class="idref" href="Partial.html#Q:263"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenps"><span class="id" title="definition">hoarenps</span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="Partial.html#x:259"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:260"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:261"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Partial.html#H:262"><span class="id" title="variable">H</span></a> <a class="idref" href="Partial.html#Q:263"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnps_let"><span class="id" title="axiom">evalnps_let</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">K'</span>. <span class="id" title="var">applys</span>* <span class="id" title="var">M<sub>2</sub></span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab493"></a><h2 class="section">Small-Step Characterization of Divergence</h2>

<div class="paragraph"> </div>

 Recall the definition of <span class="inlinecode"><span class="id" title="var">evalnps</span></span>.

<div class="paragraph"> </div>

<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">evalnps</span> (<span class="id" title="var">s</span>:<span class="id" title="var">state</span>) (<span class="id" title="var">t</span>:<span class="id" title="var">trm</span>) (<span class="id" title="var">Q</span>:<span class="id" title="var">val</span>→<span class="id" title="var">state</span>→<span class="id" title="keyword">Prop</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">s'</span> <span class="id" title="var">t'</span>, <span class="id" title="var">evals</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span> <span class="id" title="var">s'</span> <span class="id" title="var">t'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">∃</span> <span class="id" title="var">v</span>, <span class="id" title="var">t'</span> = <span class="id" title="var">trm_val</span> <span class="id" title="var">v</span> ∧ <span class="id" title="var">Q</span> <span class="id" title="var">v</span> <span class="id" title="var">s'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∨ (<span class="id" title="tactic">∃</span> <span class="id" title="var">s''</span> <span class="id" title="var">t''</span>, <span class="id" title="var">step</span> <span class="id" title="var">s'</span> <span class="id" title="var">t'</span> <span class="id" title="var">s''</span> <span class="id" title="var">t''</span>).
</span>
<div class="paragraph"> </div>

    The judgment <span class="inlinecode"><span class="id" title="var">evalnps</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> can be specialized with the empty post-
    condition <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">Empty</span></span> to express divergence, just like we did earlier on
    for setting up the definition of <span class="inlinecode"><span class="id" title="var">divn</span></span>.

<div class="paragraph"> </div>

    Recall that <span class="inlinecode"><span class="id" title="var">Empty</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> is equivalent to <span class="inlinecode"><span class="id" title="var">False</span></span>. Thus, let's take the
    definition of <span class="inlinecode"><span class="id" title="var">evalnps</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> and replace <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">s'</span></span> with <span class="inlinecode"><span class="id" title="var">False</span></span>. The
    first clause of the disjunction, <span class="inlinecode"><span class="id" title="tactic">∃</span></span> <span class="inlinecode"><span class="id" title="var">v</span>,</span> <span class="inlinecode"><span class="id" title="var">t'</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">trm_val</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode">∧</span> <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">s'</span></span>
    is never satisfiable and thus may be removed. What remains is a simpler,
    direct characterization of the property that "all executions diverge".

<div class="paragraph"> </div>

    The corresponding predicate, named <span class="inlinecode"><span class="id" title="var">divns</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> below, asserts that any
    execution prefix can be extended by at least one step. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="divns" class="idref" href="#divns"><span class="id" title="definition">divns</span></a> (<a id="s:266" class="idref" href="#s:266"><span class="id" title="binder">s</span></a>:<a class="idref" href="LibSepReference.html#state"><span class="id" title="definition">state</span></a>) (<a id="t:267" class="idref" href="#t:267"><span class="id" title="binder">t</span></a>:<a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s':268" class="idref" href="#s':268"><span class="id" title="binder">s'</span></a> <a id="t':269" class="idref" href="#t':269"><span class="id" title="binder">t'</span></a>, <a class="idref" href="Nondet.html#evals"><span class="id" title="inductive">evals</span></a> <a class="idref" href="Partial.html#s:266"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:267"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#s':268"><span class="id" title="variable">s'</span></a> <a class="idref" href="Partial.html#t':269"><span class="id" title="variable">t'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">∃</span> <a id="s'':270" class="idref" href="#s'':270"><span class="id" title="binder">s''</span></a> <a id="t'':271" class="idref" href="#t'':271"><span class="id" title="binder">t''</span></a><span class="id" title="notation">,</span> <a class="idref" href="Nondet.html#step"><span class="id" title="inductive">step</span></a> <a class="idref" href="Partial.html#s':268"><span class="id" title="variable">s'</span></a> <a class="idref" href="Partial.html#t':269"><span class="id" title="variable">t'</span></a> <a class="idref" href="Partial.html#s'':270"><span class="id" title="variable">s''</span></a> <a class="idref" href="Partial.html#t'':271"><span class="id" title="variable">t''</span></a>.<br/>
</div>

<div class="doc">
<a id="lab494"></a><h4 class="section">Exercise: 3 stars, standard, optional (divns_iff_evalnps_Empty)</h4>
 Prove the equivalence between <span class="inlinecode"><span class="id" title="var">divns</span></span> and the specialization
    of <span class="inlinecode"><span class="id" title="var">evalnps</span></span> to <span class="inlinecode"><span class="id" title="var">Empty</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="divns_iff_evalnps_Empty" class="idref" href="#divns_iff_evalnps_Empty"><span class="id" title="lemma">divns_iff_evalnps_Empty</span></a> : <span class="id" title="keyword">∀</span> <a id="s:272" class="idref" href="#s:272"><span class="id" title="binder">s</span></a> <a id="t:273" class="idref" href="#t:273"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#divns"><span class="id" title="definition">divns</span></a> <a class="idref" href="Partial.html#s:272"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:273"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="Partial.html#evalnps"><span class="id" title="definition">evalnps</span></a> <a class="idref" href="Partial.html#s:272"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:273"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#Empty"><span class="id" title="definition">Empty</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 The three exercises that follow can be proved trivially by exploiting
    the equivalence <span class="inlinecode"><span class="id" title="var">divns_iff_evalnps_Empty</span></span> then exploiting the already
    established properties of <span class="inlinecode"><span class="id" title="var">evalnps</span></span>. However, it is interesting to
    know how to carry out proofs directly with respect to the definition
    <span class="inlinecode"><span class="id" title="var">divns</span></span>. 
<div class="paragraph"> </div>

<a id="lab495"></a><h4 class="section">Exercise: 2 stars, standard, optional (divns_inv_step)</h4>
 Prove that if a diverging configuration takes a step, then it reaches a
    configuration that also diverges. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="divns_inv_step" class="idref" href="#divns_inv_step"><span class="id" title="lemma">divns_inv_step</span></a> : <span class="id" title="keyword">∀</span> <a id="s<sub>1</sub>:274" class="idref" href="#s<sub>1</sub>:274"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="t<sub>1</sub>:275" class="idref" href="#t<sub>1</sub>:275"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="s<sub>2</sub>:276" class="idref" href="#s<sub>2</sub>:276"><span class="id" title="binder">s<sub>2</sub></span></a> <a id="t<sub>2</sub>:277" class="idref" href="#t<sub>2</sub>:277"><span class="id" title="binder">t<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#divns"><span class="id" title="definition">divns</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:274"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:275"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Nondet.html#step"><span class="id" title="inductive">step</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:274"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:275"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#s<sub>2</sub>:276"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:277"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#divns"><span class="id" title="definition">divns</span></a> <a class="idref" href="Partial.html#s<sub>2</sub>:276"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:277"><span class="id" title="variable">t<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a id="lab496"></a><h4 class="section">Exercise: 2 stars, standard, optional (divns_val_inv)</h4>
 Prove that the execution of a value does not diverge. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="divns_val_inv" class="idref" href="#divns_val_inv"><span class="id" title="lemma">divns_val_inv</span></a> : <span class="id" title="keyword">∀</span> <a id="s:278" class="idref" href="#s:278"><span class="id" title="binder">s</span></a> <a id="v:279" class="idref" href="#v:279"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">¬</span></a> <a class="idref" href="Partial.html#divns"><span class="id" title="definition">divns</span></a> <a class="idref" href="Partial.html#s:278"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#v:279"><span class="id" title="variable">v</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a id="lab497"></a><h4 class="section">Exercise: 5 stars, standard, optional (divns_let_ctx)</h4>
 Prove the divergence rule for a let-binding covering the case where the
    first subterm diverges, with respect to the definition <span class="inlinecode"><span class="id" title="var">divns</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="divns_let_ctx" class="idref" href="#divns_let_ctx"><span class="id" title="lemma">divns_let_ctx</span></a> : <span class="id" title="keyword">∀</span> <a id="s<sub>1</sub>:280" class="idref" href="#s<sub>1</sub>:280"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="x:281" class="idref" href="#x:281"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:282" class="idref" href="#t<sub>1</sub>:282"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:283" class="idref" href="#t<sub>2</sub>:283"><span class="id" title="binder">t<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#divns"><span class="id" title="definition">divns</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:280"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:282"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#divns"><span class="id" title="definition">divns</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:280"><span class="id" title="variable">s<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="Partial.html#x:281"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:282"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:283"><span class="id" title="variable">t<sub>2</sub></span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab498"></a><h2 class="section">Coinductive, Small-Step Characterization of Partial Correctness</h2>

<div class="paragraph"> </div>

 In the previous section, we characterized partial correctness using the
    judgment <span class="inlinecode"><span class="id" title="var">evalnps</span></span>, which is defined in terms of the transitive closure
    of the small-step relation <span class="inlinecode"><span class="id" title="var">evals</span></span>. In this section, we present an
    alternative definition, based on a coinductive definition.

<div class="paragraph"> </div>

    Concretely, we start from the inductively defined judgment <span class="inlinecode"><span class="id" title="var">evalns</span></span>,
    which characterizes total correctness, and we consider the coinductive
    intrepretation of the same rules. The resulting judgment is written
    <span class="inlinecode"><span class="id" title="var">evalnpz</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>. This coinductive definition, because it allows for
    infinite derivations, covers the case of diverging computations that
    take involve infinitely many reduction steps. 
</div>
<div class="code">

<span class="id" title="keyword">CoInductive</span> <a id="evalnpz" class="idref" href="#evalnpz"><span class="id" title="inductive">evalnpz</span></a> : <a class="idref" href="LibSepReference.html#state"><span class="id" title="definition">state</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>(</span></a><a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a><span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="evalnpz_val" class="idref" href="#evalnpz_val"><span class="id" title="constructor">evalnpz_val</span></a> : <span class="id" title="keyword">∀</span> <a id="s:286" class="idref" href="#s:286"><span class="id" title="binder">s</span></a> <a id="v:287" class="idref" href="#v:287"><span class="id" title="binder">v</span></a> <a id="Q:288" class="idref" href="#Q:288"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#Q:288"><span class="id" title="variable">Q</span></a> <a class="idref" href="Partial.html#v:287"><span class="id" title="variable">v</span></a> <a class="idref" href="Partial.html#s:286"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnpz:284"><span class="id" title="inductive">evalnpz</span></a> <a class="idref" href="Partial.html#s:286"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#v:287"><span class="id" title="variable">v</span></a> <a class="idref" href="Partial.html#Q:288"><span class="id" title="variable">Q</span></a><br/>
&nbsp;&nbsp;| <a id="evalnpz_step" class="idref" href="#evalnpz_step"><span class="id" title="constructor">evalnpz_step</span></a> : <span class="id" title="keyword">∀</span> <a id="s:289" class="idref" href="#s:289"><span class="id" title="binder">s</span></a> <a id="t:290" class="idref" href="#t:290"><span class="id" title="binder">t</span></a> <a id="Q:291" class="idref" href="#Q:291"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="notation">∃</span> <a id="s':292" class="idref" href="#s':292"><span class="id" title="binder">s'</span></a> <a id="t':293" class="idref" href="#t':293"><span class="id" title="binder">t'</span></a><span class="id" title="notation">,</span> <a class="idref" href="Nondet.html#step"><span class="id" title="inductive">step</span></a> <a class="idref" href="Partial.html#s:289"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:290"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#s':292"><span class="id" title="variable">s'</span></a> <a class="idref" href="Partial.html#t':293"><span class="id" title="variable">t'</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="s':294" class="idref" href="#s':294"><span class="id" title="binder">s'</span></a> <a id="t':295" class="idref" href="#t':295"><span class="id" title="binder">t'</span></a>, <a class="idref" href="Nondet.html#step"><span class="id" title="inductive">step</span></a> <a class="idref" href="Partial.html#s:289"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:290"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#s':294"><span class="id" title="variable">s'</span></a> <a class="idref" href="Partial.html#t':295"><span class="id" title="variable">t'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Partial.html#evalnpz:284"><span class="id" title="inductive">evalnpz</span></a> <a class="idref" href="Partial.html#s':294"><span class="id" title="variable">s'</span></a> <a class="idref" href="Partial.html#t':295"><span class="id" title="variable">t'</span></a> <a class="idref" href="Partial.html#Q:291"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnpz:284"><span class="id" title="inductive">evalnpz</span></a> <a class="idref" href="Partial.html#s:289"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:290"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#Q:291"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
We name <span class="inlinecode"><span class="id" title="var">hoarenpz</span></span> the associated Hoare triple definition. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="hoarenpz" class="idref" href="#hoarenpz"><span class="id" title="definition">hoarenpz</span></a> (<a id="t:296" class="idref" href="#t:296"><span class="id" title="binder">t</span></a>:<a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>) (<a id="H:297" class="idref" href="#H:297"><span class="id" title="binder">H</span></a>:<a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) (<a id="Q:298" class="idref" href="#Q:298"><span class="id" title="binder">Q</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s:299" class="idref" href="#s:299"><span class="id" title="binder">s</span></a>, <a class="idref" href="Partial.html#H:297"><span class="id" title="variable">H</span></a> <a class="idref" href="Partial.html#s:299"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Partial.html#evalnpz"><span class="id" title="inductive">evalnpz</span></a> <a class="idref" href="Partial.html#s:299"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:296"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#Q:298"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
Here again, we focus on the proofs of two particular reasoning rules,
    established with respect to <span class="inlinecode"><span class="id" title="var">evalnpz</span></span>. 
<div class="paragraph"> </div>

 Firstly, let's prove the rule of consequence. The key intermediate result is
    to establish the covariance of <span class="inlinecode"><span class="id" title="var">evalnpz</span></span>. Observe that this proof is to
    be conducted by coinduction. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="evalnpz_conseq" class="idref" href="#evalnpz_conseq"><span class="id" title="lemma">evalnpz_conseq</span></a> : <span class="id" title="keyword">∀</span> <a id="s:300" class="idref" href="#s:300"><span class="id" title="binder">s</span></a> <a id="t:301" class="idref" href="#t:301"><span class="id" title="binder">t</span></a> <a id="Q:302" class="idref" href="#Q:302"><span class="id" title="binder">Q</span></a> <a id="Q':303" class="idref" href="#Q':303"><span class="id" title="binder">Q'</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnpz"><span class="id" title="inductive">evalnpz</span></a> <a class="idref" href="Partial.html#s:300"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:301"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#Q':303"><span class="id" title="variable">Q'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#Q':303"><span class="id" title="variable">Q'</span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Partial.html#Q:302"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnpz"><span class="id" title="inductive">evalnpz</span></a> <a class="idref" href="Partial.html#s:300"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:301"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#Q:302"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span> <span class="id" title="var">WQ</span>. <span class="id" title="var">gen</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span> <span class="id" title="var">Q'</span>. <span class="id" title="keyword">cofix</span> <span class="id" title="var">IH</span>; <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Partial.html#evalnpz_val"><span class="id" title="constructor">evalnpz_val</span></a>. <span class="id" title="var">applys</span>* <span class="id" title="var">WQ</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Partial.html#evalnpz_step"><span class="id" title="constructor">evalnpz_step</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">R'</span>. <span class="id" title="var">lets</span> <span class="id" title="var">M'</span>: <span class="id" title="var">H<sub>0</sub></span> <span class="id" title="var">R'</span>. <span class="id" title="var">applys</span> <span class="id" title="var">IH</span> <span class="id" title="var">M'</span> <span class="id" title="var">WQ</span>. } }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="hoarenpz_conseq" class="idref" href="#hoarenpz_conseq"><span class="id" title="lemma">hoarenpz_conseq</span></a> : <span class="id" title="keyword">∀</span> <a id="t:304" class="idref" href="#t:304"><span class="id" title="binder">t</span></a> <a id="H':305" class="idref" href="#H':305"><span class="id" title="binder">H'</span></a> <a id="Q':306" class="idref" href="#Q':306"><span class="id" title="binder">Q'</span></a> <a id="H:307" class="idref" href="#H:307"><span class="id" title="binder">H</span></a> <a id="Q:308" class="idref" href="#Q:308"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenpz"><span class="id" title="definition">hoarenpz</span></a> <a class="idref" href="Partial.html#t:304"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#H':305"><span class="id" title="variable">H'</span></a> <a class="idref" href="Partial.html#Q':306"><span class="id" title="variable">Q'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#H:307"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Partial.html#H':305"><span class="id" title="variable">H'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#Q':306"><span class="id" title="variable">Q'</span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Partial.html#Q:308"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenpz"><span class="id" title="definition">hoarenpz</span></a> <a class="idref" href="Partial.html#t:304"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#H:307"><span class="id" title="variable">H</span></a> <a class="idref" href="Partial.html#Q:308"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span> <span class="id" title="var">WH</span> <span class="id" title="var">WQ</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span> <a class="idref" href="Partial.html#evalnpz_conseq"><span class="id" title="lemma">evalnpz_conseq</span></a> <span class="id" title="var">WQ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <span class="id" title="var">WH</span> <span class="id" title="var">K</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Secondly, we let's prove the reasoning rule for let-bindings. Here again,
    the key intermediate result is to establish a rule for <span class="inlinecode"><span class="id" title="var">evalnpz</span></span>. 
<div class="paragraph"> </div>

<a id="lab499"></a><h4 class="section">Exercise: 5 stars, standard, especially useful (hoarenpz_let)</h4>
 Prove the reasoning rule for let-bindings stated for <span class="inlinecode"><span class="id" title="var">evalnpz</span></span>.
    Hint: to set up the coinductive proof, follow the template that appears
    at the beginning of the proof of <span class="inlinecode"><span class="id" title="var">evalnpz_conseq</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="evalnpz_let" class="idref" href="#evalnpz_let"><span class="id" title="lemma">evalnpz_let</span></a> : <span class="id" title="keyword">∀</span> <a id="s:309" class="idref" href="#s:309"><span class="id" title="binder">s</span></a> <a id="x:310" class="idref" href="#x:310"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:311" class="idref" href="#t<sub>1</sub>:311"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:312" class="idref" href="#t<sub>2</sub>:312"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="Q<sub>1</sub>:313" class="idref" href="#Q<sub>1</sub>:313"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q:314" class="idref" href="#Q:314"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnpz"><span class="id" title="inductive">evalnpz</span></a> <a class="idref" href="Partial.html#s:309"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:311"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#Q<sub>1</sub>:313"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="s<sub>1</sub>:315" class="idref" href="#s<sub>1</sub>:315"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="v<sub>1</sub>:316" class="idref" href="#v<sub>1</sub>:316"><span class="id" title="binder">v<sub>1</sub></span></a>, <a class="idref" href="Partial.html#Q<sub>1</sub>:313"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:316"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:315"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Partial.html#evalnpz"><span class="id" title="inductive">evalnpz</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:315"><span class="id" title="variable">s<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Partial.html#x:310"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:316"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:312"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Partial.html#Q:314"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnpz"><span class="id" title="inductive">evalnpz</span></a> <a class="idref" href="Partial.html#s:309"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="Partial.html#x:310"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:311"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:312"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Partial.html#Q:314"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="hoarenpz_let" class="idref" href="#hoarenpz_let"><span class="id" title="lemma">hoarenpz_let</span></a> : <span class="id" title="keyword">∀</span> <a id="x:317" class="idref" href="#x:317"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:318" class="idref" href="#t<sub>1</sub>:318"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:319" class="idref" href="#t<sub>2</sub>:319"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="H:320" class="idref" href="#H:320"><span class="id" title="binder">H</span></a> <a id="Q:321" class="idref" href="#Q:321"><span class="id" title="binder">Q</span></a> <a id="Q<sub>1</sub>:322" class="idref" href="#Q<sub>1</sub>:322"><span class="id" title="binder">Q<sub>1</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenpz"><span class="id" title="definition">hoarenpz</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:318"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#H:320"><span class="id" title="variable">H</span></a> <a class="idref" href="Partial.html#Q<sub>1</sub>:322"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="v<sub>1</sub>:323" class="idref" href="#v<sub>1</sub>:323"><span class="id" title="binder">v<sub>1</sub></span></a>, <a class="idref" href="Partial.html#hoarenpz"><span class="id" title="definition">hoarenpz</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Partial.html#x:317"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:323"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:319"><span class="id" title="variable">t<sub>2</sub></span></a>) (<a class="idref" href="Partial.html#Q<sub>1</sub>:322"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:323"><span class="id" title="variable">v<sub>1</sub></span></a>) <a class="idref" href="Partial.html#Q:321"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenpz"><span class="id" title="definition">hoarenpz</span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="Partial.html#x:317"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:318"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:319"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Partial.html#H:320"><span class="id" title="variable">H</span></a> <a class="idref" href="Partial.html#Q:321"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnpz_let"><span class="id" title="axiom">evalnpz_let</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">K'</span>. <span class="id" title="var">applys</span>* <span class="id" title="var">M<sub>2</sub></span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
To express diverge, the judgment <span class="inlinecode"><span class="id" title="var">evalnp</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> may be specialized with
    the postcondition <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">Empty</span></span>. Starting from the definition of
    <span class="inlinecode"><span class="id" title="var">evalnpz</span></span>, replacing <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> with <span class="inlinecode"><span class="id" title="var">False</span></span> is equivalent to removing
    the constructor <span class="inlinecode"><span class="id" title="var">evalnpz_val</span></span> altogether. Thus, divergence of a
    configuration <span class="inlinecode">(<span class="id" title="var">s</span>,<span class="id" title="var">t</span>)</span> may be characterized directly by the coinductive
    judgment <span class="inlinecode"><span class="id" title="var">divnz</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> defined below, featuring a single constructor. 
</div>
<div class="code">

<span class="id" title="keyword">CoInductive</span> <a id="divnz" class="idref" href="#divnz"><span class="id" title="inductive">divnz</span></a> : <a class="idref" href="LibSepReference.html#state"><span class="id" title="definition">state</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a id="divnz_step" class="idref" href="#divnz_step"><span class="id" title="constructor">divnz_step</span></a> : <span class="id" title="keyword">∀</span> <a id="s<sub>1</sub>:326" class="idref" href="#s<sub>1</sub>:326"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="t<sub>1</sub>:327" class="idref" href="#t<sub>1</sub>:327"><span class="id" title="binder">t<sub>1</sub></span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="notation">∃</span> <a id="s<sub>2</sub>:328" class="idref" href="#s<sub>2</sub>:328"><span class="id" title="binder">s<sub>2</sub></span></a> <a id="t<sub>2</sub>:329" class="idref" href="#t<sub>2</sub>:329"><span class="id" title="binder">t<sub>2</sub></span></a><span class="id" title="notation">,</span> <a class="idref" href="Nondet.html#step"><span class="id" title="inductive">step</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:326"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:327"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#s<sub>2</sub>:328"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:329"><span class="id" title="variable">t<sub>2</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="s<sub>2</sub>:330" class="idref" href="#s<sub>2</sub>:330"><span class="id" title="binder">s<sub>2</sub></span></a> <a id="t<sub>2</sub>:331" class="idref" href="#t<sub>2</sub>:331"><span class="id" title="binder">t<sub>2</sub></span></a>, <a class="idref" href="Nondet.html#step"><span class="id" title="inductive">step</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:326"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:327"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#s<sub>2</sub>:330"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:331"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Partial.html#divnz:324"><span class="id" title="inductive">divnz</span></a> <a class="idref" href="Partial.html#s<sub>2</sub>:330"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:331"><span class="id" title="variable">t<sub>2</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#divnz:324"><span class="id" title="inductive">divnz</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:326"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:327"><span class="id" title="variable">t<sub>1</sub></span></a>.<br/>
</div>

<div class="doc">
<a id="lab500"></a><h4 class="section">Exercise: 4 stars, standard, optional (divnz_iff_evalnpz_Empty)</h4>
 Prove the equivalence between <span class="inlinecode"><span class="id" title="var">divnz</span></span> and the specialization of the
    judgment <span class="inlinecode"><span class="id" title="var">evalnp</span></span> to <span class="inlinecode"><span class="id" title="var">Empty</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="divnz_iff_evalnpz_Empty" class="idref" href="#divnz_iff_evalnpz_Empty"><span class="id" title="lemma">divnz_iff_evalnpz_Empty</span></a> : <span class="id" title="keyword">∀</span> <a id="s:332" class="idref" href="#s:332"><span class="id" title="binder">s</span></a> <a id="t:333" class="idref" href="#t:333"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#divnz"><span class="id" title="inductive">divnz</span></a> <a class="idref" href="Partial.html#s:332"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:333"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="Partial.html#evalnpz"><span class="id" title="inductive">evalnpz</span></a> <a class="idref" href="Partial.html#s:332"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:333"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#Empty"><span class="id" title="definition">Empty</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab501"></a><h2 class="section">Equivalence Between the Two Small-Step Charact. of Partial Correctness</h2>

<div class="paragraph"> </div>

 This section establishes that <span class="inlinecode"><span class="id" title="var">hoarenpz</span></span> is equivalent to <span class="inlinecode"><span class="id" title="var">hoarenps</span></span>.
    The key result is to prove <span class="inlinecode"><span class="id" title="var">evalnpz</span></span> equivalent to <span class="inlinecode"><span class="id" title="var">evalnps</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="evalnpz_eq_evalnps" class="idref" href="#evalnpz_eq_evalnps"><span class="id" title="lemma">evalnpz_eq_evalnps</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnpz"><span class="id" title="inductive">evalnpz</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Partial.html#evalnps"><span class="id" title="definition">evalnps</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">extens</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span> <span class="id" title="var">Q</span>. <span class="id" title="var">iff</span> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">R</span>. <span class="id" title="var">gen</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">R</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">inverts</span> <span class="id" title="var">M</span> <span class="id" title="keyword">as</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">M<sub>2</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">left</span>*. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">right</span>. <span class="id" title="var">applys</span> <span class="id" title="var">M<sub>1</sub></span>. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rename</span> <span class="id" title="var">H</span> <span class="id" title="var">into</span> <span class="id" title="var">R<sub>1</sub></span>, <span class="id" title="var">R</span> <span class="id" title="var">into</span> <span class="id" title="var">R<sub>2</sub></span>. <span class="id" title="var">inverts</span> <span class="id" title="var">M</span> <span class="id" title="keyword">as</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">M<sub>2</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">false</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">R<sub>1</sub></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <span class="id" title="var">IHR</span>. <span class="id" title="var">applys</span> <span class="id" title="var">M<sub>2</sub></span> <span class="id" title="var">R<sub>1</sub></span>. } } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">gen</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span> <span class="id" title="var">Q</span>. <span class="id" title="keyword">cofix</span> <span class="id" title="var">IH</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tests</span> <span class="id" title="var">C</span>: (<span class="id" title="notation">∃</span> <a id="v:335" class="idref" href="#v:335"><span class="id" title="binder">v</span></a><span class="id" title="notation">,</span> <span class="id" title="var">t</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <a class="idref" href="Partial.html#v:334"><span class="id" title="variable">v</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> <span class="id" title="var">C</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">v</span>&amp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>). <span class="id" title="var">applys</span> <a class="idref" href="Partial.html#evalnpz_val"><span class="id" title="constructor">evalnpz_val</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="Partial.html#evalnps_val_inv"><span class="id" title="lemma">evalnps_val_inv</span></a> <span class="id" title="var">M</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">lets</span> (<span class="id" title="var">s<sub>2</sub></span>&amp;<span class="id" title="var">t<sub>2</sub></span>&amp;<span class="id" title="var">R<sub>2</sub></span>&amp;<span class="id" title="var">RS</span>): <a class="idref" href="Partial.html#evalnps_not_val_inv"><span class="id" title="axiom">evalnps_not_val_inv</span></a> <span class="id" title="var">M</span> <span class="id" title="var">C</span>. <span class="id" title="var">applys</span> <a class="idref" href="Partial.html#evalnpz_step"><span class="id" title="constructor">evalnpz_step</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">∃</span>* <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">t<sub>2</sub></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">s'</span> <span class="id" title="var">t'</span> <span class="id" title="var">R'</span>. <span class="id" title="var">applys</span> <span class="id" title="var">IH</span>. <span class="id" title="var">applys</span> <a class="idref" href="Partial.html#evalnps_inv_step"><span class="id" title="axiom">evalnps_inv_step</span></a> <span class="id" title="var">M</span> <span class="id" title="var">R'</span>. } } }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="hoarenpz_eq_hoarenps" class="idref" href="#hoarenpz_eq_hoarenps"><span class="id" title="lemma">hoarenpz_eq_hoarenps</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenpz"><span class="id" title="definition">hoarenpz</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Partial.html#hoarenps"><span class="id" title="definition">hoarenps</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Partial.html#hoarenps"><span class="id" title="definition">hoarenps</span></a>, <a class="idref" href="Partial.html#hoarenpz"><span class="id" title="definition">hoarenpz</span></a>. <span class="id" title="tactic">rewrite</span>* <a class="idref" href="Partial.html#evalnpz_eq_evalnps"><span class="id" title="lemma">evalnpz_eq_evalnps</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
As a corollary, we can establish the equivalence between the two small-step
    characterization of divergence. Indeed, both characterizations are obtained
    by specializing the postcondition of their underlying evaluation jugment to
    the empty postcondition, namely <span class="inlinecode"><span class="id" title="var">Empty</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="divnz_eq_divns" class="idref" href="#divnz_eq_divns"><span class="id" title="lemma">divnz_eq_divns</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#divnz"><span class="id" title="inductive">divnz</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Partial.html#divns"><span class="id" title="definition">divns</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">extens</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="Partial.html#divns_iff_evalnps_Empty"><span class="id" title="axiom">divns_iff_evalnps_Empty</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="Partial.html#divnz_iff_evalnpz_Empty"><span class="id" title="axiom">divnz_iff_evalnpz_Empty</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span>* <a class="idref" href="Partial.html#evalnpz_eq_evalnps"><span class="id" title="lemma">evalnpz_eq_evalnps</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab502"></a><h2 class="section">Equivalence Between Small-Step and Big-Step Partial Correctness Semantics</h2>

<div class="paragraph"> </div>

 We end this chapter with the proof of equivalence between <span class="inlinecode"><span class="id" title="var">hoarenps</span></span> and
    <span class="inlinecode"><span class="id" title="var">hoarenp</span></span>, establishing a formal relationship between partial correctness
    triples defined with respect to a small-step semantics and those defined
    with respect to a big-step semantics.

<div class="paragraph"> </div>

    The first step of the proof is to formally relate <span class="inlinecode"><span class="id" title="var">evalnpz</span></span> and <span class="inlinecode"><span class="id" title="var">evalnp</span></span>,
    which are both defined coinductively. Then, we can derive the equality
    between <span class="inlinecode"><span class="id" title="var">hoarenpz</span></span> and <span class="inlinecode"><span class="id" title="var">hoarenp</span></span>, and conclude using the equality
    <span class="inlinecode"><span class="id" title="var">hoarenpz_eq_hoarenps</span></span>, which was established earlier on. 
<div class="paragraph"> </div>

 The first direction is from <span class="inlinecode"><span class="id" title="var">evalnpz</span></span> to <span class="inlinecode"><span class="id" title="var">evalnp</span></span>. To establish it, we
    need 3 inversion lemmas for let-bindings. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="evalnpz_let_inv_ctx" class="idref" href="#evalnpz_let_inv_ctx"><span class="id" title="lemma">evalnpz_let_inv_ctx</span></a> : <span class="id" title="keyword">∀</span> <a id="x:336" class="idref" href="#x:336"><span class="id" title="binder">x</span></a> <a id="s<sub>1</sub>:337" class="idref" href="#s<sub>1</sub>:337"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="t<sub>1</sub>:338" class="idref" href="#t<sub>1</sub>:338"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:339" class="idref" href="#t<sub>2</sub>:339"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="Q:340" class="idref" href="#Q:340"><span class="id" title="binder">Q</span></a> <a id="Q<sub>1</sub>:341" class="idref" href="#Q<sub>1</sub>:341"><span class="id" title="binder">Q<sub>1</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnpz"><span class="id" title="inductive">evalnpz</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:337"><span class="id" title="variable">s<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="Partial.html#x:336"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:338"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:339"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Partial.html#Q:340"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">(</span></a><span class="id" title="keyword">fun</span> <a id="v:342" class="idref" href="#v:342"><span class="id" title="binder">v</span></a> <a id="s:343" class="idref" href="#s:343"><span class="id" title="binder">s</span></a> ⇒ <a class="idref" href="Nondet.html#evals"><span class="id" title="inductive">evals</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:337"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:338"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#s:343"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#v:342"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="Partial.html#Q<sub>1</sub>:341"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnpz"><span class="id" title="inductive">evalnpz</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:337"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:338"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#Q<sub>1</sub>:341"><span class="id" title="variable">Q<sub>1</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">cofix</span> <span class="id" title="var">IH</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span> <span class="id" title="var">WQ</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">M</span> <span class="id" title="keyword">as</span> <span class="id" title="var">M<sub>0</sub></span> <span class="id" title="var">M'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">tests</span> <span class="id" title="var">C</span>: (<span class="id" title="notation">∃</span> <a id="v<sub>1</sub>:345" class="idref" href="#v<sub>1</sub>:345"><span class="id" title="binder">v<sub>1</sub></span></a><span class="id" title="notation">,</span> <span class="id" title="var">t<sub>1</sub></span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:344"><span class="id" title="variable">v<sub>1</sub></span></a>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> <span class="id" title="var">C</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">v<sub>1</sub></span>&amp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>). <span class="id" title="var">applys</span> <a class="idref" href="Partial.html#evalnpz_val"><span class="id" title="constructor">evalnpz_val</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">applys</span> <span class="id" title="var">WQ</span>. <span class="id" title="var">applys</span> <a class="idref" href="Nondet.html#evals_refl"><span class="id" title="constructor">evals_refl</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Partial.html#evalnpz_step"><span class="id" title="constructor">evalnpz_step</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> <span class="id" title="var">M<sub>0</sub></span> <span class="id" title="keyword">as</span> (<span class="id" title="var">s'</span>&amp;<span class="id" title="var">t'</span>&amp;<span class="id" title="var">S</span>). <span class="id" title="var">inverts</span> <span class="id" title="var">S</span> <span class="id" title="keyword">as</span>. 2:{ <span class="id" title="var">false</span>* <span class="id" title="var">C</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">S</span>. <span class="id" title="tactic">∃</span>. <span class="id" title="var">applys</span> <span class="id" title="var">S</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">t<sub>1</sub>'</span> <span class="id" title="var">S</span>. <span class="id" title="var">applys</span> <span class="id" title="var">IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <span class="id" title="var">M'</span>. <span class="id" title="var">applys</span> <a class="idref" href="Nondet.html#step_let_ctx"><span class="id" title="constructor">step_let_ctx</span></a> <span class="id" title="var">S</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">v</span> <span class="id" title="var">s</span> <span class="id" title="var">R</span>. <span class="id" title="var">applys</span> <span class="id" title="var">WQ</span>. <span class="id" title="var">applys</span> <a class="idref" href="Nondet.html#evals_step"><span class="id" title="constructor">evals_step</span></a> <span class="id" title="var">S</span> <span class="id" title="var">R</span>. } } }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="evalnpz_let_inv_cont" class="idref" href="#evalnpz_let_inv_cont"><span class="id" title="lemma">evalnpz_let_inv_cont</span></a> : <span class="id" title="keyword">∀</span> <a id="s<sub>1</sub>:346" class="idref" href="#s<sub>1</sub>:346"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="s<sub>2</sub>:347" class="idref" href="#s<sub>2</sub>:347"><span class="id" title="binder">s<sub>2</sub></span></a> <a id="v<sub>1</sub>:348" class="idref" href="#v<sub>1</sub>:348"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="x:349" class="idref" href="#x:349"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:350" class="idref" href="#t<sub>1</sub>:350"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:351" class="idref" href="#t<sub>2</sub>:351"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="Q:352" class="idref" href="#Q:352"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnpz"><span class="id" title="inductive">evalnpz</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:346"><span class="id" title="variable">s<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="Partial.html#x:349"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:350"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:351"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Partial.html#Q:352"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Nondet.html#evals"><span class="id" title="inductive">evals</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:346"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:350"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#s<sub>2</sub>:347"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:348"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnpz"><span class="id" title="inductive">evalnpz</span></a> <a class="idref" href="Partial.html#s<sub>2</sub>:347"><span class="id" title="variable">s<sub>2</sub></span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Partial.html#x:349"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:348"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:351"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Partial.html#Q:352"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span> <span class="id" title="var">R</span>. <span class="id" title="var">gen_eq</span> <span class="id" title="var">t<sub>1</sub>'</span>: (<a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <span class="id" title="var">v<sub>1</sub></span>). <span class="id" title="tactic">induction</span> <span class="id" title="var">R</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">inverts</span> <span class="id" title="var">M</span> <span class="id" title="keyword">as</span> <span class="id" title="var">_</span> <span class="id" title="var">M'</span>. <span class="id" title="var">applys</span> <span class="id" title="var">M'</span>. <span class="id" title="var">applys</span> <a class="idref" href="Nondet.html#step_let"><span class="id" title="constructor">step_let</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rename</span> <span class="id" title="var">H</span> <span class="id" title="var">into</span> <span class="id" title="var">S</span>, <span class="id" title="var">R</span> <span class="id" title="var">into</span> <span class="id" title="var">R'</span>, <span class="id" title="var">t<sub>0</sub></span> <span class="id" title="var">into</span> <span class="id" title="var">t<sub>1</sub>'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inverts</span> <span class="id" title="var">M</span> <span class="id" title="keyword">as</span> <span class="id" title="var">_</span> <span class="id" title="var">M'</span>. <span class="id" title="var">applys</span>* <span class="id" title="var">IHR</span>. <span class="id" title="var">applys</span> <span class="id" title="var">M'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="Nondet.html#step_let_ctx"><span class="id" title="constructor">step_let_ctx</span></a> <span class="id" title="var">S</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="evalnpz_let_inv" class="idref" href="#evalnpz_let_inv"><span class="id" title="lemma">evalnpz_let_inv</span></a> : <span class="id" title="keyword">∀</span> <a id="s<sub>1</sub>:353" class="idref" href="#s<sub>1</sub>:353"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="x:354" class="idref" href="#x:354"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:355" class="idref" href="#t<sub>1</sub>:355"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:356" class="idref" href="#t<sub>2</sub>:356"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="Q:357" class="idref" href="#Q:357"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnpz"><span class="id" title="inductive">evalnpz</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:353"><span class="id" title="variable">s<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="Partial.html#x:354"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:355"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:356"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Partial.html#Q:357"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">∃</span> <a id="Q<sub>1</sub>:358" class="idref" href="#Q<sub>1</sub>:358"><span class="id" title="binder">Q<sub>1</sub></span></a><span class="id" title="notation">,</span> <a class="idref" href="Partial.html#evalnpz"><span class="id" title="inductive">evalnpz</span></a> <a class="idref" href="Partial.html#s<sub>1</sub>:353"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>1</sub>:355"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Partial.html#Q<sub>1</sub>:358"><span class="id" title="variable">Q<sub>1</sub></span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="v<sub>1</sub>:359" class="idref" href="#v<sub>1</sub>:359"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="s<sub>2</sub>:360" class="idref" href="#s<sub>2</sub>:360"><span class="id" title="binder">s<sub>2</sub></span></a>, <a class="idref" href="Partial.html#Q<sub>1</sub>:358"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:359"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Partial.html#s<sub>2</sub>:360"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Partial.html#evalnpz"><span class="id" title="inductive">evalnpz</span></a> <a class="idref" href="Partial.html#s<sub>2</sub>:360"><span class="id" title="variable">s<sub>2</sub></span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Partial.html#x:354"><span class="id" title="variable">x</span></a> <a class="idref" href="Partial.html#v<sub>1</sub>:359"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Partial.html#t<sub>2</sub>:356"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Partial.html#Q:357"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">∃</span> (<span class="id" title="keyword">fun</span> <a id="v:363" class="idref" href="#v:363"><span class="id" title="binder">v</span></a> <a id="s:364" class="idref" href="#s:364"><span class="id" title="binder">s</span></a> ⇒ <a class="idref" href="Nondet.html#evals"><span class="id" title="inductive">evals</span></a> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">t<sub>1</sub></span> <a class="idref" href="Partial.html#s:362"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <a class="idref" href="Partial.html#v:361"><span class="id" title="variable">v</span></a>)). <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnpz_let_inv_ctx"><span class="id" title="lemma">evalnpz_let_inv_ctx</span></a> <span class="id" title="var">M</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnpz_let_inv_cont"><span class="id" title="lemma">evalnpz_let_inv_cont</span></a> <span class="id" title="var">M</span> <span class="id" title="var">K</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Using these inversion lemmas, we can prove by induction the first
    direction, from <span class="inlinecode"><span class="id" title="var">evalnpz</span></span> to <span class="inlinecode"><span class="id" title="var">evalnp</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="evalnp_of_evalnpz" class="idref" href="#evalnp_of_evalnpz"><span class="id" title="lemma">evalnp_of_evalnpz</span></a> : <span class="id" title="keyword">∀</span> <a id="s:365" class="idref" href="#s:365"><span class="id" title="binder">s</span></a> <a id="t:366" class="idref" href="#t:366"><span class="id" title="binder">t</span></a> <a id="Q:367" class="idref" href="#Q:367"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnpz"><span class="id" title="inductive">evalnpz</span></a> <a class="idref" href="Partial.html#s:365"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:366"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#Q:367"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnp"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s:365"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:366"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#Q:367"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">cofix</span> <span class="id" title="var">IH</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">t</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [ <span class="id" title="var">inverts</span> <span class="id" title="var">M</span>; <span class="id" title="var">false_invert</span> ].<br/>
&nbsp;&nbsp;{ <span class="id" title="var">inverts</span> <span class="id" title="var">M</span> <span class="id" title="keyword">as</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">R</span>. <span class="id" title="var">applys</span> <a class="idref" href="Partial.html#evalnp_val"><span class="id" title="constructor">evalnp_val</span></a> <span class="id" title="var">R</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> (<span class="id" title="var">s'</span>&amp;<span class="id" title="var">t'</span>&amp;<span class="id" title="var">S</span>) <span class="id" title="var">_</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">S</span>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">inverts</span> <span class="id" title="var">M</span> <span class="id" title="keyword">as</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> (<span class="id" title="var">s'</span>&amp;<span class="id" title="var">t'</span>&amp;<span class="id" title="var">S</span>) <span class="id" title="var">_</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">S</span>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">inverts</span> <span class="id" title="var">M</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">s'</span>&amp;<span class="id" title="var">t'</span>&amp;<span class="id" title="var">S</span>) <span class="id" title="var">M'</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">S</span>. } <span class="comment">(*&nbsp;not&nbsp;included&nbsp;in&nbsp;semantics&nbsp;*)</span><br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rename</span> <span class="id" title="var">v</span> <span class="id" title="var">into</span> <span class="id" title="var">f</span>, <span class="id" title="var">v<sub>0</sub></span> <span class="id" title="var">into</span> <span class="id" title="var">x</span>, <span class="id" title="var">t</span> <span class="id" title="var">into</span> <span class="id" title="var">t<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inverts</span> <span class="id" title="var">M</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">s'</span>&amp;<span class="id" title="var">t'</span>&amp;<span class="id" title="var">S</span>) <span class="id" title="var">M<sub>1</sub></span>. <span class="id" title="var">inverts</span> <span class="id" title="var">S</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="Partial.html#evalnp_fix"><span class="id" title="constructor">evalnp_fix</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">forwards</span> <span class="id" title="var">M<sub>1</sub>'</span>: <span class="id" title="var">M<sub>1</sub></span>. { <span class="id" title="var">applys</span> <a class="idref" href="Nondet.html#step_fix"><span class="id" title="constructor">step_fix</span></a>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inverts</span> <span class="id" title="var">M<sub>1</sub>'</span> <span class="id" title="keyword">as</span>. { <span class="id" title="tactic">auto</span>. } { <span class="id" title="tactic">intros</span>. <span class="id" title="var">false</span>* <a class="idref" href="Partial.html#exists_step_val_inv"><span class="id" title="lemma">exists_step_val_inv</span></a>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">inverts</span> <span class="id" title="var">M</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">s'</span>&amp;<span class="id" title="var">t'</span>&amp;<span class="id" title="var">S</span>) <span class="id" title="var">M<sub>1</sub></span>. <span class="id" title="var">inverts</span> <span class="id" title="var">S</span> <span class="id" title="keyword">as</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Partial.html#evalnp_app_fix"><span class="id" title="constructor">evalnp_app_fix</span></a>. { <span class="id" title="tactic">reflexivity</span>. } <span class="id" title="var">applys</span> <span class="id" title="var">IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">applys</span> <span class="id" title="var">M<sub>1</sub></span>. <span class="id" title="var">applys</span>* <a class="idref" href="Nondet.html#step_app_fix"><span class="id" title="constructor">step_app_fix</span></a>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Partial.html#evalnp_add"><span class="id" title="constructor">evalnp_add</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">forwards</span> <span class="id" title="var">M<sub>1</sub>'</span>: <span class="id" title="var">M<sub>1</sub></span>. { <span class="id" title="var">applys</span> <a class="idref" href="Nondet.html#step_add"><span class="id" title="constructor">step_add</span></a>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inverts</span> <span class="id" title="var">M<sub>1</sub>'</span> <span class="id" title="keyword">as</span>. { <span class="id" title="tactic">auto</span>. } { <span class="id" title="tactic">intros</span>. <span class="id" title="var">false</span>* <a class="idref" href="Partial.html#exists_step_val_inv"><span class="id" title="lemma">exists_step_val_inv</span></a>. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">N</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_rand"><span class="id" title="constructor">evalnp_rand</span></a>. { <span class="id" title="var">math</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n<sub>1</sub>'</span> <span class="id" title="var">N<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">forwards</span> <span class="id" title="var">M<sub>1</sub>'</span>: <span class="id" title="var">M<sub>1</sub></span>. { <span class="id" title="var">applys</span>* <a class="idref" href="Nondet.html#step_rand"><span class="id" title="constructor">step_rand</span></a> <span class="id" title="var">n<sub>1</sub>'</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inverts</span> <span class="id" title="var">M<sub>1</sub>'</span> <span class="id" title="keyword">as</span>. { <span class="id" title="tactic">auto</span>. } { <span class="id" title="tactic">intros</span>. <span class="id" title="var">false</span>* <a class="idref" href="Partial.html#exists_step_val_inv"><span class="id" title="lemma">exists_step_val_inv</span></a>. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">D</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_ref"><span class="id" title="constructor">evalnp_ref</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">p'</span> <span class="id" title="var">D'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">forwards</span> <span class="id" title="var">M<sub>1</sub>'</span>: <span class="id" title="var">M<sub>1</sub></span>. { <span class="id" title="var">applys</span>* <a class="idref" href="Nondet.html#step_ref"><span class="id" title="constructor">step_ref</span></a> <span class="id" title="var">p'</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inverts</span> <span class="id" title="var">M<sub>1</sub>'</span> <span class="id" title="keyword">as</span>. { <span class="id" title="tactic">auto</span>. } { <span class="id" title="tactic">intros</span>. <span class="id" title="var">false</span>* <a class="idref" href="Partial.html#exists_step_val_inv"><span class="id" title="lemma">exists_step_val_inv</span></a>. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">D</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_get"><span class="id" title="constructor">evalnp_get</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">forwards</span> <span class="id" title="var">M<sub>1</sub>'</span>: <span class="id" title="var">M<sub>1</sub></span>. { <span class="id" title="var">applys</span>* <a class="idref" href="Nondet.html#step_get"><span class="id" title="constructor">step_get</span></a>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inverts</span> <span class="id" title="var">M<sub>1</sub>'</span> <span class="id" title="keyword">as</span>. { <span class="id" title="tactic">auto</span>. } { <span class="id" title="tactic">intros</span>. <span class="id" title="var">false</span>* <a class="idref" href="Partial.html#exists_step_val_inv"><span class="id" title="lemma">exists_step_val_inv</span></a>. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">D</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_set"><span class="id" title="constructor">evalnp_set</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">forwards</span> <span class="id" title="var">M<sub>1</sub>'</span>: <span class="id" title="var">M<sub>1</sub></span>. { <span class="id" title="var">applys</span>* <a class="idref" href="Nondet.html#step_set"><span class="id" title="constructor">step_set</span></a>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inverts</span> <span class="id" title="var">M<sub>1</sub>'</span> <span class="id" title="keyword">as</span>. { <span class="id" title="tactic">auto</span>. } { <span class="id" title="tactic">intros</span>. <span class="id" title="var">false</span>* <a class="idref" href="Partial.html#exists_step_val_inv"><span class="id" title="lemma">exists_step_val_inv</span></a>. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">D</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_free"><span class="id" title="constructor">evalnp_free</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">forwards</span> <span class="id" title="var">M<sub>1</sub>'</span>: <span class="id" title="var">M<sub>1</sub></span>. { <span class="id" title="var">applys</span>* <a class="idref" href="Nondet.html#step_free"><span class="id" title="constructor">step_free</span></a>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inverts</span> <span class="id" title="var">M<sub>1</sub>'</span> <span class="id" title="keyword">as</span>. { <span class="id" title="tactic">auto</span>. } { <span class="id" title="tactic">intros</span>. <span class="id" title="var">false</span>* <a class="idref" href="Partial.html#exists_step_val_inv"><span class="id" title="lemma">exists_step_val_inv</span></a>. } } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">inverts</span> <span class="id" title="var">M</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">s'</span>&amp;<span class="id" title="var">t'</span>&amp;<span class="id" title="var">S</span>) <span class="id" title="var">M'</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">S</span>. } <span class="comment">(*&nbsp;not&nbsp;included&nbsp;in&nbsp;semantics&nbsp;*)</span><br/>
&nbsp;&nbsp;{ <span class="id" title="var">lets</span> (<span class="id" title="var">Q<sub>1</sub></span>&amp;<span class="id" title="var">M<sub>1</sub></span>&amp;<span class="id" title="var">M<sub>2</sub></span>): <a class="idref" href="Partial.html#evalnpz_let_inv"><span class="id" title="lemma">evalnpz_let_inv</span></a> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <a class="idref" href="Partial.html#evalnp_let"><span class="id" title="constructor">evalnp_let</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <span class="id" title="var">IH</span>. <span class="id" title="var">applys</span> <span class="id" title="var">M<sub>1</sub></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">R</span>. <span class="id" title="var">applys</span> <span class="id" title="var">IH</span>. <span class="id" title="var">applys</span> <span class="id" title="var">M<sub>2</sub></span> <span class="id" title="var">R</span>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">inverts</span> <span class="id" title="var">M</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">s'</span>&amp;<span class="id" title="var">t'</span>&amp;<span class="id" title="var">S</span>) <span class="id" title="var">M<sub>1</sub></span>. <span class="id" title="var">inverts</span> <span class="id" title="var">S</span>. <span class="id" title="var">applys</span> <a class="idref" href="Partial.html#evalnp_if"><span class="id" title="constructor">evalnp_if</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">applys</span> <span class="id" title="var">IH</span>. <span class="id" title="var">applys</span> <span class="id" title="var">M<sub>1</sub></span>. <span class="id" title="var">applys</span> <a class="idref" href="Nondet.html#step_if"><span class="id" title="constructor">step_if</span></a>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
For the reciprocal direction, we also need one key inversion lemma. It
    is stated below. Its hypothesis is <span class="inlinecode"><span class="id" title="var">evalnp</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>, and its conclusion
    corresponds to the disjunction of the constructors of the inductive
    definition of <span class="inlinecode"><span class="id" title="var">evalnpz</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="evalnp_inv_step" class="idref" href="#evalnp_inv_step"><span class="id" title="lemma">evalnp_inv_step</span></a> : <span class="id" title="keyword">∀</span> <a id="s:368" class="idref" href="#s:368"><span class="id" title="binder">s</span></a> <a id="t:369" class="idref" href="#t:369"><span class="id" title="binder">t</span></a> <a id="Q:370" class="idref" href="#Q:370"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnp"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s:368"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:369"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#Q:370"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e<sub>25</sub>"><span class="id" title="notation">(</span></a><span class="id" title="notation">∃</span> <a id="v:371" class="idref" href="#v:371"><span class="id" title="binder">v</span></a><span class="id" title="notation">,</span> <a class="idref" href="Partial.html#t:369"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <a class="idref" href="Partial.html#v:371"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Partial.html#Q:370"><span class="id" title="variable">Q</span></a> <a class="idref" href="Partial.html#v:371"><span class="id" title="variable">v</span></a> <a class="idref" href="Partial.html#s:368"><span class="id" title="variable">s</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e<sub>25</sub>"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e<sub>25</sub>"><span class="id" title="notation">∨</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e<sub>25</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><span class="id" title="notation">∃</span> <a id="s':372" class="idref" href="#s':372"><span class="id" title="binder">s'</span></a> <a id="t':373" class="idref" href="#t':373"><span class="id" title="binder">t'</span></a><span class="id" title="notation">,</span> <a class="idref" href="Nondet.html#step"><span class="id" title="inductive">step</span></a> <a class="idref" href="Partial.html#s:368"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:369"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#s':372"><span class="id" title="variable">s'</span></a> <a class="idref" href="Partial.html#t':373"><span class="id" title="variable">t'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Partial.html#evalnp"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s':372"><span class="id" title="variable">s'</span></a> <a class="idref" href="Partial.html#t':373"><span class="id" title="variable">t'</span></a> <a class="idref" href="Partial.html#Q:370"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="s':374" class="idref" href="#s':374"><span class="id" title="binder">s'</span></a> <a id="t':375" class="idref" href="#t':375"><span class="id" title="binder">t'</span></a>, <a class="idref" href="Nondet.html#step"><span class="id" title="inductive">step</span></a> <a class="idref" href="Partial.html#s:368"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:369"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#s':374"><span class="id" title="variable">s'</span></a> <a class="idref" href="Partial.html#t':375"><span class="id" title="variable">t'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Partial.html#evalnp"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s':374"><span class="id" title="variable">s'</span></a> <a class="idref" href="Partial.html#t':375"><span class="id" title="variable">t'</span></a> <a class="idref" href="Partial.html#Q:370"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e<sub>25</sub>"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">gen</span> <span class="id" title="var">s</span> <span class="id" title="var">Q</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="var">inverts</span> <span class="id" title="var">M</span> <span class="id" title="keyword">as</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">R</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">R</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">∃</span>. <span class="id" title="tactic">split</span>. { <span class="id" title="var">applys</span> <a class="idref" href="Nondet.html#step_fix"><span class="id" title="constructor">step_fix</span></a>. } { <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_val"><span class="id" title="constructor">evalnp_val</span></a>. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">s'</span> <span class="id" title="var">t'</span> <span class="id" title="var">S</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">S</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_val"><span class="id" title="constructor">evalnp_val</span></a>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">M<sub>1</sub></span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">∃</span>. <span class="id" title="tactic">split</span>. { <span class="id" title="var">applys</span>* <a class="idref" href="Nondet.html#step_app_fix"><span class="id" title="constructor">step_app_fix</span></a>. } { <span class="id" title="tactic">auto</span>. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">s'</span> <span class="id" title="var">t'</span> <span class="id" title="var">S</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">S</span> <span class="id" title="keyword">as</span> <span class="id" title="var">E</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">E</span>. <span class="id" title="tactic">auto</span>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">R</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">∃</span>. <span class="id" title="tactic">split</span>. { <span class="id" title="var">applys</span> <a class="idref" href="Nondet.html#step_add"><span class="id" title="constructor">step_add</span></a>. } { <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_val"><span class="id" title="constructor">evalnp_val</span></a>. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">s'</span> <span class="id" title="var">t'</span> <span class="id" title="var">S</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">S</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_val"><span class="id" title="constructor">evalnp_val</span></a>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">N</span> <span class="id" title="var">R</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">∃</span>. <span class="id" title="tactic">split</span>. { <span class="id" title="var">applys</span>* <a class="idref" href="Nondet.html#step_rand"><span class="id" title="constructor">step_rand</span></a> 0. <span class="id" title="var">math</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_val"><span class="id" title="constructor">evalnp_val</span></a>. <span class="id" title="var">applys</span> <span class="id" title="var">R</span>. <span class="id" title="var">math</span>. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">s'</span> <span class="id" title="var">t'</span> <span class="id" title="var">S</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">S</span>; <span class="id" title="var">tryfalse</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_val"><span class="id" title="constructor">evalnp_val</span></a>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">R</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">forwards</span>¬(<span class="id" title="var">p</span>&amp;<span class="id" title="var">D</span>&amp;<span class="id" title="var">N</span>): (<a class="idref" href="LibSepFmap.html#exists_fresh"><span class="id" title="lemma">exists_fresh</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a> <span class="id" title="var">s</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span>. <span class="id" title="tactic">split</span>. { <span class="id" title="var">applys</span>* <a class="idref" href="Nondet.html#step_ref"><span class="id" title="constructor">step_ref</span></a>. } { <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_val"><span class="id" title="constructor">evalnp_val</span></a>. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">s'</span> <span class="id" title="var">t'</span> <span class="id" title="var">S</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">S</span>; <span class="id" title="var">tryfalse</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_val"><span class="id" title="constructor">evalnp_val</span></a>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">D</span> <span class="id" title="var">R</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">∃</span>. <span class="id" title="tactic">split</span>. { <span class="id" title="var">applys</span>* <a class="idref" href="Nondet.html#step_get"><span class="id" title="constructor">step_get</span></a>. } { <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_val"><span class="id" title="constructor">evalnp_val</span></a>. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">s'</span> <span class="id" title="var">t'</span> <span class="id" title="var">S</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">S</span>; <span class="id" title="var">tryfalse</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_val"><span class="id" title="constructor">evalnp_val</span></a>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">D</span> <span class="id" title="var">R</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">∃</span>. <span class="id" title="tactic">split</span>. { <span class="id" title="var">applys</span>* <a class="idref" href="Nondet.html#step_set"><span class="id" title="constructor">step_set</span></a>. } { <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_val"><span class="id" title="constructor">evalnp_val</span></a>. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">s'</span> <span class="id" title="var">t'</span> <span class="id" title="var">S</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">S</span>; <span class="id" title="var">tryfalse</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_val"><span class="id" title="constructor">evalnp_val</span></a>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">D</span> <span class="id" title="var">R</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">∃</span>. <span class="id" title="tactic">split</span>. { <span class="id" title="var">applys</span>* <a class="idref" href="Nondet.html#step_free"><span class="id" title="constructor">step_free</span></a>. } { <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_val"><span class="id" title="constructor">evalnp_val</span></a>. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">s'</span> <span class="id" title="var">t'</span> <span class="id" title="var">S</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">S</span>; <span class="id" title="var">tryfalse</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_val"><span class="id" title="constructor">evalnp_val</span></a>. } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="tactic">rename</span> <span class="id" title="var">v</span> <span class="id" title="var">into</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">forwards</span> [(<span class="id" title="var">v<sub>1</sub></span>&amp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>&amp;<span class="id" title="var">HQ<sub>1</sub></span>)|((<span class="id" title="var">s'</span>&amp;<span class="id" title="var">t'</span>&amp;<span class="id" title="var">S'</span>&amp;<span class="id" title="var">M'</span>)&amp;<span class="id" title="var">_</span>)]: <span class="id" title="var">IHt1</span> <span class="id" title="var">M<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">∃</span>. <span class="id" title="tactic">split</span>. { <span class="id" title="var">applys</span> <a class="idref" href="Nondet.html#step_let"><span class="id" title="constructor">step_let</span></a>. } { <span class="id" title="var">applys</span>* <span class="id" title="var">M<sub>2</sub></span>. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">∃</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Nondet.html#step_let_ctx"><span class="id" title="constructor">step_let_ctx</span></a> <span class="id" title="var">S'</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Partial.html#evalnp_let"><span class="id" title="constructor">evalnp_let</span></a> <span class="id" title="var">M'</span>. <span class="id" title="var">applys</span> <span class="id" title="var">M<sub>2</sub></span>. } } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">s'</span> <span class="id" title="var">t'</span> <span class="id" title="var">S</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">S</span> <span class="id" title="keyword">as</span> <span class="id" title="var">S</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">forwards</span> [(<span class="id" title="var">v<sub>1</sub></span>&amp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>&amp;<span class="id" title="var">HQ<sub>1</sub></span>)|(<span class="id" title="var">_</span>&amp;<span class="id" title="var">M<sub>3</sub></span>)]: <span class="id" title="var">IHt1</span> <span class="id" title="var">M<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">inverts</span> <span class="id" title="var">S</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">specializes</span> <span class="id" title="var">M<sub>3</sub></span> <span class="id" title="var">S</span>. <span class="id" title="var">applys</span> <a class="idref" href="Partial.html#evalnp_let"><span class="id" title="constructor">evalnp_let</span></a> <span class="id" title="var">M<sub>3</sub></span> <span class="id" title="var">M<sub>2</sub></span>. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">inverts</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="keyword">as</span> <span class="id" title="var">R</span>. <span class="id" title="var">applys</span>* <span class="id" title="var">M<sub>2</sub></span>. } } }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">introv</span> <span class="id" title="var">M<sub>1</sub></span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">∃</span>. <span class="id" title="tactic">split</span>. { <span class="id" title="var">applys</span> <a class="idref" href="Nondet.html#step_if"><span class="id" title="constructor">step_if</span></a>. } { <span class="id" title="tactic">auto</span>. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">s'</span> <span class="id" title="var">t'</span> <span class="id" title="var">S</span>. <span class="id" title="var">inverts</span> <span class="id" title="var">S</span>. <span class="id" title="tactic">auto</span>. } }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Using this inversion lemma, it is straightforward to derive the
    implication from <span class="inlinecode"><span class="id" title="var">evalnp</span></span> to <span class="inlinecode"><span class="id" title="var">evalnpz</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="evalnpz_of_coeval" class="idref" href="#evalnpz_of_coeval"><span class="id" title="lemma">evalnpz_of_coeval</span></a> : <span class="id" title="keyword">∀</span> <a id="s:376" class="idref" href="#s:376"><span class="id" title="binder">s</span></a> <a id="t:377" class="idref" href="#t:377"><span class="id" title="binder">t</span></a> <a id="Q:378" class="idref" href="#Q:378"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnp"><span class="id" title="inductive">evalnp</span></a> <a class="idref" href="Partial.html#s:376"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:377"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#Q:378"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnpz"><span class="id" title="inductive">evalnpz</span></a> <a class="idref" href="Partial.html#s:376"><span class="id" title="variable">s</span></a> <a class="idref" href="Partial.html#t:377"><span class="id" title="variable">t</span></a> <a class="idref" href="Partial.html#Q:378"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">cofix</span> <span class="id" title="var">IH</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">lets</span> <span class="id" title="var">C</span>: <a class="idref" href="Partial.html#evalnp_inv_step"><span class="id" title="lemma">evalnp_inv_step</span></a> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">C</span> <span class="id" title="keyword">as</span> [(<span class="id" title="var">v</span>&amp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>&amp;<span class="id" title="var">HQ</span>)|((<span class="id" title="var">s'</span>&amp;<span class="id" title="var">t'</span>&amp;<span class="id" title="var">S</span>&amp;<span class="id" title="var">M<sub>1</sub></span>)&amp;<span class="id" title="var">M<sub>2</sub></span>)].<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Partial.html#evalnpz_val"><span class="id" title="constructor">evalnpz_val</span></a> <span class="id" title="var">HQ</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Partial.html#evalnpz_step"><span class="id" title="constructor">evalnpz_step</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">∃</span>. <span class="id" title="var">applys</span> <span class="id" title="var">S</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">S'</span>. <span class="id" title="var">applys</span> <span class="id" title="var">IH</span>. <span class="id" title="var">applys</span> <span class="id" title="var">M<sub>2</sub></span> <span class="id" title="var">S'</span>. } }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Combining the two directions yields the equality between <span class="inlinecode"><span class="id" title="var">evalnpz</span></span> and
    <span class="inlinecode"><span class="id" title="var">evalnp</span></span>, and that between <span class="inlinecode"><span class="id" title="var">evalnps</span></span> and <span class="inlinecode"><span class="id" title="var">evalnp</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="evalnpz_eq_evalnp" class="idref" href="#evalnpz_eq_evalnp"><span class="id" title="lemma">evalnpz_eq_evalnp</span></a> :<br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#evalnpz"><span class="id" title="inductive">evalnpz</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Partial.html#evalnp"><span class="id" title="inductive">evalnp</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">extens</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span> <span class="id" title="var">Q</span>. <span class="id" title="var">iff</span> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnp_of_evalnpz"><span class="id" title="lemma">evalnp_of_evalnpz</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span>* <a class="idref" href="Partial.html#evalnpz_of_coeval"><span class="id" title="lemma">evalnpz_of_coeval</span></a>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="hoarenpcso_eq_hoarenp" class="idref" href="#hoarenpcso_eq_hoarenp"><span class="id" title="lemma">hoarenpcso_eq_hoarenp</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenpz"><span class="id" title="definition">hoarenpz</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Partial.html#hoarenp"><span class="id" title="definition">hoarenp</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Partial.html#hoarenp"><span class="id" title="definition">hoarenp</span></a>, <a class="idref" href="Partial.html#hoarenpz"><span class="id" title="definition">hoarenpz</span></a>. <span class="id" title="tactic">rewrite</span>* <a class="idref" href="Partial.html#evalnpz_eq_evalnp"><span class="id" title="lemma">evalnpz_eq_evalnp</span></a>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="hoarenps_eq_hoarenp" class="idref" href="#hoarenps_eq_hoarenp"><span class="id" title="lemma">hoarenps_eq_hoarenp</span></a> :<br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="Partial.html#hoarenps"><span class="id" title="definition">hoarenps</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Partial.html#hoarenp"><span class="id" title="definition">hoarenp</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="Partial.html#hoarenpz_eq_hoarenps"><span class="id" title="lemma">hoarenpz_eq_hoarenps</span></a>. <span class="id" title="tactic">rewrite</span>* <a class="idref" href="Partial.html#hoarenpcso_eq_hoarenp"><span class="id" title="lemma">hoarenpcso_eq_hoarenp</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
As another corollary, we can establish the equivalence between the big-step
    and the small-step characterization of divergence. Indeed, both are
    obtained by specializing the postcondition to <span class="inlinecode"><span class="id" title="var">Empty</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="divns_eq_divn" class="idref" href="#divns_eq_divn"><span class="id" title="lemma">divns_eq_divn</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Partial.html#divns"><span class="id" title="definition">divns</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Partial.html#divn"><span class="id" title="definition">divn</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">extens</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Partial.html#divn"><span class="id" title="definition">divn</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="Partial.html#divns_iff_evalnps_Empty"><span class="id" title="axiom">divns_iff_evalnps_Empty</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="Partial.html#evalnpz_eq_evalnp"><span class="id" title="lemma">evalnpz_eq_evalnp</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span>* <a class="idref" href="Partial.html#evalnpz_eq_evalnps"><span class="id" title="lemma">evalnpz_eq_evalnps</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab503"></a><h2 class="section">Historical Notes</h2>

<div class="paragraph"> </div>

 Many program verification tools target partial correctness only, or provide
    separate tooling for justifying termination.

<div class="paragraph"> </div>

    The soundness of program logics delivering partial correctness is nearly
    always justified with respect to a small-step semantics of the programming
    language. Partial correctness is generally chosen because it appears better
    suited for reasoning about programs that involve some amount of
    concurrency, and for programs that are not meant to terminate (e.g., system
    kernels).

<div class="paragraph"> </div>

    Capturing partial correctness using a coinductive big-step judgment, as done
    in this chapter with the predicate <span class="inlinecode"><span class="id" title="var">evalnp</span></span>, appears to be novel as of Jan.
    2021. 
</div>
<div class="code">

<span class="comment">(*&nbsp;2022-03-09&nbsp;18:49&nbsp;*)</span><br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>