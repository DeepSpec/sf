<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>Repr: Representation Predicates</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/slf.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 6: Separation Logic Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">Repr<span class="subtitle">Representation Predicates</span></h1>


<div class="code">

<span class="id" title="keyword">Set Implicit Arguments</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">SLF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="LibSepReference.html#"><span class="id" title="library">LibSepReference</span></a>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ProgramSyntax</span> <span class="id" title="var">DemoPrograms</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">SLF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Basic.html#"><span class="id" title="library">Basic</span></a>.<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">liblist_scope</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> : <span class="id" title="notation">int</span>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span> <span class="id" title="var">s</span> <span class="id" title="var">c</span> : <a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">x</span> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
</div>

<div class="doc">
<a id="lab45"></a><h1 class="section">First Pass</h1>

<div class="paragraph"> </div>

 A representation predicate is a heap predicate that describes a mutable data
    structure. For example, the heap predicate <span class="inlinecode"><span class="id" title="var">MList</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> describes a mutable
    linked list whose head cell is at location <span class="inlinecode"><span class="id" title="var">p</span></span>, and whose elements are
    described by the Coq list <span class="inlinecode"><span class="id" title="var">L</span></span>. In this chapter, we'll see how to define
    <span class="inlinecode"><span class="id" title="var">MList</span></span>, and to use this predicate for specifying and verifying functions
    that operate on mutable linked lists. We will also study representation
    predicates for mutable trees, as well as for counter functions, which
    feature an internal state.

<div class="paragraph"> </div>

    As explained in the <a href="Preface.html"><span class="inlineref">Preface</span></a>, this chapter, like all the following
    ones, is decomposed in three parts:

<div class="paragraph"> </div>

<ul class="doclist">
<li> The <i>First Pass</i> section presents the most important ideas only.

</li>
<li> The <i>More Details</i> section presents additional material explaining
      in more depth the meaning and the consequences of the key results.
      By default, readers would eventually read all this material.

</li>
<li> The <i>Optional Material</i> section contains more advanced material,
      for readers who can afford to invest more time in the topic. 
</li>
</ul>

</div>

<div class="doc">
<a id="lab46"></a><h2 class="section">Formalization of the List Representation Predicate</h2>

<div class="paragraph"> </div>

 The implementation of mutable lists and trees involves the use of records.
    For simplicity, field names are represented as natural numbers. For example,
    to represent a list cell with a head and a tail field, we define <span class="inlinecode"><span class="id" title="var">head</span></span> as
    the constant zero, and <span class="inlinecode"><span class="id" title="var">tail</span></span> as the constant one. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="head" class="idref" href="#head"><span class="id" title="definition">head</span></a> : <a class="idref" href="LibSepReference.html#field"><span class="id" title="definition">field</span></a> := 0%<span class="id" title="var">nat</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="tail" class="idref" href="#tail"><span class="id" title="definition">tail</span></a> : <a class="idref" href="LibSepReference.html#field"><span class="id" title="definition">field</span></a> := 1%<span class="id" title="var">nat</span>.<br/>
</div>

<div class="doc">
The heap predicate <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~~&gt;`{</span> <span class="inlinecode"><span class="id" title="var">head</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">x</span>;</span> <span class="inlinecode"><span class="id" title="var">tail</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">q</span></span> <span class="inlinecode">}</span> describes a record
    allocated at location <span class="inlinecode"><span class="id" title="var">p</span></span>, with a head field storing <span class="inlinecode"><span class="id" title="var">x</span></span> and a tail field
    storing <span class="inlinecode"><span class="id" title="var">q</span></span>. The arrow <span class="inlinecode">~~~&gt;</span> is provided by the framework for describing
    records. The notation <span class="inlinecode">`{...}</span> is a handy notation for a list of pairs of
    field names and values of arbitrary types. (Further details on the
    formalization of records are presented in chapter <a href="Struct.html"><span class="inlineref">Struct</span></a>.)

<div class="paragraph"> </div>

    A mutable list consists of a chain of cells. Each cell stores a tail pointer
    that gives the location of the next cell in the chain. The last cell stores
    the <span class="inlinecode"><span class="id" title="var">null</span></span> value in its tail field.

<div class="paragraph"> </div>

    The heap predicate <span class="inlinecode"><span class="id" title="var">MList</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> describes a list whose head cell is at
    location <span class="inlinecode"><span class="id" title="var">p</span></span>, and whose elements are described by the list <span class="inlinecode"><span class="id" title="var">L</span></span>. This
    predicate is defined recursively on the structure of <span class="inlinecode"><span class="id" title="var">L</span></span>:

<div class="paragraph"> </div>

<ul class="doclist">
<li> if <span class="inlinecode"><span class="id" title="var">L</span></span> is empty, then <span class="inlinecode"><span class="id" title="var">p</span></span> is the null pointer,

</li>
<li> if <span class="inlinecode"><span class="id" title="var">L</span></span> is of the form <span class="inlinecode"><span class="id" title="var">x</span>::<span class="id" title="var">L'</span></span>, then <span class="inlinecode"><span class="id" title="var">p</span></span> is not null, and the
      head field of <span class="inlinecode"><span class="id" title="var">p</span></span> contains <span class="inlinecode"><span class="id" title="var">x</span></span>, and the tail field of <span class="inlinecode"><span class="id" title="var">p</span></span>
      contains a pointer <span class="inlinecode"><span class="id" title="var">q</span></span> such that <span class="inlinecode"><span class="id" title="var">MList</span></span> <span class="inlinecode"><span class="id" title="var">L'</span></span> <span class="inlinecode"><span class="id" title="var">q</span></span> describes the
      tail of the list.

</li>
</ul>

<div class="paragraph"> </div>

    This definition is formalized as follows. 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <a id="MList" class="idref" href="#MList"><span class="id" title="definition">MList</span></a> (<a id="L:1" class="idref" href="#L:1"><span class="id" title="binder">L</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) (<a id="p:2" class="idref" href="#p:2"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Repr.html#L:1"><span class="id" title="variable">L</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Repr.html#p:2"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;| <span class="id" title="var">x</span><span class="id" title="notation">::</span><span class="id" title="var">L'</span> ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="q:5" class="idref" href="#q:5"><span class="id" title="binder">q</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#p:2"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#3a1f4def71aa7ea77c87b41e2bd7edb0"><span class="id" title="notation">~~~&gt;</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">`{</span></a> <a class="idref" href="Repr.html#head"><span class="id" title="definition">head</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <span class="id" title="var">x</span><a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Repr.html#tail"><span class="id" title="definition">tail</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Repr.html#q:5"><span class="id" title="variable">q</span></a><a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">}</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#MList:3"><span class="id" title="definition">MList</span></a> <span class="id" title="var">L'</span> <a class="idref" href="Repr.html#q:5"><span class="id" title="variable">q</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
<a id="lab47"></a><h2 class="section">Alternative Characterizations of <span class="inlinecode"><span class="id" title="var">MList</span></span></h2>

<div class="paragraph"> </div>

 Carrying out proofs directly with <span class="inlinecode"><span class="id" title="var">MList</span></span> can be slightly cumbersome, mainly
    due to Coq's limited support for folding back definitions. We find it more
    practical to explicitly state equalities that paraphrase the definition of
    <span class="inlinecode"><span class="id" title="var">MList</span></span>. There is one equality for the <span class="inlinecode"><span class="id" title="var">nil</span></span> case, and one for the <span class="inlinecode"><span class="id" title="var">cons</span></span>
    case. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="MList_nil" class="idref" href="#MList_nil"><span class="id" title="lemma">MList_nil</span></a> : <span class="id" title="keyword">∀</span> <a id="p:6" class="idref" href="#p:6"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="Repr.html#p:6"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Repr.html#p:6"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="MList_cons" class="idref" href="#MList_cons"><span class="id" title="lemma">MList_cons</span></a> : <span class="id" title="keyword">∀</span> <a id="p:7" class="idref" href="#p:7"><span class="id" title="binder">p</span></a> <a id="x:8" class="idref" href="#x:8"><span class="id" title="binder">x</span></a> <a id="L':9" class="idref" href="#L':9"><span class="id" title="binder">L'</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> (<a class="idref" href="Repr.html#x:8"><span class="id" title="variable">x</span></a><span class="id" title="notation">::</span><a class="idref" href="Repr.html#L':9"><span class="id" title="variable">L'</span></a>) <a class="idref" href="Repr.html#p:7"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="q:10" class="idref" href="#q:10"><span class="id" title="binder">q</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#p:7"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#3a1f4def71aa7ea77c87b41e2bd7edb0"><span class="id" title="notation">~~~&gt;</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">`{</span></a> <a class="idref" href="Repr.html#head"><span class="id" title="definition">head</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Repr.html#x:8"><span class="id" title="variable">x</span></a><a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Repr.html#tail"><span class="id" title="definition">tail</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Repr.html#q:10"><span class="id" title="variable">q</span></a><a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">}</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Repr.html#L':9"><span class="id" title="variable">L'</span></a> <a class="idref" href="Repr.html#q:10"><span class="id" title="variable">q</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
In addition, it is also very useful in proofs to reformulate the definition
    of <span class="inlinecode"><span class="id" title="var">MList</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> in the form of a case analysis on whether the pointer <span class="inlinecode"><span class="id" title="var">p</span></span> is
    null or not. This corresponds to the programming pattern
    <span class="inlinecode"><span class="id" title="keyword">if</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">==</span> <span class="inlinecode"><span class="id" title="var">null</span></span> <span class="inlinecode"><span class="id" title="keyword">then</span></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="keyword">else</span></span>. This alternative characterization of
    <span class="inlinecode"><span class="id" title="var">MList</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> asserts that:

<div class="paragraph"> </div>

<ul class="doclist">
<li> if <span class="inlinecode"><span class="id" title="var">p</span></span> is null, then <span class="inlinecode"><span class="id" title="var">L</span></span> is empty,

</li>
<li> otherwise, <span class="inlinecode"><span class="id" title="var">L</span></span> decomposes as <span class="inlinecode"><span class="id" title="var">x</span>::<span class="id" title="var">L'</span></span>, the head field of <span class="inlinecode"><span class="id" title="var">p</span></span> contains <span class="inlinecode"><span class="id" title="var">x</span></span>,
      and the tail field of <span class="inlinecode"><span class="id" title="var">p</span></span> contains a pointer <span class="inlinecode"><span class="id" title="var">q</span></span> such that <span class="inlinecode"><span class="id" title="var">MList</span></span> <span class="inlinecode"><span class="id" title="var">L'</span></span> <span class="inlinecode"><span class="id" title="var">q</span></span>
      describes the tail of the list.

</li>
</ul>

<div class="paragraph"> </div>

    The corresponding lemma, shown below, is stated using the
    <span class="inlinecode"><span class="id" title="var">If</span></span> <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="keyword">then</span></span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode"><span class="id" title="keyword">else</span></span> <span class="inlinecode"><span class="id" title="var">Y</span></span> construction, which generalizes Coq's construction
    <span class="inlinecode"><span class="id" title="keyword">if</span></span> <span class="inlinecode"><span class="id" title="var">b</span></span> <span class="inlinecode"><span class="id" title="keyword">then</span></span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode"><span class="id" title="keyword">else</span></span> <span class="inlinecode"><span class="id" title="var">Y</span></span> to discriminate over a proposition <span class="inlinecode"><span class="id" title="var">P</span></span> as opposed to a
    boolean value <span class="inlinecode"><span class="id" title="var">b</span></span>. The <span class="inlinecode"><span class="id" title="var">If</span></span> construct leverages (strong) classical logic. It
    is provided by the TLC library, just like the tactic <span class="inlinecode"><span class="id" title="var">case_if</span></span> which is
    convenient for performing the case analysis on whether <span class="inlinecode"><span class="id" title="var">P</span></span> is true or false.
    
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="MList_if" class="idref" href="#MList_if"><span class="id" title="lemma">MList_if</span></a> : <span class="id" title="keyword">∀</span> (<a id="p:11" class="idref" href="#p:11"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) (<a id="L:12" class="idref" href="#L:12"><span class="id" title="binder">L</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Repr.html#L:12"><span class="id" title="variable">L</span></a> <a class="idref" href="Repr.html#p:11"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><span class="id" title="notation">If</span> <a class="idref" href="Repr.html#p:11"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">then</span> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Repr.html#L:12"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">else</span> <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="x:13" class="idref" href="#x:13"><span class="id" title="binder">x</span></a> <a id="q:14" class="idref" href="#q:14"><span class="id" title="binder">q</span></a> <a id="L':15" class="idref" href="#L':15"><span class="id" title="binder">L'</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Repr.html#L:12"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Repr.html#x:13"><span class="id" title="variable">x</span></a><span class="id" title="notation">::</span><a class="idref" href="Repr.html#L':15"><span class="id" title="variable">L'</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#p:11"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#3a1f4def71aa7ea77c87b41e2bd7edb0"><span class="id" title="notation">~~~&gt;</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">`{</span></a> <a class="idref" href="Repr.html#head"><span class="id" title="definition">head</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Repr.html#x:13"><span class="id" title="variable">x</span></a><a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Repr.html#tail"><span class="id" title="definition">tail</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Repr.html#q:14"><span class="id" title="variable">q</span></a><a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">}</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Repr.html#L':15"><span class="id" title="variable">L'</span></a> <a class="idref" href="Repr.html#q:14"><span class="id" title="variable">q</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
</div>

<div class="doc">
The proof is a bit technical, it may be skipped for a first reading. 
</div>
<div class="code">
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
</div>

<div class="doc">
Let's prove this result by case analysis on <span class="inlinecode"><span class="id" title="var">L</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">L</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">x</span> <span class="id" title="var">L'</span>].<br/>
</div>

<div class="doc">
Case <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">nil</span></span>. By definition of <span class="inlinecode"><span class="id" title="var">MList</span></span>, we have <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">null</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;{ <span class="id" title="var">xchange</span> <a class="idref" href="Repr.html#MList_nil"><span class="id" title="lemma">MList_nil</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">M</span>.<br/>
</div>

<div class="doc">
We have to justify <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">nil</span></span>, which is trivial. The TLC <span class="inlinecode"><span class="id" title="var">case_if</span></span> tactic
    performs a case analysis on the argument of the first visible <span class="inlinecode"><span class="id" title="keyword">if</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">case_if</span>. <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">auto</span>. }<br/>
</div>

<div class="doc">
Case <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">x</span>::<span class="id" title="var">L'</span></span>.  One possibility is to perform a rewrite operation using <span class="inlinecode"><span class="id" title="var">MList_cons</span></span> on its
    first occurrence. Then using CFML the tactic <span class="inlinecode"><span class="id" title="var">xpull</span></span> to extract the
    existential quantifiers out from the precondition:
    <span class="inlinecode"><span class="id" title="tactic">rewrite</span></span> <span class="inlinecode"><span class="id" title="var">MList_cons</span>.</span> <span class="inlinecode"><span class="id" title="var">xpull</span>.</span> <span class="inlinecode"><span class="id" title="tactic">intros</span></span> <span class="inlinecode"><span class="id" title="var">q</span>.</span>
    A more efficient approach is to use the dedicated CFML tactic <span class="inlinecode"><span class="id" title="var">xchange</span></span>,
    which is specialized for performing updates in the current state. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">xchange</span> <a class="idref" href="Repr.html#MList_cons"><span class="id" title="lemma">MList_cons</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">q</span>.<br/>
</div>

<div class="doc">
Because a record is allocated at location <span class="inlinecode"><span class="id" title="var">p</span></span>, the pointer <span class="inlinecode"><span class="id" title="var">p</span></span> cannot be
    null. The lemma <span class="inlinecode"><span class="id" title="var">hrecord_not_null</span></span> allows us to exploit this property,
    extracting the hypothesis <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">≠</span> <span class="inlinecode"><span class="id" title="var">null</span></span>. We use again the tactic <span class="inlinecode"><span class="id" title="var">case_if</span></span> to
    simplify the case analysis. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xchange</span> <a class="idref" href="LibSepReference.html#hrecord_not_null"><span class="id" title="axiom">hrecord_not_null</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">N</span>. <span class="id" title="var">case_if</span>.<br/>
</div>

<div class="doc">
To conclude, it suffices to correctly instantiate the existential
    quantifiers. The tactic <span class="inlinecode"><span class="id" title="var">xsimpl</span></span> is able to guess the appropriate
    instantiations. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">auto</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Note that the reciprocal entailment to the one stated in <span class="inlinecode"><span class="id" title="var">MList_if</span></span> is also
    true, but we do not need it so we do not bother proving it here. In the rest
    of the course, we will never unfold the definition <span class="inlinecode"><span class="id" title="var">MList</span></span>, but only work
    using <span class="inlinecode"><span class="id" title="var">MList_nil</span></span>, <span class="inlinecode"><span class="id" title="var">MList_cons</span></span>, and <span class="inlinecode"><span class="id" title="var">MList_if</span></span>. So, we can make <span class="inlinecode"><span class="id" title="var">MList</span></span>
    opaque, thereby avoiding undesired simplifications. 
</div>
<div class="code">

<span class="id" title="keyword">Global Opaque</span> <a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a>.<br/>
</div>

<div class="doc">
<a id="lab48"></a><h2 class="section">In-place Concatenation of Two Mutable Lists</h2>

<div class="paragraph"> </div>

 The function <span class="inlinecode"><span class="id" title="var">append</span></span> expects two arguments: a pointer <span class="inlinecode"><span class="id" title="var">p<sub>1</sub></span></span> on a nonempty
    list, and a pointer <span class="inlinecode"><span class="id" title="var">p<sub>2</sub></span></span> on another list (possibly empty). The function
    updates the last cell from the first list in such a way that its tail points
    to the head cell of <span class="inlinecode"><span class="id" title="var">p<sub>2</sub></span></span>. After this operation, the pointer <span class="inlinecode"><span class="id" title="var">p<sub>1</sub></span></span> points to a
    list that corresponds to the concatenation of the two input lists.

<div class="paragraph"> </div>

<span class="inlinecode-ocaml">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="keyword">rec</span> <span class="id" title="var">append</span> <span class="id" title="var">p<sub>1</sub></span> <span class="id" title="var">p<sub>2</sub></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">p<sub>1</sub>.tail</span> == <span class="id" title="var">null</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">p<sub>1</sub>.tail</span> &lt;- <span class="id" title="var">p<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">append</span> <span class="id" title="var">p<sub>1</sub>.tail</span> <span class="id" title="var">p<sub>2</sub></span>
</span>
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="append" class="idref" href="#append"><span class="id" title="definition">append</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#04af5112f77d94e84bf2cc7677bd575d"><span class="id" title="notation">fix</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">p<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#04af5112f77d94e84bf2cc7677bd575d"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q<sub>1</sub>'"><span class="id" title="notation">q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#8e45340a54d108624916002b0e01c7ee"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#tail"><span class="id" title="definition">tail</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q<sub>1</sub>'"><span class="id" title="notation">q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#3fbef795df792463de2da5f563e20424"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a><a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#ed9bce70f2e963efb3aa4cfc718e9949"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#tail"><span class="id" title="definition">tail</span></a> <a class="idref" href="LibSepReference.html#ed9bce70f2e963efb3aa4cfc718e9949"><span class="id" title="notation">:=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">p<sub>2</sub></span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q<sub>1</sub>'"><span class="id" title="notation">q<sub>1</sub></span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">p<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
The append function is specified and verified as shown below. The proof
    pattern is representative of that of many list-manipulating functions, so it
    is essential that the reader follow through every step of this proof. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_append" class="idref" href="#triple_append"><span class="id" title="lemma">triple_append</span></a> : <span class="id" title="keyword">∀</span> (<a id="L<sub>1</sub>:16" class="idref" href="#L<sub>1</sub>:16"><span class="id" title="binder">L<sub>1</sub></span></a> <a id="L<sub>2</sub>:17" class="idref" href="#L<sub>2</sub>:17"><span class="id" title="binder">L<sub>2</sub></span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) (<a id="p<sub>1</sub>:18" class="idref" href="#p<sub>1</sub>:18"><span class="id" title="binder">p<sub>1</sub></span></a> <a id="p<sub>2</sub>:19" class="idref" href="#p<sub>2</sub>:19"><span class="id" title="binder">p<sub>2</sub></span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="Repr.html#p<sub>1</sub>:18"><span class="id" title="variable">p<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#append"><span class="id" title="definition">append</span></a> <a class="idref" href="Repr.html#p<sub>1</sub>:18"><span class="id" title="variable">p<sub>1</sub></span></a> <a class="idref" href="Repr.html#p<sub>2</sub>:19"><span class="id" title="variable">p<sub>2</sub></span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Repr.html#L<sub>1</sub>:16"><span class="id" title="variable">L<sub>1</sub></span></a> <a class="idref" href="Repr.html#p<sub>1</sub>:18"><span class="id" title="variable">p<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Repr.html#L<sub>2</sub>:17"><span class="id" title="variable">L<sub>2</sub></span></a> <a class="idref" href="Repr.html#p<sub>2</sub>:19"><span class="id" title="variable">p<sub>2</sub></span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> (<a class="idref" href="Repr.html#L<sub>1</sub>:16"><span class="id" title="variable">L<sub>1</sub></span></a><span class="id" title="notation">++</span><a class="idref" href="Repr.html#L<sub>2</sub>:17"><span class="id" title="variable">L<sub>2</sub></span></a>) <a class="idref" href="Repr.html#p<sub>1</sub>:18"><span class="id" title="variable">p<sub>1</sub></span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
</div>

<div class="doc">
The induction principle provides an hypothesis for the tail of <span class="inlinecode"><span class="id" title="var">L<sub>1</sub></span></span>, i.e.,
    for the list <span class="inlinecode"><span class="id" title="var">L<sub>1</sub>'</span></span>, such that the relation <span class="inlinecode"><span class="id" title="var">list_sub</span></span> <span class="inlinecode"><span class="id" title="var">L<sub>1</sub>'</span></span> <span class="inlinecode"><span class="id" title="var">L<sub>1</sub></span></span> holds. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">K</span>. <span class="id" title="var">gen</span> <span class="id" title="var">p<sub>1</sub></span>. <span class="id" title="var">induction_wf</span> <span class="id" title="var">IH</span>: <span class="id" title="inductive">list_sub</span> <span class="id" title="var">L<sub>1</sub></span>. <span class="id" title="var">introv</span> <span class="id" title="var">N</span>. <span class="id" title="var">xwp</span>.<br/>
</div>

<div class="doc">
To begin the proof, we reveal the head cell of <span class="inlinecode"><span class="id" title="var">p<sub>1</sub></span></span>. We let <span class="inlinecode"><span class="id" title="var">q<sub>1</sub></span></span> denote the
    tail of <span class="inlinecode"><span class="id" title="var">p<sub>1</sub></span></span>, and <span class="inlinecode"><span class="id" title="var">L<sub>1</sub>'</span></span> the tail of <span class="inlinecode"><span class="id" title="var">L<sub>1</sub></span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="var">xchange</span> (<a class="idref" href="Repr.html#MList_if"><span class="id" title="lemma">MList_if</span></a> <span class="id" title="var">p<sub>1</sub></span>). <span class="id" title="var">case_if</span>. <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">q<sub>1</sub></span> <span class="id" title="var">L<sub>1</sub>'</span> →.<br/>
</div>

<div class="doc">
We then reason about the case analysis. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="var">xapp</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xif</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">Cq<sub>1</sub></span>.<br/>
</div>

<div class="doc">
If <span class="inlinecode"><span class="id" title="var">q<sub>1</sub>'</span></span> is null, then <span class="inlinecode"><span class="id" title="var">L<sub>1</sub>'</span></span> is empty. 
</div>
<div class="code">
&nbsp;&nbsp;{ <span class="id" title="var">xchange</span> (<a class="idref" href="Repr.html#MList_if"><span class="id" title="lemma">MList_if</span></a> <span class="id" title="var">q<sub>1</sub></span>). <span class="id" title="var">case_if</span>. <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> →.<br/>
</div>

<div class="doc">
In this case, we set the pointer, then we fold back the head cell. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xapp</span>. <span class="id" title="var">xchange</span> &lt;- <a class="idref" href="Repr.html#MList_cons"><span class="id" title="lemma">MList_cons</span></a>. }<br/>
</div>

<div class="doc">
Otherwise, if <span class="inlinecode"><span class="id" title="var">q<sub>1</sub>'</span></span> is not null, we reason about the recursive call using
    the induction hypothesis, then we fold back the head cell. 
</div>
<div class="code">
&nbsp;&nbsp;{ <span class="id" title="var">xapp</span>. <span class="id" title="var">xchange</span> &lt;- <a class="idref" href="Repr.html#MList_cons"><span class="id" title="lemma">MList_cons</span></a>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab49"></a><h2 class="section">Smart Constructors for Linked Lists</h2>

<div class="paragraph"> </div>

 We next introduce two smart constructors for linked lists, called <span class="inlinecode"><span class="id" title="var">mnil</span></span> and
    <span class="inlinecode"><span class="id" title="var">mcons</span></span>. The operation <span class="inlinecode"><span class="id" title="var">mnil</span>()</span> creates an empty list. Its implementation
    simply returns the value <span class="inlinecode"><span class="id" title="var">null</span></span>. Its specification asserts that the return
    value is a pointer <span class="inlinecode"><span class="id" title="var">p</span></span> such that <span class="inlinecode"><span class="id" title="var">MList</span></span> <span class="inlinecode"><span class="id" title="var">nil</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> holds. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="mnil" class="idref" href="#mnil"><span class="id" title="definition">mnil</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''u'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''u'"><span class="id" title="notation">u</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="triple_mnil" class="idref" href="#triple_mnil"><span class="id" title="lemma">triple_mnil</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#mnil"><span class="id" title="definition">mnil</span></a> <a class="idref" href="LibSepReference.html#3127c6bc552ca21a494fc6e3474a507d"><span class="id" title="notation">()</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Basic.html#41749fe005eef2f7f0316a63bdabe5a<sub>8</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:20" class="idref" href="#p:20"><span class="id" title="binder">p</span></a> <a class="idref" href="Basic.html#41749fe005eef2f7f0316a63bdabe5a<sub>8</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="Repr.html#p:20"><span class="id" title="variable">p</span></a>).<br/>
</div>

<div class="doc">
The proof uses the tactic <span class="inlinecode"><span class="id" title="var">xchanges</span>*</span>, which is a shorthand for <span class="inlinecode"><span class="id" title="var">xchange</span></span>
    followed with <span class="inlinecode"><span class="id" title="var">xsimpl</span>*</span>. 
</div>
<div class="code">
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">xwp</span>. <span class="id" title="var">xval</span>. <span class="id" title="var">xchanges</span>* &lt;- (<a class="idref" href="Repr.html#MList_nil"><span class="id" title="lemma">MList_nil</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a>). <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">triple_mnil</span> : <span class="id" title="var">triple</span>.<br/>
</div>

<div class="doc">
Observe that the specification <span class="inlinecode"><span class="id" title="var">triple_mnil</span></span> does not mention the <span class="inlinecode"><span class="id" title="var">null</span></span>
    pointer anywhere. This specification may thus be used to specify the
    behavior of operations on mutable lists without having to reveal low-level
    implementation details that involve the <span class="inlinecode"><span class="id" title="var">null</span></span> pointer. 
<div class="paragraph"> </div>

 The operation <span class="inlinecode"><span class="id" title="var">mcons</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">q</span></span> creates a fresh list cell, with <span class="inlinecode"><span class="id" title="var">x</span></span> in the head
    field and <span class="inlinecode"><span class="id" title="var">q</span></span> in the tail field. Its implementation allocates and
    initializes a fresh record made of two fields. The allocation operation
    leverages the allocation construct written <span class="inlinecode">`{</span> <span class="inlinecode"><span class="id" title="var">head</span></span> <span class="inlinecode">:=</span> <span class="inlinecode">'<span class="id" title="var">x</span>;</span> <span class="inlinecode"><span class="id" title="var">tail</span></span> <span class="inlinecode">:=</span> <span class="inlinecode">'<span class="id" title="var">q</span></span> <span class="inlinecode">}</span> in
    the code. This construct is in fact a notation for an operation called
    <span class="inlinecode"><span class="id" title="var">val_new_hrecord_2</span></span>, which we here view as a primitive operation. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="mcons" class="idref" href="#mcons"><span class="id" title="definition">mcons</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#938475157e31b8b3433e07bd510fd74f"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">x</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">q</span></a> <a class="idref" href="LibSepReference.html#938475157e31b8b3433e07bd510fd74f"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#af0cd7a27fb992cad1a6aae30c4dc671"><span class="id" title="notation">`{</span></a> <a class="idref" href="Repr.html#head"><span class="id" title="definition">head</span></a> <a class="idref" href="LibSepReference.html#af0cd7a27fb992cad1a6aae30c4dc671"><span class="id" title="notation">:=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">x</span></a><a class="idref" href="LibSepReference.html#af0cd7a27fb992cad1a6aae30c4dc671"><span class="id" title="notation">;</span></a> <a class="idref" href="Repr.html#tail"><span class="id" title="definition">tail</span></a> <a class="idref" href="LibSepReference.html#af0cd7a27fb992cad1a6aae30c4dc671"><span class="id" title="notation">:=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">q</span></a> <a class="idref" href="LibSepReference.html#af0cd7a27fb992cad1a6aae30c4dc671"><span class="id" title="notation">}</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
The operation <span class="inlinecode"><span class="id" title="var">mcons</span></span> admits two specifications. The first one describes
    only the production of a heap predicate for the freshly allocated record. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_mcons" class="idref" href="#triple_mcons"><span class="id" title="lemma">triple_mcons</span></a> : <span class="id" title="keyword">∀</span> <a id="x:21" class="idref" href="#x:21"><span class="id" title="binder">x</span></a> <a id="q:22" class="idref" href="#q:22"><span class="id" title="binder">q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#mcons"><span class="id" title="definition">mcons</span></a> <a class="idref" href="Repr.html#x:21"><span class="id" title="variable">x</span></a> <a class="idref" href="Repr.html#q:22"><span class="id" title="variable">q</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Basic.html#41749fe005eef2f7f0316a63bdabe5a<sub>8</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:23" class="idref" href="#p:23"><span class="id" title="binder">p</span></a> <a class="idref" href="Basic.html#41749fe005eef2f7f0316a63bdabe5a<sub>8</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Repr.html#p:23"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#3a1f4def71aa7ea77c87b41e2bd7edb0"><span class="id" title="notation">~~~&gt;</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">`{</span></a> <a class="idref" href="Repr.html#head"><span class="id" title="definition">head</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Repr.html#x:21"><span class="id" title="variable">x</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Repr.html#tail"><span class="id" title="definition">tail</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Repr.html#q:22"><span class="id" title="variable">q</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">}</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">xwp</span>. <span class="id" title="var">xapp</span> <a class="idref" href="LibSepReference.html#triple_new_hrecord_2"><span class="id" title="axiom">triple_new_hrecord_2</span></a>; <span class="id" title="tactic">auto</span>. <span class="id" title="var">xsimpl</span>*. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The second specification assumes that the argument <span class="inlinecode"><span class="id" title="var">q</span></span> comes with a list
    representation of the form <span class="inlinecode"><span class="id" title="var">Mlist</span></span> <span class="inlinecode"><span class="id" title="var">q</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span>, and it specifies that the function
    <span class="inlinecode"><span class="id" title="var">mcons</span></span> produces the representation predicate <span class="inlinecode"><span class="id" title="var">Mlist</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">(<span class="id" title="var">x</span>::<span class="id" title="var">L</span>)</span>. This second
    specification is derivable from the first one, by folding the representation
    predicate <span class="inlinecode"><span class="id" title="var">MList</span></span> using the tactic <span class="inlinecode"><span class="id" title="var">xchange</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_mcons'" class="idref" href="#triple_mcons'"><span class="id" title="lemma">triple_mcons'</span></a> : <span class="id" title="keyword">∀</span> <a id="L:24" class="idref" href="#L:24"><span class="id" title="binder">L</span></a> <a id="x:25" class="idref" href="#x:25"><span class="id" title="binder">x</span></a> <a id="q:26" class="idref" href="#q:26"><span class="id" title="binder">q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#mcons"><span class="id" title="definition">mcons</span></a> <a class="idref" href="Repr.html#x:25"><span class="id" title="variable">x</span></a> <a class="idref" href="Repr.html#q:26"><span class="id" title="variable">q</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Repr.html#L:24"><span class="id" title="variable">L</span></a> <a class="idref" href="Repr.html#q:26"><span class="id" title="variable">q</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Basic.html#41749fe005eef2f7f0316a63bdabe5a<sub>8</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:27" class="idref" href="#p:27"><span class="id" title="binder">p</span></a> <a class="idref" href="Basic.html#41749fe005eef2f7f0316a63bdabe5a<sub>8</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> (<a class="idref" href="Repr.html#x:25"><span class="id" title="variable">x</span></a><span class="id" title="notation">::</span><a class="idref" href="Repr.html#L:24"><span class="id" title="variable">L</span></a>) <a class="idref" href="Repr.html#p:27"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">xapp</span> <a class="idref" href="Repr.html#triple_mcons"><span class="id" title="lemma">triple_mcons</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">p</span>. <span class="id" title="var">xchange</span> &lt;- <a class="idref" href="Repr.html#MList_cons"><span class="id" title="lemma">MList_cons</span></a>. <span class="id" title="var">xsimpl</span>*.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
In practice, this second specification is more often useful than the first
    one, hence we register it in the database for <span class="inlinecode"><span class="id" title="var">xapp</span></span>. It remains possible to
    invoke <span class="inlinecode"><span class="id" title="var">xapp</span></span> <span class="inlinecode"><span class="id" title="var">triple_mcons</span></span> for exploiting the first specification, where
    needed. 
</div>
<div class="code">

<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">triple_mcons'</span> : <span class="id" title="var">triple</span>.<br/>
</div>

<div class="doc">
<a id="lab50"></a><h2 class="section">Copy Function for Lists</h2>

<div class="paragraph"> </div>

 The function <span class="inlinecode"><span class="id" title="var">mcopy</span></span> takes a mutable linked list and builds an independent
    copy of it, with help of the functions <span class="inlinecode"><span class="id" title="var">mnil</span></span> and <span class="inlinecode"><span class="id" title="var">mcons</span></span>.

<div class="paragraph"> </div>

<span class="inlinecode-ocaml">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="keyword">rec</span> <span class="id" title="var">mcopy</span> <span class="id" title="var">p</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">p</span> == <span class="id" title="var">null</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">mnil</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">mcons</span> (<span class="id" title="var">p.head</span>) (<span class="id" title="var">mcopy</span> <span class="id" title="var">p.tail</span>)
</span>
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="mcopy" class="idref" href="#mcopy"><span class="id" title="definition">mcopy</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#7809db93a49fc4341c1251bb4de79a<sub>62</sub>"><span class="id" title="notation">fix</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#7809db93a49fc4341c1251bb4de79a<sub>62</sub>"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#3fbef795df792463de2da5f563e20424"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a><a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="Repr.html#mnil"><span class="id" title="definition">mnil</span></a> <a class="idref" href="LibSepReference.html#71337baa9b3f1f61552031a8e9cb9237"><span class="id" title="notation">()</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">x</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="LibSepReference.html#8e45340a54d108624916002b0e01c7ee"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#head"><span class="id" title="definition">head</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">q</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="LibSepReference.html#8e45340a54d108624916002b0e01c7ee"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#tail"><span class="id" title="definition">tail</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q<sub>2</sub>'"><span class="id" title="notation">q<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">q</span></a><a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Repr.html#mcons"><span class="id" title="definition">mcons</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">x</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q<sub>2</sub>'"><span class="id" title="notation">q<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
The precondition of <span class="inlinecode"><span class="id" title="var">mcopy</span></span> requires a linked list described as <span class="inlinecode"><span class="id" title="var">MList</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>.
    The postcondition asserts that the function returns a pointer <span class="inlinecode"><span class="id" title="var">p'</span></span> and a
    list described as <span class="inlinecode"><span class="id" title="var">MList</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p'</span></span>, in addition to the original list <span class="inlinecode"><span class="id" title="var">MList</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>
    . The two lists are totally disjoint and independent, as captured by the
    separating conjunction symbol (the star). 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_mcopy" class="idref" href="#triple_mcopy"><span class="id" title="lemma">triple_mcopy</span></a> : <span class="id" title="keyword">∀</span> <a id="L:28" class="idref" href="#L:28"><span class="id" title="binder">L</span></a> <a id="p:29" class="idref" href="#p:29"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#mcopy"><span class="id" title="definition">mcopy</span></a> <a class="idref" href="Repr.html#p:29"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Repr.html#L:28"><span class="id" title="variable">L</span></a> <a class="idref" href="Repr.html#p:29"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Basic.html#41749fe005eef2f7f0316a63bdabe5a<sub>8</sub>"><span class="id" title="notation">funloc</span></a> <a id="p':30" class="idref" href="#p':30"><span class="id" title="binder">p'</span></a> <a class="idref" href="Basic.html#41749fe005eef2f7f0316a63bdabe5a<sub>8</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Repr.html#L:28"><span class="id" title="variable">L</span></a> <a class="idref" href="Repr.html#p:29"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Repr.html#L:28"><span class="id" title="variable">L</span></a> <a class="idref" href="Repr.html#p':30"><span class="id" title="variable">p'</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>).<br/>
</div>

<div class="doc">
The proof is structure is like the previous ones. While playing the script,
    try to spot the places where:

<div class="paragraph"> </div>

<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="var">mnil</span></span> produces an empty list of the form <span class="inlinecode"><span class="id" title="var">MList</span></span> <span class="inlinecode"><span class="id" title="var">nil</span></span> <span class="inlinecode"><span class="id" title="var">p'</span></span>,

</li>
<li> the recursive call produces a list of the form <span class="inlinecode"><span class="id" title="var">MList</span></span> <span class="inlinecode"><span class="id" title="var">L'</span></span> <span class="inlinecode"><span class="id" title="var">q'</span></span>,

</li>
<li> <span class="inlinecode"><span class="id" title="var">mcons</span></span> produces a list of the form <span class="inlinecode"><span class="id" title="var">MList</span></span> <span class="inlinecode">(<span class="id" title="var">x</span>::<span class="id" title="var">L'</span>)</span> <span class="inlinecode"><span class="id" title="var">p'</span></span>.

</li>
</ul>

<div class="paragraph"> </div>


</div>
<div class="code">

<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">gen</span> <span class="id" title="var">p</span>. <span class="id" title="var">induction_wf</span> <span class="id" title="var">IH</span>: <span class="id" title="inductive">list_sub</span> <span class="id" title="var">L</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xwp</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xchange</span> <a class="idref" href="Repr.html#MList_if"><span class="id" title="lemma">MList_if</span></a>. <span class="id" title="var">xif</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">C</span>; <span class="id" title="var">case_if</span>; <span class="id" title="var">xpull</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> →. <span class="id" title="var">xapp</span>. <span class="id" title="var">xsimpl</span>*. <span class="id" title="tactic">subst</span>. <span class="id" title="var">xchange</span>* &lt;- <a class="idref" href="Repr.html#MList_nil"><span class="id" title="lemma">MList_nil</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">q</span> <span class="id" title="var">L'</span> →. <span class="id" title="var">xapp</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xapp</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">q'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xapp</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">p'</span>. <span class="id" title="var">xchange</span> &lt;- <a class="idref" href="Repr.html#MList_cons"><span class="id" title="lemma">MList_cons</span></a>. <span class="id" title="var">xsimpl</span>*. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab51"></a><h2 class="section">Length Function for Lists</h2>

<div class="paragraph"> </div>

 The function <span class="inlinecode"><span class="id" title="var">mlength</span></span> computes the length of a mutable linked list.

<div class="paragraph"> </div>

<span class="inlinecode-ocaml">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="keyword">rec</span> <span class="id" title="var">mlength</span> <span class="id" title="var">p</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">p</span> == <span class="id" title="var">null</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> 1 + <span class="id" title="var">mlength</span> <span class="id" title="var">p.tail</span>
</span>
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="mlength" class="idref" href="#mlength"><span class="id" title="definition">mlength</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#7809db93a49fc4341c1251bb4de79a<sub>62</sub>"><span class="id" title="notation">fix</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#7809db93a49fc4341c1251bb4de79a<sub>62</sub>"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#3fbef795df792463de2da5f563e20424"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a><a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">q</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="LibSepReference.html#8e45340a54d108624916002b0e01c7ee"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#tail"><span class="id" title="definition">tail</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">q</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#590da34eb63eef1c68773c655749c128"><span class="id" title="notation">+</span></a> 1<a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
<a id="lab52"></a><h4 class="section">Exercise: 3 stars, standard, especially useful (triple_mlength)</h4>
 Prove the correctness of the function <span class="inlinecode"><span class="id" title="var">mlength</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_mlength" class="idref" href="#triple_mlength"><span class="id" title="lemma">triple_mlength</span></a> : <span class="id" title="keyword">∀</span> <a id="L:31" class="idref" href="#L:31"><span class="id" title="binder">L</span></a> <a id="p:32" class="idref" href="#p:32"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#mlength"><span class="id" title="definition">mlength</span></a> <a class="idref" href="Repr.html#p:32"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Repr.html#L:31"><span class="id" title="variable">L</span></a> <a class="idref" href="Repr.html#p:32"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:33" class="idref" href="#r:33"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Repr.html#r:33"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> (<span class="id" title="definition">length</span> <a class="idref" href="Repr.html#L:31"><span class="id" title="variable">L</span></a>)<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Repr.html#L:31"><span class="id" title="variable">L</span></a> <a class="idref" href="Repr.html#p:32"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab53"></a><h2 class="section">Alternative Length Function for Lists</h2>

<div class="paragraph"> </div>

 In this section, we consider an alternative implementation of <span class="inlinecode"><span class="id" title="var">mlength</span></span> that
    uses an auxiliary reference cell, called <span class="inlinecode"><span class="id" title="var">c</span></span>, to keep track of the number of
    cells traversed so far. The list is traversed recursively, incrementing the
    contents of the reference once for every cell.

<div class="paragraph"> </div>

<span class="inlinecode-ocaml">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="keyword">rec</span> <span class="id" title="var">listacc</span> <span class="id" title="var">c</span> <span class="id" title="var">p</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">p</span> == <span class="id" title="var">null</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> (<span class="id" title="var">incr</span> <span class="id" title="var">c</span>; <span class="id" title="var">listacc</span> <span class="id" title="var">c</span> <span class="id" title="var">p.tail</span>)<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">mlength'</span> <span class="id" title="var">p</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">c</span> = <span class="id" title="var">ref</span> 0 <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">listacc</span> <span class="id" title="var">c</span> <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!<span class="id" title="var">c</span>
</span>
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="acclength" class="idref" href="#acclength"><span class="id" title="definition">acclength</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#04af5112f77d94e84bf2cc7677bd575d"><span class="id" title="notation">fix</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">c</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#04af5112f77d94e84bf2cc7677bd575d"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a><a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'end'"><span class="id" title="notation">if</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'end'"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Basic.html#incr"><span class="id" title="definition">incr</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">c</span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">q</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="LibSepReference.html#8e45340a54d108624916002b0e01c7ee"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#tail"><span class="id" title="definition">tail</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">c</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">q</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'end'"><span class="id" title="notation">end</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="mlength'" class="idref" href="#mlength'"><span class="id" title="definition">mlength'</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">c</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:'ref'"><span class="id" title="notation">ref</span></a> 0 <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Repr.html#acclength"><span class="id" title="definition">acclength</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">c</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Basic.html#get_and_free"><span class="id" title="definition">get_and_free</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">c</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
<a id="lab54"></a><h4 class="section">Exercise: 3 stars, standard, especially useful (triple_mlength')</h4>
 Prove the correctness of the function <span class="inlinecode"><span class="id" title="var">mlength'</span></span>. Hint: start by stating a
    lemma <span class="inlinecode"><span class="id" title="var">triple_acclength</span></span> expressing the specification of the recursive
    function <span class="inlinecode"><span class="id" title="var">acclength</span></span>. Make sure to generalize the appropriate variables
    before applying the well-founded induction tactic. Then, complete the proof
    of the specification <span class="inlinecode"><span class="id" title="var">triple_mlength'</span></span>, using <span class="inlinecode"><span class="id" title="var">xapp</span></span> <span class="inlinecode"><span class="id" title="var">triple_acclength</span></span> to
    reason about the call to the auxiliary function. 
</div>
<div class="code">

<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="triple_mlength'" class="idref" href="#triple_mlength'"><span class="id" title="lemma">triple_mlength'</span></a> : <span class="id" title="keyword">∀</span> <a id="L:34" class="idref" href="#L:34"><span class="id" title="binder">L</span></a> <a id="p:35" class="idref" href="#p:35"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#mlength'"><span class="id" title="definition">mlength'</span></a> <a class="idref" href="Repr.html#p:35"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Repr.html#L:34"><span class="id" title="variable">L</span></a> <a class="idref" href="Repr.html#p:35"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:36" class="idref" href="#r:36"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Repr.html#r:36"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> (<span class="id" title="definition">length</span> <a class="idref" href="Repr.html#L:34"><span class="id" title="variable">L</span></a>)<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Repr.html#L:34"><span class="id" title="variable">L</span></a> <a class="idref" href="Repr.html#p:35"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab55"></a><h2 class="section">In-Place Reversal Function for Lists</h2>

<div class="paragraph"> </div>

 The function <span class="inlinecode"><span class="id" title="var">mrev</span></span> takes as argument a pointer on a mutable list, and
    returns a pointer on the reverse list, that is, a list with elements in the
    reverse order. The cells from the input list are reused for constructing the
    output list. The operation is said to be "in place".

<div class="paragraph"> </div>

<span class="inlinecode-ocaml">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="keyword">rec</span> <span class="id" title="var">mrev_aux</span> <span class="id" title="var">p<sub>1</sub></span> <span class="id" title="var">p<sub>2</sub></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">p<sub>2</sub></span> == <span class="id" title="var">null</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">p<sub>1</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> (<span class="id" title="keyword">let</span> <span class="id" title="var">p<sub>3</sub></span> = <span class="id" title="var">p<sub>2</sub>.tail</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">p<sub>2</sub>.tail</span> &lt;- <span class="id" title="var">p<sub>1</sub></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mrev_aux</span> <span class="id" title="var">p<sub>2</sub></span> <span class="id" title="var">p<sub>3</sub></span>)<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">mrev</span> <span class="id" title="var">p</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mrev_aux</span> <span class="id" title="var">p</span> <span class="id" title="var">null</span>
</span>
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="mrev_aux" class="idref" href="#mrev_aux"><span class="id" title="definition">mrev_aux</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#04af5112f77d94e84bf2cc7677bd575d"><span class="id" title="notation">fix</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">p<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#04af5112f77d94e84bf2cc7677bd575d"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">p<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#3fbef795df792463de2da5f563e20424"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a><a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">(</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>3</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>3</sub>'"><span class="id" title="notation">p<sub>3</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">p<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#8e45340a54d108624916002b0e01c7ee"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#tail"><span class="id" title="definition">tail</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">p<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#ed9bce70f2e963efb3aa4cfc718e9949"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#tail"><span class="id" title="definition">tail</span></a> <a class="idref" href="LibSepReference.html#ed9bce70f2e963efb3aa4cfc718e9949"><span class="id" title="notation">:=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">p<sub>2</sub></span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>3</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>3</sub>'"><span class="id" title="notation">p<sub>3</sub></span></a><a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="mrev" class="idref" href="#mrev"><span class="id" title="definition">mrev</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Repr.html#mrev_aux"><span class="id" title="definition">mrev_aux</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
<a id="lab56"></a><h4 class="section">Exercise: 5 stars, standard, optional (triple_mrev)</h4>
 Prove the correctness of the functions <span class="inlinecode"><span class="id" title="var">mrev_aux</span></span> and <span class="inlinecode"><span class="id" title="var">mrev</span></span>. Hint: here
    again, start by stating a lemma <span class="inlinecode"><span class="id" title="var">mtriple_rev_aux</span></span> expressing the
    specification of the recursive function <span class="inlinecode"><span class="id" title="var">mrev_aux</span></span>. Make sure to generalize
    the appropriate variables before applying the well-founded induction tactic.
    Then, complete the proof of <span class="inlinecode"><span class="id" title="var">triple_mrev</span></span>, using <span class="inlinecode"><span class="id" title="var">xapp</span></span> <span class="inlinecode"><span class="id" title="var">triple_mrev_aux</span></span>. 
</div>
<div class="code">

<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="triple_mrev" class="idref" href="#triple_mrev"><span class="id" title="lemma">triple_mrev</span></a> : <span class="id" title="keyword">∀</span> <a id="L:37" class="idref" href="#L:37"><span class="id" title="binder">L</span></a> <a id="p:38" class="idref" href="#p:38"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#mrev"><span class="id" title="definition">mrev</span></a> <a class="idref" href="Repr.html#p:38"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Repr.html#L:37"><span class="id" title="variable">L</span></a> <a class="idref" href="Repr.html#p:38"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Basic.html#41749fe005eef2f7f0316a63bdabe5a<sub>8</sub>"><span class="id" title="notation">funloc</span></a> <a id="q:39" class="idref" href="#q:39"><span class="id" title="binder">q</span></a> <a class="idref" href="Basic.html#41749fe005eef2f7f0316a63bdabe5a<sub>8</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> (<span class="id" title="definition">rev</span> <a class="idref" href="Repr.html#L:37"><span class="id" title="variable">L</span></a>) <a class="idref" href="Repr.html#q:39"><span class="id" title="variable">q</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab57"></a><h1 class="section">More Details</h1>

</div>

<div class="doc">
<a id="lab58"></a><h2 class="section">Sized Stack</h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="SizedStack" class="idref" href="#SizedStack"><span class="id" title="module">SizedStack</span></a>.<br/>
</div>

<div class="doc">
In this section, we consider the implementation of a mutable stack featuring
    a constant-time access to the size of the stack. This stack structure
    consists of a 2-field record, storing a pointer on a mutable linked list,
    and an integer storing the length of that list. The implementation includes
    a function <span class="inlinecode"><span class="id" title="var">create</span></span> to allocate an empty stack, a function <span class="inlinecode"><span class="id" title="var">sizeof</span></span> for
    reading the size, and three functions <span class="inlinecode"><span class="id" title="var">push</span></span>, <span class="inlinecode"><span class="id" title="var">top</span></span> and <span class="inlinecode"><span class="id" title="var">pop</span></span> for operating
    at the top of the stack.

<div class="paragraph"> </div>

<span class="inlinecode-ocaml">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">type</span> '<span class="id" title="var">a</span> <span class="id" title="var">stack</span> = { <span class="id" title="var">data</span> : '<span class="id" title="var">a</span> <span class="id" title="var">list</span>; <span class="id" title="var">size</span> : <span class="id" title="var">int</span> }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">create</span> () =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">data</span> = <span class="id" title="var">nil</span>; <span class="id" title="var">size</span> = 0 }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">sizeof</span> <span class="id" title="var">s</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">s.size</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">push</span> <span class="id" title="var">p</span> <span class="id" title="var">x</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">s.data</span> &lt;- <span class="id" title="var">mcons</span> <span class="id" title="var">x</span> <span class="id" title="var">s.data</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">s.size</span> &lt;- <span class="id" title="var">s.size</span> + 1<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">top</span> <span class="id" title="var">s</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">p</span> = <span class="id" title="var">s.data</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">p.head</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">pop</span> <span class="id" title="var">s</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">p</span> = <span class="id" title="var">s.data</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">x</span> = <span class="id" title="var">p.head</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">q</span> = <span class="id" title="var">p.tail</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">delete</span> <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">s.data</span> &lt;- <span class="id" title="var">q</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">s.size</span> &lt;- <span class="id" title="var">s.size</span> - 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">x</span>
</span>
<div class="paragraph"> </div>

 The representation predicate for the stack takes the form <span class="inlinecode"><span class="id" title="var">Stack</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span>, where
    <span class="inlinecode"><span class="id" title="var">s</span></span> denotes the location of the record describing the stack, and where <span class="inlinecode"><span class="id" title="var">L</span></span>
    denotes the list of items stored in the stack. The underlying mutable list
    is described as <span class="inlinecode"><span class="id" title="var">MList</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>, where <span class="inlinecode"><span class="id" title="var">p</span></span> is the location <span class="inlinecode"><span class="id" title="var">p</span></span> stored in the
    first field of the record. The definition of <span class="inlinecode"><span class="id" title="var">Stack</span></span> is as follows. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="SizedStack.data" class="idref" href="#SizedStack.data"><span class="id" title="definition">data</span></a> : <a class="idref" href="LibSepReference.html#field"><span class="id" title="definition">field</span></a> := 0%<span class="id" title="var">nat</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="SizedStack.size" class="idref" href="#SizedStack.size"><span class="id" title="definition">size</span></a> : <a class="idref" href="LibSepReference.html#field"><span class="id" title="definition">field</span></a> := 1%<span class="id" title="var">nat</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="SizedStack.Stack" class="idref" href="#SizedStack.Stack"><span class="id" title="definition">Stack</span></a> (<a id="L:40" class="idref" href="#L:40"><span class="id" title="binder">L</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) (<a id="s:41" class="idref" href="#s:41"><span class="id" title="binder">s</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="p:42" class="idref" href="#p:42"><span class="id" title="binder">p</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Repr.html#s:41"><span class="id" title="variable">s</span></a> <a class="idref" href="LibSepReference.html#3a1f4def71aa7ea77c87b41e2bd7edb0"><span class="id" title="notation">~~~&gt;</span></a><a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">`{</span></a> <a class="idref" href="Repr.html#SizedStack.data"><span class="id" title="definition">data</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="Repr.html#p:42"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Repr.html#SizedStack.size"><span class="id" title="definition">size</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">:=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Repr.html#L:40"><span class="id" title="variable">L</span></a> <a class="idref" href="LibSepReference.html#76933079165db105f5fb332367c5f7d<sub>8</sub>"><span class="id" title="notation">}</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Repr.html#L:40"><span class="id" title="variable">L</span></a> <a class="idref" href="Repr.html#p:42"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>.<br/>
</div>

<div class="doc">
Observe that the predicate <span class="inlinecode"><span class="id" title="var">Stack</span></span> does not expose the location of the
    mutable list; this location is existentially quantified in the definition.
    The predicate <span class="inlinecode"><span class="id" title="var">Stack</span></span> also does not expose the size of the stack, as this
    value can be deduced by computing <span class="inlinecode"><span class="id" title="var">length</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span>. Let's start with the
    specification and verification of <span class="inlinecode"><span class="id" title="var">create</span></span> and <span class="inlinecode"><span class="id" title="var">sizeof</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="SizedStack.create" class="idref" href="#SizedStack.create"><span class="id" title="definition">create</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''u'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''u'"><span class="id" title="notation">u</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#af0cd7a27fb992cad1a6aae30c4dc671"><span class="id" title="notation">`{</span></a> <a class="idref" href="Repr.html#SizedStack.data"><span class="id" title="definition">data</span></a> <a class="idref" href="LibSepReference.html#af0cd7a27fb992cad1a6aae30c4dc671"><span class="id" title="notation">:=</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a><a class="idref" href="LibSepReference.html#af0cd7a27fb992cad1a6aae30c4dc671"><span class="id" title="notation">;</span></a> <a class="idref" href="Repr.html#SizedStack.size"><span class="id" title="definition">size</span></a> <a class="idref" href="LibSepReference.html#af0cd7a27fb992cad1a6aae30c4dc671"><span class="id" title="notation">:=</span></a> 0 <a class="idref" href="LibSepReference.html#af0cd7a27fb992cad1a6aae30c4dc671"><span class="id" title="notation">}</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="SizedStack.triple_create" class="idref" href="#SizedStack.triple_create"><span class="id" title="lemma">triple_create</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#SizedStack.create"><span class="id" title="definition">create</span></a> <a class="idref" href="LibSepReference.html#3127c6bc552ca21a494fc6e3474a507d"><span class="id" title="notation">()</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Basic.html#41749fe005eef2f7f0316a63bdabe5a<sub>8</sub>"><span class="id" title="notation">funloc</span></a> <a id="s:43" class="idref" href="#s:43"><span class="id" title="binder">s</span></a> <a class="idref" href="Basic.html#41749fe005eef2f7f0316a63bdabe5a<sub>8</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Repr.html#SizedStack.Stack"><span class="id" title="definition">Stack</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="Repr.html#s:43"><span class="id" title="variable">s</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xwp</span>. <span class="id" title="var">xapp</span> <a class="idref" href="LibSepReference.html#triple_new_hrecord_2"><span class="id" title="axiom">triple_new_hrecord_2</span></a>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">s</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Repr.html#SizedStack.Stack"><span class="id" title="definition">Stack</span></a>. <span class="id" title="var">xsimpl</span>*. <span class="id" title="var">xchange</span>* &lt;- (<a class="idref" href="Repr.html#MList_nil"><span class="id" title="lemma">MList_nil</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a>).<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The <span class="inlinecode"><span class="id" title="var">sizeof</span></span> operation returns the contents of the <span class="inlinecode"><span class="id" title="var">size</span></span> field of a stack.
    
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="SizedStack.sizeof" class="idref" href="#SizedStack.sizeof"><span class="id" title="definition">sizeof</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="LibSepReference.html#8e45340a54d108624916002b0e01c7ee"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#SizedStack.size"><span class="id" title="definition">size</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="SizedStack.triple_sizeof" class="idref" href="#SizedStack.triple_sizeof"><span class="id" title="lemma">triple_sizeof</span></a> : <span class="id" title="keyword">∀</span> <a id="L:44" class="idref" href="#L:44"><span class="id" title="binder">L</span></a> <a id="s:45" class="idref" href="#s:45"><span class="id" title="binder">s</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#SizedStack.sizeof"><span class="id" title="definition">sizeof</span></a> <a class="idref" href="Repr.html#s:45"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Repr.html#SizedStack.Stack"><span class="id" title="definition">Stack</span></a> <a class="idref" href="Repr.html#L:44"><span class="id" title="variable">L</span></a> <a class="idref" href="Repr.html#s:45"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:46" class="idref" href="#r:46"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Repr.html#r:46"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Repr.html#L:44"><span class="id" title="variable">L</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Repr.html#SizedStack.Stack"><span class="id" title="definition">Stack</span></a> <a class="idref" href="Repr.html#L:44"><span class="id" title="variable">L</span></a> <a class="idref" href="Repr.html#s:45"><span class="id" title="variable">s</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xwp</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Repr.html#SizedStack.Stack"><span class="id" title="definition">Stack</span></a>. <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">p</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xsimpl</span>*.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The <span class="inlinecode"><span class="id" title="var">push</span></span> operation extends the head of the list, and increments the size
    field. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="SizedStack.push" class="idref" href="#SizedStack.push"><span class="id" title="definition">push</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#938475157e31b8b3433e07bd510fd74f"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''s'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''s'"><span class="id" title="notation">s</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">x</span></a> <a class="idref" href="LibSepReference.html#938475157e31b8b3433e07bd510fd74f"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''s'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''s'"><span class="id" title="notation">s</span></a><a class="idref" href="LibSepReference.html#8e45340a54d108624916002b0e01c7ee"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#SizedStack.data"><span class="id" title="definition">data</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">p<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="Repr.html#mcons"><span class="id" title="definition">mcons</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">x</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''s'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''s'"><span class="id" title="notation">s</span></a><a class="idref" href="LibSepReference.html#ed9bce70f2e963efb3aa4cfc718e9949"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#SizedStack.data"><span class="id" title="definition">data</span></a> <a class="idref" href="LibSepReference.html#ed9bce70f2e963efb3aa4cfc718e9949"><span class="id" title="notation">:=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">p<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''s'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''s'"><span class="id" title="notation">s</span></a><a class="idref" href="LibSepReference.html#8e45340a54d108624916002b0e01c7ee"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#SizedStack.size"><span class="id" title="definition">size</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n<sub>2</sub>'"><span class="id" title="notation">n<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#590da34eb63eef1c68773c655749c128"><span class="id" title="notation">+</span></a> 1 <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''s'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''s'"><span class="id" title="notation">s</span></a><a class="idref" href="LibSepReference.html#ed9bce70f2e963efb3aa4cfc718e9949"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#SizedStack.size"><span class="id" title="definition">size</span></a> <a class="idref" href="LibSepReference.html#ed9bce70f2e963efb3aa4cfc718e9949"><span class="id" title="notation">:=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n<sub>2</sub>'"><span class="id" title="notation">n<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
<a id="lab59"></a><h4 class="section">Exercise: 3 stars, standard, especially useful (triple_push)</h4>
 Prove the following specification for the <span class="inlinecode"><span class="id" title="var">push</span></span> operation. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="SizedStack.triple_push" class="idref" href="#SizedStack.triple_push"><span class="id" title="lemma">triple_push</span></a> : <span class="id" title="keyword">∀</span> <a id="L:47" class="idref" href="#L:47"><span class="id" title="binder">L</span></a> <a id="s:48" class="idref" href="#s:48"><span class="id" title="binder">s</span></a> <a id="x:49" class="idref" href="#x:49"><span class="id" title="binder">x</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#SizedStack.push"><span class="id" title="definition">push</span></a> <a class="idref" href="Repr.html#s:48"><span class="id" title="variable">s</span></a> <a class="idref" href="Repr.html#x:49"><span class="id" title="variable">x</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Repr.html#SizedStack.Stack"><span class="id" title="definition">Stack</span></a> <a class="idref" href="Repr.html#L:47"><span class="id" title="variable">L</span></a> <a class="idref" href="Repr.html#s:48"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="u:50" class="idref" href="#u:50"><span class="id" title="binder">u</span></a> ⇒ <a class="idref" href="Repr.html#SizedStack.Stack"><span class="id" title="definition">Stack</span></a> (<a class="idref" href="Repr.html#x:49"><span class="id" title="variable">x</span></a><span class="id" title="notation">::</span><a class="idref" href="Repr.html#L:47"><span class="id" title="variable">L</span></a>) <a class="idref" href="Repr.html#s:48"><span class="id" title="variable">s</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 The <span class="inlinecode"><span class="id" title="var">pop</span></span> operation extracts the element at the head of the list, updates
    the <span class="inlinecode"><span class="id" title="var">data</span></span> field to the tail of the list, and decrements the size field. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="SizedStack.pop" class="idref" href="#SizedStack.pop"><span class="id" title="definition">pop</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''s'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''s'"><span class="id" title="notation">s</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''s'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''s'"><span class="id" title="notation">s</span></a><a class="idref" href="LibSepReference.html#8e45340a54d108624916002b0e01c7ee"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#SizedStack.data"><span class="id" title="definition">data</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">x</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="LibSepReference.html#8e45340a54d108624916002b0e01c7ee"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#head"><span class="id" title="definition">head</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">p<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="LibSepReference.html#8e45340a54d108624916002b0e01c7ee"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#tail"><span class="id" title="definition">tail</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'delete'"><span class="id" title="notation">delete</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''s'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''s'"><span class="id" title="notation">s</span></a><a class="idref" href="LibSepReference.html#ed9bce70f2e963efb3aa4cfc718e9949"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#SizedStack.data"><span class="id" title="definition">data</span></a> <a class="idref" href="LibSepReference.html#ed9bce70f2e963efb3aa4cfc718e9949"><span class="id" title="notation">:=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">p<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''s'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''s'"><span class="id" title="notation">s</span></a><a class="idref" href="LibSepReference.html#8e45340a54d108624916002b0e01c7ee"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#SizedStack.size"><span class="id" title="definition">size</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n<sub>2</sub>'"><span class="id" title="notation">n<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1 <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''s'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''s'"><span class="id" title="notation">s</span></a><a class="idref" href="LibSepReference.html#ed9bce70f2e963efb3aa4cfc718e9949"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#SizedStack.size"><span class="id" title="definition">size</span></a> <a class="idref" href="LibSepReference.html#ed9bce70f2e963efb3aa4cfc718e9949"><span class="id" title="notation">:=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n<sub>2</sub>'"><span class="id" title="notation">n<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">x</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
<a id="lab60"></a><h4 class="section">Exercise: 4 stars, standard, especially useful (triple_pop)</h4>
 Prove the following specification for the <span class="inlinecode"><span class="id" title="var">pop</span></span> operation. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="SizedStack.triple_pop" class="idref" href="#SizedStack.triple_pop"><span class="id" title="lemma">triple_pop</span></a> : <span class="id" title="keyword">∀</span> <a id="L:51" class="idref" href="#L:51"><span class="id" title="binder">L</span></a> <a id="s:52" class="idref" href="#s:52"><span class="id" title="binder">s</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Repr.html#L:51"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#SizedStack.pop"><span class="id" title="definition">pop</span></a> <a class="idref" href="Repr.html#s:52"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Repr.html#SizedStack.Stack"><span class="id" title="definition">Stack</span></a> <a class="idref" href="Repr.html#L:51"><span class="id" title="variable">L</span></a> <a class="idref" href="Repr.html#s:52"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="x:53" class="idref" href="#x:53"><span class="id" title="binder">x</span></a> ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="L':54" class="idref" href="#L':54"><span class="id" title="binder">L'</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Repr.html#L:51"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Repr.html#x:53"><span class="id" title="variable">x</span></a><span class="id" title="notation">::</span><a class="idref" href="Repr.html#L':54"><span class="id" title="variable">L'</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Repr.html#SizedStack.Stack"><span class="id" title="definition">Stack</span></a> <a class="idref" href="Repr.html#L':54"><span class="id" title="variable">L'</span></a> <a class="idref" href="Repr.html#s:52"><span class="id" title="variable">s</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 The <span class="inlinecode"><span class="id" title="var">top</span></span> operation extracts the element at the head of the list. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="SizedStack.top" class="idref" href="#SizedStack.top"><span class="id" title="definition">top</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''s'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''s'"><span class="id" title="notation">s</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''s'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''s'"><span class="id" title="notation">s</span></a><a class="idref" href="LibSepReference.html#8e45340a54d108624916002b0e01c7ee"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#SizedStack.data"><span class="id" title="definition">data</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="LibSepReference.html#8e45340a54d108624916002b0e01c7ee"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#head"><span class="id" title="definition">head</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
<a id="lab61"></a><h4 class="section">Exercise: 2 stars, standard, optional (triple_top)</h4>
 Prove the following specification for the <span class="inlinecode"><span class="id" title="var">top</span></span> operation. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="SizedStack.triple_top" class="idref" href="#SizedStack.triple_top"><span class="id" title="lemma">triple_top</span></a> : <span class="id" title="keyword">∀</span> <a id="L:55" class="idref" href="#L:55"><span class="id" title="binder">L</span></a> <a id="s:56" class="idref" href="#s:56"><span class="id" title="binder">s</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Repr.html#L:55"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#SizedStack.top"><span class="id" title="definition">top</span></a> <a class="idref" href="Repr.html#s:56"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Repr.html#SizedStack.Stack"><span class="id" title="definition">Stack</span></a> <a class="idref" href="Repr.html#L:55"><span class="id" title="variable">L</span></a> <a class="idref" href="Repr.html#s:56"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="x:57" class="idref" href="#x:57"><span class="id" title="binder">x</span></a> ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="L':58" class="idref" href="#L':58"><span class="id" title="binder">L'</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Repr.html#L:55"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Repr.html#x:57"><span class="id" title="variable">x</span></a><span class="id" title="notation">::</span><a class="idref" href="Repr.html#L':58"><span class="id" title="variable">L'</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Repr.html#SizedStack.Stack"><span class="id" title="definition">Stack</span></a> <a class="idref" href="Repr.html#L:55"><span class="id" title="variable">L</span></a> <a class="idref" href="Repr.html#s:56"><span class="id" title="variable">s</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<span class="id" title="keyword">End</span> <a class="idref" href="Repr.html#SizedStack"><span class="id" title="module">SizedStack</span></a>.<br/>
</div>

<div class="doc">
<a id="lab62"></a><h2 class="section">Formalization of the Tree Representation Predicate</h2>

<div class="paragraph"> </div>

 In this section, we generalize the ideas presented for linked lists to
    binary trees. For simplicity, let us consider binary trees that store
    integer values in the nodes. Just like mutable lists are specified with
    respect to Coq's purely functional lists, mutable binary trees are specified
    with respect to Coq trees. Consider the following inductive definition of
    the type <span class="inlinecode"><span class="id" title="var">tree</span></span>. A leaf is represented by the constructor <span class="inlinecode"><span class="id" title="var">Leaf</span></span>, and a node
    takes the form <span class="inlinecode"><span class="id" title="var">Node</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">T<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">T<sub>2</sub></span></span>, where <span class="inlinecode"><span class="id" title="var">n</span></span> is an integer and <span class="inlinecode"><span class="id" title="var">T<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">T<sub>2</sub></span></span>
    denote the two subtrees. 
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <a id="tree" class="idref" href="#tree"><span class="id" title="inductive">tree</span></a> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <a id="Leaf" class="idref" href="#Leaf"><span class="id" title="constructor">Leaf</span></a> : <a class="idref" href="Repr.html#tree:59"><span class="id" title="inductive">tree</span></a><br/>
&nbsp;&nbsp;| <a id="Node" class="idref" href="#Node"><span class="id" title="constructor">Node</span></a> : <span class="id" title="notation">int</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Repr.html#tree:59"><span class="id" title="inductive">tree</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Repr.html#tree:59"><span class="id" title="inductive">tree</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Repr.html#tree:59"><span class="id" title="inductive">tree</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">T</span> : <a class="idref" href="Repr.html#tree"><span class="id" title="inductive">tree</span></a>.<br/>
</div>

<div class="doc">
In a program manipulating a mutable tree, an empty tree is represented using
    the <span class="inlinecode"><span class="id" title="var">null</span></span> pointer, and a node is represented in memory using a three-cell
    record. The first field, named "item", stores an integer. The other two
    fields, named "left" and "right", store pointers to the left and right
    subtrees, respectively. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="item" class="idref" href="#item"><span class="id" title="definition">item</span></a> : <a class="idref" href="LibSepReference.html#field"><span class="id" title="definition">field</span></a> := 0%<span class="id" title="var">nat</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="left" class="idref" href="#left"><span class="id" title="definition">left</span></a> : <a class="idref" href="LibSepReference.html#field"><span class="id" title="definition">field</span></a> := 1%<span class="id" title="var">nat</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="right" class="idref" href="#right"><span class="id" title="definition">right</span></a> : <a class="idref" href="LibSepReference.html#field"><span class="id" title="definition">field</span></a> := 2%<span class="id" title="var">nat</span>.<br/>
</div>

<div class="doc">
The heap predicate <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~~&gt;`{</span> <span class="inlinecode"><span class="id" title="var">item</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">n</span>;</span> <span class="inlinecode"><span class="id" title="tactic">left</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">p<sub>1</sub></span>;</span> <span class="inlinecode"><span class="id" title="tactic">right</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">p<sub>2</sub></span></span> <span class="inlinecode">}</span> describes
    a record allocated at location <span class="inlinecode"><span class="id" title="var">p</span></span>, storing the integer <span class="inlinecode"><span class="id" title="var">n</span></span> and the two
    pointers <span class="inlinecode"><span class="id" title="var">p<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">p<sub>2</sub></span></span>.

<div class="paragraph"> </div>

    The representation predicate <span class="inlinecode"><span class="id" title="var">MTree</span></span> <span class="inlinecode"><span class="id" title="var">T</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>, of type <span class="inlinecode"><span class="id" title="var">hprop</span></span>, asserts that the
    mutable tree structure with root at location <span class="inlinecode"><span class="id" title="var">p</span></span> describes the logical tree
    <span class="inlinecode"><span class="id" title="var">T</span></span>. The predicate is defined recursively on the structure of <span class="inlinecode"><span class="id" title="var">T</span></span>:

<div class="paragraph"> </div>

<ul class="doclist">
<li> if <span class="inlinecode"><span class="id" title="var">T</span></span> is a <span class="inlinecode"><span class="id" title="var">Leaf</span></span>, then <span class="inlinecode"><span class="id" title="var">p</span></span> is the null pointer,

</li>
<li> if <span class="inlinecode"><span class="id" title="var">T</span></span> is a node <span class="inlinecode"><span class="id" title="var">Node</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">T<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">T<sub>2</sub></span></span>, then <span class="inlinecode"><span class="id" title="var">p</span></span> is not null, and at location
      <span class="inlinecode"><span class="id" title="var">p</span></span> one finds a record with field contents <span class="inlinecode"><span class="id" title="var">n</span></span>, <span class="inlinecode"><span class="id" title="var">p<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">p<sub>2</sub></span></span>, with
      <span class="inlinecode"><span class="id" title="var">MTree</span></span> <span class="inlinecode"><span class="id" title="var">T<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">p<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">MTree</span></span> <span class="inlinecode"><span class="id" title="var">T<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">p<sub>2</sub></span></span> describing the two subtrees. 
</li>
</ul>

</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <a id="MTree" class="idref" href="#MTree"><span class="id" title="definition">MTree</span></a> (<a id="T:61" class="idref" href="#T:61"><span class="id" title="binder">T</span></a>:<a class="idref" href="Repr.html#tree"><span class="id" title="inductive">tree</span></a>) (<a id="p:62" class="idref" href="#p:62"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Repr.html#T:61"><span class="id" title="variable">T</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Repr.html#Leaf"><span class="id" title="constructor">Leaf</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Repr.html#p:62"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Repr.html#Node"><span class="id" title="constructor">Node</span></a> <span class="id" title="var">n</span> <span class="id" title="var">T<sub>1</sub></span> <span class="id" title="var">T<sub>2</sub></span> ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="p<sub>1</sub>:65" class="idref" href="#p<sub>1</sub>:65"><span class="id" title="binder">p<sub>1</sub></span></a> <a id="p<sub>2</sub>:66" class="idref" href="#p<sub>2</sub>:66"><span class="id" title="binder">p<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#p:62"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#3a1f4def71aa7ea77c87b41e2bd7edb0"><span class="id" title="notation">~~~&gt;</span></a><a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">`{</span></a> <a class="idref" href="Repr.html#item"><span class="id" title="definition">item</span></a> <a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">:=</span></a> <span class="id" title="var">n</span><a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">;</span></a> <a class="idref" href="Repr.html#left"><span class="id" title="definition">left</span></a> <a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">:=</span></a> <a class="idref" href="Repr.html#p<sub>1</sub>:65"><span class="id" title="variable">p<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">;</span></a> <a class="idref" href="Repr.html#right"><span class="id" title="definition">right</span></a> <a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">:=</span></a> <a class="idref" href="Repr.html#p<sub>2</sub>:66"><span class="id" title="variable">p<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">}</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#MTree:63"><span class="id" title="definition">MTree</span></a> <span class="id" title="var">T<sub>1</sub></span> <a class="idref" href="Repr.html#p<sub>1</sub>:65"><span class="id" title="variable">p<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#MTree:63"><span class="id" title="definition">MTree</span></a> <span class="id" title="var">T<sub>2</sub></span> <a class="idref" href="Repr.html#p<sub>2</sub>:66"><span class="id" title="variable">p<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
<a id="lab63"></a><h2 class="section">Alternative Characterization of <span class="inlinecode"><span class="id" title="var">MTree</span></span></h2>

<div class="paragraph"> </div>

 Just like for <span class="inlinecode"><span class="id" title="var">MList</span></span>, it is very useful for proofs to state three lemmas
    that paraphrase the definition of <span class="inlinecode"><span class="id" title="var">MTree</span></span>. The first two lemmas correspond
    to the folding/unfolding rules for leaves and nodes. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="MTree_Leaf" class="idref" href="#MTree_Leaf"><span class="id" title="lemma">MTree_Leaf</span></a> : <span class="id" title="keyword">∀</span> <a id="p:67" class="idref" href="#p:67"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#MTree"><span class="id" title="definition">MTree</span></a> <a class="idref" href="Repr.html#Leaf"><span class="id" title="constructor">Leaf</span></a> <a class="idref" href="Repr.html#p:67"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Repr.html#p:67"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="MTree_Node" class="idref" href="#MTree_Node"><span class="id" title="lemma">MTree_Node</span></a> : <span class="id" title="keyword">∀</span> <a id="p:68" class="idref" href="#p:68"><span class="id" title="binder">p</span></a> <a id="n:69" class="idref" href="#n:69"><span class="id" title="binder">n</span></a> <a id="T<sub>1</sub>:70" class="idref" href="#T<sub>1</sub>:70"><span class="id" title="binder">T<sub>1</sub></span></a> <a id="T<sub>2</sub>:71" class="idref" href="#T<sub>2</sub>:71"><span class="id" title="binder">T<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#MTree"><span class="id" title="definition">MTree</span></a> (<a class="idref" href="Repr.html#Node"><span class="id" title="constructor">Node</span></a> <a class="idref" href="Repr.html#n:69"><span class="id" title="variable">n</span></a> <a class="idref" href="Repr.html#T<sub>1</sub>:70"><span class="id" title="variable">T<sub>1</sub></span></a> <a class="idref" href="Repr.html#T<sub>2</sub>:71"><span class="id" title="variable">T<sub>2</sub></span></a>) <a class="idref" href="Repr.html#p:68"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="p<sub>1</sub>:72" class="idref" href="#p<sub>1</sub>:72"><span class="id" title="binder">p<sub>1</sub></span></a> <a id="p<sub>2</sub>:73" class="idref" href="#p<sub>2</sub>:73"><span class="id" title="binder">p<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#p:68"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#3a1f4def71aa7ea77c87b41e2bd7edb0"><span class="id" title="notation">~~~&gt;</span></a><a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">`{</span></a> <a class="idref" href="Repr.html#item"><span class="id" title="definition">item</span></a> <a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">:=</span></a> <a class="idref" href="Repr.html#n:69"><span class="id" title="variable">n</span></a><a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">;</span></a> <a class="idref" href="Repr.html#left"><span class="id" title="definition">left</span></a> <a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">:=</span></a> <a class="idref" href="Repr.html#p<sub>1</sub>:72"><span class="id" title="variable">p<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">;</span></a> <a class="idref" href="Repr.html#right"><span class="id" title="definition">right</span></a> <a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">:=</span></a> <a class="idref" href="Repr.html#p<sub>2</sub>:73"><span class="id" title="variable">p<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">}</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#MTree"><span class="id" title="definition">MTree</span></a> <a class="idref" href="Repr.html#T<sub>1</sub>:70"><span class="id" title="variable">T<sub>1</sub></span></a> <a class="idref" href="Repr.html#p<sub>1</sub>:72"><span class="id" title="variable">p<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#MTree"><span class="id" title="definition">MTree</span></a> <a class="idref" href="Repr.html#T<sub>2</sub>:71"><span class="id" title="variable">T<sub>2</sub></span></a> <a class="idref" href="Repr.html#p<sub>2</sub>:73"><span class="id" title="variable">p<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The third lemma reformulates <span class="inlinecode"><span class="id" title="var">MTree</span></span> <span class="inlinecode"><span class="id" title="var">T</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> using a case analysis on whether
    <span class="inlinecode"><span class="id" title="var">p</span></span> is the null pointer. This formulation matches the case analysis
    typically perform in the code of functions that operates on trees. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="MTree_if" class="idref" href="#MTree_if"><span class="id" title="lemma">MTree_if</span></a> : <span class="id" title="keyword">∀</span> (<a id="p:74" class="idref" href="#p:74"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) (<a id="T:75" class="idref" href="#T:75"><span class="id" title="binder">T</span></a>:<a class="idref" href="Repr.html#tree"><span class="id" title="inductive">tree</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#MTree"><span class="id" title="definition">MTree</span></a> <a class="idref" href="Repr.html#T:75"><span class="id" title="variable">T</span></a> <a class="idref" href="Repr.html#p:74"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><span class="id" title="notation">If</span> <a class="idref" href="Repr.html#p:74"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">then</span> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Repr.html#T:75"><span class="id" title="variable">T</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Repr.html#Leaf"><span class="id" title="constructor">Leaf</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">else</span> <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="n:76" class="idref" href="#n:76"><span class="id" title="binder">n</span></a> <a id="p<sub>1</sub>:77" class="idref" href="#p<sub>1</sub>:77"><span class="id" title="binder">p<sub>1</sub></span></a> <a id="p<sub>2</sub>:78" class="idref" href="#p<sub>2</sub>:78"><span class="id" title="binder">p<sub>2</sub></span></a> <a id="T<sub>1</sub>:79" class="idref" href="#T<sub>1</sub>:79"><span class="id" title="binder">T<sub>1</sub></span></a> <a id="T<sub>2</sub>:80" class="idref" href="#T<sub>2</sub>:80"><span class="id" title="binder">T<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Repr.html#T:75"><span class="id" title="variable">T</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Repr.html#Node"><span class="id" title="constructor">Node</span></a> <a class="idref" href="Repr.html#n:76"><span class="id" title="variable">n</span></a> <a class="idref" href="Repr.html#T<sub>1</sub>:79"><span class="id" title="variable">T<sub>1</sub></span></a> <a class="idref" href="Repr.html#T<sub>2</sub>:80"><span class="id" title="variable">T<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#p:74"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#3a1f4def71aa7ea77c87b41e2bd7edb0"><span class="id" title="notation">~~~&gt;</span></a><a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">`{</span></a> <a class="idref" href="Repr.html#item"><span class="id" title="definition">item</span></a> <a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">:=</span></a> <a class="idref" href="Repr.html#n:76"><span class="id" title="variable">n</span></a><a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">;</span></a> <a class="idref" href="Repr.html#left"><span class="id" title="definition">left</span></a> <a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">:=</span></a> <a class="idref" href="Repr.html#p<sub>1</sub>:77"><span class="id" title="variable">p<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">;</span></a> <a class="idref" href="Repr.html#right"><span class="id" title="definition">right</span></a> <a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">:=</span></a> <a class="idref" href="Repr.html#p<sub>2</sub>:78"><span class="id" title="variable">p<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">}</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#MTree"><span class="id" title="definition">MTree</span></a> <a class="idref" href="Repr.html#T<sub>1</sub>:79"><span class="id" title="variable">T<sub>1</sub></span></a> <a class="idref" href="Repr.html#p<sub>1</sub>:77"><span class="id" title="variable">p<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#MTree"><span class="id" title="definition">MTree</span></a> <a class="idref" href="Repr.html#T<sub>2</sub>:80"><span class="id" title="variable">T<sub>2</sub></span></a> <a class="idref" href="Repr.html#p<sub>2</sub>:78"><span class="id" title="variable">p<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">T</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">n</span> <span class="id" title="var">T<sub>1</sub></span> <span class="id" title="var">T<sub>2</sub></span>].<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xchange</span> <a class="idref" href="Repr.html#MTree_Leaf"><span class="id" title="lemma">MTree_Leaf</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">M</span>. <span class="id" title="var">case_if</span>. <span class="id" title="var">xsimpl</span>*. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xchange</span> <a class="idref" href="Repr.html#MTree_Node"><span class="id" title="lemma">MTree_Node</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">p<sub>1</sub></span> <span class="id" title="var">p<sub>2</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xchange</span> <a class="idref" href="LibSepReference.html#hrecord_not_null"><span class="id" title="axiom">hrecord_not_null</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">N</span>. <span class="id" title="var">case_if</span>. <span class="id" title="var">xsimpl</span>*. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Opaque</span> <a class="idref" href="Repr.html#MTree"><span class="id" title="definition">MTree</span></a>.<br/>
</div>

<div class="doc">
<a id="lab64"></a><h2 class="section">Additional Tooling for <span class="inlinecode"><span class="id" title="var">MTree</span></span></h2>

<div class="paragraph"> </div>

 For reasoning about recursive functions over trees, it is useful to exploit
    the well-founded order associated with "immediate subtrees". Concretely,
    <span class="inlinecode"><span class="id" title="var">tree_sub</span></span> <span class="inlinecode"><span class="id" title="var">T<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">T</span></span> asserts that the tree <span class="inlinecode"><span class="id" title="var">T<sub>1</sub></span></span> is either the left or the right
    subtree of the tree <span class="inlinecode"><span class="id" title="var">T</span></span>. This order may be exploited for verifying recursive
    functions over trees using the tactic <span class="inlinecode"><span class="id" title="var">induction_wf</span></span> <span class="inlinecode"><span class="id" title="var">IH</span>:</span> <span class="inlinecode"><span class="id" title="var">tree_sub</span></span> <span class="inlinecode"><span class="id" title="var">T</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <a id="tree_sub" class="idref" href="#tree_sub"><span class="id" title="inductive">tree_sub</span></a> : <span class="id" title="definition">binary</span> (<a class="idref" href="Repr.html#tree"><span class="id" title="inductive">tree</span></a>) :=<br/>
&nbsp;&nbsp;| <a id="tree_sub_1" class="idref" href="#tree_sub_1"><span class="id" title="constructor">tree_sub_1</span></a> : <span class="id" title="keyword">∀</span> <a id="n:83" class="idref" href="#n:83"><span class="id" title="binder">n</span></a> <a id="T<sub>1</sub>:84" class="idref" href="#T<sub>1</sub>:84"><span class="id" title="binder">T<sub>1</sub></span></a> <a id="T<sub>2</sub>:85" class="idref" href="#T<sub>2</sub>:85"><span class="id" title="binder">T<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Repr.html#tree_sub:81"><span class="id" title="inductive">tree_sub</span></a> <a class="idref" href="Repr.html#T<sub>1</sub>:84"><span class="id" title="variable">T<sub>1</sub></span></a> (<a class="idref" href="Repr.html#Node"><span class="id" title="constructor">Node</span></a> <a class="idref" href="Repr.html#n:83"><span class="id" title="variable">n</span></a> <a class="idref" href="Repr.html#T<sub>1</sub>:84"><span class="id" title="variable">T<sub>1</sub></span></a> <a class="idref" href="Repr.html#T<sub>2</sub>:85"><span class="id" title="variable">T<sub>2</sub></span></a>)<br/>
&nbsp;&nbsp;| <a id="tree_sub_2" class="idref" href="#tree_sub_2"><span class="id" title="constructor">tree_sub_2</span></a> : <span class="id" title="keyword">∀</span> <a id="n:86" class="idref" href="#n:86"><span class="id" title="binder">n</span></a> <a id="T<sub>1</sub>:87" class="idref" href="#T<sub>1</sub>:87"><span class="id" title="binder">T<sub>1</sub></span></a> <a id="T<sub>2</sub>:88" class="idref" href="#T<sub>2</sub>:88"><span class="id" title="binder">T<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Repr.html#tree_sub:81"><span class="id" title="inductive">tree_sub</span></a> <a class="idref" href="Repr.html#T<sub>2</sub>:88"><span class="id" title="variable">T<sub>2</sub></span></a> (<a class="idref" href="Repr.html#Node"><span class="id" title="constructor">Node</span></a> <a class="idref" href="Repr.html#n:86"><span class="id" title="variable">n</span></a> <a class="idref" href="Repr.html#T<sub>1</sub>:87"><span class="id" title="variable">T<sub>1</sub></span></a> <a class="idref" href="Repr.html#T<sub>2</sub>:88"><span class="id" title="variable">T<sub>2</sub></span></a>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="tree_sub_wf" class="idref" href="#tree_sub_wf"><span class="id" title="lemma">tree_sub_wf</span></a> : <span class="id" title="definition">wf</span> <a class="idref" href="Repr.html#tree_sub"><span class="id" title="inductive">tree_sub</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">T</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">T</span>; <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">t'</span> <span class="id" title="var">H</span>; <span class="id" title="var">inversions</span>¬<span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">tree_sub_wf</span> : <span class="id" title="keyword">wf</span>.<br/>
</div>

<div class="doc">
For allocating fresh tree nodes as a 3-field record, we introduce the
    operation <span class="inlinecode"><span class="id" title="var">mnode</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">p<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">p<sub>2</sub></span></span>, defined and specified as follows. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="mnode" class="idref" href="#mnode"><span class="id" title="definition">mnode</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#val_new_hrecord_3"><span class="id" title="axiom">val_new_hrecord_3</span></a> <a class="idref" href="Repr.html#item"><span class="id" title="definition">item</span></a> <a class="idref" href="Repr.html#left"><span class="id" title="definition">left</span></a> <a class="idref" href="Repr.html#right"><span class="id" title="definition">right</span></a>.<br/>
</div>

<div class="doc">
A first specification of <span class="inlinecode"><span class="id" title="var">mnode</span></span> describes the allocation of a record. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_mnode" class="idref" href="#triple_mnode"><span class="id" title="lemma">triple_mnode</span></a> : <span class="id" title="keyword">∀</span> <a id="n:89" class="idref" href="#n:89"><span class="id" title="binder">n</span></a> <a id="p<sub>1</sub>:90" class="idref" href="#p<sub>1</sub>:90"><span class="id" title="binder">p<sub>1</sub></span></a> <a id="p<sub>2</sub>:91" class="idref" href="#p<sub>2</sub>:91"><span class="id" title="binder">p<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#mnode"><span class="id" title="definition">mnode</span></a> <a class="idref" href="Repr.html#n:89"><span class="id" title="variable">n</span></a> <a class="idref" href="Repr.html#p<sub>1</sub>:90"><span class="id" title="variable">p<sub>1</sub></span></a> <a class="idref" href="Repr.html#p<sub>2</sub>:91"><span class="id" title="variable">p<sub>2</sub></span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Basic.html#41749fe005eef2f7f0316a63bdabe5a<sub>8</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:92" class="idref" href="#p:92"><span class="id" title="binder">p</span></a> <a class="idref" href="Basic.html#41749fe005eef2f7f0316a63bdabe5a<sub>8</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Repr.html#p:92"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#3a1f4def71aa7ea77c87b41e2bd7edb0"><span class="id" title="notation">~~~&gt;</span></a> <a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">`{</span></a> <a class="idref" href="Repr.html#item"><span class="id" title="definition">item</span></a> <a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">:=</span></a> <a class="idref" href="Repr.html#n:89"><span class="id" title="variable">n</span></a> <a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">;</span></a> <a class="idref" href="Repr.html#left"><span class="id" title="definition">left</span></a> <a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">:=</span></a> <a class="idref" href="Repr.html#p<sub>1</sub>:90"><span class="id" title="variable">p<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">;</span></a> <a class="idref" href="Repr.html#right"><span class="id" title="definition">right</span></a> <a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">:=</span></a> <a class="idref" href="Repr.html#p<sub>2</sub>:91"><span class="id" title="variable">p<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#012f9b2134e94c33afbef326b7f96606"><span class="id" title="notation">}</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#triple_new_hrecord_3"><span class="id" title="axiom">triple_new_hrecord_3</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
A second specification, derived from the first, asserts that, if provided
    the description of two subtrees <span class="inlinecode"><span class="id" title="var">T<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">T<sub>2</sub></span></span> at locations <span class="inlinecode"><span class="id" title="var">p<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">p<sub>2</sub></span></span>,
    the operation <span class="inlinecode"><span class="id" title="var">mnode</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">p<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">p<sub>2</sub></span></span> builds, at a fresh location <span class="inlinecode"><span class="id" title="var">p</span></span>, a tree
    described by <span class="inlinecode"><span class="id" title="var">Mtree</span></span> <span class="inlinecode">[<span class="id" title="var">Node</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">T<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">T<sub>2</sub></span>]</span> <span class="inlinecode"><span class="id" title="var">p</span></span>. Compared with the first
    specification, this second specification is said to perform "ownership
    transfer". 
<div class="paragraph"> </div>

<a id="lab65"></a><h4 class="section">Exercise: 2 stars, standard, optional (triple_mnode')</h4>
 Prove the specification <span class="inlinecode"><span class="id" title="var">triple_mnode'</span></span> for node allocation. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_mnode'" class="idref" href="#triple_mnode'"><span class="id" title="lemma">triple_mnode'</span></a> : <span class="id" title="keyword">∀</span> <a id="T<sub>1</sub>:93" class="idref" href="#T<sub>1</sub>:93"><span class="id" title="binder">T<sub>1</sub></span></a> <a id="T<sub>2</sub>:94" class="idref" href="#T<sub>2</sub>:94"><span class="id" title="binder">T<sub>2</sub></span></a> <a id="n:95" class="idref" href="#n:95"><span class="id" title="binder">n</span></a> <a id="p<sub>1</sub>:96" class="idref" href="#p<sub>1</sub>:96"><span class="id" title="binder">p<sub>1</sub></span></a> <a id="p<sub>2</sub>:97" class="idref" href="#p<sub>2</sub>:97"><span class="id" title="binder">p<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#mnode"><span class="id" title="definition">mnode</span></a> <a class="idref" href="Repr.html#n:95"><span class="id" title="variable">n</span></a> <a class="idref" href="Repr.html#p<sub>1</sub>:96"><span class="id" title="variable">p<sub>1</sub></span></a> <a class="idref" href="Repr.html#p<sub>2</sub>:97"><span class="id" title="variable">p<sub>2</sub></span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Repr.html#MTree"><span class="id" title="definition">MTree</span></a> <a class="idref" href="Repr.html#T<sub>1</sub>:93"><span class="id" title="variable">T<sub>1</sub></span></a> <a class="idref" href="Repr.html#p<sub>1</sub>:96"><span class="id" title="variable">p<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Repr.html#MTree"><span class="id" title="definition">MTree</span></a> <a class="idref" href="Repr.html#T<sub>2</sub>:94"><span class="id" title="variable">T<sub>2</sub></span></a> <a class="idref" href="Repr.html#p<sub>2</sub>:97"><span class="id" title="variable">p<sub>2</sub></span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Basic.html#41749fe005eef2f7f0316a63bdabe5a<sub>8</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:98" class="idref" href="#p:98"><span class="id" title="binder">p</span></a> <a class="idref" href="Basic.html#41749fe005eef2f7f0316a63bdabe5a<sub>8</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Repr.html#MTree"><span class="id" title="definition">MTree</span></a> (<a class="idref" href="Repr.html#Node"><span class="id" title="constructor">Node</span></a> <a class="idref" href="Repr.html#n:95"><span class="id" title="variable">n</span></a> <a class="idref" href="Repr.html#T<sub>1</sub>:93"><span class="id" title="variable">T<sub>1</sub></span></a> <a class="idref" href="Repr.html#T<sub>2</sub>:94"><span class="id" title="variable">T<sub>2</sub></span></a>) <a class="idref" href="Repr.html#p:98"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">triple_mnode'</span> : <span class="id" title="var">triple</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab66"></a><h2 class="section">Tree Copy</h2>

<div class="paragraph"> </div>

 The operation <span class="inlinecode"><span class="id" title="var">tree_copy</span></span> takes as argument a pointer <span class="inlinecode"><span class="id" title="var">p</span></span> on a mutable tree
    and returns a fresh copy of that tree. It is defined in a similar way to the
    function <span class="inlinecode"><span class="id" title="var">mcopy</span></span> for lists.

<div class="paragraph"> </div>

<span class="inlinecode-ocaml">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="keyword">rec</span> <span class="id" title="var">tree_copy</span> <span class="id" title="var">p</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">p</span> = <span class="id" title="var">null</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">null</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">mnode</span> <span class="id" title="var">p.item</span> (<span class="id" title="var">tree_copy</span> <span class="id" title="var">p.left</span>) (<span class="id" title="var">tree_copy</span> <span class="id" title="var">p.right</span>)
</span>
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="tree_copy" class="idref" href="#tree_copy"><span class="id" title="definition">tree_copy</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#7809db93a49fc4341c1251bb4de79a<sub>62</sub>"><span class="id" title="notation">fix</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#7809db93a49fc4341c1251bb4de79a<sub>62</sub>"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#3fbef795df792463de2da5f563e20424"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a><a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">(</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="LibSepReference.html#8e45340a54d108624916002b0e01c7ee"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#item"><span class="id" title="definition">item</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="LibSepReference.html#8e45340a54d108624916002b0e01c7ee"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#left"><span class="id" title="definition">left</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">p<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="LibSepReference.html#8e45340a54d108624916002b0e01c7ee"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#right"><span class="id" title="definition">right</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q<sub>1</sub>'"><span class="id" title="notation">q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q<sub>2</sub>'"><span class="id" title="notation">q<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">p<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Repr.html#mnode"><span class="id" title="definition">mnode</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q<sub>1</sub>'"><span class="id" title="notation">q<sub>1</sub></span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q<sub>2</sub>'"><span class="id" title="notation">q<sub>2</sub></span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
<a id="lab67"></a><h4 class="section">Exercise: 3 stars, standard, optional (triple_tree_copy)</h4>
 Prove the specification of <span class="inlinecode"><span class="id" title="var">tree_copy</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_tree_copy" class="idref" href="#triple_tree_copy"><span class="id" title="lemma">triple_tree_copy</span></a> : <span class="id" title="keyword">∀</span> <a id="p:99" class="idref" href="#p:99"><span class="id" title="binder">p</span></a> <a id="T:100" class="idref" href="#T:100"><span class="id" title="binder">T</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#tree_copy"><span class="id" title="definition">tree_copy</span></a> <a class="idref" href="Repr.html#p:99"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Repr.html#MTree"><span class="id" title="definition">MTree</span></a> <a class="idref" href="Repr.html#T:100"><span class="id" title="variable">T</span></a> <a class="idref" href="Repr.html#p:99"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Basic.html#41749fe005eef2f7f0316a63bdabe5a<sub>8</sub>"><span class="id" title="notation">funloc</span></a> <a id="q:101" class="idref" href="#q:101"><span class="id" title="binder">q</span></a> <a class="idref" href="Basic.html#41749fe005eef2f7f0316a63bdabe5a<sub>8</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#MTree"><span class="id" title="definition">MTree</span></a> <a class="idref" href="Repr.html#T:100"><span class="id" title="variable">T</span></a> <a class="idref" href="Repr.html#p:99"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#MTree"><span class="id" title="definition">MTree</span></a> <a class="idref" href="Repr.html#T:100"><span class="id" title="variable">T</span></a> <a class="idref" href="Repr.html#q:101"><span class="id" title="variable">q</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab68"></a><h2 class="section">Computing the Sum of the Items in a Tree</h2>

<div class="paragraph"> </div>

 The operation <span class="inlinecode"><span class="id" title="var">mtreesum</span></span> takes as argument the location <span class="inlinecode"><span class="id" title="var">p</span></span> of a mutable
    tree, and it returns the sum of all the integers stored in the nodes of that
    tree. Consider the implementation that traverses the tree, using an
    auxiliary reference cell to maintain the sum of all the items visited so
    far.

<div class="paragraph"> </div>

<span class="inlinecode-ocaml">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="keyword">rec</span> <span class="id" title="var">treeacc</span> <span class="id" title="var">c</span> <span class="id" title="var">p</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">p</span> ≠ <span class="id" title="var">null</span> <span class="id" title="keyword">then</span> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">c</span> := !<span class="id" title="var">c</span> + <span class="id" title="var">p.item</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">treeacc</span> <span class="id" title="var">c</span> <span class="id" title="var">p.left</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">treeacc</span> <span class="id" title="var">c</span> <span class="id" title="var">p.right</span>)<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">mtreesum</span> <span class="id" title="var">p</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">c</span> = <span class="id" title="var">ref</span> 0 <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">treeacc</span> <span class="id" title="var">c</span> <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!<span class="id" title="var">c</span>
</span>
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="treeacc" class="idref" href="#treeacc"><span class="id" title="definition">treeacc</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#04af5112f77d94e84bf2cc7677bd575d"><span class="id" title="notation">fix</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">c</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#04af5112f77d94e84bf2cc7677bd575d"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a><a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'end'"><span class="id" title="notation">if</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'end'"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">m</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#27f9d9ef09cb3e20c393642accbfc5d<sub>1</sub>"><span class="id" title="notation">!</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">c</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">x</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="LibSepReference.html#8e45340a54d108624916002b0e01c7ee"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#item"><span class="id" title="definition">item</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m<sub>2</sub>'"><span class="id" title="notation">m<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">m</span></a> <a class="idref" href="LibSepReference.html#590da34eb63eef1c68773c655749c128"><span class="id" title="notation">+</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">x</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">c</span></a> <a class="idref" href="LibSepReference.html#e0633f114fcb17e965cb872e30ce07a<sub>5</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m<sub>2</sub>'"><span class="id" title="notation">m<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="LibSepReference.html#8e45340a54d108624916002b0e01c7ee"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#left"><span class="id" title="definition">left</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">c</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">p<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="LibSepReference.html#8e45340a54d108624916002b0e01c7ee"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#right"><span class="id" title="definition">right</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">c</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">p<sub>2</sub></span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'end'"><span class="id" title="notation">end</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="mtreesum" class="idref" href="#mtreesum"><span class="id" title="definition">mtreesum</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">c</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:'ref'"><span class="id" title="notation">ref</span></a> 0 <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Repr.html#treeacc"><span class="id" title="definition">treeacc</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">c</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Basic.html#get_and_free"><span class="id" title="definition">get_and_free</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">c</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
The specification of <span class="inlinecode"><span class="id" title="var">mtreesum</span></span> is expressed in terms of the Coq function
    <span class="inlinecode"><span class="id" title="var">treesum</span></span>, which computes the sum of the node items stored in a logical
    tree. This operation is defined by recursion over the tree. 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <a id="treesum" class="idref" href="#treesum"><span class="id" title="definition">treesum</span></a> (<a id="T:102" class="idref" href="#T:102"><span class="id" title="binder">T</span></a>:<a class="idref" href="Repr.html#tree"><span class="id" title="inductive">tree</span></a>) : <span class="id" title="notation">int</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Repr.html#T:102"><span class="id" title="variable">T</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Repr.html#Leaf"><span class="id" title="constructor">Leaf</span></a> ⇒ 0<br/>
&nbsp;&nbsp;| <a class="idref" href="Repr.html#Node"><span class="id" title="constructor">Node</span></a> <span class="id" title="var">n</span> <span class="id" title="var">T<sub>1</sub></span> <span class="id" title="var">T<sub>2</sub></span> ⇒ <span class="id" title="var">n</span> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="Repr.html#treesum:103"><span class="id" title="definition">treesum</span></a> <span class="id" title="var">T<sub>1</sub></span> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="Repr.html#treesum:103"><span class="id" title="definition">treesum</span></a> <span class="id" title="var">T<sub>2</sub></span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
<a id="lab69"></a><h4 class="section">Exercise: 4 stars, standard, optional (triple_mtreesum)</h4>
 Prove the correctness of the function <span class="inlinecode"><span class="id" title="var">mlength'</span></span>. Hint: to begin with, state
    and prove the specification lemma <span class="inlinecode"><span class="id" title="var">triple_treeacc</span></span>. 
</div>
<div class="code">

<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="triple_mtreesum" class="idref" href="#triple_mtreesum"><span class="id" title="lemma">triple_mtreesum</span></a> : <span class="id" title="keyword">∀</span> <a id="T:105" class="idref" href="#T:105"><span class="id" title="binder">T</span></a> <a id="p:106" class="idref" href="#p:106"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#mtreesum"><span class="id" title="definition">mtreesum</span></a> <a class="idref" href="Repr.html#p:106"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Repr.html#MTree"><span class="id" title="definition">MTree</span></a> <a class="idref" href="Repr.html#T:105"><span class="id" title="variable">T</span></a> <a class="idref" href="Repr.html#p:106"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:107" class="idref" href="#r:107"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Repr.html#r:107"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Repr.html#treesum"><span class="id" title="definition">treesum</span></a> <a class="idref" href="Repr.html#T:105"><span class="id" title="variable">T</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#MTree"><span class="id" title="definition">MTree</span></a> <a class="idref" href="Repr.html#T:105"><span class="id" title="variable">T</span></a> <a class="idref" href="Repr.html#p:106"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab70"></a><h2 class="section">Verification of a Counter Function with Local State</h2>

<div class="paragraph"> </div>

 This section is concerned with the verification of counter functions, which
    feature internal, mutable state. A counter function <span class="inlinecode"><span class="id" title="var">f</span></span> is a function that,
    each time it is called, returns the next integer. Concretely, the first call
    to <span class="inlinecode"><span class="id" title="var">f</span>()</span> returns <span class="inlinecode">1</span>, the second call to <span class="inlinecode"><span class="id" title="var">f</span>()</span> returns <span class="inlinecode">2</span>, the third call
    to <span class="inlinecode"><span class="id" title="var">f</span>()</span> returns <span class="inlinecode">3</span>, and so on.

<div class="paragraph"> </div>

    A counter function can be implemented using a reference cell, named <span class="inlinecode"><span class="id" title="var">p</span></span>,
    that stores the integer last returned by the counter. Initially, the
    contents of the reference <span class="inlinecode"><span class="id" title="var">p</span></span> is zero. Each time the counter function is
    called, the contents of <span class="inlinecode"><span class="id" title="var">p</span></span> is increased by one unit, and the new value of
    the contents is returned to the caller.

<div class="paragraph"> </div>

    The function <span class="inlinecode"><span class="id" title="var">create_counter</span></span> produces a fresh counter function. Concretely,
    <span class="inlinecode"><span class="id" title="var">create_counter</span>()</span> returns a counter function <span class="inlinecode"><span class="id" title="var">f</span></span> independent from any other
    previously existing counter function.

<div class="paragraph"> </div>

<span class="inlinecode-ocaml">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">create_counter</span> () =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">p</span> = <span class="id" title="var">ref</span> 0 <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> () → (<span class="id" title="var">incr</span> <span class="id" title="var">p</span>; !<span class="id" title="var">p</span>))
</span>
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="create_counter" class="idref" href="#create_counter"><span class="id" title="definition">create_counter</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''u'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''u'"><span class="id" title="notation">u</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:'ref'"><span class="id" title="notation">ref</span></a> 0 <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#6de150166dc2b6b515065825fd7ae19d"><span class="id" title="notation">fun_</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''u'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''u'"><span class="id" title="notation">u</span></a> <a class="idref" href="LibSepReference.html#6de150166dc2b6b515065825fd7ae19d"><span class="id" title="notation">⇒</span></a> <a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">(</span></a><a class="idref" href="Basic.html#incr"><span class="id" title="definition">incr</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="LibSepReference.html#27f9d9ef09cb3e20c393642accbfc5d<sub>1</sub>"><span class="id" title="notation">!</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">))</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
In this section, we present two specifications for counter functions. The
    first specification is the most direct, however it exposes the existence of
    the reference cell, revealing implementation details about the counter
    function. The second specification is more abstract: it hides from the
    client the internal representation of the counter, by means of using an
    abstract representation predicate. 
<div class="paragraph"> </div>

 Let us begin with the simple, direct specification. The proposition
    <span class="inlinecode"><span class="id" title="var">CounterSpec</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> asserts that <span class="inlinecode"><span class="id" title="var">f</span></span> is a counter function <span class="inlinecode"><span class="id" title="var">f</span></span> whose internal
    state is stored in a reference cell at location <span class="inlinecode"><span class="id" title="var">p</span></span>. Thus, invoking <span class="inlinecode"><span class="id" title="var">f</span></span> in a
    state <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">m</span></span> updates the state to <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode">(<span class="id" title="var">m</span>+1)</span>, and produces the output
    value <span class="inlinecode"><span class="id" title="var">m</span>+1</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="CounterSpec" class="idref" href="#CounterSpec"><span class="id" title="definition">CounterSpec</span></a> (<a id="f:108" class="idref" href="#f:108"><span class="id" title="binder">f</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) (<a id="p:109" class="idref" href="#p:109"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="m:110" class="idref" href="#m:110"><span class="id" title="binder">m</span></a>, <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#f:108"><span class="id" title="variable">f</span></a> <a class="idref" href="LibSepReference.html#3127c6bc552ca21a494fc6e3474a507d"><span class="id" title="notation">()</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Repr.html#p:109"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Repr.html#m:110"><span class="id" title="variable">m</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:111" class="idref" href="#r:111"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Repr.html#r:111"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Repr.html#m:110"><span class="id" title="variable">m</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Repr.html#p:109"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#m:110"><span class="id" title="variable">m</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1<a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">)</span></a>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">f</span> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
</div>

<div class="doc">
The function <span class="inlinecode"><span class="id" title="var">create_counter</span></span> creates a fresh counter. Its precondition is
    empty. Its postcondition asserts that the function <span class="inlinecode"><span class="id" title="var">f</span></span> being returned
    satisfies <span class="inlinecode"><span class="id" title="var">CounterSpec</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>, and the output state contains a cell <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode">0</span>
    for some existentially quantified location <span class="inlinecode"><span class="id" title="var">p</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_create_counter" class="idref" href="#triple_create_counter"><span class="id" title="lemma">triple_create_counter</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#create_counter"><span class="id" title="definition">create_counter</span></a> <a class="idref" href="LibSepReference.html#3127c6bc552ca21a494fc6e3474a507d"><span class="id" title="notation">()</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="f:112" class="idref" href="#f:112"><span class="id" title="binder">f</span></a> ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="p:113" class="idref" href="#p:113"><span class="id" title="binder">p</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#p:113"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> 0<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Repr.html#CounterSpec"><span class="id" title="definition">CounterSpec</span></a> <a class="idref" href="Repr.html#f:112"><span class="id" title="variable">f</span></a> <a class="idref" href="Repr.html#p:113"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xwp</span>. <span class="id" title="var">xapp</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">p</span>.<br/>
</div>

<div class="doc">
The proof involves the use of a new tactic, called <span class="inlinecode"><span class="id" title="var">xfun</span></span>, for reasoning
    about local function definitions. Here, <span class="inlinecode"><span class="id" title="var">xfun</span></span> gives us the hypothesis <span class="inlinecode"><span class="id" title="var">Hf</span></span>
    that specifies the code of <span class="inlinecode"><span class="id" title="var">f</span></span> 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="var">xfun</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">f</span> <span class="id" title="var">Hf</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xsimpl</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">m</span>.<br/>
</div>

<div class="doc">
To reason about the call to the function <span class="inlinecode"><span class="id" title="var">f</span></span>, we can exploit <span class="inlinecode"><span class="id" title="var">Hf</span></span>, either
    explicitly by calling <span class="inlinecode"><span class="id" title="var">applys</span></span> <span class="inlinecode"><span class="id" title="var">Hf</span></span>, or automatically by simply calling <span class="inlinecode"><span class="id" title="var">xapp</span></span>
    . 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xapp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xapp</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">auto</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Consider now a call to a counter function <span class="inlinecode"><span class="id" title="var">f</span></span>, under the assumption
    <span class="inlinecode"><span class="id" title="var">CounterSpec</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>. Assume the input state to be of the form <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">n</span></span> for
    some <span class="inlinecode"><span class="id" title="var">n</span></span>. Then, the call produces a state <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode">(<span class="id" title="var">n</span>+1)</span>, and returns the
    value <span class="inlinecode"><span class="id" title="var">n</span>+1</span>. The specification shown below captures this logic, for any <span class="inlinecode"><span class="id" title="var">f</span></span>.
    
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_apply_counter" class="idref" href="#triple_apply_counter"><span class="id" title="lemma">triple_apply_counter</span></a> : <span class="id" title="keyword">∀</span> <a id="f:114" class="idref" href="#f:114"><span class="id" title="binder">f</span></a> <a id="p:115" class="idref" href="#p:115"><span class="id" title="binder">p</span></a> <a id="n:116" class="idref" href="#n:116"><span class="id" title="binder">n</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Repr.html#CounterSpec"><span class="id" title="definition">CounterSpec</span></a> <a class="idref" href="Repr.html#f:114"><span class="id" title="variable">f</span></a> <a class="idref" href="Repr.html#p:115"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#f:114"><span class="id" title="variable">f</span></a> <a class="idref" href="LibSepReference.html#3127c6bc552ca21a494fc6e3474a507d"><span class="id" title="notation">()</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Repr.html#p:115"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Repr.html#n:116"><span class="id" title="variable">n</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:117" class="idref" href="#r:117"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Repr.html#r:117"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Repr.html#n:116"><span class="id" title="variable">n</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#p:115"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#n:116"><span class="id" title="variable">n</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1<a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">)</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>).<br/>
</div>

<div class="doc">
The specification above is in fact nothing but a reformulation of the
    definition of <span class="inlinecode"><span class="id" title="var">CounterSpec</span></span>. Thus, its proof is straightforwards. (The proof
    may actually be reduced to just <span class="inlinecode"><span class="id" title="tactic">auto</span></span>, however in general one needs to use
    <span class="inlinecode"><span class="id" title="var">xapp</span></span> for reasoning about an abstract function.) 
</div>
<div class="code">
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">Hf</span>. <span class="id" title="var">unfolds</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hf</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xsimpl</span>*. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab71"></a><h2 class="section">Verification of a Counter Function with Local State, With Abstraction</h2>

<div class="paragraph"> </div>

 Let us move on to the presentation of more abstract specifications. The goal
    is to hide from the client the existence of the reference cell used to
    represent the internal state of the counter functions. To that end, we
    introduce the heap predicate <span class="inlinecode"><span class="id" title="var">IsCounter</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span>, which relates a function <span class="inlinecode"><span class="id" title="var">f</span></span>,
    its current value <span class="inlinecode"><span class="id" title="var">n</span></span>, and the piece of memory state involved in the
    implementation of this function. This piece of memory is of the form
    <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">n</span></span>, for some location <span class="inlinecode"><span class="id" title="var">p</span></span>, such that <span class="inlinecode"><span class="id" title="var">CounterSpec</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> holds. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="IsCounter" class="idref" href="#IsCounter"><span class="id" title="definition">IsCounter</span></a> (<a id="f:118" class="idref" href="#f:118"><span class="id" title="binder">f</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) (<a id="n:119" class="idref" href="#n:119"><span class="id" title="binder">n</span></a>:<span class="id" title="notation">int</span>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="p:120" class="idref" href="#p:120"><span class="id" title="binder">p</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="Repr.html#p:120"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Repr.html#n:119"><span class="id" title="variable">n</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Repr.html#CounterSpec"><span class="id" title="definition">CounterSpec</span></a> <a class="idref" href="Repr.html#f:118"><span class="id" title="variable">f</span></a> <a class="idref" href="Repr.html#p:120"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>.<br/>
</div>

<div class="doc">
Using <span class="inlinecode"><span class="id" title="var">IsCounter</span></span>, we can reformulate the specification of <span class="inlinecode"><span class="id" title="var">create_counter</span></span>
    with a postcondition asserting that the output function <span class="inlinecode"><span class="id" title="var">f</span></span> is described by
    the heap predicate <span class="inlinecode"><span class="id" title="var">IsCounter</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode">0</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_create_counter_abstract" class="idref" href="#triple_create_counter_abstract"><span class="id" title="lemma">triple_create_counter_abstract</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#create_counter"><span class="id" title="definition">create_counter</span></a> <a class="idref" href="LibSepReference.html#3127c6bc552ca21a494fc6e3474a507d"><span class="id" title="notation">()</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="f:121" class="idref" href="#f:121"><span class="id" title="binder">f</span></a> ⇒ <a class="idref" href="Repr.html#IsCounter"><span class="id" title="definition">IsCounter</span></a> <a class="idref" href="Repr.html#f:121"><span class="id" title="variable">f</span></a> 0).<br/>
</div>

<div class="doc">
This lemma is the same as the previous specification <span class="inlinecode"><span class="id" title="var">triple_create_counter</span></span>
    , except that the reference cell <span class="inlinecode"><span class="id" title="var">p</span></span> is no longer visible. 
</div>
<div class="code">
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Repr.html#IsCounter"><span class="id" title="definition">IsCounter</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="Repr.html#triple_create_counter"><span class="id" title="lemma">triple_create_counter</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
We can also reformulate the specification of a call to a counter function. A
    call to <span class="inlinecode"><span class="id" title="var">f</span>()</span>, in a state satisfying <span class="inlinecode"><span class="id" title="var">IsCounter</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span>, produces a state
    satisfying <span class="inlinecode"><span class="id" title="var">IsCounter</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode">(<span class="id" title="var">n</span>+1)</span>, and returns <span class="inlinecode"><span class="id" title="var">n</span>+1</span>. 
<div class="paragraph"> </div>

<a id="lab72"></a><h4 class="section">Exercise: 4 stars, standard, especially useful (triple_apply_counter_abstract)</h4>
 Prove the abstract specification for a counter function. You will need to
    begin the proof using the tactic <span class="inlinecode"><span class="id" title="var">xtriple</span></span>, for turning goal into a form on
    which <span class="inlinecode"><span class="id" title="var">xpull</span></span> can be invoked to extract facts from the precondition. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_apply_counter_abstract" class="idref" href="#triple_apply_counter_abstract"><span class="id" title="lemma">triple_apply_counter_abstract</span></a> : <span class="id" title="keyword">∀</span> <a id="f:122" class="idref" href="#f:122"><span class="id" title="binder">f</span></a> <a id="n:123" class="idref" href="#n:123"><span class="id" title="binder">n</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#f:122"><span class="id" title="variable">f</span></a> <a class="idref" href="LibSepReference.html#3127c6bc552ca21a494fc6e3474a507d"><span class="id" title="notation">()</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Repr.html#IsCounter"><span class="id" title="definition">IsCounter</span></a> <a class="idref" href="Repr.html#f:122"><span class="id" title="variable">f</span></a> <a class="idref" href="Repr.html#n:123"><span class="id" title="variable">n</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:124" class="idref" href="#r:124"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Repr.html#r:124"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Repr.html#n:123"><span class="id" title="variable">n</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Repr.html#IsCounter"><span class="id" title="definition">IsCounter</span></a> <a class="idref" href="Repr.html#f:122"><span class="id" title="variable">f</span></a> (<a class="idref" href="Repr.html#n:123"><span class="id" title="variable">n</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1)<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<span class="id" title="keyword">Opaque</span> <a class="idref" href="Repr.html#IsCounter"><span class="id" title="definition">IsCounter</span></a>.<br/>
</div>

<div class="doc">
<a id="lab73"></a><h1 class="section">Optional Material</h1>

</div>

<div class="doc">
<a id="lab74"></a><h2 class="section">Specification of a Higher-Order Repeat Operator</h2>

<div class="paragraph"> </div>

 Consider the higher-order iterator <span class="inlinecode"><span class="id" title="tactic">repeat</span></span>: a call to <span class="inlinecode"><span class="id" title="tactic">repeat</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> executes
    <span class="inlinecode"><span class="id" title="var">n</span></span> times the call <span class="inlinecode"><span class="id" title="var">f</span>()</span>.

<div class="paragraph"> </div>

<span class="inlinecode-ocaml">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="keyword">rec</span> <span class="id" title="tactic">repeat</span> <span class="id" title="var">f</span> <span class="id" title="var">n</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">n</span> &gt; 0 <span class="id" title="keyword">then</span> (<span class="id" title="var">f</span>(); <span class="id" title="tactic">repeat</span> <span class="id" title="var">f</span> (<span class="id" title="var">n</span>-1))
</span>
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="repeat" class="idref" href="#repeat"><span class="id" title="definition">repeat</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#04af5112f77d94e84bf2cc7677bd575d"><span class="id" title="notation">fix</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''g'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''g'"><span class="id" title="notation">g</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#04af5112f77d94e84bf2cc7677bd575d"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:x_'&gt;'_x"><span class="id" title="notation">&gt;</span></a> 0<a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'end'"><span class="id" title="notation">if</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'end'"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepReference.html#71337baa9b3f1f61552031a8e9cb9237"><span class="id" title="notation">()</span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n<sub>2</sub>'"><span class="id" title="notation">n<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1 <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''g'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''g'"><span class="id" title="notation">g</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n<sub>2</sub>'"><span class="id" title="notation">n<sub>2</sub></span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'end'"><span class="id" title="notation">end</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
For simplicity, let us assume for now <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">≥</span> <span class="inlinecode">0</span>. The specification of
    <span class="inlinecode"><span class="id" title="tactic">repeat</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> can be expressed in terms of an invariant, named <span class="inlinecode"><span class="id" title="var">I</span></span>,
    describing the state in between every two calls to <span class="inlinecode"><span class="id" title="var">f</span></span>. We assume that the
    initial state satisfies <span class="inlinecode"><span class="id" title="var">I</span></span> <span class="inlinecode">0</span>. Moreover, we assume that, for every index <span class="inlinecode"><span class="id" title="var">i</span></span>
    in the range from <span class="inlinecode">0</span> (inclusive) to <span class="inlinecode"><span class="id" title="var">n</span></span> (exclusive), a call <span class="inlinecode"><span class="id" title="var">f</span>()</span> can
    execute in a state that satisfies <span class="inlinecode"><span class="id" title="var">I</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> and produce a state that satisfies
    <span class="inlinecode"><span class="id" title="var">I</span></span> <span class="inlinecode">(<span class="id" title="var">i</span>+1)</span>. The specification below asserts that, under these two
    assumptions, after the <span class="inlinecode"><span class="id" title="var">n</span></span> calls to <span class="inlinecode"><span class="id" title="var">f</span>()</span>, the final state satisfies <span class="inlinecode"><span class="id" title="var">I</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span>.
    The specification takes the form:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">n</span> ≥ 0 →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hypothesis_on_f</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">triple</span> (<span class="id" title="tactic">repeat</span> <span class="id" title="var">f</span> <span class="id" title="var">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">I</span> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">u</span> ⇒ <span class="id" title="var">I</span> <span class="id" title="var">n</span>)
</span>    where <span class="inlinecode"><span class="id" title="var">Hypothesis_on_f</span></span> is a proposition that captures the following
    specification:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;0 ≤ <span class="id" title="var">i</span> &lt; <span class="id" title="var">n</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">triple</span> (<span class="id" title="var">f</span> ())<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">I</span> <span class="id" title="var">i</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">u</span> ⇒ <span class="id" title="var">I</span> (<span class="id" title="var">i</span>+1))
</span>    The complete specification of <span class="inlinecode"><span class="id" title="tactic">repeat</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> is thus as shown below. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_repeat" class="idref" href="#triple_repeat"><span class="id" title="lemma">triple_repeat</span></a> : <span class="id" title="keyword">∀</span> (<a id="I:125" class="idref" href="#I:125"><span class="id" title="binder">I</span></a>:<span class="id" title="notation">int</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) (<a id="f:126" class="idref" href="#f:126"><span class="id" title="binder">f</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) (<a id="n:127" class="idref" href="#n:127"><span class="id" title="binder">n</span></a>:<span class="id" title="notation">int</span>),<br/>
&nbsp;&nbsp;<a class="idref" href="Repr.html#n:127"><span class="id" title="variable">n</span></a> <span class="id" title="notation">≥</span> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="i:129" class="idref" href="#i:129"><span class="id" title="binder">i</span></a>, 0 <span class="id" title="notation">≤</span> <a class="idref" href="Repr.html#i:129"><span class="id" title="variable">i</span></a> <span class="id" title="notation">&lt;</span> <a class="idref" href="Repr.html#n:127"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#f:126"><span class="id" title="variable">f</span></a> <a class="idref" href="LibSepReference.html#3127c6bc552ca21a494fc6e3474a507d"><span class="id" title="notation">()</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Repr.html#I:125"><span class="id" title="variable">I</span></a> <a class="idref" href="Repr.html#i:129"><span class="id" title="variable">i</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="u:130" class="idref" href="#u:130"><span class="id" title="binder">u</span></a> ⇒ <a class="idref" href="Repr.html#I:125"><span class="id" title="variable">I</span></a> (<a class="idref" href="Repr.html#i:129"><span class="id" title="variable">i</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1))<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#repeat"><span class="id" title="definition">repeat</span></a> <a class="idref" href="Repr.html#f:126"><span class="id" title="variable">f</span></a> <a class="idref" href="Repr.html#n:127"><span class="id" title="variable">n</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Repr.html#I:125"><span class="id" title="variable">I</span></a> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="u:128" class="idref" href="#u:128"><span class="id" title="binder">u</span></a> ⇒ <a class="idref" href="Repr.html#I:125"><span class="id" title="variable">I</span></a> <a class="idref" href="Repr.html#n:127"><span class="id" title="variable">n</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">Hn</span> <span class="id" title="var">Hf</span>.<br/>
</div>

<div class="doc">
To establish this specification, we carry out a proof by induction over a
    generalized specification, covering the case where there remains <span class="inlinecode"><span class="id" title="var">m</span></span>
    iterations to perform, for any value of <span class="inlinecode"><span class="id" title="var">m</span></span> between <span class="inlinecode">0</span> and <span class="inlinecode"><span class="id" title="var">n</span></span> inclusive.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">m</span>, 0 ≤ <span class="id" title="var">m</span> ≤ <span class="id" title="var">n</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">triple</span> (<span class="id" title="tactic">repeat</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">I</span> (<span class="id" title="var">n</span>-<span class="id" title="var">m</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">u</span> ⇒ <span class="id" title="var">I</span> <span class="id" title="var">n</span>))
</span>    We use the TLC tactics <span class="inlinecode"><span class="id" title="var">cuts</span></span>, a variant of <span class="inlinecode"><span class="id" title="tactic">cut</span></span>, to state show that the
    generalized specification entails the statement of <span class="inlinecode"><span class="id" title="var">triple_repeat</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="var">cuts</span> <span class="id" title="var">G</span>: (<span class="id" title="keyword">∀</span> <a id="m:133" class="idref" href="#m:133"><span class="id" title="binder">m</span></a>, 0 <span class="id" title="notation">≤</span> <a class="idref" href="Repr.html#m:131"><span class="id" title="variable">m</span></a> <span class="id" title="notation">≤</span> <span class="id" title="var">n</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#repeat"><span class="id" title="definition">repeat</span></a> <span class="id" title="var">f</span> <a class="idref" href="Repr.html#m:131"><span class="id" title="variable">m</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">I</span> (<span class="id" title="var">n</span><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#::Z_scope:x_'-'_x"><span class="id" title="notation">-</span></a><a class="idref" href="Repr.html#m:131"><span class="id" title="variable">m</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="u:134" class="idref" href="#u:134"><span class="id" title="binder">u</span></a> ⇒ <span class="id" title="var">I</span> <span class="id" title="var">n</span>)).<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys_eq</span> <span class="id" title="var">G</span>. { <span class="id" title="var">fequals</span>. <span class="id" title="var">math</span>. } { <span class="id" title="var">math</span>. } }<br/>
</div>

<div class="doc">
We then carry a proof by induction: during the execution, the value of <span class="inlinecode"><span class="id" title="var">m</span></span>
    decreases step by step down to <span class="inlinecode">0</span>. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">m</span>. <span class="id" title="var">induction_wf</span> <span class="id" title="var">IH</span>: (<span class="id" title="definition">downto</span> 0) <span class="id" title="var">m</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Hm</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">xwp</span>. <span class="id" title="var">xapp</span>. <span class="id" title="var">xif</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">C</span>.<br/>
</div>

<div class="doc">
We reason about the call to <span class="inlinecode"><span class="id" title="var">f</span></span> 
</div>
<div class="code">
&nbsp;&nbsp;{ <span class="id" title="var">xapp</span>. { <span class="id" title="var">math</span>. } <span class="id" title="var">xapp</span>.<br/>
</div>

<div class="doc">
We next reason about the recursive call. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xapp</span>. { <span class="id" title="var">math</span>. } { <span class="id" title="var">math</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">math_rewrite</span> (<a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">(</span></a><span class="id" title="var">n</span> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#::Z_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <span class="id" title="var">m</span><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">n</span> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#::Z_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#::Z_scope:x_'-'_x"><span class="id" title="notation">(</span></a><span class="id" title="var">m</span> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#::Z_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1<a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#::Z_scope:x_'-'_x"><span class="id" title="notation">)</span></a>). <span class="id" title="var">xsimpl</span>. }<br/>
</div>

<div class="doc">
Finally, when <span class="inlinecode"><span class="id" title="var">m</span></span> reaches zero, we check that we obtain <span class="inlinecode"><span class="id" title="var">I</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;{ <span class="id" title="var">xval</span>. <span class="id" title="var">math_rewrite</span> (<span class="id" title="var">n</span> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#::Z_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <span class="id" title="var">m</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">n</span>). <span class="id" title="var">xsimpl</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab75"></a><h2 class="section">Specification of an Iterator on Mutable Lists</h2>

<div class="paragraph"> </div>

 The operation <span class="inlinecode"><span class="id" title="var">miter</span></span> takes as argument a function <span class="inlinecode"><span class="id" title="var">f</span></span> and a pointer <span class="inlinecode"><span class="id" title="var">p</span></span> on
    a mutable list, and invokes <span class="inlinecode"><span class="id" title="var">f</span></span> on each of the items stored in that list.

<div class="paragraph"> </div>

<span class="inlinecode-ocaml">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="keyword">rec</span> <span class="id" title="var">miter</span> <span class="id" title="var">f</span> <span class="id" title="var">p</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">p</span> ≠ <span class="id" title="var">null</span> <span class="id" title="keyword">then</span> (<span class="id" title="var">f</span> <span class="id" title="var">p.head</span>; <span class="id" title="var">miter</span> <span class="id" title="var">f</span> <span class="id" title="var">p.tail</span>)
</span>
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="miter" class="idref" href="#miter"><span class="id" title="definition">miter</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#04af5112f77d94e84bf2cc7677bd575d"><span class="id" title="notation">fix</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''g'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''g'"><span class="id" title="notation">g</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#04af5112f77d94e84bf2cc7677bd575d"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a><a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'end'"><span class="id" title="notation">if</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'end'"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">x</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="LibSepReference.html#8e45340a54d108624916002b0e01c7ee"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#head"><span class="id" title="definition">head</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">x</span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">q</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="LibSepReference.html#8e45340a54d108624916002b0e01c7ee"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#tail"><span class="id" title="definition">tail</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''g'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''g'"><span class="id" title="notation">g</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q'"><span class="id" title="notation">q</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'end'"><span class="id" title="notation">end</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
The specification of <span class="inlinecode"><span class="id" title="var">miter</span></span> follows the same structure as that of the
    function <span class="inlinecode"><span class="id" title="tactic">repeat</span></span> from the previous section, with two main differences. The
    first difference is that the invariant is expressed not in terms of an index
    <span class="inlinecode"><span class="id" title="var">i</span></span> ranging from <span class="inlinecode">0</span> to <span class="inlinecode"><span class="id" title="var">n</span></span>, but in terms of a prefix of the list <span class="inlinecode"><span class="id" title="var">L</span></span> being
    traversed. This prefix ranges from <span class="inlinecode"><span class="id" title="var">nil</span></span> to the full list <span class="inlinecode"><span class="id" title="var">L</span></span>. The second
    difference is that the operation <span class="inlinecode"><span class="id" title="var">miter</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> requires in its precondition,
    in addition to <span class="inlinecode"><span class="id" title="var">I</span></span> <span class="inlinecode"><span class="id" title="var">nil</span></span>, the description of the mutable list <span class="inlinecode"><span class="id" title="var">MList</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>.
    This predicate is returned in the postcondition, unchanged, reflecting the
    fact that the iteration process does not alter the contents of the list. 
<div class="paragraph"> </div>

<a id="lab76"></a><h4 class="section">Exercise: 5 stars, standard, especially useful (triple_miter)</h4>
 Prove the correctness of <span class="inlinecode"><span class="id" title="var">triple_miter</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_miter" class="idref" href="#triple_miter"><span class="id" title="lemma">triple_miter</span></a> : <span class="id" title="keyword">∀</span> (<a id="I:135" class="idref" href="#I:135"><span class="id" title="binder">I</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) <a id="L:136" class="idref" href="#L:136"><span class="id" title="binder">L</span></a> (<a id="f:137" class="idref" href="#f:137"><span class="id" title="binder">f</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) <a id="p:138" class="idref" href="#p:138"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="x:140" class="idref" href="#x:140"><span class="id" title="binder">x</span></a> <a id="L<sub>1</sub>:141" class="idref" href="#L<sub>1</sub>:141"><span class="id" title="binder">L<sub>1</sub></span></a> <a id="L<sub>2</sub>:142" class="idref" href="#L<sub>2</sub>:142"><span class="id" title="binder">L<sub>2</sub></span></a>, <a class="idref" href="Repr.html#L:136"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Repr.html#L<sub>1</sub>:141"><span class="id" title="variable">L<sub>1</sub></span></a><span class="id" title="notation">++</span><a class="idref" href="Repr.html#x:140"><span class="id" title="variable">x</span></a><span class="id" title="notation">::</span><a class="idref" href="Repr.html#L<sub>2</sub>:142"><span class="id" title="variable">L<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#f:137"><span class="id" title="variable">f</span></a> <a class="idref" href="Repr.html#x:140"><span class="id" title="variable">x</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Repr.html#I:135"><span class="id" title="variable">I</span></a> <a class="idref" href="Repr.html#L<sub>1</sub>:141"><span class="id" title="variable">L<sub>1</sub></span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="u:143" class="idref" href="#u:143"><span class="id" title="binder">u</span></a> ⇒ <a class="idref" href="Repr.html#I:135"><span class="id" title="variable">I</span></a> (<a class="idref" href="Repr.html#L<sub>1</sub>:141"><span class="id" title="variable">L<sub>1</sub></span></a><span class="id" title="notation">++(</span><a class="idref" href="Repr.html#x:140"><span class="id" title="variable">x</span></a><span class="id" title="notation">::</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a><span class="id" title="notation">)</span>))<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#miter"><span class="id" title="definition">miter</span></a> <a class="idref" href="Repr.html#f:137"><span class="id" title="variable">f</span></a> <a class="idref" href="Repr.html#p:138"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Repr.html#L:136"><span class="id" title="variable">L</span></a> <a class="idref" href="Repr.html#p:138"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Repr.html#I:135"><span class="id" title="variable">I</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="u:139" class="idref" href="#u:139"><span class="id" title="binder">u</span></a> ⇒ <a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Repr.html#L:136"><span class="id" title="variable">L</span></a> <a class="idref" href="Repr.html#p:138"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Repr.html#I:135"><span class="id" title="variable">I</span></a> <a class="idref" href="Repr.html#L:136"><span class="id" title="variable">L</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 For exploiting the specification <span class="inlinecode"><span class="id" title="var">triple_miter</span></span> to reason about a call to
    <span class="inlinecode"><span class="id" title="var">miter</span></span>, it is necessary to provide an invariant <span class="inlinecode"><span class="id" title="var">I</span></span> of type
    <span class="inlinecode"><span class="id" title="var">list</span></span> <span class="inlinecode"><span class="id" title="var">val</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">hprop</span></span>, that is, of the form <span class="inlinecode"><span class="id" title="keyword">fun</span></span> <span class="inlinecode">(<span class="id" title="var">K</span>:<span class="id" title="var">list</span></span> <span class="inlinecode"><span class="id" title="var">val</span>)</span> <span class="inlinecode">⇒</span> <span class="inlinecode">...</span>. This
    invariant, which cannot be inferred automatically, should describe the state
    at the point where the iteration has traversed a prefix <span class="inlinecode"><span class="id" title="var">K</span></span> of the list <span class="inlinecode"><span class="id" title="var">L</span></span>.
    Concretely, for reasoning about a call to <span class="inlinecode"><span class="id" title="var">miter</span></span>, one should exploit the
    tactic <span class="inlinecode"><span class="id" title="var">xapp</span></span> <span class="inlinecode">(<span class="id" title="var">triple_iter</span></span> <span class="inlinecode">(<span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">K</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode">...))</span>. An example appears next. 
</div>

<div class="doc">
<a id="lab77"></a><h2 class="section">Computing the Length of a Mutable List using an Iterator</h2>

<div class="paragraph"> </div>

 The function <span class="inlinecode"><span class="id" title="var">mlength_using_miter</span></span> computes the length of a mutable list by
    iterating over that list a function that increments a reference cell once
    for every item.

<div class="paragraph"> </div>

<span class="inlinecode-ocaml">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">mlength_using_miter</span> <span class="id" title="var">p</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">c</span> = <span class="id" title="var">ref</span> 0 <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">miter</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> → <span class="id" title="var">incr</span> <span class="id" title="var">c</span>) <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!<span class="id" title="var">c</span>
</span>
<div class="paragraph"> </div>

<a id="lab78"></a><h4 class="section">Exercise: 4 stars, standard, especially useful (triple_mlength_using_miter)</h4>
 Prove the correctness of <span class="inlinecode"><span class="id" title="var">mlength_using_iter</span></span>. Hint: as explained earlier,
    use <span class="inlinecode"><span class="id" title="var">xfun</span>;</span> <span class="inlinecode"><span class="id" title="tactic">intros</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">Hf</span></span> for reasoning about the function definition, then
    use <span class="inlinecode"><span class="id" title="var">xapp</span></span> for reasoning about a call to <span class="inlinecode"><span class="id" title="var">f</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="mlength_using_miter" class="idref" href="#mlength_using_miter"><span class="id" title="definition">mlength_using_miter</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">c</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:'ref'"><span class="id" title="notation">ref</span></a> 0 <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#6de150166dc2b6b515065825fd7ae19d"><span class="id" title="notation">fun_</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">x</span></a> <a class="idref" href="LibSepReference.html#6de150166dc2b6b515065825fd7ae19d"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Basic.html#incr"><span class="id" title="definition">incr</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">c</span></a><a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Repr.html#miter"><span class="id" title="definition">miter</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Basic.html#get_and_free"><span class="id" title="definition">get_and_free</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''c'"><span class="id" title="notation">c</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="triple_mlength_using_miter" class="idref" href="#triple_mlength_using_miter"><span class="id" title="lemma">triple_mlength_using_miter</span></a> : <span class="id" title="keyword">∀</span> <a id="p:144" class="idref" href="#p:144"><span class="id" title="binder">p</span></a> <a id="L:145" class="idref" href="#L:145"><span class="id" title="binder">L</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#mlength_using_miter"><span class="id" title="definition">mlength_using_miter</span></a> <a class="idref" href="Repr.html#p:144"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Repr.html#L:145"><span class="id" title="variable">L</span></a> <a class="idref" href="Repr.html#p:144"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:146" class="idref" href="#r:146"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Repr.html#r:146"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">length</span> <a class="idref" href="Repr.html#L:145"><span class="id" title="variable">L</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Repr.html#L:145"><span class="id" title="variable">L</span></a> <a class="idref" href="Repr.html#p:144"><span class="id" title="variable">p</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab79"></a><h2 class="section">A Continuation-Passing-Style, In-Place Concatenation Function</h2>

<div class="paragraph"> </div>

 This section presents an example verification of a function involving
    "continuations". The function <span class="inlinecode"><span class="id" title="var">cps_append</span></span> is similar to the function
    <span class="inlinecode"><span class="id" title="var">append</span></span> presented previously: it also performs in-place concatenation of
    two lists. The main difference is that it is implemented using an auxiliary
    recursive function in "continuation-passing style" (CPS).

<div class="paragraph"> </div>

    The presentation of <span class="inlinecode"><span class="id" title="var">cps_append</span></span> <span class="inlinecode"><span class="id" title="var">p<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">p<sub>2</sub></span></span> is also slightly different: this
    operation returns a pointer <span class="inlinecode"><span class="id" title="var">p<sub>3</sub></span></span> that describes the head of the result of
    the concatenation. In the general case, <span class="inlinecode"><span class="id" title="var">p<sub>3</sub></span></span> is equal to <span class="inlinecode"><span class="id" title="var">p<sub>1</sub></span></span>, but if <span class="inlinecode"><span class="id" title="var">p<sub>1</sub></span></span>
    is the null pointer, meaning that the first list is empty, then <span class="inlinecode"><span class="id" title="var">p<sub>3</sub></span></span> is
    equal to <span class="inlinecode"><span class="id" title="var">p<sub>2</sub></span></span>.

<div class="paragraph"> </div>

    The code of <span class="inlinecode"><span class="id" title="var">cps_append</span></span> involves the auxiliary function
    <span class="inlinecode"><span class="id" title="var">cps_append_aux</span></span> <span class="inlinecode"><span class="id" title="var">p<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">p<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">k</span></span>, which invokes the continuation function <span class="inlinecode"><span class="id" title="var">k</span></span> on the
    result of concatenating the lists at locations <span class="inlinecode"><span class="id" title="var">p<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">p<sub>2</sub></span></span>. Its code
    appears at first quite puzzling, because the recursive call is performed
    inside the continuation. It takes a good drawing and at least several
    minutes to figure out how the function works.

<div class="paragraph"> </div>

<span class="inlinecode-ocaml">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="keyword">rec</span> <span class="id" title="var">cps_append_aux</span> <span class="id" title="var">p<sub>1</sub></span> <span class="id" title="var">p<sub>2</sub></span> <span class="id" title="var">k</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">p<sub>1</sub></span> == <span class="id" title="var">null</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">k</span> <span class="id" title="var">p<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">cps_append_aux</span> <span class="id" title="var">p<sub>1</sub>.tail</span> <span class="id" title="var">p<sub>2</sub></span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">r</span> ⇒ (<span class="id" title="var">p<sub>1</sub>.tail</span> &lt;- <span class="id" title="var">r</span>); <span class="id" title="var">k</span> <span class="id" title="var">p<sub>1</sub></span>)<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">cps_append</span> <span class="id" title="var">p<sub>1</sub></span> <span class="id" title="var">p<sub>2</sub></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cps_append_aux</span> <span class="id" title="var">p<sub>1</sub></span> <span class="id" title="var">p<sub>2</sub></span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">r</span> ⇒ <span class="id" title="var">r</span>)
</span>
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="cps_append_aux" class="idref" href="#cps_append_aux"><span class="id" title="definition">cps_append_aux</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#9c6e37d134b5d334d9e71c4ddf16d95c"><span class="id" title="notation">fix</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">p<sub>2</sub></span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''k'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''k'"><span class="id" title="notation">k</span></a> <a class="idref" href="LibSepReference.html#9c6e37d134b5d334d9e71c4ddf16d95c"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#3fbef795df792463de2da5f563e20424"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#null"><span class="id" title="definition">null</span></a><a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''k'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''k'"><span class="id" title="notation">k</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">p<sub>2</sub></span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q<sub>1</sub>'"><span class="id" title="notation">q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#8e45340a54d108624916002b0e01c7ee"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#tail"><span class="id" title="definition">tail</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''k<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''k<sub>2</sub>'"><span class="id" title="notation">k<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#6de150166dc2b6b515065825fd7ae19d"><span class="id" title="notation">fun_</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''r'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''r'"><span class="id" title="notation">r</span></a> <a class="idref" href="LibSepReference.html#6de150166dc2b6b515065825fd7ae19d"><span class="id" title="notation">⇒</span></a> <a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#ed9bce70f2e963efb3aa4cfc718e9949"><span class="id" title="notation">`.</span></a><a class="idref" href="Repr.html#tail"><span class="id" title="definition">tail</span></a> <a class="idref" href="LibSepReference.html#ed9bce70f2e963efb3aa4cfc718e9949"><span class="id" title="notation">:=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''r'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''r'"><span class="id" title="notation">r</span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''k'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''k'"><span class="id" title="notation">k</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">))</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''q<sub>1</sub>'"><span class="id" title="notation">q<sub>1</sub></span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">p<sub>2</sub></span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''k<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''k<sub>2</sub>'"><span class="id" title="notation">k<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="cps_append" class="idref" href="#cps_append"><span class="id" title="definition">cps_append</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#938475157e31b8b3433e07bd510fd74f"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">p<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#938475157e31b8b3433e07bd510fd74f"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#6de150166dc2b6b515065825fd7ae19d"><span class="id" title="notation">fun_</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''r'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''r'"><span class="id" title="notation">r</span></a> <a class="idref" href="LibSepReference.html#6de150166dc2b6b515065825fd7ae19d"><span class="id" title="notation">⇒</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''r'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''r'"><span class="id" title="notation">r</span></a><a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Repr.html#cps_append_aux"><span class="id" title="definition">cps_append_aux</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>1</sub>'"><span class="id" title="notation">p<sub>1</sub></span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p<sub>2</sub>'"><span class="id" title="notation">p<sub>2</sub></span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
<a id="lab80"></a><h4 class="section">Exercise: 5 stars, standard, optional (triple_cps_append)</h4>
 Specify and verify <span class="inlinecode"><span class="id" title="var">cps_append_aux</span></span>, then verify <span class="inlinecode"><span class="id" title="var">cps_append</span></span>. 
</div>
<div class="code">

<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="triple_cps_append" class="idref" href="#triple_cps_append"><span class="id" title="lemma">triple_cps_append</span></a> : <span class="id" title="keyword">∀</span> (<a id="L<sub>1</sub>:147" class="idref" href="#L<sub>1</sub>:147"><span class="id" title="binder">L<sub>1</sub></span></a> <a id="L<sub>2</sub>:148" class="idref" href="#L<sub>2</sub>:148"><span class="id" title="binder">L<sub>2</sub></span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>) (<a id="p<sub>1</sub>:149" class="idref" href="#p<sub>1</sub>:149"><span class="id" title="binder">p<sub>1</sub></span></a> <a id="p<sub>2</sub>:150" class="idref" href="#p<sub>2</sub>:150"><span class="id" title="binder">p<sub>2</sub></span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Repr.html#cps_append"><span class="id" title="definition">cps_append</span></a> <a class="idref" href="Repr.html#p<sub>1</sub>:149"><span class="id" title="variable">p<sub>1</sub></span></a> <a class="idref" href="Repr.html#p<sub>2</sub>:150"><span class="id" title="variable">p<sub>2</sub></span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Repr.html#L<sub>1</sub>:147"><span class="id" title="variable">L<sub>1</sub></span></a> <a class="idref" href="Repr.html#p<sub>1</sub>:149"><span class="id" title="variable">p<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> <a class="idref" href="Repr.html#L<sub>2</sub>:148"><span class="id" title="variable">L<sub>2</sub></span></a> <a class="idref" href="Repr.html#p<sub>2</sub>:150"><span class="id" title="variable">p<sub>2</sub></span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Basic.html#41749fe005eef2f7f0316a63bdabe5a<sub>8</sub>"><span class="id" title="notation">funloc</span></a> <a id="p<sub>3</sub>:151" class="idref" href="#p<sub>3</sub>:151"><span class="id" title="binder">p<sub>3</sub></span></a> <a class="idref" href="Basic.html#41749fe005eef2f7f0316a63bdabe5a<sub>8</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Repr.html#MList"><span class="id" title="definition">MList</span></a> (<a class="idref" href="Repr.html#L<sub>1</sub>:147"><span class="id" title="variable">L<sub>1</sub></span></a><span class="id" title="notation">++</span><a class="idref" href="Repr.html#L<sub>2</sub>:148"><span class="id" title="variable">L<sub>2</sub></span></a>) <a class="idref" href="Repr.html#p<sub>3</sub>:151"><span class="id" title="variable">p<sub>3</sub></span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab81"></a><h2 class="section">Historical Notes</h2>

<div class="paragraph"> </div>

 The representation predicate for lists appears in the seminal papers on
    Separation Logic: the notes by Reynolds from the summer 1999, updated the
    next summer <a href="Bib.html#Reynolds-2000"><span class="inlineref">[Reynolds 2000]</span></a>, and the publication by
    <a href="Bib.html#O’Hearn,-Reynolds, and Yang 2001"><span class="inlineref">[O’Hearn, Reynolds, and Yang 2001]</span></a>. The function <span class="inlinecode"><span class="id" title="var">cps_append</span></span> was
    proposed in Reynolds's article as an open challenge for verification.

<div class="paragraph"> </div>

    Most presentations of Separation Logic target partial correctness, whereas
    this chapters targets total correctness. The specifications of recursive
    functions are established using the built-in induction mechanism offered by
    Coq.

<div class="paragraph"> </div>

    The specification of higher-order iterators requires higher-order Separation
    Logic. Being embedded in the higher-order logic of Coq, the Separation Logic
    that we work with is inherently higher-order. Further information on the
    history of higher-order Separation Logic for higher-order programs may be
    found in section 10.2 of
    <a href='http://www.chargueraud.org/research/2020/seq_seplogic/seq_seplogic.pdf'>http://www.chargueraud.org/research/2020/seq_seplogic/seq_seplogic.pdf</a>. 
</div>
<div class="code">

<span class="comment">(*&nbsp;2021-06-29&nbsp;22:28&nbsp;*)</span><br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>