<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>Rules: Reasoning Rules for Term Constructs</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/slf.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 6: Separation Logic Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">Rules<span class="subtitle">Reasoning Rules for Term Constructs</span></h1>


<div class="code">

<span class="id" title="keyword">Set Implicit Arguments</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">From</span> <span class="id" title="var">SLF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="LibSepReference.html#"><span class="id" title="library">LibSepReference</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">SLF</span> <span class="id" title="keyword">Require</span> <a class="idref" href="Basic.html#"><span class="id" title="library">Basic</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">n</span> : <span class="id" title="notation">int</span>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">t</span> : <a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">r</span> <span class="id" title="var">v</span> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">p</span> : <a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">H</span> : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">Q</span> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>.<br/>
</div>

<div class="doc">
<a id="lab194"></a><h1 class="section">First Pass</h1>

<div class="paragraph"> </div>

 This chapter establishes the remaining reasoning rules of Separation Logic:
    rules for reasoning about each language construct, and rules for reasoning
    about primitive operations. All these reasoning rules are expressed using
    the predicate <span class="inlinecode"><span class="id" title="var">triple</span></span>, and are proved with respect to the formal semantics
    captured by the predicate <span class="inlinecode"><span class="id" title="tactic">eval</span></span> introduced in the previous chapter
    (<a href="Triples.html"><span class="inlineref">Triples</span></a>). Throughout the chapter, one needs to have in mind the
    definition of <span class="inlinecode"><span class="id" title="var">triple</span></span>:

<div class="paragraph"> </div>

<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">triple</span> (<span class="id" title="var">t</span>:<span class="id" title="var">trm</span>) (<span class="id" title="var">H</span>:<span class="id" title="var">hprop</span>) (<span class="id" title="var">Q</span>:<span class="id" title="var">val</span>→<span class="id" title="var">hprop</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">s</span>, <span class="id" title="var">H</span> <span class="id" title="var">s</span> → <span class="id" title="tactic">eval</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span> <span class="id" title="var">Q</span>.
</span>
<div class="paragraph"> </div>

    After establishing the reasoning rules, we present an example proof of a
    concrete program, using directly these reasoning rules, as opposed to using
    high-level "x-tactics" as in the first two chapters. This example proof
    reveals the proof patterns employed by the x-tactics. It also motivates the
    introduction of the x-tactics to avoid the tedious, repetitive proof
    patterns. 
</div>

<div class="doc">
<a id="lab195"></a><h2 class="section">Rules for Term Constructors</h2>

</div>

<div class="doc">
<a id="lab196"></a><h3 class="section">Sequences</h3>

<div class="paragraph"> </div>

 The Separation Logic reasoning rule for a sequence <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span>;<span class="id" title="var">t<sub>2</sub></span></span> is essentially
    the same as that from Hoare logic. In the rule shown below, the underscore
    symbol indicates that the output value produced by <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> is irrelevant to the
    semantics, as captured by the rule <span class="inlinecode"><span class="id" title="var">eval_seq</span></span>.
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">{H} t<sub>1</sub> {fun _ => H<sub>1</sub>}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{H<sub>1</sub>} t<sub>2</sub> {Q}</td>
  <td class="infrulenamecol" rowspan="3">
    &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">{H} (t<sub>1</sub>;t<sub>2</sub>) {Q}</td>
  <td></td>
</tr>
</table></center>    The Coq statement corresponding to the above rule is: 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_seq" class="idref" href="#triple_seq"><span class="id" title="lemma">triple_seq</span></a> : <span class="id" title="keyword">∀</span> <a id="t<sub>1</sub>:1" class="idref" href="#t<sub>1</sub>:1"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:2" class="idref" href="#t<sub>2</sub>:2"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="H:3" class="idref" href="#H:3"><span class="id" title="binder">H</span></a> <a id="Q:4" class="idref" href="#Q:4"><span class="id" title="binder">Q</span></a> <a id="H<sub>1</sub>:5" class="idref" href="#H<sub>1</sub>:5"><span class="id" title="binder">H<sub>1</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Rules.html#t<sub>1</sub>:1"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rules.html#H:3"><span class="id" title="variable">H</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Rules.html#H<sub>1</sub>:5"><span class="id" title="variable">H<sub>1</sub></span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Rules.html#t<sub>2</sub>:2"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="Rules.html#H<sub>1</sub>:5"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Rules.html#Q:4"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> <a class="idref" href="Rules.html#t<sub>1</sub>:1"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rules.html#t<sub>2</sub>:2"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Rules.html#H:3"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q:4"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
<a id="lab197"></a><h4 class="section">Exercise: 2 stars, standard, especially useful (triple_seq)</h4>
 Prove <span class="inlinecode"><span class="id" title="var">triple_seq</span></span> by unfolding <span class="inlinecode"><span class="id" title="var">triple</span></span> and using <span class="inlinecode"><span class="id" title="var">eval_seq</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab198"></a><h3 class="section">Let-Bindings</h3>

<div class="paragraph"> </div>

 Next, we present the reasoning rule for let-bindings. Here again, there is
    nothing specific to Separation Logic: the rule is exactly the same as in
    Hoare Logic. The rule for a <span class="inlinecode"><span class="id" title="keyword">let</span></span>-binding <span class="inlinecode"><span class="id" title="keyword">let</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="keyword">in</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> could be
    stated, informally, in the form:
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">{H} t<sub>1</sub> {Q<sub>1</sub>}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(forall x, {Q<sub>1</sub> x} t<sub>2</sub> {Q})</td>
  <td class="infrulenamecol" rowspan="3">
    &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">{H} (let x = t<sub>1</sub> in t<sub>2</sub>) {Q}</td>
  <td></td>
</tr>
</table></center>   However, this presentation confuses the <span class="inlinecode"><span class="id" title="var">x</span></span> that denotes a program variable
   in <span class="inlinecode"><span class="id" title="keyword">let</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="keyword">in</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>, and the <span class="inlinecode"><span class="id" title="var">x</span></span> that denotes a universally quantified Coq
   value. The correct statement involves a substitution from the variable <span class="inlinecode"><span class="id" title="var">x</span></span> to
   a value quantified as <span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode">(<span class="id" title="var">v</span>:<span class="id" title="var">val</span>)</span>.
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">{H} t<sub>1</sub> {Q<sub>1</sub>}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(forall v, {Q<sub>1</sub> v} (subst x v t<sub>2</sub>) {Q})</td>
  <td class="infrulenamecol" rowspan="3">
    &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">{H} (let x = t<sub>1</sub> in t<sub>2</sub>) {Q}</td>
  <td></td>
</tr>
</table></center>   The corresponding Coq statement is thus. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_let" class="idref" href="#triple_let"><span class="id" title="lemma">triple_let</span></a> : <span class="id" title="keyword">∀</span> <a id="x:6" class="idref" href="#x:6"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:7" class="idref" href="#t<sub>1</sub>:7"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:8" class="idref" href="#t<sub>2</sub>:8"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="Q<sub>1</sub>:9" class="idref" href="#Q<sub>1</sub>:9"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="H:10" class="idref" href="#H:10"><span class="id" title="binder">H</span></a> <a id="Q:11" class="idref" href="#Q:11"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Rules.html#t<sub>1</sub>:7"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rules.html#H:10"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q<sub>1</sub>:9"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="v<sub>1</sub>:12" class="idref" href="#v<sub>1</sub>:12"><span class="id" title="binder">v<sub>1</sub></span></a>, <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Rules.html#x:6"><span class="id" title="variable">x</span></a> <a class="idref" href="Rules.html#v<sub>1</sub>:12"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Rules.html#t<sub>2</sub>:8"><span class="id" title="variable">t<sub>2</sub></span></a>) (<a class="idref" href="Rules.html#Q<sub>1</sub>:9"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Rules.html#v<sub>1</sub>:12"><span class="id" title="variable">v<sub>1</sub></span></a>) <a class="idref" href="Rules.html#Q:11"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="Rules.html#x:6"><span class="id" title="variable">x</span></a> <a class="idref" href="Rules.html#t<sub>1</sub>:7"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rules.html#t<sub>2</sub>:8"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Rules.html#H:10"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q:11"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">M<sub>2</sub></span> <span class="id" title="var">Hs</span>. <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#eval_let"><span class="id" title="constructor">eval_let</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
When we carry out proofs in practice, the application of the rule
    <span class="inlinecode"><span class="id" title="var">triple_let</span></span> produces a second sub-goal of the form, e.g.:
    <span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span>,</span> <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode">(<span class="id" title="tactic">subst</span></span> <span class="inlinecode">&quot;<span class="id" title="var">a</span>&quot;</span> <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">rest_of_the_program</span>)</span> <span class="inlinecode">(<span class="id" title="var">post1</span></span> <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span>)</span> <span class="inlinecode"><span class="id" title="var">post2</span></span>,
    where "a" denotes the name of the program variable that was bound by the
    let-binding in the original source code. At this point, the user would
    typically type <span class="inlinecode"><span class="id" title="tactic">intros</span></span> <span class="inlinecode"><span class="id" title="var">a</span></span>, to introduce the Coq variable <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span> under the same
    name that it had in the source code. This operations produces:
    <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode">(<span class="id" title="tactic">subst</span></span> <span class="inlinecode">&quot;<span class="id" title="var">a</span>&quot;</span> <span class="inlinecode"><span class="id" title="var">a</span></span> <span class="inlinecode"><span class="id" title="var">rest_of_the_program</span>)</span> <span class="inlinecode">(<span class="id" title="var">post1</span></span> <span class="inlinecode"><span class="id" title="var">a</span>)</span> <span class="inlinecode"><span class="id" title="var">post2</span></span>. At that point,
    the user may call <span class="inlinecode"><span class="id" title="tactic">simpl</span></span> to effectively replace all occurences of the
    program variable <span class="inlinecode">&quot;<span class="id" title="var">a</span>&quot;</span> with the Coq variable <span class="inlinecode"><span class="id" title="var">a</span></span> of type <span class="inlinecode"><span class="id" title="var">val</span></span>. Doing so
    produces: <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">rest_of_the_program_updated</span></span> <span class="inlinecode">(<span class="id" title="var">post1</span></span> <span class="inlinecode"><span class="id" title="var">a</span>)</span> <span class="inlinecode"><span class="id" title="var">post2</span></span>, where
    <span class="inlinecode"><span class="id" title="var">rest_of_the_program_updated</span></span> refers to the Coq variable <span class="inlinecode"><span class="id" title="var">a</span></span>. This process
    will be illustrated in the proof of <span class="inlinecode"><span class="id" title="var">triple_incr</span></span> further on. 
</div>

<div class="doc">
<a id="lab199"></a><h3 class="section">Conditionals</h3>

<div class="paragraph"> </div>

 The rule for a conditional is, again, exactly like in Hoare logic.
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">b = true <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> {H} t<sub>1</sub> {Q}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b = false <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> {H} t<sub>2</sub> {Q}</td>
  <td class="infrulenamecol" rowspan="3">
    &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">{H} (if b then t<sub>1</sub> in t<sub>2</sub>) {Q}</td>
  <td></td>
</tr>
</table></center>  The corresponding Coq statement is: 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_if_case" class="idref" href="#triple_if_case"><span class="id" title="lemma">triple_if_case</span></a> : <span class="id" title="keyword">∀</span> <a id="b:13" class="idref" href="#b:13"><span class="id" title="binder">b</span></a> <a id="t<sub>1</sub>:14" class="idref" href="#t<sub>1</sub>:14"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:15" class="idref" href="#t<sub>2</sub>:15"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="H:16" class="idref" href="#H:16"><span class="id" title="binder">H</span></a> <a id="Q:17" class="idref" href="#Q:17"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Rules.html#b:13"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Rules.html#t<sub>1</sub>:14"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rules.html#H:16"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q:17"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Rules.html#b:13"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Rules.html#t<sub>2</sub>:15"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="Rules.html#H:16"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q:17"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> (<a class="idref" href="LibSepReference.html#val_bool"><span class="id" title="constructor">val_bool</span></a> <a class="idref" href="Rules.html#b:13"><span class="id" title="variable">b</span></a>) <a class="idref" href="Rules.html#t<sub>1</sub>:14"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rules.html#t<sub>2</sub>:15"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Rules.html#H:16"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q:17"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
<a id="lab200"></a><h4 class="section">Exercise: 2 stars, standard, especially useful (triple_if_case)</h4>
 Prove <span class="inlinecode"><span class="id" title="var">triple_if_case</span></span> by unfolding <span class="inlinecode"><span class="id" title="var">triple</span></span> and using <span class="inlinecode"><span class="id" title="var">eval_if</span></span>. Hint: use
    the tactic <span class="inlinecode"><span class="id" title="var">case_if</span></span> to perform a case analysis. 
</div>
<div class="code">

<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 The two premises of the rule for if-statements may be factorized into a
    single one using Coq's conditional construct, as in <span class="inlinecode"><span class="id" title="var">eval_if</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_if" class="idref" href="#triple_if"><span class="id" title="lemma">triple_if</span></a> : <span class="id" title="keyword">∀</span> (<a id="b:18" class="idref" href="#b:18"><span class="id" title="binder">b</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>) <a id="t<sub>1</sub>:19" class="idref" href="#t<sub>1</sub>:19"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:20" class="idref" href="#t<sub>2</sub>:20"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="H:21" class="idref" href="#H:21"><span class="id" title="binder">H</span></a> <a id="Q:22" class="idref" href="#Q:22"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<span class="id" title="keyword">if</span> <a class="idref" href="Rules.html#b:18"><span class="id" title="variable">b</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="Rules.html#t<sub>1</sub>:19"><span class="id" title="variable">t<sub>1</sub></span></a> <span class="id" title="keyword">else</span> <a class="idref" href="Rules.html#t<sub>2</sub>:20"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Rules.html#H:21"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q:22"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> <a class="idref" href="Rules.html#b:18"><span class="id" title="variable">b</span></a> <a class="idref" href="Rules.html#t<sub>1</sub>:19"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rules.html#t<sub>2</sub>:20"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Rules.html#H:21"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q:22"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span> <span class="id" title="var">Hs</span>. <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#eval_if"><span class="id" title="constructor">eval_if</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab201"></a><h3 class="section">Values</h3>

<div class="paragraph"> </div>

 The triple specifying the behavior of a value <span class="inlinecode"><span class="id" title="var">v</span></span> can be written as a triple
    with an empty precondition and a postcondition asserting that the result
    value <span class="inlinecode"><span class="id" title="var">r</span></span> is equal to <span class="inlinecode"><span class="id" title="var">v</span></span>, in the empty heap. Formally:
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">{<span class='gray-font'>\</span>[]} v {fun r => <span class='gray-font'>\</span>[r = v]}</td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>

    In practice, however, it is more convenient to work with a judgment whose
    conclusion has the form <span class="inlinecode">{<span class="id" title="var">H</span>}</span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode">{<span class="id" title="var">Q</span>}</span>, for an arbitrary precondition <span class="inlinecode"><span class="id" title="var">H</span></span> and
    postcondition <span class="inlinecode"><span class="id" title="var">Q</span></span>.
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">H ==> Q v</td>
  <td class="infrulenamecol" rowspan="3">
    &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">{H} v {Q}</td>
  <td></td>
</tr>
</table></center>    The Coq statement of the rule for values is thus as follows. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_val" class="idref" href="#triple_val"><span class="id" title="lemma">triple_val</span></a> : <span class="id" title="keyword">∀</span> <a id="v:23" class="idref" href="#v:23"><span class="id" title="binder">v</span></a> <a id="H:24" class="idref" href="#H:24"><span class="id" title="binder">H</span></a> <a id="Q:25" class="idref" href="#Q:25"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rules.html#H:24"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Rules.html#Q:25"><span class="id" title="variable">Q</span></a> <a class="idref" href="Rules.html#v:23"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <a class="idref" href="Rules.html#v:23"><span class="id" title="variable">v</span></a>) <a class="idref" href="Rules.html#H:24"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q:25"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span> <span class="id" title="var">Hs</span>. <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#eval_val"><span class="id" title="constructor">eval_val</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
It may not be obvious at first sight why <span class="inlinecode"><span class="id" title="var">triple_val</span></span> is equivalent to the
    "minimalistic" rule <span class="inlinecode">{<span class='gray-font'>\</span>[]}</span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode">{<span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">r</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">r</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">v</span>]}</span>. Let us prove the
    equivalence. 
<div class="paragraph"> </div>

<a id="lab202"></a><h4 class="section">Exercise: 1 star, standard, especially useful (triple_val_minimal)</h4>
 Prove that the first rule for values is derivable from <span class="inlinecode"><span class="id" title="var">triple_val</span></span>. Hint:
    use the tactic <span class="inlinecode"><span class="id" title="var">xsimpl</span></span> to conclude the proof. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_val_minimal" class="idref" href="#triple_val_minimal"><span class="id" title="lemma">triple_val_minimal</span></a> : <span class="id" title="keyword">∀</span> <a id="v:26" class="idref" href="#v:26"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <a class="idref" href="Rules.html#v:26"><span class="id" title="variable">v</span></a>) <a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a> (<span class="id" title="keyword">fun</span> <a id="r:27" class="idref" href="#r:27"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Rules.html#r:27"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Rules.html#v:26"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a id="lab203"></a><h4 class="section">Exercise: 2 stars, standard, especially useful (triple_val')</h4>
 More interestingly, prove that <span class="inlinecode"><span class="id" title="var">triple_val</span></span> is derivable from
    <span class="inlinecode"><span class="id" title="var">triple_val_minimal</span></span>. Concretely, your goal is to prove <span class="inlinecode"><span class="id" title="var">triple_val'</span></span>
    without unfolding the definition of <span class="inlinecode"><span class="id" title="var">triple</span></span>. Use <span class="inlinecode"><span class="id" title="var">triple_conseq_frame</span></span>,
    <span class="inlinecode"><span class="id" title="var">triple_val_minimal</span></span>, and <span class="inlinecode"><span class="id" title="var">xsimpl</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_val'" class="idref" href="#triple_val'"><span class="id" title="lemma">triple_val'</span></a> : <span class="id" title="keyword">∀</span> <a id="v:28" class="idref" href="#v:28"><span class="id" title="binder">v</span></a> <a id="H:29" class="idref" href="#H:29"><span class="id" title="binder">H</span></a> <a id="Q:30" class="idref" href="#Q:30"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rules.html#H:29"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Rules.html#Q:30"><span class="id" title="variable">Q</span></a> <a class="idref" href="Rules.html#v:28"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <a class="idref" href="Rules.html#v:28"><span class="id" title="variable">v</span></a>) <a class="idref" href="Rules.html#H:29"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q:30"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a id="lab204"></a><h4 class="section">Exercise: 4 stars, standard, especially useful (triple_let_val)</h4>
 Consider a term of the form <span class="inlinecode"><span class="id" title="keyword">let</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="keyword">in</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>, that is, where the argument
    of the let-binding is already a value. State and prove a reasoning rule of
    the form:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">triple_let_val</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">v<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="var">H</span> <span class="id" title="var">Q</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;... →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">triple</span> (<span class="id" title="var">trm_let</span> <span class="id" title="var">x</span> <span class="id" title="var">v<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>) <span class="id" title="var">H</span> <span class="id" title="var">Q</span>.
</span>
</div>
<div class="code">

<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab205"></a><h3 class="section">Function Definitions</h3>

<div class="paragraph"> </div>

 Recall from the previous chapter the distinction between <span class="inlinecode"><span class="id" title="var">val_fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>,
    which denotes a closed value, and <span class="inlinecode"><span class="id" title="var">trm_fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>, which corresponds to a
    term that may contain free variables. By the time the evaluation of a
    program reaches a <span class="inlinecode"><span class="id" title="var">trm_fun</span></span>, all its free variables should have been
    substituted by values. At this point, the rule <span class="inlinecode"><span class="id" title="var">eval_fun</span></span> reduces the
    <span class="inlinecode"><span class="id" title="var">trm_fun</span></span> into a <span class="inlinecode"><span class="id" title="var">val_fun</span></span>.

<div class="paragraph"> </div>

    We need a rule in the program logic to mimic this transition from <span class="inlinecode"><span class="id" title="var">trm_fun</span></span>
    to <span class="inlinecode"><span class="id" title="var">val_fun</span></span>. We have two ways to state this rule, similar to the two ways
    of stating the rule for reasoning about values. The first possibility is to
    consider a rule with an empty precondition.
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">{<span class='gray-font'>\</span>[]} (trm_fun x t<sub>1</sub>) {fun r => <span class='gray-font'>\</span>[r = val_fun x t<sub>1</sub>]}</td>
  <td></td>
</tr>
</table></center>  The second possibility, which leads to a more practical rule, features a
  conclusion of the form <span class="inlinecode">{<span class="id" title="var">H</span>}</span> <span class="inlinecode">(<span class="id" title="var">trm_fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span>)</span> <span class="inlinecode">{<span class="id" title="var">Q</span>}</span>, with <span class="inlinecode"><span class="id" title="var">H</span></span> and <span class="inlinecode"><span class="id" title="var">Q</span></span>
  unconstrained. The resulting rule, <span class="inlinecode"><span class="id" title="var">triple_fun</span></span> is structured similarly to
  <span class="inlinecode"><span class="id" title="var">triple_val</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_fun" class="idref" href="#triple_fun"><span class="id" title="lemma">triple_fun</span></a> : <span class="id" title="keyword">∀</span> <a id="x:31" class="idref" href="#x:31"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:32" class="idref" href="#t<sub>1</sub>:32"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="H:33" class="idref" href="#H:33"><span class="id" title="binder">H</span></a> <a id="Q:34" class="idref" href="#Q:34"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rules.html#H:33"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Rules.html#Q:34"><span class="id" title="variable">Q</span></a> (<a class="idref" href="LibSepReference.html#val_fun"><span class="id" title="constructor">val_fun</span></a> <a class="idref" href="Rules.html#x:31"><span class="id" title="variable">x</span></a> <a class="idref" href="Rules.html#t<sub>1</sub>:32"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_fun"><span class="id" title="constructor">trm_fun</span></a> <a class="idref" href="Rules.html#x:31"><span class="id" title="variable">x</span></a> <a class="idref" href="Rules.html#t<sub>1</sub>:32"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="Rules.html#H:33"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q:34"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span> <span class="id" title="var">Hs</span>. <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#eval_fun"><span class="id" title="constructor">eval_fun</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
This reasoning rules for functions generalizes to recursive functions. A
    term describing a recursive function is written <span class="inlinecode"><span class="id" title="var">trm_fix</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>, and the
    corresponding value is written <span class="inlinecode"><span class="id" title="var">val_fix</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_fix" class="idref" href="#triple_fix"><span class="id" title="lemma">triple_fix</span></a> : <span class="id" title="keyword">∀</span> <a id="f:35" class="idref" href="#f:35"><span class="id" title="binder">f</span></a> <a id="x:36" class="idref" href="#x:36"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:37" class="idref" href="#t<sub>1</sub>:37"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="H:38" class="idref" href="#H:38"><span class="id" title="binder">H</span></a> <a id="Q:39" class="idref" href="#Q:39"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rules.html#H:38"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Rules.html#Q:39"><span class="id" title="variable">Q</span></a> (<a class="idref" href="LibSepReference.html#val_fix"><span class="id" title="constructor">val_fix</span></a> <a class="idref" href="Rules.html#f:35"><span class="id" title="variable">f</span></a> <a class="idref" href="Rules.html#x:36"><span class="id" title="variable">x</span></a> <a class="idref" href="Rules.html#t<sub>1</sub>:37"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_fix"><span class="id" title="constructor">trm_fix</span></a> <a class="idref" href="Rules.html#f:35"><span class="id" title="variable">f</span></a> <a class="idref" href="Rules.html#x:36"><span class="id" title="variable">x</span></a> <a class="idref" href="Rules.html#t<sub>1</sub>:37"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="Rules.html#H:38"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q:39"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span> <span class="id" title="var">Hs</span>. <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#eval_fix"><span class="id" title="constructor">eval_fix</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab206"></a><h3 class="section">Function Calls</h3>

<div class="paragraph"> </div>

 Last but not least, we need a reasoning rule to reason about function
    applications. Consider an application <span class="inlinecode"><span class="id" title="var">trm_app</span></span> <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">v<sub>2</sub></span></span>. Assume <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span> to be a
    function, that is, to be of the form <span class="inlinecode"><span class="id" title="var">val_fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>. Then, according to the
    beta-reduction rule, the semantics of <span class="inlinecode"><span class="id" title="var">trm_app</span></span> <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">v<sub>2</sub></span></span> is the same as that of
    <span class="inlinecode"><span class="id" title="tactic">subst</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">v<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>. This reasoning rule is thus:
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">v<sub>1</sub> = val_fun x t<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{H} (subst x v<sub>2</sub> t<sub>1</sub>) {Q}</td>
  <td class="infrulenamecol" rowspan="3">
    &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">{H} (trm_app v<sub>1</sub> v<sub>2</sub>) {Q}</td>
  <td></td>
</tr>
</table></center>   Observe that this reasoning rule requires <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span> to be a known value. In
   particular, <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span> cannot be a program variable or an unspecified program
   value. More precisely:

<div class="paragraph"> </div>

<ul class="doclist">
<li> If <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span> was a program variable (that is, a <span class="inlinecode"><span class="id" title="var">trm_var</span></span>) in the original
     source code, then this program variable should have been substituted by
     a Coq value or variable of type <span class="inlinecode"><span class="id" title="var">val</span></span> by the time we reach this function
     call. Otherwise, the variable would correspond to a dangling free variable.

</li>
<li> If <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span> is a Coq variable of type <span class="inlinecode"><span class="id" title="var">val</span></span> but with no assumption of the form
     <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">val_fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>, it is probably the case that we already have
     established a specification lemma for the function <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span> earlier in the
     reasoning. It this case, the rule above generally cannot be applied.
     Instead, one should apply the specification lemma for <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span>, which
     is expected to have a conclusion of the form <span class="inlinecode">{..}</span> <span class="inlinecode">(<span class="id" title="var">trm_app</span></span> <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span> <span class="inlinecode">..)</span> <span class="inlinecode">{..}</span>,
     matching the proof obligation at hand.

</li>
</ul>

<div class="paragraph"> </div>

   Let's come back to the case where we are interested in establishing a triple
   for a concrete function, whose code is known. The reasoning rule stated above
   translates in Coq as shown below. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_app_fun" class="idref" href="#triple_app_fun"><span class="id" title="lemma">triple_app_fun</span></a> : <span class="id" title="keyword">∀</span> <a id="x:40" class="idref" href="#x:40"><span class="id" title="binder">x</span></a> <a id="v<sub>1</sub>:41" class="idref" href="#v<sub>1</sub>:41"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="v<sub>2</sub>:42" class="idref" href="#v<sub>2</sub>:42"><span class="id" title="binder">v<sub>2</sub></span></a> <a id="t<sub>1</sub>:43" class="idref" href="#t<sub>1</sub>:43"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="H:44" class="idref" href="#H:44"><span class="id" title="binder">H</span></a> <a id="Q:45" class="idref" href="#Q:45"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rules.html#v<sub>1</sub>:41"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_fun"><span class="id" title="constructor">val_fun</span></a> <a class="idref" href="Rules.html#x:40"><span class="id" title="variable">x</span></a> <a class="idref" href="Rules.html#t<sub>1</sub>:43"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Rules.html#x:40"><span class="id" title="variable">x</span></a> <a class="idref" href="Rules.html#v<sub>2</sub>:42"><span class="id" title="variable">v<sub>2</sub></span></a> <a class="idref" href="Rules.html#t<sub>1</sub>:43"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="Rules.html#H:44"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q:45"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="Rules.html#v<sub>1</sub>:41"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Rules.html#v<sub>2</sub>:42"><span class="id" title="variable">v<sub>2</sub></span></a>) <a class="idref" href="Rules.html#H:44"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q:45"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">E</span> <span class="id" title="var">M</span> <span class="id" title="var">Hs</span>. <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#eval_app_fun"><span class="id" title="constructor">eval_app_fun</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The reasoning rule that corresponds to beta-reduction for a recursive
    function involves <i>two</i> substitutions: a first substitution for recursive
    occurrences of the function, followed with a second substitution for the
    argument provided to the call. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_app_fix" class="idref" href="#triple_app_fix"><span class="id" title="lemma">triple_app_fix</span></a> : <span class="id" title="keyword">∀</span> <a id="v<sub>1</sub>:46" class="idref" href="#v<sub>1</sub>:46"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="v<sub>2</sub>:47" class="idref" href="#v<sub>2</sub>:47"><span class="id" title="binder">v<sub>2</sub></span></a> <a id="f:48" class="idref" href="#f:48"><span class="id" title="binder">f</span></a> <a id="x:49" class="idref" href="#x:49"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:50" class="idref" href="#t<sub>1</sub>:50"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="H:51" class="idref" href="#H:51"><span class="id" title="binder">H</span></a> <a id="Q:52" class="idref" href="#Q:52"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rules.html#v<sub>1</sub>:46"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_fix"><span class="id" title="constructor">val_fix</span></a> <a class="idref" href="Rules.html#f:48"><span class="id" title="variable">f</span></a> <a class="idref" href="Rules.html#x:49"><span class="id" title="variable">x</span></a> <a class="idref" href="Rules.html#t<sub>1</sub>:50"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Rules.html#x:49"><span class="id" title="variable">x</span></a> <a class="idref" href="Rules.html#v<sub>2</sub>:47"><span class="id" title="variable">v<sub>2</sub></span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Rules.html#f:48"><span class="id" title="variable">f</span></a> <a class="idref" href="Rules.html#v<sub>1</sub>:46"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Rules.html#t<sub>1</sub>:50"><span class="id" title="variable">t<sub>1</sub></span></a>)) <a class="idref" href="Rules.html#H:51"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q:52"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="Rules.html#v<sub>1</sub>:46"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Rules.html#v<sub>2</sub>:47"><span class="id" title="variable">v<sub>2</sub></span></a>) <a class="idref" href="Rules.html#H:51"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q:52"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">E</span> <span class="id" title="var">M</span> <span class="id" title="var">Hs</span>. <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#eval_app_fix"><span class="id" title="constructor">eval_app_fix</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
This concludes the presentation of the reasoning rules for term constructs.
    Before we can tackle the verification of actual programs, there remains to
    present the specifications for the primitive operations. We start with
    arithmetic operations, then consider heap-manipulating operations. 
</div>

<div class="doc">
<a id="lab207"></a><h2 class="section">Primitive Arithmetic Operations</h2>

</div>

<div class="doc">
<a id="lab208"></a><h3 class="section">Addition</h3>

<div class="paragraph"> </div>

 Consider a term of the form <span class="inlinecode"><span class="id" title="var">val_add</span></span> <span class="inlinecode"><span class="id" title="var">n<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">n<sub>2</sub></span></span>, which is short for
    <span class="inlinecode"><span class="id" title="var">trm_app</span></span> <span class="inlinecode">(<span class="id" title="var">trm_app</span></span> <span class="inlinecode">(<span class="id" title="var">trm_val</span></span> <span class="inlinecode"><span class="id" title="var">val_add</span>)</span> <span class="inlinecode">(<span class="id" title="var">val_int</span></span> <span class="inlinecode"><span class="id" title="var">n<sub>1</sub></span>))</span> <span class="inlinecode">(<span class="id" title="var">val_int</span></span> <span class="inlinecode"><span class="id" title="var">n<sub>2</sub></span>)</span>, if we
    unfold the coercion <span class="inlinecode"><span class="id" title="var">val_int</span></span>.

<div class="paragraph"> </div>

    The addition operation may execute in an empty state. It does not modify the
    state, and returns the value <span class="inlinecode"><span class="id" title="var">val_int</span></span> <span class="inlinecode">(<span class="id" title="var">n<sub>1</sub></span>+<span class="id" title="var">n<sub>2</sub></span>)</span>. Recall the statement of the
    evaluation rule, in omni-big-step style. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="eval_add" class="idref" href="#eval_add"><span class="id" title="axiom">eval_add</span></a> : <span class="id" title="keyword">∀</span> <a id="s:53" class="idref" href="#s:53"><span class="id" title="binder">s</span></a> <a id="n<sub>1</sub>:54" class="idref" href="#n<sub>1</sub>:54"><span class="id" title="binder">n<sub>1</sub></span></a> <a id="n<sub>2</sub>:55" class="idref" href="#n<sub>2</sub>:55"><span class="id" title="binder">n<sub>2</sub></span></a> <a id="Q:56" class="idref" href="#Q:56"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rules.html#Q:56"><span class="id" title="variable">Q</span></a> (<a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> (<a class="idref" href="Rules.html#n<sub>1</sub>:54"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="Rules.html#n<sub>2</sub>:55"><span class="id" title="variable">n<sub>2</sub></span></a>)) <a class="idref" href="Rules.html#s:53"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Rules.html#s:53"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#val_add"><span class="id" title="constructor">val_add</span></a> (<a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Rules.html#n<sub>1</sub>:54"><span class="id" title="variable">n<sub>1</sub></span></a>) (<a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Rules.html#n<sub>2</sub>:55"><span class="id" title="variable">n<sub>2</sub></span></a>)) <a class="idref" href="Rules.html#Q:56"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
In the specification shown below, the precondition is written <span class="inlinecode"><span class='gray-font'>\</span>[]</span> and the
    postcondition binds a return value <span class="inlinecode"><span class="id" title="var">r</span></span> of type <span class="inlinecode"><span class="id" title="var">val</span></span> specified to be equal
    to <span class="inlinecode"><span class="id" title="var">val_int</span></span> <span class="inlinecode">(<span class="id" title="var">n<sub>1</sub></span>+<span class="id" title="var">n<sub>2</sub></span>)</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_add" class="idref" href="#triple_add"><span class="id" title="lemma">triple_add</span></a> : <span class="id" title="keyword">∀</span> <a id="n<sub>1</sub>:58" class="idref" href="#n<sub>1</sub>:58"><span class="id" title="binder">n<sub>1</sub></span></a> <a id="n<sub>2</sub>:59" class="idref" href="#n<sub>2</sub>:59"><span class="id" title="binder">n<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_add"><span class="id" title="constructor">val_add</span></a> <a class="idref" href="Rules.html#n<sub>1</sub>:58"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Rules.html#n<sub>2</sub>:59"><span class="id" title="variable">n<sub>2</sub></span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:60" class="idref" href="#r:60"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Rules.html#r:60"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> (<a class="idref" href="Rules.html#n<sub>1</sub>:58"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="Rules.html#n<sub>2</sub>:59"><span class="id" title="variable">n<sub>2</sub></span></a>)<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">Hs</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Rules.html#eval_add"><span class="id" title="axiom">eval_add</span></a>. <span class="id" title="var">lets</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>: <a class="idref" href="LibSepReference.html#SepSimplArgs.hempty_inv"><span class="id" title="lemma">hempty_inv</span></a> <span class="id" title="var">Hs</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hpure_intro"><span class="id" title="lemma">hpure_intro</span></a>. <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Technically, for a simple function such as addition, we could state a
    specification in a similar form as <span class="inlinecode"><span class="id" title="var">triple_val</span></span>, with an entailment of the
    form <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span>, as shown below. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_add'" class="idref" href="#triple_add'"><span class="id" title="lemma">triple_add'</span></a> : <span class="id" title="keyword">∀</span> <a id="H:61" class="idref" href="#H:61"><span class="id" title="binder">H</span></a> <a id="Q:62" class="idref" href="#Q:62"><span class="id" title="binder">Q</span></a> <a id="n<sub>1</sub>:63" class="idref" href="#n<sub>1</sub>:63"><span class="id" title="binder">n<sub>1</sub></span></a> <a id="n<sub>2</sub>:64" class="idref" href="#n<sub>2</sub>:64"><span class="id" title="binder">n<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rules.html#H:61"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Rules.html#Q:62"><span class="id" title="variable">Q</span></a> (<a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> (<a class="idref" href="Rules.html#n<sub>1</sub>:63"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="Rules.html#n<sub>2</sub>:64"><span class="id" title="variable">n<sub>2</sub></span></a>)) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_add"><span class="id" title="constructor">val_add</span></a> <a class="idref" href="Rules.html#n<sub>1</sub>:63"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Rules.html#n<sub>2</sub>:64"><span class="id" title="variable">n<sub>2</sub></span></a>) <a class="idref" href="Rules.html#H:61"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q:62"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_conseq_frame"><span class="id" title="lemma">triple_conseq_frame</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Rules.html#triple_add"><span class="id" title="lemma">triple_add</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> ? →. <span class="id" title="tactic">auto</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Yet, this pattern does not generalize well to more complex functions with
    nonempty preconditions. Instead, for specifying functions, we follow by
    convention the pattern of "minimal footprint specifications", where the
    precondition of the function covers no more than what the function needs to
    access. For example:

<div class="paragraph"> </div>

<ul class="doclist">
<li> the <span class="inlinecode"><span class="id" title="var">add</span></span> operation does not access the memory state, so it should be
      specified with <span class="inlinecode"><span class='gray-font'>\</span>[]</span> as precondition;

</li>
<li> the <span class="inlinecode"><span class="id" title="var">get</span></span> operation on a reference accesses exactly one cell, so it
      should be specified using a precondition of the form <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">v</span></span>;

</li>
<li> the <span class="inlinecode"><span class="id" title="var">mlist_length</span></span> operation traverses one mutable linked list, so it
      should be specified using a precondition of the form <span class="inlinecode"><span class="id" title="var">MList</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span>.

</li>
</ul>

<div class="paragraph"> </div>

    There are a few situations where the precondition of a function may be an
    over-approximation, to avoid complications. For example, a function that
    gives the index of the first occurrence of a value <span class="inlinecode"><span class="id" title="var">v</span></span> in a mutable list at
    address <span class="inlinecode"><span class="id" title="var">p</span></span> would typically be specified with a precondition of the form
    <span class="inlinecode"><span class="id" title="var">MList</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">L</span></span> describing the full linked list, rather than a precondition
    describing the the smallest prefix of the list that reaches a cell with
    value <span class="inlinecode"><span class="id" title="var">v</span></span>. 
</div>

<div class="doc">
<a id="lab209"></a><h3 class="section">Division</h3>

<div class="paragraph"> </div>

 The specification of the division operation <span class="inlinecode"><span class="id" title="var">val_div</span></span> <span class="inlinecode"><span class="id" title="var">n<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">n<sub>2</sub></span></span> is similar, yet
    with the extra requirement that the argument <span class="inlinecode"><span class="id" title="var">n<sub>2</sub></span></span> must be nonzero. This
    requirement <span class="inlinecode"><span class="id" title="var">n<sub>2</sub></span></span> <span class="inlinecode">≠</span> <span class="inlinecode">0</span> appears in the evaluation rule as well as in the
    reasoning rule. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="eval_div" class="idref" href="#eval_div"><span class="id" title="axiom">eval_div</span></a> : <span class="id" title="keyword">∀</span> <a id="s:65" class="idref" href="#s:65"><span class="id" title="binder">s</span></a> <a id="n<sub>1</sub>:66" class="idref" href="#n<sub>1</sub>:66"><span class="id" title="binder">n<sub>1</sub></span></a> <a id="n<sub>2</sub>:67" class="idref" href="#n<sub>2</sub>:67"><span class="id" title="binder">n<sub>2</sub></span></a> <a id="Q:68" class="idref" href="#Q:68"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rules.html#n<sub>2</sub>:67"><span class="id" title="variable">n<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Rules.html#Q:68"><span class="id" title="variable">Q</span></a> (<a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#Z.quot"><span class="id" title="definition">Z.quot</span></a> <a class="idref" href="Rules.html#n<sub>1</sub>:66"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Rules.html#n<sub>2</sub>:67"><span class="id" title="variable">n<sub>2</sub></span></a>)) <a class="idref" href="Rules.html#s:65"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Rules.html#s:65"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#val_div"><span class="id" title="constructor">val_div</span></a> (<a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Rules.html#n<sub>1</sub>:66"><span class="id" title="variable">n<sub>1</sub></span></a>) (<a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Rules.html#n<sub>2</sub>:67"><span class="id" title="variable">n<sub>2</sub></span></a>)) <a class="idref" href="Rules.html#Q:68"><span class="id" title="variable">Q</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="triple_div" class="idref" href="#triple_div"><span class="id" title="lemma">triple_div</span></a> : <span class="id" title="keyword">∀</span> <a id="n<sub>1</sub>:70" class="idref" href="#n<sub>1</sub>:70"><span class="id" title="binder">n<sub>1</sub></span></a> <a id="n<sub>2</sub>:71" class="idref" href="#n<sub>2</sub>:71"><span class="id" title="binder">n<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rules.html#n<sub>2</sub>:71"><span class="id" title="variable">n<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_div"><span class="id" title="constructor">val_div</span></a> <a class="idref" href="Rules.html#n<sub>1</sub>:70"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Rules.html#n<sub>2</sub>:71"><span class="id" title="variable">n<sub>2</sub></span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:72" class="idref" href="#r:72"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Rules.html#r:72"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#Z.quot"><span class="id" title="definition">Z.quot</span></a> <a class="idref" href="Rules.html#n<sub>1</sub>:70"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Rules.html#n<sub>2</sub>:71"><span class="id" title="variable">n<sub>2</sub></span></a>)<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">Hn<sub>2</sub></span> <span class="id" title="var">Hs</span>. <span class="id" title="var">applys</span>* <a class="idref" href="Rules.html#eval_div"><span class="id" title="axiom">eval_div</span></a>. <span class="id" title="var">lets</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>: <a class="idref" href="LibSepReference.html#SepSimplArgs.hempty_inv"><span class="id" title="lemma">hempty_inv</span></a> <span class="id" title="var">Hs</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hpure_intro"><span class="id" title="lemma">hpure_intro</span></a>. <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab210"></a><h3 class="section">Random-Number Generation</h3>

<div class="paragraph"> </div>

 The evaluation of <span class="inlinecode"><span class="id" title="var">val_rand</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> is particularly interesting because it
    involves nondeterminism. Assume <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">&gt;</span> <span class="inlinecode">0</span>. The output value may be any <span class="inlinecode"><span class="id" title="var">n<sub>1</sub></span></span> in
    the range <span class="inlinecode">0</span> <span class="inlinecode">≤</span> <span class="inlinecode"><span class="id" title="var">n<sub>1</sub></span></span> <span class="inlinecode">&lt;</span> <span class="inlinecode"><span class="id" title="var">n</span></span>. The statement <span class="inlinecode"><span class="id" title="tactic">eval</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode">(<span class="id" title="var">val_rand</span></span> <span class="inlinecode"><span class="id" title="var">n</span>)</span> <span class="inlinecode"><span class="id" title="var">Q</span></span> should
    capture the fact that <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">n<sub>1</sub></span></span> holds, for any possible output integer <span class="inlinecode"><span class="id" title="var">n<sub>1</sub></span></span>.
    This condition is captured by <span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">n<sub>1</sub></span>,</span> <span class="inlinecode">0</span> <span class="inlinecode">≤</span> <span class="inlinecode"><span class="id" title="var">n<sub>1</sub></span></span> <span class="inlinecode">&lt;</span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode"><span class="id" title="var">n<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">s</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="eval_rand" class="idref" href="#eval_rand"><span class="id" title="axiom">eval_rand</span></a> : <span class="id" title="keyword">∀</span> <a id="s:73" class="idref" href="#s:73"><span class="id" title="binder">s</span></a> <a id="n:74" class="idref" href="#n:74"><span class="id" title="binder">n</span></a> <a id="Q:75" class="idref" href="#Q:75"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rules.html#n:74"><span class="id" title="variable">n</span></a> <span class="id" title="notation">&gt;</span> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="n<sub>1</sub>:76" class="idref" href="#n<sub>1</sub>:76"><span class="id" title="binder">n<sub>1</sub></span></a>, 0 <span class="id" title="notation">≤</span> <a class="idref" href="Rules.html#n<sub>1</sub>:76"><span class="id" title="variable">n<sub>1</sub></span></a> <span class="id" title="notation">&lt;</span> <a class="idref" href="Rules.html#n:74"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Rules.html#Q:75"><span class="id" title="variable">Q</span></a> <a class="idref" href="Rules.html#n<sub>1</sub>:76"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Rules.html#s:73"><span class="id" title="variable">s</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Rules.html#s:73"><span class="id" title="variable">s</span></a> (<a class="idref" href="LibSepReference.html#val_rand"><span class="id" title="constructor">val_rand</span></a> (<a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Rules.html#n:74"><span class="id" title="variable">n</span></a>)) <a class="idref" href="Rules.html#Q:75"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
The postcondition of the triple for <span class="inlinecode"><span class="id" title="var">val_rand</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> asserts that the output
    value <span class="inlinecode"><span class="id" title="var">r</span></span> corresponds to an integer <span class="inlinecode"><span class="id" title="var">n<sub>1</sub></span></span> in the range <span class="inlinecode">0</span> <span class="inlinecode">≤</span> <span class="inlinecode"><span class="id" title="var">n<sub>1</sub></span></span> <span class="inlinecode">&lt;</span> <span class="inlinecode"><span class="id" title="var">n</span></span>. 
<div class="paragraph"> </div>

<a id="lab211"></a><h4 class="section">Exercise: 2 stars, standard, especially useful (triple_rand)</h4>
 Prove the reasoning rule for calls to the random number generator. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_rand" class="idref" href="#triple_rand"><span class="id" title="lemma">triple_rand</span></a> : <span class="id" title="keyword">∀</span> <a id="n:78" class="idref" href="#n:78"><span class="id" title="binder">n</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rules.html#n:78"><span class="id" title="variable">n</span></a> <span class="id" title="notation">&gt;</span> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_rand"><span class="id" title="constructor">val_rand</span></a> <a class="idref" href="Rules.html#n:78"><span class="id" title="variable">n</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:79" class="idref" href="#r:79"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">∃</span></a> <a id="n<sub>1</sub>:80" class="idref" href="#n<sub>1</sub>:80"><span class="id" title="binder">n<sub>1</sub></span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="Rules.html#r:79"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> <a class="idref" href="Rules.html#n<sub>1</sub>:80"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> 0 <span class="id" title="notation">≤</span> <a class="idref" href="Rules.html#n<sub>1</sub>:80"><span class="id" title="variable">n<sub>1</sub></span></a> <span class="id" title="notation">&lt;</span> <a class="idref" href="Rules.html#n:78"><span class="id" title="variable">n</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab212"></a><h2 class="section">Primitive Heap-Manipulating Operations</h2>

<div class="paragraph"> </div>

 Establishing triples for the operations <span class="inlinecode"><span class="id" title="var">ref</span></span>, <span class="inlinecode"><span class="id" title="var">get</span></span>, <span class="inlinecode"><span class="id" title="tactic">set</span></span> and <span class="inlinecode"><span class="id" title="var">free</span></span>
    requires reasoning about the definitions of certain primitive heap
    predicates. This reasoning is carried out using the introduction and
    elimination lemmas introduced in chapter <a href="Hprop.html"><span class="inlineref">Hprop</span></a>. For example,
    <span class="inlinecode"><span class="id" title="var">hsingle_intro</span></span> proves <span class="inlinecode">(<span class="id" title="var">p</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">v</span>)</span> <span class="inlinecode">(<span class="id" title="var">Fmap.single</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">v</span>)</span>. Also, the lemma
    <span class="inlinecode"><span class="id" title="var">hstar_hpure_l</span></span> establishing <span class="inlinecode">(<span class='gray-font'>\</span>[<span class="id" title="var">P</span>]</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H</span>)</span> <span class="inlinecode"><span class="id" title="var">h</span></span> <span class="inlinecode">=</span> <span class="inlinecode">(<span class="id" title="var">P</span></span> <span class="inlinecode">∧</span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">h</span>)</span> will be used
    pervasively. 
</div>

<div class="doc">
<a id="lab213"></a><h3 class="section">Allocation</h3>

<div class="paragraph"> </div>

 Recall that <span class="inlinecode"><span class="id" title="var">val_ref</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> allocates a cell with contents <span class="inlinecode"><span class="id" title="var">v</span></span>. A call to
    <span class="inlinecode"><span class="id" title="var">val_ref</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> does not depend on the current contents of the state. The
    operation extends the state with a fresh singleton cell, at some location
    <span class="inlinecode"><span class="id" title="var">p</span></span>, assigning it <span class="inlinecode"><span class="id" title="var">v</span></span> as contents. This fresh cell is described by the heap
    predicate <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">v</span></span>. The evaluation of <span class="inlinecode"><span class="id" title="var">val_ref</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> produces the value
    <span class="inlinecode"><span class="id" title="var">val_loc</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>. Thus, if <span class="inlinecode"><span class="id" title="var">r</span></span> denotes the result value, we have <span class="inlinecode"><span class="id" title="var">r</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">val_loc</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>
    for some <span class="inlinecode"><span class="id" title="var">p</span></span>. In the corresponding specification shown below, observe how
    the location <span class="inlinecode"><span class="id" title="var">p</span></span> is existentially quantified in the postcondition. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_ref" class="idref" href="#triple_ref"><span class="id" title="lemma">triple_ref</span></a> : <span class="id" title="keyword">∀</span> <a id="v:81" class="idref" href="#v:81"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_ref"><span class="id" title="constructor">val_ref</span></a> <a class="idref" href="Rules.html#v:81"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:82" class="idref" href="#r:82"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="p:83" class="idref" href="#p:83"><span class="id" title="binder">p</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Rules.html#r:82"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Rules.html#p:83"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Rules.html#p:83"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Rules.html#v:81"><span class="id" title="variable">v</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#eval_ref"><span class="id" title="constructor">eval_ref</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">p</span> <span class="id" title="var">D</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">lets</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>: <a class="idref" href="LibSepReference.html#SepSimplArgs.hempty_inv"><span class="id" title="lemma">hempty_inv</span></a> <span class="id" title="var">K</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#Fmap.update_empty"><span class="id" title="lemma">Fmap.update_empty</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hexists_intro"><span class="id" title="lemma">hexists_intro</span></a> <span class="id" title="var">p</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_hpure_l"><span class="id" title="lemma">hstar_hpure_l</span></a>. <span class="id" title="tactic">split</span>*.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hsingle_intro"><span class="id" title="lemma">hsingle_intro</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Using the notation <span class="inlinecode"><span class="id" title="var">funloc</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">H</span></span> as a shorthand for
    <span class="inlinecode"><span class="id" title="keyword">fun</span></span> <span class="inlinecode">(<span class="id" title="var">r</span>:<span class="id" title="var">val</span>)</span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class='gray-font'>\</span><span class="id" title="tactic">∃</span></span> <span class="inlinecode">(<span class="id" title="var">p</span>:<span class="id" title="var">loc</span>),</span> <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">r</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">val_loc</span></span> <span class="inlinecode"><span class="id" title="var">p</span>]</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H</span></span>, the specification
    for <span class="inlinecode"><span class="id" title="var">val_ref</span></span> becomes more concise. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_ref'" class="idref" href="#triple_ref'"><span class="id" title="lemma">triple_ref'</span></a> : <span class="id" title="keyword">∀</span> <a id="v:84" class="idref" href="#v:84"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_ref"><span class="id" title="constructor">val_ref</span></a> <a class="idref" href="Rules.html#v:84"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:87" class="idref" href="#p:87"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="Rules.html#p:85"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Rules.html#v:84"><span class="id" title="variable">v</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="Rules.html#triple_ref"><span class="id" title="lemma">triple_ref</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab214"></a><h3 class="section">Deallocation</h3>

<div class="paragraph"> </div>

 Recall that <span class="inlinecode"><span class="id" title="var">val_free</span></span> denotes the operation for deallocating a cell at a
    given address. A call of the form <span class="inlinecode"><span class="id" title="var">val_free</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> executes safely in a state
    described by <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">v</span></span>. The operation leaves an empty state, and asserts
    that the return value, named <span class="inlinecode"><span class="id" title="var">r</span></span>, is equal to unit. 
<div class="paragraph"> </div>

<a id="lab215"></a><h4 class="section">Exercise: 2 stars, standard, especially useful (triple_free')</h4>
 Prove the reasoning rule for deallocation of a single cell. Hint: use
    <span class="inlinecode"><span class="id" title="var">Fmap.indom_single</span></span> and <span class="inlinecode"><span class="id" title="var">Fmap.remove_single</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_free'" class="idref" href="#triple_free'"><span class="id" title="lemma">triple_free'</span></a> : <span class="id" title="keyword">∀</span> <a id="p:88" class="idref" href="#p:88"><span class="id" title="binder">p</span></a> <a id="v:89" class="idref" href="#v:89"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_free"><span class="id" title="constructor">val_free</span></a> (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Rules.html#p:88"><span class="id" title="variable">p</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Rules.html#p:88"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Rules.html#v:89"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:90" class="idref" href="#r:90"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Rules.html#r:90"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 In practice, the information <span class="inlinecode"><span class="id" title="var">r</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">val_unit</span></span> is generally useless. Thus, we
    state <span class="inlinecode"><span class="id" title="var">triple_free</span></span> with an empty postcondition. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_free" class="idref" href="#triple_free"><span class="id" title="lemma">triple_free</span></a> : <span class="id" title="keyword">∀</span> <a id="p:91" class="idref" href="#p:91"><span class="id" title="binder">p</span></a> <a id="v:92" class="idref" href="#v:92"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_free"><span class="id" title="constructor">val_free</span></a> (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Rules.html#p:91"><span class="id" title="variable">p</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Rules.html#p:91"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Rules.html#v:92"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_conseq"><span class="id" title="lemma">triple_conseq</span></a> <a class="idref" href="Rules.html#triple_free'"><span class="id" title="axiom">triple_free'</span></a>; <span class="id" title="var">xsimpl</span>*. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab216"></a><h3 class="section">Read</h3>

<div class="paragraph"> </div>

 Recall that <span class="inlinecode"><span class="id" title="var">val_get</span></span> denotes the operation for reading a memory cell. A
    call of the form <span class="inlinecode"><span class="id" title="var">val_get</span></span> <span class="inlinecode"><span class="id" title="var">v'</span></span> executes safely if its argument <span class="inlinecode"><span class="id" title="var">v'</span></span> is a
    value of the form <span class="inlinecode"><span class="id" title="var">val_loc</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> for some location <span class="inlinecode"><span class="id" title="var">p</span></span>, in a state that
    features a memory cell at location <span class="inlinecode"><span class="id" title="var">p</span></span>, storing some contents <span class="inlinecode"><span class="id" title="var">v</span></span>. Such a
    state is described as <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">v</span></span>. The read operation returns a value <span class="inlinecode"><span class="id" title="var">r</span></span> such
    that <span class="inlinecode"><span class="id" title="var">r</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">v</span></span>, and the memory state of the operation remains unchanged. The
    specification of <span class="inlinecode"><span class="id" title="var">val_get</span></span> is thus expressed as follows. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_get" class="idref" href="#triple_get"><span class="id" title="lemma">triple_get</span></a> : <span class="id" title="keyword">∀</span> <a id="v:93" class="idref" href="#v:93"><span class="id" title="binder">v</span></a> <a id="p:94" class="idref" href="#p:94"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_get"><span class="id" title="constructor">val_get</span></a> <a class="idref" href="Rules.html#p:94"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Rules.html#p:94"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Rules.html#v:93"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:95" class="idref" href="#r:95"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Rules.html#r:95"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Rules.html#v:93"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Rules.html#p:94"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Rules.html#v:93"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">s</span> <span class="id" title="var">K</span>. <span class="id" title="var">lets</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>: <a class="idref" href="LibSepReference.html#SepSimplArgs.hsingle_inv"><span class="id" title="lemma">hsingle_inv</span></a> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#eval_get"><span class="id" title="constructor">eval_get</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#Fmap.indom_single"><span class="id" title="lemma">Fmap.indom_single</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_hpure_l"><span class="id" title="lemma">hstar_hpure_l</span></a>. <span class="id" title="tactic">split</span>*. <span class="id" title="tactic">rewrite</span>* <a class="idref" href="LibSepReference.html#Fmap.read_single"><span class="id" title="lemma">Fmap.read_single</span></a>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab217"></a><h3 class="section">Write</h3>

<div class="paragraph"> </div>

 Recall that <span class="inlinecode"><span class="id" title="var">val_set</span></span> denotes the operation for writing a memory cell. A
    call of the form <span class="inlinecode"><span class="id" title="var">val_set</span></span> <span class="inlinecode"><span class="id" title="var">v'</span></span> <span class="inlinecode"><span class="id" title="var">w</span></span> executes safely if <span class="inlinecode"><span class="id" title="var">v'</span></span> is of the form
    <span class="inlinecode"><span class="id" title="var">val_loc</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> for some location <span class="inlinecode"><span class="id" title="var">p</span></span>, in a state <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">v</span></span>. The write operation
    updates this state to <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">w</span></span>, and returns the unit value, which can be
    ignored. Hence, <span class="inlinecode"><span class="id" title="var">val_set</span></span> is specified as follows. 
<div class="paragraph"> </div>

<a id="lab218"></a><h4 class="section">Exercise: 2 stars, standard, especially useful (triple_set)</h4>
 Prove the reasoning rule for a write operation. Hint: use
    <span class="inlinecode"><span class="id" title="var">Fmap.update_single</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_set" class="idref" href="#triple_set"><span class="id" title="lemma">triple_set</span></a> : <span class="id" title="keyword">∀</span> <a id="w:96" class="idref" href="#w:96"><span class="id" title="binder">w</span></a> <a id="p:97" class="idref" href="#p:97"><span class="id" title="binder">p</span></a> <a id="v:98" class="idref" href="#v:98"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_set"><span class="id" title="constructor">val_set</span></a> (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Rules.html#p:97"><span class="id" title="variable">p</span></a>) <a class="idref" href="Rules.html#v:98"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Rules.html#p:97"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Rules.html#w:96"><span class="id" title="variable">w</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:99" class="idref" href="#r:99"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Rules.html#r:99"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="Rules.html#p:97"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Rules.html#v:98"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab219"></a><h2 class="section">Program Verification using the Reasoning Rules</h2>

<div class="paragraph"> </div>

 We now have at hand all the necessary rules for carrying out actual
    verification proofs in Separation Logic. 
</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="ExamplePrograms" class="idref" href="#ExamplePrograms"><span class="id" title="module">ExamplePrograms</span></a>.<br/>
<span class="id" title="keyword">Export</span> <a class="idref" href="LibSepReference.html#ProgramSyntax"><span class="id" title="module">ProgramSyntax</span></a>.<br/>
</div>

<div class="doc">
<a id="lab220"></a><h3 class="section">Proof of <span class="inlinecode"><span class="id" title="var">incr</span></span></h3>

<div class="paragraph"> </div>

 First, we consider the verification of the increment function, which is
    written in OCaml syntax as:

<div class="paragraph"> </div>

<span class="inlinecode-ocaml">&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">incr</span> <span class="id" title="var">p</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">p</span> := !<span class="id" title="var">p</span> + 1
</span>    and in "A-normal form" as:

<div class="paragraph"> </div>

<span class="inlinecode-ocaml">&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">incr</span> <span class="id" title="var">p</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">n</span> = !<span class="id" title="var">p</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">m</span> = <span class="id" title="var">n</span>+1 <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">p</span> := <span class="id" title="var">m</span>
</span>    Using the construct from our embedded programming language, the definition
    of <span class="inlinecode"><span class="id" title="var">incr</span></span> is formalized as shown below. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="ExamplePrograms.incr" class="idref" href="#ExamplePrograms.incr"><span class="id" title="definition">incr</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#val_fun"><span class="id" title="constructor">val_fun</span></a> "p" (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> "n" (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="LibSepReference.html#val_get"><span class="id" title="constructor">val_get</span></a> (<a class="idref" href="LibSepReference.html#trm_var"><span class="id" title="constructor">trm_var</span></a> "p")) (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> "m" (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="LibSepReference.html#val_add"><span class="id" title="constructor">val_add</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#trm_var"><span class="id" title="constructor">trm_var</span></a> "n")) (<a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> 1)) (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="LibSepReference.html#val_set"><span class="id" title="constructor">val_set</span></a> (<a class="idref" href="LibSepReference.html#trm_var"><span class="id" title="constructor">trm_var</span></a> "p")) (<a class="idref" href="LibSepReference.html#trm_var"><span class="id" title="constructor">trm_var</span></a> "m")))).<br/>
</div>

<div class="doc">
Alternatively, using notation and coercions, the same program can be written
    more concisely. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="ExamplePrograms.incr'" class="idref" href="#ExamplePrograms.incr'"><span class="id" title="definition">incr'</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#27f9d9ef09cb3e20c393642accbfc5d<sub>1</sub>"><span class="id" title="notation">!</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">m</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#590da34eb63eef1c68773c655749c128"><span class="id" title="notation">+</span></a> 1 <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''p'"><span class="id" title="notation">p</span></a> <a class="idref" href="LibSepReference.html#e0633f114fcb17e965cb872e30ce07a<sub>5</sub>"><span class="id" title="notation">:=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''m'"><span class="id" title="notation">m</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
Let us check that the two definitions are indeed the same. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="ExamplePrograms.incr_eq_incr'" class="idref" href="#ExamplePrograms.incr_eq_incr'"><span class="id" title="lemma">incr_eq_incr'</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Rules.html#ExamplePrograms.incr"><span class="id" title="definition">incr</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Rules.html#ExamplePrograms.incr'"><span class="id" title="definition">incr'</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Recall from the first chapter the specification of the increment function.
    Its precondition requires a singleton state of the form <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">n</span></span>. Its
    postcondition describes a state of the form <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode">(<span class="id" title="var">n</span>+1)</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="ExamplePrograms.triple_incr" class="idref" href="#ExamplePrograms.triple_incr"><span class="id" title="lemma">triple_incr</span></a> : <span class="id" title="keyword">∀</span> (<a id="p:100" class="idref" href="#p:100"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) (<a id="n:101" class="idref" href="#n:101"><span class="id" title="binder">n</span></a>:<span class="id" title="notation">int</span>),<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="Rules.html#ExamplePrograms.incr"><span class="id" title="definition">incr</span></a> <a class="idref" href="Rules.html#p:100"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Rules.html#p:100"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Rules.html#n:101"><span class="id" title="variable">n</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Rules.html#p:100"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">(</span></a><a class="idref" href="Rules.html#n:101"><span class="id" title="variable">n</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1<a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">)</span></a>).<br/>
</div>

<div class="doc">
In chapter <a href="Basic.html"><span class="inlineref">Basic</span></a>, we have seen that the proof of this lemma can be
    completed by the short script <span class="inlinecode"><span class="id" title="var">xwp</span>.</span> <span class="inlinecode"><span class="id" title="var">xapp</span>.</span> <span class="inlinecode"><span class="id" title="var">xapp</span>.</span> <span class="inlinecode"><span class="id" title="var">xapp</span>.</span> <span class="inlinecode"><span class="id" title="var">xsimpl</span>.</span>. The purpose
    of the detailed proof that follows is to explain how the x-tactics operate.
    It shows how, under the hood, the proof exploits:

<div class="paragraph"> </div>

<ul class="doclist">
<li> the structural reasoning rules,

</li>
<li> the reasoning rules for terms,

</li>
<li> the specification of the primitive functions,

</li>
<li> the <span class="inlinecode"><span class="id" title="var">xsimpl</span></span> tactic for simplifying entailments.

</li>
</ul>

<div class="paragraph"> </div>

    Executing the proof script step by step leads to the display of intermediate
    proof obligations that involve Coq existential variables, a.k.a. "evars",
    whose name is prefixed by a question mark, e.g., "?x". These placeholders
    are typically introduced by <span class="inlinecode"><span class="id" title="var">applys</span></span> (which calls <span class="inlinecode"><span class="id" title="tactic">eapply</span></span>), and are
    typically instantiated when solving subgoals. 
</div>
<div class="code">

<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
</div>

<div class="doc">
Initialize the proof 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span> <a class="idref" href="Rules.html#triple_app_fun"><span class="id" title="lemma">triple_app_fun</span></a>.<br/>
</div>

<div class="doc">
Provide the argument name and body for <span class="inlinecode"><span class="id" title="var">incr</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;{ <span class="id" title="tactic">reflexivity</span>. }<br/>
</div>

<div class="doc">
Compute the substitution from program variable <span class="inlinecode">&quot;<span class="id" title="var">p</span>&quot;</span> to Coq variable <span class="inlinecode"><span class="id" title="var">p</span></span> 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
</div>

<div class="doc">
Reason about <span class="inlinecode"><span class="id" title="keyword">let</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">=</span> <span class="inlinecode">..</span>. Observe that this introduces an evar <span class="inlinecode">?<span class="id" title="var">Q<sub>1</sub></span></span>, which
    denotes the postcondition of <span class="inlinecode">!<span class="id" title="var">p</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="Rules.html#triple_let"><span class="id" title="lemma">triple_let</span></a>.<br/>
</div>

<div class="doc">
In the body of the let-binding, reason about <span class="inlinecode">!<span class="id" title="var">p</span></span>. Here we are in a
    favorable situation, where there is no need to apply a consequence or frame
    rule. 
</div>
<div class="code">
&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <a class="idref" href="Rules.html#triple_get"><span class="id" title="lemma">triple_get</span></a>. }<br/>
</div>

<div class="doc">
Observe how <span class="inlinecode">?<span class="id" title="var">Q<sub>1</sub></span></span> has been instantiated as <span class="inlinecode"><span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">r</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">r</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">n</span>]</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">n</span></span>.
    We next introduce a name <span class="inlinecode"><span class="id" title="var">n'</span></span> for the result of <span class="inlinecode">!<span class="id" title="var">p</span></span> 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n'</span>.<br/>
</div>

<div class="doc">
Once again, we compute the substitution of a program variable. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
</div>

<div class="doc">
We substitute away the equality <span class="inlinecode"><span class="id" title="var">n'</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">n</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="LibSepReference.html#triple_hpure"><span class="id" title="lemma">triple_hpure</span></a>. <span class="id" title="tactic">intros</span> →.<br/>
</div>

<div class="doc">
Reason about <span class="inlinecode"><span class="id" title="keyword">let</span></span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">=</span> <span class="inlinecode">..</span>. Observe the introduction of another evar <span class="inlinecode">?<span class="id" title="var">Q<sub>1</sub></span></span>.
    
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="Rules.html#triple_let"><span class="id" title="lemma">triple_let</span></a>.<br/>
</div>

<div class="doc">
Apply the frame rule to put aside <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">n</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_conseq_frame"><span class="id" title="lemma">triple_conseq_frame</span></a>.<br/>
</div>

<div class="doc">
We reason about <span class="inlinecode"><span class="id" title="var">n</span>+1</span> in the empty state. Doing so instantiates <span class="inlinecode">?<span class="id" title="var">Q<sub>1</sub></span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Rules.html#triple_add"><span class="id" title="lemma">triple_add</span></a>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span>. } }<br/>
</div>

<div class="doc">
We name <span class="inlinecode"><span class="id" title="var">m'</span></span> the result of <span class="inlinecode"><span class="id" title="var">n</span>+1</span>. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">m'</span>. <span class="id" title="tactic">simpl</span>.<br/>
</div>

<div class="doc">
We can extract the equality <span class="inlinecode"><span class="id" title="var">m'</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">+</span> <span class="inlinecode">1</span> and substitute it away. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="LibSepReference.html#triple_hpure"><span class="id" title="lemma">triple_hpure</span></a>. <span class="id" title="tactic">intros</span> →.<br/>
</div>

<div class="doc">
Finally, we reason about <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">m</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_conseq_frame"><span class="id" title="lemma">triple_conseq_frame</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Rules.html#triple_set"><span class="id" title="axiom">triple_set</span></a>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab221"></a><h3 class="section">Proof of <span class="inlinecode"><span class="id" title="var">succ_using_incr</span></span></h3>

<div class="paragraph"> </div>

 Recall from <a href="Basic.html"><span class="inlineref">Basic</span></a> the function <span class="inlinecode"><span class="id" title="var">succ_using_incr</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="ExamplePrograms.succ_using_incr" class="idref" href="#ExamplePrograms.succ_using_incr"><span class="id" title="definition">succ_using_incr</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">fun</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#580b26347bf7760f2fc76a1944e0af<sub>93</sub>"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''r'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''r'"><span class="id" title="notation">r</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_ref"><span class="id" title="constructor">val_ref</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Rules.html#ExamplePrograms.incr"><span class="id" title="definition">incr</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''r'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''r'"><span class="id" title="notation">r</span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">x</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#27f9d9ef09cb3e20c393642accbfc5d<sub>1</sub>"><span class="id" title="notation">!</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''r'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''r'"><span class="id" title="notation">r</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#val_free"><span class="id" title="constructor">val_free</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''r'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''r'"><span class="id" title="notation">r</span></a><a class="idref" href="LibSepReference.html#56accb00428c2a6753c1055752721c<sub>75</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">x</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
Recall the specification of <span class="inlinecode"><span class="id" title="var">succ_using_incr</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="ExamplePrograms.triple_succ_using_incr" class="idref" href="#ExamplePrograms.triple_succ_using_incr"><span class="id" title="lemma">triple_succ_using_incr</span></a> : <span class="id" title="keyword">∀</span> (<a id="n:102" class="idref" href="#n:102"><span class="id" title="binder">n</span></a>:<span class="id" title="notation">int</span>),<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="Rules.html#ExamplePrograms.succ_using_incr"><span class="id" title="definition">succ_using_incr</span></a> <a class="idref" href="Rules.html#n:102"><span class="id" title="variable">n</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="v:103" class="idref" href="#v:103"><span class="id" title="binder">v</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Rules.html#v:103"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> (<a class="idref" href="Rules.html#n:102"><span class="id" title="variable">n</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1)<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>).<br/>
</div>

<div class="doc">
<a id="lab222"></a><h4 class="section">Exercise: 4 stars, standard, especially useful (triple_succ_using_incr)</h4>
 Verify the function <span class="inlinecode"><span class="id" title="var">triple_succ_using_incr</span></span>. Hint: follow the pattern of
    <span class="inlinecode"><span class="id" title="var">triple_incr</span></span>. Use <span class="inlinecode"><span class="id" title="var">applys</span></span> <span class="inlinecode"><span class="id" title="var">triple_seq</span></span> for reasoning about a sequence. Use
    <span class="inlinecode"><span class="id" title="var">applys</span></span> <span class="inlinecode"><span class="id" title="var">triple_val</span></span> for reasoning about the final return value, namely <span class="inlinecode"><span class="id" title="var">x</span></span>.
    
</div>
<div class="code">

<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<span class="id" title="keyword">End</span> <a class="idref" href="Rules.html#ExamplePrograms"><span class="id" title="module">ExamplePrograms</span></a>.<br/>
</div>

<div class="doc">
The job of the following chapters is to introduce additional technology to
    streamline the proof process, notably by:

<div class="paragraph"> </div>

<ul class="doclist">
<li> automating the application of the frame rule, and

</li>
<li> eliminating the need to manipulate program variables
      and substitutions during verification. 

</li>
</ul>
</div>

<div class="doc">
<a id="lab223"></a><h1 class="section">More Details</h1>

<div class="paragraph"> </div>

 This "More Details" section presents several additional reasoning rules. 
</div>

<div class="doc">
<a id="lab224"></a><h2 class="section">Triple for Terms with Same Semantics</h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="ProofsSameSemantics" class="idref" href="#ProofsSameSemantics"><span class="id" title="module">ProofsSameSemantics</span></a>.<br/>
</div>

<div class="doc">
A general principle is that if, according to the semantics, the terms <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>
    and <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> admit the same behaviors, then <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> satisfy the same
    triples. The statement can also be reformulated in an asymmetric fashion: if
    <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> admits no more behaviors than <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>, then <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> satisfies all the triples
    that <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> satisfies. This section explains how to formalize this asymmetric
    statement, which is more general and more useful in practice.

<div class="paragraph"> </div>

    The judgment <span class="inlinecode"><span class="id" title="var">eval_like</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> asserts that if <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> terminates and produces
    results in <span class="inlinecode"><span class="id" title="var">Q</span></span>, then so does <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="ProofsSameSemantics.eval_like" class="idref" href="#ProofsSameSemantics.eval_like"><span class="id" title="definition">eval_like</span></a> (<a id="t<sub>1</sub>:104" class="idref" href="#t<sub>1</sub>:104"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:105" class="idref" href="#t<sub>2</sub>:105"><span class="id" title="binder">t<sub>2</sub></span></a>:<a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s:106" class="idref" href="#s:106"><span class="id" title="binder">s</span></a> <a id="Q:107" class="idref" href="#Q:107"><span class="id" title="binder">Q</span></a>, <a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Rules.html#s:106"><span class="id" title="variable">s</span></a> <a class="idref" href="Rules.html#t<sub>1</sub>:104"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rules.html#Q:107"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="Rules.html#s:106"><span class="id" title="variable">s</span></a> <a class="idref" href="Rules.html#t<sub>2</sub>:105"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="Rules.html#Q:107"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
<a id="lab225"></a><h4 class="section">Exercise: 1 star, standard, especially useful (eval_like_eta_expansion)</h4>
 Prove that when the relation <span class="inlinecode"><span class="id" title="var">eval_like</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> holds, any triple that <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>
    satisfies any triple that <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> satisfies. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="ProofsSameSemantics.triple_eval_like" class="idref" href="#ProofsSameSemantics.triple_eval_like"><span class="id" title="lemma">triple_eval_like</span></a> : <span class="id" title="keyword">∀</span> <a id="t<sub>1</sub>:108" class="idref" href="#t<sub>1</sub>:108"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:109" class="idref" href="#t<sub>2</sub>:109"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="H:110" class="idref" href="#H:110"><span class="id" title="binder">H</span></a> <a id="Q:111" class="idref" href="#Q:111"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rules.html#ProofsSameSemantics.eval_like"><span class="id" title="definition">eval_like</span></a> <a class="idref" href="Rules.html#t<sub>1</sub>:108"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rules.html#t<sub>2</sub>:109"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Rules.html#t<sub>1</sub>:108"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rules.html#H:110"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q:111"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Rules.html#t<sub>2</sub>:109"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="Rules.html#H:110"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q:111"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 The remaining of this section presents 4 examples applications of this
    reasoning principle. To begin with, consider the term <span class="inlinecode"><span class="id" title="keyword">let</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="keyword">in</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span>,
    represented as <span class="inlinecode"><span class="id" title="var">trm_let</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> for a variable named <span class="inlinecode"><span class="id" title="var">x</span></span>. This term reduces
    to <span class="inlinecode"><span class="id" title="var">t</span></span>, hence the relation <span class="inlinecode"><span class="id" title="var">eval_like</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">(<span class="id" title="var">trm_let</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">x</span>)</span> holds. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="ProofsSameSemantics.eval_like_eta_reduction" class="idref" href="#ProofsSameSemantics.eval_like_eta_reduction"><span class="id" title="lemma">eval_like_eta_reduction</span></a> : <span class="id" title="keyword">∀</span> (<a id="t:112" class="idref" href="#t:112"><span class="id" title="binder">t</span></a>:<a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>) (<a id="x:113" class="idref" href="#x:113"><span class="id" title="binder">x</span></a>:<a class="idref" href="LibSepVar.html#var"><span class="id" title="definition">var</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="Rules.html#ProofsSameSemantics.eval_like"><span class="id" title="definition">eval_like</span></a> <a class="idref" href="Rules.html#t:112"><span class="id" title="variable">t</span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="Rules.html#x:113"><span class="id" title="variable">x</span></a> <a class="idref" href="Rules.html#t:112"><span class="id" title="variable">t</span></a> <a class="idref" href="Rules.html#x:113"><span class="id" title="variable">x</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">R</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#eval_let"><span class="id" title="constructor">eval_let</span></a> <span class="id" title="var">R</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepVar.html#var_eq_spec"><span class="id" title="lemma">var_eq_spec</span></a>. <span class="id" title="var">case_if</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">Hv</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#eval_val"><span class="id" title="constructor">eval_val</span></a> <span class="id" title="var">Hv</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab226"></a><h4 class="section">Exercise: 4 stars, standard, optional (eval_like_eta_expansion)</h4>
 Prove that the symmetric relation <span class="inlinecode"><span class="id" title="var">eval_like</span></span> <span class="inlinecode">(<span class="id" title="var">trm_let</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">x</span>)</span> <span class="inlinecode"><span class="id" title="var">t</span></span> also holds.
    
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="ProofsSameSemantics.eval_like_eta_expansion" class="idref" href="#ProofsSameSemantics.eval_like_eta_expansion"><span class="id" title="lemma">eval_like_eta_expansion</span></a> : <span class="id" title="keyword">∀</span> (<a id="t:114" class="idref" href="#t:114"><span class="id" title="binder">t</span></a>:<a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>) (<a id="x:115" class="idref" href="#x:115"><span class="id" title="binder">x</span></a>:<a class="idref" href="LibSepVar.html#var"><span class="id" title="definition">var</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="Rules.html#ProofsSameSemantics.eval_like"><span class="id" title="definition">eval_like</span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="Rules.html#x:115"><span class="id" title="variable">x</span></a> <a class="idref" href="Rules.html#t:114"><span class="id" title="variable">t</span></a> <a class="idref" href="Rules.html#x:115"><span class="id" title="variable">x</span></a>) <a class="idref" href="Rules.html#t:114"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a id="lab227"></a><h4 class="section">Exercise: 2 stars, standard, especially useful (eta_same_triples)</h4>
 Conclude that <span class="inlinecode"><span class="id" title="var">t</span></span> and <span class="inlinecode"><span class="id" title="var">trm_let</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> satisfy exactly the same set of
    triples. (This result will be exploited in chapter <a href="Affine.html"><span class="inlineref">Affine</span></a>, for
    proving the equivalence of two versions of the garbage collection rule.) 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="ProofsSameSemantics.eta_same_triples" class="idref" href="#ProofsSameSemantics.eta_same_triples"><span class="id" title="lemma">eta_same_triples</span></a> : <span class="id" title="keyword">∀</span> (<a id="t:116" class="idref" href="#t:116"><span class="id" title="binder">t</span></a>:<a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>) (<a id="x:117" class="idref" href="#x:117"><span class="id" title="binder">x</span></a>:<a class="idref" href="LibSepVar.html#var"><span class="id" title="definition">var</span></a>) <a id="H:118" class="idref" href="#H:118"><span class="id" title="binder">H</span></a> <a id="Q:119" class="idref" href="#Q:119"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Rules.html#t:116"><span class="id" title="variable">t</span></a> <a class="idref" href="Rules.html#H:118"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q:119"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="Rules.html#x:117"><span class="id" title="variable">x</span></a> <a class="idref" href="Rules.html#t:116"><span class="id" title="variable">t</span></a> <a class="idref" href="Rules.html#x:117"><span class="id" title="variable">x</span></a>) <a class="idref" href="Rules.html#H:118"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q:119"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 Another application of the reasoning rule <span class="inlinecode"><span class="id" title="var">triple_eval_like</span></span> is to revisit
    the proof of <span class="inlinecode"><span class="id" title="var">triple_app_fun</span></span> by arguing that <span class="inlinecode"><span class="id" title="var">trm_app</span></span> <span class="inlinecode">(<span class="id" title="var">val_fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span>)</span> <span class="inlinecode"><span class="id" title="var">v<sub>2</sub></span></span>
    reduces to <span class="inlinecode"><span class="id" title="tactic">subst</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">v<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>, hence they admit the same behavior. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="ProofsSameSemantics.triple_app_fun" class="idref" href="#ProofsSameSemantics.triple_app_fun"><span class="id" title="lemma">triple_app_fun</span></a> : <span class="id" title="keyword">∀</span> <a id="x:120" class="idref" href="#x:120"><span class="id" title="binder">x</span></a> <a id="v<sub>1</sub>:121" class="idref" href="#v<sub>1</sub>:121"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="v<sub>2</sub>:122" class="idref" href="#v<sub>2</sub>:122"><span class="id" title="binder">v<sub>2</sub></span></a> <a id="t<sub>1</sub>:123" class="idref" href="#t<sub>1</sub>:123"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="H:124" class="idref" href="#H:124"><span class="id" title="binder">H</span></a> <a id="Q:125" class="idref" href="#Q:125"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rules.html#v<sub>1</sub>:121"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_fun"><span class="id" title="constructor">val_fun</span></a> <a class="idref" href="Rules.html#x:120"><span class="id" title="variable">x</span></a> <a class="idref" href="Rules.html#t<sub>1</sub>:123"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Rules.html#x:120"><span class="id" title="variable">x</span></a> <a class="idref" href="Rules.html#v<sub>2</sub>:122"><span class="id" title="variable">v<sub>2</sub></span></a> <a class="idref" href="Rules.html#t<sub>1</sub>:123"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="Rules.html#H:124"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q:125"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="Rules.html#v<sub>1</sub>:121"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Rules.html#v<sub>2</sub>:122"><span class="id" title="variable">v<sub>2</sub></span></a>) <a class="idref" href="Rules.html#H:124"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q:125"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">E</span> <span class="id" title="var">M<sub>1</sub></span>. <span class="id" title="var">applys</span> <a class="idref" href="Rules.html#ProofsSameSemantics.triple_eval_like"><span class="id" title="axiom">triple_eval_like</span></a> <span class="id" title="var">M<sub>1</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">R</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#eval_app_fun"><span class="id" title="constructor">eval_app_fun</span></a> <span class="id" title="var">E</span> <span class="id" title="var">R</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
A even more interesting application is a rule that allows to modify the
    parenthesis structure of a sequence, from <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span>;</span> <span class="inlinecode">(<span class="id" title="var">t<sub>2</sub></span>;</span> <span class="inlinecode"><span class="id" title="var">t<sub>3</sub></span>)</span> to <span class="inlinecode">(<span class="id" title="var">t<sub>1</sub></span>;<span class="id" title="var">t<sub>2</sub></span>);</span> <span class="inlinecode"><span class="id" title="var">t<sub>3</sub></span></span>.
    Such a change in the parenthesis structure of a sequence might be helfpul to
    apply the frame rule around <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span>;<span class="id" title="var">t<sub>2</sub></span></span>, for example. 
<div class="paragraph"> </div>

<a id="lab228"></a><h4 class="section">Exercise: 3 stars, standard, optional (triple_trm_seq_assoc)</h4>
 Prove that the term <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span>;</span> <span class="inlinecode">(<span class="id" title="var">t<sub>2</sub></span>;</span> <span class="inlinecode"><span class="id" title="var">t<sub>3</sub></span>)</span>, which corresponds to the natural parsing
    of <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span>;</span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span>;</span> <span class="inlinecode"><span class="id" title="var">t<sub>3</sub></span></span>, satisfies any triple that the term <span class="inlinecode">(<span class="id" title="var">t<sub>1</sub></span>;<span class="id" title="var">t<sub>2</sub></span>);</span> <span class="inlinecode"><span class="id" title="var">t<sub>3</sub></span></span> satisfies.
    
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="ProofsSameSemantics.triple_trm_seq_assoc" class="idref" href="#ProofsSameSemantics.triple_trm_seq_assoc"><span class="id" title="lemma">triple_trm_seq_assoc</span></a> : <span class="id" title="keyword">∀</span> <a id="t<sub>1</sub>:126" class="idref" href="#t<sub>1</sub>:126"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:127" class="idref" href="#t<sub>2</sub>:127"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="t<sub>3</sub>:128" class="idref" href="#t<sub>3</sub>:128"><span class="id" title="binder">t<sub>3</sub></span></a> <a id="H:129" class="idref" href="#H:129"><span class="id" title="binder">H</span></a> <a id="Q:130" class="idref" href="#Q:130"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> (<a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> <a class="idref" href="Rules.html#t<sub>1</sub>:126"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rules.html#t<sub>2</sub>:127"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Rules.html#t<sub>3</sub>:128"><span class="id" title="variable">t<sub>3</sub></span></a>) <a class="idref" href="Rules.html#H:129"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q:130"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> <a class="idref" href="Rules.html#t<sub>1</sub>:126"><span class="id" title="variable">t<sub>1</sub></span></a> (<a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> <a class="idref" href="Rules.html#t<sub>2</sub>:127"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="Rules.html#t<sub>3</sub>:128"><span class="id" title="variable">t<sub>3</sub></span></a>)) <a class="idref" href="Rules.html#H:129"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q:130"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<span class="id" title="keyword">End</span> <a class="idref" href="Rules.html#ProofsSameSemantics"><span class="id" title="module">ProofsSameSemantics</span></a>.<br/>
</div>

<div class="doc">
<a id="lab229"></a><h2 class="section">The Combined Let-Frame Rule</h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="LetFrame" class="idref" href="#LetFrame"><span class="id" title="module">LetFrame</span></a>.<br/>
</div>

<div class="doc">
Recall the Separation Logic let rule. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="LetFrame.triple_let" class="idref" href="#LetFrame.triple_let"><span class="id" title="axiom">triple_let</span></a> : <span class="id" title="keyword">∀</span> <a id="x:131" class="idref" href="#x:131"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:132" class="idref" href="#t<sub>1</sub>:132"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:133" class="idref" href="#t<sub>2</sub>:133"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="Q<sub>1</sub>:134" class="idref" href="#Q<sub>1</sub>:134"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="H:135" class="idref" href="#H:135"><span class="id" title="binder">H</span></a> <a id="Q:136" class="idref" href="#Q:136"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Rules.html#t<sub>1</sub>:132"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rules.html#H:135"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q<sub>1</sub>:134"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="v<sub>1</sub>:137" class="idref" href="#v<sub>1</sub>:137"><span class="id" title="binder">v<sub>1</sub></span></a>, <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Rules.html#x:131"><span class="id" title="variable">x</span></a> <a class="idref" href="Rules.html#v<sub>1</sub>:137"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Rules.html#t<sub>2</sub>:133"><span class="id" title="variable">t<sub>2</sub></span></a>) (<a class="idref" href="Rules.html#Q<sub>1</sub>:134"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Rules.html#v<sub>1</sub>:137"><span class="id" title="variable">v<sub>1</sub></span></a>) <a class="idref" href="Rules.html#Q:136"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="Rules.html#x:131"><span class="id" title="variable">x</span></a> <a class="idref" href="Rules.html#t<sub>1</sub>:132"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rules.html#t<sub>2</sub>:133"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Rules.html#H:135"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q:136"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
At first sight, it seems that, to reason about <span class="inlinecode"><span class="id" title="keyword">let</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="keyword">in</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> in a state
    described by precondition <span class="inlinecode"><span class="id" title="var">H</span></span>, we need to first reason about <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> in that
    same state. But <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> may well require only a subset of the state <span class="inlinecode"><span class="id" title="var">H</span></span> to
    evaluate.

<div class="paragraph"> </div>

    The "let-frame" rule combines the rule for let-bindings with the frame rule
    to make it more explicit that the precondition <span class="inlinecode"><span class="id" title="var">H</span></span> may be decomposed in the
    form <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>, where <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> is the part needed by <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>, and <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> denotes the
    rest of the state. The part of the state covered by <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> remains unmodified
    during the evaluation of <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>, and appears as part of the precondition of
    <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>. The corresponding statement is as follows. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="LetFrame.triple_let_frame" class="idref" href="#LetFrame.triple_let_frame"><span class="id" title="lemma">triple_let_frame</span></a> : <span class="id" title="keyword">∀</span> <a id="x:139" class="idref" href="#x:139"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:140" class="idref" href="#t<sub>1</sub>:140"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:141" class="idref" href="#t<sub>2</sub>:141"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="Q<sub>1</sub>:142" class="idref" href="#Q<sub>1</sub>:142"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="H:143" class="idref" href="#H:143"><span class="id" title="binder">H</span></a> <a id="H<sub>1</sub>:144" class="idref" href="#H<sub>1</sub>:144"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:145" class="idref" href="#H<sub>2</sub>:145"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="Q:146" class="idref" href="#Q:146"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Rules.html#t<sub>1</sub>:140"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rules.html#H<sub>1</sub>:144"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="Rules.html#Q<sub>1</sub>:142"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Rules.html#H:143"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="Rules.html#H<sub>1</sub>:144"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Rules.html#H<sub>2</sub>:145"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="v<sub>1</sub>:147" class="idref" href="#v<sub>1</sub>:147"><span class="id" title="binder">v<sub>1</sub></span></a>, <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Rules.html#x:139"><span class="id" title="variable">x</span></a> <a class="idref" href="Rules.html#v<sub>1</sub>:147"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Rules.html#t<sub>2</sub>:141"><span class="id" title="variable">t<sub>2</sub></span></a>) (<a class="idref" href="Rules.html#Q<sub>1</sub>:142"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="Rules.html#v<sub>1</sub>:147"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Rules.html#H<sub>2</sub>:145"><span class="id" title="variable">H<sub>2</sub></span></a>) <a class="idref" href="Rules.html#Q:146"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="Rules.html#x:139"><span class="id" title="variable">x</span></a> <a class="idref" href="Rules.html#t<sub>1</sub>:140"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Rules.html#t<sub>2</sub>:141"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="Rules.html#H:143"><span class="id" title="variable">H</span></a> <a class="idref" href="Rules.html#Q:146"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
<a id="lab230"></a><h4 class="section">Exercise: 3 stars, standard, especially useful (triple_let_frame)</h4>
 Prove the let-frame rule. 
</div>
<div class="code">

<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<span class="id" title="keyword">End</span> <a class="idref" href="Rules.html#LetFrame"><span class="id" title="module">LetFrame</span></a>.<br/>
</div>

<div class="doc">
<a id="lab231"></a><h1 class="section">Optional Material</h1>

</div>

<div class="doc">
<a id="lab232"></a><h2 class="section">Alternative Specification Style for Pure Preconditions</h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="DivSpec" class="idref" href="#DivSpec"><span class="id" title="module">DivSpec</span></a>.<br/>
</div>

<div class="doc">
Recall the specification for division. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="DivSpec.triple_div" class="idref" href="#DivSpec.triple_div"><span class="id" title="axiom">triple_div</span></a> : <span class="id" title="keyword">∀</span> <a id="n<sub>1</sub>:148" class="idref" href="#n<sub>1</sub>:148"><span class="id" title="binder">n<sub>1</sub></span></a> <a id="n<sub>2</sub>:149" class="idref" href="#n<sub>2</sub>:149"><span class="id" title="binder">n<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rules.html#n<sub>2</sub>:149"><span class="id" title="variable">n<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_div"><span class="id" title="constructor">val_div</span></a> <a class="idref" href="Rules.html#n<sub>1</sub>:148"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Rules.html#n<sub>2</sub>:149"><span class="id" title="variable">n<sub>2</sub></span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:150" class="idref" href="#r:150"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Rules.html#r:150"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#Z.quot"><span class="id" title="definition">Z.quot</span></a> <a class="idref" href="Rules.html#n<sub>1</sub>:148"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Rules.html#n<sub>2</sub>:149"><span class="id" title="variable">n<sub>2</sub></span></a>)<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>).<br/>
</div>

<div class="doc">
Equivalently, we could place the requirement <span class="inlinecode"><span class="id" title="var">n<sub>2</sub></span></span> <span class="inlinecode">≠</span> <span class="inlinecode">0</span> in the precondition:
    
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="DivSpec.triple_div'" class="idref" href="#DivSpec.triple_div'"><span class="id" title="axiom">triple_div'</span></a> : <span class="id" title="keyword">∀</span> <a id="n<sub>1</sub>:152" class="idref" href="#n<sub>1</sub>:152"><span class="id" title="binder">n<sub>1</sub></span></a> <a id="n<sub>2</sub>:153" class="idref" href="#n<sub>2</sub>:153"><span class="id" title="binder">n<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_div"><span class="id" title="constructor">val_div</span></a> <a class="idref" href="Rules.html#n<sub>1</sub>:152"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Rules.html#n<sub>2</sub>:153"><span class="id" title="variable">n<sub>2</sub></span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Rules.html#n<sub>2</sub>:153"><span class="id" title="variable">n<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> 0<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:154" class="idref" href="#r:154"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Rules.html#r:154"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#Z.quot"><span class="id" title="definition">Z.quot</span></a> <a class="idref" href="Rules.html#n<sub>1</sub>:152"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Rules.html#n<sub>2</sub>:153"><span class="id" title="variable">n<sub>2</sub></span></a>)<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>).<br/>
</div>

<div class="doc">
The two presentations are equivalent. First, let us prove <span class="inlinecode"><span class="id" title="var">triple_div'</span></span>
    using <span class="inlinecode"><span class="id" title="var">triple_div</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="DivSpec.triple_div'_from_triple_div" class="idref" href="#DivSpec.triple_div'_from_triple_div"><span class="id" title="lemma">triple_div'_from_triple_div</span></a> : <span class="id" title="keyword">∀</span> <a id="n<sub>1</sub>:156" class="idref" href="#n<sub>1</sub>:156"><span class="id" title="binder">n<sub>1</sub></span></a> <a id="n<sub>2</sub>:157" class="idref" href="#n<sub>2</sub>:157"><span class="id" title="binder">n<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_div"><span class="id" title="constructor">val_div</span></a> <a class="idref" href="Rules.html#n<sub>1</sub>:156"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Rules.html#n<sub>2</sub>:157"><span class="id" title="variable">n<sub>2</sub></span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Rules.html#n<sub>2</sub>:157"><span class="id" title="variable">n<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> 0<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:158" class="idref" href="#r:158"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Rules.html#r:158"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#Z.quot"><span class="id" title="definition">Z.quot</span></a> <a class="idref" href="Rules.html#n<sub>1</sub>:156"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Rules.html#n<sub>2</sub>:157"><span class="id" title="variable">n<sub>2</sub></span></a>)<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#triple_hpure'"><span class="id" title="axiom">triple_hpure'</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="Rules.html#DivSpec.triple_div"><span class="id" title="axiom">triple_div</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab233"></a><h4 class="section">Exercise: 2 stars, standard, especially useful (triple_div_from_triple_div')</h4>
 Prove <span class="inlinecode"><span class="id" title="var">triple_div</span></span> using <span class="inlinecode"><span class="id" title="var">triple_div'</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="DivSpec.triple_div_from_triple_div'" class="idref" href="#DivSpec.triple_div_from_triple_div'"><span class="id" title="lemma">triple_div_from_triple_div'</span></a> : <span class="id" title="keyword">∀</span> <a id="n<sub>1</sub>:159" class="idref" href="#n<sub>1</sub>:159"><span class="id" title="binder">n<sub>1</sub></span></a> <a id="n<sub>2</sub>:160" class="idref" href="#n<sub>2</sub>:160"><span class="id" title="binder">n<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rules.html#n<sub>2</sub>:160"><span class="id" title="variable">n<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_div"><span class="id" title="constructor">val_div</span></a> <a class="idref" href="Rules.html#n<sub>1</sub>:159"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Rules.html#n<sub>2</sub>:160"><span class="id" title="variable">n<sub>2</sub></span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:161" class="idref" href="#r:161"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Rules.html#r:161"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_int"><span class="id" title="constructor">val_int</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#Z.quot"><span class="id" title="definition">Z.quot</span></a> <a class="idref" href="Rules.html#n<sub>1</sub>:159"><span class="id" title="variable">n<sub>1</sub></span></a> <a class="idref" href="Rules.html#n<sub>2</sub>:160"><span class="id" title="variable">n<sub>2</sub></span></a>)<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 Placing pure preconditions outside of the triples makes it slightly more
    convenient to exploit specifications. For this reason, we adopt the style
    that precondition only contain the description of heap-allocated data
    structures. 
</div>
<div class="code">

<span class="id" title="keyword">End</span> <a class="idref" href="Rules.html#DivSpec"><span class="id" title="module">DivSpec</span></a>.<br/>
</div>

<div class="doc">
<a id="lab234"></a><h2 class="section">Alternative Specification Style for Result Values</h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="MatchStyle" class="idref" href="#MatchStyle"><span class="id" title="module">MatchStyle</span></a>.<br/>
</div>

<div class="doc">
Recall the specification for the function <span class="inlinecode"><span class="id" title="var">ref</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="MatchStyle.triple_ref" class="idref" href="#MatchStyle.triple_ref"><span class="id" title="axiom">triple_ref</span></a> : <span class="id" title="keyword">∀</span> <a id="v:162" class="idref" href="#v:162"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_ref"><span class="id" title="constructor">val_ref</span></a> <a class="idref" href="Rules.html#v:162"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:163" class="idref" href="#r:163"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="p:164" class="idref" href="#p:164"><span class="id" title="binder">p</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Rules.html#r:163"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="Rules.html#p:164"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="Rules.html#p:164"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Rules.html#v:162"><span class="id" title="variable">v</span></a>).<br/>
</div>

<div class="doc">
Its postcondition could be equivalently stated by using, instead of an
    existential quantifier, a pattern matching construct. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="MatchStyle.triple_ref'" class="idref" href="#MatchStyle.triple_ref'"><span class="id" title="axiom">triple_ref'</span></a> : <span class="id" title="keyword">∀</span> <a id="v:166" class="idref" href="#v:166"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_ref"><span class="id" title="constructor">val_ref</span></a> <a class="idref" href="Rules.html#v:166"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:167" class="idref" href="#r:167"><span class="id" title="binder">r</span></a> ⇒ <span class="id" title="keyword">match</span> <a class="idref" href="Rules.html#r:167"><span class="id" title="variable">r</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <span class="id" title="var">p</span> ⇒ (<span class="id" title="var">p</span> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="Rules.html#v:166"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>).<br/>
</div>

<div class="doc">
However, the pattern-matching presentation is less readable and would be
    fairly cumbersome to work with in practice. 
</div>
<div class="code">

<span class="id" title="keyword">End</span> <a class="idref" href="Rules.html#MatchStyle"><span class="id" title="module">MatchStyle</span></a>.<br/>
</div>

<div class="doc">
<a id="lab235"></a><h3 class="section">Proof of <span class="inlinecode"><span class="id" title="var">factorec</span></span></h3>

<div class="paragraph"> </div>

 This section presents a manual proof for a recursive function. 
</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="ExamplePrograms2" class="idref" href="#ExamplePrograms2"><span class="id" title="module">ExamplePrograms2</span></a>.<br/>
<span class="id" title="keyword">Export</span> <a class="idref" href="LibSepReference.html#ProgramSyntax"><span class="id" title="module">ProgramSyntax</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="Basic.html#Facto"><span class="id" title="module">Basic.Facto</span></a>.<br/>
</div>

<div class="doc">
In this section, the corollary <span class="inlinecode"><span class="id" title="var">triple_hpure'</span></span> established in the previous
    chapter, can be useful. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="ExamplePrograms2.triple_hpure'" class="idref" href="#ExamplePrograms2.triple_hpure'"><span class="id" title="axiom">triple_hpure'</span></a> : <span class="id" title="keyword">∀</span> <a id="t:170" class="idref" href="#t:170"><span class="id" title="binder">t</span></a> (<a id="P:171" class="idref" href="#P:171"><span class="id" title="binder">P</span></a>:<span class="id" title="keyword">Prop</span>) <a id="Q:172" class="idref" href="#Q:172"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Rules.html#P:171"><span class="id" title="variable">P</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Rules.html#t:170"><span class="id" title="variable">t</span></a> <a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a> <a class="idref" href="Rules.html#Q:172"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="Rules.html#t:170"><span class="id" title="variable">t</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Rules.html#P:171"><span class="id" title="variable">P</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="Rules.html#Q:172"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
Recall the function <span class="inlinecode"><span class="id" title="var">repeat_incr</span></span> from chapter <a href="Basic.html"><span class="inlineref">Basic</span></a>.

<div class="paragraph"> </div>

<span class="inlinecode-ocaml">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="keyword">rec</span> <span class="id" title="var">factorec</span> <span class="id" title="var">n</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">n</span> ≤ 1 <span class="id" title="keyword">then</span> 1 <span class="id" title="keyword">else</span> <span class="id" title="var">n</span> * <span class="id" title="var">factorec</span> (<span class="id" title="var">n</span>-1)
</span>
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="ExamplePrograms2.factorec" class="idref" href="#ExamplePrograms2.factorec"><span class="id" title="definition">factorec</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="LibSepReference.html#7809db93a49fc4341c1251bb4de79a<sub>62</sub>"><span class="id" title="notation">fix</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#7809db93a49fc4341c1251bb4de79a<sub>62</sub>"><span class="id" title="notation">⇒</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#9ff281c3872a35aaa31aa0ff16f0b827"><span class="id" title="notation">≤</span></a> 1<a class="idref" href="LibSepReference.html#2b10480be1a1611f7c8b850ecabd4776"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''b'"><span class="id" title="notation">b</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#:trm:trm_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">x</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#:trm:trm_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1 <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">let</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''y'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''y'"><span class="id" title="notation">y</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''f'"><span class="id" title="notation">f</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''x'"><span class="id" title="notation">x</span></a> <a class="idref" href="LibSepReference.html#3a3686de54cc1093527e5e95b371bea7"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''n'"><span class="id" title="notation">n</span></a> <a class="idref" href="LibSepReference.html#8687bd0de562fa8820387e422eed2db<sub>3</sub>"><span class="id" title="notation">*</span></a> <a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''y'"><span class="id" title="notation">'</span></a><a class="idref" href="LibSepVar.html#NotationForVariables.:trm:trm_scope:'''y'"><span class="id" title="notation">y</span></a> <a class="idref" href="LibSepReference.html#e0b85224b7295b880f5ac68dccd380d<sub>1</sub>"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
<a id="lab236"></a><h4 class="section">Exercise: 4 stars, standard, especially useful (triple_factorec)</h4>
 Verify the function <span class="inlinecode"><span class="id" title="var">factorec</span></span>. Hint: exploit <span class="inlinecode"><span class="id" title="var">triple_app_fix</span></span> for reasoning
    about the recursive function. Use <span class="inlinecode"><span class="id" title="var">triple_hpure'</span></span>, the corollary of
    <span class="inlinecode"><span class="id" title="var">triple_hpure</span></span>. Exploit <span class="inlinecode"><span class="id" title="var">triple_le</span></span> and <span class="inlinecode"><span class="id" title="var">triple_sub</span></span> and <span class="inlinecode"><span class="id" title="var">triple_mul</span></span> to
    reason about the behavior of the primitive operations involved. Exploit
    <span class="inlinecode"><span class="id" title="var">applys</span></span> <span class="inlinecode"><span class="id" title="var">triple_if</span>.</span> <span class="inlinecode"><span class="id" title="var">case_if</span></span> <span class="inlinecode"><span class="id" title="keyword">as</span></span> <span class="inlinecode"><span class="id" title="var">C</span>.</span> to reason about the conditional;
    alternatively, if using <span class="inlinecode"><span class="id" title="var">triple_if_case</span></span>, you'll need to use the tactic
    <span class="inlinecode"><span class="id" title="var">rew_bool_eq</span></span> <span class="inlinecode"><span class="id" title="keyword">in</span></span> <span class="inlinecode">*</span> to simplify, e.g., the expression
    <span class="inlinecode"><span class="id" title="var">isTrue</span></span> <span class="inlinecode">(<span class="id" title="var">m</span></span> <span class="inlinecode">≤</span> <span class="inlinecode">1))</span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">true</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="ExamplePrograms2.triple_factorec" class="idref" href="#ExamplePrograms2.triple_factorec"><span class="id" title="lemma">triple_factorec</span></a> : <span class="id" title="keyword">∀</span> <a id="n:174" class="idref" href="#n:174"><span class="id" title="binder">n</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Rules.html#n:174"><span class="id" title="variable">n</span></a> <span class="id" title="notation">≥</span> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="Rules.html#ExamplePrograms2.factorec"><span class="id" title="definition">factorec</span></a> <a class="idref" href="Rules.html#n:174"><span class="id" title="variable">n</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:175" class="idref" href="#r:175"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="Rules.html#r:175"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Basic.html#Facto.facto"><span class="id" title="axiom">facto</span></a> <a class="idref" href="Rules.html#n:174"><span class="id" title="variable">n</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<span class="id" title="keyword">End</span> <a class="idref" href="Rules.html#ExamplePrograms2"><span class="id" title="module">ExamplePrograms2</span></a>.<br/>
</div>

<div class="doc">
<a id="lab237"></a><h2 class="section">Historical Notes</h2>

<div class="paragraph"> </div>

 <a href="Bib.html#Gordon-1989"><span class="inlineref">[Gordon 1989]</span></a> gave the first mechanization of Hoare logic in a proof
    assistant, using the HOL tool. Gordon's pioneering work was followed by
    numerous formalizations of Hoare logic, targeting various programming
    languages.

<div class="paragraph"> </div>

    The original presentation of Separation Logic (1999-2001) consists of a set
    of rules written down on paper. These rules were not formally described in a
    proof assistant. Nevertheless, mechanized presentation of Separation Logic
    emerged a few years later.

<div class="paragraph"> </div>

    <a href="Bib.html#Yu,-Hamid, and Shao 2003"><span class="inlineref">[Yu, Hamid, and Shao 2003]</span></a> present the CAP framework for the
    verification in Coq of assembly-level code. This framework exploits
    separation logic style specifications, with predicate for lists and list
    segments involving the separating conjunction operator.

<div class="paragraph"> </div>

    In parallel, <a href="Bib.html#Weber-2004"><span class="inlineref">[Weber 2004]</span></a>, advised by Nipkow, developed the first
    mechanization of the rules of Separation Logic for a while language, using
    the Isabelle/HOL tool. His presentation is quite close from the original,
    paper presentation.

<div class="paragraph"> </div>

    Numerous mechanized presentations of Separation Logic, targeting various
    languages (assembly, C, core-Java, ML, etc.) and using various tools
    (Isabelle/HOL, Coq, PVS, HOL4, HOL). For a detailed list, see the last
    chapter of the companion notes, linked from the <a href="Preface.html"><span class="inlineref">Preface</span></a>. 
</div>
<div class="code">

<span class="comment">(*&nbsp;2024-12-26&nbsp;15:06&nbsp;*)</span><br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>