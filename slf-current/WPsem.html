<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>WPsem: Semantics of Weakest Preconditions</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/slf.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 6: Separation Logic Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">WPsem<span class="subtitle">Semantics of Weakest Preconditions</span></h1>


<div class="code">

<span class="id" title="keyword">Set Implicit Arguments</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">SLF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="Rules.html#"><span class="id" title="library">Rules</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">f</span> : <a class="idref" href="LibSepVar.html#var"><span class="id" title="definition">var</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">b</span> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">v</span> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">h</span> : <a class="idref" href="LibSepReference.html#heap"><span class="id" title="definition">heap</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">P</span> : <span class="id" title="keyword">Prop</span>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">H</span> : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">Q</span> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>.<br/>
</div>

<div class="doc">
<a id="lab219"></a><h1 class="section">First Pass</h1>

<div class="paragraph"> </div>

 In previous chapters, we have introduced the notion of
    Separation Logic triple, written <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>.

<div class="paragraph"> </div>

    In this chapter, we introduce the notion of "weakest precondition"
    for Separation Logic triples, written <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>.

<div class="paragraph"> </div>

    The intention is for <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> to be a heap predicate (of type <span class="inlinecode"><span class="id" title="var">hprop</span></span>)
    such that <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> if and only if <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> holds.

<div class="paragraph"> </div>

    The benefits of introducing weakest preconditions is two-fold:

<div class="paragraph"> </div>

<ul class="doclist">
<li> the use of <span class="inlinecode"><span class="id" title="var">wp</span></span> greatly reduces the number of structural rules
      required, and thus reduces accordingly the number of tactics
      required for carrying out proofs in practice;

</li>
<li> the predicate <span class="inlinecode"><span class="id" title="var">wp</span></span> will serve as guidelines for setting up in the
      next chapter a "characteristic formula generator", which is the
      key ingredient at the heart of the implementation of the CFML tool.

</li>
</ul>

<div class="paragraph"> </div>

    This chapter presents:

<div class="paragraph"> </div>

<ul class="doclist">
<li> the notion of weakest precondition, as captured by <span class="inlinecode"><span class="id" title="var">wp</span></span>,

</li>
<li> the reformulation of structural rules in <span class="inlinecode"><span class="id" title="var">wp</span></span>-style,

</li>
<li> the reformulation of reasoning rules in <span class="inlinecode"><span class="id" title="var">wp</span></span>-style,

</li>
<li> (optional) alternative, equivalent definitions for <span class="inlinecode"><span class="id" title="var">wp</span></span>,
      and alternative proofs for deriving <span class="inlinecode"><span class="id" title="var">wp</span></span>-style reasoning rules. 

</li>
</ul>
</div>

<div class="doc">
<a id="lab220"></a><h2 class="section">Notion of Weakest Precondition</h2>

<div class="paragraph"> </div>

 We next introduce a function <span class="inlinecode"><span class="id" title="var">wp</span></span>, called "weakest precondition".
    Given a term <span class="inlinecode"><span class="id" title="var">t</span></span> and a postcondition <span class="inlinecode"><span class="id" title="var">Q</span></span>, the expression <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>
    denotes a heap predicate <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> such that, for any heap predicate
    <span class="inlinecode"><span class="id" title="var">H</span></span>, the entailment <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> is equivalent to <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>.

<div class="paragraph"> </div>

    The notion of <span class="inlinecode"><span class="id" title="var">wp</span></span> usually sounds fairly mysterious at first sight.
    It will make more sense when we describe the properties of <span class="inlinecode"><span class="id" title="var">wp</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="wp" class="idref" href="#wp"><span class="id" title="axiom">wp</span></a> : <a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Parameter</span> <a id="wp_equiv" class="idref" href="#wp_equiv"><span class="id" title="axiom">wp_equiv</span></a> : <span class="id" title="keyword">∀</span> <a id="t:2" class="idref" href="#t:2"><span class="id" title="binder">t</span></a> <a id="H:3" class="idref" href="#H:3"><span class="id" title="binder">H</span></a> <a id="Q:4" class="idref" href="#Q:4"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#H:3"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> <a class="idref" href="WPsem.html#t:2"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:4"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:2"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H:3"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:4"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/>
</div>

<div class="doc">
The <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> is called "weakest precondition" for two reasons:
    because (1) it is a precondition, and (2) it is the weakest one,
    as we explain next.

<div class="paragraph"> </div>

    First, <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> is always a "valid precondition" for a
    triple associated with the term <span class="inlinecode"><span class="id" title="var">t</span></span> and the postcondition <span class="inlinecode"><span class="id" title="var">Q</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_pre" class="idref" href="#wp_pre"><span class="id" title="lemma">wp_pre</span></a> : <span class="id" title="keyword">∀</span> <a id="t:6" class="idref" href="#t:6"><span class="id" title="binder">t</span></a> <a id="Q:7" class="idref" href="#Q:7"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:6"><span class="id" title="variable">t</span></a> (<a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> <a class="idref" href="WPsem.html#t:6"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:7"><span class="id" title="variable">Q</span></a>) <a class="idref" href="WPsem.html#Q:7"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="axiom">wp_equiv</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_refl"><span class="id" title="lemma">himpl_refl</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Second, <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> is the "weakest" of all valid preconditions
    for the term <span class="inlinecode"><span class="id" title="var">t</span></span> and the postcondition <span class="inlinecode"><span class="id" title="var">Q</span></span>, in the sense that
    any other valid precondition <span class="inlinecode"><span class="id" title="var">H</span></span>, i.e. satisfying <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>,
    is such that <span class="inlinecode"><span class="id" title="var">H</span></span> entails <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_weakest" class="idref" href="#wp_weakest"><span class="id" title="lemma">wp_weakest</span></a> : <span class="id" title="keyword">∀</span> <a id="t:8" class="idref" href="#t:8"><span class="id" title="binder">t</span></a> <a id="H:9" class="idref" href="#H:9"><span class="id" title="binder">H</span></a> <a id="Q:10" class="idref" href="#Q:10"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:8"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H:9"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:10"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#H:9"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> <a class="idref" href="WPsem.html#t:8"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:10"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="axiom">wp_equiv</span></a>. <span class="id" title="var">applys</span> <span class="id" title="var">M</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
There are several equivalent ways to define <span class="inlinecode"><span class="id" title="var">wp</span></span>, as we show
    in the optional contents of this chapter. It turns out that
    the equivalence <span class="inlinecode">(<span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>)</span> <span class="inlinecode">↔</span> <span class="inlinecode">(<span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>)</span> fully
    characterizes the predicate <span class="inlinecode"><span class="id" title="var">wp</span></span>, and that it is all we need
    to carry out formal reasoning.

<div class="paragraph"> </div>

    For this reason, we postpone to further on in this chapter the
    description of alternative, direct definitions for <span class="inlinecode"><span class="id" title="var">wp</span></span>. 
</div>

<div class="doc">
<a id="lab221"></a><h2 class="section">Structural Rules in Weakest-Precondition Style</h2>

<div class="paragraph"> </div>

 We next present reformulations of the frame rule and of the rule
    of consequence in "weakest-precondition style". 
</div>

<div class="doc">
<a id="lab222"></a><h3 class="section">The Frame Rule</h3>

<div class="paragraph"> </div>

 The frame rule for <span class="inlinecode"><span class="id" title="var">wp</span></span> asserts that <span class="inlinecode">(<span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>)</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H</span></span> entails
    <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">(<span class="id" title="var">Q</span></span> <span class="inlinecode"><span class='gray-font'>\</span>*+</span> <span class="inlinecode"><span class="id" title="var">H</span>)</span>. This statement can be read as follows:
    if you own both a piece of state satisfying <span class="inlinecode"><span class="id" title="var">H</span></span> and a piece of state
    in which the execution of <span class="inlinecode"><span class="id" title="var">t</span></span> produces (a result and an output value
    satisfying) <span class="inlinecode"><span class="id" title="var">Q</span></span>, then you own a piece of state in which the execution
    of <span class="inlinecode"><span class="id" title="var">t</span></span> produces <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode"><span class='gray-font'>\</span>*+</span> <span class="inlinecode"><span class="id" title="var">H</span></span>, that is, produces both <span class="inlinecode"><span class="id" title="var">Q</span></span> and <span class="inlinecode"><span class="id" title="var">H</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_frame" class="idref" href="#wp_frame"><span class="id" title="lemma">wp_frame</span></a> : <span class="id" title="keyword">∀</span> <a id="t:11" class="idref" href="#t:11"><span class="id" title="binder">t</span></a> <a id="H:12" class="idref" href="#H:12"><span class="id" title="binder">H</span></a> <a id="Q:13" class="idref" href="#Q:13"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> <a class="idref" href="WPsem.html#t:11"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:13"><span class="id" title="variable">Q</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="WPsem.html#H:12"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> <a class="idref" href="WPsem.html#t:11"><span class="id" title="variable">t</span></a> (<a class="idref" href="WPsem.html#Q:13"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="WPsem.html#H:12"><span class="id" title="variable">H</span></a>).<br/>
</div>

<div class="doc">
The lemma is proved by exploiting the frame rule for triples
    and the equivalence that characterizes <span class="inlinecode"><span class="id" title="var">wp</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="axiom">wp_equiv</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="Rules.html#triple_frame"><span class="id" title="axiom">triple_frame</span></a>. <span class="id" title="tactic">rewrite</span>* &lt;- <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="axiom">wp_equiv</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The connection with the frame might not be totally obvious.
    Recall the frame rule for triples.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">triple</span> <span class="id" title="var">t</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">triple</span> <span class="id" title="var">t</span> (<span class="id" title="var">H<sub>1</sub></span> <span class='gray-font'>\</span>* <span class="id" title="var">H</span>) (<span class="id" title="var">Q</span> <span class='gray-font'>\</span>*+ <span class="id" title="var">H</span>)
</span>    Let us replace the form <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> with the form
    <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>. We obtain the following statement. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_frame_trans" class="idref" href="#wp_frame_trans"><span class="id" title="lemma">wp_frame_trans</span></a> : <span class="id" title="keyword">∀</span> <a id="t:14" class="idref" href="#t:14"><span class="id" title="binder">t</span></a> <a id="H<sub>1</sub>:15" class="idref" href="#H<sub>1</sub>:15"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="Q:16" class="idref" href="#Q:16"><span class="id" title="binder">Q</span></a> <a id="H:17" class="idref" href="#H:17"><span class="id" title="binder">H</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#H<sub>1</sub>:15"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> <a class="idref" href="WPsem.html#t:14"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:16"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#H<sub>1</sub>:15"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="WPsem.html#H:17"><span class="id" title="variable">H</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> <a class="idref" href="WPsem.html#t:14"><span class="id" title="variable">t</span></a> (<a class="idref" href="WPsem.html#Q:16"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="WPsem.html#H:17"><span class="id" title="variable">H</span></a>).<br/>
</div>

<div class="doc">
If we exploit transitivity of entailment to eliminate <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span>, then we
    obtain exactly <span class="inlinecode"><span class="id" title="var">wp_frame</span></span>, as illustrated by the proof script below. 
</div>
<div class="code">

<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">xchange</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span>* <a class="idref" href="WPsem.html#wp_frame"><span class="id" title="lemma">wp_frame</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab223"></a><h3 class="section">The Rule of Consequence</h3>

<div class="paragraph"> </div>

 The rule of consequence for <span class="inlinecode"><span class="id" title="var">wp</span></span> materializes as a covariance
    property: it asserts that <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> is covariant in <span class="inlinecode"><span class="id" title="var">Q</span></span>.
    In other words, if one weakens <span class="inlinecode"><span class="id" title="var">Q</span></span>, then one weakens <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>.
    The corresponding formal statement appears next. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_conseq" class="idref" href="#wp_conseq"><span class="id" title="lemma">wp_conseq</span></a> : <span class="id" title="keyword">∀</span> <a id="t:18" class="idref" href="#t:18"><span class="id" title="binder">t</span></a> <a id="Q<sub>1</sub>:19" class="idref" href="#Q<sub>1</sub>:19"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:20" class="idref" href="#Q<sub>2</sub>:20"><span class="id" title="binder">Q<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#Q<sub>1</sub>:19"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="WPsem.html#Q<sub>2</sub>:20"><span class="id" title="variable">Q<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> <a class="idref" href="WPsem.html#t:18"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q<sub>1</sub>:19"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> <a class="idref" href="WPsem.html#t:18"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q<sub>2</sub>:20"><span class="id" title="variable">Q<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="axiom">wp_equiv</span></a>. <span class="id" title="var">applys</span>* <a class="idref" href="Rules.html#triple_conseq"><span class="id" title="axiom">triple_conseq</span></a> (<a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> <span class="id" title="var">t</span> <span class="id" title="var">Q<sub>1</sub></span>) <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <a class="idref" href="WPsem.html#wp_pre"><span class="id" title="lemma">wp_pre</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The connection with the rule of consequence is, again, not
    totally obvious. Recall the rule of consequence for triples.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">triple</span> <span class="id" title="var">t</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">Q<sub>1</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H<sub>2</sub></span> ==&gt; <span class="id" title="var">H<sub>1</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Q<sub>1</sub></span> ===&gt; <span class="id" title="var">Q<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">triple</span> <span class="id" title="var">t</span> <span class="id" title="var">H<sub>2</sub></span> <span class="id" title="var">Q<sub>2</sub></span>
</span>    Let us replace the form <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> with the form <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>.
    We obtain the following statement: 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_conseq_trans" class="idref" href="#wp_conseq_trans"><span class="id" title="lemma">wp_conseq_trans</span></a> : <span class="id" title="keyword">∀</span> <a id="t:21" class="idref" href="#t:21"><span class="id" title="binder">t</span></a> <a id="H<sub>1</sub>:22" class="idref" href="#H<sub>1</sub>:22"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:23" class="idref" href="#H<sub>2</sub>:23"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="Q<sub>1</sub>:24" class="idref" href="#Q<sub>1</sub>:24"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:25" class="idref" href="#Q<sub>2</sub>:25"><span class="id" title="binder">Q<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#H<sub>1</sub>:22"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> <a class="idref" href="WPsem.html#t:21"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q<sub>1</sub>:24"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#H<sub>2</sub>:23"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#H<sub>1</sub>:22"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#Q<sub>1</sub>:24"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="WPsem.html#Q<sub>2</sub>:25"><span class="id" title="variable">Q<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#H<sub>2</sub>:23"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> <a class="idref" href="WPsem.html#t:21"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q<sub>2</sub>:25"><span class="id" title="variable">Q<sub>2</sub></span></a>.<br/>
</div>

<div class="doc">
If we exploit transitivity of entailment to eliminate <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>,
    then we obtain exactly <span class="inlinecode"><span class="id" title="var">wp_conseq</span></span>, as illustrated below. 
</div>
<div class="code">

<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span> <span class="id" title="var">WH</span> <span class="id" title="var">WQ</span>. <span class="id" title="var">xchange</span> <span class="id" title="var">WH</span>. <span class="id" title="var">xchange</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <a class="idref" href="WPsem.html#wp_conseq"><span class="id" title="lemma">wp_conseq</span></a> <span class="id" title="var">WQ</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab224"></a><h3 class="section">The Extraction Rules</h3>

<div class="paragraph"> </div>

 The extraction rules <span class="inlinecode"><span class="id" title="var">triple_hpure</span></span> and <span class="inlinecode"><span class="id" title="var">triple_hexists</span></span>
    have no specific counterpart with the <span class="inlinecode"><span class="id" title="var">wp</span></span> presentation.
    Indeed, in a weakest-precondition style presentation, the
    extraction rules for triples correspond exactly to the
    extraction rules for entailment.

<div class="paragraph"> </div>

    To see why, consider for example the rule <span class="inlinecode"><span class="id" title="var">triple_hpure</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_hpure" class="idref" href="#triple_hpure"><span class="id" title="axiom">triple_hpure</span></a> : <span class="id" title="keyword">∀</span> <a id="t:26" class="idref" href="#t:26"><span class="id" title="binder">t</span></a> (<a id="P:27" class="idref" href="#P:27"><span class="id" title="binder">P</span></a>:<span class="id" title="keyword">Prop</span>) <a id="H:28" class="idref" href="#H:28"><span class="id" title="binder">H</span></a> <a id="Q:29" class="idref" href="#Q:29"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#P:27"><span class="id" title="variable">P</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:26"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H:28"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:29"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:26"><span class="id" title="variable">t</span></a> (<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="WPsem.html#P:27"><span class="id" title="variable">P</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="WPsem.html#H:28"><span class="id" title="variable">H</span></a>) <a class="idref" href="WPsem.html#Q:29"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
Replacing the form <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> with <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> yields
    the following statement. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_hpure_with_wp" class="idref" href="#triple_hpure_with_wp"><span class="id" title="lemma">triple_hpure_with_wp</span></a> : <span class="id" title="keyword">∀</span> <a id="t:31" class="idref" href="#t:31"><span class="id" title="binder">t</span></a> <a id="H:32" class="idref" href="#H:32"><span class="id" title="binder">H</span></a> <a id="Q:33" class="idref" href="#Q:33"><span class="id" title="binder">Q</span></a> (<a id="P:34" class="idref" href="#P:34"><span class="id" title="binder">P</span></a>:<span class="id" title="keyword">Prop</span>),<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#P:34"><span class="id" title="variable">P</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#H:32"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> <a class="idref" href="WPsem.html#t:31"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:33"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">))</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="WPsem.html#P:34"><span class="id" title="variable">P</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="WPsem.html#H:32"><span class="id" title="variable">H</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> <a class="idref" href="WPsem.html#t:31"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:33"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
The above implication is just a special case of the extraction
    lemma for pure facts on the left on an entailment, named
    <span class="inlinecode"><span class="id" title="var">himpl_hstar_hpure_l</span></span>, and whose statement is as follows.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">P</span> → (<span class="id" title="var">H</span> ==&gt; <span class="id" title="var">H'</span>)) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class='gray-font'>\</span>[<span class="id" title="var">P</span>] <span class='gray-font'>\</span>* <span class="id" title="var">H</span>) ==&gt; <span class="id" title="var">H'</span>.
</span>    Instantiating <span class="inlinecode"><span class="id" title="var">H'</span></span> with <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> proves <span class="inlinecode"><span class="id" title="var">triple_hpure_with_wp</span></span>.

</div>
<div class="code">

<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_hstar_hpure_l"><span class="id" title="lemma">himpl_hstar_hpure_l</span></a> <span class="id" title="var">M</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
A similar reasoning applies to the extraction rule for existentials. 
</div>

<div class="doc">
<a id="lab225"></a><h2 class="section">Reasoning Rules for Terms, in Weakest-Precondition Style</h2>

</div>

<div class="doc">
<a id="lab226"></a><h3 class="section">Rule for Values</h3>

<div class="paragraph"> </div>

 Recall the rule <span class="inlinecode"><span class="id" title="var">triple_val</span></span> which gives a reasoning rule for
    establishing a triple for a value <span class="inlinecode"><span class="id" title="var">v</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_val" class="idref" href="#triple_val"><span class="id" title="axiom">triple_val</span></a> : <span class="id" title="keyword">∀</span> <a id="v:35" class="idref" href="#v:35"><span class="id" title="binder">v</span></a> <a id="H:36" class="idref" href="#H:36"><span class="id" title="binder">H</span></a> <a id="Q:37" class="idref" href="#Q:37"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#H:36"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#Q:37"><span class="id" title="variable">Q</span></a> <a class="idref" href="WPsem.html#v:35"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <a class="idref" href="WPsem.html#v:35"><span class="id" title="variable">v</span></a>) <a class="idref" href="WPsem.html#H:36"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:37"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
If we rewrite this rule in <span class="inlinecode"><span class="id" title="var">wp</span></span> style, we obtain the rule below.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H</span> ==&gt; <span class="id" title="var">Q</span> <span class="id" title="var">v</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H</span> ==&gt; <span class="id" title="var">wp</span> (<span class="id" title="var">trm_val</span> <span class="id" title="var">v</span>) <span class="id" title="var">Q</span>.
</span>    By exploiting transitivity of entailment, we can eliminate <span class="inlinecode"><span class="id" title="var">H</span></span>.
    We obtain the following statement, which reads as follows:
    if you own a state satisfying <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span>, then you own a state
    from which the evaluation of the value <span class="inlinecode"><span class="id" title="var">v</span></span> produces <span class="inlinecode"><span class="id" title="var">Q</span></span>.

</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_val" class="idref" href="#wp_val"><span class="id" title="lemma">wp_val</span></a> : <span class="id" title="keyword">∀</span> <a id="v:39" class="idref" href="#v:39"><span class="id" title="binder">v</span></a> <a id="Q:40" class="idref" href="#Q:40"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#Q:40"><span class="id" title="variable">Q</span></a> <a class="idref" href="WPsem.html#v:39"><span class="id" title="variable">v</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <a class="idref" href="WPsem.html#v:39"><span class="id" title="variable">v</span></a>) <a class="idref" href="WPsem.html#Q:40"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="axiom">wp_equiv</span></a>. <span class="id" title="var">applys</span>* <a class="idref" href="WPsem.html#triple_val"><span class="id" title="axiom">triple_val</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
We can verify that, when migrating to the <span class="inlinecode"><span class="id" title="var">wp</span></span> presentation, we have
    not lost any expressiveness. To that end, we prove that <span class="inlinecode"><span class="id" title="var">triple_val</span></span> is
    derivable from <span class="inlinecode"><span class="id" title="var">wp_val</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_val_derived_from_wp_val" class="idref" href="#triple_val_derived_from_wp_val"><span class="id" title="lemma">triple_val_derived_from_wp_val</span></a> : <span class="id" title="keyword">∀</span> <a id="v:41" class="idref" href="#v:41"><span class="id" title="binder">v</span></a> <a id="H:42" class="idref" href="#H:42"><span class="id" title="binder">H</span></a> <a id="Q:43" class="idref" href="#Q:43"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#H:42"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#Q:43"><span class="id" title="variable">Q</span></a> <a class="idref" href="WPsem.html#v:41"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <a class="idref" href="WPsem.html#v:41"><span class="id" title="variable">v</span></a>) <a class="idref" href="WPsem.html#H:42"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:43"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="axiom">wp_equiv</span></a>. <span class="id" title="var">xchange</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <a class="idref" href="WPsem.html#wp_val"><span class="id" title="lemma">wp_val</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab227"></a><h3 class="section">Rule for Sequence</h3>

<div class="paragraph"> </div>

 Recall the reasoning rule for a sequence <span class="inlinecode"><span class="id" title="var">trm_seq</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_seq" class="idref" href="#triple_seq"><span class="id" title="axiom">triple_seq</span></a> : <span class="id" title="keyword">∀</span> <a id="t<sub>1</sub>:44" class="idref" href="#t<sub>1</sub>:44"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:45" class="idref" href="#t<sub>2</sub>:45"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="H:46" class="idref" href="#H:46"><span class="id" title="binder">H</span></a> <a id="Q:47" class="idref" href="#Q:47"><span class="id" title="binder">Q</span></a> <a id="H<sub>1</sub>:48" class="idref" href="#H<sub>1</sub>:48"><span class="id" title="binder">H<sub>1</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:44"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsem.html#H:46"><span class="id" title="variable">H</span></a> (<span class="id" title="keyword">fun</span> <a id="v:49" class="idref" href="#v:49"><span class="id" title="binder">v</span></a> ⇒ <a class="idref" href="WPsem.html#H<sub>1</sub>:48"><span class="id" title="variable">H<sub>1</sub></span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:45"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="WPsem.html#H<sub>1</sub>:48"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="WPsem.html#Q:47"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:44"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:45"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#H:46"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:47"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
Replacing <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> with <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> throughout the rule
    gives the statement below.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H</span> ==&gt; (<span class="id" title="var">wp</span> <span class="id" title="var">t<sub>1</sub></span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">v</span> ⇒ <span class="id" title="var">H<sub>1</sub></span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H<sub>1</sub></span> ==&gt; (<span class="id" title="var">wp</span> <span class="id" title="var">t<sub>2</sub></span>) <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H</span> ==&gt; <span class="id" title="var">wp</span> (<span class="id" title="var">trm_seq</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>) <span class="id" title="var">Q</span>.
</span>    This entailment holds for any <span class="inlinecode"><span class="id" title="var">H</span></span> and <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span>. Let us specialize it to
    <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode">:=</span> <span class="inlinecode">(<span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span>)</span> <span class="inlinecode"><span class="id" title="var">Q</span></span> and <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">:=</span> <span class="inlinecode">(<span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span>)</span> <span class="inlinecode">(<span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode">(<span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span>)</span> <span class="inlinecode"><span class="id" title="var">Q</span>)</span>.

<div class="paragraph"> </div>

    This leads us to the following statement, which reads as follows:
    if you own a state from which the evaluation of <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> produces a
    state from which the evaluation of <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> produces the postcondition
    <span class="inlinecode"><span class="id" title="var">Q</span></span>, then you own a state from which the evaluation of the sequence
    <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span>;<span class="id" title="var">t<sub>2</sub></span></span> produces <span class="inlinecode"><span class="id" title="var">Q</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_seq" class="idref" href="#wp_seq"><span class="id" title="lemma">wp_seq</span></a> : <span class="id" title="keyword">∀</span> <a id="t<sub>1</sub>:51" class="idref" href="#t<sub>1</sub>:51"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:52" class="idref" href="#t<sub>2</sub>:52"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="Q:53" class="idref" href="#Q:53"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:51"><span class="id" title="variable">t<sub>1</sub></span></a> (<span class="id" title="keyword">fun</span> <a id="v:54" class="idref" href="#v:54"><span class="id" title="binder">v</span></a> ⇒ <a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:52"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="WPsem.html#Q:53"><span class="id" title="variable">Q</span></a>) <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:51"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:52"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#Q:53"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="axiom">wp_equiv</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="WPsem.html#triple_seq"><span class="id" title="axiom">triple_seq</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span>* &lt;- <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="axiom">wp_equiv</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span>* &lt;- <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="axiom">wp_equiv</span></a>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab228"></a><h4 class="section">Exercise: 2 stars, standard, optional (triple_seq_from_wp_seq)</h4>
 Check that <span class="inlinecode"><span class="id" title="var">wp_seq</span></span> is just as expressive as <span class="inlinecode"><span class="id" title="var">triple_seq</span></span>,
    by proving that <span class="inlinecode"><span class="id" title="var">triple_seq</span></span> is derivable from <span class="inlinecode"><span class="id" title="var">wp_seq</span></span>
    and from the structural rules for <span class="inlinecode"><span class="id" title="var">wp</span></span> and/or the structural
    rules for <span class="inlinecode"><span class="id" title="var">triple</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_seq_from_wp_seq" class="idref" href="#triple_seq_from_wp_seq"><span class="id" title="lemma">triple_seq_from_wp_seq</span></a> : <span class="id" title="keyword">∀</span> <a id="t<sub>1</sub>:55" class="idref" href="#t<sub>1</sub>:55"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:56" class="idref" href="#t<sub>2</sub>:56"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="H:57" class="idref" href="#H:57"><span class="id" title="binder">H</span></a> <a id="Q:58" class="idref" href="#Q:58"><span class="id" title="binder">Q</span></a> <a id="H<sub>1</sub>:59" class="idref" href="#H<sub>1</sub>:59"><span class="id" title="binder">H<sub>1</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:55"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsem.html#H:57"><span class="id" title="variable">H</span></a> (<span class="id" title="keyword">fun</span> <a id="v:60" class="idref" href="#v:60"><span class="id" title="binder">v</span></a> ⇒ <a class="idref" href="WPsem.html#H<sub>1</sub>:59"><span class="id" title="variable">H<sub>1</sub></span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:56"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="WPsem.html#H<sub>1</sub>:59"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="WPsem.html#Q:58"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:55"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:56"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#H:57"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:58"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab229"></a><h1 class="section">More Details</h1>

</div>

<div class="doc">
<a id="lab230"></a><h2 class="section">Other Reasoning Rules for Terms</h2>

</div>

<div class="doc">
<a id="lab231"></a><h3 class="section">Rule for Functions</h3>

<div class="paragraph"> </div>

 Recall the reasoning rule for a term <span class="inlinecode"><span class="id" title="var">trm_fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>,
    which evaluates to the value <span class="inlinecode"><span class="id" title="var">val_fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_fun" class="idref" href="#triple_fun"><span class="id" title="axiom">triple_fun</span></a> : <span class="id" title="keyword">∀</span> <a id="x:61" class="idref" href="#x:61"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:62" class="idref" href="#t<sub>1</sub>:62"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="H:63" class="idref" href="#H:63"><span class="id" title="binder">H</span></a> <a id="Q:64" class="idref" href="#Q:64"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#H:63"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#Q:64"><span class="id" title="variable">Q</span></a> (<a class="idref" href="LibSepReference.html#val_fun"><span class="id" title="constructor">val_fun</span></a> <a class="idref" href="WPsem.html#x:61"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:62"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_fun"><span class="id" title="constructor">trm_fun</span></a> <a class="idref" href="WPsem.html#x:61"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:62"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="WPsem.html#H:63"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:64"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
The rule for functions follow exactly the same pattern as for values. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_fun" class="idref" href="#wp_fun"><span class="id" title="lemma">wp_fun</span></a> : <span class="id" title="keyword">∀</span> <a id="x:66" class="idref" href="#x:66"><span class="id" title="binder">x</span></a> <a id="t:67" class="idref" href="#t:67"><span class="id" title="binder">t</span></a> <a id="Q:68" class="idref" href="#Q:68"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#Q:68"><span class="id" title="variable">Q</span></a> (<a class="idref" href="LibSepReference.html#val_fun"><span class="id" title="constructor">val_fun</span></a> <a class="idref" href="WPsem.html#x:66"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t:67"><span class="id" title="variable">t</span></a>) <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_fun"><span class="id" title="constructor">trm_fun</span></a> <a class="idref" href="WPsem.html#x:66"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t:67"><span class="id" title="variable">t</span></a>) <a class="idref" href="WPsem.html#Q:68"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="axiom">wp_equiv</span></a>. <span class="id" title="var">applys</span>* <a class="idref" href="WPsem.html#triple_fun"><span class="id" title="axiom">triple_fun</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
A similar rule holds for the evaluation of a recursive function. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_fix" class="idref" href="#wp_fix"><span class="id" title="lemma">wp_fix</span></a> : <span class="id" title="keyword">∀</span> <a id="f:69" class="idref" href="#f:69"><span class="id" title="binder">f</span></a> <a id="x:70" class="idref" href="#x:70"><span class="id" title="binder">x</span></a> <a id="t:71" class="idref" href="#t:71"><span class="id" title="binder">t</span></a> <a id="Q:72" class="idref" href="#Q:72"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#Q:72"><span class="id" title="variable">Q</span></a> (<a class="idref" href="LibSepReference.html#val_fix"><span class="id" title="constructor">val_fix</span></a> <a class="idref" href="WPsem.html#f:69"><span class="id" title="variable">f</span></a> <a class="idref" href="WPsem.html#x:70"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t:71"><span class="id" title="variable">t</span></a>) <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_fix"><span class="id" title="constructor">trm_fix</span></a> <a class="idref" href="WPsem.html#f:69"><span class="id" title="variable">f</span></a> <a class="idref" href="WPsem.html#x:70"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t:71"><span class="id" title="variable">t</span></a>) <a class="idref" href="WPsem.html#Q:72"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="axiom">wp_equiv</span></a>. <span class="id" title="var">applys</span>* <a class="idref" href="Rules.html#triple_fix"><span class="id" title="axiom">triple_fix</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab232"></a><h3 class="section">Rule for Conditionals</h3>

<div class="paragraph"> </div>

 Recall the reasoning rule for a term <span class="inlinecode"><span class="id" title="var">triple_if</span></span> <span class="inlinecode"><span class="id" title="var">b</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_if" class="idref" href="#triple_if"><span class="id" title="axiom">triple_if</span></a> : <span class="id" title="keyword">∀</span> <a id="b:73" class="idref" href="#b:73"><span class="id" title="binder">b</span></a> <a id="t<sub>1</sub>:74" class="idref" href="#t<sub>1</sub>:74"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:75" class="idref" href="#t<sub>2</sub>:75"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="H:76" class="idref" href="#H:76"><span class="id" title="binder">H</span></a> <a id="Q:77" class="idref" href="#Q:77"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<span class="id" title="keyword">if</span> <a class="idref" href="WPsem.html#b:73"><span class="id" title="variable">b</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="WPsem.html#t<sub>1</sub>:74"><span class="id" title="variable">t<sub>1</sub></span></a> <span class="id" title="keyword">else</span> <a class="idref" href="WPsem.html#t<sub>2</sub>:75"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#H:76"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:77"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> (<a class="idref" href="LibSepReference.html#val_bool"><span class="id" title="constructor">val_bool</span></a> <a class="idref" href="WPsem.html#b:73"><span class="id" title="variable">b</span></a>) <a class="idref" href="WPsem.html#t<sub>1</sub>:74"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:75"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#H:76"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:77"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
Replacing <span class="inlinecode"><span class="id" title="var">triple</span></span> using <span class="inlinecode"><span class="id" title="var">wp</span></span> entailments yields:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H</span> ==&gt; <span class="id" title="var">wp</span> (<span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">t<sub>2</sub></span>) <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H</span> ==&gt; <span class="id" title="var">wp</span> (<span class="id" title="var">trm_if</span> (<span class="id" title="var">val_bool</span> <span class="id" title="var">b</span>) <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>) <span class="id" title="var">Q</span>.
</span>    which simplifies by transitivity to:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">wp</span> (<span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">t<sub>2</sub></span>) <span class="id" title="var">Q</span> ==&gt; <span class="id" title="var">wp</span> (<span class="id" title="var">trm_if</span> (<span class="id" title="var">val_bool</span> <span class="id" title="var">b</span>) <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>) <span class="id" title="var">Q</span>.
</span>    This statement corresponds to the wp-style reasoning rule
    for conditionals. The proof appears next.

</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_if" class="idref" href="#wp_if"><span class="id" title="lemma">wp_if</span></a> : <span class="id" title="keyword">∀</span> <a id="b:79" class="idref" href="#b:79"><span class="id" title="binder">b</span></a> <a id="t<sub>1</sub>:80" class="idref" href="#t<sub>1</sub>:80"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:81" class="idref" href="#t<sub>2</sub>:81"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="Q:82" class="idref" href="#Q:82"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> (<span class="id" title="keyword">if</span> <a class="idref" href="WPsem.html#b:79"><span class="id" title="variable">b</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="WPsem.html#t<sub>1</sub>:80"><span class="id" title="variable">t<sub>1</sub></span></a> <span class="id" title="keyword">else</span> <a class="idref" href="WPsem.html#t<sub>2</sub>:81"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#Q:82"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> (<a class="idref" href="LibSepReference.html#val_bool"><span class="id" title="constructor">val_bool</span></a> <a class="idref" href="WPsem.html#b:79"><span class="id" title="variable">b</span></a>) <a class="idref" href="WPsem.html#t<sub>1</sub>:80"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:81"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#Q:82"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="axiom">wp_equiv</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="WPsem.html#triple_if"><span class="id" title="axiom">triple_if</span></a>. <span class="id" title="tactic">rewrite</span>* &lt;- <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="axiom">wp_equiv</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab233"></a><h3 class="section">Rule for Let-Bindings</h3>

<div class="paragraph"> </div>

 Recall the reasoning rule for a term <span class="inlinecode"><span class="id" title="var">trm_let</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_let" class="idref" href="#triple_let"><span class="id" title="axiom">triple_let</span></a> : <span class="id" title="keyword">∀</span> <a id="x:83" class="idref" href="#x:83"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:84" class="idref" href="#t<sub>1</sub>:84"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:85" class="idref" href="#t<sub>2</sub>:85"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="Q<sub>1</sub>:86" class="idref" href="#Q<sub>1</sub>:86"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="H:87" class="idref" href="#H:87"><span class="id" title="binder">H</span></a> <a id="Q:88" class="idref" href="#Q:88"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:84"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsem.html#H:87"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q<sub>1</sub>:86"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="v<sub>1</sub>:89" class="idref" href="#v<sub>1</sub>:89"><span class="id" title="binder">v<sub>1</sub></span></a>, <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="WPsem.html#x:83"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#v<sub>1</sub>:89"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:85"><span class="id" title="variable">t<sub>2</sub></span></a>) (<a class="idref" href="WPsem.html#Q<sub>1</sub>:86"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="WPsem.html#v<sub>1</sub>:89"><span class="id" title="variable">v<sub>1</sub></span></a>) <a class="idref" href="WPsem.html#Q:88"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="WPsem.html#x:83"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:84"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:85"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#H:87"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:88"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
The rule of <span class="inlinecode"><span class="id" title="var">trm_let</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> is very similar to that for
    <span class="inlinecode"><span class="id" title="var">trm_seq</span></span>, the only difference being the substitution of
    <span class="inlinecode"><span class="id" title="var">x</span></span> by <span class="inlinecode"><span class="id" title="var">v</span></span> in <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>, where <span class="inlinecode"><span class="id" title="var">v</span></span> denotes the result of <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_let" class="idref" href="#wp_let"><span class="id" title="lemma">wp_let</span></a> : <span class="id" title="keyword">∀</span> <a id="x:91" class="idref" href="#x:91"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:92" class="idref" href="#t<sub>1</sub>:92"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:93" class="idref" href="#t<sub>2</sub>:93"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="Q:94" class="idref" href="#Q:94"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:92"><span class="id" title="variable">t<sub>1</sub></span></a> (<span class="id" title="keyword">fun</span> <a id="v<sub>1</sub>:95" class="idref" href="#v<sub>1</sub>:95"><span class="id" title="binder">v<sub>1</sub></span></a> ⇒ <a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="WPsem.html#x:91"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#v<sub>1</sub>:95"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:93"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#Q:94"><span class="id" title="variable">Q</span></a>) <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="WPsem.html#x:91"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:92"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:93"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#Q:94"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="axiom">wp_equiv</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="WPsem.html#triple_let"><span class="id" title="axiom">triple_let</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span>* &lt;- <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="axiom">wp_equiv</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">v</span>. <span class="id" title="tactic">rewrite</span>* &lt;- <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="axiom">wp_equiv</span></a>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab234"></a><h3 class="section">Rule For Function Applications</h3>

<div class="paragraph"> </div>

 Recall the reasoning rule for an application <span class="inlinecode">(<span class="id" title="var">val_fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span>)</span> <span class="inlinecode"><span class="id" title="var">v<sub>2</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_app_fun" class="idref" href="#triple_app_fun"><span class="id" title="axiom">triple_app_fun</span></a> : <span class="id" title="keyword">∀</span> <a id="x:96" class="idref" href="#x:96"><span class="id" title="binder">x</span></a> <a id="v<sub>1</sub>:97" class="idref" href="#v<sub>1</sub>:97"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="v<sub>2</sub>:98" class="idref" href="#v<sub>2</sub>:98"><span class="id" title="binder">v<sub>2</sub></span></a> <a id="t<sub>1</sub>:99" class="idref" href="#t<sub>1</sub>:99"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="H:100" class="idref" href="#H:100"><span class="id" title="binder">H</span></a> <a id="Q:101" class="idref" href="#Q:101"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#v<sub>1</sub>:97"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_fun"><span class="id" title="constructor">val_fun</span></a> <a class="idref" href="WPsem.html#x:96"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:99"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="WPsem.html#x:96"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#v<sub>2</sub>:98"><span class="id" title="variable">v<sub>2</sub></span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:99"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="WPsem.html#H:100"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:101"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="WPsem.html#v<sub>1</sub>:97"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="WPsem.html#v<sub>2</sub>:98"><span class="id" title="variable">v<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#H:100"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:101"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
The corresponding <span class="inlinecode"><span class="id" title="var">wp</span></span> rule is stated and proved next. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_app_fun" class="idref" href="#wp_app_fun"><span class="id" title="lemma">wp_app_fun</span></a> : <span class="id" title="keyword">∀</span> <a id="x:103" class="idref" href="#x:103"><span class="id" title="binder">x</span></a> <a id="v<sub>1</sub>:104" class="idref" href="#v<sub>1</sub>:104"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="v<sub>2</sub>:105" class="idref" href="#v<sub>2</sub>:105"><span class="id" title="binder">v<sub>2</sub></span></a> <a id="t<sub>1</sub>:106" class="idref" href="#t<sub>1</sub>:106"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="Q:107" class="idref" href="#Q:107"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#v<sub>1</sub>:104"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_fun"><span class="id" title="constructor">val_fun</span></a> <a class="idref" href="WPsem.html#x:103"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:106"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="WPsem.html#x:103"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#v<sub>2</sub>:105"><span class="id" title="variable">v<sub>2</sub></span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:106"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="WPsem.html#Q:107"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="WPsem.html#v<sub>1</sub>:104"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="WPsem.html#v<sub>2</sub>:105"><span class="id" title="variable">v<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#Q:107"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">EQ<sub>1</sub></span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="axiom">wp_equiv</span></a>. <span class="id" title="var">applys</span>* <a class="idref" href="WPsem.html#triple_app_fun"><span class="id" title="axiom">triple_app_fun</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span>* &lt;- <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="axiom">wp_equiv</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
A similar rule holds for the application of a recursive function. 
</div>

<div class="doc">
<a id="lab235"></a><h1 class="section">Optional Material</h1>

</div>

<div class="doc">
<a id="lab236"></a><h2 class="section">A Concrete Definition for Weakest Precondition</h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="WpHighLevel" class="idref" href="#WpHighLevel"><span class="id" title="module">WpHighLevel</span></a>.<br/>
</div>

<div class="doc">
The lemma <span class="inlinecode"><span class="id" title="var">wp_equiv</span></span> captures the characteristic property of <span class="inlinecode"><span class="id" title="var">wp</span></span>,
    that is, <span class="inlinecode"></span> <span class="inlinecode">(<span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>)</span> <span class="inlinecode">↔</span> <span class="inlinecode">(<span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>)</span> <span class="inlinecode"></span>.

<div class="paragraph"> </div>

    However, it does not give evidence that there exists a predicate <span class="inlinecode"><span class="id" title="var">wp</span></span>
    satisfying this equivalence. We next present one possible definition.

<div class="paragraph"> </div>

    The idea is to define <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> as the predicate
    <span class="inlinecode"><span class='gray-font'>\</span><span class="id" title="tactic">∃</span></span> <span class="inlinecode"><span class="id" title="var">H</span>,</span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>]</span>, which, reading litterally, is
    satisfied by "any" heap predicate <span class="inlinecode"><span class="id" title="var">H</span></span> which is a valid precondition
    for a triple for the term <span class="inlinecode"><span class="id" title="var">t</span></span> and the postcondition <span class="inlinecode"><span class="id" title="var">Q</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="WpHighLevel.wp" class="idref" href="#WpHighLevel.wp"><span class="id" title="definition">wp</span></a> (<a id="t:108" class="idref" href="#t:108"><span class="id" title="binder">t</span></a>:<a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>) (<a id="Q:109" class="idref" href="#Q:109"><span class="id" title="binder">Q</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">(</span></a><a id="H:110" class="idref" href="#H:110"><span class="id" title="binder">H</span></a>:<a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">),</span></a> <a class="idref" href="WPsem.html#H:110"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:108"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H:110"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:109"><span class="id" title="variable">Q</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>.<br/>
</div>

<div class="doc">
First, let us prove that <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> is itself a valid precondition,
    in the sense that <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">(<span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>)</span> <span class="inlinecode"><span class="id" title="var">Q</span></span> always holds (as asserted
    by the lemma <span class="inlinecode"><span class="id" title="var">wp_pre</span></span>).

<div class="paragraph"> </div>

    To establish this fact, we have to prove:
    <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">(<span class='gray-font'>\</span><span class="id" title="tactic">∃</span></span> <span class="inlinecode"><span class="id" title="var">H</span>,</span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>])</span> <span class="inlinecode"><span class="id" title="var">Q</span></span>.

<div class="paragraph"> </div>

    Applying the extraction rule for existentials gives:
    <span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">H</span>,</span> <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">(<span class="id" title="var">H</span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>])</span> <span class="inlinecode"><span class="id" title="var">Q</span></span>.

<div class="paragraph"> </div>

    Applying the extraction rule for pure facts gives:
    <span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">H</span>,</span> <span class="inlinecode">(<span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>)</span> <span class="inlinecode">→</span> <span class="inlinecode">(<span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>)</span>, which is true. 
<div class="paragraph"> </div>

 Second, let us demonstrate that the heap predicate <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>
    is entailed by any precondition <span class="inlinecode"><span class="id" title="var">H</span></span> that satisfies <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>,
    as asserted by the lemma <span class="inlinecode"><span class="id" title="var">wp_weakest</span></span>.

<div class="paragraph"> </div>

    Assume <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>. Let us prove <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>, that is
    <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class='gray-font'>\</span><span class="id" title="tactic">∃</span></span> <span class="inlinecode"><span class="id" title="var">H</span>,</span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>]</span>. Instantiating the
    <span class="inlinecode"><span class="id" title="var">H</span></span> on the right-hand side as the <span class="inlinecode"><span class="id" title="var">H</span></span> from the left-hand side
    suffices to satisfy the entailment. 
<div class="paragraph"> </div>

 Recall that the properties <span class="inlinecode"><span class="id" title="var">wp_pre</span></span> and <span class="inlinecode"><span class="id" title="var">wp_weakest</span></span> were derivable
    from the characteristic equivalence <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode">↔</span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>.
    Thus, to formalize the proofs of <span class="inlinecode"><span class="id" title="var">wp_pre</span></span> and <span class="inlinecode"><span class="id" title="var">wp_weakest</span></span>, all we
    have to do is to establish that equivalence. 
<div class="paragraph"> </div>

<a id="lab237"></a><h4 class="section">Exercise: 2 stars, standard, especially useful (wp_equiv)</h4>
 Prove that the definition <span class="inlinecode"><span class="id" title="var">wp</span></span> satisfies the characteristic equivalence
    for weakest preconditions. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WpHighLevel.wp_equiv" class="idref" href="#WpHighLevel.wp_equiv"><span class="id" title="lemma">wp_equiv</span></a> : <span class="id" title="keyword">∀</span> <a id="t:111" class="idref" href="#t:111"><span class="id" title="binder">t</span></a> <a id="H:112" class="idref" href="#H:112"><span class="id" title="binder">H</span></a> <a id="Q:113" class="idref" href="#Q:113"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#H:112"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#WpHighLevel.wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:111"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:113"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:111"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H:112"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:113"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<span class="id" title="keyword">End</span> <a class="idref" href="WPsem.html#WpHighLevel"><span class="id" title="module">WpHighLevel</span></a>.<br/>
</div>

<div class="doc">
<a id="lab238"></a><h2 class="section">Equivalence Between all Definitions Of <span class="inlinecode"><span class="id" title="var">wp</span></span></h2>

<div class="paragraph"> </div>

 We next prove that the equivalence <span class="inlinecode">(<span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>)</span> <span class="inlinecode">↔</span> <span class="inlinecode">(<span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>)</span>
    defines a unique predicate <span class="inlinecode"><span class="id" title="var">wp</span></span>. In other words, all possible
    definitions of <span class="inlinecode"><span class="id" title="var">wp</span></span> are equivalent to each another.
    Thus, it really does not matter which concrete definition
    of <span class="inlinecode"><span class="id" title="var">wp</span></span> we consider: they are all equivalent.

<div class="paragraph"> </div>

    Concretely, assume two predicates <span class="inlinecode"><span class="id" title="var">wp<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">wp<sub>2</sub></span></span> to both satisfy
    the characteristic equivalence. We prove that they are equal. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_unique" class="idref" href="#wp_unique"><span class="id" title="lemma">wp_unique</span></a> : <span class="id" title="keyword">∀</span> <a id="wp<sub>1</sub>:114" class="idref" href="#wp<sub>1</sub>:114"><span class="id" title="binder">wp<sub>1</sub></span></a> <a id="wp<sub>2</sub>:115" class="idref" href="#wp<sub>2</sub>:115"><span class="id" title="binder">wp<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="t:116" class="idref" href="#t:116"><span class="id" title="binder">t</span></a> <a id="H:117" class="idref" href="#H:117"><span class="id" title="binder">H</span></a> <a id="Q:118" class="idref" href="#Q:118"><span class="id" title="binder">Q</span></a>, <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:116"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H:117"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:118"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#H:117"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp<sub>1</sub>:114"><span class="id" title="variable">wp<sub>1</sub></span></a> <a class="idref" href="WPsem.html#t:116"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:118"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="t:119" class="idref" href="#t:119"><span class="id" title="binder">t</span></a> <a id="H:120" class="idref" href="#H:120"><span class="id" title="binder">H</span></a> <a id="Q:121" class="idref" href="#Q:121"><span class="id" title="binder">Q</span></a>, <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:119"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H:120"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:121"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#H:120"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp<sub>2</sub>:115"><span class="id" title="variable">wp<sub>2</sub></span></a> <a class="idref" href="WPsem.html#t:119"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:121"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#wp<sub>1</sub>:114"><span class="id" title="variable">wp<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WPsem.html#wp<sub>2</sub>:115"><span class="id" title="variable">wp<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="var">applys</span> <span class="id" title="lemma">fun_ext_2</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">t</span> <span class="id" title="var">Q</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_antisym"><span class="id" title="lemma">himpl_antisym</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">M<sub>1</sub></span>. <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">M<sub>1</sub></span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="tactic">auto</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Recall that both <span class="inlinecode"><span class="id" title="var">wp_pre</span></span> and <span class="inlinecode"><span class="id" title="var">wp_weakest</span></span> are derivable from
    <span class="inlinecode"><span class="id" title="var">wp_equiv</span></span>. Let us also that, reciprocally, <span class="inlinecode"><span class="id" title="var">wp_equiv</span></span> is derivable
    from the conjunction of <span class="inlinecode"><span class="id" title="var">wp_pre</span></span> and <span class="inlinecode"><span class="id" title="var">wp_weakest</span></span>.

<div class="paragraph"> </div>

    In other words, the property of "being the weakest precondition"
    also uniquely characterizes the definition of <span class="inlinecode"><span class="id" title="var">wp</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_from_weakest_pre" class="idref" href="#wp_from_weakest_pre"><span class="id" title="lemma">wp_from_weakest_pre</span></a> : <span class="id" title="keyword">∀</span> <a id="wp':122" class="idref" href="#wp':122"><span class="id" title="binder">wp'</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="t:123" class="idref" href="#t:123"><span class="id" title="binder">t</span></a> <a id="Q:124" class="idref" href="#Q:124"><span class="id" title="binder">Q</span></a>, <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:123"><span class="id" title="variable">t</span></a> (<a class="idref" href="WPsem.html#wp':122"><span class="id" title="variable">wp'</span></a> <a class="idref" href="WPsem.html#t:123"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:124"><span class="id" title="variable">Q</span></a>) <a class="idref" href="WPsem.html#Q:124"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a>  <span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">wp_pre</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="t:125" class="idref" href="#t:125"><span class="id" title="binder">t</span></a> <a id="H:126" class="idref" href="#H:126"><span class="id" title="binder">H</span></a> <a id="Q:127" class="idref" href="#Q:127"><span class="id" title="binder">Q</span></a>, <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:125"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H:126"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:127"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="WPsem.html#H:126"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp':122"><span class="id" title="variable">wp'</span></a> <a class="idref" href="WPsem.html#t:125"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:127"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a>  <span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">wp_weakest</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="t:128" class="idref" href="#t:128"><span class="id" title="binder">t</span></a> <a id="H:129" class="idref" href="#H:129"><span class="id" title="binder">H</span></a> <a id="Q:130" class="idref" href="#Q:130"><span class="id" title="binder">Q</span></a>, <a class="idref" href="WPsem.html#H:129"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp':122"><span class="id" title="variable">wp'</span></a> <a class="idref" href="WPsem.html#t:128"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:130"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:128"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H:129"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:130"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a>. <span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">wp_equiv</span></span>&nbsp;*)</span><br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="var">iff</span> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Rules.html#triple_conseq"><span class="id" title="axiom">triple_conseq</span></a> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">M</span>. <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="tactic">auto</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab239"></a><h2 class="section">An Alternative Definition for Weakest Precondition</h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="WpLowLevel" class="idref" href="#WpLowLevel"><span class="id" title="module">WpLowLevel</span></a>.<br/>
</div>

<div class="doc">
The concrete definition for <span class="inlinecode"><span class="id" title="var">wp</span></span> given above is expressed
    in terms of Separation Logic combinators. In contrast to
    this "high level" definition, there exists a more "low level"
    definition, expressed directly as a function over heaps.

<div class="paragraph"> </div>

    In that alternative definition, the heap predicate <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>
    is defined as a predicate that holds of a heap <span class="inlinecode"><span class="id" title="var">h</span></span>
    if and only if the execution of <span class="inlinecode"><span class="id" title="var">t</span></span> starting in exactly
    the heap <span class="inlinecode"><span class="id" title="var">h</span></span> produces the post-condition <span class="inlinecode"><span class="id" title="var">Q</span></span>.

<div class="paragraph"> </div>

    Technically, <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> can be defined as:
    <span class="inlinecode"><span class="id" title="keyword">fun</span></span> <span class="inlinecode">(<span class="id" title="var">h</span>:<span class="id" title="var">heap</span>)</span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">(<span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">h'</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">h'</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">h</span>)</span> <span class="inlinecode"><span class="id" title="var">Q</span></span>.
    In other words, the precondition requires the input heap
    to be exactly <span class="inlinecode"><span class="id" title="var">h</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="WpLowLevel.wp" class="idref" href="#WpLowLevel.wp"><span class="id" title="definition">wp</span></a> (<a id="t:131" class="idref" href="#t:131"><span class="id" title="binder">t</span></a>:<a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>) (<a id="Q:132" class="idref" href="#Q:132"><span class="id" title="binder">Q</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<a id="h:133" class="idref" href="#h:133"><span class="id" title="binder">h</span></a>:<a class="idref" href="LibSepReference.html#heap"><span class="id" title="definition">heap</span></a>) ⇒ <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:131"><span class="id" title="variable">t</span></a> (<span class="id" title="keyword">fun</span> <a id="h':134" class="idref" href="#h':134"><span class="id" title="binder">h'</span></a> ⇒ (<a class="idref" href="WPsem.html#h':134"><span class="id" title="variable">h'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WPsem.html#h:133"><span class="id" title="variable">h</span></a>)) <a class="idref" href="WPsem.html#Q:132"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
<a id="lab240"></a><h4 class="section">Exercise: 4 stars, standard, optional (wp_equiv_wp_low)</h4>
 Prove this alternative definition of <span class="inlinecode"><span class="id" title="var">wp</span></span> also satisfies the
    characteristic equivalence <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode">↔</span> <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>.
    Hint: exploit the lemma <span class="inlinecode"><span class="id" title="var">triple_named_heap</span></span> which was
    established as an exercise in the appendix of the chapter
    <span class="inlinecode"><span class="id" title="var">Himpl</span></span>.) 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WpLowLevel.wp_equiv_wp_low" class="idref" href="#WpLowLevel.wp_equiv_wp_low"><span class="id" title="lemma">wp_equiv_wp_low</span></a> : <span class="id" title="keyword">∀</span> <a id="t:135" class="idref" href="#t:135"><span class="id" title="binder">t</span></a> <a id="H:136" class="idref" href="#H:136"><span class="id" title="binder">H</span></a> <a id="Q:137" class="idref" href="#Q:137"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#H:136"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#WpLowLevel.wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:135"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:137"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:135"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H:136"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:137"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<span class="id" title="keyword">End</span> <a class="idref" href="WPsem.html#WpLowLevel"><span class="id" title="module">WpLowLevel</span></a>.<br/>
</div>

<div class="doc">
<a id="lab241"></a><h2 class="section">Extraction Rule for Existentials</h2>

<div class="paragraph"> </div>

 Recall the extraction rule for existentials. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_hexists" class="idref" href="#triple_hexists"><span class="id" title="axiom">triple_hexists</span></a> : <span class="id" title="keyword">∀</span> <a id="t:138" class="idref" href="#t:138"><span class="id" title="binder">t</span></a> (<a id="A:139" class="idref" href="#A:139"><span class="id" title="binder">A</span></a>:<span class="id" title="keyword">Type</span>) (<a id="J:140" class="idref" href="#J:140"><span class="id" title="binder">J</span></a>:<a class="idref" href="WPsem.html#A:139"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) <a id="Q:141" class="idref" href="#Q:141"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="x:142" class="idref" href="#x:142"><span class="id" title="binder">x</span></a>, <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:138"><span class="id" title="variable">t</span></a> (<a class="idref" href="WPsem.html#J:140"><span class="id" title="variable">J</span></a> <a class="idref" href="WPsem.html#x:142"><span class="id" title="variable">x</span></a>) <a class="idref" href="WPsem.html#Q:141"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:138"><span class="id" title="variable">t</span></a> (<a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="x:143" class="idref" href="#x:143"><span class="id" title="binder">x</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="WPsem.html#J:140"><span class="id" title="variable">J</span></a> <a class="idref" href="WPsem.html#x:143"><span class="id" title="variable">x</span></a>) <a class="idref" href="WPsem.html#Q:141"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
Replacing <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> with <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> yields the
    lemma stated below. 
<div class="paragraph"> </div>

<a id="lab242"></a><h4 class="section">Exercise: 1 star, standard, optional (triple_hexists_in_wp)</h4>
 Prove the extraction rule for existentials in <span class="inlinecode"><span class="id" title="var">wp</span></span> style. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_hexists_in_wp" class="idref" href="#triple_hexists_in_wp"><span class="id" title="lemma">triple_hexists_in_wp</span></a> : <span class="id" title="keyword">∀</span> <a id="t:145" class="idref" href="#t:145"><span class="id" title="binder">t</span></a> <a id="Q:146" class="idref" href="#Q:146"><span class="id" title="binder">Q</span></a> <a id="A:147" class="idref" href="#A:147"><span class="id" title="binder">A</span></a> (<a id="J:148" class="idref" href="#J:148"><span class="id" title="binder">J</span></a>:<a class="idref" href="WPsem.html#A:147"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="x:149" class="idref" href="#x:149"><span class="id" title="binder">x</span></a>, (<a class="idref" href="WPsem.html#J:148"><span class="id" title="variable">J</span></a> <a class="idref" href="WPsem.html#x:149"><span class="id" title="variable">x</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> <a class="idref" href="WPsem.html#t:145"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:146"><span class="id" title="variable">Q</span></a>)<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="x:150" class="idref" href="#x:150"><span class="id" title="binder">x</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="WPsem.html#J:148"><span class="id" title="variable">J</span></a> <a class="idref" href="WPsem.html#x:150"><span class="id" title="variable">x</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> <a class="idref" href="WPsem.html#t:145"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:146"><span class="id" title="variable">Q</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 In other words, in the <span class="inlinecode"><span class="id" title="var">wp</span></span> presentation, we do not need
    a specific extraction rule for existentials, because the
    extraction rule for entailment already does the job. 
</div>

<div class="doc">
<a id="lab243"></a><h2 class="section">Combined Structural Rule</h2>

<div class="paragraph"> </div>

 Recall the combined consequence-frame rule for <span class="inlinecode"><span class="id" title="var">triple</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_conseq_frame" class="idref" href="#triple_conseq_frame"><span class="id" title="axiom">triple_conseq_frame</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>2</sub>:151" class="idref" href="#H<sub>2</sub>:151"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="H<sub>1</sub>:152" class="idref" href="#H<sub>1</sub>:152"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="Q<sub>1</sub>:153" class="idref" href="#Q<sub>1</sub>:153"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="t:154" class="idref" href="#t:154"><span class="id" title="binder">t</span></a> <a id="H:155" class="idref" href="#H:155"><span class="id" title="binder">H</span></a> <a id="Q:156" class="idref" href="#Q:156"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:154"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H<sub>1</sub>:152"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="WPsem.html#Q<sub>1</sub>:153"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#H:155"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#H<sub>1</sub>:152"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="WPsem.html#H<sub>2</sub>:151"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#Q<sub>1</sub>:153"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="WPsem.html#H<sub>2</sub>:151"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="WPsem.html#Q:156"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:154"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H:155"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:156"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
Let us reformulate this rule using <span class="inlinecode"><span class="id" title="var">wp</span></span>, replacing the
    form <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> with the form <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>. 
<div class="paragraph"> </div>

<a id="lab244"></a><h4 class="section">Exercise: 2 stars, standard, especially useful (wp_conseq_frame_trans)</h4>
 Prove the combined structural rule in <span class="inlinecode"><span class="id" title="var">wp</span></span> style.
    Hint: exploit <span class="inlinecode"><span class="id" title="var">wp_conseq_trans</span></span> and <span class="inlinecode"><span class="id" title="var">wp_frame</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_conseq_frame_trans" class="idref" href="#wp_conseq_frame_trans"><span class="id" title="lemma">wp_conseq_frame_trans</span></a> : <span class="id" title="keyword">∀</span> <a id="t:158" class="idref" href="#t:158"><span class="id" title="binder">t</span></a> <a id="H:159" class="idref" href="#H:159"><span class="id" title="binder">H</span></a> <a id="H<sub>1</sub>:160" class="idref" href="#H<sub>1</sub>:160"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:161" class="idref" href="#H<sub>2</sub>:161"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="Q<sub>1</sub>:162" class="idref" href="#Q<sub>1</sub>:162"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q:163" class="idref" href="#Q:163"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#H<sub>1</sub>:160"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> <a class="idref" href="WPsem.html#t:158"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q<sub>1</sub>:162"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#H:159"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#H<sub>1</sub>:160"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="WPsem.html#H<sub>2</sub>:161"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#Q<sub>1</sub>:162"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="WPsem.html#H<sub>2</sub>:161"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="WPsem.html#Q:163"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#H:159"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> <a class="idref" href="WPsem.html#t:158"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:163"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 The combined structural rule for <span class="inlinecode"><span class="id" title="var">wp</span></span> can actually be stated in a more
    concise way. The rule reads as follows: if you own a state from which the
    execution of <span class="inlinecode"><span class="id" title="var">t</span></span> produces (a result and a state satisfying) <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> and you
    own <span class="inlinecode"><span class="id" title="var">H</span></span>, and if you can trade the combination of <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">H</span></span> against <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span></span>,
    the you own a piece of state from which the execution of <span class="inlinecode"><span class="id" title="var">t</span></span> produces
    <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span></span>. 
<div class="paragraph"> </div>

<a id="lab245"></a><h4 class="section">Exercise: 2 stars, standard, especially useful (wp_conseq_frame)</h4>
 Prove the concise version of the combined structural rule
    in <span class="inlinecode"><span class="id" title="var">wp</span></span> style. Many proofs are possible. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_conseq_frame" class="idref" href="#wp_conseq_frame"><span class="id" title="lemma">wp_conseq_frame</span></a> : <span class="id" title="keyword">∀</span> <a id="t:164" class="idref" href="#t:164"><span class="id" title="binder">t</span></a> <a id="H:165" class="idref" href="#H:165"><span class="id" title="binder">H</span></a> <a id="Q<sub>1</sub>:166" class="idref" href="#Q<sub>1</sub>:166"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:167" class="idref" href="#Q<sub>2</sub>:167"><span class="id" title="binder">Q<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#Q<sub>1</sub>:166"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="WPsem.html#H:165"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="WPsem.html#Q<sub>2</sub>:167"><span class="id" title="variable">Q<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> <a class="idref" href="WPsem.html#t:164"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q<sub>1</sub>:166"><span class="id" title="variable">Q<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="WPsem.html#H:165"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> <a class="idref" href="WPsem.html#t:164"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q<sub>2</sub>:167"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab246"></a><h2 class="section">Alternative Statement of the Rule for Conditionals</h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="WpIfAlt" class="idref" href="#WpIfAlt"><span class="id" title="module">WpIfAlt</span></a>.<br/>
</div>

<div class="doc">
We have established the following rule for reasoning about
    conditionals using <span class="inlinecode"><span class="id" title="var">wp</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="WpIfAlt.wp_if" class="idref" href="#WpIfAlt.wp_if"><span class="id" title="axiom">wp_if</span></a> : <span class="id" title="keyword">∀</span> <a id="b:168" class="idref" href="#b:168"><span class="id" title="binder">b</span></a> <a id="t<sub>1</sub>:169" class="idref" href="#t<sub>1</sub>:169"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:170" class="idref" href="#t<sub>2</sub>:170"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="Q:171" class="idref" href="#Q:171"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> (<span class="id" title="keyword">if</span> <a class="idref" href="WPsem.html#b:168"><span class="id" title="variable">b</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="WPsem.html#t<sub>1</sub>:169"><span class="id" title="variable">t<sub>1</sub></span></a> <span class="id" title="keyword">else</span> <a class="idref" href="WPsem.html#t<sub>2</sub>:170"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#Q:171"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> <a class="idref" href="WPsem.html#b:168"><span class="id" title="variable">b</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:169"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:170"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#Q:171"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
Equivalently, the rule may be stated with the conditional around
    the calls to <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> and <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>. 
<div class="paragraph"> </div>

<a id="lab247"></a><h4 class="section">Exercise: 1 star, standard, optional (wp_if')</h4>
 Prove the alternative statement of rule <span class="inlinecode"><span class="id" title="var">wp_if</span></span>,
    either from <span class="inlinecode"><span class="id" title="var">wp_if</span></span> or directly from <span class="inlinecode"><span class="id" title="var">triple_if</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WpIfAlt.wp_if'" class="idref" href="#WpIfAlt.wp_if'"><span class="id" title="lemma">wp_if'</span></a> : <span class="id" title="keyword">∀</span> <a id="b:173" class="idref" href="#b:173"><span class="id" title="binder">b</span></a> <a id="t<sub>1</sub>:174" class="idref" href="#t<sub>1</sub>:174"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:175" class="idref" href="#t<sub>2</sub>:175"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="Q:176" class="idref" href="#Q:176"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><span class="id" title="keyword">if</span> <a class="idref" href="WPsem.html#b:173"><span class="id" title="variable">b</span></a> <span class="id" title="keyword">then</span> (<a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:174"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsem.html#Q:176"><span class="id" title="variable">Q</span></a>) <span class="id" title="keyword">else</span> (<a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:175"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="WPsem.html#Q:176"><span class="id" title="variable">Q</span></a>)<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="axiom">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> <a class="idref" href="WPsem.html#b:173"><span class="id" title="variable">b</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:174"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:175"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#Q:176"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<span class="id" title="keyword">End</span> <a class="idref" href="WPsem.html#WpIfAlt"><span class="id" title="module">WpIfAlt</span></a>.<br/>
</div>

<div class="doc">
<a id="lab248"></a><h2 class="section">Definition of <span class="inlinecode"><span class="id" title="var">wp</span></span> Directly from <span class="inlinecode"><span class="id" title="var">hoare</span></span></h2>

<div class="paragraph"> </div>

 Let's take a step back and look at our construction of
    Separation Logic so far.

<div class="paragraph"> </div>

    1. We defined Hoare triples (<span class="inlinecode"><span class="id" title="var">hoare</span></span>) with respect to the big-step
       judgment (<span class="inlinecode"><span class="id" title="tactic">eval</span></span>).

<div class="paragraph"> </div>

    2. We defined Separation Logic triples (<span class="inlinecode"><span class="id" title="var">triple</span></span>) in terms of
       Hoare triples (<span class="inlinecode"><span class="id" title="var">hoare</span></span>), through the definition:
       \<span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">H'</span>,</span> <span class="inlinecode"><span class="id" title="var">hoare</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">(<span class="id" title="var">H</span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H'</span>)</span> <span class="inlinecode">(<span class="id" title="var">Q</span></span> <span class="inlinecode"><span class='gray-font'>\</span>*+</span> <span class="inlinecode"><span class="id" title="var">H'</span>)</span>.

<div class="paragraph"> </div>

    3. We then defined Separation Logic weakest-preconditions (<span class="inlinecode"><span class="id" title="var">wp</span></span>)
       in terms of Separation Logic triples (<span class="inlinecode"><span class="id" title="var">triple</span></span>).

<div class="paragraph"> </div>

    Through the construction, we established reasoning rules, first
    for Hoare triples (<span class="inlinecode"><span class="id" title="var">hoare</span></span>), then for Separation Logic triples
    (<span class="inlinecode"><span class="id" title="var">triple</span></span>), and finally for weakest-preconditions (<span class="inlinecode"><span class="id" title="var">wp</span></span>).

<div class="paragraph"> </div>

    One question that naturally arises is whether there is a more direct
    route to deriving reasoning rules for weakest preconditions.
    In other words, can we obtain the same end result through simpler
    proofs? 
<div class="paragraph"> </div>

 The notion of Hoare triple is a key abstraction that enables conduction
    further proofs without manipulating heaps (of type <span class="inlinecode"><span class="id" title="var">heap</span></span>) explicitly.
    Experiments suggest that it is beneficial to introduce the Hoare
    logic layer. In other words, it is counterproductive to try and prove
    Separation Logic reasoning rules, whether for <span class="inlinecode"><span class="id" title="var">triple</span></span> or for <span class="inlinecode"><span class="id" title="var">wp</span></span>,
    directly with respect to the evaluation judgment <span class="inlinecode"><span class="id" title="tactic">eval</span></span>.

<div class="paragraph"> </div>

    Thus, the only question that remains is whether it would have some
    interest to derive the reasoning rules for weakest preconditions (<span class="inlinecode"><span class="id" title="var">wp</span></span>)
    directly from the the reasoning rules for Hoare triples (<span class="inlinecode"><span class="id" title="var">hoare</span></span>),
    that is, by bypassing the statement and proofs for the reasoning rules
    for Separation Logic triples (<span class="inlinecode"><span class="id" title="var">triple</span></span>).

<div class="paragraph"> </div>

    In what follows, we show that if one cares only for <span class="inlinecode"><span class="id" title="var">wp</span></span>-style rules,
    then the route to deriving them straight from <span class="inlinecode"><span class="id" title="var">hoare</span></span>-style rules
    may indeed be somewhat shorter. 
</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="WpFromHoare" class="idref" href="#WpFromHoare"><span class="id" title="module">WpFromHoare</span></a>.<br/>
</div>

<div class="doc">
Recall the definition of <span class="inlinecode"><span class="id" title="var">triple</span></span> in terms of <span class="inlinecode"><span class="id" title="var">hoare</span></span>.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">triple</span> (<span class="id" title="var">t</span>:<span class="id" title="var">trm</span>) (<span class="id" title="var">H</span>:<span class="id" title="var">hprop</span>) (<span class="id" title="var">Q</span>:<span class="id" title="var">val</span>→<span class="id" title="var">hprop</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">H'</span>:<span class="id" title="var">hprop</span>), <span class="id" title="var">hoare</span> <span class="id" title="var">t</span> (<span class="id" title="var">H</span> <span class='gray-font'>\</span>* <span class="id" title="var">H'</span>) (<span class="id" title="var">Q</span> <span class='gray-font'>\</span>*+ <span class="id" title="var">H'</span>).
</span>    In what follows, we conduct the proofs by assuming a concrete definition
    for <span class="inlinecode"><span class="id" title="var">wp</span></span> that lends itself better to automated  proofs. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="WpFromHoare.wp" class="idref" href="#WpFromHoare.wp"><span class="id" title="definition">wp</span></a> (<a id="t:177" class="idref" href="#t:177"><span class="id" title="binder">t</span></a>:<a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>) := <span class="id" title="keyword">fun</span> (<a id="Q:178" class="idref" href="#Q:178"><span class="id" title="binder">Q</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) ⇒<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="H:179" class="idref" href="#H:179"><span class="id" title="binder">H</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="WPsem.html#H:179"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:177"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H:179"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:178"><span class="id" title="variable">Q</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>.<br/>
</div>

<div class="doc">
First, we check the equivalence between <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> and <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>.
    This proof is the same as <span class="inlinecode"><span class="id" title="var">wp_equiv</span></span> from the module <span class="inlinecode"><span class="id" title="var">WpHighLevel</span></span>
    given earlier in this chapter. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WpFromHoare.wp_equiv" class="idref" href="#WpFromHoare.wp_equiv"><span class="id" title="lemma">wp_equiv</span></a> : <span class="id" title="keyword">∀</span> <a id="t:180" class="idref" href="#t:180"><span class="id" title="binder">t</span></a> <a id="H:181" class="idref" href="#H:181"><span class="id" title="binder">H</span></a> <a id="Q:182" class="idref" href="#Q:182"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#H:181"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#WpFromHoare.wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:180"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:182"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:180"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H:181"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:182"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="WPsem.html#WpFromHoare.wp"><span class="id" title="definition">wp</span></a>. <span class="id" title="var">iff</span> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span>* <a class="idref" href="Rules.html#triple_conseq"><span class="id" title="axiom">triple_conseq</span></a> <span class="id" title="var">Q</span> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="WPsem.html#triple_hexists"><span class="id" title="axiom">triple_hexists</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_comm"><span class="id" title="lemma">hstar_comm</span></a>. <span class="id" title="var">applys</span>* <a class="idref" href="WPsem.html#triple_hpure"><span class="id" title="axiom">triple_hpure</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span>* <span class="id" title="var">H</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Second, we prove the consequence-frame rule associated with <span class="inlinecode"><span class="id" title="var">wp</span></span>.
    It is the only structural rule that is needed for working with
    weakest preconditions. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WpFromHoare.wp_conseq_frame" class="idref" href="#WpFromHoare.wp_conseq_frame"><span class="id" title="lemma">wp_conseq_frame</span></a> : <span class="id" title="keyword">∀</span> <a id="t:183" class="idref" href="#t:183"><span class="id" title="binder">t</span></a> <a id="H:184" class="idref" href="#H:184"><span class="id" title="binder">H</span></a> <a id="Q<sub>1</sub>:185" class="idref" href="#Q<sub>1</sub>:185"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:186" class="idref" href="#Q<sub>2</sub>:186"><span class="id" title="binder">Q<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#Q<sub>1</sub>:185"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="WPsem.html#H:184"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="WPsem.html#Q<sub>2</sub>:186"><span class="id" title="variable">Q<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#WpFromHoare.wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:183"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q<sub>1</sub>:185"><span class="id" title="variable">Q<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="WPsem.html#H:184"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#WpFromHoare.wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:183"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q<sub>2</sub>:186"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
</div>

<div class="doc">
The proof leverages the consequence rule for <span class="inlinecode"><span class="id" title="var">hoare</span></span> triples,
    and the frame property comes from the <span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">H'</span></span> quantification
    baked in the definition of <span class="inlinecode"><span class="id" title="var">triple</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="WPsem.html#WpFromHoare.wp"><span class="id" title="definition">wp</span></a>. <span class="id" title="var">xpull</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H'</span> <span class="id" title="var">N</span>. <span class="id" title="var">xsimpl</span> (<span class="id" title="var">H'</span> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <span class="id" title="var">H</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">unfolds</span> <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H''</span>. <span class="id" title="var">specializes</span> <span class="id" title="var">N</span> (<span class="id" title="var">H</span> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <span class="id" title="var">H''</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#hoare_conseq"><span class="id" title="lemma">hoare_conseq</span></a> <span class="id" title="var">N</span>. { <span class="id" title="var">xsimpl</span>. } { <span class="id" title="var">xchange</span> <span class="id" title="var">M</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Third and last, we establish reasoning rules for terms in <span class="inlinecode"><span class="id" title="var">wp</span></span>-style
    directly from the corresponding rules for <span class="inlinecode"><span class="id" title="var">hoare</span></span> triples.

<div class="paragraph"> </div>

    The proof details are beyond the scope of this course.
    The point here is to show that the proofs are fairly concise. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WpFromHoare.wp_val" class="idref" href="#WpFromHoare.wp_val"><span class="id" title="lemma">wp_val</span></a> : <span class="id" title="keyword">∀</span> <a id="v:187" class="idref" href="#v:187"><span class="id" title="binder">v</span></a> <a id="Q:188" class="idref" href="#Q:188"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#Q:188"><span class="id" title="variable">Q</span></a> <a class="idref" href="WPsem.html#v:187"><span class="id" title="variable">v</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#WpFromHoare.wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <a class="idref" href="WPsem.html#v:187"><span class="id" title="variable">v</span></a>) <a class="idref" href="WPsem.html#Q:188"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="WPsem.html#WpFromHoare.wp"><span class="id" title="definition">wp</span></a>. <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H'</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#hoare_val"><span class="id" title="lemma">hoare_val</span></a>. <span class="id" title="var">xsimpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="WpFromHoare.wp_fun" class="idref" href="#WpFromHoare.wp_fun"><span class="id" title="lemma">wp_fun</span></a> : <span class="id" title="keyword">∀</span> <a id="x:189" class="idref" href="#x:189"><span class="id" title="binder">x</span></a> <a id="t:190" class="idref" href="#t:190"><span class="id" title="binder">t</span></a> <a id="Q:191" class="idref" href="#Q:191"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#Q:191"><span class="id" title="variable">Q</span></a> (<a class="idref" href="LibSepReference.html#val_fun"><span class="id" title="constructor">val_fun</span></a> <a class="idref" href="WPsem.html#x:189"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t:190"><span class="id" title="variable">t</span></a>) <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#WpFromHoare.wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_fun"><span class="id" title="constructor">trm_fun</span></a> <a class="idref" href="WPsem.html#x:189"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t:190"><span class="id" title="variable">t</span></a>) <a class="idref" href="WPsem.html#Q:191"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="WPsem.html#WpFromHoare.wp"><span class="id" title="definition">wp</span></a>. <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H'</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#hoare_fun"><span class="id" title="lemma">hoare_fun</span></a>. <span class="id" title="var">xsimpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="WpFromHoare.wp_fix" class="idref" href="#WpFromHoare.wp_fix"><span class="id" title="lemma">wp_fix</span></a> : <span class="id" title="keyword">∀</span> <a id="f:192" class="idref" href="#f:192"><span class="id" title="binder">f</span></a> <a id="x:193" class="idref" href="#x:193"><span class="id" title="binder">x</span></a> <a id="t:194" class="idref" href="#t:194"><span class="id" title="binder">t</span></a> <a id="Q:195" class="idref" href="#Q:195"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#Q:195"><span class="id" title="variable">Q</span></a> (<a class="idref" href="LibSepReference.html#val_fix"><span class="id" title="constructor">val_fix</span></a> <a class="idref" href="WPsem.html#f:192"><span class="id" title="variable">f</span></a> <a class="idref" href="WPsem.html#x:193"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t:194"><span class="id" title="variable">t</span></a>) <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#WpFromHoare.wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_fix"><span class="id" title="constructor">trm_fix</span></a> <a class="idref" href="WPsem.html#f:192"><span class="id" title="variable">f</span></a> <a class="idref" href="WPsem.html#x:193"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t:194"><span class="id" title="variable">t</span></a>) <a class="idref" href="WPsem.html#Q:195"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="WPsem.html#WpFromHoare.wp"><span class="id" title="definition">wp</span></a>. <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H'</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#hoare_fix"><span class="id" title="lemma">hoare_fix</span></a>. <span class="id" title="var">xsimpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="WpFromHoare.wp_if" class="idref" href="#WpFromHoare.wp_if"><span class="id" title="lemma">wp_if</span></a> : <span class="id" title="keyword">∀</span> <a id="b:196" class="idref" href="#b:196"><span class="id" title="binder">b</span></a> <a id="t<sub>1</sub>:197" class="idref" href="#t<sub>1</sub>:197"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:198" class="idref" href="#t<sub>2</sub>:198"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="Q:199" class="idref" href="#Q:199"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#WpFromHoare.wp"><span class="id" title="definition">wp</span></a> (<span class="id" title="keyword">if</span> <a class="idref" href="WPsem.html#b:196"><span class="id" title="variable">b</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="WPsem.html#t<sub>1</sub>:197"><span class="id" title="variable">t<sub>1</sub></span></a> <span class="id" title="keyword">else</span> <a class="idref" href="WPsem.html#t<sub>2</sub>:198"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#Q:199"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#WpFromHoare.wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> <a class="idref" href="WPsem.html#b:196"><span class="id" title="variable">b</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:197"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:198"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#Q:199"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="WPsem.html#WpFromHoare.wp"><span class="id" title="definition">wp</span></a>. <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span> <span class="id" title="var">M</span> <span class="id" title="var">H'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#hoare_if"><span class="id" title="lemma">hoare_if</span></a>. <span class="id" title="var">applys</span> <span class="id" title="var">M</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="WpFromHoare.wp_app_fun" class="idref" href="#WpFromHoare.wp_app_fun"><span class="id" title="lemma">wp_app_fun</span></a> : <span class="id" title="keyword">∀</span> <a id="x:200" class="idref" href="#x:200"><span class="id" title="binder">x</span></a> <a id="v<sub>1</sub>:201" class="idref" href="#v<sub>1</sub>:201"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="v<sub>2</sub>:202" class="idref" href="#v<sub>2</sub>:202"><span class="id" title="binder">v<sub>2</sub></span></a> <a id="t<sub>1</sub>:203" class="idref" href="#t<sub>1</sub>:203"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="Q:204" class="idref" href="#Q:204"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#v<sub>1</sub>:201"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_fun"><span class="id" title="constructor">val_fun</span></a> <a class="idref" href="WPsem.html#x:200"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:203"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#WpFromHoare.wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="WPsem.html#x:200"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#v<sub>2</sub>:202"><span class="id" title="variable">v<sub>2</sub></span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:203"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="WPsem.html#Q:204"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#WpFromHoare.wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="WPsem.html#v<sub>1</sub>:201"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="WPsem.html#v<sub>2</sub>:202"><span class="id" title="variable">v<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#Q:204"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">EQ<sub>1</sub></span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="WPsem.html#WpFromHoare.wp"><span class="id" title="definition">wp</span></a>. <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H'</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H''</span>. <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#hoare_app_fun"><span class="id" title="lemma">hoare_app_fun</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="WpFromHoare.wp_app_fix" class="idref" href="#WpFromHoare.wp_app_fix"><span class="id" title="lemma">wp_app_fix</span></a> : <span class="id" title="keyword">∀</span> <a id="f:205" class="idref" href="#f:205"><span class="id" title="binder">f</span></a> <a id="x:206" class="idref" href="#x:206"><span class="id" title="binder">x</span></a> <a id="v<sub>1</sub>:207" class="idref" href="#v<sub>1</sub>:207"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="v<sub>2</sub>:208" class="idref" href="#v<sub>2</sub>:208"><span class="id" title="binder">v<sub>2</sub></span></a> <a id="t<sub>1</sub>:209" class="idref" href="#t<sub>1</sub>:209"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="Q:210" class="idref" href="#Q:210"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#v<sub>1</sub>:207"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_fix"><span class="id" title="constructor">val_fix</span></a> <a class="idref" href="WPsem.html#f:205"><span class="id" title="variable">f</span></a> <a class="idref" href="WPsem.html#x:206"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:209"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#WpFromHoare.wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="WPsem.html#x:206"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#v<sub>2</sub>:208"><span class="id" title="variable">v<sub>2</sub></span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="WPsem.html#f:205"><span class="id" title="variable">f</span></a> <a class="idref" href="WPsem.html#v<sub>1</sub>:207"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:209"><span class="id" title="variable">t<sub>1</sub></span></a>)) <a class="idref" href="WPsem.html#Q:210"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#WpFromHoare.wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="WPsem.html#v<sub>1</sub>:207"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="WPsem.html#v<sub>2</sub>:208"><span class="id" title="variable">v<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#Q:210"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">EQ<sub>1</sub></span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="WPsem.html#WpFromHoare.wp"><span class="id" title="definition">wp</span></a>. <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H'</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H''</span>. <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#hoare_app_fix"><span class="id" title="lemma">hoare_app_fix</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab249"></a><h4 class="section">Exercise: 4 stars, standard, especially useful (wp_let)</h4>
 Prove wp-style rule for let bindings. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WpFromHoare.wp_let" class="idref" href="#WpFromHoare.wp_let"><span class="id" title="lemma">wp_let</span></a> : <span class="id" title="keyword">∀</span> <a id="x:211" class="idref" href="#x:211"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:212" class="idref" href="#t<sub>1</sub>:212"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:213" class="idref" href="#t<sub>2</sub>:213"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="Q:214" class="idref" href="#Q:214"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#WpFromHoare.wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:212"><span class="id" title="variable">t<sub>1</sub></span></a> (<span class="id" title="keyword">fun</span> <a id="v:215" class="idref" href="#v:215"><span class="id" title="binder">v</span></a> ⇒ <a class="idref" href="WPsem.html#WpFromHoare.wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="WPsem.html#x:211"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#v:215"><span class="id" title="variable">v</span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:213"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#Q:214"><span class="id" title="variable">Q</span></a>) <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#WpFromHoare.wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="WPsem.html#x:211"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:212"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:213"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#Q:214"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 Note: <span class="inlinecode"><span class="id" title="var">wp_seq</span></span> admits essentially the same proof as <span class="inlinecode"><span class="id" title="var">wp_let</span></span>, simply
    replacing <span class="inlinecode"><span class="id" title="var">hoare_let</span></span> with <span class="inlinecode"><span class="id" title="var">hoare_seq</span></span>, and removing the tactic
    <span class="inlinecode"><span class="id" title="tactic">intros</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span>. 
<div class="paragraph"> </div>

 It is technically possible to bypass even the definition of
    <span class="inlinecode"><span class="id" title="var">triple</span></span> and specify all functions directly using the predicate
    <span class="inlinecode"><span class="id" title="var">wp</span></span>. However, using <span class="inlinecode"><span class="id" title="var">triple</span></span> leads to better readability of
    specifications, thus it seems preferable to continue using that
    style for specifying functions. (See discussion in chapter
    <a href="Wand.html"><span class="inlineref">Wand</span></a>, appendix on "Texan triples".) 
</div>
<div class="code">

<span class="id" title="keyword">End</span> <a class="idref" href="WPsem.html#WpFromHoare"><span class="id" title="module">WpFromHoare</span></a>.<br/>
</div>

<div class="doc">
<a id="lab250"></a><h2 class="section">Historical Notes</h2>

<div class="paragraph"> </div>

 The idea of weakest precondition was introduced by <a href="Bib.html#Dijstra-1975"><span class="inlineref">[Dijstra 1975]</span></a>
    in his seminal paper "Guarded Commands, Nondeterminacy and Formal
    Derivation of Programs".

<div class="paragraph"> </div>

    Weakest preconditions provide a reformulation of Floyd-Hoare logic.
    Numerous practical verification tools leverage weakest preconditions,
    e.g. ESC/Java, Why3, Boogie, Spec, etc.

    In the context of Separation Logic in a proof assistant, the Iris framework
     <a href='https://iris-project.org/),'>https://iris-project.org/),</a>developed since 2015, exploits weakest
    preconditions to state reasoning rules. See the <a href="Postscript.html"><span class="inlineref">Postscript</span></a>. 
</div>
<div class="code">

<span class="comment">(*&nbsp;2022-02-15&nbsp;02:24&nbsp;*)</span><br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>