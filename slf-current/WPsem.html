<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>WPsem: Semantics of Weakest Preconditions</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/slf.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 6: Separation Logic Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">WPsem<span class="subtitle">Semantics of Weakest Preconditions</span></h1>


<div class="code">

<span class="id" title="keyword">Set Implicit Arguments</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">SLF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="Rules.html#"><span class="id" title="library">Rules</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">f</span> : <a class="idref" href="LibSepVar.html#var"><span class="id" title="definition">var</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">b</span> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">v</span> <span class="id" title="var">w</span> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">p</span> : <a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">h</span> : <a class="idref" href="LibSepReference.html#heap"><span class="id" title="definition">heap</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">P</span> : <span class="id" title="keyword">Prop</span>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">H</span> : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">Q</span> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>.<br/>
</div>

<div class="doc">
<a id="lab270"></a><h1 class="section">First Pass</h1>

<div class="paragraph"> </div>

 In this chapter, we introduce the notion of "weakest precondition" for
    Separation Logic triples, written <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>.

<div class="paragraph"> </div>

    The intention is for <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> to be a heap predicate (of type <span class="inlinecode"><span class="id" title="var">hprop</span></span>) such
    that <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> iff <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>. 
<div class="paragraph"> </div>

 The benefits of introducing weakest preconditions are twofold.

<div class="paragraph"> </div>

<ul class="doclist">
<li> The use of <span class="inlinecode"><span class="id" title="var">wp</span></span> greatly reduces the number of structural rules required,
        thus reducing the number of tactics required for carrying out proofs in
        practice;

<div class="paragraph"> </div>


</li>
<li> The predicate <span class="inlinecode"><span class="id" title="var">wp</span></span> will serve as guidelines for setting up (in the next
        chapter) a "characteristic formula generator", which is the key
        ingredient at the heart of the CFML tool. 
</li>
</ul>

<div class="paragraph"> </div>

 The high-level picture is:

<div class="paragraph"> </div>

<ul class="doclist">
<li> (1) wp and triples are equivalent presentations of the same thing.

<div class="paragraph"> </div>


</li>
<li> (2) wp has practical benefits, reducing the number of reasoning rules
             and tactics that are needed, by a fair amount.

<div class="paragraph"> </div>


</li>
<li> (3) specifications of functions remain more intuitive to read with
             triples.

</li>
</ul>

<div class="paragraph"> </div>

 The chapter presents:

<div class="paragraph"> </div>

<ul class="doclist">
<li> the notion of weakest precondition, as captured by <span class="inlinecode"><span class="id" title="var">wp</span></span>,

</li>
<li> the reformulation of structural rules in <span class="inlinecode"><span class="id" title="var">wp</span></span>-style, and

</li>
<li> the reformulation of reasoning rules in <span class="inlinecode"><span class="id" title="var">wp</span></span>-style.

</li>
</ul>

<div class="paragraph"> </div>

    Throughout the chapter, we aim to establish reasoning rules in <span class="inlinecode"><span class="id" title="var">wp</span></span>-style
    directly with respect to the semantics defined by <span class="inlinecode"><span class="id" title="tactic">eval</span></span>, as opposed to
    deriving <span class="inlinecode"><span class="id" title="var">wp</span></span>-style rules from the reasoning rules on triples proved in the
    previous chapters. The interest is to present the proofs involved in the
    most direct construction of a program verification framework based on <span class="inlinecode"><span class="id" title="var">wp</span></span>.
    
<div class="paragraph"> </div>

 The "optional material" section presents several equivalent definitions for
    <span class="inlinecode"><span class="id" title="var">wp</span></span>, alternative proofs for deriving <span class="inlinecode"><span class="id" title="var">wp</span></span>-style reasoning rules, as well as
    a presentation of "Texan triples", which reformulate function specifications
    using magic wands instead of triples. 
</div>

<div class="doc">
<a id="lab271"></a><h2 class="section">Definition of Weakest Preconditions</h2>

<div class="paragraph"> </div>

 Consider a term <span class="inlinecode"><span class="id" title="var">t</span></span> and a postcondition <span class="inlinecode"><span class="id" title="var">Q</span></span>.

<div class="paragraph"> </div>

    The expression <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> is called the "weakest precondition" of the term <span class="inlinecode"><span class="id" title="var">t</span></span>
    with respect to the postcondition <span class="inlinecode"><span class="id" title="var">Q</span></span>.

<div class="paragraph"> </div>

    It is a heap predicate such that, for any heap predicate <span class="inlinecode"><span class="id" title="var">H</span></span>, the entailment
    <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> holds if and only if <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> does. 
<div class="paragraph"> </div>

 The concept of <span class="inlinecode"><span class="id" title="var">wp</span></span> might seem a bit mysterious at this point. Hopefully it
    will become clearer in the rest of this chapter. 
<div class="paragraph"> </div>

 The first critical observation is that <span class="inlinecode"><span class="id" title="var">wp</span></span> is in fact nothing but a
    reformulation of the predicate <span class="inlinecode"><span class="id" title="tactic">eval</span></span>. To see why, recall the definition of
    <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">triple</span> (<span class="id" title="var">t</span>:<span class="id" title="var">trm</span>) (<span class="id" title="var">H</span>:<span class="id" title="var">hprop</span>) (<span class="id" title="var">Q</span>:<span class="id" title="var">val</span>→<span class="id" title="var">hprop</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">s</span>, <span class="id" title="var">H</span> <span class="id" title="var">s</span> → <span class="id" title="tactic">eval</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span> <span class="id" title="var">Q</span>.
</span>    By definition, the predicate <span class="inlinecode"><span class="id" title="var">wp</span></span> should be such that <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> is
    equivalent to <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>. But <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> unfolds to
    <span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">s</span>,</span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span>. If we compare <span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">s</span>,</span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="tactic">eval</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>
    with <span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">s</span>,</span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span>, we see that <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> should match
    <span class="inlinecode"><span class="id" title="tactic">eval</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>. In other words, <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> should correspond to
    <span class="inlinecode"><span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="tactic">eval</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="wp" class="idref" href="#wp"><span class="id" title="definition">wp</span></a> (<a id="t:1" class="idref" href="#t:1"><span class="id" title="binder">t</span></a> : <a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>) (<a id="Q:2" class="idref" href="#Q:2"><span class="id" title="binder">Q</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="s:3" class="idref" href="#s:3"><span class="id" title="binder">s</span></a> ⇒ <a class="idref" href="LibSepReference.html#eval"><span class="id" title="inductive">eval</span></a> <a class="idref" href="WPsem.html#s:3"><span class="id" title="variable">s</span></a> <a class="idref" href="WPsem.html#t:1"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:2"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
Remark: the reader may wonder why <span class="inlinecode"><span class="id" title="var">wp</span></span> is not just defined to *be* <span class="inlinecode"><span class="id" title="tactic">eval</span></span>,
    by simply modifying our earlier definition of <span class="inlinecode"><span class="id" title="tactic">eval</span></span> to take its arguments
    in a different order. Certainly, it could be done. However, the benefits of
    identifying <span class="inlinecode"><span class="id" title="var">wp</span></span> and <span class="inlinecode"><span class="id" title="tactic">eval</span></span> are limited, and there are two orthogonal
    motivations for not following that route.

<div class="paragraph"> </div>

    Firstly, the omni-big-step predicate <span class="inlinecode"><span class="id" title="tactic">eval</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> is devised as an immediate
    generalization of the big-step predicate <span class="inlinecode"><span class="id" title="tactic">eval</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">s'</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span>, by generalizing
    from out final configuration <span class="inlinecode">(<span class="id" title="var">s'</span>,<span class="id" title="var">v</span>)</span> to a set <span class="inlinecode"><span class="id" title="var">Q</span></span> of final configurations.
    From the perspective of a semantics, we view the configuration <span class="inlinecode">(<span class="id" title="var">s</span>,<span class="id" title="var">t</span>)</span> as an
    input and the set <span class="inlinecode"><span class="id" title="var">Q</span></span> as an output, thus it would be fairly awckward to
    write <span class="inlinecode"><span class="id" title="tactic">eval</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span>, with the input state <span class="inlinecode"><span class="id" title="var">s</span></span> taken as last argument.

<div class="paragraph"> </div>

    Secondly, we are looking here at a simple Separation Logic where heap
    predicates are predicates over the physical state. They have type
    <span class="inlinecode"><span class="id" title="var">heap</span>→<span class="id" title="keyword">Prop</span></span>, where <span class="inlinecode"><span class="id" title="var">heap</span></span> corresponds exactly to the type of of a state
    <span class="inlinecode"><span class="id" title="var">s</span></span>. More advanced Separation Logic feature something known as "ghost state"
    (used, e.g., to represent invariants associated with locks). In such logics,
    heap predicates are predicates over both the physical and the ghost state.
    In other words, the type <span class="inlinecode"><span class="id" title="var">heap</span></span> in general may consist of more than just a
    state <span class="inlinecode"><span class="id" title="var">s</span></span>. The point of this discussion is that, for more advanced
    Separation Logics, <span class="inlinecode"><span class="id" title="var">wp</span></span> is more than just <span class="inlinecode"><span class="id" title="tactic">eval</span></span>. Thus, there is no reason
    to attempt to identify the two. 
<div class="paragraph"> </div>

 As intended, the entailment <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> holds if and only if
    <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> does.
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_equiv" class="idref" href="#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a> : <span class="id" title="keyword">∀</span> <a id="t:4" class="idref" href="#t:4"><span class="id" title="binder">t</span></a> <a id="H:5" class="idref" href="#H:5"><span class="id" title="binder">H</span></a> <a id="Q:6" class="idref" href="#Q:6"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#H:5"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:4"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:6"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:4"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H:5"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:6"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iff</span> <span class="id" title="var">M</span>. { <span class="id" title="var">introv</span> <span class="id" title="var">Hs</span>. <span class="id" title="var">applys</span> <span class="id" title="var">M</span> <span class="id" title="var">Hs</span>. } { <span class="id" title="var">introv</span> <span class="id" title="var">Hs</span>. <span class="id" title="var">applys</span> <span class="id" title="var">M</span> <span class="id" title="var">Hs</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
There are several other ways of defining <span class="inlinecode"><span class="id" title="var">wp</span></span>. As we show near the end of
    this chapter, they are all equivalent. The definition above is the one that
    leads to the simplest proofs for the reasoning rules. Indeed, reasoning
    rules must be proved correct with respect to the semantics, and the
    semantics is captured by the predicate <span class="inlinecode"><span class="id" title="tactic">eval</span></span>. 
<div class="paragraph"> </div>

 Let us now explain why <span class="inlinecode"><span class="id" title="var">wp</span></span> is called a "weakest precondition". First,
    <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> is always a <i>valid</i> precondition for <span class="inlinecode"><span class="id" title="var">t</span></span> with respect to the
    postcondition <span class="inlinecode"><span class="id" title="var">Q</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_pre" class="idref" href="#wp_pre"><span class="id" title="lemma">wp_pre</span></a> : <span class="id" title="keyword">∀</span> <a id="t:7" class="idref" href="#t:7"><span class="id" title="binder">t</span></a> <a id="Q:8" class="idref" href="#Q:8"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:7"><span class="id" title="variable">t</span></a> (<a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:7"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:8"><span class="id" title="variable">Q</span></a>) <a class="idref" href="WPsem.html#Q:8"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_refl"><span class="id" title="lemma">himpl_refl</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Second, <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> is the "weakest" of all valid preconditions for <span class="inlinecode"><span class="id" title="var">t</span></span> and
    <span class="inlinecode"><span class="id" title="var">Q</span></span>, in the sense that, for any other valid precondition <span class="inlinecode"><span class="id" title="var">H</span></span> (i.e., such
    that <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> holds), it is the case that <span class="inlinecode"><span class="id" title="var">H</span></span> entails <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_weakest" class="idref" href="#wp_weakest"><span class="id" title="lemma">wp_weakest</span></a> : <span class="id" title="keyword">∀</span> <a id="t:9" class="idref" href="#t:9"><span class="id" title="binder">t</span></a> <a id="H:10" class="idref" href="#H:10"><span class="id" title="binder">H</span></a> <a id="Q:11" class="idref" href="#Q:11"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:9"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H:10"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:11"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#H:10"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:9"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:11"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="var">applys</span> <span class="id" title="var">M</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab272"></a><h2 class="section">Structural Rules in Weakest-Precondition Style</h2>

<div class="paragraph"> </div>

 We next present reformulations of the frame rule and the rule of consequence
    in <i>weakest-precondition style</i>.

<div class="paragraph"> </div>

    Given a term <span class="inlinecode"><span class="id" title="var">t</span></span> and a postcondition <span class="inlinecode"><span class="id" title="var">Q</span></span>, we say that "<span class="inlinecode"><span class="id" title="var">t</span></span> produces <span class="inlinecode"><span class="id" title="var">Q</span></span>" if
    <span class="inlinecode"><span class="id" title="var">t</span></span> terminates and produces a output value and an output state that,
    together, satisfy the postcondition <span class="inlinecode"><span class="id" title="var">Q</span></span>. 
</div>

<div class="doc">
<a id="lab273"></a><h3 class="section">The Frame Rule</h3>

<div class="paragraph"> </div>

 The frame rule for <span class="inlinecode"><span class="id" title="var">wp</span></span> asserts that <span class="inlinecode">(<span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>)</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H</span></span> entails
    <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">(<span class="id" title="var">Q</span></span> <span class="inlinecode"><span class='gray-font'>\</span>*+</span> <span class="inlinecode"><span class="id" title="var">H</span>)</span>. This statement can be read as follows: if you own both a
    piece of state satisfying <span class="inlinecode"><span class="id" title="var">H</span></span> and a piece of state in which the execution of
    <span class="inlinecode"><span class="id" title="var">t</span></span> produces <span class="inlinecode"><span class="id" title="var">Q</span></span>, then you own a piece of state in which the execution of
    <span class="inlinecode"><span class="id" title="var">t</span></span> produces <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode"><span class='gray-font'>\</span>*+</span> <span class="inlinecode"><span class="id" title="var">H</span></span>, that is, produces both <span class="inlinecode"><span class="id" title="var">Q</span></span> and <span class="inlinecode"><span class="id" title="var">H</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_frame" class="idref" href="#wp_frame"><span class="id" title="lemma">wp_frame</span></a> : <span class="id" title="keyword">∀</span> <a id="t:12" class="idref" href="#t:12"><span class="id" title="binder">t</span></a> <a id="H:13" class="idref" href="#H:13"><span class="id" title="binder">H</span></a> <a id="Q:14" class="idref" href="#Q:14"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:12"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:14"><span class="id" title="variable">Q</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="WPsem.html#H:13"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:12"><span class="id" title="variable">t</span></a> (<a class="idref" href="WPsem.html#Q:14"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="WPsem.html#H:13"><span class="id" title="variable">H</span></a>).<br/>
</div>

<div class="doc">
The lemma is proved by exploiting the frame property on <span class="inlinecode"><span class="id" title="tactic">eval</span></span>. (It could
    also be derived using <span class="inlinecode"><span class="id" title="var">wp_equiv</span></span> and <span class="inlinecode"><span class="id" title="var">triple_frame</span></span>, but the point here is
    to derive properties of <span class="inlinecode"><span class="id" title="var">wp</span></span> without mentioning <span class="inlinecode"><span class="id" title="var">triple</span></span>.) 
</div>
<div class="code">

<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">HF</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">lets</span> (<span class="id" title="var">h<sub>1</sub></span>&amp;<span class="id" title="var">h<sub>2</sub></span>&amp;<span class="id" title="var">M<sub>1</sub></span>&amp;<span class="id" title="var">M<sub>2</sub></span>&amp;<span class="id" title="var">MD</span>&amp;<span class="id" title="var">MU</span>): <a class="idref" href="LibSepReference.html#SepSimplArgs.hstar_inv"><span class="id" title="lemma">hstar_inv</span></a> <span class="id" title="var">HF</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#eval_conseq"><span class="id" title="lemma">eval_conseq</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#eval_frame"><span class="id" title="lemma">eval_frame</span></a> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">MD</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h'</span> →. <span class="id" title="var">applys</span> <span class="id" title="var">M<sub>2</sub></span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Looking at the entaileent expressed by <span class="inlinecode"><span class="id" title="var">wp_frame</span></span>, the reader may wander
    whether the reverse entailment holds, that is, if <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">(<span class="id" title="var">Q</span></span> <span class="inlinecode"><span class='gray-font'>\</span>*+</span> <span class="inlinecode"><span class="id" title="var">H</span>)</span> entails
    <span class="inlinecode">(<span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>)</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H</span></span>. This reverse entailment does not hold in general. Consider
    the following counterexample term <span class="inlinecode"><span class="id" title="var">t</span></span>, defined as <span class="inlinecode"><span class="id" title="keyword">let</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">ref</span></span> <span class="inlinecode">1</span> <span class="inlinecode"><span class="id" title="keyword">in</span></span> <span class="inlinecode">0</span>. This
    term returns <span class="inlinecode">0</span> and produces a dangling reference cell that can be
    described as <span class="inlinecode"><span class='gray-font'>\</span><span class="id" title="tactic">∃</span></span> <span class="inlinecode"><span class="id" title="var">p</span>,</span> <span class="inlinecode">(<span class="id" title="var">p</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode">1)</span>. Let <span class="inlinecode"><span class="id" title="var">Q</span></span> be <span class="inlinecode"><span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">r</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">r</span></span> <span class="inlinecode">=</span> <span class="inlinecode">0]</span> and <span class="inlinecode"><span class="id" title="var">H</span></span>
    be <span class="inlinecode"><span class='gray-font'>\</span><span class="id" title="tactic">∃</span></span> <span class="inlinecode"><span class="id" title="var">p</span>,</span> <span class="inlinecode">(<span class="id" title="var">p</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode">1)</span>. The term <span class="inlinecode"><span class="id" title="var">t</span></span>, executed in the empty heap,
    terminates with postcondition <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode"><span class='gray-font'>\</span>*+</span> <span class="inlinecode"><span class="id" title="var">H</span></span>. Therefore, the predicate
    <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">(<span class="id" title="var">Q</span></span> <span class="inlinecode"><span class='gray-font'>\</span>*+</span> <span class="inlinecode"><span class="id" title="var">H</span>)</span> holds of the empty heap. However, <span class="inlinecode">(<span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>)</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H</span></span> does not
    hold of the empty heap, because <span class="inlinecode"><span class="id" title="var">H</span></span>, which describes one memory cell, cannot
    be carved out of the empty heap. We conclude that <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">(<span class="id" title="var">Q</span></span> <span class="inlinecode"><span class='gray-font'>\</span>*+</span> <span class="inlinecode"><span class="id" title="var">H</span>)</span> does not
    entail <span class="inlinecode">(<span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>)</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H</span></span> in general. 
<div class="paragraph"> </div>

 The connection between <span class="inlinecode"><span class="id" title="var">wp_frame</span></span> and the rule <span class="inlinecode"><span class="id" title="var">triple_frame</span></span> is not be
    totally obvious. Recall the statement of the frame rule for triples.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">triple</span> <span class="id" title="var">t</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">triple</span> <span class="id" title="var">t</span> (<span class="id" title="var">H<sub>1</sub></span> <span class='gray-font'>\</span>* <span class="id" title="var">H</span>) (<span class="id" title="var">Q</span> <span class='gray-font'>\</span>*+ <span class="id" title="var">H</span>)
</span>    Let us replace the pattern <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> with the pattern <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>,
    following the characteristic equivalence <span class="inlinecode"><span class="id" title="var">wp_equiv</span></span>. We obtain the statement
    shown below. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_frame_trans" class="idref" href="#wp_frame_trans"><span class="id" title="lemma">wp_frame_trans</span></a> : <span class="id" title="keyword">∀</span> <a id="t:15" class="idref" href="#t:15"><span class="id" title="binder">t</span></a> <a id="H<sub>1</sub>:16" class="idref" href="#H<sub>1</sub>:16"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="Q:17" class="idref" href="#Q:17"><span class="id" title="binder">Q</span></a> <a id="H:18" class="idref" href="#H:18"><span class="id" title="binder">H</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#H<sub>1</sub>:16"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:15"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:17"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#H<sub>1</sub>:16"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="WPsem.html#H:18"><span class="id" title="variable">H</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:15"><span class="id" title="variable">t</span></a> (<a class="idref" href="WPsem.html#Q:17"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="WPsem.html#H:18"><span class="id" title="variable">H</span></a>).<br/>
</div>

<div class="doc">
If we exploit transitivity of entailment to eliminate <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span>, then we obtain
    exactly <span class="inlinecode"><span class="id" title="var">wp_frame</span></span>, as illustrated by the proof script below. 
</div>
<div class="code">

<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">xchange</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span>* <a class="idref" href="WPsem.html#wp_frame"><span class="id" title="lemma">wp_frame</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab274"></a><h3 class="section">The Rule of Consequence</h3>

<div class="paragraph"> </div>

 The rule of consequence for <span class="inlinecode"><span class="id" title="var">wp</span></span> is a covariance property: it asserts that
    <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> is covariant in <span class="inlinecode"><span class="id" title="var">Q</span></span>. In other words, if <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> entails <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span></span>, then
    <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> entails <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_conseq" class="idref" href="#wp_conseq"><span class="id" title="lemma">wp_conseq</span></a> : <span class="id" title="keyword">∀</span> <a id="t:19" class="idref" href="#t:19"><span class="id" title="binder">t</span></a> <a id="Q<sub>1</sub>:20" class="idref" href="#Q<sub>1</sub>:20"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:21" class="idref" href="#Q<sub>2</sub>:21"><span class="id" title="binder">Q<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#Q<sub>1</sub>:20"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="WPsem.html#Q<sub>2</sub>:21"><span class="id" title="variable">Q<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:19"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q<sub>1</sub>:20"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:19"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q<sub>2</sub>:21"><span class="id" title="variable">Q<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">s</span> <span class="id" title="var">Hs</span>. <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#eval_conseq"><span class="id" title="lemma">eval_conseq</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Here again, the connection with the corresponding reasoning rule for triples
    is not totally obvious. Recall the statement of the rule of consequence.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">triple</span> <span class="id" title="var">t</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">Q<sub>1</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H<sub>2</sub></span> ==&gt; <span class="id" title="var">H<sub>1</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Q<sub>1</sub></span> ===&gt; <span class="id" title="var">Q<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">triple</span> <span class="id" title="var">t</span> <span class="id" title="var">H<sub>2</sub></span> <span class="id" title="var">Q<sub>2</sub></span>
</span>    Let us replace <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> with <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> to obtain the following
    statement: 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_conseq_trans" class="idref" href="#wp_conseq_trans"><span class="id" title="lemma">wp_conseq_trans</span></a> : <span class="id" title="keyword">∀</span> <a id="t:22" class="idref" href="#t:22"><span class="id" title="binder">t</span></a> <a id="H<sub>1</sub>:23" class="idref" href="#H<sub>1</sub>:23"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:24" class="idref" href="#H<sub>2</sub>:24"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="Q<sub>1</sub>:25" class="idref" href="#Q<sub>1</sub>:25"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:26" class="idref" href="#Q<sub>2</sub>:26"><span class="id" title="binder">Q<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#H<sub>1</sub>:23"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:22"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q<sub>1</sub>:25"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#H<sub>2</sub>:24"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#H<sub>1</sub>:23"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#Q<sub>1</sub>:25"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="WPsem.html#Q<sub>2</sub>:26"><span class="id" title="variable">Q<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#H<sub>2</sub>:24"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:22"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q<sub>2</sub>:26"><span class="id" title="variable">Q<sub>2</sub></span></a>.<br/>
</div>

<div class="doc">
If we exploit transitivity of entailment to eliminate <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>, then we
    obtain exactly <span class="inlinecode"><span class="id" title="var">wp_conseq</span></span>, as illustrated by the proof script below. 
</div>
<div class="code">

<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M</span> <span class="id" title="var">WH</span> <span class="id" title="var">WQ</span>. <span class="id" title="var">xchange</span> <span class="id" title="var">WH</span>. <span class="id" title="var">xchange</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <a class="idref" href="WPsem.html#wp_conseq"><span class="id" title="lemma">wp_conseq</span></a> <span class="id" title="var">WQ</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab275"></a><h3 class="section">The Extraction Rules</h3>

<div class="paragraph"> </div>

 The extraction rules <span class="inlinecode"><span class="id" title="var">triple_hpure</span></span> and <span class="inlinecode"><span class="id" title="var">triple_hexists</span></span> have no specific
    counterpart with the <span class="inlinecode"><span class="id" title="var">wp</span></span> presentation. Indeed, in a weakest-precondition
    style presentation, the extraction rules for triples correspond exactly to
    the extraction rules for entailment.

<div class="paragraph"> </div>

    To see why, consider the rule <span class="inlinecode"><span class="id" title="var">triple_hpure</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_hpure" class="idref" href="#triple_hpure"><span class="id" title="axiom">triple_hpure</span></a> : <span class="id" title="keyword">∀</span> <a id="t:27" class="idref" href="#t:27"><span class="id" title="binder">t</span></a> (<a id="P:28" class="idref" href="#P:28"><span class="id" title="binder">P</span></a>:<span class="id" title="keyword">Prop</span>) <a id="H:29" class="idref" href="#H:29"><span class="id" title="binder">H</span></a> <a id="Q:30" class="idref" href="#Q:30"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#P:28"><span class="id" title="variable">P</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:27"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H:29"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:30"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:27"><span class="id" title="variable">t</span></a> (<a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="WPsem.html#P:28"><span class="id" title="variable">P</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="WPsem.html#H:29"><span class="id" title="variable">H</span></a>) <a class="idref" href="WPsem.html#Q:30"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
Replacing <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> with <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> yields the following: 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="triple_hpure_with_wp" class="idref" href="#triple_hpure_with_wp"><span class="id" title="lemma">triple_hpure_with_wp</span></a> : <span class="id" title="keyword">∀</span> <a id="t:32" class="idref" href="#t:32"><span class="id" title="binder">t</span></a> <a id="H:33" class="idref" href="#H:33"><span class="id" title="binder">H</span></a> <a id="Q:34" class="idref" href="#Q:34"><span class="id" title="binder">Q</span></a> (<a id="P:35" class="idref" href="#P:35"><span class="id" title="binder">P</span></a>:<span class="id" title="keyword">Prop</span>),<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#P:35"><span class="id" title="variable">P</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#H:33"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:32"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:34"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">))</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="WPsem.html#P:35"><span class="id" title="variable">P</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="WPsem.html#H:33"><span class="id" title="variable">H</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:32"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:34"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
This implication is just a special case of the extraction lemma for pure
    facts on the left on an entailment, <span class="inlinecode"><span class="id" title="var">himpl_hstar_hpure_l</span></span>:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">P</span> → (<span class="id" title="var">H</span> ==&gt; <span class="id" title="var">H'</span>)) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class='gray-font'>\</span>[<span class="id" title="var">P</span>] <span class='gray-font'>\</span>* <span class="id" title="var">H</span>) ==&gt; <span class="id" title="var">H'</span>.
</span>
</div>
<div class="code">

<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_hstar_hpure_l"><span class="id" title="lemma">himpl_hstar_hpure_l</span></a> <span class="id" title="var">M</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Similar reasoning applies to the extraction rule for existentials. 
</div>

<div class="doc">
<a id="lab276"></a><h3 class="section">The Ramified Frame Rule</h3>

<div class="paragraph"> </div>

 Recall the ramified frame rule: 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_ramified_frame" class="idref" href="#triple_ramified_frame"><span class="id" title="axiom">triple_ramified_frame</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>1</sub>:36" class="idref" href="#H<sub>1</sub>:36"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="Q<sub>1</sub>:37" class="idref" href="#Q<sub>1</sub>:37"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="t:38" class="idref" href="#t:38"><span class="id" title="binder">t</span></a> <a id="H:39" class="idref" href="#H:39"><span class="id" title="binder">H</span></a> <a id="Q:40" class="idref" href="#Q:40"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:38"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H<sub>1</sub>:36"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="WPsem.html#Q<sub>1</sub>:37"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#H:39"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#H<sub>1</sub>:36"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#Q<sub>1</sub>:37"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#5609a52f091556b9923d5758aa61f543"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="WPsem.html#Q:40"><span class="id" title="variable">Q</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:38"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H:39"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:40"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
The ramified frame rule in weakest-precondition style, named <span class="inlinecode"><span class="id" title="var">wp_ramified</span></span>,
    admits a concise statement and subsumes all the other structural rules of
    Separation Logic. Its very elegant statement is as follows. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_ramified" class="idref" href="#wp_ramified"><span class="id" title="lemma">wp_ramified</span></a> : <span class="id" title="keyword">∀</span> <a id="t:42" class="idref" href="#t:42"><span class="id" title="binder">t</span></a> <a id="Q<sub>1</sub>:43" class="idref" href="#Q<sub>1</sub>:43"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:44" class="idref" href="#Q<sub>2</sub>:44"><span class="id" title="binder">Q<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:42"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q<sub>1</sub>:43"><span class="id" title="variable">Q<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#Q<sub>1</sub>:43"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#5609a52f091556b9923d5758aa61f543"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="WPsem.html#Q<sub>2</sub>:44"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:42"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q<sub>2</sub>:44"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#wp_conseq_frame"><span class="id" title="lemma">wp_conseq_frame</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.qwand_cancel"><span class="id" title="lemma">qwand_cancel</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The following reformulation of <span class="inlinecode"><span class="id" title="var">wp_ramified</span></span> can be more practical to
    exploit in practice, because it applies to any goal of the form
    <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_ramified_trans" class="idref" href="#wp_ramified_trans"><span class="id" title="lemma">wp_ramified_trans</span></a> : <span class="id" title="keyword">∀</span> <a id="t:45" class="idref" href="#t:45"><span class="id" title="binder">t</span></a> <a id="H:46" class="idref" href="#H:46"><span class="id" title="binder">H</span></a> <a id="Q<sub>1</sub>:47" class="idref" href="#Q<sub>1</sub>:47"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:48" class="idref" href="#Q<sub>2</sub>:48"><span class="id" title="binder">Q<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#H:46"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:45"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q<sub>1</sub>:47"><span class="id" title="variable">Q<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#Q<sub>1</sub>:47"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#5609a52f091556b9923d5758aa61f543"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="WPsem.html#Q<sub>2</sub>:48"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#H:46"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:45"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q<sub>2</sub>:48"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="var">introv</span> <span class="id" title="var">M</span>. <span class="id" title="var">xchange</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <a class="idref" href="WPsem.html#wp_ramified"><span class="id" title="lemma">wp_ramified</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab277"></a><h4 class="section">Exercise: 3 stars, standard, especially useful (wp_conseq_of_wp_ramified)</h4>
 Prove that <span class="inlinecode"><span class="id" title="var">wp_conseq</span></span> is derivable from <span class="inlinecode"><span class="id" title="var">wp_ramified</span></span>. Concretely, prove
    <span class="inlinecode"><span class="id" title="var">wp_conseq</span></span> using only <span class="inlinecode"><span class="id" title="var">wp_ramified</span></span> or <span class="inlinecode"><span class="id" title="var">wp_ramified_trans</span></span>, plus properties
    of the entailment relation. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_conseq_of_wp_ramified" class="idref" href="#wp_conseq_of_wp_ramified"><span class="id" title="lemma">wp_conseq_of_wp_ramified</span></a> : <span class="id" title="keyword">∀</span> <a id="t:49" class="idref" href="#t:49"><span class="id" title="binder">t</span></a> <a id="Q<sub>1</sub>:50" class="idref" href="#Q<sub>1</sub>:50"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:51" class="idref" href="#Q<sub>2</sub>:51"><span class="id" title="binder">Q<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#Q<sub>1</sub>:50"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="WPsem.html#Q<sub>2</sub>:51"><span class="id" title="variable">Q<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:49"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q<sub>1</sub>:50"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:49"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q<sub>2</sub>:51"><span class="id" title="variable">Q<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a id="lab278"></a><h4 class="section">Exercise: 2 stars, standard, especially useful (wp_frame_of_wp_ramified)</h4>
 Prove that <span class="inlinecode"><span class="id" title="var">wp_frame</span></span> is derivable from <span class="inlinecode"><span class="id" title="var">wp_ramified</span></span>. Concretely, prove
    <span class="inlinecode"><span class="id" title="var">wp_frame</span></span> using only <span class="inlinecode"><span class="id" title="var">wp_ramified</span></span> plus properties of entailment. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_frame_of_wp_ramified" class="idref" href="#wp_frame_of_wp_ramified"><span class="id" title="lemma">wp_frame_of_wp_ramified</span></a> : <span class="id" title="keyword">∀</span> <a id="t:52" class="idref" href="#t:52"><span class="id" title="binder">t</span></a> <a id="H:53" class="idref" href="#H:53"><span class="id" title="binder">H</span></a> <a id="Q:54" class="idref" href="#Q:54"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:52"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:54"><span class="id" title="variable">Q</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="WPsem.html#H:53"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:52"><span class="id" title="variable">t</span></a> (<a class="idref" href="WPsem.html#Q:54"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="WPsem.html#H:53"><span class="id" title="variable">H</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab279"></a><h2 class="section">Reasoning Rules for Terms in Weakest-Precondition Style</h2>

</div>

<div class="doc">
<a id="lab280"></a><h3 class="section">Values</h3>

<div class="paragraph"> </div>

 Recall the rule <span class="inlinecode"><span class="id" title="var">triple_val</span></span> which establishes a triple for a value <span class="inlinecode"><span class="id" title="var">v</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_val" class="idref" href="#triple_val"><span class="id" title="axiom">triple_val</span></a> : <span class="id" title="keyword">∀</span> <a id="v:55" class="idref" href="#v:55"><span class="id" title="binder">v</span></a> <a id="H:56" class="idref" href="#H:56"><span class="id" title="binder">H</span></a> <a id="Q:57" class="idref" href="#Q:57"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#H:56"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#Q:57"><span class="id" title="variable">Q</span></a> <a class="idref" href="WPsem.html#v:55"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <a class="idref" href="WPsem.html#v:55"><span class="id" title="variable">v</span></a>) <a class="idref" href="WPsem.html#H:56"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:57"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
If we rewrite this rule in <span class="inlinecode"><span class="id" title="var">wp</span></span> style, we obtain this:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H</span> ==&gt; <span class="id" title="var">Q</span> <span class="id" title="var">v</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H</span> ==&gt; <span class="id" title="var">wp</span> (<span class="id" title="var">trm_val</span> <span class="id" title="var">v</span>) <span class="id" title="var">Q</span>.
</span>    By exploiting transitivity of entailment, we can eliminate <span class="inlinecode"><span class="id" title="var">H</span></span>. We obtain
    the following rule: If you own a state satisfying <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span>, then you own a
    state from which the evaluation of the value <span class="inlinecode"><span class="id" title="var">v</span></span> produces <span class="inlinecode"><span class="id" title="var">Q</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_val" class="idref" href="#wp_val"><span class="id" title="lemma">wp_val</span></a> : <span class="id" title="keyword">∀</span> <a id="v:59" class="idref" href="#v:59"><span class="id" title="binder">v</span></a> <a id="Q:60" class="idref" href="#Q:60"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#Q:60"><span class="id" title="variable">Q</span></a> <a class="idref" href="WPsem.html#v:59"><span class="id" title="variable">v</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_val"><span class="id" title="constructor">trm_val</span></a> <a class="idref" href="WPsem.html#v:59"><span class="id" title="variable">v</span></a>) <a class="idref" href="WPsem.html#Q:60"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#eval_val"><span class="id" title="constructor">eval_val</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab281"></a><h3 class="section">Sequences</h3>

<div class="paragraph"> </div>

 Recall the reasoning rule for a sequence <span class="inlinecode"><span class="id" title="var">trm_seq</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_seq" class="idref" href="#triple_seq"><span class="id" title="axiom">triple_seq</span></a> : <span class="id" title="keyword">∀</span> <a id="t<sub>1</sub>:61" class="idref" href="#t<sub>1</sub>:61"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:62" class="idref" href="#t<sub>2</sub>:62"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="H:63" class="idref" href="#H:63"><span class="id" title="binder">H</span></a> <a id="Q:64" class="idref" href="#Q:64"><span class="id" title="binder">Q</span></a> <a id="H<sub>1</sub>:65" class="idref" href="#H<sub>1</sub>:65"><span class="id" title="binder">H<sub>1</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:61"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsem.html#H:63"><span class="id" title="variable">H</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="WPsem.html#H<sub>1</sub>:65"><span class="id" title="variable">H<sub>1</sub></span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:62"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="WPsem.html#H<sub>1</sub>:65"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="WPsem.html#Q:64"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:61"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:62"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#H:63"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:64"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
Replacing <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> with <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> gives this:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H</span> ==&gt; (<span class="id" title="var">wp</span> <span class="id" title="var">t<sub>1</sub></span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">H<sub>1</sub></span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H<sub>1</sub></span> ==&gt; (<span class="id" title="var">wp</span> <span class="id" title="var">t<sub>2</sub></span>) <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H</span> ==&gt; <span class="id" title="var">wp</span> (<span class="id" title="var">trm_seq</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>) <span class="id" title="var">Q</span>.
</span>    This entailment holds for any <span class="inlinecode"><span class="id" title="var">H</span></span> and <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span>. Let us specialize it to
    <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode">:=</span> <span class="inlinecode">(<span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span>)</span> <span class="inlinecode"><span class="id" title="var">Q</span></span> and <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">:=</span> <span class="inlinecode">(<span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span>)</span> <span class="inlinecode">(<span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode">(<span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span>)</span> <span class="inlinecode"><span class="id" title="var">Q</span>)</span>.

<div class="paragraph"> </div>

    This leads us to the following rule: If you own a state from which the
    evaluation of <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> produces a state from which the evaluation of <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>
    produces the postcondition <span class="inlinecode"><span class="id" title="var">Q</span></span>, then you own a state from which the
    evaluation of the sequence <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span>;<span class="id" title="var">t<sub>2</sub></span></span> produces <span class="inlinecode"><span class="id" title="var">Q</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_seq" class="idref" href="#wp_seq"><span class="id" title="lemma">wp_seq</span></a> : <span class="id" title="keyword">∀</span> <a id="t<sub>1</sub>:67" class="idref" href="#t<sub>1</sub>:67"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:68" class="idref" href="#t<sub>2</sub>:68"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="Q:69" class="idref" href="#Q:69"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:67"><span class="id" title="variable">t<sub>1</sub></span></a> (<span class="id" title="keyword">fun</span> <a id="v:70" class="idref" href="#v:70"><span class="id" title="binder">v</span></a> ⇒ <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:68"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="WPsem.html#Q:69"><span class="id" title="variable">Q</span></a>) <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_seq"><span class="id" title="constructor">trm_seq</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:67"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:68"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#Q:69"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#eval_seq"><span class="id" title="constructor">eval_seq</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab282"></a><h3 class="section">Let-Bindings</h3>

<div class="paragraph"> </div>

 Recall the reasoning rule for a term <span class="inlinecode"><span class="id" title="var">trm_let</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_let" class="idref" href="#triple_let"><span class="id" title="axiom">triple_let</span></a> : <span class="id" title="keyword">∀</span> <a id="x:71" class="idref" href="#x:71"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:72" class="idref" href="#t<sub>1</sub>:72"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:73" class="idref" href="#t<sub>2</sub>:73"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="Q<sub>1</sub>:74" class="idref" href="#Q<sub>1</sub>:74"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="H:75" class="idref" href="#H:75"><span class="id" title="binder">H</span></a> <a id="Q:76" class="idref" href="#Q:76"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:72"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsem.html#H:75"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q<sub>1</sub>:74"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="v<sub>1</sub>:77" class="idref" href="#v<sub>1</sub>:77"><span class="id" title="binder">v<sub>1</sub></span></a>, <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="WPsem.html#x:71"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#v<sub>1</sub>:77"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:73"><span class="id" title="variable">t<sub>2</sub></span></a>) (<a class="idref" href="WPsem.html#Q<sub>1</sub>:74"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="WPsem.html#v<sub>1</sub>:77"><span class="id" title="variable">v<sub>1</sub></span></a>) <a class="idref" href="WPsem.html#Q:76"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="WPsem.html#x:71"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:72"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:73"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#H:75"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:76"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
The rule of <span class="inlinecode"><span class="id" title="var">trm_let</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> is very similar to that for <span class="inlinecode"><span class="id" title="var">trm_seq</span></span>, the
    only difference being the substitution of <span class="inlinecode"><span class="id" title="var">x</span></span> by <span class="inlinecode"><span class="id" title="var">v</span></span> in <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>, where <span class="inlinecode"><span class="id" title="var">v</span></span>
    denotes the result of <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_let" class="idref" href="#wp_let"><span class="id" title="lemma">wp_let</span></a> : <span class="id" title="keyword">∀</span> <a id="x:79" class="idref" href="#x:79"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:80" class="idref" href="#t<sub>1</sub>:80"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:81" class="idref" href="#t<sub>2</sub>:81"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="Q:82" class="idref" href="#Q:82"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:80"><span class="id" title="variable">t<sub>1</sub></span></a> (<span class="id" title="keyword">fun</span> <a id="v<sub>1</sub>:83" class="idref" href="#v<sub>1</sub>:83"><span class="id" title="binder">v<sub>1</sub></span></a> ⇒ <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="WPsem.html#x:79"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#v<sub>1</sub>:83"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:81"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#Q:82"><span class="id" title="variable">Q</span></a>) <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_let"><span class="id" title="constructor">trm_let</span></a> <a class="idref" href="WPsem.html#x:79"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:80"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:81"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#Q:82"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#eval_let"><span class="id" title="constructor">eval_let</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab283"></a><h3 class="section">Functions</h3>

<div class="paragraph"> </div>

 Recall the reasoning rule for a term <span class="inlinecode"><span class="id" title="var">trm_fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>, which evaluates to the
    value <span class="inlinecode"><span class="id" title="var">val_fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_fun" class="idref" href="#triple_fun"><span class="id" title="axiom">triple_fun</span></a> : <span class="id" title="keyword">∀</span> <a id="x:84" class="idref" href="#x:84"><span class="id" title="binder">x</span></a> <a id="t<sub>1</sub>:85" class="idref" href="#t<sub>1</sub>:85"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="H:86" class="idref" href="#H:86"><span class="id" title="binder">H</span></a> <a id="Q:87" class="idref" href="#Q:87"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#H:86"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#Q:87"><span class="id" title="variable">Q</span></a> (<a class="idref" href="LibSepReference.html#val_fun"><span class="id" title="constructor">val_fun</span></a> <a class="idref" href="WPsem.html#x:84"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:85"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_fun"><span class="id" title="constructor">trm_fun</span></a> <a class="idref" href="WPsem.html#x:84"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:85"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="WPsem.html#H:86"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:87"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
The rule for functions follows exactly the same pattern as for values. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_fun" class="idref" href="#wp_fun"><span class="id" title="lemma">wp_fun</span></a> : <span class="id" title="keyword">∀</span> <a id="x:89" class="idref" href="#x:89"><span class="id" title="binder">x</span></a> <a id="t:90" class="idref" href="#t:90"><span class="id" title="binder">t</span></a> <a id="Q:91" class="idref" href="#Q:91"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#Q:91"><span class="id" title="variable">Q</span></a> (<a class="idref" href="LibSepReference.html#val_fun"><span class="id" title="constructor">val_fun</span></a> <a class="idref" href="WPsem.html#x:89"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t:90"><span class="id" title="variable">t</span></a>) <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_fun"><span class="id" title="constructor">trm_fun</span></a> <a class="idref" href="WPsem.html#x:89"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t:90"><span class="id" title="variable">t</span></a>) <a class="idref" href="WPsem.html#Q:91"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#eval_fun"><span class="id" title="constructor">eval_fun</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
A similar rule holds for the evaluation of a recursive function. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_fix" class="idref" href="#wp_fix"><span class="id" title="lemma">wp_fix</span></a> : <span class="id" title="keyword">∀</span> <a id="f:92" class="idref" href="#f:92"><span class="id" title="binder">f</span></a> <a id="x:93" class="idref" href="#x:93"><span class="id" title="binder">x</span></a> <a id="t:94" class="idref" href="#t:94"><span class="id" title="binder">t</span></a> <a id="Q:95" class="idref" href="#Q:95"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#Q:95"><span class="id" title="variable">Q</span></a> (<a class="idref" href="LibSepReference.html#val_fix"><span class="id" title="constructor">val_fix</span></a> <a class="idref" href="WPsem.html#f:92"><span class="id" title="variable">f</span></a> <a class="idref" href="WPsem.html#x:93"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t:94"><span class="id" title="variable">t</span></a>) <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_fix"><span class="id" title="constructor">trm_fix</span></a> <a class="idref" href="WPsem.html#f:92"><span class="id" title="variable">f</span></a> <a class="idref" href="WPsem.html#x:93"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t:94"><span class="id" title="variable">t</span></a>) <a class="idref" href="WPsem.html#Q:95"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#eval_fix"><span class="id" title="constructor">eval_fix</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab284"></a><h3 class="section">Conditionals</h3>

<div class="paragraph"> </div>

 Recall the reasoning rule for a term <span class="inlinecode"><span class="id" title="var">triple_if</span></span> <span class="inlinecode"><span class="id" title="var">b</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_if" class="idref" href="#triple_if"><span class="id" title="axiom">triple_if</span></a> : <span class="id" title="keyword">∀</span> <a id="b:96" class="idref" href="#b:96"><span class="id" title="binder">b</span></a> <a id="t<sub>1</sub>:97" class="idref" href="#t<sub>1</sub>:97"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:98" class="idref" href="#t<sub>2</sub>:98"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="H:99" class="idref" href="#H:99"><span class="id" title="binder">H</span></a> <a id="Q:100" class="idref" href="#Q:100"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<span class="id" title="keyword">if</span> <a class="idref" href="WPsem.html#b:96"><span class="id" title="variable">b</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="WPsem.html#t<sub>1</sub>:97"><span class="id" title="variable">t<sub>1</sub></span></a> <span class="id" title="keyword">else</span> <a class="idref" href="WPsem.html#t<sub>2</sub>:98"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#H:99"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:100"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> (<a class="idref" href="LibSepReference.html#val_bool"><span class="id" title="constructor">val_bool</span></a> <a class="idref" href="WPsem.html#b:96"><span class="id" title="variable">b</span></a>) <a class="idref" href="WPsem.html#t<sub>1</sub>:97"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:98"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#H:99"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:100"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
Replacing <span class="inlinecode"><span class="id" title="var">triple</span></span> using <span class="inlinecode"><span class="id" title="var">wp</span></span> entailments yields
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H</span> ==&gt; <span class="id" title="var">wp</span> (<span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">t<sub>2</sub></span>) <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H</span> ==&gt; <span class="id" title="var">wp</span> (<span class="id" title="var">trm_if</span> (<span class="id" title="var">val_bool</span> <span class="id" title="var">b</span>) <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>) <span class="id" title="var">Q</span>
</span>    A necessary and sufficient condition to prove a proposition of the form
    <span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">H</span>,</span> <span class="inlinecode">(<span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span>)</span> <span class="inlinecode">→</span> <span class="inlinecode">(<span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span>)</span> is <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>. Indeed, if we
    instantiate <span class="inlinecode"><span class="id" title="var">H</span></span> with <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span>, we have <span class="inlinecode">(<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span>)</span> <span class="inlinecode">→</span> <span class="inlinecode">(<span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span>)</span>, thus we
    deduce <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>. Reciprocally, if we have <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> and <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span>,
    then by the transitivity property <span class="inlinecode"><span class="id" title="var">himpl_trans</span></span>, we deduce <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span>.

<div class="paragraph"> </div>

    Therefore, the previous entailment simplifies to:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">wp</span> (<span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">t<sub>2</sub></span>) <span class="id" title="var">Q</span> ==&gt; <span class="id" title="var">wp</span> (<span class="id" title="var">trm_if</span> (<span class="id" title="var">val_bool</span> <span class="id" title="var">b</span>) <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>) <span class="id" title="var">Q</span>.
</span>    This is the wp-style reasoning rule for conditionals. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_if" class="idref" href="#wp_if"><span class="id" title="lemma">wp_if</span></a> : <span class="id" title="keyword">∀</span> <a id="b:102" class="idref" href="#b:102"><span class="id" title="binder">b</span></a> <a id="t<sub>1</sub>:103" class="idref" href="#t<sub>1</sub>:103"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:104" class="idref" href="#t<sub>2</sub>:104"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="Q:105" class="idref" href="#Q:105"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> (<span class="id" title="keyword">if</span> <a class="idref" href="WPsem.html#b:102"><span class="id" title="variable">b</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="WPsem.html#t<sub>1</sub>:103"><span class="id" title="variable">t<sub>1</sub></span></a> <span class="id" title="keyword">else</span> <a class="idref" href="WPsem.html#t<sub>2</sub>:104"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#Q:105"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> (<a class="idref" href="LibSepReference.html#val_bool"><span class="id" title="constructor">val_bool</span></a> <a class="idref" href="WPsem.html#b:102"><span class="id" title="variable">b</span></a>) <a class="idref" href="WPsem.html#t<sub>1</sub>:103"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:104"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#Q:105"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#eval_if"><span class="id" title="constructor">eval_if</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Equivalently, the rule may be stated with the conditional around the calls
    to <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> and <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>. 
<div class="paragraph"> </div>

<a id="lab285"></a><h4 class="section">Exercise: 1 star, standard, optional (wp_if')</h4>
 Prove the alternative statement of rule <span class="inlinecode"><span class="id" title="var">wp_if</span></span>, either from <span class="inlinecode"><span class="id" title="var">wp_if</span></span> or
    directly from <span class="inlinecode"><span class="id" title="var">eval_if</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_if'" class="idref" href="#wp_if'"><span class="id" title="lemma">wp_if'</span></a> : <span class="id" title="keyword">∀</span> <a id="b:106" class="idref" href="#b:106"><span class="id" title="binder">b</span></a> <a id="t<sub>1</sub>:107" class="idref" href="#t<sub>1</sub>:107"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="t<sub>2</sub>:108" class="idref" href="#t<sub>2</sub>:108"><span class="id" title="binder">t<sub>2</sub></span></a> <a id="Q:109" class="idref" href="#Q:109"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><span class="id" title="keyword">if</span> <a class="idref" href="WPsem.html#b:106"><span class="id" title="variable">b</span></a> <span class="id" title="keyword">then</span> (<a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:107"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsem.html#Q:109"><span class="id" title="variable">Q</span></a>) <span class="id" title="keyword">else</span> (<a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:108"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="WPsem.html#Q:109"><span class="id" title="variable">Q</span></a>)<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_if"><span class="id" title="constructor">trm_if</span></a> <a class="idref" href="WPsem.html#b:106"><span class="id" title="variable">b</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:107"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="WPsem.html#t<sub>2</sub>:108"><span class="id" title="variable">t<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#Q:109"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab286"></a><h3 class="section">Rule For Function Applications</h3>

<div class="paragraph"> </div>

 Recall the reasoning rule for an application <span class="inlinecode">(<span class="id" title="var">val_fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span>)</span> <span class="inlinecode"><span class="id" title="var">v<sub>2</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_app_fun" class="idref" href="#triple_app_fun"><span class="id" title="axiom">triple_app_fun</span></a> : <span class="id" title="keyword">∀</span> <a id="x:110" class="idref" href="#x:110"><span class="id" title="binder">x</span></a> <a id="v<sub>1</sub>:111" class="idref" href="#v<sub>1</sub>:111"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="v<sub>2</sub>:112" class="idref" href="#v<sub>2</sub>:112"><span class="id" title="binder">v<sub>2</sub></span></a> <a id="t<sub>1</sub>:113" class="idref" href="#t<sub>1</sub>:113"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="H:114" class="idref" href="#H:114"><span class="id" title="binder">H</span></a> <a id="Q:115" class="idref" href="#Q:115"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#v<sub>1</sub>:111"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_fun"><span class="id" title="constructor">val_fun</span></a> <a class="idref" href="WPsem.html#x:110"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:113"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="WPsem.html#x:110"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#v<sub>2</sub>:112"><span class="id" title="variable">v<sub>2</sub></span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:113"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="WPsem.html#H:114"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:115"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="WPsem.html#v<sub>1</sub>:111"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="WPsem.html#v<sub>2</sub>:112"><span class="id" title="variable">v<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#H:114"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:115"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
The corresponding <span class="inlinecode"><span class="id" title="var">wp</span></span> rule is: 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_app_fun" class="idref" href="#wp_app_fun"><span class="id" title="lemma">wp_app_fun</span></a> : <span class="id" title="keyword">∀</span> <a id="x:117" class="idref" href="#x:117"><span class="id" title="binder">x</span></a> <a id="v<sub>1</sub>:118" class="idref" href="#v<sub>1</sub>:118"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="v<sub>2</sub>:119" class="idref" href="#v<sub>2</sub>:119"><span class="id" title="binder">v<sub>2</sub></span></a> <a id="t<sub>1</sub>:120" class="idref" href="#t<sub>1</sub>:120"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="Q:121" class="idref" href="#Q:121"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#v<sub>1</sub>:118"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_fun"><span class="id" title="constructor">val_fun</span></a> <a class="idref" href="WPsem.html#x:117"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:120"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="WPsem.html#x:117"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#v<sub>2</sub>:119"><span class="id" title="variable">v<sub>2</sub></span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:120"><span class="id" title="variable">t<sub>1</sub></span></a>) <a class="idref" href="WPsem.html#Q:121"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="WPsem.html#v<sub>1</sub>:118"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="WPsem.html#v<sub>2</sub>:119"><span class="id" title="variable">v<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#Q:121"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#eval_app_fun"><span class="id" title="constructor">eval_app_fun</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
A similar rule holds for the application of a recursive function. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_app_fix" class="idref" href="#wp_app_fix"><span class="id" title="lemma">wp_app_fix</span></a> : <span class="id" title="keyword">∀</span> <a id="f:122" class="idref" href="#f:122"><span class="id" title="binder">f</span></a> <a id="x:123" class="idref" href="#x:123"><span class="id" title="binder">x</span></a> <a id="v<sub>1</sub>:124" class="idref" href="#v<sub>1</sub>:124"><span class="id" title="binder">v<sub>1</sub></span></a> <a id="v<sub>2</sub>:125" class="idref" href="#v<sub>2</sub>:125"><span class="id" title="binder">v<sub>2</sub></span></a> <a id="t<sub>1</sub>:126" class="idref" href="#t<sub>1</sub>:126"><span class="id" title="binder">t<sub>1</sub></span></a> <a id="Q:127" class="idref" href="#Q:127"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#v<sub>1</sub>:124"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_fix"><span class="id" title="constructor">val_fix</span></a> <a class="idref" href="WPsem.html#f:122"><span class="id" title="variable">f</span></a> <a class="idref" href="WPsem.html#x:123"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:126"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="WPsem.html#x:123"><span class="id" title="variable">x</span></a> <a class="idref" href="WPsem.html#v<sub>2</sub>:125"><span class="id" title="variable">v<sub>2</sub></span></a> (<a class="idref" href="LibSepReference.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="WPsem.html#f:122"><span class="id" title="variable">f</span></a> <a class="idref" href="WPsem.html#v<sub>1</sub>:124"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="WPsem.html#t<sub>1</sub>:126"><span class="id" title="variable">t<sub>1</sub></span></a>)) <a class="idref" href="WPsem.html#Q:127"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#trm_app"><span class="id" title="constructor">trm_app</span></a> <a class="idref" href="WPsem.html#v<sub>1</sub>:124"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="WPsem.html#v<sub>2</sub>:125"><span class="id" title="variable">v<sub>2</sub></span></a>) <a class="idref" href="WPsem.html#Q:127"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">K</span>. <span class="id" title="var">applys</span>* <a class="idref" href="LibSepReference.html#eval_app_fix"><span class="id" title="constructor">eval_app_fix</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab287"></a><h1 class="section">More Details</h1>

</div>

<div class="doc">
<a id="lab288"></a><h2 class="section">Combined Structural Rule</h2>

<div class="paragraph"> </div>

 Recall the combined consequence-frame rule for <span class="inlinecode"><span class="id" title="var">triple</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="triple_conseq_frame" class="idref" href="#triple_conseq_frame"><span class="id" title="axiom">triple_conseq_frame</span></a> : <span class="id" title="keyword">∀</span> <a id="H<sub>2</sub>:128" class="idref" href="#H<sub>2</sub>:128"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="H<sub>1</sub>:129" class="idref" href="#H<sub>1</sub>:129"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="Q<sub>1</sub>:130" class="idref" href="#Q<sub>1</sub>:130"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="t:131" class="idref" href="#t:131"><span class="id" title="binder">t</span></a> <a id="H:132" class="idref" href="#H:132"><span class="id" title="binder">H</span></a> <a id="Q:133" class="idref" href="#Q:133"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:131"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H<sub>1</sub>:129"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="WPsem.html#Q<sub>1</sub>:130"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#H:132"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#H<sub>1</sub>:129"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="WPsem.html#H<sub>2</sub>:128"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#Q<sub>1</sub>:130"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="WPsem.html#H<sub>2</sub>:128"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="WPsem.html#Q:133"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:131"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H:132"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:133"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
Let us reformulate this rule using <span class="inlinecode"><span class="id" title="var">wp</span></span>, replacing <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> with
    <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>. 
<div class="paragraph"> </div>

<a id="lab289"></a><h4 class="section">Exercise: 2 stars, standard, especially useful (wp_conseq_frame_trans)</h4>
 Prove the combined structural rule in <span class="inlinecode"><span class="id" title="var">wp</span></span> style. Hint: exploit
    <span class="inlinecode"><span class="id" title="var">wp_conseq_trans</span></span> and <span class="inlinecode"><span class="id" title="var">wp_frame</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_conseq_frame_trans" class="idref" href="#wp_conseq_frame_trans"><span class="id" title="lemma">wp_conseq_frame_trans</span></a> : <span class="id" title="keyword">∀</span> <a id="t:135" class="idref" href="#t:135"><span class="id" title="binder">t</span></a> <a id="H:136" class="idref" href="#H:136"><span class="id" title="binder">H</span></a> <a id="H<sub>1</sub>:137" class="idref" href="#H<sub>1</sub>:137"><span class="id" title="binder">H<sub>1</sub></span></a> <a id="H<sub>2</sub>:138" class="idref" href="#H<sub>2</sub>:138"><span class="id" title="binder">H<sub>2</sub></span></a> <a id="Q<sub>1</sub>:139" class="idref" href="#Q<sub>1</sub>:139"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q:140" class="idref" href="#Q:140"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#H<sub>1</sub>:137"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:135"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q<sub>1</sub>:139"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#H:136"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#H<sub>1</sub>:137"><span class="id" title="variable">H<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="WPsem.html#H<sub>2</sub>:138"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#Q<sub>1</sub>:139"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="WPsem.html#H<sub>2</sub>:138"><span class="id" title="variable">H<sub>2</sub></span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="WPsem.html#Q:140"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#H:136"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:135"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:140"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 The combined structural rule for <span class="inlinecode"><span class="id" title="var">wp</span></span> can actually be stated in a more
    concise way. The rule reads as follows: If you own a state from which the
    execution of <span class="inlinecode"><span class="id" title="var">t</span></span> produces (a result and a state satisfying) <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> and you
    also own <span class="inlinecode"><span class="id" title="var">H</span></span>; and if, furthermore, you can trade the combination of <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> and
    <span class="inlinecode"><span class="id" title="var">H</span></span> against <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span></span>; then you own a piece of state from which the execution of
    <span class="inlinecode"><span class="id" title="var">t</span></span> produces <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span></span>. 
<div class="paragraph"> </div>

<a id="lab290"></a><h4 class="section">Exercise: 2 stars, standard, especially useful (wp_conseq_frame)</h4>
 Prove the concise version of the combined structural rule in <span class="inlinecode"><span class="id" title="var">wp</span></span> style.
    (Many proofs are possible.) 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_conseq_frame" class="idref" href="#wp_conseq_frame"><span class="id" title="lemma">wp_conseq_frame</span></a> : <span class="id" title="keyword">∀</span> <a id="t:141" class="idref" href="#t:141"><span class="id" title="binder">t</span></a> <a id="H:142" class="idref" href="#H:142"><span class="id" title="binder">H</span></a> <a id="Q<sub>1</sub>:143" class="idref" href="#Q<sub>1</sub>:143"><span class="id" title="binder">Q<sub>1</sub></span></a> <a id="Q<sub>2</sub>:144" class="idref" href="#Q<sub>2</sub>:144"><span class="id" title="binder">Q<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#Q<sub>1</sub>:143"><span class="id" title="variable">Q<sub>1</sub></span></a> <a class="idref" href="LibSepReference.html#635f8491703dab9d0d18a6c2474b0d2a"><span class="id" title="notation"><span class='gray-font'>\</span>*+</span></a> <a class="idref" href="WPsem.html#H:142"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#9351a4f098e275023c32e0091e608189"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="WPsem.html#Q<sub>2</sub>:144"><span class="id" title="variable">Q<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:141"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q<sub>1</sub>:143"><span class="id" title="variable">Q<sub>1</sub></span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="WPsem.html#H:142"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:141"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q<sub>2</sub>:144"><span class="id" title="variable">Q<sub>2</sub></span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 Let us reformulate the rule <span class="inlinecode"><span class="id" title="var">wp_conseq_frame</span></span> using a magic wand. The
    premise <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span>*+</span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">===&gt;</span> <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span></span> can be rewritten as <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode">(<span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span>)</span>. By
    replacing <span class="inlinecode"><span class="id" title="var">H</span></span> with <span class="inlinecode"><span class="id" title="var">Q<sub>1</sub></span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">Q<sub>2</sub></span></span> in the conclusion of <span class="inlinecode"><span class="id" title="var">wp_conseq_frame</span></span>, we
    obtain the ramified rule for <span class="inlinecode"><span class="id" title="var">wp</span></span>.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">wp_ramified</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t</span> <span class="id" title="var">Q<sub>1</sub></span> <span class="id" title="var">Q<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">wp</span> <span class="id" title="var">t</span> <span class="id" title="var">Q<sub>1</sub></span>) <span class='gray-font'>\</span>* (<span class="id" title="var">Q<sub>1</sub></span> <span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span> <span class="id" title="var">Q<sub>2</sub></span>) ==&gt; (<span class="id" title="var">wp</span> <span class="id" title="var">t</span> <span class="id" title="var">Q<sub>2</sub></span>).
</span>    This explaination suggests how one might have come up with the statement of
    the ramified frame rule. 
</div>

<div class="doc">
<a id="lab291"></a><h1 class="section">Optional Material</h1>

</div>

<div class="doc">
<a id="lab292"></a><h2 class="section">Weakest Preconditions Derived from Triples, a First Route</h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="WpFromTriple" class="idref" href="#WpFromTriple"><span class="id" title="module">WpFromTriple</span></a>.<br/>
</div>

<div class="doc">
The lemma <span class="inlinecode"><span class="id" title="var">wp_equiv</span></span> captures the characteristic property of <span class="inlinecode"><span class="id" title="var">wp</span></span>, that is,
    <span class="inlinecode">(<span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>)</span> <span class="inlinecode">↔</span> <span class="inlinecode">(<span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>)</span>. The predicate <span class="inlinecode"><span class="id" title="var">wp</span></span> can be defined in
    terms of <span class="inlinecode"><span class="id" title="tactic">eval</span></span>, like <span class="inlinecode"><span class="id" title="var">triple</span></span>. Interestingly, <span class="inlinecode"><span class="id" title="var">wp</span></span> may also be defined in
    terms of <span class="inlinecode"><span class="id" title="var">triple</span></span>. The idea is to define <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> as the predicate
    <span class="inlinecode"><span class='gray-font'>\</span><span class="id" title="tactic">∃</span></span> <span class="inlinecode"><span class="id" title="var">H</span>,</span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>]</span>, which, reading literally, is satisfied by
    "any" heap predicate <span class="inlinecode"><span class="id" title="var">H</span></span> which is a valid precondition for a triple for the
    term <span class="inlinecode"><span class="id" title="var">t</span></span> and the postcondition <span class="inlinecode"><span class="id" title="var">Q</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="WpFromTriple.wp_1" class="idref" href="#WpFromTriple.wp_1"><span class="id" title="definition">wp_1</span></a> (<a id="t:145" class="idref" href="#t:145"><span class="id" title="binder">t</span></a>:<a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>) (<a id="Q:146" class="idref" href="#Q:146"><span class="id" title="binder">Q</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">(</span></a><a id="H:147" class="idref" href="#H:147"><span class="id" title="binder">H</span></a>:<a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">),</span></a> <a class="idref" href="WPsem.html#H:147"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:145"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H:147"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:146"><span class="id" title="variable">Q</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>.<br/>
</div>

<div class="doc">
<a id="lab293"></a><h4 class="section">Exercise: 3 stars, standard, especially useful (wp_equiv_1)</h4>
 Prove that the alternative definition <span class="inlinecode"><span class="id" title="var">wp_1</span></span> satisfies the characteristic
    equivalence for weakest preconditions. Hint: use the consequence rule and
    the extraction rules. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WpFromTriple.wp_equiv_1" class="idref" href="#WpFromTriple.wp_equiv_1"><span class="id" title="lemma">wp_equiv_1</span></a> : <span class="id" title="keyword">∀</span> <a id="t:148" class="idref" href="#t:148"><span class="id" title="binder">t</span></a> <a id="H:149" class="idref" href="#H:149"><span class="id" title="binder">H</span></a> <a id="Q:150" class="idref" href="#Q:150"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#H:149"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#WpFromTriple.wp_1"><span class="id" title="definition">wp_1</span></a> <a class="idref" href="WPsem.html#t:148"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:150"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:148"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H:149"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:150"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<span class="id" title="keyword">End</span> <a class="idref" href="WPsem.html#WpFromTriple"><span class="id" title="module">WpFromTriple</span></a>.<br/>
</div>

<div class="doc">
<a id="lab294"></a><h2 class="section">Weakest Preconditions Derived From Triples, a Second Route</h2>

</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="WpFromTriple2" class="idref" href="#WpFromTriple2"><span class="id" title="module">WpFromTriple2</span></a>.<br/>
</div>

<div class="doc">
The concrete definition for <span class="inlinecode"><span class="id" title="var">wp</span></span> given above is expressed in terms of
    Separation Logic combinators. In contrast to this "high level" definition,
    there exists a more "low level" definition, expressed directly as a function
    over heaps. In this alternative definition, the heap predicate <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> is
    defined as a predicate that holds of a heap <span class="inlinecode"><span class="id" title="var">h</span></span> if and only if the execution
    of <span class="inlinecode"><span class="id" title="var">t</span></span> starting in exactly the heap <span class="inlinecode"><span class="id" title="var">h</span></span> produces the post-condition <span class="inlinecode"><span class="id" title="var">Q</span></span>. The
    latter statement is formally captured as <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">(<span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">h'</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">h'</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">h</span>)</span> <span class="inlinecode"><span class="id" title="var">Q</span></span>.
    The low-level definition of <span class="inlinecode"><span class="id" title="var">wp</span></span> is thus as shown below. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="WpFromTriple2.wp_2" class="idref" href="#WpFromTriple2.wp_2"><span class="id" title="definition">wp_2</span></a> (<a id="t:151" class="idref" href="#t:151"><span class="id" title="binder">t</span></a>:<a class="idref" href="LibSepReference.html#trm"><span class="id" title="inductive">trm</span></a>) (<a id="Q:152" class="idref" href="#Q:152"><span class="id" title="binder">Q</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) : <a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<a id="h:153" class="idref" href="#h:153"><span class="id" title="binder">h</span></a>:<a class="idref" href="LibSepReference.html#heap"><span class="id" title="definition">heap</span></a>) ⇒ <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:151"><span class="id" title="variable">t</span></a> (<span class="id" title="keyword">fun</span> <a id="h':154" class="idref" href="#h':154"><span class="id" title="binder">h'</span></a> ⇒ (<a class="idref" href="WPsem.html#h':154"><span class="id" title="variable">h'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WPsem.html#h:153"><span class="id" title="variable">h</span></a>)) <a class="idref" href="WPsem.html#Q:152"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
<a id="lab295"></a><h4 class="section">Exercise: 4 stars, standard, optional (wp_equiv_2)</h4>
 Prove that the low-level definition <span class="inlinecode"><span class="id" title="var">wp_2</span></span> also satisfies the characteristic
    equivalence <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode">↔</span> <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>. Hint: exploit the lemma
    <span class="inlinecode"><span class="id" title="var">triple_named_heap</span></span> which was established as an exercise in the chapter
    <a href="Triples.html"><span class="inlineref">Triples</span></a>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="WpFromTriple2.wp_equiv_2" class="idref" href="#WpFromTriple2.wp_equiv_2"><span class="id" title="lemma">wp_equiv_2</span></a> : <span class="id" title="keyword">∀</span> <a id="t:155" class="idref" href="#t:155"><span class="id" title="binder">t</span></a> <a id="H:156" class="idref" href="#H:156"><span class="id" title="binder">H</span></a> <a id="Q:157" class="idref" href="#Q:157"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#H:156"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#WpFromTriple2.wp_2"><span class="id" title="definition">wp_2</span></a> <a class="idref" href="WPsem.html#t:155"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:157"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:155"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H:156"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:157"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<span class="id" title="keyword">End</span> <a class="idref" href="WPsem.html#WpFromTriple2"><span class="id" title="module">WpFromTriple2</span></a>.<br/>
</div>

<div class="doc">
<a id="lab296"></a><h2 class="section">Equivalent Characterizations of <span class="inlinecode"><span class="id" title="var">wp</span></span></h2>

<div class="paragraph"> </div>

 First, we establish that the equivalence <span class="inlinecode">(<span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>)</span> <span class="inlinecode">↔</span> <span class="inlinecode">(<span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>)</span>
    defines a unique predicate <span class="inlinecode"><span class="id" title="var">wp</span></span>. In other words, all possible definitions of
    <span class="inlinecode"><span class="id" title="var">wp</span></span> are equivalent to each another. Thus, it really does not matter which
    concrete definition of <span class="inlinecode"><span class="id" title="var">wp</span></span> we consider: they are all equivalent.
    Concretely, assume two predicates <span class="inlinecode"><span class="id" title="var">wp<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">wp<sub>2</sub></span></span> to both satisfy the
    characteristic equivalence. We prove that they are equal. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_unique" class="idref" href="#wp_unique"><span class="id" title="lemma">wp_unique</span></a> : <span class="id" title="keyword">∀</span> <a id="wp<sub>1</sub>:158" class="idref" href="#wp<sub>1</sub>:158"><span class="id" title="binder">wp<sub>1</sub></span></a> <a id="wp<sub>2</sub>:159" class="idref" href="#wp<sub>2</sub>:159"><span class="id" title="binder">wp<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="t:160" class="idref" href="#t:160"><span class="id" title="binder">t</span></a> <a id="H:161" class="idref" href="#H:161"><span class="id" title="binder">H</span></a> <a id="Q:162" class="idref" href="#Q:162"><span class="id" title="binder">Q</span></a>, <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:160"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H:161"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:162"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#H:161"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp<sub>1</sub>:158"><span class="id" title="variable">wp<sub>1</sub></span></a> <a class="idref" href="WPsem.html#t:160"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:162"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="t:163" class="idref" href="#t:163"><span class="id" title="binder">t</span></a> <a id="H:164" class="idref" href="#H:164"><span class="id" title="binder">H</span></a> <a id="Q:165" class="idref" href="#Q:165"><span class="id" title="binder">Q</span></a>, <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:163"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H:164"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:165"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#H:164"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp<sub>2</sub>:159"><span class="id" title="variable">wp<sub>2</sub></span></a> <a class="idref" href="WPsem.html#t:163"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:165"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WPsem.html#wp<sub>1</sub>:158"><span class="id" title="variable">wp<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WPsem.html#wp<sub>2</sub>:159"><span class="id" title="variable">wp<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">introv</span> <span class="id" title="var">M<sub>1</sub></span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="var">applys</span> <span class="id" title="lemma">fun_ext_2</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">t</span> <span class="id" title="var">Q</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_antisym"><span class="id" title="lemma">himpl_antisym</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">M<sub>1</sub></span>. <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">M<sub>1</sub></span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">M<sub>2</sub></span>. <span class="id" title="tactic">auto</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Second, we establish that the property of "being the weakest precondition"
    also uniquely characterizes the definition of <span class="inlinecode"><span class="id" title="var">wp</span></span>. This property is the
    conjunction of two facts: <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> must be a valid precondition for a triple
    involving <span class="inlinecode"><span class="id" title="var">t</span></span> and <span class="inlinecode"><span class="id" title="var">Q</span></span>; and <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> must be entailed by any valid
    precondition of a triple involving <span class="inlinecode"><span class="id" title="var">t</span></span> and <span class="inlinecode"><span class="id" title="var">Q</span></span>. These two facts correspond
    to <span class="inlinecode"><span class="id" title="var">wp_pre</span></span> and <span class="inlinecode"><span class="id" title="var">wp_weakest</span></span>. 
<div class="paragraph"> </div>

<a id="lab297"></a><h4 class="section">Exercise: 2 stars, standard, especially useful (wp_equiv_iff_wp_pre_and_wp_weakest)</h4>
 Prove that the conjunction of the properties <span class="inlinecode"><span class="id" title="var">wp_pre</span></span> and <span class="inlinecode"><span class="id" title="var">wk_weakest</span></span> is
    equivalent to the property <span class="inlinecode"><span class="id" title="var">wp_equiv</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="wp_equiv_iff_wp_pre_and_wp_weakest" class="idref" href="#wp_equiv_iff_wp_pre_and_wp_weakest"><span class="id" title="lemma">wp_equiv_iff_wp_pre_and_wp_weakest</span></a> : <span class="id" title="keyword">∀</span> <a id="wp':166" class="idref" href="#wp':166"><span class="id" title="binder">wp'</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a>   <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="t:167" class="idref" href="#t:167"><span class="id" title="binder">t</span></a> <a id="Q:168" class="idref" href="#Q:168"><span class="id" title="binder">Q</span></a>, <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:167"><span class="id" title="variable">t</span></a> (<a class="idref" href="WPsem.html#wp':166"><span class="id" title="variable">wp'</span></a> <a class="idref" href="WPsem.html#t:167"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:168"><span class="id" title="variable">Q</span></a>) <a class="idref" href="WPsem.html#Q:168"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a> <span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">wp_pre</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="t:169" class="idref" href="#t:169"><span class="id" title="binder">t</span></a> <a id="H:170" class="idref" href="#H:170"><span class="id" title="binder">H</span></a> <a id="Q:171" class="idref" href="#Q:171"><span class="id" title="binder">Q</span></a>, <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:169"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H:170"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:171"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="WPsem.html#H:170"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp':166"><span class="id" title="variable">wp'</span></a> <a class="idref" href="WPsem.html#t:169"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:171"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a> <span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">wp_weakest</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="t:172" class="idref" href="#t:172"><span class="id" title="binder">t</span></a> <a id="H:173" class="idref" href="#H:173"><span class="id" title="binder">H</span></a> <a id="Q:174" class="idref" href="#Q:174"><span class="id" title="binder">Q</span></a>, <a class="idref" href="WPsem.html#H:173"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp':166"><span class="id" title="variable">wp'</span></a> <a class="idref" href="WPsem.html#t:172"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:174"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:172"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H:173"><span class="id" title="variable">H</span></a> <a class="idref" href="WPsem.html#Q:174"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a>. <span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">wp_equiv</span></span>&nbsp;*)</span><br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab298"></a><h2 class="section">Texan Triples</h2>

<div class="paragraph"> </div>

 In this section, we show that specification triples can be presented in a
    different style using weakest preconditions. This style has appeared under
    the name "Texan triples" in certain work related to the Iris framework. The
    main motivation is to slighly simplify the implementation of the tactic
    <span class="inlinecode"><span class="id" title="var">xapp</span></span>. The main drawback is that it makes specifications, one could argue,
    slightly less easy to read. For this reason, users of the Iris framework
    usually stick to the standard triple notation in their publications. Despite
    the readability issue, it may be interesting for the reader to be aware of
    the possibility of stating specifications directly using <span class="inlinecode"><span class="id" title="var">wp</span></span>, as there
    might be useful applications of this technique in certain contexts. 
</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="TexanTriples" class="idref" href="#TexanTriples"><span class="id" title="module">TexanTriples</span></a>.<br/>
</div>

<div class="doc">
<a id="lab299"></a><h3 class="section">1. An Example</h3>

<div class="paragraph"> </div>

 Consider the specification triple for allocation. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="TexanTriples.triple_ref" class="idref" href="#TexanTriples.triple_ref"><span class="id" title="axiom">triple_ref</span></a> : <span class="id" title="keyword">∀</span> <a id="v:175" class="idref" href="#v:175"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_ref"><span class="id" title="constructor">val_ref</span></a> <a class="idref" href="WPsem.html#v:175"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:178" class="idref" href="#p:178"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="WPsem.html#p:176"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="WPsem.html#v:175"><span class="id" title="variable">v</span></a>).<br/>
</div>

<div class="doc">
This specification may be equivalently reformulated in the form of an
    entailment, as shown below. Note that we purposely leave an empty heap
    predicate at the front to indicate where the precondition, if it were not
    empty, would go in the reformulation. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="TexanTriples.wp_ref" class="idref" href="#TexanTriples.wp_ref"><span class="id" title="axiom">wp_ref</span></a> : <span class="id" title="keyword">∀</span> <a id="Q:180" class="idref" href="#Q:180"><span class="id" title="binder">Q</span></a> <a id="v:181" class="idref" href="#v:181"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">∀</span></a> <a id="p:182" class="idref" href="#p:182"><span class="id" title="binder">p</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="WPsem.html#p:182"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="WPsem.html#v:181"><span class="id" title="variable">v</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="WPsem.html#Q:180"><span class="id" title="variable">Q</span></a> (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="WPsem.html#p:182"><span class="id" title="variable">p</span></a>)<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#val_ref"><span class="id" title="constructor">val_ref</span></a> <a class="idref" href="WPsem.html#v:181"><span class="id" title="variable">v</span></a>) <a class="idref" href="WPsem.html#Q:180"><span class="id" title="variable">Q</span></a>.<br/>
</div>

<div class="doc">
In what follows, we describe a chain of transformations that can take us
    from the triple form to the <span class="inlinecode"><span class="id" title="var">wp</span></span> form, and we establish the reciprocal.
    Afterwards, we will formalize the general pattern of the translation from a
    triple to a "texan triple", that is, to a wp-based specification. 
<div class="paragraph"> </div>

 By replacing <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> with <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>, the specification
    <span class="inlinecode"><span class="id" title="var">triple_ref</span></span> can be reformulated as follows. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="TexanTriples.wp_ref_0" class="idref" href="#TexanTriples.wp_ref_0"><span class="id" title="lemma">wp_ref_0</span></a> : <span class="id" title="keyword">∀</span> <a id="v:184" class="idref" href="#v:184"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#0a700e54c124035039013e87e1a2bcaa"><span class="id" title="notation"><span class='gray-font'>\</span>[]</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#val_ref"><span class="id" title="constructor">val_ref</span></a> <a class="idref" href="WPsem.html#v:184"><span class="id" title="variable">v</span></a>) (<a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:187" class="idref" href="#p:187"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="WPsem.html#p:185"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="WPsem.html#v:184"><span class="id" title="variable">v</span></a>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="WPsem.html#TexanTriples.triple_ref"><span class="id" title="axiom">triple_ref</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
We wish to cast the RHS in the form <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode">(<span class="id" title="var">val_ref</span></span> <span class="inlinecode"><span class="id" title="var">v</span>)</span> <span class="inlinecode"><span class="id" title="var">Q</span></span> for an abstract
    postcondition <span class="inlinecode"><span class="id" title="var">Q</span></span>. To that end, we reformulate the above statement by
    including a magic wand relating the postcondition <span class="inlinecode">(<span class="id" title="var">funloc</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">~~&gt;</span> <span class="inlinecode"><span class="id" title="var">v</span>)</span>
    with <span class="inlinecode"><span class="id" title="var">Q</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="TexanTriples.wp_ref_1" class="idref" href="#TexanTriples.wp_ref_1"><span class="id" title="lemma">wp_ref_1</span></a> : <span class="id" title="keyword">∀</span> <a id="Q:188" class="idref" href="#Q:188"><span class="id" title="binder">Q</span></a> <a id="v:189" class="idref" href="#v:189"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#5609a52f091556b9923d5758aa61f543"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">funloc</span></a> <a id="p:192" class="idref" href="#p:192"><span class="id" title="binder">p</span></a> <a class="idref" href="LibSepReference.html#d1e35cef49ddf53b46b670034b3362a<sub>0</sub>"><span class="id" title="notation">⇒</span></a> <a class="idref" href="WPsem.html#p:190"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="WPsem.html#v:189"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#5609a52f091556b9923d5758aa61f543"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#5609a52f091556b9923d5758aa61f543"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&minus;&lowast;</span></span></a> <a class="idref" href="WPsem.html#Q:188"><span class="id" title="variable">Q</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#val_ref"><span class="id" title="constructor">val_ref</span></a> <a class="idref" href="WPsem.html#v:189"><span class="id" title="variable">v</span></a>) <a class="idref" href="WPsem.html#Q:188"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">xchange</span> (<a class="idref" href="WPsem.html#TexanTriples.wp_ref_0"><span class="id" title="lemma">wp_ref_0</span></a> <span class="id" title="var">v</span>). <span class="id" title="var">applys</span> <a class="idref" href="WPsem.html#wp_ramified"><span class="id" title="lemma">wp_ramified</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
This statement can be made slightly more readable by unfolding the
    definition of the magic wand for postconditions. Doing so amounts to
    quantifying explicitly on the result, named <span class="inlinecode"><span class="id" title="var">r</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="TexanTriples.wp_ref_2" class="idref" href="#TexanTriples.wp_ref_2"><span class="id" title="lemma">wp_ref_2</span></a> : <span class="id" title="keyword">∀</span> <a id="Q:193" class="idref" href="#Q:193"><span class="id" title="binder">Q</span></a> <a id="v:194" class="idref" href="#v:194"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">∀</span></a> <a id="r:195" class="idref" href="#r:195"><span class="id" title="binder">r</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">,</span></a>     <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="p:196" class="idref" href="#p:196"><span class="id" title="binder">p</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="WPsem.html#r:195"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="WPsem.html#p:196"><span class="id" title="variable">p</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="WPsem.html#p:196"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="WPsem.html#v:194"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="WPsem.html#Q:193"><span class="id" title="variable">Q</span></a> <a class="idref" href="WPsem.html#r:195"><span class="id" title="variable">r</span></a><a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#val_ref"><span class="id" title="constructor">val_ref</span></a> <a class="idref" href="WPsem.html#v:194"><span class="id" title="variable">v</span></a>) <a class="idref" href="WPsem.html#Q:193"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans"><span class="id" title="lemma">himpl_trans</span></a> <a class="idref" href="WPsem.html#TexanTriples.wp_ref_1"><span class="id" title="lemma">wp_ref_1</span></a>. <span class="id" title="var">xsimpl</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Interestingly, the variable <span class="inlinecode"><span class="id" title="var">r</span></span>, which is equal to <span class="inlinecode"><span class="id" title="var">val_loc</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span>, can now be
    substituted away, further increasing readability. We obtain the
    specification of <span class="inlinecode"><span class="id" title="var">val_ref</span></span> in "Texan triple style". 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="TexanTriples.wp_ref_3" class="idref" href="#TexanTriples.wp_ref_3"><span class="id" title="lemma">wp_ref_3</span></a> : <span class="id" title="keyword">∀</span> <a id="Q:197" class="idref" href="#Q:197"><span class="id" title="binder">Q</span></a> <a id="v:198" class="idref" href="#v:198"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">∀</span></a> <a id="p:199" class="idref" href="#p:199"><span class="id" title="binder">p</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#p:199"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="WPsem.html#v:198"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="WPsem.html#Q:197"><span class="id" title="variable">Q</span></a> (<a class="idref" href="LibSepReference.html#val_loc"><span class="id" title="constructor">val_loc</span></a> <a class="idref" href="WPsem.html#p:199"><span class="id" title="variable">p</span></a>)<a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#val_ref"><span class="id" title="constructor">val_ref</span></a> <a class="idref" href="WPsem.html#v:198"><span class="id" title="variable">v</span></a>) <a class="idref" href="WPsem.html#Q:197"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans"><span class="id" title="lemma">himpl_trans</span></a> <a class="idref" href="WPsem.html#TexanTriples.wp_ref_2"><span class="id" title="lemma">wp_ref_2</span></a>. <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> ? <span class="id" title="var">p</span> →.<br/>
&nbsp;&nbsp;<span class="id" title="var">xchange</span> (<a class="idref" href="LibSepReference.html#SepSimplArgs.hforall_specialize"><span class="id" title="lemma">hforall_specialize</span></a> <span class="id" title="var">p</span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab300"></a><h3 class="section">2. The General Pattern</h3>

<div class="paragraph"> </div>

 Most specification triples can be cast in the form:
    <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">(<span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">r</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="tactic">∃</span></span> <span class="inlinecode"><span class="id" title="var">x<sub>1</sub></span></span> <span class="inlinecode">..</span> <span class="inlinecode"><span class="id" title="var">xN</span>,</span> <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">r</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">v</span>]</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H'</span>)</span>. In such a
    specification:

<div class="paragraph"> </div>

<ul class="doclist">
<li> the value <span class="inlinecode"><span class="id" title="var">v</span></span> may depend on the <span class="inlinecode"><span class="id" title="var">xi</span></span> variables,

</li>
<li> the heap predicate <span class="inlinecode"><span class="id" title="var">H'</span></span> may depend on <span class="inlinecode"><span class="id" title="var">r</span></span> and the <span class="inlinecode"><span class="id" title="var">xi</span></span>,

</li>
<li> the number of existentials <span class="inlinecode"><span class="id" title="var">xi</span></span> may vary, possibly be zero,

</li>
<li> the equality <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">r</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">v</span>]</span> may be removed if no pure fact is needed
      about <span class="inlinecode"><span class="id" title="var">r</span></span>.

</li>
</ul>

<div class="paragraph"> </div>

    Such a specification triple of the form
    <span class="inlinecode"><span class="id" title="var">triple</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">(<span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">r</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="tactic">∃</span></span> <span class="inlinecode"><span class="id" title="var">x<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">xN</span>,</span> <span class="inlinecode"><span class='gray-font'>\</span>[<span class="id" title="var">r</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">v</span>]</span> <span class="inlinecode"><span class='gray-font'>\</span>*</span> <span class="inlinecode"><span class="id" title="var">H'</span></span> can be be reformulated
    as the Texan triple: <span class="inlinecode">(\<span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">x<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">xN</span>,</span> <span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode"><span class="id" title="var">v</span>)</span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><span class="id" title="var">wp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>.

<div class="paragraph"> </div>

    We next formalize the equivalence between the two presentations, for the
    specific case where the specification involves a single auxiliary variable,
    named <span class="inlinecode"><span class="id" title="var">x</span></span>. The statement below makes it explicit that <span class="inlinecode"><span class="id" title="var">v</span></span> may depend on <span class="inlinecode"><span class="id" title="var">x</span></span>,
    and that <span class="inlinecode"><span class="id" title="var">H</span></span> may depend on <span class="inlinecode"><span class="id" title="var">r</span></span> and <span class="inlinecode"><span class="id" title="var">x</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="TexanTriples.texan_triple_equiv" class="idref" href="#TexanTriples.texan_triple_equiv"><span class="id" title="lemma">texan_triple_equiv</span></a> : <span class="id" title="keyword">∀</span> <a id="t:200" class="idref" href="#t:200"><span class="id" title="binder">t</span></a> <a id="H:201" class="idref" href="#H:201"><span class="id" title="binder">H</span></a> <a id="A:202" class="idref" href="#A:202"><span class="id" title="binder">A</span></a> (<a id="Hof:203" class="idref" href="#Hof:203"><span class="id" title="binder">Hof</span></a>:<a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="WPsem.html#A:202"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#SepSimplArgs.hprop"><span class="id" title="definition">hprop</span></a>) (<a id="vof:204" class="idref" href="#vof:204"><span class="id" title="binder">vof</span></a>:<a class="idref" href="WPsem.html#A:202"><span class="id" title="variable">A</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> <a class="idref" href="WPsem.html#t:200"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#H:201"><span class="id" title="variable">H</span></a> (<span class="id" title="keyword">fun</span> <a id="r:205" class="idref" href="#r:205"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">∃</span></a> <a id="x:206" class="idref" href="#x:206"><span class="id" title="binder">x</span></a><a class="idref" href="LibSepReference.html#961b41dcd8e5f7d3252676574333c51d"><span class="id" title="notation">,</span></a> <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="WPsem.html#r:205"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WPsem.html#vof:204"><span class="id" title="variable">vof</span></a> <a class="idref" href="WPsem.html#x:206"><span class="id" title="variable">x</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="WPsem.html#Hof:203"><span class="id" title="variable">Hof</span></a> <a class="idref" href="WPsem.html#r:205"><span class="id" title="variable">r</span></a> <a class="idref" href="WPsem.html#x:206"><span class="id" title="variable">x</span></a>)<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="Q:207" class="idref" href="#Q:207"><span class="id" title="binder">Q</span></a>, <a class="idref" href="WPsem.html#H:201"><span class="id" title="variable">H</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">∀</span></a> <a id="x:208" class="idref" href="#x:208"><span class="id" title="binder">x</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="WPsem.html#Hof:203"><span class="id" title="variable">Hof</span></a> (<a class="idref" href="WPsem.html#vof:204"><span class="id" title="variable">vof</span></a> <a class="idref" href="WPsem.html#x:208"><span class="id" title="variable">x</span></a>) <a class="idref" href="WPsem.html#x:208"><span class="id" title="variable">x</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="WPsem.html#Q:207"><span class="id" title="variable">Q</span></a> (<a class="idref" href="WPsem.html#vof:204"><span class="id" title="variable">vof</span></a> <a class="idref" href="WPsem.html#x:208"><span class="id" title="variable">x</span></a>)<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> <a class="idref" href="WPsem.html#t:200"><span class="id" title="variable">t</span></a> <a class="idref" href="WPsem.html#Q:207"><span class="id" title="variable">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="var">iff</span> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span>. <span class="id" title="var">xchange</span> <span class="id" title="var">M</span>. <span class="id" title="var">applys</span> <a class="idref" href="WPsem.html#wp_ramified_trans"><span class="id" title="lemma">wp_ramified_trans</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">r</span> <span class="id" title="var">x</span> →.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xchange</span> (<a class="idref" href="LibSepReference.html#SepSimplArgs.hforall_specialize"><span class="id" title="lemma">hforall_specialize</span></a> <span class="id" title="var">x</span>). }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_trans"><span class="id" title="lemma">himpl_trans</span></a> <span class="id" title="var">M</span>. <span class="id" title="var">xsimpl</span>¬. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab301"></a><h3 class="section">3. Further Examples</h3>

</div>
<div class="code">

<span class="id" title="keyword">Section</span> <a id="TexanTriples.WpSpecRef" class="idref" href="#TexanTriples.WpSpecRef"><span class="id" title="section">WpSpecRef</span></a>.<br/>
</div>

<div class="doc">
The wp-style specifications of <span class="inlinecode"><span class="id" title="var">ref</span></span>, <span class="inlinecode"><span class="id" title="var">get</span></span>, and <span class="inlinecode"><span class="id" title="tactic">set</span></span> are presented next.
    
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="TexanTriples.wp_get" class="idref" href="#TexanTriples.wp_get"><span class="id" title="lemma">wp_get</span></a> : <span class="id" title="keyword">∀</span> <a id="v:209" class="idref" href="#v:209"><span class="id" title="binder">v</span></a> <a id="p:210" class="idref" href="#p:210"><span class="id" title="binder">p</span></a> <a id="Q:211" class="idref" href="#Q:211"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#p:210"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="WPsem.html#v:209"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#p:210"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="WPsem.html#v:209"><span class="id" title="variable">v</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="WPsem.html#Q:211"><span class="id" title="variable">Q</span></a> <a class="idref" href="WPsem.html#v:209"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#val_get"><span class="id" title="constructor">val_get</span></a> <a class="idref" href="WPsem.html#p:210"><span class="id" title="variable">p</span></a>) <a class="idref" href="WPsem.html#Q:211"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="WPsem.html#triple_conseq_frame"><span class="id" title="axiom">triple_conseq_frame</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Rules.html#triple_get"><span class="id" title="lemma">triple_get</span></a>. } { <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_refl"><span class="id" title="lemma">himpl_refl</span></a>. } { <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> ? →. <span class="id" title="tactic">auto</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="TexanTriples.wp_set" class="idref" href="#TexanTriples.wp_set"><span class="id" title="lemma">wp_set</span></a> : <span class="id" title="keyword">∀</span> <a id="v:212" class="idref" href="#v:212"><span class="id" title="binder">v</span></a> <a id="w:213" class="idref" href="#w:213"><span class="id" title="binder">w</span></a> <a id="p:214" class="idref" href="#p:214"><span class="id" title="binder">p</span></a> <a id="Q:215" class="idref" href="#Q:215"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#p:214"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="WPsem.html#v:212"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">∀</span></a> <a id="r:216" class="idref" href="#r:216"><span class="id" title="binder">r</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="WPsem.html#p:214"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="WPsem.html#w:213"><span class="id" title="variable">w</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="WPsem.html#Q:215"><span class="id" title="variable">Q</span></a> <a class="idref" href="WPsem.html#r:216"><span class="id" title="variable">r</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#val_set"><span class="id" title="constructor">val_set</span></a> <a class="idref" href="WPsem.html#p:214"><span class="id" title="variable">p</span></a> <a class="idref" href="WPsem.html#w:213"><span class="id" title="variable">w</span></a>) <a class="idref" href="WPsem.html#Q:215"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="WPsem.html#triple_conseq_frame"><span class="id" title="axiom">triple_conseq_frame</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Rules.html#triple_set"><span class="id" title="axiom">triple_set</span></a>. } { <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_refl"><span class="id" title="lemma">himpl_refl</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">r</span>. <span class="id" title="var">xchange</span> (<a class="idref" href="LibSepReference.html#SepSimplArgs.hforall_specialize"><span class="id" title="lemma">hforall_specialize</span></a> <span class="id" title="var">r</span>). <span class="id" title="var">xsimpl</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="TexanTriples.wp_free" class="idref" href="#TexanTriples.wp_free"><span class="id" title="lemma">wp_free</span></a> : <span class="id" title="keyword">∀</span> <a id="v:217" class="idref" href="#v:217"><span class="id" title="binder">v</span></a> <a id="p:218" class="idref" href="#p:218"><span class="id" title="binder">p</span></a> <a id="Q:219" class="idref" href="#Q:219"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#p:218"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="WPsem.html#v:217"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">∀</span></a> <a id="r:220" class="idref" href="#r:220"><span class="id" title="binder">r</span></a><a class="idref" href="LibSepReference.html#466ecb7d71d07e4d74c1c028c2497a<sub>33</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="WPsem.html#Q:219"><span class="id" title="variable">Q</span></a> <a class="idref" href="WPsem.html#r:220"><span class="id" title="variable">r</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#val_free"><span class="id" title="constructor">val_free</span></a> <a class="idref" href="WPsem.html#p:218"><span class="id" title="variable">p</span></a>) <a class="idref" href="WPsem.html#Q:219"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="WPsem.html#triple_conseq_frame"><span class="id" title="axiom">triple_conseq_frame</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="Rules.html#triple_free"><span class="id" title="lemma">triple_free</span></a>. } { <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_refl"><span class="id" title="lemma">himpl_refl</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">r</span>. <span class="id" title="var">xchange</span> (<a class="idref" href="LibSepReference.html#SepSimplArgs.hforall_specialize"><span class="id" title="lemma">hforall_specialize</span></a> <span class="id" title="var">r</span>). }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Alternatively, the specifications of <span class="inlinecode"><span class="id" title="tactic">set</span></span> and <span class="inlinecode"><span class="id" title="var">free</span></span> may advertize that the
    output value is the unit value. 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="TexanTriples.triple_set'" class="idref" href="#TexanTriples.triple_set'"><span class="id" title="axiom">triple_set'</span></a> : <span class="id" title="keyword">∀</span> <a id="w:221" class="idref" href="#w:221"><span class="id" title="binder">w</span></a> <a id="p:222" class="idref" href="#p:222"><span class="id" title="binder">p</span></a> <a id="v:223" class="idref" href="#v:223"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_set"><span class="id" title="constructor">val_set</span></a> <a class="idref" href="WPsem.html#p:222"><span class="id" title="variable">p</span></a> <a class="idref" href="WPsem.html#w:221"><span class="id" title="variable">w</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="WPsem.html#p:222"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="WPsem.html#v:223"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:224" class="idref" href="#r:224"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="WPsem.html#r:224"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="WPsem.html#p:222"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="WPsem.html#w:221"><span class="id" title="variable">w</span></a>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="TexanTriples.wp_set'" class="idref" href="#TexanTriples.wp_set'"><span class="id" title="lemma">wp_set'</span></a> : <span class="id" title="keyword">∀</span> <a id="v:226" class="idref" href="#v:226"><span class="id" title="binder">v</span></a> <a id="w:227" class="idref" href="#w:227"><span class="id" title="binder">w</span></a> <a id="p:228" class="idref" href="#p:228"><span class="id" title="binder">p</span></a> <a id="Q:229" class="idref" href="#Q:229"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#p:228"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="WPsem.html#v:226"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#p:228"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="WPsem.html#w:227"><span class="id" title="variable">w</span></a> <a class="idref" href="LibSepReference.html#1153660e6ba8dfddb6aef382b72370c<sub>9</sub>"><span class="id" title="notation"><span class='gray-font'>\</span><span class="nowrap">&minus;&lowast;</span></span></a> <a class="idref" href="WPsem.html#Q:229"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#val_set"><span class="id" title="constructor">val_set</span></a> <a class="idref" href="WPsem.html#p:228"><span class="id" title="variable">p</span></a> <a class="idref" href="WPsem.html#w:227"><span class="id" title="variable">w</span></a>) <a class="idref" href="WPsem.html#Q:229"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="WPsem.html#triple_conseq_frame"><span class="id" title="axiom">triple_conseq_frame</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="WPsem.html#TexanTriples.triple_set'"><span class="id" title="axiom">triple_set'</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_refl"><span class="id" title="lemma">himpl_refl</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> ? →. <span class="id" title="tactic">auto</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Parameter</span> <a id="TexanTriples.triple_free'" class="idref" href="#TexanTriples.triple_free'"><span class="id" title="axiom">triple_free'</span></a> : <span class="id" title="keyword">∀</span> <a id="p:230" class="idref" href="#p:230"><span class="id" title="binder">p</span></a> <a id="v:231" class="idref" href="#v:231"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="LibSepReference.html#val_free"><span class="id" title="constructor">val_free</span></a> <a class="idref" href="WPsem.html#p:230"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="WPsem.html#p:230"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="WPsem.html#v:231"><span class="id" title="variable">v</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="r:232" class="idref" href="#r:232"><span class="id" title="binder">r</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="WPsem.html#r:232"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="TexanTriples.wp_free'" class="idref" href="#TexanTriples.wp_free'"><span class="id" title="lemma">wp_free'</span></a> : <span class="id" title="keyword">∀</span> <a id="v:234" class="idref" href="#v:234"><span class="id" title="binder">v</span></a> <a id="w:235" class="idref" href="#w:235"><span class="id" title="binder">w</span></a> <a id="p:236" class="idref" href="#p:236"><span class="id" title="binder">p</span></a> <a id="Q:237" class="idref" href="#Q:237"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#p:236"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="WPsem.html#v:234"><span class="id" title="variable">v</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#Q:237"><span class="id" title="variable">Q</span></a> <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a> <a class="idref" href="LibSepReference.html#c7ebd77e939e3f02c508e57b470dc021"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="WPsem.html#wp"><span class="id" title="definition">wp</span></a> (<a class="idref" href="LibSepReference.html#val_free"><span class="id" title="constructor">val_free</span></a> <a class="idref" href="WPsem.html#p:236"><span class="id" title="variable">p</span></a>) <a class="idref" href="WPsem.html#Q:237"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="WPsem.html#wp_equiv"><span class="id" title="lemma">wp_equiv</span></a>. <span class="id" title="var">applys</span> <a class="idref" href="WPsem.html#triple_conseq_frame"><span class="id" title="axiom">triple_conseq_frame</span></a>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="WPsem.html#TexanTriples.triple_free'"><span class="id" title="axiom">triple_free'</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">applys</span> <a class="idref" href="LibSepReference.html#SepSimplArgs.himpl_refl"><span class="id" title="lemma">himpl_refl</span></a>. }<br/>
&nbsp;&nbsp;{ <span class="id" title="var">xsimpl</span>. <span class="id" title="tactic">intros</span> ? →. <span class="id" title="tactic">auto</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="WPsem.html#TexanTriples.WpSpecRef"><span class="id" title="section">WpSpecRef</span></a>.<br/>
</div>

<div class="doc">
<a id="lab302"></a><h3 class="section">4. Exercise</h3>

<div class="paragraph"> </div>

 Let us put to practice the use of a Texan triple on a different example.
    Recall the function <span class="inlinecode"><span class="id" title="var">incr</span></span> and its specification (from <span class="inlinecode"><span class="id" title="var">Hprop.v</span></span>). 
</div>
<div class="code">

<span class="id" title="keyword">Parameter</span> <a id="TexanTriples.incr" class="idref" href="#TexanTriples.incr"><span class="id" title="axiom">incr</span></a> : <a class="idref" href="LibSepReference.html#val"><span class="id" title="inductive">val</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Parameter</span> <a id="TexanTriples.triple_incr" class="idref" href="#TexanTriples.triple_incr"><span class="id" title="axiom">triple_incr</span></a> : <span class="id" title="keyword">∀</span> (<a id="p:239" class="idref" href="#p:239"><span class="id" title="binder">p</span></a>:<a class="idref" href="LibSepReference.html#loc"><span class="id" title="definition">loc</span></a>) (<a id="n:240" class="idref" href="#n:240"><span class="id" title="binder">n</span></a>:<span class="id" title="notation">int</span>),<br/>
&nbsp;&nbsp;<a class="idref" href="LibSepReference.html#triple"><span class="id" title="definition">triple</span></a> (<a class="idref" href="WPsem.html#TexanTriples.incr"><span class="id" title="axiom">incr</span></a> <a class="idref" href="WPsem.html#p:239"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="WPsem.html#p:239"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="WPsem.html#n:240"><span class="id" title="variable">n</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="v:241" class="idref" href="#v:241"><span class="id" title="binder">v</span></a> ⇒ <a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation"><span class='gray-font'>\</span>[</span></a><a class="idref" href="WPsem.html#v:241"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="LibSepReference.html#val_unit"><span class="id" title="constructor">val_unit</span></a><a class="idref" href="LibSepReference.html#d090ebaffe5a082b6a27552ccf013e<sub>09</sub>"><span class="id" title="notation">]</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation"><span class='gray-font'>\</span>*</span></a> <a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#p:239"><span class="id" title="variable">p</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">~~&gt;</span></a> <a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">(</span></a><a class="idref" href="WPsem.html#n:240"><span class="id" title="variable">n</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a>1<a class="idref" href="LibSepReference.html#04d59e26c33e7500ff8979242a3d649f"><span class="id" title="notation">)</span></a><a class="idref" href="LibSepReference.html#6e7aeeae3643da4efcca62b993bbca40"><span class="id" title="notation">)</span></a>).<br/>
</div>

<div class="doc">
<a id="lab303"></a><h4 class="section">Exercise: 3 stars, standard, especially useful (wp_incr)</h4>
 State a Texan triple for <span class="inlinecode"><span class="id" title="var">incr</span></span> as a lemma called <span class="inlinecode"><span class="id" title="var">wp_incr</span></span>, then prove this
    lemma from <span class="inlinecode"><span class="id" title="var">triple_incr</span></span>. 
</div>
<div class="code">

<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<span class="id" title="keyword">End</span> <a class="idref" href="WPsem.html#TexanTriples"><span class="id" title="module">TexanTriples</span></a>.<br/>
</div>

<div class="doc">
<a id="lab304"></a><h2 class="section">Historical Notes</h2>

<div class="paragraph"> </div>

 The idea of weakest precondition was introduced by <a href="Bib.html#Dijstra-1975"><span class="inlineref">[Dijstra 1975]</span></a> in
    his seminal paper "Guarded Commands, Nondeterminacy and Formal Derivation of
    Programs". Weakest preconditions provide a reformulation of Floyd-Hoare
    logic. Numerous practical verification tools leverage weakest preconditions,
    e.g. ESC/Java, Why3, Boogie, Spec, etc.

    In the context of Separation Logic in proof assistants, the Iris framework
     <a href='https://iris-project.org/),'>https://iris-project.org/),</a>developed since 2015, prevasively exploits
    weakest preconditions to state reasoning rules. The developers of Iris and
    VST have advocated for this rule. The ramified frame rule was integrated in
    CFML 2.0 in 2018. 
</div>
<div class="code">

<span class="comment">(*&nbsp;2024-10-24&nbsp;22:02&nbsp;*)</span><br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>